/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 23);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var CONST = exports.CONST = {
    url: {
        base: 'http://api.luxgram.ru/v1/',
        registration: 'registration/basic/',
        login: 'registration/basic/login',
        confirmation: 'registration/basic/confirmation?token',
        instagram_addAccount: 'instagram-accounts/',
        instagramAccount_getMetaData: 'instagram-accounts/meta',
        instagramAccount_checkpoint: 'instagram-accounts/checkpoint/',
        instagramAccount_confirmKey: 'instagram-accounts/checkpoint/',
        instagramDirect_getMetaData: '/instagram-direct/meta'
    },
    user: {
        email: '',
        password: '',
        token: ''
    },
    cookieStorage: {
        token: 'user_logged',
        emailConfirmed: 'email_confirmed'
    },
    uiSelectors: {
        headerLoginBox: 'nav .login-box',
        headerNavLoginBtn: 'nav ul li .js_login',
        headerRegBox: 'nav .register-box',
        headerRegBtn: 'nav ul li .js_register',
        instagram: {
            addAccountBtnSelector: '#js_show-login-box',
            addAccountBtnId: 'js_show-login-box'
        }
    },
    events: {
        USER_LOGGED: 'user_logged',
        USER_LOGOUT: 'user_logout',
        USER_EMAIL_CONFIRMED: 'user_email_confirmed',
        STOP_FIXED_SPINNER: 'stop_fixed_spinner'
    },
    getPath: function getPath(name) {
        return this.url.base + this.url[name];
    }
};

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';


var _consts = __webpack_require__(0);

var _network = __webpack_require__(5);

var _network2 = _interopRequireDefault(_network);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var User = function () {
    function User() {
        _classCallCheck(this, User);

        this.network = new _network2.default();
        this.cookieStorage = _cookie2.default;
        this.settingPost = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        };
    }

    _createClass(User, [{
        key: 'isLoggedIn',
        value: function isLoggedIn() {
            return !!this.getToken();
        }
    }, {
        key: 'isEmailConfirmed',
        value: function isEmailConfirmed() {
            return this.cookieStorage.get(_consts.CONST.cookieStorage.emailConfirmed) === 'confirmed';
        }
    }, {
        key: 'getToken',
        value: function getToken() {
            var cookieToken = this.cookieStorage.get(_consts.CONST.cookieStorage.token);
            return cookieToken;
        }
    }, {
        key: 'login',
        value: function login(formData, cbError) {
            var setting = _extends({}, this.settingPost, { body: JSON.stringify(formData) });
            return this.network.sendRequest(_consts.CONST.getPath('login'), setting, cbError);
        }
    }, {
        key: 'addInstagramAccount',
        value: function addInstagramAccount(formData, cbError) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify(formData),
                headers: _extends({}, this.settingPost.headers, {
                    token: this.getToken()
                })
            });
            return this.network.sendRequest(_consts.CONST.getPath('instagram_addAccount'), setting, cbError);
        }
    }, {
        key: 'getInstagramAccount',
        value: function getInstagramAccount() {
            var setting = _extends({}, this.settingPost, {
                method: 'GET',
                headers: _extends({}, this.settingPost.headers, {
                    token: this.getToken()
                })
            });
            return this.network.sendRequest(_consts.CONST.getPath('instagram_addAccount'), setting);
        }
    }, {
        key: 'confirm',
        value: function confirm(token) {
            // const confirmUrl = CONST.getPath('confirmation');
            return this.network.sendRequest('' + (_consts.CONST.getPath('confirmation') + token));
        }
    }, {
        key: 'register',
        value: function register(formData) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify(formData)
            });
            return this.network.sendRequest(_consts.CONST.getPath('registration'), setting);
        }
    }, {
        key: 'getMetadata',
        value: function getMetadata(token, cbError) {
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_getMetaData'), { headers: { token: token } }, cbError);
        }
    }, {
        key: 'getSecurityKey',
        value: function getSecurityKey(username, checkpointType) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify({ 'type': checkpointType }), // todo: tmp set, it should be 'type'
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            });
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_checkpoint') + username, setting);
        }
    }, {
        key: 'confirmSecurityKey',
        value: function confirmSecurityKey(key, username) {
            var setting = {
                method: 'DELETE',
                body: JSON.stringify({ 'security_code': key }),
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            };
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_confirmKey') + username, setting);
        }
    }]);

    return User;
}();

var userInstance = null;

if (!userInstance) {
    userInstance = new User();
}

exports.default = userInstance;

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var CookieSrv = {
    get: function get(name) {
        var c = document.cookie.match('(?:(?:^|.*; *)' + name + ' *= *([^;]*).*$)|^.*$')[1];
        if (c) {
            return decodeURIComponent(c);
        }
    },
    set: function set(name, value) {
        var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : { path: '/', days: 365 };

        if (opts.days) {
            opts['max-age'] = opts.days * 60 * 60 * 24;
            delete opts.days;
        }
        // eslint-disable-next-line no-param-reassign
        opts = Object.entries(opts).reduce(function (str, _ref) {
            var _ref2 = _slicedToArray(_ref, 2),
                k = _ref2[0],
                v = _ref2[1];

            return str + '; ' + k + '=' + v;
        }, '');
        document.cookie = name + '=' + (encodeURIComponent(value) + opts);
    },
    remove: function remove(name, opts) {
        return CookieSrv.set(name, '', _extends({ 'max-age': -1, path: '/', days: 0 }, opts)
        // path & domain must match cookie being deleted
        );
    } };

/*
class CookieStorage {
    read(key) {
        const value = $.cookie(key);
        return value === undefined ? null : value;
    }

    setCookie(name, value, days) {
        let expires = '';
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = `; expires=${date.toUTCString()}`;
        }
        document.cookie = `${name} =${(value || '') + expires}; path=/`;
    }

    getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length == 2) {
            return parts.pop().split(';').shift();
        }
    }
}
*/

exports.default = CookieSrv;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// import $ from 'jquery';
// import {CONST} from './consts';

function viewUtils() {
    function showInfoMessage(selector, message1, message2) {
        $(selector).empty().append('' + (message1 ? '<p>status: ' + message1 + '</p>' : '')).append('<p>' + message2 + ' </p>');
    }

    function fillList($list, dataArray) {
        var items = dataArray;
        var cList = $list;
        cList.empty();
        items.forEach(function (item, i) {
            var li = $('<li class="list-group-item"></li>').appendTo(cList);
            $('<a/>').addClass('ui-all').text(item.username).appendTo(li);
        });
    }

    function isEmail(email) {
        /* eslint-disable */
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
        /* eslint-enable */
    }

    return {
        showInfoMessage: showInfoMessage,
        fillList: fillList,
        isEmail: isEmail
    };
}

exports.default = viewUtils();

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {/**
 * Copyright (c) 2010,2011,2012,2013,2014 Morgan Roderick http://roderick.dk
 * License: MIT - http://mrgnrdrck.mit-license.org
 *
 * https://github.com/mroderick/PubSubJS
 */

(function (root, factory){
    'use strict';

    var PubSub = {};
    root.PubSub = PubSub;

    var define = root.define;

    factory(PubSub);

    // AMD support
    if (typeof define === 'function' && define.amd){
        define(function() { return PubSub; });

        // CommonJS and Node.js module support
    } else if (true){
        if (module !== undefined && module.exports) {
            exports = module.exports = PubSub; // Node.js specific `module.exports`
        }
        exports.PubSub = PubSub; // CommonJS module 1.1.1 spec
        module.exports = exports = PubSub; // CommonJS
    }

}(( typeof window === 'object' && window ) || this, function (PubSub){
    'use strict';

    var messages = {},
        lastUid = -1;

    function hasKeys(obj){
        var key;

        for (key in obj){
            if ( obj.hasOwnProperty(key) ){
                return true;
            }
        }
        return false;
    }

    /**
     * Returns a function that throws the passed exception, for use as argument for setTimeout
     * @alias throwException
     * @function
     * @param { Object } ex An Error object
     */
    function throwException( ex ){
        return function reThrowException(){
            throw ex;
        };
    }

    function callSubscriberWithDelayedExceptions( subscriber, message, data ){
        try {
            subscriber( message, data );
        } catch( ex ){
            setTimeout( throwException( ex ), 0);
        }
    }

    function callSubscriberWithImmediateExceptions( subscriber, message, data ){
        subscriber( message, data );
    }

    function deliverMessage( originalMessage, matchedMessage, data, immediateExceptions ){
        var subscribers = messages[matchedMessage],
            callSubscriber = immediateExceptions ? callSubscriberWithImmediateExceptions : callSubscriberWithDelayedExceptions,
            s;

        if ( !messages.hasOwnProperty( matchedMessage ) ) {
            return;
        }

        for (s in subscribers){
            if ( subscribers.hasOwnProperty(s)){
                callSubscriber( subscribers[s], originalMessage, data );
            }
        }
    }

    function createDeliveryFunction( message, data, immediateExceptions ){
        return function deliverNamespaced(){
            var topic = String( message ),
                position = topic.lastIndexOf( '.' );

            // deliver the message as it is now
            deliverMessage(message, message, data, immediateExceptions);

            // trim the hierarchy and deliver message to each level
            while( position !== -1 ){
                topic = topic.substr( 0, position );
                position = topic.lastIndexOf('.');
                deliverMessage( message, topic, data, immediateExceptions );
            }
        };
    }

    function messageHasSubscribers( message ){
        var topic = String( message ),
            found = Boolean(messages.hasOwnProperty( topic ) && hasKeys(messages[topic])),
            position = topic.lastIndexOf( '.' );

        while ( !found && position !== -1 ){
            topic = topic.substr( 0, position );
            position = topic.lastIndexOf( '.' );
            found = Boolean(messages.hasOwnProperty( topic ) && hasKeys(messages[topic]));
        }

        return found;
    }

    function publish( message, data, sync, immediateExceptions ){
        message = (typeof message === 'symbol') ? message.toString() : message;

        var deliver = createDeliveryFunction( message, data, immediateExceptions ),
            hasSubscribers = messageHasSubscribers( message );

        if ( !hasSubscribers ){
            return false;
        }

        if ( sync === true ){
            deliver();
        } else {
            setTimeout( deliver, 0 );
        }
        return true;
    }

    /**
     * Publishes the message, passing the data to it's subscribers
     * @function
     * @alias publish
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    PubSub.publish = function( message, data ){
        return publish( message, data, false, PubSub.immediateExceptions );
    };

    /**
     * Publishes the the message synchronously, passing the data to it's subscribers
     * @function
     * @alias publishSync
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    PubSub.publishSync = function( message, data ){
        return publish( message, data, true, PubSub.immediateExceptions );
    };

    /**
     * Subscribes the passed function to the passed message. Every returned token is unique and should be stored if you need to unsubscribe
     * @function
     * @alias subscribe
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { String }
     */
    PubSub.subscribe = function( message, func ){
        if ( typeof func !== 'function'){
            return false;
        }

        message = (typeof message === 'symbol') ? message.toString() : message;

        // message is not registered yet
        if ( !messages.hasOwnProperty( message ) ){
            messages[message] = {};
        }

        // forcing token as String, to allow for future expansions without breaking usage
        // and allow for easy use as key names for the 'messages' object
        var token = 'uid_' + String(++lastUid);
        messages[message][token] = func;
        
        // return token for unsubscribing
        return token;
    };

    /**
     * Subscribes the passed function to the passed message once
     * @function
     * @alias subscribeOnce
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { PubSub }
     */
    PubSub.subscribeOnce = function( message, func ){
        var token = PubSub.subscribe( message, function(){
            // before func apply, unsubscribe message
            PubSub.unsubscribe( token );
            func.apply( this, arguments );
        });
        return PubSub;
    };

    /**
     * Clears all subscriptions
     * @function
     * @public
     * @alias clearAllSubscriptions
     */
    PubSub.clearAllSubscriptions = function clearAllSubscriptions(){
        messages = {};
    };

    /**
     * Clear subscriptions by the topic
     * @function
     * @public
     * @alias clearAllSubscriptions
     */
    PubSub.clearSubscriptions = function clearSubscriptions(topic){
        var m;
        for (m in messages){
            if (messages.hasOwnProperty(m) && m.indexOf(topic) === 0){
                delete messages[m];
            }
        }
    };

    /**
     * Removes subscriptions
     *
     * - When passed a token, removes a specific subscription.
     *
	 * - When passed a function, removes all subscriptions for that function
     *
	 * - When passed a topic, removes all subscriptions for that topic (hierarchy)
     * @function
     * @public
     * @alias subscribeOnce
     * @param { String | Function } value A token, function or topic to unsubscribe from
     * @example // Unsubscribing with a token
     * var token = PubSub.subscribe('mytopic', myFunc);
     * PubSub.unsubscribe(token);
     * @example // Unsubscribing with a function
     * PubSub.unsubscribe(myFunc);
     * @example // Unsubscribing from a topic
     * PubSub.unsubscribe('mytopic');
     */
    PubSub.unsubscribe = function(value){
        var descendantTopicExists = function(topic) {
                var m;
                for ( m in messages ){
                    if ( messages.hasOwnProperty(m) && m.indexOf(topic) === 0 ){
                        // a descendant of the topic exists:
                        return true;
                    }
                }

                return false;
            },
            isTopic    = typeof value === 'string' && ( messages.hasOwnProperty(value) || descendantTopicExists(value) ),
            isToken    = !isTopic && typeof value === 'string',
            isFunction = typeof value === 'function',
            result = false,
            m, message, t;

        if (isTopic){
            PubSub.clearSubscriptions(value);
            return;
        }

        for ( m in messages ){
            if ( messages.hasOwnProperty( m ) ){
                message = messages[m];

                if ( isToken && message[value] ){
                    delete message[value];
                    result = value;
                    // tokens are unique, so we can just stop here
                    break;
                }

                if (isFunction) {
                    for ( t in message ){
                        if (message.hasOwnProperty(t) && message[t] === value){
                            delete message[t];
                            result = true;
                        }
                    }
                }
            }
        }

        return result;
    };
}));

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(22)(module)))

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';


var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Network = function () {
    function Network() {
        _classCallCheck(this, Network);
    }

    _createClass(Network, [{
        key: 'cbErrorDefault',
        value: function cbErrorDefault(result) {
            var $el = $('#description').length ? $('#description') : $('.error-msg');
            _view2.default.showInfoMessage($el, result.status.state, result.status.message || 'Login error');
        }
    }, {
        key: 'checkStatus',
        value: function checkStatus(response) {
            if (response.status && response.status >= 200 && response.status < 300) {
                return response;
            } else {
                var error = new Error(response.statusText);
                error.response = response;
                throw error;
            }
        }
    }, {
        key: 'sendRequest',
        value: function sendRequest(URL, OPTS, cbError) {
            var _this = this;

            return fetch(URL, OPTS).then(function (response) {
                return Promise.all([response, response.json()]);
            }).then(function (_ref) {
                var _ref2 = _slicedToArray(_ref, 2),
                    response = _ref2[0],
                    json = _ref2[1];

                if (!response.ok) {
                    if (!cbError) {
                        _this.cbErrorDefault(json);
                    } else {
                        cbError(json); // update view
                    }
                    _this.checkStatus(response);
                    // throw new Error(json.status.message);
                }
                return json;
            });
        }
    }]);

    return Network;
}();

exports.default = Network;

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


__webpack_require__(18);

var _registerForm = __webpack_require__(14);

var _registerForm2 = _interopRequireDefault(_registerForm);

var _loginForm = __webpack_require__(11);

var _loginPage = __webpack_require__(16);

var _confirmReg = __webpack_require__(7);

var _instagram = __webpack_require__(17);

var _header = __webpack_require__(9);

var header = _interopRequireWildcard(_header);

var _burgerMenu = __webpack_require__(8);

var burgerMenu = _interopRequireWildcard(_burgerMenu);

var _consts = __webpack_require__(0);

var _instagramAccountsList = __webpack_require__(10);

var instagramAccounts = _interopRequireWildcard(_instagramAccountsList);

var _messages = __webpack_require__(13);

var messages = _interopRequireWildcard(_messages);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import 'bootstrap';

var selectorCssLoginForm = {
    _loginBox: _consts.CONST.uiSelectors.headerLoginBox,
    _formId: '#js_login-form',
    _buttonSubmitId: '#js_login_btn',
    _showLoginBoxBtnId: _consts.CONST.uiSelectors.headerNavLoginBtn
};

var selectorCssLoginFormInstagram = {
    _loginBox: 'main .login-box',
    _formId: '#js_instagram-add-account',
    _buttonSubmitId: '#js_instagram-add-account--btn',
    _showLoginBoxBtnId: '#js_show-login-box',
    isLoginInstagram: true
};

var init = function init() {
    // console.log('init js here', CONST.user);
    new _registerForm2.default().init();
    (0, _loginForm.LoginForm)(selectorCssLoginForm).init();
    (0, _loginForm.LoginForm)(selectorCssLoginFormInstagram).init(); // init instagram login form*!/
    (0, _loginPage.LoginPage)({
        _loginBox: '.auth.login .card-signin',
        _formId: '.form-signin',
        _buttonSubmitId: '.form-signin [type="submit"]'
    }).init();
    (0, _instagram.Instagram)().init();
    (0, _confirmReg.confirmationWithRedirect)().init();
    header.initHeader();
    burgerMenu.init();
    instagramAccounts.init();
    messages.init();
};

(function () {
    return init();
})();

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.confirmationWithRedirect = confirmationWithRedirect;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _consts = __webpack_require__(0);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var parseQueryString = function parseQueryString() {

    var str = window.location.search;
    var objURL = {};

    str.replace(new RegExp('([^?=&]+)(=([^&]*))?', 'g'), function ($0, $1, $2) {
        objURL[$1] = $2;
    });
    return objURL;
}; /* eslint-disable sort-vars */
// import $ from 'jquery';
function confirmationWithRedirect() {
    var user = _user2.default;
    var params = parseQueryString();
    // Example how to use it:

    var sendConfirm = function sendConfirm(token) {
        user.confirm(token).then(function (result) {
            if (result.status && result.status.state === 'ok') {

                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.emailConfirmed, 'confirmed');
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);

                // window.location = confirm-registration.html?token='from server';

                // retrieve the object in a string form
                var customersDataString = sessionStorage.getItem('customersData');
                console.log(customersDataString);
                console.log('request succeeded with JSON response', result);
                $('.confirm-registration').append('<p>confirmation status: ' + result.status.state + '</p>');
                setTimeout(function () {
                    window.location = './profile.html';
                }, 1000);
            } else if (result.status) {
                console.log(result);
            } else {
                console.log(result);
            }
        });
    };

    var redirect = function redirect() {
        // eslint-disable-next-line dot-notation
        var token = params['token'];

        if (!location.pathname.indexOf('confirm-registration')) {
            return;
        }
        if (token) {
            console.log('send req to ', token);
            sendConfirm(token);
        }
    };

    function init() {
        redirect();
    }

    return {
        init: init
    };
}

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;
// import $ from 'jquery';

// const hamburgerButtonCls = '#aside_mobile__button';
// const hamburgerMenuCls = '.aside-burger-menu';
// const hamburgerMenuOpenedClass = 'burger-menu--closed';
// const hamburgerButtonCloseClass = 'burger-menu__button--close';
var selectorsEl = {
    leftMenu: {
        hamburgerButtonCls: '#aside_mobile__button',
        hamburgerMenuCls: '.aside-burger-menu',
        hamburgerMenuOpenedClass: 'burger-menu--closed',
        hamburgerButtonCloseClass: 'burger-menu__button--close'
    },
    rightMenu: {
        hamburgerButtonCls: '#header_mobile_toggler',
        hamburgerMenuCls: '.r-side-burger-menu',
        hamburgerMenuOpenedClass: 'r-side-burger-menu--open',
        hamburgerButtonCloseClass: 'burger-menu-right__button--close'
    },
    subHeader: {
        hamburgerButtonCls: '#header_mobile_topbar_toggler',
        hamburgerMenuCls: '.sub-header',
        hamburgerMenuOpenedClass: 'sub-header--open',
        hamburgerButtonCloseClass: 'sub-header-button--close'
    }
};

/**
 * Toggle hamburger menu popover
 */
function toggleHamburgerMenu(menuName) {
    var _selectorsEl$menuName = selectorsEl[menuName],
        hamburgerMenuCls = _selectorsEl$menuName.hamburgerMenuCls,
        hamburgerButtonCls = _selectorsEl$menuName.hamburgerButtonCls,
        hamburgerButtonCloseClass = _selectorsEl$menuName.hamburgerButtonCloseClass,
        hamburgerMenuOpenedClass = _selectorsEl$menuName.hamburgerMenuOpenedClass;

    $(hamburgerButtonCls).toggleClass(hamburgerButtonCloseClass);
    $(hamburgerMenuCls).toggleClass(hamburgerMenuOpenedClass);
}

/**
 * Init hamburger menu
 */
function init() {
    var leftMenu = 'leftMenu';
    var rightMenu = 'rightMenu';
    var subHeader = 'subHeader';

    $(selectorsEl[leftMenu].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, leftMenu));
    $(selectorsEl[rightMenu].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, rightMenu));
    $(selectorsEl[subHeader].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, subHeader));
}

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.initHeader = initHeader;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var selectorLoginState = '.js_message_logged--text'; // https://www.npmjs.com/package/pubsub-js
// import $ from 'jquery';

var selectorEmailConfirmState = '.js_email-confirm--text';
var closeClass = 'd-none';
var openedClass = 'd-block';

function emailNotConfirmed() {
    var $emailnMsg = $(selectorEmailConfirmState);
    $emailnMsg.text('**emailNotConfirmed** Email не подтвержден.').css('color', 'lightcoral');
}

function onLoginSubscribe(msg, data) {
    // console.log(msg, data);
    $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(closeClass).removeClass(openedClass);
    $(_consts.CONST.uiSelectors.headerRegBtn).addClass(closeClass).removeClass(openedClass);
    $(_consts.CONST.uiSelectors.headerLoginBox).addClass(closeClass).removeClass(openedClass);

    $('.nav-link.js_logOut').addClass(openedClass).removeClass(closeClass); // show
    var $loginMsg = $(selectorLoginState);
    $loginMsg.text('**onLoginSubscribe** вы залогинились в Luxgram успешно').css('color', 'lightblue');
    var isEmailConfirmed = _user2.default.isEmailConfirmed();
    if (!isEmailConfirmed) {
        emailNotConfirmed();
    }
}

function showLogout() {
    // check is logged
    var isLogged = _user2.default.isLoggedIn();
    var isEmailConfirmed = _user2.default.isEmailConfirmed();
    if (!isEmailConfirmed) {
        emailNotConfirmed();
    }
    if (isLogged) {
        $('.nav-link.js_logOut').parent().show();
        $('.js_email-confirm--text').text('вы залогинились успешно');
        var oldURL = document.referrer;
        // console.log(oldURL);
        if (oldURL.includes('confirm-registration')) {
            $('.js_message_logged--text').text('вы подтвердили регистрацию');
        }
        onLoginSubscribe();
    } else {
        $(selectorLoginState).text('Привет анонимный пользователь');
        $(selectorEmailConfirmState).empty();
    }
}

/**
 * Init header
 */
function initHeader() {
    // check other handler in login-form.js
    var $loginBox = $(_consts.CONST.uiSelectors.headerLoginBox);
    var $registerBox = $(_consts.CONST.uiSelectors.headerRegBox);

    _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGGED, onLoginSubscribe);

    showLogout();

    $(_consts.CONST.uiSelectors.headerRegBtn).on('click', function () {
        $loginBox.hide();
        $registerBox.css({ 'top': 0, 'right': 0 }).addClass('bg-light border mt-5 mx-auto position-absolute px-3 d-block').removeClass('d-none');
    });

    $(_consts.CONST.uiSelectors.headerNavLoginBtn).on('click', function () {
        $loginBox.addClass('d-block').removeClass('d-none');
        $registerBox.addClass('d-none').removeClass('d-block');
    });
}

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
const staticResp = {
    'status': {
        'state': 'ok'
    },
    'data': {
        'accounts': [{
            'status': 'OK',
            'username': 'andrey.jakivchyk',
            'checkpoint': {
                'status': 'ABSENT',
                'type': 'PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            },
            'info': {
                'profile_pic_url': 'https://randomuser.me/api/portraits/men/50.jpg',
                'name': 'Андрей Якивчук',
                'biography': '',
                'url': '',
                'email': 'nidzuku@inbox.ru',
                'phone': '',
                'media_count': 2,
                'follower_count': 4,
                'following_count': 15
            }
        }, {
            'status': 'OK',
            'username': 'andrey.jakivchyk',
            'checkpoint': {
                'status': 'ABSENT',
                'type': 'EMAIL'
            },
            'tariff': {
                'status': 'ABSENT'
            },
            'info': {
                'profile_pic_url': 'https://randomuser.me/api/portraits/men/52.jpg',
                'name': 'Димон Паралон',
                'biography': 'biography text',
                'url': 'www.lenengrad.ru',
                'email': 'nidzuku@inbox.ru',
                'phone': '011-111-111-11',
                'media_count': 515,
                'following_count': 34
            }
        }, {
            'status': 'OK',
            'username': 'alex.smith',
            'checkpoint': {
                'status': 'TRIGGERED',
                'type': 'EMAIL_OR_PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            }
        }, {
            'status': 'OK',
            'username': '22andrey.jakivchyk2',
            'checkpoint': {
                'status': 'TRIGGERED',
                'type': 'PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            }
        }
        ],
        'available_proxy_purchase': true
    }
};
*/ /*
   const staticRespWithDelay = {
     'status': {
         'state': 'ok'
     },
     'data': {
         'accounts': [{
             'status': 'OK',
             'username': 'staticResp.WithDelay',
             'checkpoint': {
                 'status': 'ABSENT',
                 'type': 'PHONE'
             },
             'tariff': {
                 'status': 'ABSENT'
             }
         }],
         'available_proxy_purchase': true
     }
   };
   */

// После добавления аккаунта снова дернуть МЕТА и перерисовать список аккаунтов
// import $ from 'jquery';
var addInstagramAccount = function addInstagramAccount(newFormData) {
    var cbError = function cbError(result) {
        console.log('ERROR', result);
        _view2.default.showInfoMessage($('.error-msg'), result.status.state, result.status.message || 'Login error');
        // $(_loginBox).addClass(closeClass).removeClass(openedClass);
    };

    _user2.default.addInstagramAccount(newFormData, cbError).then(function (result) {
        if (result && result.status) {
            console.log(result, result.status);
            // debugger;
            var $msgList = $('.accounts-list');
            $msgList.empty();
            // todo : reload list
            // fillList($msgList, result.data.accounts);
            // addListHandler();

            // viewUtils.showInfoMessage($textAreaDescription,
            //     result.status.state,
            //     result.status.message || 'Login error');
            // $(_loginBox).addClass(closeClass).removeClass(openedClass);
        }
    }).catch(function (err) {
        // todo: render for user
        console.log(err);
    });

    console.log('submit', newFormData);
};
// import Spinner from '../../common/js-services/spinner';


function addOnLoadHandlers() {
    // $('.js_repeat-security-code').on('click', (e) => {

    // });

    $('.js_add-instagram-account').on('click', function (e) {
        var btn = $(e.target);
        var $modalBody = btn.closest('.modal').find('.modal-dialog .modal-body');
        var username = $modalBody.find('input[name="username"]').val().trim();
        var password = $modalBody.find('input[name="pass"]').val().trim();
        var $form = $('form', $modalBody);
        var form = $form.get(0);
        var cssValidationClass = 'form-validation';

        e.preventDefault();

        // const validator = new Validator($form);
        // console.log(validator.validate());
        if (form.checkValidity()) {
            addInstagramAccount({ username: username, password: password });
        } else {
            // Highlight errors
            if (form.reportValidity) {
                form.reportValidity();
            }
            $form.addClass(cssValidationClass);
        }

        if (!username || !password) {
            console.log('not valid - Empty fields');
            return;
        }
    });
}

function addListHandler() /* username*/{
    // $('#yourModalID').on('show.bs.modal', function(e) {
    //     var yourparameter = e.relatedTarget.dataset.yourparameter;
    //     // Do some stuff w/ it.
    // });
    var checkpointType = '';

    $('.js_pass-checkpoint-btn').on('click', function (e) {
        var $button = $(e.target);
        var username = $button.data('username');
        checkpointType = $button.data('checkpointType') || checkpointType;
        // $('#security-code').data('checkpointType', checkpointType);
        // todo add 'checkpointType' to modal
        var sendTo = checkpointType === 'PHONE' ? 'телефон' : 'email';
        // Spinner.start($button, 'fa-key');

        if (checkpointType === 'EMAIL_OR_PHONE') {
            e.stopPropagation();

            // инпуты спрятаны,
            // показать серые переключатели (выбрал тип)
            // есть кнопка Запросить код подтверждение
            $('#security-code-phoneOremail').modal({ show: true, username: username });

            // не отправляем реквест
            return;
        }

        _user2.default.getSecurityKey(username, checkpointType).then(function (result) {
            console.log('SecurityKey received:', result.status.state);
            if (result.status.state === 'ok') {
                var $modal = $('#security-code');

                // Spinner.stop($button, 'fa-key');
                $('.js_success-feedback', $modal).empty().text('\u041A\u043B\u044E\u0447 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0431\u044B\u043B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u0412\u0430\u043C \u043D\u0430 ' + sendTo);
            }
        });
    });

    // inside modal
    $('.js_confirm-security-code').on('click', function (e) {
        var btn = $(e.target);
        var username = btn.data('username');
        var $keyInput = btn.closest('.modal').find('.modal-dialog form input.js_confirm-key');
        var key = $keyInput.val().trim();
        var $modal = btn.closest('.modal');
        e.stopPropagation();

        if (key.length !== 6) {
            return;
        }
        _user2.default.confirmSecurityKey(key, username).then(function (result) {
            if (result.status.state !== 'ok') {
                return;
            }
            console.log('js_confirm:', result.status.state, 'close modal');
            $modal.modal('hide');
        }).catch(function (err) {
            console.log('err');
            $('.js_success-feedback', $modal).text('Запрос не отправлен').css('color', 'red');
            console.log(err);
        });
    });

    $('form input[minlength]').on('blur', function () {
        var len = $(this).val().trim().length;
        var minLen = Number($(this).attr('minlength'));
        // const message = minLen <= len ? '' : minLen + ' characters minimum';
        if (minLen !== len) {
            $(this).css('borderColor', 'red');
        } else {
            $(this).css('borderColor', '#ced4da');
        }
        // this.setCustomValidity(message)
    });

    function onHideModal(e) {
        var $modal = $(e.target);
        $modal.find('.first-step').removeClass('d-none');
        $modal.find('.second-step').addClass('d-none');
        $('.js_confirm-key').val('');
        $('.js_success-feedback', $modal).removeAttr('style').empty();
    }
    $('#security-code-phoneOremail').on('hide.bs.modal', onHideModal);
    $('#security-code').on('hide.bs.modal', onHideModal);

    // "PHONE_OR_EMAIL" modal
    $('.js_get-security-code-phoneOremail').on('click', function (e) {
        var $modal = $('#security-code-phoneOremail');
        var typeSelected = $(e.target).closest($modal).find('.js_btn-type-switcher input:checked');
        var checkpointTypeActive = typeSelected.val();
        var sendTo = checkpointTypeActive === 'PHONE' ? 'телефон' : 'email';
        var modalConfig = $modal.data()['bs.modal']._config;
        var username = modalConfig.username;
        _user2.default.getSecurityKey(username, checkpointTypeActive).then(function (result) {
            // при нажатии "Запросить код подтверждение" - отпарляется реквест "старт чекпоинт" появляеться инпут и кнопка других типах
            // get selected button

            // переключатель(серый) и кнопка "Запросить код подтверждение" исчезают
            console.log('SecurityKey received:', result.status.state);
            if (result.status.state === 'ok') {
                $('.first-step', $modal).addClass('d-none');
                $('.second-step', $modal).removeClass('d-none');
                $('.js_success-feedback', $modal).empty().text('\u041A\u043B\u044E\u0447 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0431\u044B\u043B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u0412\u0430\u043C \u043D\u0430 ' + sendTo);
            }
        });
    });
}

function fillList($list, dataArray) {
    var items = dataArray;
    var cList = $list;
    var defaultAvatarSrc = 'https://i.imgur.com/jNNT4LE.png';
    var insertItem = function insertItem(data, text, cssCls) {
        var liTpl = '' + (data ? '<li class="list-inline-item ' + cssCls + '"><span class="figure">' + data + '</span><span>' + text + '</span></li>' : '<li class="list-inline-item ' + cssCls + '"><span class="figure">-</span><span>' + text + '</span></li>');
        return liTpl;
    };
    var stats = function stats(info) {
        var tpl = '<div class="col">\n            <ul class="list-inline text-center counts-list">\n            ' + (info ? insertItem(info['media_count'], 'Публикации', 'media-count') + '\n                ' + insertItem(info['follower_count'], 'Подписчики', 'follower-count') + '\n                ' + insertItem(info['following_count'], 'Подписки', 'following-count') : insertItem(false, 'Публикации', 'media-count') + '\n                ' + insertItem(false, 'Подписчики', 'follower-count') + '\n                ' + insertItem(false, 'Подписки', 'following-count')) + '\n            </ul>\n        </div>';
        return tpl;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item) {
        var info = item.info;
        var checkpoint = item.checkpoint || item;

        if (!info) {
            $('<li class="media py-3">\n                <img class="ml-3 rounded" alt="default avatar" src="' + defaultAvatarSrc + '">\n                <div class="media-body d-flex">\n                    <div class="col user-info">\n                        ' + (item.username ? '<h4 class="mt-0 mb-1 name">' + item.username + '</h4>' : '') + '\n                    </div>\n                    <div class="col">                        \n                        ' + (checkpoint.status === 'TRIGGERED' ? '<button class="btn btn-outline-secondary js_pass-checkpoint-btn d-block mx-auto" \n                            data-checkpoint-type="' + checkpoint.type + '"\n                            data-username="' + (item.username || '') + '"\n                            data-toggle="modal" data-target="#security-code">\n                            <i class="fas fa-key"></i>\u041F\u0440\u043E\u0439\u0442\u0438 \u0447\u0435\u043A\u043F\u043E\u0438\u043D\u0442</button>' : '(todo)checkpoint status - ' + checkpoint.status) + '\n                    </div>\n                    ' + stats() + '\n                </div>\n            </li>').appendTo(cList);
        } else {
            $('<li class="media py-3">\n            ' + (info['profile_pic_url'] ? '<img class="ml-3 rounded" alt="User photo" src="' + info['profile_pic_url'] + '">' : '<img class="ml-3 rounded" alt="default avatar" src="' + defaultAvatarSrc + '">') + '\n            <div class="media-body d-flex">\n                <div class="col user-info">\n                    ' + (item.username ? '<p class="mt-0 mb-1 name">' + item.username + '</p>' : '') + '\n                    ' + (info.name ? '<h4 class="mt-0 mb-1">' + info.name + '</h4>' : '') + '\n                    ' + (info.name ? '' : 'commented' /* ${(info.email) ? `<p class="mt-0 mb-1">${info.email}</p>` : ''}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ${(info.phone) ? `<p class="mt-0 mb-1">${info.phone}</p>` : ''} */) + '\n                    \n                </div>\n                <div class="col">                        \n                    ' + (checkpoint.status === 'TRIGGERED' ? '<button class="btn btn-outline-secondary js_pass-checkpoint-btn d-block mx-auto" data-checkpoint-type="' + checkpoint.type + '" data-toggle="modal" data-target="#security-code">\n                    <i class="fas fa-key"></i>\u041F\u0440\u043E\u0439\u0442\u0438 \u0447\u0435\u043A\u043F\u043E\u0438\u043D\u0442</button>' : '') + '\n                </div>\n                ' + stats(info) + '\n            </div>\n        </li>').appendTo(cList);
        }
    });
}

/**
 * Init header
 */
function init() {
    var $msgList = $('.accounts-list');
    // check we are in profile page
    if (!$msgList.length) {
        return;
    }
    var token = _user2.default.getToken(); // upd to: User.getToken()
    var metadata = _user2.default.getMetadata(token);
    var resendRequest = function resendRequest() {
        return _user2.default.getMetadata(token);
    };
    var isSendReqOnce = false;
    var checkResponse = function checkResponse(result, isResendRequest) {
        if (!result.status.state === 'ok' || !result.data || !$msgList.length || isResendRequest) {
            // проверям один раз наличие result.data.accounts.info
            $msgList.empty();
            $('<li class="media">\n                <div class="media-body">\n                    <h3 class="mt-0 mb-3">\u041D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0410\u043A\u043A\u0430\u0443\u043D\u0442\u0430 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E</h3>\n                </div>\n            </li>').appendTo($msgList);
            setTimeout(function () {
                resendRequest().then(function (result) {
                    checkResponse(result, false);
                });
                console.log('Request resend');
            }, 3500);
            return;
        }
        // вывод результатов (data.accounts.info)
        $('.profile-user .spinner-box').addClass('d-none');
        fillList($msgList, result.data.accounts);
        addListHandler();
    };

    // check we are in profile page
    if (!$msgList.length) {
        return;
    }

    addOnLoadHandlers();

    // может инфо отсутсвовать - сделать еще раз запрос через 3 сек.

    metadata.then(function (result) {
        // проверям один раз наличие result.data.accounts.info
        var isResendRequest = false;
        if (result.data && result.data.accounts && !isSendReqOnce) {
            result.data.accounts.forEach(function (item) {
                if (!item.info) {
                    isResendRequest = true;
                    isSendReqOnce = true;
                    return;
                }
            });
        }
        checkResponse(result, isResendRequest);
    }).catch(function (err) {
        setTimeout(function () {
            _view2.default.showInfoMessage($('.error-msg'), err.status || '', 'Не получилось загрузить доступные Instagram аккаунты');
        }, 3000);
        $('.spinner-box').addClass('d-none');
    });
}

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.LoginForm = LoginForm;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// window.$ = $;

// import Validator from '../../common/js-services/form-validator';
function LoginForm(selectorCss) {
    var _this = this;

    var _formId = selectorCss._formId,
        _buttonSubmitId = selectorCss._buttonSubmitId,
        _showLoginBoxBtnId = selectorCss._showLoginBoxBtnId,
        _loginBox = selectorCss._loginBox;

    var user = _user2.default,
        // service
    $form = $(_formId),
        $email = $form.find('input[name="mail"]'),
        $textAreaDescription = $('#description');
    // const openedClass = 'd-block';
    // const closeClass = 'd-none';

    var userLoginHeader = function userLoginHeader(_formData) {
        var cbError = function cbError(result) {
            $(_loginBox).append('<p>result.status.message</p>');
        };

        return user.login(_formData, cbError).then(function (result) {
            if (result && result.data && result.data.token) {
                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                $('.nav-link.js_logOut').parent().show();
                // console.log('request succeeded with JSON response', result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login succsess');
            } else if (result.status) {
                console.log(result);
                _view2.default.showInfoMessage(_this.$textAreaDescription, '<p>status: ' + result.status.state + '</p><p> message: ' + result.status.message + '</p>');
            } else {
                console.log(result);
            }
        }).then(function (result) {
            if (result && result.status) {
                console.log(result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login error');
            }
        });
    };

    var submitForm = function submitForm(formDataObj) {
        var email = $email.val(),
            password = $form.find('input[name="pass"]').val(),
            _formData = formDataObj || { email: email, password: password };

        if (selectorCss.isLoginInstagram) {
            // todo: delete me
            // addInstagramAccount({username: $form.find('input[name="username"]').val(), password});
        } else {
            $email.val($email.val().toLocaleLowerCase());
            userLoginHeader(_formData).then(function () {
                _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGGED, 'login');
            });
        }
    };

    var logOut = function logOut() {
        _cookie2.default.remove(_consts.CONST.cookieStorage.token);
        _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGOUT);
    };

    var bindEvents = function bindEvents() {
        var $showLoginBoxBtnId = $(_showLoginBoxBtnId);
        var $loginBox = $(_loginBox);
        var openedClass = 'd-block';
        var closeClass = 'd-none';

        $showLoginBoxBtnId.on('click', function () {
            if (!selectorCss.isLoginInstagram) {
                $loginBox.css({ 'top': 0, 'right': 0 }).addClass('bg-light border mt-5 mx-auto position-absolute');
            }
            $loginBox.addClass(openedClass).removeClass(closeClass);
        });

        var $buttonSubmit = $(_buttonSubmitId),
            cssValidationClass = 'form-validation';

        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            var form = $form.get(0);
            // const validator = new Validator($form);
            // console.log(validator.validate());
            if (form.checkValidity() && _view2.default.isEmail($email.val())) {
                submitForm();
            } else {
                // Highlight errors
                if (form.reportValidity) {
                    form.reportValidity();
                }
                $form.addClass(cssValidationClass);
            }
        });

        $('.nav-link.js_logOut').on('click', function (e) {
            e.preventDefault();
            logOut();
            $(e.target).parent().hide();
            _view2.default.showInfoMessage($textAreaDescription, 'Logged out');
        });

        _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGOUT, function (msg) {
            $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(openedClass).removeClass(closeClass); // .show();
            $(_consts.CONST.uiSelectors.headerRegBtn).addClass(openedClass).removeClass(closeClass);
            $('.nav-link.js_logOut').addClass(closeClass).removeClass(openedClass); // .hide();
            var selectorLoginState = '.js_message_logged--text';
            $(selectorLoginState).text('Вы вышли из аккаунта');
        });

        $(document).on('click', function (event) {
            var isLoginBtnClick = $(event.target).closest('nav.navbar').find($loginBox).length;
            var isAddInstagramBtnClicked = $(event.target).attr('id') === _consts.CONST.uiSelectors.instagram.addAccountBtnId;

            if (!isLoginBtnClick && $loginBox.hasClass(openedClass) && !isAddInstagramBtnClicked) {
                $loginBox.addClass(closeClass).removeClass(openedClass);
            }
        });
    };

    function init() {
        bindEvents();
    }

    return {
        init: init
    };
} // https://www.npmjs.com/package/pubsub-js
/* eslint-disable sort-vars */
// import $ from 'jquery';

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var conversation = {
    'data': {
        'meta': {
            'pagination': {
                'prev_cursor': '...',
                'next_cursor': '...'
            },
            'messages': [{
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'photo', // photo, video, gif, like, link
                'value': 'http://www.zr.ru/d/story/ad/913581/0-0.jpg',
                'timestamp': '14:33'

            }, {
                'side': 'right',
                'type': 'text',
                'value': 'Йоу(right)',
                'timestamp': '14:32'
            }, {
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'text', // photo, video, gif, like, link
                'value': 'Заходи сюда: google.com',
                'timestamp': '14:34'
            }, {
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'link', // photo, video, gif, like, link
                'value': 'http://www.zr.ru/d/story/ad/913581/0-0.jpg',
                'timestamp': '14:33'
            }, {
                'side': 'right',
                'type': 'photo',
                'value': 'https://s.auto.drom.ru/i24224/pubs/4/63060/gen340_2880636.jpg',
                'timestamp': '19:38'
            }, {
                'side': 'right',
                'type': 'text',
                'value': 'demos -> fineuploader.com',
                'timestamp': '19:38'
            }, {
                'side': 'right',
                'type': 'link',
                'value': 'https://fineuploader.com/demos#gallery-view',
                'timestamp': '19:38'
            }]
        }
    }
};

var userList = {
    'data': {
        'settings': {
            'do_notification': true,
            'invoke_in_millis': 3000
        },
        'accounts': [{
            'username': 'the_rostyslav',
            'unread_conversations': 0,
            'pagination': {
                'prev_cursor': '...',
                'next_cursor': '...'
            },
            'conversations': [{
                'id': '1',
                'name': 'Тест1',
                'to': [{
                    'username': 'dianacober7',
                    'profile_pic_url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAyVBMVEX///+re1CSXkV4QDqAqr9kl7GibT1eMi1zobhke5BxMyzDsK+mdU6KUDJuLCOQWj+fbUvn4N+ndUXXxLWsiXukbjrbrJiETz9TjqpkNTB1PDmpeEuVYUOIW0BqJBpZLCvv5+G/nIHk6/BxRTalajOInqlzj52aXh+NnKt1OjPNurK8xMyaeHXNnYmee2C5iHONsMOgvs5fAACDQRnAp5ygdWL38/DbzcZ9QjDQw8GUbmqVZUa7lnivjHHMtKKbZ0LBkXw/hKSnZSAqI9PKAAADR0lEQVR4nO3d21YaMRhAYbWCtB0QEKqAFbS0atXagkc81vd/qF41+amZhgxJJq619+WsyeFzbuIoi5UVIiIiIiIiIiIiKrXbj3G7jS6cNT7ErDGLLjw9fhez41OECBEiRIgQYSxhSzcLJtwWaeFMrB1QOGmoggH72apqt6+JeulJQOFeKJYUNrVwrW+6Yw8hQoQIESJE+EaFfZ35TBNQ2JrsqcIBtWp1W2jNd+sNTXycUVuNYK4cocO4BkKECL2FMC+ECBEuDjD3ZoT9nqWNu6z5uuxuQ9/yRScG5pzaogt7G5aG4tcFUXNoG9hDiBAhQoQIEZYs1Iev3tCYk9A8Rc/2TiqkcE332dzQQTjMmUOsElso32rm5CS0zpYZn2JIoXnT4YRNhAgRIkSIEKF34dVIdX2zbcp+phGvz8w3Z+IO62yZcRc313qjV07CrXH1b23r4mXWVvscb7kJ03aZaiNEmHwIEaYfQoSvqnZVbZG+2nXaX9c2XTW2sCpOgSfvVUdiDhdiV4w70tOd6KtXNqJ34SiycIQQIUKECBEiROhfOLjfVz380Omr+wMH4UCME7M96Kv3tum8n7wHIvNlB2DeuJxF4giTCyHC9EOIMP0Q/isUb7zK3vp/E6/l3ISjLdXjk+GzEvMfnAi2f9PHNOZ6etQbHTkJJba+Zsn+J/2iNW1L1wuzRK2khV7+FwMhQoQIESJEuIgwC1UqwhJDiBBh+SFEiLD8ECJEWH4IESIsP4QIEZafH+G0riq6kU2dF5dq6uW7LvQ3Z9j/WJoDfD5TnXsAjsJ9mUdR4dkn1fnyT7Hum4UQIUKECBEinGta7PTlRaiXngYUftdduuzuXOc0TnQp1g4oFHXcnuKyJ+/NThxWYeHSIUSIECFChIkKbbkJbMUXXnRs7bpkne0iutDeYXXxDsvebKEQIkw/hAjTDyHC9HuTwt87pio1Y2M7TDU2TpwzcyWgcKdiqrZuzElonDhn5hpChAgRIkSIMB3hy3jxXsoUHvzSuexj/Zuxr+acZv6pWj/wIRTLOO0jxs07CBEiRIgQIUKECwpzXqUlUcWLUBy3zT/SmvkBxLi5hhAhQoQIESJEiBAhQoQIESJEiBBhKsI/XikgQrJf9G0AAAAASUVORK5CYII='
                }, {
                    'username': 'your_dieta',
                    'profile_pic_url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAw1BMVEX///+re1CRd15Em8XPqYYbhbiibT3brJiPd19ke5DMo32te0+eeVf17umpeEzIoHysmomJbVCndUXq5uPXxLXo18jg7PMxlMG/nIGmelPavaTSrIqXeFvv5+EmirujbDsAh7+pay6ig2yzhl2+k20AfLRFgKN+enXNoo16s9KNcl/NwrqHaUyee2BTboa4k328xMx1e4SfiXWwaRvInHG/sqeslH/MtqTjzbvh5ehJZ4BqcXzcwanUs5WvjHG7lnhYe5eai2xoAAAD/klEQVR4nO3cbVfTSBiAYQyli7SppUChUAwVWN9Qd1WQfUH5/79KP8g8T/c82emEmUl6vO+POcnMXC09DGl0Y4OIiIiIfrnKY9edOnwrhw/sC+/kjDLLSptW7vQe2lGHj93hnRqhum49hT2ECDsTQoQI2w/hOgkPzG57yiLdyeF/7QtF2Lu1z8guPN6x6qn8h0POOM4v7OUNIUKECBEiRJhNWEpK+CxdSliaxRZ+NrdZF6NUXahZzL3c59jEpe2jEj5J05LQLPofIggRIkSIECHCFoQnUjphaW/VcgifqA3cuUmMI6xx5RCqECJEiBAhQoTZhCdmF6OBK4JlYI52bm7gYgtPzs2Gc9fw8cSBHk4TpZN0QvPHcTDcLn62PY8gnMtw9gs2alFYRBEWCBEiRIgQ4doIZW813HbN7S3XCi5pLsMNzdEyCYfeQogD/3C5hTWv9EyObgcJ1XWzmp+O7ELz0zKTj2SgUK6bqXfW/IQjRIgQIUKEHRQWQ/mWb1Y8WljMZLhhkUxYnroO1IN0IhzdjF03R5IcHYfcRR2p69RoehI1t1rRgSw0DLtf9R+aqC9iZUl9/3hVgLDyv+Z99XpIE7fOaj9MOPEsqX+aWXja9wwxQYgQIUKECBGuv7DsiPCvv9+7fEOsIPxDhvvHt5HPJXz/9KH7GEI32tM/ESJEiBAhQoQtCO07UdPIQjfcfXbh6NuR1bd3Usj90pE52tHXgOFiC/UdPV3T7/EfP1x0YedCiLD7IUTY/RD+V1hNXE1/iadLrUiWGfj94em+60vDh/HSpR/z+yIL9d/frGlvt9nDeOlSj/nt7jVlLQmbPXyQLvVYA0KECFsKIUKE7ZdSOJOyu9Tc6YSF/lcRuYFq7iKdUFnzC61lIESIECFChAgTCwcB+f/HYO8Q2YV6A+fv1W++/GOYq0gpDMovbDgwQoQIESJEiDCW8GrX1XAdK+xpwlyuqxjCjT1XGUR8JX194SsIWMqSYgB1VyELUe9QEMDbVWwWQoQIESJEiHBZGLKBiyxUW7WEwrfSR++SPkgRhB/V3AmFqvHjFx3UOA8LIUKECBEiRLgsjHCTMaDd/MLrsdlLaR6Sus4e+Dq70G56eeZaVKu3kMsup20j/rfp5dZDZ4v+6i3O3HUIWw4hQoTthxDhegk/LVyVyarkhE9dET4/tNq6lLYk2YidvbGI1Rt1hrpOj2bO9zyh8HDT6nDLU63Qd2HNfAgRIkSIECHCTgqLhVXREeH0tWRO+GNKq0210t/t1Bk1Y9ipFcXYxE7r5vHle4OWajjHIUKECBEiRIgQYWKhujFXw1K3z9ZSqLEmsCkLIUKECBEiRIgQIUKECBEiRIgQIcIuCr8DS8wc0PgR4R4AAAAASUVORK5CYII='
                }],
                'last_message': 'йоу',
                'is_unread': false
            }, {
                'id': '2',
                'name': 'Sergant',
                'to': [{
                    'username': 'dianacober7',
                    'profile_pic_url': 'data:image/png;base64,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'
                }],
                'param_value': 'dianacober7',
                'last_message': 'hallo static sergant',
                'is_unread': false
            }]
        }, {
            'username': 'the_rostyslav2',
            'unread_conversations': 0,
            'pagination': {
                'prev_cursor': '...',
                'next_cursor': '...'
            },
            'conversations': [{
                'id': '1',
                'name': 'Тест22',
                'to': [{
                    'username': 'dianacober7',
                    'profile_pic_url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAyVBMVEX///+re1CSXkV4QDqAqr9kl7GibT1eMi1zobhke5BxMyzDsK+mdU6KUDJuLCOQWj+fbUvn4N+ndUXXxLWsiXukbjrbrJiETz9TjqpkNTB1PDmpeEuVYUOIW0BqJBpZLCvv5+G/nIHk6/BxRTalajOInqlzj52aXh+NnKt1OjPNurK8xMyaeHXNnYmee2C5iHONsMOgvs5fAACDQRnAp5ygdWL38/DbzcZ9QjDQw8GUbmqVZUa7lnivjHHMtKKbZ0LBkXw/hKSnZSAqI9PKAAADR0lEQVR4nO3d21YaMRhAYbWCtB0QEKqAFbS0atXagkc81vd/qF41+amZhgxJJq619+WsyeFzbuIoi5UVIiIiIiIiIiIiKrXbj3G7jS6cNT7ErDGLLjw9fhez41OECBEiRIgQYSxhSzcLJtwWaeFMrB1QOGmoggH72apqt6+JeulJQOFeKJYUNrVwrW+6Yw8hQoQIESJE+EaFfZ35TBNQ2JrsqcIBtWp1W2jNd+sNTXycUVuNYK4cocO4BkKECL2FMC+ECBEuDjD3ZoT9nqWNu6z5uuxuQ9/yRScG5pzaogt7G5aG4tcFUXNoG9hDiBAhQoQIEZYs1Iev3tCYk9A8Rc/2TiqkcE332dzQQTjMmUOsElso32rm5CS0zpYZn2JIoXnT4YRNhAgRIkSIEKF34dVIdX2zbcp+phGvz8w3Z+IO62yZcRc313qjV07CrXH1b23r4mXWVvscb7kJ03aZaiNEmHwIEaYfQoSvqnZVbZG+2nXaX9c2XTW2sCpOgSfvVUdiDhdiV4w70tOd6KtXNqJ34SiycIQQIUKECBEiROhfOLjfVz380Omr+wMH4UCME7M96Kv3tum8n7wHIvNlB2DeuJxF4giTCyHC9EOIMP0Q/isUb7zK3vp/E6/l3ISjLdXjk+GzEvMfnAi2f9PHNOZ6etQbHTkJJba+Zsn+J/2iNW1L1wuzRK2khV7+FwMhQoQIESJEuIgwC1UqwhJDiBBh+SFEiLD8ECJEWH4IESIsP4QIEZafH+G0riq6kU2dF5dq6uW7LvQ3Z9j/WJoDfD5TnXsAjsJ9mUdR4dkn1fnyT7Hum4UQIUKECBEinGta7PTlRaiXngYUftdduuzuXOc0TnQp1g4oFHXcnuKyJ+/NThxWYeHSIUSIECFChIkKbbkJbMUXXnRs7bpkne0iutDeYXXxDsvebKEQIkw/hAjTDyHC9HuTwt87pio1Y2M7TDU2TpwzcyWgcKdiqrZuzElonDhn5hpChAgRIkSIMB3hy3jxXsoUHvzSuexj/Zuxr+acZv6pWj/wIRTLOO0jxs07CBEiRIgQIUKECwpzXqUlUcWLUBy3zT/SmvkBxLi5hhAhQoQIESJEiBAhQoQIESJEiBBhKsI/XikgQrJf9G0AAAAASUVORK5CYII='
                }],
                'last_message': 'hallo static',
                'is_unread': false
            }]
        }]
    }

};

exports.userList = userList;
exports.conversation = conversation;

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;

var _dataServer = __webpack_require__(12);

var data = _interopRequireWildcard(_dataServer);

var _meteorEmoji = __webpack_require__(21);

var _meteorEmoji2 = _interopRequireDefault(_meteorEmoji);

var _fineUploader = __webpack_require__(20);

var _fineUploader2 = _interopRequireDefault(_fineUploader);

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _apiUserDirect = __webpack_require__(15);

var _apiUserDirect2 = _interopRequireDefault(_apiUserDirect);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function isInMessagePage() {
    var $msgList = $('.messages-list');
    var $userList = $('.messages-user-list');
    return !!$msgList.length && !!$userList.length;
}
$(document).ready(function () {
    if (!isInMessagePage()) {
        return;
    }
    // eslint-disable-next-line no-unused-vars
    var m = new _meteorEmoji2.default();
    var $picker = $('textarea[data-meteor-emoji="true"] ~ div');
    var style = $picker.attr('style');
    var styleNew = style.replace('top: 30px;', 'top: -210px;');
    $picker.attr('style', styleNew);

    // eslint-disable-next-line no-unused-vars
    var restrictedUploader = new _fineUploader2.default.FineUploader({
        element: document.getElementById('fine-uploader-validation'),
        template: 'qq-template-validation',
        request: {
            endpoint: '/server/uploads'
        },
        thumbnails: {
            placeholders: {
                waitingPath: 'https://fineuploader.com/source/placeholders/waiting-generic.png', // '/source/placeholders/waiting-generic.png',
                notAvailablePath: 'https://fineuploader.com/server/waiting-generic.png' // '/source/placeholders/not_available-generic.png'
            }
        },
        validation: {
            allowedExtensions: ['jpeg', 'jpg', 'txt'],
            itemLimit: 3,
            sizeLimit: 500 * 1024
        }
    });
});

function fillList($list, dataArray) {
    var items = dataArray;
    var cList = $list;
    // const defaultAvatarSrc = 'https://i.imgur.com/jNNT4LE.png';
    var insertMsg = function insertMsg(value, type, cssCls) {
        var str = '';
        switch (type) {
            case 'photo':
                str = '<div class="chat-img">\n                    <img src="' + value + '" alt="Content Image" class="content-image">\n                </div>';
                break;
            case 'link':
                str = '<div class="chat-img">\n                <a target="_blank" href="' + value + '">' + value + '</a>';
                break;
            default:
                str = '<div class="chat-text" >' + value + '</div>';
        }
        return str;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item) {
        var message = item;
        // const checkpoint = item.checkpoint || item;

        if (message.side === 'left') {
            $('<li class="chat-item chat-item-left" value="' + message.value + '">\n                <div class="d-flex">\n                ' + (message['profile_pic_url'] ? '<div class="chat-img-box"> \n                         <img src="' + message['profile_pic_url'] + '" alt="User Avatar" class="">\n                        </div>' : '') + '\n                <div>\n                    <p class="chat-username text-muted">' + message.username + '</p>\n                    ' + insertMsg(message.value, message.type) + '\n                </div>\n                    <small class="chat-time-text">' + message.timestamp + '</small>\n                </div>\n            </li>').appendTo(cList);
        } else {
            $('<li class="chat-item justify-content-end chat-item-right" value="' + message.value + '">\n                <div class="d-flex">\n                    ' + insertMsg(message.value, message.type) + '\n                    <small class="pull-right chat-time-text">' + message.timestamp + '</small>\n                    </div>\n            </li>').appendTo(cList);
        }
    });
}
function fillUserList($list, dataArray) {
    var items = dataArray.meta;
    var cList = $list;
    var conversationDetail = function conversationDetail(items) {
        var tpl = '';
        items.forEach(function (item) {
            tpl += '<img src="' + item['profile_pic_url'] + '" class="media-photo" style="width: 24px;">\n                <div class="media-body">\n                <h5 class="title">\n                    ' + item.username + '\n                </h5>';
        });
        return tpl;
    };
    var addConversations = function addConversations(conversations, idx) {
        var tpl = '';
        conversations.forEach(function (item) {
            tpl += '<div id="collapse-' + idx + '" class="collapse" aria-labelledby="heading-' + idx + '" data-parent="#accordion">\n                <div class="media">\n                        ' + conversationDetail(item.to) + '\n                        <p class="summary">' + item['last_message'] + '</p>\n                    </div>\n                </div>\n            </div>';
        });
        return tpl;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item, idx) {
        $('<li class="list-group-item" data-toggle="collapse" data-target="#collapse-' + idx + '" aria-expanded="true" aria-controls="collapse-' + idx + '">\n            <div class="media" id="heading-' + idx + '">\n                <a href="#" class="mr-3">\n                    <img src="https://i.imgur.com/jNNT4LE.png"\n                    class="media-photo">\n                </a>\n                <span class="badge badge-secondary position-absolute p-2">' + item['unread_conversations'] + '</span>\n                <div class="media-body">\n                    <h4 class="title">\n                        ' + item.username + '\n                    </h4>\n                </div>\n            </div>\n            ' + addConversations(item.conversations, idx) + '\n            </li>').appendTo(cList);
    });
}

function addHandlers() {
    // let checkpointType = '';

    $('#sendMessageButton').on('click', function (e) {
        // const $button = $(e.target);
        var userMsg = $('#sendMessageTextArea').val();
        console.log(userMsg);
        // eslint-disable-next-line no-alert
        alert(userMsg);
        // console.log($button);
    });
    $(document).on('click', '.list-group-item', function (e) {
        // e.preventDefault();
        console.log('click');
        var $msgList = $('.messages-list');
        var conversation = data.conversation;
        // User.getMetadata(token);

        fillList($msgList, conversation.data.meta.messages);
    });
}

function init() {
    var userList = data.userList;
    // const $msgList = $('.messages-list');

    var $userList = $('.messages-user-list');
    // check we are in correct page (messages)
    if (!isInMessagePage()) {
        return;
    }
    var token = _user2.default.getToken(); // upd to: User.getToken()
    var metadata = _apiUserDirect2.default.getMetadata(token);
    metadata.then(function (result) {
        fillUserList($userList, result.data || userList.data);
    }).then(function (result) {
        console.log('add onClick');
        _apiUserDirect2.default.getMetadata(token);
        // fillList($msgList, result.data.meta.messages || conversation.data.meta.messages);
        // addHandlers();
    });
    addHandlers();
}

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';
// https://www.npmjs.com/package/pubsub-js


var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

var _consts = __webpack_require__(0);

var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var selectorCls = {
    form: '.auth.register .form-signin',
    submitBtn: '[type="submit"]'
};

var RegisterForm = function () {
    function RegisterForm() {
        _classCallCheck(this, RegisterForm);

        this.user = _user2.default;
        this.$form = $(selectorCls.form);
        this.$email = this.$form.find('input[name="mail"]');
        this.$textAreaDescription = $('#description');
        this.formData = { 'email': 'test1_email@m.ru', 'password': 'password' };
    }

    _createClass(RegisterForm, [{
        key: 'init',
        value: function init() {
            if ($('.auth.register').length) {
                this.bindEvents();
            }
        }
    }, {
        key: 'submitForm',
        value: function submitForm(formDataObj) {
            var _this = this;

            var email = this.$email.val();
            var $password = this.$form.find('input[name="pass"]'),
                $passwordConfirm = this.$form.find('input[name="pass-confirm"]'),
                password = this.$form.find('input[name="pass"]').val(),
                passwordConfirm = this.$form.find('input[name="pass-confirm"]').val();

            if (passwordConfirm !== password) {
                $password.addClass('input-error');
                $passwordConfirm.addClass('input-error');
                return;
            }
            this.$email.val(this.$email.val().toLocaleLowerCase());
            this.formData = formDataObj || { email: email, password: password };

            this.user.register(this.formData).then(function (result) {
                if (result.data && result.data.token) {

                    // save the item
                    _cookie2.default.set(_consts.CONST.cookieStorage.emailConfirmed, 'false');

                    _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                    // console.log('request succeeded with JSON response', result);
                    _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGGED);
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state, result.status.message || 'Register and Login succsess');
                } else {
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state, result.status.message || 'no result.data found');
                }
            }).then(function (result) {
                if (result && result.status) {
                    console.log(result);
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state);
                    $('.login-box').show();
                }
            }).catch(function (error) {
                console.log('request failed', error);
                _view2.default.showInfoMessage(_this.$textAreaDescription, error.message);
                console.log('do something');
            });
        }
    }, {
        key: 'bindEvents',
        value: function bindEvents() {
            var _this2 = this;

            var registerBox = _consts.CONST.uiSelectors.headerRegBox; // 'nav .register-box';
            var openedClass = 'd-block';
            var closeClass = 'd-none';
            var $btn = $(selectorCls.submitBtn),
                cssValidationClass = 'form-validation';

            $btn.on('click', function (e) {
                var form = _this2.$form.get(0);
                e.preventDefault();

                if (!$btn.is(':disabled')) {
                    if (form.checkValidity()) {
                        // $btn.attr('disabled', true);
                        _this2.submitForm();
                    } else {
                        // Highlight errors
                        if (form.reportValidity) {
                            form.reportValidity();
                        }
                        _this2.$form.addClass(cssValidationClass);
                    }
                }
            });

            $(document).on('click', function (event) {
                var isRegBtnClick = $(event.target).closest('nav.navbar').find('.register-box').length;

                if (!isRegBtnClick && $(registerBox).hasClass(openedClass)) {
                    $(registerBox).addClass(closeClass).removeClass(openedClass);
                }
            });
        }
    }]);

    return RegisterForm;
}();

exports.default = RegisterForm;

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';


var _consts = __webpack_require__(0);

var _network = __webpack_require__(5);

var _network2 = _interopRequireDefault(_network);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var UserConversation = function () {
    function UserConversation() {
        _classCallCheck(this, UserConversation);

        this.network = new _network2.default();
        this.cookieStorage = _cookie2.default;
        this.settingPost = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        };
    }

    _createClass(UserConversation, [{
        key: 'isLoggedIn',
        value: function isLoggedIn() {
            return !!this.getToken();
        }
    }, {
        key: 'isEmailConfirmed',
        value: function isEmailConfirmed() {
            return this.cookieStorage.get(_consts.CONST.cookieStorage.emailConfirmed) === 'confirmed';
        }
    }, {
        key: 'getToken',
        value: function getToken() {
            var cookieToken = this.cookieStorage.get(_consts.CONST.cookieStorage.token);
            return cookieToken;
        }
    }, {
        key: 'getMetadata',
        value: function getMetadata(token, cbError) {
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramDirect_getMetaData'), { headers: { token: token } }, cbError);
        }
    }, {
        key: 'getSecurityKey',
        value: function getSecurityKey(username, checkpointType) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify({ 'type': checkpointType }), // todo: tmp set, it should be 'type'
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            });
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_checkpoint') + username, setting);
        }
    }, {
        key: 'confirmSecurityKey',
        value: function confirmSecurityKey(key, username) {
            var setting = {
                method: 'DELETE',
                body: JSON.stringify({ 'security_code': key }),
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            };
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_confirmKey') + username, setting);
        }
    }]);

    return UserConversation;
}();

var userInstance = null;

if (!userInstance) {
    userInstance = new UserConversation();
}

exports.default = userInstance;

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.LoginPage = LoginPage;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _cookie = __webpack_require__(2);

var _cookie2 = _interopRequireDefault(_cookie);

var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// window.$ = $;

// import Validator from '../../common/js-services/form-validator';
function LoginPage(selectorCss) {
    var _this = this;

    var _formId = selectorCss._formId,
        _buttonSubmitId = selectorCss._buttonSubmitId,
        _loginBox = selectorCss._loginBox;

    var user = _user2.default,
        // service
    $form = $(_formId),
        $email = $form.find('input[name="mail"]'),
        $textAreaDescription = $('#description');
    // const openedClass = 'd-block';
    // const closeClass = 'd-none';

    var userLoginHeader = function userLoginHeader(_formData) {
        var cbError = function cbError(result) {
            $(_loginBox).append('<p>result.status.message</p>');
        };

        return user.login(_formData, cbError).then(function (result) {
            if (result && result.data && result.data.token) {
                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                $('.nav-link.js_logOut').parent().show();
                // console.log('request succeeded with JSON response', result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login succsess');
            } else if (result.status) {
                console.log(result);
                _view2.default.showInfoMessage(_this.$textAreaDescription, '<p>status: ' + result.status.state + '</p><p> message: ' + result.status.message + '</p>');
            } else {
                console.log(result);
            }
        }).then(function (result) {
            if (result && result.status) {
                console.log(result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login error');
            }
        });
    };

    var submitForm = function submitForm(formDataObj) {
        var email = $email.val(),
            password = $form.find('input[name="pass"]').val(),
            _formData = formDataObj || { email: email, password: password };

        if (selectorCss.isLoginInstagram) {
            // todo: delete me
            // addInstagramAccount({username: $form.find('input[name="username"]').val(), password});
        } else {
            $email.val($email.val().toLocaleLowerCase());
            userLoginHeader(_formData).then(function () {
                // PubSub.publish(CONST.events.USER_LOGGED, 'login');
                window.location.href = '/instagram-integration/instagram-accounts.html';
            });
        }
    };

    var logOut = function logOut() {
        _cookie2.default.remove(_consts.CONST.cookieStorage.token);
        _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGOUT);
    };

    var bindEvents = function bindEvents() {
        // const $showLoginBoxBtnId = $(_showLoginBoxBtnId);
        var $loginBox = $(_loginBox);
        var openedClass = 'd-block';
        var closeClass = 'd-none';

        // $showLoginBoxBtnId.on('click', () => {
        //     if (!selectorCss.isLoginInstagram) {
        //         $loginBox.css({'top': 0, 'right': 0})
        //             .addClass('bg-light border mt-5 mx-auto position-absolute');
        //     }
        //     $loginBox.addClass(openedClass).removeClass(closeClass);
        // });

        var $buttonSubmit = $(_buttonSubmitId),
            cssValidationClass = 'form-validation';

        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            var form = $form.get(0);
            // const validator = new Validator($form);
            console.log(_view2.default, _view2.default.isEmail($email.val()));

            if (form.checkValidity() && _view2.default.isEmail($email.val())) {
                submitForm();
            } else {
                // Highlight errors
                if (form.reportValidity) {
                    form.reportValidity();
                }
                $form.addClass(cssValidationClass);
            }
        });

        $('.nav-link.js_logOut').on('click', function (e) {
            e.preventDefault();
            logOut();
            $(e.target).parent().hide();
            _view2.default.showInfoMessage($textAreaDescription, 'Logged out');
        });

        _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGOUT, function (msg) {
            $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(openedClass).removeClass(closeClass); // .show();
            $(_consts.CONST.uiSelectors.headerRegBtn).addClass(openedClass).removeClass(closeClass);
            $('.nav-link.js_logOut').addClass(closeClass).removeClass(openedClass); // .hide();
            var selectorLoginState = '.js_message_logged--text';
            $(selectorLoginState).text('Вы вышли из аккаунта');
        });

        $(document).on('click', function (event) {
            var isLoginBtnClick = $(event.target).closest('nav.navbar').find($loginBox).length;
            var isAddInstagramBtnClicked = $(event.target).attr('id') === _consts.CONST.uiSelectors.instagram.addAccountBtnId;

            if (!isLoginBtnClick && $loginBox.hasClass(openedClass) && !isAddInstagramBtnClicked) {
                $loginBox.addClass(closeClass).removeClass(openedClass);
            }
        });
    };

    function init() {
        if ($('.auth.login').length) {
            bindEvents();
        }
    }

    return {
        init: init
    };
} // https://www.npmjs.com/package/pubsub-js
/* eslint-disable sort-vars */
// import $ from 'jquery';

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Instagram = Instagram;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _view = __webpack_require__(3);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import {CONST} from '../../common/js-services/consts';

/* eslint-disable sort-vars */
// import $ from 'jquery';
function Instagram() {
    var selectorCSS = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var $buttonSubmit = $('#js_instagram-get-accounts--btn');
    var user = _user2.default,
        // service
    $list = $('.instagram-accounts-list');

    var submitForm = function submitForm(formDataObj) {
        if ($buttonSubmit.length) {
            user.getInstagramAccount().then(function (result) {
                if (result && result.status) {
                    console.log(result);
                    _view2.default.fillList($list, result.data.accounts || 'Login error');
                }
            });

            console.log('getInstagramAccount ', $buttonSubmit);
            return;
        }
    };

    var bindEvents = function bindEvents() {
        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            submitForm();
        });
    };

    function init() {
        bindEvents();
    }

    return {
        init: init
    };
}
// import cookieStorage from '../../common/js-services/cookie';

/***/ }),
/* 18 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;// Fine Uploader 5.16.2 - MIT licensed. http://fineuploader.com
(function(global) {
    var qq = function(element) {
        "use strict";
        return {
            hide: function() {
                element.style.display = "none";
                return this;
            },
            attach: function(type, fn) {
                if (element.addEventListener) {
                    element.addEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.attachEvent("on" + type, fn);
                }
                return function() {
                    qq(element).detach(type, fn);
                };
            },
            detach: function(type, fn) {
                if (element.removeEventListener) {
                    element.removeEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.detachEvent("on" + type, fn);
                }
                return this;
            },
            contains: function(descendant) {
                if (!descendant) {
                    return false;
                }
                if (element === descendant) {
                    return true;
                }
                if (element.contains) {
                    return element.contains(descendant);
                } else {
                    return !!(descendant.compareDocumentPosition(element) & 8);
                }
            },
            insertBefore: function(elementB) {
                elementB.parentNode.insertBefore(element, elementB);
                return this;
            },
            remove: function() {
                element.parentNode.removeChild(element);
                return this;
            },
            css: function(styles) {
                if (element.style == null) {
                    throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");
                }
                if (styles.opacity != null) {
                    if (typeof element.style.opacity !== "string" && typeof element.filters !== "undefined") {
                        styles.filter = "alpha(opacity=" + Math.round(100 * styles.opacity) + ")";
                    }
                }
                qq.extend(element.style, styles);
                return this;
            },
            hasClass: function(name, considerParent) {
                var re = new RegExp("(^| )" + name + "( |$)");
                return re.test(element.className) || !!(considerParent && re.test(element.parentNode.className));
            },
            addClass: function(name) {
                if (!qq(element).hasClass(name)) {
                    element.className += " " + name;
                }
                return this;
            },
            removeClass: function(name) {
                var re = new RegExp("(^| )" + name + "( |$)");
                element.className = element.className.replace(re, " ").replace(/^\s+|\s+$/g, "");
                return this;
            },
            getByClass: function(className, first) {
                var candidates, result = [];
                if (first && element.querySelector) {
                    return element.querySelector("." + className);
                } else if (element.querySelectorAll) {
                    return element.querySelectorAll("." + className);
                }
                candidates = element.getElementsByTagName("*");
                qq.each(candidates, function(idx, val) {
                    if (qq(val).hasClass(className)) {
                        result.push(val);
                    }
                });
                return first ? result[0] : result;
            },
            getFirstByClass: function(className) {
                return qq(element).getByClass(className, true);
            },
            children: function() {
                var children = [], child = element.firstChild;
                while (child) {
                    if (child.nodeType === 1) {
                        children.push(child);
                    }
                    child = child.nextSibling;
                }
                return children;
            },
            setText: function(text) {
                element.innerText = text;
                element.textContent = text;
                return this;
            },
            clearText: function() {
                return qq(element).setText("");
            },
            hasAttribute: function(attrName) {
                var attrVal;
                if (element.hasAttribute) {
                    if (!element.hasAttribute(attrName)) {
                        return false;
                    }
                    return /^false$/i.exec(element.getAttribute(attrName)) == null;
                } else {
                    attrVal = element[attrName];
                    if (attrVal === undefined) {
                        return false;
                    }
                    return /^false$/i.exec(attrVal) == null;
                }
            }
        };
    };
    (function() {
        "use strict";
        qq.canvasToBlob = function(canvas, mime, quality) {
            return qq.dataUriToBlob(canvas.toDataURL(mime, quality));
        };
        qq.dataUriToBlob = function(dataUri) {
            var arrayBuffer, byteString, createBlob = function(data, mime) {
                var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
                if (blobBuilder) {
                    blobBuilder.append(data);
                    return blobBuilder.getBlob(mime);
                } else {
                    return new Blob([ data ], {
                        type: mime
                    });
                }
            }, intArray, mimeString;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return createBlob(arrayBuffer, mimeString);
        };
        qq.log = function(message, level) {
            if (window.console) {
                if (!level || level === "info") {
                    window.console.log(message);
                } else {
                    if (window.console[level]) {
                        window.console[level](message);
                    } else {
                        window.console.log("<" + level + "> " + message);
                    }
                }
            }
        };
        qq.isObject = function(variable) {
            return variable && !variable.nodeType && Object.prototype.toString.call(variable) === "[object Object]";
        };
        qq.isFunction = function(variable) {
            return typeof variable === "function";
        };
        qq.isArray = function(value) {
            return Object.prototype.toString.call(value) === "[object Array]" || value && window.ArrayBuffer && value.buffer && value.buffer.constructor === ArrayBuffer;
        };
        qq.isItemList = function(maybeItemList) {
            return Object.prototype.toString.call(maybeItemList) === "[object DataTransferItemList]";
        };
        qq.isNodeList = function(maybeNodeList) {
            return Object.prototype.toString.call(maybeNodeList) === "[object NodeList]" || maybeNodeList.item && maybeNodeList.namedItem;
        };
        qq.isString = function(maybeString) {
            return Object.prototype.toString.call(maybeString) === "[object String]";
        };
        qq.trimStr = function(string) {
            if (String.prototype.trim) {
                return string.trim();
            }
            return string.replace(/^\s+|\s+$/g, "");
        };
        qq.format = function(str) {
            var args = Array.prototype.slice.call(arguments, 1), newStr = str, nextIdxToReplace = newStr.indexOf("{}");
            qq.each(args, function(idx, val) {
                var strBefore = newStr.substring(0, nextIdxToReplace), strAfter = newStr.substring(nextIdxToReplace + 2);
                newStr = strBefore + val + strAfter;
                nextIdxToReplace = newStr.indexOf("{}", nextIdxToReplace + val.length);
                if (nextIdxToReplace < 0) {
                    return false;
                }
            });
            return newStr;
        };
        qq.isFile = function(maybeFile) {
            return window.File && Object.prototype.toString.call(maybeFile) === "[object File]";
        };
        qq.isFileList = function(maybeFileList) {
            return window.FileList && Object.prototype.toString.call(maybeFileList) === "[object FileList]";
        };
        qq.isFileOrInput = function(maybeFileOrInput) {
            return qq.isFile(maybeFileOrInput) || qq.isInput(maybeFileOrInput);
        };
        qq.isInput = function(maybeInput, notFile) {
            var evaluateType = function(type) {
                var normalizedType = type.toLowerCase();
                if (notFile) {
                    return normalizedType !== "file";
                }
                return normalizedType === "file";
            };
            if (window.HTMLInputElement) {
                if (Object.prototype.toString.call(maybeInput) === "[object HTMLInputElement]") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            if (maybeInput.tagName) {
                if (maybeInput.tagName.toLowerCase() === "input") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            return false;
        };
        qq.isBlob = function(maybeBlob) {
            if (window.Blob && Object.prototype.toString.call(maybeBlob) === "[object Blob]") {
                return true;
            }
        };
        qq.isXhrUploadSupported = function() {
            var input = document.createElement("input");
            input.type = "file";
            return input.multiple !== undefined && typeof File !== "undefined" && typeof FormData !== "undefined" && typeof qq.createXhrInstance().upload !== "undefined";
        };
        qq.createXhrInstance = function() {
            if (window.XMLHttpRequest) {
                return new XMLHttpRequest();
            }
            try {
                return new ActiveXObject("MSXML2.XMLHTTP.3.0");
            } catch (error) {
                qq.log("Neither XHR or ActiveX are supported!", "error");
                return null;
            }
        };
        qq.isFolderDropSupported = function(dataTransfer) {
            return dataTransfer.items && dataTransfer.items.length > 0 && dataTransfer.items[0].webkitGetAsEntry;
        };
        qq.isFileChunkingSupported = function() {
            return !qq.androidStock() && qq.isXhrUploadSupported() && (File.prototype.slice !== undefined || File.prototype.webkitSlice !== undefined || File.prototype.mozSlice !== undefined);
        };
        qq.sliceBlob = function(fileOrBlob, start, end) {
            var slicer = fileOrBlob.slice || fileOrBlob.mozSlice || fileOrBlob.webkitSlice;
            return slicer.call(fileOrBlob, start, end);
        };
        qq.arrayBufferToHex = function(buffer) {
            var bytesAsHex = "", bytes = new Uint8Array(buffer);
            qq.each(bytes, function(idx, byt) {
                var byteAsHexStr = byt.toString(16);
                if (byteAsHexStr.length < 2) {
                    byteAsHexStr = "0" + byteAsHexStr;
                }
                bytesAsHex += byteAsHexStr;
            });
            return bytesAsHex;
        };
        qq.readBlobToHex = function(blob, startOffset, length) {
            var initialBlob = qq.sliceBlob(blob, startOffset, startOffset + length), fileReader = new FileReader(), promise = new qq.Promise();
            fileReader.onload = function() {
                promise.success(qq.arrayBufferToHex(fileReader.result));
            };
            fileReader.onerror = promise.failure;
            fileReader.readAsArrayBuffer(initialBlob);
            return promise;
        };
        qq.extend = function(first, second, extendNested) {
            qq.each(second, function(prop, val) {
                if (extendNested && qq.isObject(val)) {
                    if (first[prop] === undefined) {
                        first[prop] = {};
                    }
                    qq.extend(first[prop], val, true);
                } else {
                    first[prop] = val;
                }
            });
            return first;
        };
        qq.override = function(target, sourceFn) {
            var super_ = {}, source = sourceFn(super_);
            qq.each(source, function(srcPropName, srcPropVal) {
                if (target[srcPropName] !== undefined) {
                    super_[srcPropName] = target[srcPropName];
                }
                target[srcPropName] = srcPropVal;
            });
            return target;
        };
        qq.indexOf = function(arr, elt, from) {
            if (arr.indexOf) {
                return arr.indexOf(elt, from);
            }
            from = from || 0;
            var len = arr.length;
            if (from < 0) {
                from += len;
            }
            for (;from < len; from += 1) {
                if (arr.hasOwnProperty(from) && arr[from] === elt) {
                    return from;
                }
            }
            return -1;
        };
        qq.getUniqueId = function() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == "x" ? r : r & 3 | 8;
                return v.toString(16);
            });
        };
        qq.ie = function() {
            return navigator.userAgent.indexOf("MSIE") !== -1 || navigator.userAgent.indexOf("Trident") !== -1;
        };
        qq.ie7 = function() {
            return navigator.userAgent.indexOf("MSIE 7") !== -1;
        };
        qq.ie8 = function() {
            return navigator.userAgent.indexOf("MSIE 8") !== -1;
        };
        qq.ie10 = function() {
            return navigator.userAgent.indexOf("MSIE 10") !== -1;
        };
        qq.ie11 = function() {
            return qq.ie() && navigator.userAgent.indexOf("rv:11") !== -1;
        };
        qq.edge = function() {
            return navigator.userAgent.indexOf("Edge") >= 0;
        };
        qq.safari = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Apple") !== -1;
        };
        qq.chrome = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Google") !== -1;
        };
        qq.opera = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Opera") !== -1;
        };
        qq.firefox = function() {
            return !qq.edge() && !qq.ie11() && navigator.userAgent.indexOf("Mozilla") !== -1 && navigator.vendor !== undefined && navigator.vendor === "";
        };
        qq.windows = function() {
            return navigator.platform === "Win32";
        };
        qq.android = function() {
            return navigator.userAgent.toLowerCase().indexOf("android") !== -1;
        };
        qq.androidStock = function() {
            return qq.android() && navigator.userAgent.toLowerCase().indexOf("chrome") < 0;
        };
        qq.ios6 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 6_") !== -1;
        };
        qq.ios7 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 7_") !== -1;
        };
        qq.ios8 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_") !== -1;
        };
        qq.ios800 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_0 ") !== -1;
        };
        qq.ios = function() {
            return navigator.userAgent.indexOf("iPad") !== -1 || navigator.userAgent.indexOf("iPod") !== -1 || navigator.userAgent.indexOf("iPhone") !== -1;
        };
        qq.iosChrome = function() {
            return qq.ios() && navigator.userAgent.indexOf("CriOS") !== -1;
        };
        qq.iosSafari = function() {
            return qq.ios() && !qq.iosChrome() && navigator.userAgent.indexOf("Safari") !== -1;
        };
        qq.iosSafariWebView = function() {
            return qq.ios() && !qq.iosChrome() && !qq.iosSafari();
        };
        qq.preventDefault = function(e) {
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
        };
        qq.toElement = function() {
            var div = document.createElement("div");
            return function(html) {
                div.innerHTML = html;
                var element = div.firstChild;
                div.removeChild(element);
                return element;
            };
        }();
        qq.each = function(iterableItem, callback) {
            var keyOrIndex, retVal;
            if (iterableItem) {
                if (window.Storage && iterableItem.constructor === window.Storage) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(iterableItem.key(keyOrIndex), iterableItem.getItem(iterableItem.key(keyOrIndex)));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isArray(iterableItem) || qq.isItemList(iterableItem) || qq.isNodeList(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isString(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem.charAt(keyOrIndex));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else {
                    for (keyOrIndex in iterableItem) {
                        if (Object.prototype.hasOwnProperty.call(iterableItem, keyOrIndex)) {
                            retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                            if (retVal === false) {
                                break;
                            }
                        }
                    }
                }
            }
        };
        qq.bind = function(oldFunc, context) {
            if (qq.isFunction(oldFunc)) {
                var args = Array.prototype.slice.call(arguments, 2);
                return function() {
                    var newArgs = qq.extend([], args);
                    if (arguments.length) {
                        newArgs = newArgs.concat(Array.prototype.slice.call(arguments));
                    }
                    return oldFunc.apply(context, newArgs);
                };
            }
            throw new Error("first parameter must be a function!");
        };
        qq.obj2url = function(obj, temp, prefixDone) {
            var uristrings = [], prefix = "&", add = function(nextObj, i) {
                var nextTemp = temp ? /\[\]$/.test(temp) ? temp : temp + "[" + i + "]" : i;
                if (nextTemp !== "undefined" && i !== "undefined") {
                    uristrings.push(typeof nextObj === "object" ? qq.obj2url(nextObj, nextTemp, true) : Object.prototype.toString.call(nextObj) === "[object Function]" ? encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj()) : encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj));
                }
            };
            if (!prefixDone && temp) {
                prefix = /\?/.test(temp) ? /\?$/.test(temp) ? "" : "&" : "?";
                uristrings.push(temp);
                uristrings.push(qq.obj2url(obj));
            } else if (Object.prototype.toString.call(obj) === "[object Array]" && typeof obj !== "undefined") {
                qq.each(obj, function(idx, val) {
                    add(val, idx);
                });
            } else if (typeof obj !== "undefined" && obj !== null && typeof obj === "object") {
                qq.each(obj, function(prop, val) {
                    add(val, prop);
                });
            } else {
                uristrings.push(encodeURIComponent(temp) + "=" + encodeURIComponent(obj));
            }
            if (temp) {
                return uristrings.join(prefix);
            } else {
                return uristrings.join(prefix).replace(/^&/, "").replace(/%20/g, "+");
            }
        };
        qq.obj2FormData = function(obj, formData, arrayKeyName) {
            if (!formData) {
                formData = new FormData();
            }
            qq.each(obj, function(key, val) {
                key = arrayKeyName ? arrayKeyName + "[" + key + "]" : key;
                if (qq.isObject(val)) {
                    qq.obj2FormData(val, formData, key);
                } else if (qq.isFunction(val)) {
                    formData.append(key, val());
                } else {
                    formData.append(key, val);
                }
            });
            return formData;
        };
        qq.obj2Inputs = function(obj, form) {
            var input;
            if (!form) {
                form = document.createElement("form");
            }
            qq.obj2FormData(obj, {
                append: function(key, val) {
                    input = document.createElement("input");
                    input.setAttribute("name", key);
                    input.setAttribute("value", val);
                    form.appendChild(input);
                }
            });
            return form;
        };
        qq.parseJson = function(json) {
            if (window.JSON && qq.isFunction(JSON.parse)) {
                return JSON.parse(json);
            } else {
                return eval("(" + json + ")");
            }
        };
        qq.getExtension = function(filename) {
            var extIdx = filename.lastIndexOf(".") + 1;
            if (extIdx > 0) {
                return filename.substr(extIdx, filename.length - extIdx);
            }
        };
        qq.getFilename = function(blobOrFileInput) {
            if (qq.isInput(blobOrFileInput)) {
                return blobOrFileInput.value.replace(/.*(\/|\\)/, "");
            } else if (qq.isFile(blobOrFileInput)) {
                if (blobOrFileInput.fileName !== null && blobOrFileInput.fileName !== undefined) {
                    return blobOrFileInput.fileName;
                }
            }
            return blobOrFileInput.name;
        };
        qq.DisposeSupport = function() {
            var disposers = [];
            return {
                dispose: function() {
                    var disposer;
                    do {
                        disposer = disposers.shift();
                        if (disposer) {
                            disposer();
                        }
                    } while (disposer);
                },
                attach: function() {
                    var args = arguments;
                    this.addDisposer(qq(args[0]).attach.apply(this, Array.prototype.slice.call(arguments, 1)));
                },
                addDisposer: function(disposeFunction) {
                    disposers.push(disposeFunction);
                }
            };
        };
    })();
    (function() {
        "use strict";
        if (true) {
            !(__WEBPACK_AMD_DEFINE_RESULT__ = function() {
                return qq;
            }.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
        } else if (typeof module !== "undefined" && module.exports) {
            module.exports = qq;
        } else {
            global.qq = qq;
        }
    })();
    (function() {
        "use strict";
        qq.Error = function(message) {
            this.message = "[Fine Uploader " + qq.version + "] " + message;
        };
        qq.Error.prototype = new Error();
    })();
    qq.version = "5.16.2";
    qq.supportedFeatures = function() {
        "use strict";
        var supportsUploading, supportsUploadingBlobs, supportsFileDrop, supportsAjaxFileUploading, supportsFolderDrop, supportsChunking, supportsResume, supportsUploadViaPaste, supportsUploadCors, supportsDeleteFileXdr, supportsDeleteFileCorsXhr, supportsDeleteFileCors, supportsFolderSelection, supportsImagePreviews, supportsUploadProgress;
        function testSupportsFileInputElement() {
            var supported = true, tempInput;
            try {
                tempInput = document.createElement("input");
                tempInput.type = "file";
                qq(tempInput).hide();
                if (tempInput.disabled) {
                    supported = false;
                }
            } catch (ex) {
                supported = false;
            }
            return supported;
        }
        function isChrome14OrHigher() {
            return (qq.chrome() || qq.opera()) && navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/) !== undefined;
        }
        function isCrossOriginXhrSupported() {
            if (window.XMLHttpRequest) {
                var xhr = qq.createXhrInstance();
                return xhr.withCredentials !== undefined;
            }
            return false;
        }
        function isXdrSupported() {
            return window.XDomainRequest !== undefined;
        }
        function isCrossOriginAjaxSupported() {
            if (isCrossOriginXhrSupported()) {
                return true;
            }
            return isXdrSupported();
        }
        function isFolderSelectionSupported() {
            return document.createElement("input").webkitdirectory !== undefined;
        }
        function isLocalStorageSupported() {
            try {
                return !!window.localStorage && qq.isFunction(window.localStorage.setItem);
            } catch (error) {
                return false;
            }
        }
        function isDragAndDropSupported() {
            var span = document.createElement("span");
            return ("draggable" in span || "ondragstart" in span && "ondrop" in span) && !qq.android() && !qq.ios();
        }
        supportsUploading = testSupportsFileInputElement();
        supportsAjaxFileUploading = supportsUploading && qq.isXhrUploadSupported();
        supportsUploadingBlobs = supportsAjaxFileUploading && !qq.androidStock();
        supportsFileDrop = supportsAjaxFileUploading && isDragAndDropSupported();
        supportsFolderDrop = supportsFileDrop && function() {
            var input = document.createElement("input");
            input.type = "file";
            return !!("webkitdirectory" in (input || document.querySelectorAll("input[type=file]")[0]));
        }();
        supportsChunking = supportsAjaxFileUploading && qq.isFileChunkingSupported();
        supportsResume = supportsAjaxFileUploading && supportsChunking && isLocalStorageSupported();
        supportsUploadViaPaste = supportsAjaxFileUploading && isChrome14OrHigher();
        supportsUploadCors = supportsUploading && (window.postMessage !== undefined || supportsAjaxFileUploading);
        supportsDeleteFileCorsXhr = isCrossOriginXhrSupported();
        supportsDeleteFileXdr = isXdrSupported();
        supportsDeleteFileCors = isCrossOriginAjaxSupported();
        supportsFolderSelection = isFolderSelectionSupported();
        supportsImagePreviews = supportsAjaxFileUploading && window.FileReader !== undefined;
        supportsUploadProgress = function() {
            if (supportsAjaxFileUploading) {
                return !qq.androidStock() && !qq.iosChrome();
            }
            return false;
        }();
        return {
            ajaxUploading: supportsAjaxFileUploading,
            blobUploading: supportsUploadingBlobs,
            canDetermineSize: supportsAjaxFileUploading,
            chunking: supportsChunking,
            deleteFileCors: supportsDeleteFileCors,
            deleteFileCorsXdr: supportsDeleteFileXdr,
            deleteFileCorsXhr: supportsDeleteFileCorsXhr,
            dialogElement: !!window.HTMLDialogElement,
            fileDrop: supportsFileDrop,
            folderDrop: supportsFolderDrop,
            folderSelection: supportsFolderSelection,
            imagePreviews: supportsImagePreviews,
            imageValidation: supportsImagePreviews,
            itemSizeValidation: supportsAjaxFileUploading,
            pause: supportsChunking,
            progressBar: supportsUploadProgress,
            resume: supportsResume,
            scaling: supportsImagePreviews && supportsUploadingBlobs,
            tiffPreviews: qq.safari(),
            unlimitedScaledImageSize: !qq.ios(),
            uploading: supportsUploading,
            uploadCors: supportsUploadCors,
            uploadCustomHeaders: supportsAjaxFileUploading,
            uploadNonMultipart: supportsAjaxFileUploading,
            uploadViaPaste: supportsUploadViaPaste
        };
    }();
    qq.isGenericPromise = function(maybePromise) {
        "use strict";
        return !!(maybePromise && maybePromise.then && qq.isFunction(maybePromise.then));
    };
    qq.Promise = function() {
        "use strict";
        var successArgs, failureArgs, successCallbacks = [], failureCallbacks = [], doneCallbacks = [], state = 0;
        qq.extend(this, {
            then: function(onSuccess, onFailure) {
                if (state === 0) {
                    if (onSuccess) {
                        successCallbacks.push(onSuccess);
                    }
                    if (onFailure) {
                        failureCallbacks.push(onFailure);
                    }
                } else if (state === -1) {
                    onFailure && onFailure.apply(null, failureArgs);
                } else if (onSuccess) {
                    onSuccess.apply(null, successArgs);
                }
                return this;
            },
            done: function(callback) {
                if (state === 0) {
                    doneCallbacks.push(callback);
                } else {
                    callback.apply(null, failureArgs === undefined ? successArgs : failureArgs);
                }
                return this;
            },
            success: function() {
                state = 1;
                successArgs = arguments;
                if (successCallbacks.length) {
                    qq.each(successCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                return this;
            },
            failure: function() {
                state = -1;
                failureArgs = arguments;
                if (failureCallbacks.length) {
                    qq.each(failureCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                return this;
            }
        });
    };
    qq.BlobProxy = function(referenceBlob, onCreate) {
        "use strict";
        qq.extend(this, {
            referenceBlob: referenceBlob,
            create: function() {
                return onCreate(referenceBlob);
            }
        });
    };
    qq.UploadButton = function(o) {
        "use strict";
        var self = this, disposeSupport = new qq.DisposeSupport(), options = {
            acceptFiles: null,
            element: null,
            focusClass: "qq-upload-button-focus",
            folders: false,
            hoverClass: "qq-upload-button-hover",
            ios8BrowserCrashWorkaround: false,
            multiple: false,
            name: "qqfile",
            onChange: function(input) {},
            title: null
        }, input, buttonId;
        qq.extend(options, o);
        buttonId = qq.getUniqueId();
        function createInput() {
            var input = document.createElement("input");
            input.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME, buttonId);
            input.setAttribute("title", options.title);
            self.setMultiple(options.multiple, input);
            if (options.folders && qq.supportedFeatures.folderSelection) {
                input.setAttribute("webkitdirectory", "");
            }
            if (options.acceptFiles) {
                input.setAttribute("accept", options.acceptFiles);
            }
            input.setAttribute("type", "file");
            input.setAttribute("name", options.name);
            qq(input).css({
                position: "absolute",
                right: 0,
                top: 0,
                fontFamily: "Arial",
                fontSize: qq.ie() && !qq.ie8() ? "3500px" : "118px",
                margin: 0,
                padding: 0,
                cursor: "pointer",
                opacity: 0
            });
            !qq.ie7() && qq(input).css({
                height: "100%"
            });
            options.element.appendChild(input);
            disposeSupport.attach(input, "change", function() {
                options.onChange(input);
            });
            disposeSupport.attach(input, "mouseover", function() {
                qq(options.element).addClass(options.hoverClass);
            });
            disposeSupport.attach(input, "mouseout", function() {
                qq(options.element).removeClass(options.hoverClass);
            });
            disposeSupport.attach(input, "focus", function() {
                qq(options.element).addClass(options.focusClass);
            });
            disposeSupport.attach(input, "blur", function() {
                qq(options.element).removeClass(options.focusClass);
            });
            return input;
        }
        qq(options.element).css({
            position: "relative",
            overflow: "hidden",
            direction: "ltr"
        });
        qq.extend(this, {
            getInput: function() {
                return input;
            },
            getButtonId: function() {
                return buttonId;
            },
            setMultiple: function(isMultiple, optInput) {
                var input = optInput || this.getInput();
                if (options.ios8BrowserCrashWorkaround && qq.ios8() && (qq.iosChrome() || qq.iosSafariWebView())) {
                    input.setAttribute("multiple", "");
                } else {
                    if (isMultiple) {
                        input.setAttribute("multiple", "");
                    } else {
                        input.removeAttribute("multiple");
                    }
                }
            },
            setAcceptFiles: function(acceptFiles) {
                if (acceptFiles !== options.acceptFiles) {
                    input.setAttribute("accept", acceptFiles);
                }
            },
            reset: function() {
                if (input.parentNode) {
                    qq(input).remove();
                }
                qq(options.element).removeClass(options.focusClass);
                input = null;
                input = createInput();
            }
        });
        input = createInput();
    };
    qq.UploadButton.BUTTON_ID_ATTR_NAME = "qq-button-id";
    qq.UploadData = function(uploaderProxy) {
        "use strict";
        var data = [], byUuid = {}, byStatus = {}, byProxyGroupId = {}, byBatchId = {};
        function getDataByIds(idOrIds) {
            if (qq.isArray(idOrIds)) {
                var entries = [];
                qq.each(idOrIds, function(idx, id) {
                    entries.push(data[id]);
                });
                return entries;
            }
            return data[idOrIds];
        }
        function getDataByUuids(uuids) {
            if (qq.isArray(uuids)) {
                var entries = [];
                qq.each(uuids, function(idx, uuid) {
                    entries.push(data[byUuid[uuid]]);
                });
                return entries;
            }
            return data[byUuid[uuids]];
        }
        function getDataByStatus(status) {
            var statusResults = [], statuses = [].concat(status);
            qq.each(statuses, function(index, statusEnum) {
                var statusResultIndexes = byStatus[statusEnum];
                if (statusResultIndexes !== undefined) {
                    qq.each(statusResultIndexes, function(i, dataIndex) {
                        statusResults.push(data[dataIndex]);
                    });
                }
            });
            return statusResults;
        }
        qq.extend(this, {
            addFile: function(spec) {
                var status = spec.status || qq.status.SUBMITTING, id = data.push({
                    name: spec.name,
                    originalName: spec.name,
                    uuid: spec.uuid,
                    size: spec.size == null ? -1 : spec.size,
                    status: status,
                    file: spec.file
                }) - 1;
                if (spec.batchId) {
                    data[id].batchId = spec.batchId;
                    if (byBatchId[spec.batchId] === undefined) {
                        byBatchId[spec.batchId] = [];
                    }
                    byBatchId[spec.batchId].push(id);
                }
                if (spec.proxyGroupId) {
                    data[id].proxyGroupId = spec.proxyGroupId;
                    if (byProxyGroupId[spec.proxyGroupId] === undefined) {
                        byProxyGroupId[spec.proxyGroupId] = [];
                    }
                    byProxyGroupId[spec.proxyGroupId].push(id);
                }
                data[id].id = id;
                byUuid[spec.uuid] = id;
                if (byStatus[status] === undefined) {
                    byStatus[status] = [];
                }
                byStatus[status].push(id);
                spec.onBeforeStatusChange && spec.onBeforeStatusChange(id);
                uploaderProxy.onStatusChange(id, null, status);
                return id;
            },
            retrieve: function(optionalFilter) {
                if (qq.isObject(optionalFilter) && data.length) {
                    if (optionalFilter.id !== undefined) {
                        return getDataByIds(optionalFilter.id);
                    } else if (optionalFilter.uuid !== undefined) {
                        return getDataByUuids(optionalFilter.uuid);
                    } else if (optionalFilter.status) {
                        return getDataByStatus(optionalFilter.status);
                    }
                } else {
                    return qq.extend([], data, true);
                }
            },
            removeFileRef: function(id) {
                var record = getDataByIds(id);
                if (record) {
                    delete record.file;
                }
            },
            reset: function() {
                data = [];
                byUuid = {};
                byStatus = {};
                byBatchId = {};
            },
            setStatus: function(id, newStatus) {
                var oldStatus = data[id].status, byStatusOldStatusIndex = qq.indexOf(byStatus[oldStatus], id);
                byStatus[oldStatus].splice(byStatusOldStatusIndex, 1);
                data[id].status = newStatus;
                if (byStatus[newStatus] === undefined) {
                    byStatus[newStatus] = [];
                }
                byStatus[newStatus].push(id);
                uploaderProxy.onStatusChange(id, oldStatus, newStatus);
            },
            uuidChanged: function(id, newUuid) {
                var oldUuid = data[id].uuid;
                data[id].uuid = newUuid;
                byUuid[newUuid] = id;
                delete byUuid[oldUuid];
            },
            updateName: function(id, newName) {
                data[id].name = newName;
            },
            updateSize: function(id, newSize) {
                data[id].size = newSize;
            },
            setParentId: function(targetId, parentId) {
                data[targetId].parentId = parentId;
            },
            getIdsInProxyGroup: function(id) {
                var proxyGroupId = data[id].proxyGroupId;
                if (proxyGroupId) {
                    return byProxyGroupId[proxyGroupId];
                }
                return [];
            },
            getIdsInBatch: function(id) {
                var batchId = data[id].batchId;
                return byBatchId[batchId];
            }
        });
    };
    qq.status = {
        SUBMITTING: "submitting",
        SUBMITTED: "submitted",
        REJECTED: "rejected",
        QUEUED: "queued",
        CANCELED: "canceled",
        PAUSED: "paused",
        UPLOADING: "uploading",
        UPLOAD_FINALIZING: "upload finalizing",
        UPLOAD_RETRYING: "retrying upload",
        UPLOAD_SUCCESSFUL: "upload successful",
        UPLOAD_FAILED: "upload failed",
        DELETE_FAILED: "delete failed",
        DELETING: "deleting",
        DELETED: "deleted"
    };
    (function() {
        "use strict";
        qq.basePublicApi = {
            addBlobs: function(blobDataOrArray, params, endpoint) {
                this.addFiles(blobDataOrArray, params, endpoint);
            },
            addInitialFiles: function(cannedFileList) {
                var self = this;
                qq.each(cannedFileList, function(index, cannedFile) {
                    self._addCannedFile(cannedFile);
                });
            },
            addFiles: function(data, params, endpoint) {
                this._maybeHandleIos8SafariWorkaround();
                var batchId = this._storedIds.length === 0 ? qq.getUniqueId() : this._currentBatchId, processBlob = qq.bind(function(blob) {
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName
                    }, batchId, verifiedFiles);
                }, this), processBlobData = qq.bind(function(blobData) {
                    this._handleNewFile(blobData, batchId, verifiedFiles);
                }, this), processCanvas = qq.bind(function(canvas) {
                    var blob = qq.canvasToBlob(canvas);
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName + ".png"
                    }, batchId, verifiedFiles);
                }, this), processCanvasData = qq.bind(function(canvasData) {
                    var normalizedQuality = canvasData.quality && canvasData.quality / 100, blob = qq.canvasToBlob(canvasData.canvas, canvasData.type, normalizedQuality);
                    this._handleNewFile({
                        blob: blob,
                        name: canvasData.name
                    }, batchId, verifiedFiles);
                }, this), processFileOrInput = qq.bind(function(fileOrInput) {
                    if (qq.isInput(fileOrInput) && qq.supportedFeatures.ajaxUploading) {
                        var files = Array.prototype.slice.call(fileOrInput.files), self = this;
                        qq.each(files, function(idx, file) {
                            self._handleNewFile(file, batchId, verifiedFiles);
                        });
                    } else {
                        this._handleNewFile(fileOrInput, batchId, verifiedFiles);
                    }
                }, this), normalizeData = function() {
                    if (qq.isFileList(data)) {
                        data = Array.prototype.slice.call(data);
                    }
                    data = [].concat(data);
                }, self = this, verifiedFiles = [];
                this._currentBatchId = batchId;
                if (data) {
                    normalizeData();
                    qq.each(data, function(idx, fileContainer) {
                        if (qq.isFileOrInput(fileContainer)) {
                            processFileOrInput(fileContainer);
                        } else if (qq.isBlob(fileContainer)) {
                            processBlob(fileContainer);
                        } else if (qq.isObject(fileContainer)) {
                            if (fileContainer.blob && fileContainer.name) {
                                processBlobData(fileContainer);
                            } else if (fileContainer.canvas && fileContainer.name) {
                                processCanvasData(fileContainer);
                            }
                        } else if (fileContainer.tagName && fileContainer.tagName.toLowerCase() === "canvas") {
                            processCanvas(fileContainer);
                        } else {
                            self.log(fileContainer + " is not a valid file container!  Ignoring!", "warn");
                        }
                    });
                    this.log("Received " + verifiedFiles.length + " files.");
                    this._prepareItemsForUpload(verifiedFiles, params, endpoint);
                }
            },
            cancel: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (uploadData && uploadData.status === qq.status.UPLOAD_FINALIZING) {
                    this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.", id, this.getName(id)), "error");
                } else {
                    this._handler.cancel(id);
                }
            },
            cancelAll: function() {
                var storedIdsCopy = [], self = this;
                qq.extend(storedIdsCopy, this._storedIds);
                qq.each(storedIdsCopy, function(idx, storedFileId) {
                    self.cancel(storedFileId);
                });
                this._handler.cancelAll();
            },
            clearStoredFiles: function() {
                this._storedIds = [];
            },
            continueUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (uploadData.status === qq.status.PAUSED) {
                    this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.", id, this.getName(id)));
                    this._uploadFile(id);
                    return true;
                } else {
                    this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.", id, this.getName(id)), "error");
                }
                return false;
            },
            deleteFile: function(id) {
                return this._onSubmitDelete(id);
            },
            doesExist: function(fileOrBlobId) {
                return this._handler.isValid(fileOrBlobId);
            },
            drawThumbnail: function(fileId, imgOrCanvas, maxSize, fromServer, customResizeFunction) {
                var promiseToReturn = new qq.Promise(), fileOrUrl, options;
                if (this._imageGenerator) {
                    fileOrUrl = this._thumbnailUrls[fileId];
                    options = {
                        customResizeFunction: customResizeFunction,
                        maxSize: maxSize > 0 ? maxSize : null,
                        scale: maxSize > 0
                    };
                    if (!fromServer && qq.supportedFeatures.imagePreviews) {
                        fileOrUrl = this.getFile(fileId);
                    }
                    if (fileOrUrl == null) {
                        promiseToReturn.failure({
                            container: imgOrCanvas,
                            error: "File or URL not found."
                        });
                    } else {
                        this._imageGenerator.generate(fileOrUrl, imgOrCanvas, options).then(function success(modifiedContainer) {
                            promiseToReturn.success(modifiedContainer);
                        }, function failure(container, reason) {
                            promiseToReturn.failure({
                                container: container,
                                error: reason || "Problem generating thumbnail"
                            });
                        });
                    }
                } else {
                    promiseToReturn.failure({
                        container: imgOrCanvas,
                        error: "Missing image generator module"
                    });
                }
                return promiseToReturn;
            },
            getButton: function(fileId) {
                return this._getButton(this._buttonIdsForFileIds[fileId]);
            },
            getEndpoint: function(fileId) {
                return this._endpointStore.get(fileId);
            },
            getFile: function(fileOrBlobId) {
                var file = this._handler.getFile(fileOrBlobId);
                var uploadDataRecord;
                if (!file) {
                    uploadDataRecord = this._uploadData.retrieve({
                        id: fileOrBlobId
                    });
                    if (uploadDataRecord) {
                        file = uploadDataRecord.file;
                    }
                }
                return file || null;
            },
            getInProgress: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED ]
                }).length;
            },
            getName: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).name;
            },
            getParentId: function(id) {
                var uploadDataEntry = this.getUploads({
                    id: id
                }), parentId = null;
                if (uploadDataEntry) {
                    if (uploadDataEntry.parentId !== undefined) {
                        parentId = uploadDataEntry.parentId;
                    }
                }
                return parentId;
            },
            getResumableFilesData: function() {
                return this._handler.getResumableFilesData();
            },
            getSize: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).size;
            },
            getNetUploads: function() {
                return this._netUploaded;
            },
            getRemainingAllowedItems: function() {
                var allowedItems = this._currentItemLimit;
                if (allowedItems > 0) {
                    return allowedItems - this._netUploadedOrQueued;
                }
                return null;
            },
            getUploads: function(optionalFilter) {
                return this._uploadData.retrieve(optionalFilter);
            },
            getUuid: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).uuid;
            },
            isResumable: function(id) {
                return this._handler.hasResumeRecord(id);
            },
            log: function(str, level) {
                if (this._options.debug && (!level || level === "info")) {
                    qq.log("[Fine Uploader " + qq.version + "] " + str);
                } else if (level && level !== "info") {
                    qq.log("[Fine Uploader " + qq.version + "] " + str, level);
                }
            },
            pauseUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (qq.indexOf([ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING ], uploadData.status) >= 0) {
                    if (this._handler.pause(id)) {
                        this._uploadData.setStatus(id, qq.status.PAUSED);
                        return true;
                    } else {
                        this.log(qq.format("Unable to pause file ID {} ({}).", id, this.getName(id)), "error");
                    }
                } else {
                    this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.", id, this.getName(id)), "error");
                }
                return false;
            },
            removeFileRef: function(id) {
                this._handler.expunge(id);
                this._uploadData.removeFileRef(id);
            },
            reset: function() {
                this.log("Resetting uploader...");
                this._handler.reset();
                this._storedIds = [];
                this._autoRetries = [];
                this._retryTimeouts = [];
                this._preventRetries = [];
                this._thumbnailUrls = [];
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
                this._paramsStore.reset();
                this._endpointStore.reset();
                this._netUploadedOrQueued = 0;
                this._netUploaded = 0;
                this._uploadData.reset();
                this._buttonIdsForFileIds = [];
                this._pasteHandler && this._pasteHandler.reset();
                this._options.session.refreshOnReset && this._refreshSessionData();
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
                this._totalProgress && this._totalProgress.reset();
                this._customResumeDataStore.reset();
            },
            retry: function(id) {
                return this._manualRetry(id);
            },
            scaleImage: function(id, specs) {
                var self = this;
                return qq.Scaler.prototype.scaleImage(id, specs, {
                    log: qq.bind(self.log, self),
                    getFile: qq.bind(self.getFile, self),
                    uploadData: self._uploadData
                });
            },
            setCustomHeaders: function(headers, id) {
                this._customHeadersStore.set(headers, id);
            },
            setCustomResumeData: function(id, data) {
                this._customResumeDataStore.set(data, id);
            },
            setDeleteFileCustomHeaders: function(headers, id) {
                this._deleteFileCustomHeadersStore.set(headers, id);
            },
            setDeleteFileEndpoint: function(endpoint, id) {
                this._deleteFileEndpointStore.set(endpoint, id);
            },
            setDeleteFileParams: function(params, id) {
                this._deleteFileParamsStore.set(params, id);
            },
            setEndpoint: function(endpoint, id) {
                this._endpointStore.set(endpoint, id);
            },
            setForm: function(elementOrId) {
                this._updateFormSupportAndParams(elementOrId);
            },
            setItemLimit: function(newItemLimit) {
                this._currentItemLimit = newItemLimit;
            },
            setName: function(id, newName) {
                this._uploadData.updateName(id, newName);
            },
            setParams: function(params, id) {
                this._paramsStore.set(params, id);
            },
            setUuid: function(id, newUuid) {
                return this._uploadData.uuidChanged(id, newUuid);
            },
            setStatus: function(id, newStatus) {
                var fileRecord = this.getUploads({
                    id: id
                });
                if (!fileRecord) {
                    throw new qq.Error(id + " is not a valid file ID.");
                }
                switch (newStatus) {
                  case qq.status.DELETED:
                    this._onDeleteComplete(id, null, false);
                    break;

                  case qq.status.DELETE_FAILED:
                    this._onDeleteComplete(id, null, true);
                    break;

                  default:
                    var errorMessage = "Method setStatus called on '" + name + "' not implemented yet for " + newStatus;
                    this.log(errorMessage);
                    throw new qq.Error(errorMessage);
                }
            },
            uploadStoredFiles: function() {
                if (this._storedIds.length === 0) {
                    this._itemError("noFilesError");
                } else {
                    this._uploadStoredFiles();
                }
            }
        };
        qq.basePrivateApi = {
            _addCannedFile: function(sessionData) {
                var self = this;
                return this._uploadData.addFile({
                    uuid: sessionData.uuid,
                    name: sessionData.name,
                    size: sessionData.size,
                    status: qq.status.UPLOAD_SUCCESSFUL,
                    onBeforeStatusChange: function(id) {
                        sessionData.deleteFileEndpoint && self.setDeleteFileEndpoint(sessionData.deleteFileEndpoint, id);
                        sessionData.deleteFileParams && self.setDeleteFileParams(sessionData.deleteFileParams, id);
                        if (sessionData.thumbnailUrl) {
                            self._thumbnailUrls[id] = sessionData.thumbnailUrl;
                        }
                        self._netUploaded++;
                        self._netUploadedOrQueued++;
                    }
                });
            },
            _annotateWithButtonId: function(file, associatedInput) {
                if (qq.isFile(file)) {
                    file.qqButtonId = this._getButtonId(associatedInput);
                }
            },
            _batchError: function(message) {
                this._options.callbacks.onError(null, null, message, undefined);
            },
            _createDeleteHandler: function() {
                var self = this;
                return new qq.DeleteFileAjaxRequester({
                    method: this._options.deleteFile.method.toUpperCase(),
                    maxConnections: this._options.maxConnections,
                    uuidParamName: this._options.request.uuidName,
                    customHeaders: this._deleteFileCustomHeadersStore,
                    paramsStore: this._deleteFileParamsStore,
                    endpointStore: this._deleteFileEndpointStore,
                    cors: this._options.cors,
                    log: qq.bind(self.log, self),
                    onDelete: function(id) {
                        self._onDelete(id);
                        self._options.callbacks.onDelete(id);
                    },
                    onDeleteComplete: function(id, xhrOrXdr, isError) {
                        self._onDeleteComplete(id, xhrOrXdr, isError);
                        self._options.callbacks.onDeleteComplete(id, xhrOrXdr, isError);
                    }
                });
            },
            _createPasteHandler: function() {
                var self = this;
                return new qq.PasteSupport({
                    targetElement: this._options.paste.targetElement,
                    callbacks: {
                        log: qq.bind(self.log, self),
                        pasteReceived: function(blob) {
                            self._handleCheckedCallback({
                                name: "onPasteReceived",
                                callback: qq.bind(self._options.callbacks.onPasteReceived, self, blob),
                                onSuccess: qq.bind(self._handlePasteSuccess, self, blob),
                                identifier: "pasted image"
                            });
                        }
                    }
                });
            },
            _createStore: function(initialValue, _readOnlyValues_) {
                var store = {}, catchall = initialValue, perIdReadOnlyValues = {}, readOnlyValues = _readOnlyValues_, copy = function(orig) {
                    if (qq.isObject(orig)) {
                        return qq.extend({}, orig);
                    }
                    return orig;
                }, getReadOnlyValues = function() {
                    if (qq.isFunction(readOnlyValues)) {
                        return readOnlyValues();
                    }
                    return readOnlyValues;
                }, includeReadOnlyValues = function(id, existing) {
                    if (readOnlyValues && qq.isObject(existing)) {
                        qq.extend(existing, getReadOnlyValues());
                    }
                    if (perIdReadOnlyValues[id]) {
                        qq.extend(existing, perIdReadOnlyValues[id]);
                    }
                };
                return {
                    set: function(val, id) {
                        if (id == null) {
                            store = {};
                            catchall = copy(val);
                        } else {
                            store[id] = copy(val);
                        }
                    },
                    get: function(id) {
                        var values;
                        if (id != null && store[id]) {
                            values = store[id];
                        } else {
                            values = copy(catchall);
                        }
                        includeReadOnlyValues(id, values);
                        return copy(values);
                    },
                    addReadOnly: function(id, values) {
                        if (qq.isObject(store)) {
                            if (id === null) {
                                if (qq.isFunction(values)) {
                                    readOnlyValues = values;
                                } else {
                                    readOnlyValues = readOnlyValues || {};
                                    qq.extend(readOnlyValues, values);
                                }
                            } else {
                                perIdReadOnlyValues[id] = perIdReadOnlyValues[id] || {};
                                qq.extend(perIdReadOnlyValues[id], values);
                            }
                        }
                    },
                    remove: function(fileId) {
                        return delete store[fileId];
                    },
                    reset: function() {
                        store = {};
                        perIdReadOnlyValues = {};
                        catchall = initialValue;
                    }
                };
            },
            _createUploadDataTracker: function() {
                var self = this;
                return new qq.UploadData({
                    getName: function(id) {
                        return self.getName(id);
                    },
                    getUuid: function(id) {
                        return self.getUuid(id);
                    },
                    getSize: function(id) {
                        return self.getSize(id);
                    },
                    onStatusChange: function(id, oldStatus, newStatus) {
                        self._onUploadStatusChange(id, oldStatus, newStatus);
                        self._options.callbacks.onStatusChange(id, oldStatus, newStatus);
                        self._maybeAllComplete(id, newStatus);
                        if (self._totalProgress) {
                            setTimeout(function() {
                                self._totalProgress.onStatusChange(id, oldStatus, newStatus);
                            }, 0);
                        }
                    }
                });
            },
            _createUploadButton: function(spec) {
                var self = this, acceptFiles = spec.accept || this._options.validation.acceptFiles, allowedExtensions = spec.allowedExtensions || this._options.validation.allowedExtensions, button;
                function allowMultiple() {
                    if (qq.supportedFeatures.ajaxUploading) {
                        if (self._options.workarounds.iosEmptyVideos && qq.ios() && !qq.ios6() && self._isAllowedExtension(allowedExtensions, ".mov")) {
                            return false;
                        }
                        if (spec.multiple === undefined) {
                            return self._options.multiple;
                        }
                        return spec.multiple;
                    }
                    return false;
                }
                button = new qq.UploadButton({
                    acceptFiles: acceptFiles,
                    element: spec.element,
                    focusClass: this._options.classes.buttonFocus,
                    folders: spec.folders,
                    hoverClass: this._options.classes.buttonHover,
                    ios8BrowserCrashWorkaround: this._options.workarounds.ios8BrowserCrash,
                    multiple: allowMultiple(),
                    name: this._options.request.inputName,
                    onChange: function(input) {
                        self._onInputChange(input);
                    },
                    title: spec.title == null ? this._options.text.fileInputTitle : spec.title
                });
                this._disposeSupport.addDisposer(function() {
                    button.dispose();
                });
                self._buttons.push(button);
                return button;
            },
            _createUploadHandler: function(additionalOptions, namespace) {
                var self = this, lastOnProgress = {}, options = {
                    debug: this._options.debug,
                    maxConnections: this._options.maxConnections,
                    cors: this._options.cors,
                    paramsStore: this._paramsStore,
                    endpointStore: this._endpointStore,
                    chunking: this._options.chunking,
                    resume: this._options.resume,
                    blobs: this._options.blobs,
                    log: qq.bind(self.log, self),
                    preventRetryParam: this._options.retry.preventRetryResponseProperty,
                    onProgress: function(id, name, loaded, total) {
                        if (loaded < 0 || total < 0) {
                            return;
                        }
                        if (lastOnProgress[id]) {
                            if (lastOnProgress[id].loaded !== loaded || lastOnProgress[id].total !== total) {
                                self._onProgress(id, name, loaded, total);
                                self._options.callbacks.onProgress(id, name, loaded, total);
                            }
                        } else {
                            self._onProgress(id, name, loaded, total);
                            self._options.callbacks.onProgress(id, name, loaded, total);
                        }
                        lastOnProgress[id] = {
                            loaded: loaded,
                            total: total
                        };
                    },
                    onComplete: function(id, name, result, xhr) {
                        delete lastOnProgress[id];
                        var status = self.getUploads({
                            id: id
                        }).status, retVal;
                        if (status === qq.status.UPLOAD_SUCCESSFUL || status === qq.status.UPLOAD_FAILED) {
                            return;
                        }
                        retVal = self._onComplete(id, name, result, xhr);
                        if (retVal instanceof qq.Promise) {
                            retVal.done(function() {
                                self._options.callbacks.onComplete(id, name, result, xhr);
                            });
                        } else {
                            self._options.callbacks.onComplete(id, name, result, xhr);
                        }
                    },
                    onCancel: function(id, name, cancelFinalizationEffort) {
                        var promise = new qq.Promise();
                        self._handleCheckedCallback({
                            name: "onCancel",
                            callback: qq.bind(self._options.callbacks.onCancel, self, id, name),
                            onFailure: promise.failure,
                            onSuccess: function() {
                                cancelFinalizationEffort.then(function() {
                                    self._onCancel(id, name);
                                });
                                promise.success();
                            },
                            identifier: id
                        });
                        return promise;
                    },
                    onUploadPrep: qq.bind(this._onUploadPrep, this),
                    onUpload: function(id, name) {
                        self._onUpload(id, name);
                        var onUploadResult = self._options.callbacks.onUpload(id, name);
                        if (qq.isGenericPromise(onUploadResult)) {
                            self.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.", id));
                            return onUploadResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunk: function(id, name, chunkData) {
                        self._onUploadChunk(id, chunkData);
                        var onUploadChunkResult = self._options.callbacks.onUploadChunk(id, name, chunkData);
                        if (qq.isGenericPromise(onUploadChunkResult)) {
                            self.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.", id, chunkData.partIndex));
                            return onUploadChunkResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunkSuccess: function(id, chunkData, result, xhr) {
                        self._onUploadChunkSuccess(id, chunkData);
                        self._options.callbacks.onUploadChunkSuccess.apply(self, arguments);
                    },
                    onResume: function(id, name, chunkData, customResumeData) {
                        return self._options.callbacks.onResume(id, name, chunkData, customResumeData);
                    },
                    onAutoRetry: function(id, name, responseJSON, xhr) {
                        return self._onAutoRetry.apply(self, arguments);
                    },
                    onUuidChanged: function(id, newUuid) {
                        self.log("Server requested UUID change from '" + self.getUuid(id) + "' to '" + newUuid + "'");
                        self.setUuid(id, newUuid);
                    },
                    getName: qq.bind(self.getName, self),
                    getUuid: qq.bind(self.getUuid, self),
                    getSize: qq.bind(self.getSize, self),
                    setSize: qq.bind(self._setSize, self),
                    getDataByUuid: function(uuid) {
                        return self.getUploads({
                            uuid: uuid
                        });
                    },
                    isQueued: function(id) {
                        var status = self.getUploads({
                            id: id
                        }).status;
                        return status === qq.status.QUEUED || status === qq.status.SUBMITTED || status === qq.status.UPLOAD_RETRYING || status === qq.status.PAUSED;
                    },
                    getIdsInProxyGroup: self._uploadData.getIdsInProxyGroup,
                    getIdsInBatch: self._uploadData.getIdsInBatch,
                    isInProgress: function(id) {
                        return self.getUploads({
                            id: id
                        }).status === qq.status.UPLOADING;
                    },
                    getCustomResumeData: qq.bind(self._getCustomResumeData, self),
                    setStatus: function(id, status) {
                        self._uploadData.setStatus(id, status);
                    }
                };
                qq.each(this._options.request, function(prop, val) {
                    options[prop] = val;
                });
                options.customHeaders = this._customHeadersStore;
                if (additionalOptions) {
                    qq.each(additionalOptions, function(key, val) {
                        options[key] = val;
                    });
                }
                return new qq.UploadHandlerController(options, namespace);
            },
            _fileOrBlobRejected: function(id) {
                this._netUploadedOrQueued--;
                this._uploadData.setStatus(id, qq.status.REJECTED);
            },
            _formatSize: function(bytes) {
                if (bytes === 0) {
                    return bytes + this._options.text.sizeSymbols[0];
                }
                var i = -1;
                do {
                    bytes = bytes / 1e3;
                    i++;
                } while (bytes > 999);
                return Math.max(bytes, .1).toFixed(1) + this._options.text.sizeSymbols[i];
            },
            _generateExtraButtonSpecs: function() {
                var self = this;
                this._extraButtonSpecs = {};
                qq.each(this._options.extraButtons, function(idx, extraButtonOptionEntry) {
                    var multiple = extraButtonOptionEntry.multiple, validation = qq.extend({}, self._options.validation, true), extraButtonSpec = qq.extend({}, extraButtonOptionEntry);
                    if (multiple === undefined) {
                        multiple = self._options.multiple;
                    }
                    if (extraButtonSpec.validation) {
                        qq.extend(validation, extraButtonOptionEntry.validation, true);
                    }
                    qq.extend(extraButtonSpec, {
                        multiple: multiple,
                        validation: validation
                    }, true);
                    self._initExtraButton(extraButtonSpec);
                });
            },
            _getButton: function(buttonId) {
                var extraButtonsSpec = this._extraButtonSpecs[buttonId];
                if (extraButtonsSpec) {
                    return extraButtonsSpec.element;
                } else if (buttonId === this._defaultButtonId) {
                    return this._options.button;
                }
            },
            _getButtonId: function(buttonOrFileInputOrFile) {
                var inputs, fileInput, fileBlobOrInput = buttonOrFileInputOrFile;
                if (fileBlobOrInput instanceof qq.BlobProxy) {
                    fileBlobOrInput = fileBlobOrInput.referenceBlob;
                }
                if (fileBlobOrInput && !qq.isBlob(fileBlobOrInput)) {
                    if (qq.isFile(fileBlobOrInput)) {
                        return fileBlobOrInput.qqButtonId;
                    } else if (fileBlobOrInput.tagName.toLowerCase() === "input" && fileBlobOrInput.type.toLowerCase() === "file") {
                        return fileBlobOrInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                    inputs = fileBlobOrInput.getElementsByTagName("input");
                    qq.each(inputs, function(idx, input) {
                        if (input.getAttribute("type") === "file") {
                            fileInput = input;
                            return false;
                        }
                    });
                    if (fileInput) {
                        return fileInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                }
            },
            _getCustomResumeData: function(fileId) {
                return this._customResumeDataStore.get(fileId);
            },
            _getNotFinished: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED, qq.status.SUBMITTING, qq.status.SUBMITTED, qq.status.PAUSED ]
                }).length;
            },
            _getValidationBase: function(buttonId) {
                var extraButtonSpec = this._extraButtonSpecs[buttonId];
                return extraButtonSpec ? extraButtonSpec.validation : this._options.validation;
            },
            _getValidationDescriptor: function(fileWrapper) {
                if (fileWrapper.file instanceof qq.BlobProxy) {
                    return {
                        name: qq.getFilename(fileWrapper.file.referenceBlob),
                        size: fileWrapper.file.referenceBlob.size
                    };
                }
                return {
                    name: this.getUploads({
                        id: fileWrapper.id
                    }).name,
                    size: this.getUploads({
                        id: fileWrapper.id
                    }).size
                };
            },
            _getValidationDescriptors: function(fileWrappers) {
                var self = this, fileDescriptors = [];
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    fileDescriptors.push(self._getValidationDescriptor(fileWrapper));
                });
                return fileDescriptors;
            },
            _handleCameraAccess: function() {
                if (this._options.camera.ios && qq.ios()) {
                    var acceptIosCamera = "image/*;capture=camera", button = this._options.camera.button, buttonId = button ? this._getButtonId(button) : this._defaultButtonId, optionRoot = this._options;
                    if (buttonId && buttonId !== this._defaultButtonId) {
                        optionRoot = this._extraButtonSpecs[buttonId];
                    }
                    optionRoot.multiple = false;
                    if (optionRoot.validation.acceptFiles === null) {
                        optionRoot.validation.acceptFiles = acceptIosCamera;
                    } else {
                        optionRoot.validation.acceptFiles += "," + acceptIosCamera;
                    }
                    qq.each(this._buttons, function(idx, button) {
                        if (button.getButtonId() === buttonId) {
                            button.setMultiple(optionRoot.multiple);
                            button.setAcceptFiles(optionRoot.acceptFiles);
                            return false;
                        }
                    });
                }
            },
            _handleCheckedCallback: function(details) {
                var self = this, callbackRetVal = details.callback();
                if (qq.isGenericPromise(callbackRetVal)) {
                    this.log(details.name + " - waiting for " + details.name + " promise to be fulfilled for " + details.identifier);
                    return callbackRetVal.then(function(successParam) {
                        self.log(details.name + " promise success for " + details.identifier);
                        details.onSuccess(successParam);
                    }, function() {
                        if (details.onFailure) {
                            self.log(details.name + " promise failure for " + details.identifier);
                            details.onFailure();
                        } else {
                            self.log(details.name + " promise failure for " + details.identifier);
                        }
                    });
                }
                if (callbackRetVal !== false) {
                    details.onSuccess(callbackRetVal);
                } else {
                    if (details.onFailure) {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Invoking failure callback.");
                        details.onFailure();
                    } else {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Will not proceed.");
                    }
                }
                return callbackRetVal;
            },
            _handleNewFile: function(file, batchId, newFileWrapperList) {
                var self = this, uuid = qq.getUniqueId(), size = -1, name = qq.getFilename(file), actualFile = file.blob || file, handler = this._customNewFileHandler ? this._customNewFileHandler : qq.bind(self._handleNewFileGeneric, self);
                if (!qq.isInput(actualFile) && actualFile.size >= 0) {
                    size = actualFile.size;
                }
                handler(actualFile, name, uuid, size, newFileWrapperList, batchId, this._options.request.uuidName, {
                    uploadData: self._uploadData,
                    paramsStore: self._paramsStore,
                    addFileToHandler: function(id, file) {
                        self._handler.add(id, file);
                        self._netUploadedOrQueued++;
                        self._trackButton(id);
                    }
                });
            },
            _handleNewFileGeneric: function(file, name, uuid, size, fileList, batchId) {
                var id = this._uploadData.addFile({
                    uuid: uuid,
                    name: name,
                    size: size,
                    batchId: batchId,
                    file: file
                });
                this._handler.add(id, file);
                this._trackButton(id);
                this._netUploadedOrQueued++;
                fileList.push({
                    id: id,
                    file: file
                });
            },
            _handlePasteSuccess: function(blob, extSuppliedName) {
                var extension = blob.type.split("/")[1], name = extSuppliedName;
                if (name == null) {
                    name = this._options.paste.defaultName;
                }
                name += "." + extension;
                this.addFiles({
                    name: name,
                    blob: blob
                });
            },
            _handleDeleteSuccess: function(id) {
                if (this.getUploads({
                    id: id
                }).status !== qq.status.DELETED) {
                    var name = this.getName(id);
                    this._netUploadedOrQueued--;
                    this._netUploaded--;
                    this._handler.expunge(id);
                    this._uploadData.setStatus(id, qq.status.DELETED);
                    this.log("Delete request for '" + name + "' has succeeded.");
                }
            },
            _handleDeleteFailed: function(id, xhrOrXdr) {
                var name = this.getName(id);
                this._uploadData.setStatus(id, qq.status.DELETE_FAILED);
                this.log("Delete request for '" + name + "' has failed.", "error");
                if (!xhrOrXdr || xhrOrXdr.withCredentials === undefined) {
                    this._options.callbacks.onError(id, name, "Delete request failed", xhrOrXdr);
                } else {
                    this._options.callbacks.onError(id, name, "Delete request failed with response code " + xhrOrXdr.status, xhrOrXdr);
                }
            },
            _initExtraButton: function(spec) {
                var button = this._createUploadButton({
                    accept: spec.validation.acceptFiles,
                    allowedExtensions: spec.validation.allowedExtensions,
                    element: spec.element,
                    folders: spec.folders,
                    multiple: spec.multiple,
                    title: spec.fileInputTitle
                });
                this._extraButtonSpecs[button.getButtonId()] = spec;
            },
            _initFormSupportAndParams: function() {
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore = this._createStore(this._options.request.params, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this._options.request.endpoint = this._formSupport.newEndpoint;
                    }
                } else {
                    this._paramsStore = this._createStore(this._options.request.params);
                }
            },
            _isDeletePossible: function() {
                if (!qq.DeleteFileAjaxRequester || !this._options.deleteFile.enabled) {
                    return false;
                }
                if (this._options.cors.expected) {
                    if (qq.supportedFeatures.deleteFileCorsXhr) {
                        return true;
                    }
                    if (qq.supportedFeatures.deleteFileCorsXdr && this._options.cors.allowXdr) {
                        return true;
                    }
                    return false;
                }
                return true;
            },
            _isAllowedExtension: function(allowed, fileName) {
                var valid = false;
                if (!allowed.length) {
                    return true;
                }
                qq.each(allowed, function(idx, allowedExt) {
                    if (qq.isString(allowedExt)) {
                        var extRegex = new RegExp("\\." + allowedExt + "$", "i");
                        if (fileName.match(extRegex) != null) {
                            valid = true;
                            return false;
                        }
                    }
                });
                return valid;
            },
            _itemError: function(code, maybeNameOrNames, item) {
                var message = this._options.messages[code], allowedExtensions = [], names = [].concat(maybeNameOrNames), name = names[0], buttonId = this._getButtonId(item), validationBase = this._getValidationBase(buttonId), extensionsForMessage, placeholderMatch;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                qq.each(validationBase.allowedExtensions, function(idx, allowedExtension) {
                    if (qq.isString(allowedExtension)) {
                        allowedExtensions.push(allowedExtension);
                    }
                });
                extensionsForMessage = allowedExtensions.join(", ").toLowerCase();
                r("{file}", this._options.formatFileName(name));
                r("{extensions}", extensionsForMessage);
                r("{sizeLimit}", this._formatSize(validationBase.sizeLimit));
                r("{minSizeLimit}", this._formatSize(validationBase.minSizeLimit));
                placeholderMatch = message.match(/(\{\w+\})/g);
                if (placeholderMatch !== null) {
                    qq.each(placeholderMatch, function(idx, placeholder) {
                        r(placeholder, names[idx]);
                    });
                }
                this._options.callbacks.onError(null, name, message, undefined);
                return message;
            },
            _manualRetry: function(id, callback) {
                if (this._onBeforeManualRetry(id)) {
                    this._netUploadedOrQueued++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    if (callback) {
                        callback(id);
                    } else {
                        this._handler.retry(id);
                    }
                    return true;
                }
            },
            _maybeAllComplete: function(id, status) {
                var self = this, notFinished = this._getNotFinished();
                if (status === qq.status.UPLOAD_SUCCESSFUL) {
                    this._succeededSinceLastAllComplete.push(id);
                } else if (status === qq.status.UPLOAD_FAILED) {
                    this._failedSinceLastAllComplete.push(id);
                }
                if (notFinished === 0 && (this._succeededSinceLastAllComplete.length || this._failedSinceLastAllComplete.length)) {
                    setTimeout(function() {
                        self._onAllComplete(self._succeededSinceLastAllComplete, self._failedSinceLastAllComplete);
                    }, 0);
                }
            },
            _maybeHandleIos8SafariWorkaround: function() {
                var self = this;
                if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
                    setTimeout(function() {
                        window.alert(self._options.messages.unsupportedBrowserIos8Safari);
                    }, 0);
                    throw new qq.Error(this._options.messages.unsupportedBrowserIos8Safari);
                }
            },
            _maybeParseAndSendUploadError: function(id, name, response, xhr) {
                if (!response.success) {
                    if (xhr && xhr.status !== 200 && !response.error) {
                        this._options.callbacks.onError(id, name, "XHR returned response code " + xhr.status, xhr);
                    } else {
                        var errorReason = response.error ? response.error : this._options.text.defaultResponseError;
                        this._options.callbacks.onError(id, name, errorReason, xhr);
                    }
                }
            },
            _maybeProcessNextItemAfterOnValidateCallback: function(validItem, items, index, params, endpoint) {
                var self = this;
                if (items.length > index) {
                    if (validItem || !this._options.validation.stopOnFirstInvalidFile) {
                        setTimeout(function() {
                            var validationDescriptor = self._getValidationDescriptor(items[index]), buttonId = self._getButtonId(items[index].file), button = self._getButton(buttonId);
                            self._handleCheckedCallback({
                                name: "onValidate",
                                callback: qq.bind(self._options.callbacks.onValidate, self, validationDescriptor, button),
                                onSuccess: qq.bind(self._onValidateCallbackSuccess, self, items, index, params, endpoint),
                                onFailure: qq.bind(self._onValidateCallbackFailure, self, items, index, params, endpoint),
                                identifier: "Item '" + validationDescriptor.name + "', size: " + validationDescriptor.size
                            });
                        }, 0);
                    } else if (!validItem) {
                        for (;index < items.length; index++) {
                            self._fileOrBlobRejected(items[index].id);
                        }
                    }
                }
            },
            _onAllComplete: function(successful, failed) {
                this._totalProgress && this._totalProgress.onAllComplete(successful, failed, this._preventRetries);
                this._options.callbacks.onAllComplete(qq.extend([], successful), qq.extend([], failed));
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
            },
            _onAutoRetry: function(id, name, responseJSON, xhr, callback) {
                var self = this;
                self._preventRetries[id] = responseJSON[self._options.retry.preventRetryResponseProperty];
                if (self._shouldAutoRetry(id)) {
                    var retryWaitPeriod = self._options.retry.autoAttemptDelay * 1e3;
                    self._maybeParseAndSendUploadError.apply(self, arguments);
                    self._options.callbacks.onAutoRetry(id, name, self._autoRetries[id]);
                    self._onBeforeAutoRetry(id, name);
                    self._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    self._retryTimeouts[id] = setTimeout(function() {
                        self.log("Starting retry for " + name + "...");
                        if (callback) {
                            callback(id);
                        } else {
                            self._handler.retry(id);
                        }
                    }, retryWaitPeriod);
                    return true;
                }
            },
            _onBeforeAutoRetry: function(id, name) {
                this.log("Waiting " + this._options.retry.autoAttemptDelay + " seconds before retrying " + name + "...");
            },
            _onBeforeManualRetry: function(id) {
                var itemLimit = this._currentItemLimit, fileName;
                if (this._preventRetries[id]) {
                    this.log("Retries are forbidden for id " + id, "warn");
                    return false;
                } else if (this._handler.isValid(id)) {
                    fileName = this.getName(id);
                    if (this._options.callbacks.onManualRetry(id, fileName) === false) {
                        return false;
                    }
                    if (itemLimit > 0 && this._netUploadedOrQueued + 1 > itemLimit) {
                        this._itemError("retryFailTooManyItems");
                        return false;
                    }
                    this.log("Retrying upload for '" + fileName + "' (id: " + id + ")...");
                    return true;
                } else {
                    this.log("'" + id + "' is not a valid file ID", "error");
                    return false;
                }
            },
            _onCancel: function(id, name) {
                this._netUploadedOrQueued--;
                clearTimeout(this._retryTimeouts[id]);
                var storedItemIndex = qq.indexOf(this._storedIds, id);
                if (!this._options.autoUpload && storedItemIndex >= 0) {
                    this._storedIds.splice(storedItemIndex, 1);
                }
                this._uploadData.setStatus(id, qq.status.CANCELED);
            },
            _onComplete: function(id, name, result, xhr) {
                if (!result.success) {
                    this._netUploadedOrQueued--;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_FAILED);
                    if (result[this._options.retry.preventRetryResponseProperty] === true) {
                        this._preventRetries[id] = true;
                    }
                } else {
                    if (result.thumbnailUrl) {
                        this._thumbnailUrls[id] = result.thumbnailUrl;
                    }
                    this._netUploaded++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_SUCCESSFUL);
                }
                this._maybeParseAndSendUploadError(id, name, result, xhr);
                return result.success ? true : false;
            },
            _onDelete: function(id) {
                this._uploadData.setStatus(id, qq.status.DELETING);
            },
            _onDeleteComplete: function(id, xhrOrXdr, isError) {
                var name = this.getName(id);
                if (isError) {
                    this._handleDeleteFailed(id, xhrOrXdr);
                } else {
                    this._handleDeleteSuccess(id);
                }
            },
            _onInputChange: function(input) {
                var fileIndex;
                if (qq.supportedFeatures.ajaxUploading) {
                    for (fileIndex = 0; fileIndex < input.files.length; fileIndex++) {
                        this._annotateWithButtonId(input.files[fileIndex], input);
                    }
                    this.addFiles(input.files);
                } else if (input.value.length > 0) {
                    this.addFiles(input);
                }
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
            },
            _onProgress: function(id, name, loaded, total) {
                this._totalProgress && this._totalProgress.onIndividualProgress(id, loaded, total);
            },
            _onSubmit: function(id, name) {},
            _onSubmitCallbackSuccess: function(id, name) {
                this._onSubmit.apply(this, arguments);
                this._uploadData.setStatus(id, qq.status.SUBMITTED);
                this._onSubmitted.apply(this, arguments);
                if (this._options.autoUpload) {
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                    this._uploadFile(id);
                } else {
                    this._storeForLater(id);
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                }
            },
            _onSubmitDelete: function(id, onSuccessCallback, additionalMandatedParams) {
                var uuid = this.getUuid(id), adjustedOnSuccessCallback;
                if (onSuccessCallback) {
                    adjustedOnSuccessCallback = qq.bind(onSuccessCallback, this, id, uuid, additionalMandatedParams);
                }
                if (this._isDeletePossible()) {
                    this._handleCheckedCallback({
                        name: "onSubmitDelete",
                        callback: qq.bind(this._options.callbacks.onSubmitDelete, this, id),
                        onSuccess: adjustedOnSuccessCallback || qq.bind(this._deleteHandler.sendDelete, this, id, uuid, additionalMandatedParams),
                        identifier: id
                    });
                    return true;
                } else {
                    this.log("Delete request ignored for ID " + id + ", delete feature is disabled or request not possible " + "due to CORS on a user agent that does not support pre-flighting.", "warn");
                    return false;
                }
            },
            _onSubmitted: function(id) {},
            _onTotalProgress: function(loaded, total) {
                this._options.callbacks.onTotalProgress(loaded, total);
            },
            _onUploadPrep: function(id) {},
            _onUpload: function(id, name) {
                this._uploadData.setStatus(id, qq.status.UPLOADING);
            },
            _onUploadChunk: function(id, chunkData) {},
            _onUploadChunkSuccess: function(id, chunkData) {
                if (!this._preventRetries[id] && this._options.retry.enableAuto) {
                    this._autoRetries[id] = 0;
                }
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.PAUSED) {
                    clearTimeout(this._retryTimeouts[id]);
                }
            },
            _onValidateBatchCallbackFailure: function(fileWrappers) {
                var self = this;
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    self._fileOrBlobRejected(fileWrapper.id);
                });
            },
            _onValidateBatchCallbackSuccess: function(validationDescriptors, items, params, endpoint, button) {
                var errorMessage, itemLimit = this._currentItemLimit, proposedNetFilesUploadedOrQueued = this._netUploadedOrQueued;
                if (itemLimit === 0 || proposedNetFilesUploadedOrQueued <= itemLimit) {
                    if (items.length > 0) {
                        this._handleCheckedCallback({
                            name: "onValidate",
                            callback: qq.bind(this._options.callbacks.onValidate, this, validationDescriptors[0], button),
                            onSuccess: qq.bind(this._onValidateCallbackSuccess, this, items, 0, params, endpoint),
                            onFailure: qq.bind(this._onValidateCallbackFailure, this, items, 0, params, endpoint),
                            identifier: "Item '" + items[0].file.name + "', size: " + items[0].file.size
                        });
                    } else {
                        this._itemError("noFilesError");
                    }
                } else {
                    this._onValidateBatchCallbackFailure(items);
                    errorMessage = this._options.messages.tooManyItemsError.replace(/\{netItems\}/g, proposedNetFilesUploadedOrQueued).replace(/\{itemLimit\}/g, itemLimit);
                    this._batchError(errorMessage);
                }
            },
            _onValidateCallbackFailure: function(items, index, params, endpoint) {
                var nextIndex = index + 1;
                this._fileOrBlobRejected(items[index].id, items[index].file.name);
                this._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
            },
            _onValidateCallbackSuccess: function(items, index, params, endpoint) {
                var self = this, nextIndex = index + 1, validationDescriptor = this._getValidationDescriptor(items[index]);
                this._validateFileOrBlobData(items[index], validationDescriptor).then(function() {
                    self._upload(items[index].id, params, endpoint);
                    self._maybeProcessNextItemAfterOnValidateCallback(true, items, nextIndex, params, endpoint);
                }, function() {
                    self._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
                });
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                if (items.length === 0) {
                    this._itemError("noFilesError");
                    return;
                }
                var validationDescriptors = this._getValidationDescriptors(items), buttonId = this._getButtonId(items[0].file), button = this._getButton(buttonId);
                this._handleCheckedCallback({
                    name: "onValidateBatch",
                    callback: qq.bind(this._options.callbacks.onValidateBatch, this, validationDescriptors, button),
                    onSuccess: qq.bind(this._onValidateBatchCallbackSuccess, this, validationDescriptors, items, params, endpoint, button),
                    onFailure: qq.bind(this._onValidateBatchCallbackFailure, this, items),
                    identifier: "batch validation"
                });
            },
            _preventLeaveInProgress: function() {
                var self = this;
                this._disposeSupport.attach(window, "beforeunload", function(e) {
                    if (self.getInProgress()) {
                        e = e || window.event;
                        e.returnValue = self._options.messages.onLeave;
                        return self._options.messages.onLeave;
                    }
                });
            },
            _refreshSessionData: function() {
                var self = this, options = this._options.session;
                if (qq.Session && this._options.session.endpoint != null) {
                    if (!this._session) {
                        qq.extend(options, {
                            cors: this._options.cors
                        });
                        options.log = qq.bind(this.log, this);
                        options.addFileRecord = qq.bind(this._addCannedFile, this);
                        this._session = new qq.Session(options);
                    }
                    setTimeout(function() {
                        self._session.refresh().then(function(response, xhrOrXdr) {
                            self._sessionRequestComplete();
                            self._options.callbacks.onSessionRequestComplete(response, true, xhrOrXdr);
                        }, function(response, xhrOrXdr) {
                            self._options.callbacks.onSessionRequestComplete(response, false, xhrOrXdr);
                        });
                    }, 0);
                }
            },
            _sessionRequestComplete: function() {},
            _setSize: function(id, newSize) {
                this._uploadData.updateSize(id, newSize);
                this._totalProgress && this._totalProgress.onNewSize(id);
            },
            _shouldAutoRetry: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!this._preventRetries[id] && this._options.retry.enableAuto && uploadData.status !== qq.status.PAUSED) {
                    if (this._autoRetries[id] === undefined) {
                        this._autoRetries[id] = 0;
                    }
                    if (this._autoRetries[id] < this._options.retry.maxAutoAttempts) {
                        this._autoRetries[id] += 1;
                        return true;
                    }
                }
                return false;
            },
            _storeForLater: function(id) {
                this._storedIds.push(id);
            },
            _trackButton: function(id) {
                var buttonId;
                if (qq.supportedFeatures.ajaxUploading) {
                    buttonId = this._handler.getFile(id).qqButtonId;
                } else {
                    buttonId = this._getButtonId(this._handler.getInput(id));
                }
                if (buttonId) {
                    this._buttonIdsForFileIds[id] = buttonId;
                }
            },
            _updateFormSupportAndParams: function(formElementOrId) {
                this._options.form.element = formElementOrId;
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore.addReadOnly(null, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this.setEndpoint(this._formSupport.newEndpoint);
                    }
                }
            },
            _upload: function(id, params, endpoint) {
                var name = this.getName(id);
                if (params) {
                    this.setParams(params, id);
                }
                if (endpoint) {
                    this.setEndpoint(endpoint, id);
                }
                this._handleCheckedCallback({
                    name: "onSubmit",
                    callback: qq.bind(this._options.callbacks.onSubmit, this, id, name),
                    onSuccess: qq.bind(this._onSubmitCallbackSuccess, this, id, name),
                    onFailure: qq.bind(this._fileOrBlobRejected, this, id, name),
                    identifier: id
                });
            },
            _uploadFile: function(id) {
                if (!this._handler.upload(id)) {
                    this._uploadData.setStatus(id, qq.status.QUEUED);
                }
            },
            _uploadStoredFiles: function() {
                var idToUpload, stillSubmitting, self = this;
                while (this._storedIds.length) {
                    idToUpload = this._storedIds.shift();
                    this._uploadFile(idToUpload);
                }
                stillSubmitting = this.getUploads({
                    status: qq.status.SUBMITTING
                }).length;
                if (stillSubmitting) {
                    qq.log("Still waiting for " + stillSubmitting + " files to clear submit queue. Will re-parse stored IDs array shortly.");
                    setTimeout(function() {
                        self._uploadStoredFiles();
                    }, 1e3);
                }
            },
            _validateFileOrBlobData: function(fileWrapper, validationDescriptor) {
                var self = this, file = function() {
                    if (fileWrapper.file instanceof qq.BlobProxy) {
                        return fileWrapper.file.referenceBlob;
                    }
                    return fileWrapper.file;
                }(), name = validationDescriptor.name, size = validationDescriptor.size, buttonId = this._getButtonId(fileWrapper.file), validationBase = this._getValidationBase(buttonId), validityChecker = new qq.Promise();
                validityChecker.then(function() {}, function() {
                    self._fileOrBlobRejected(fileWrapper.id, name);
                });
                if (qq.isFileOrInput(file) && !this._isAllowedExtension(validationBase.allowedExtensions, name)) {
                    this._itemError("typeError", name, file);
                    return validityChecker.failure();
                }
                if (!this._options.validation.allowEmpty && size === 0) {
                    this._itemError("emptyError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && validationBase.sizeLimit && size > validationBase.sizeLimit) {
                    this._itemError("sizeError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && size < validationBase.minSizeLimit) {
                    this._itemError("minSizeError", name, file);
                    return validityChecker.failure();
                }
                if (qq.ImageValidation && qq.supportedFeatures.imagePreviews && qq.isFile(file)) {
                    new qq.ImageValidation(file, qq.bind(self.log, self)).validate(validationBase.image).then(validityChecker.success, function(errorCode) {
                        self._itemError(errorCode + "ImageError", name, file);
                        validityChecker.failure();
                    });
                } else {
                    validityChecker.success();
                }
                return validityChecker;
            },
            _wrapCallbacks: function() {
                var self, safeCallback, prop;
                self = this;
                safeCallback = function(name, callback, args) {
                    var errorMsg;
                    try {
                        return callback.apply(self, args);
                    } catch (exception) {
                        errorMsg = exception.message || exception.toString();
                        self.log("Caught exception in '" + name + "' callback - " + errorMsg, "error");
                    }
                };
                for (prop in this._options.callbacks) {
                    (function() {
                        var callbackName, callbackFunc;
                        callbackName = prop;
                        callbackFunc = self._options.callbacks[callbackName];
                        self._options.callbacks[callbackName] = function() {
                            return safeCallback(callbackName, callbackFunc, arguments);
                        };
                    })();
                }
            }
        };
    })();
    (function() {
        "use strict";
        qq.FineUploaderBasic = function(o) {
            var self = this;
            this._options = {
                debug: false,
                button: null,
                multiple: true,
                maxConnections: 3,
                disableCancelForFormUploads: false,
                autoUpload: true,
                warnBeforeUnload: true,
                request: {
                    customHeaders: {},
                    endpoint: "/server/upload",
                    filenameParam: "qqfilename",
                    forceMultipart: true,
                    inputName: "qqfile",
                    method: "POST",
                    omitDefaultParams: false,
                    params: {},
                    paramsInBody: true,
                    requireSuccessJson: true,
                    totalFileSizeName: "qqtotalfilesize",
                    uuidName: "qquuid"
                },
                validation: {
                    allowedExtensions: [],
                    sizeLimit: 0,
                    minSizeLimit: 0,
                    itemLimit: 0,
                    stopOnFirstInvalidFile: true,
                    acceptFiles: null,
                    image: {
                        maxHeight: 0,
                        maxWidth: 0,
                        minHeight: 0,
                        minWidth: 0
                    },
                    allowEmpty: false
                },
                callbacks: {
                    onSubmit: function(id, name) {},
                    onSubmitted: function(id, name) {},
                    onComplete: function(id, name, responseJSON, maybeXhr) {},
                    onAllComplete: function(successful, failed) {},
                    onCancel: function(id, name) {},
                    onUpload: function(id, name) {},
                    onUploadChunk: function(id, name, chunkData) {},
                    onUploadChunkSuccess: function(id, chunkData, responseJSON, xhr) {},
                    onResume: function(id, fileName, chunkData, customResumeData) {},
                    onProgress: function(id, name, loaded, total) {},
                    onTotalProgress: function(loaded, total) {},
                    onError: function(id, name, reason, maybeXhrOrXdr) {},
                    onAutoRetry: function(id, name, attemptNumber) {},
                    onManualRetry: function(id, name) {},
                    onValidateBatch: function(fileOrBlobData) {},
                    onValidate: function(fileOrBlobData) {},
                    onSubmitDelete: function(id) {},
                    onDelete: function(id) {},
                    onDeleteComplete: function(id, xhrOrXdr, isError) {},
                    onPasteReceived: function(blob) {},
                    onStatusChange: function(id, oldStatus, newStatus) {},
                    onSessionRequestComplete: function(response, success, xhrOrXdr) {}
                },
                messages: {
                    typeError: "{file} has an invalid extension. Valid extension(s): {extensions}.",
                    sizeError: "{file} is too large, maximum file size is {sizeLimit}.",
                    minSizeError: "{file} is too small, minimum file size is {minSizeLimit}.",
                    emptyError: "{file} is empty, please select files again without it.",
                    noFilesError: "No files to upload.",
                    tooManyItemsError: "Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",
                    maxHeightImageError: "Image is too tall.",
                    maxWidthImageError: "Image is too wide.",
                    minHeightImageError: "Image is not tall enough.",
                    minWidthImageError: "Image is not wide enough.",
                    retryFailTooManyItems: "Retry failed - you have reached your file limit.",
                    onLeave: "The files are being uploaded, if you leave now the upload will be canceled.",
                    unsupportedBrowserIos8Safari: "Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."
                },
                retry: {
                    enableAuto: false,
                    maxAutoAttempts: 3,
                    autoAttemptDelay: 5,
                    preventRetryResponseProperty: "preventRetry"
                },
                classes: {
                    buttonHover: "qq-upload-button-hover",
                    buttonFocus: "qq-upload-button-focus"
                },
                chunking: {
                    enabled: false,
                    concurrent: {
                        enabled: false
                    },
                    mandatory: false,
                    paramNames: {
                        partIndex: "qqpartindex",
                        partByteOffset: "qqpartbyteoffset",
                        chunkSize: "qqchunksize",
                        totalFileSize: "qqtotalfilesize",
                        totalParts: "qqtotalparts"
                    },
                    partSize: function(id) {
                        return 2e6;
                    },
                    success: {
                        endpoint: null,
                        headers: function(id) {
                            return null;
                        },
                        jsonPayload: false,
                        method: "POST",
                        params: function(id) {
                            return null;
                        },
                        resetOnStatus: []
                    }
                },
                resume: {
                    enabled: false,
                    recordsExpireIn: 7,
                    paramNames: {
                        resuming: "qqresume"
                    },
                    customKeys: function(fileId) {
                        return [];
                    }
                },
                formatFileName: function(fileOrBlobName) {
                    return fileOrBlobName;
                },
                text: {
                    defaultResponseError: "Upload failure reason unknown",
                    fileInputTitle: "file input",
                    sizeSymbols: [ "kB", "MB", "GB", "TB", "PB", "EB" ]
                },
                deleteFile: {
                    enabled: false,
                    method: "DELETE",
                    endpoint: "/server/upload",
                    customHeaders: {},
                    params: {}
                },
                cors: {
                    expected: false,
                    sendCredentials: false,
                    allowXdr: false
                },
                blobs: {
                    defaultName: "misc_data"
                },
                paste: {
                    targetElement: null,
                    defaultName: "pasted_image"
                },
                camera: {
                    ios: false,
                    button: null
                },
                extraButtons: [],
                session: {
                    endpoint: null,
                    params: {},
                    customHeaders: {},
                    refreshOnReset: true
                },
                form: {
                    element: "qq-form",
                    autoUpload: false,
                    interceptSubmit: true
                },
                scaling: {
                    customResizer: null,
                    sendOriginal: true,
                    orient: true,
                    defaultType: null,
                    defaultQuality: 80,
                    failureText: "Failed to scale",
                    includeExif: false,
                    sizes: []
                },
                workarounds: {
                    iosEmptyVideos: true,
                    ios8SafariUploads: true,
                    ios8BrowserCrash: false
                }
            };
            qq.extend(this._options, o, true);
            this._buttons = [];
            this._extraButtonSpecs = {};
            this._buttonIdsForFileIds = [];
            this._wrapCallbacks();
            this._disposeSupport = new qq.DisposeSupport();
            this._storedIds = [];
            this._autoRetries = [];
            this._retryTimeouts = [];
            this._preventRetries = [];
            this._thumbnailUrls = [];
            this._netUploadedOrQueued = 0;
            this._netUploaded = 0;
            this._uploadData = this._createUploadDataTracker();
            this._initFormSupportAndParams();
            this._customHeadersStore = this._createStore(this._options.request.customHeaders);
            this._deleteFileCustomHeadersStore = this._createStore(this._options.deleteFile.customHeaders);
            this._deleteFileParamsStore = this._createStore(this._options.deleteFile.params);
            this._endpointStore = this._createStore(this._options.request.endpoint);
            this._deleteFileEndpointStore = this._createStore(this._options.deleteFile.endpoint);
            this._handler = this._createUploadHandler();
            this._deleteHandler = qq.DeleteFileAjaxRequester && this._createDeleteHandler();
            if (this._options.button) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._options.button,
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._generateExtraButtonSpecs();
            this._handleCameraAccess();
            if (this._options.paste.targetElement) {
                if (qq.PasteSupport) {
                    this._pasteHandler = this._createPasteHandler();
                } else {
                    this.log("Paste support module not found", "error");
                }
            }
            this._options.warnBeforeUnload && this._preventLeaveInProgress();
            this._imageGenerator = qq.ImageGenerator && new qq.ImageGenerator(qq.bind(this.log, this));
            this._refreshSessionData();
            this._succeededSinceLastAllComplete = [];
            this._failedSinceLastAllComplete = [];
            this._scaler = qq.Scaler && new qq.Scaler(this._options.scaling, qq.bind(this.log, this)) || {};
            if (this._scaler.enabled) {
                this._customNewFileHandler = qq.bind(this._scaler.handleNewFile, this._scaler);
            }
            if (qq.TotalProgress && qq.supportedFeatures.progressBar) {
                this._totalProgress = new qq.TotalProgress(qq.bind(this._onTotalProgress, this), function(id) {
                    var entry = self._uploadData.retrieve({
                        id: id
                    });
                    return entry && entry.size || 0;
                });
            }
            this._currentItemLimit = this._options.validation.itemLimit;
            this._customResumeDataStore = this._createStore();
        };
        qq.FineUploaderBasic.prototype = qq.basePublicApi;
        qq.extend(qq.FineUploaderBasic.prototype, qq.basePrivateApi);
    })();
    qq.AjaxRequester = function(o) {
        "use strict";
        var log, shouldParamsBeInQueryString, queue = [], requestData = {}, options = {
            acceptHeader: null,
            validMethods: [ "PATCH", "POST", "PUT" ],
            method: "POST",
            contentType: "application/x-www-form-urlencoded",
            maxConnections: 3,
            customHeaders: {},
            endpointStore: {},
            paramsStore: {},
            mandatedParams: {},
            allowXRequestedWithAndCacheControl: true,
            successfulResponseCodes: {
                DELETE: [ 200, 202, 204 ],
                PATCH: [ 200, 201, 202, 203, 204 ],
                POST: [ 200, 201, 202, 203, 204 ],
                PUT: [ 200, 201, 202, 203, 204 ],
                GET: [ 200 ]
            },
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onSend: function(id) {},
            onComplete: function(id, xhrOrXdr, isError) {},
            onProgress: null
        };
        qq.extend(options, o);
        log = options.log;
        if (qq.indexOf(options.validMethods, options.method) < 0) {
            throw new Error("'" + options.method + "' is not a supported method for this type of request!");
        }
        function isSimpleMethod() {
            return qq.indexOf([ "GET", "POST", "HEAD" ], options.method) >= 0;
        }
        function containsNonSimpleHeaders(headers) {
            var containsNonSimple = false;
            qq.each(containsNonSimple, function(idx, header) {
                if (qq.indexOf([ "Accept", "Accept-Language", "Content-Language", "Content-Type" ], header) < 0) {
                    containsNonSimple = true;
                    return false;
                }
            });
            return containsNonSimple;
        }
        function isXdr(xhr) {
            return options.cors.expected && xhr.withCredentials === undefined;
        }
        function getCorsAjaxTransport() {
            var xhrOrXdr;
            if (window.XMLHttpRequest || window.ActiveXObject) {
                xhrOrXdr = qq.createXhrInstance();
                if (xhrOrXdr.withCredentials === undefined) {
                    xhrOrXdr = new XDomainRequest();
                    xhrOrXdr.onload = function() {};
                    xhrOrXdr.onerror = function() {};
                    xhrOrXdr.ontimeout = function() {};
                    xhrOrXdr.onprogress = function() {};
                }
            }
            return xhrOrXdr;
        }
        function getXhrOrXdr(id, suppliedXhr) {
            var xhrOrXdr = requestData[id] && requestData[id].xhr;
            if (!xhrOrXdr) {
                if (suppliedXhr) {
                    xhrOrXdr = suppliedXhr;
                } else {
                    if (options.cors.expected) {
                        xhrOrXdr = getCorsAjaxTransport();
                    } else {
                        xhrOrXdr = qq.createXhrInstance();
                    }
                }
                requestData[id].xhr = xhrOrXdr;
            }
            return xhrOrXdr;
        }
        function dequeue(id) {
            var i = qq.indexOf(queue, id), max = options.maxConnections, nextId;
            delete requestData[id];
            queue.splice(i, 1);
            if (queue.length >= max && i < max) {
                nextId = queue[max - 1];
                sendRequest(nextId);
            }
        }
        function onComplete(id, xdrError) {
            var xhr = getXhrOrXdr(id), method = options.method, isError = xdrError === true;
            dequeue(id);
            if (isError) {
                log(method + " request for " + id + " has failed", "error");
            } else if (!isXdr(xhr) && !isResponseSuccessful(xhr.status)) {
                isError = true;
                log(method + " request for " + id + " has failed - response code " + xhr.status, "error");
            }
            options.onComplete(id, xhr, isError);
        }
        function getParams(id) {
            var onDemandParams = requestData[id].additionalParams, mandatedParams = options.mandatedParams, params;
            if (options.paramsStore.get) {
                params = options.paramsStore.get(id);
            }
            if (onDemandParams) {
                qq.each(onDemandParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            if (mandatedParams) {
                qq.each(mandatedParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            return params;
        }
        function sendRequest(id, optXhr) {
            var xhr = getXhrOrXdr(id, optXhr), method = options.method, params = getParams(id), payload = requestData[id].payload, url;
            options.onSend(id);
            url = createUrl(id, params, requestData[id].additionalQueryParams);
            if (isXdr(xhr)) {
                xhr.onload = getXdrLoadHandler(id);
                xhr.onerror = getXdrErrorHandler(id);
            } else {
                xhr.onreadystatechange = getXhrReadyStateChangeHandler(id);
            }
            registerForUploadProgress(id);
            xhr.open(method, url, true);
            if (options.cors.expected && options.cors.sendCredentials && !isXdr(xhr)) {
                xhr.withCredentials = true;
            }
            setHeaders(id);
            log("Sending " + method + " request for " + id);
            if (payload) {
                xhr.send(payload);
            } else if (shouldParamsBeInQueryString || !params) {
                xhr.send();
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded") >= 0) {
                xhr.send(qq.obj2url(params, ""));
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/json") >= 0) {
                xhr.send(JSON.stringify(params));
            } else {
                xhr.send(params);
            }
            return xhr;
        }
        function createUrl(id, params, additionalQueryParams) {
            var endpoint = options.endpointStore.get(id), addToPath = requestData[id].addToPath;
            if (addToPath != undefined) {
                endpoint += "/" + addToPath;
            }
            if (shouldParamsBeInQueryString && params) {
                endpoint = qq.obj2url(params, endpoint);
            }
            if (additionalQueryParams) {
                endpoint = qq.obj2url(additionalQueryParams, endpoint);
            }
            return endpoint;
        }
        function getXhrReadyStateChangeHandler(id) {
            return function() {
                if (getXhrOrXdr(id).readyState === 4) {
                    onComplete(id);
                }
            };
        }
        function registerForUploadProgress(id) {
            var onProgress = options.onProgress;
            if (onProgress) {
                getXhrOrXdr(id).upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        onProgress(id, e.loaded, e.total);
                    }
                };
            }
        }
        function getXdrLoadHandler(id) {
            return function() {
                onComplete(id);
            };
        }
        function getXdrErrorHandler(id) {
            return function() {
                onComplete(id, true);
            };
        }
        function setHeaders(id) {
            var xhr = getXhrOrXdr(id), customHeaders = options.customHeaders, onDemandHeaders = requestData[id].additionalHeaders || {}, method = options.method, allHeaders = {};
            if (!isXdr(xhr)) {
                options.acceptHeader && xhr.setRequestHeader("Accept", options.acceptHeader);
                if (options.allowXRequestedWithAndCacheControl) {
                    if (!options.cors.expected || (!isSimpleMethod() || containsNonSimpleHeaders(customHeaders))) {
                        xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                        xhr.setRequestHeader("Cache-Control", "no-cache");
                    }
                }
                if (options.contentType && (method === "POST" || method === "PUT")) {
                    xhr.setRequestHeader("Content-Type", options.contentType);
                }
                qq.extend(allHeaders, qq.isFunction(customHeaders) ? customHeaders(id) : customHeaders);
                qq.extend(allHeaders, onDemandHeaders);
                qq.each(allHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        }
        function isResponseSuccessful(responseCode) {
            return qq.indexOf(options.successfulResponseCodes[options.method], responseCode) >= 0;
        }
        function prepareToSend(id, optXhr, addToPath, additionalParams, additionalQueryParams, additionalHeaders, payload) {
            requestData[id] = {
                addToPath: addToPath,
                additionalParams: additionalParams,
                additionalQueryParams: additionalQueryParams,
                additionalHeaders: additionalHeaders,
                payload: payload
            };
            var len = queue.push(id);
            if (len <= options.maxConnections) {
                return sendRequest(id, optXhr);
            }
        }
        shouldParamsBeInQueryString = options.method === "GET" || options.method === "DELETE";
        qq.extend(this, {
            initTransport: function(id) {
                var path, params, headers, payload, cacheBuster, additionalQueryParams;
                return {
                    withPath: function(appendToPath) {
                        path = appendToPath;
                        return this;
                    },
                    withParams: function(additionalParams) {
                        params = additionalParams;
                        return this;
                    },
                    withQueryParams: function(_additionalQueryParams_) {
                        additionalQueryParams = _additionalQueryParams_;
                        return this;
                    },
                    withHeaders: function(additionalHeaders) {
                        headers = additionalHeaders;
                        return this;
                    },
                    withPayload: function(thePayload) {
                        payload = thePayload;
                        return this;
                    },
                    withCacheBuster: function() {
                        cacheBuster = true;
                        return this;
                    },
                    send: function(optXhr) {
                        if (cacheBuster && qq.indexOf([ "GET", "DELETE" ], options.method) >= 0) {
                            params.qqtimestamp = new Date().getTime();
                        }
                        return prepareToSend(id, optXhr, path, params, additionalQueryParams, headers, payload);
                    }
                };
            },
            canceled: function(id) {
                dequeue(id);
            }
        });
    };
    qq.UploadHandler = function(spec) {
        "use strict";
        var proxy = spec.proxy, fileState = {}, onCancel = proxy.onCancel, getName = proxy.getName;
        qq.extend(this, {
            add: function(id, fileItem) {
                fileState[id] = fileItem;
                fileState[id].temp = {};
            },
            cancel: function(id) {
                var self = this, cancelFinalizationEffort = new qq.Promise(), onCancelRetVal = onCancel(id, getName(id), cancelFinalizationEffort);
                onCancelRetVal.then(function() {
                    if (self.isValid(id)) {
                        fileState[id].canceled = true;
                        self.expunge(id);
                    }
                    cancelFinalizationEffort.success();
                });
            },
            expunge: function(id) {
                delete fileState[id];
            },
            getThirdPartyFileId: function(id) {
                return fileState[id].key;
            },
            isValid: function(id) {
                return fileState[id] !== undefined;
            },
            reset: function() {
                fileState = {};
            },
            _getFileState: function(id) {
                return fileState[id];
            },
            _setThirdPartyFileId: function(id, thirdPartyFileId) {
                fileState[id].key = thirdPartyFileId;
            },
            _wasCanceled: function(id) {
                return !!fileState[id].canceled;
            }
        });
    };
    qq.UploadHandlerController = function(o, namespace) {
        "use strict";
        var controller = this, chunkingPossible = false, concurrentChunkingPossible = false, chunking, preventRetryResponse, log, handler, options = {
            paramsStore: {},
            maxConnections: 3,
            chunking: {
                enabled: false,
                multiple: {
                    enabled: false
                }
            },
            log: function(str, level) {},
            onProgress: function(id, fileName, loaded, total) {},
            onComplete: function(id, fileName, response, xhr) {},
            onCancel: function(id, fileName) {},
            onUploadPrep: function(id) {},
            onUpload: function(id, fileName) {},
            onUploadChunk: function(id, fileName, chunkData) {},
            onUploadChunkSuccess: function(id, chunkData, response, xhr) {},
            onAutoRetry: function(id, fileName, response, xhr) {},
            onResume: function(id, fileName, chunkData, customResumeData) {},
            onUuidChanged: function(id, newUuid) {},
            getName: function(id) {},
            setSize: function(id, newSize) {},
            isQueued: function(id) {},
            getIdsInProxyGroup: function(id) {},
            getIdsInBatch: function(id) {},
            isInProgress: function(id) {}
        }, chunked = {
            done: function(id, chunkIdx, response, xhr) {
                var chunkData = handler._getChunkData(id, chunkIdx);
                handler._getFileState(id).attemptingResume = false;
                delete handler._getFileState(id).temp.chunkProgress[chunkIdx];
                handler._getFileState(id).loaded += chunkData.size;
                options.onUploadChunkSuccess(id, handler._getChunkDataForCallback(chunkData), response, xhr);
            },
            finalize: function(id) {
                var size = options.getSize(id), name = options.getName(id);
                log("All chunks have been uploaded for " + id + " - finalizing....");
                handler.finalizeChunks(id).then(function(response, xhr) {
                    log("Finalize successful for " + id);
                    var normaizedResponse = upload.normalizeResponse(response, true);
                    options.onProgress(id, name, size, size);
                    handler._maybeDeletePersistedChunkData(id);
                    upload.cleanup(id, normaizedResponse, xhr);
                }, function(response, xhr) {
                    var normalizedResponse = upload.normalizeResponse(response, false);
                    log("Problem finalizing chunks for file ID " + id + " - " + normalizedResponse.error, "error");
                    if (normalizedResponse.reset || xhr && options.chunking.success.resetOnStatus.indexOf(xhr.status) >= 0) {
                        chunked.reset(id);
                    }
                    if (!options.onAutoRetry(id, name, normalizedResponse, xhr)) {
                        upload.cleanup(id, normalizedResponse, xhr);
                    }
                });
            },
            handleFailure: function(chunkIdx, id, response, xhr) {
                var name = options.getName(id);
                log("Chunked upload request failed for " + id + ", chunk " + chunkIdx);
                handler.clearCachedChunk(id, chunkIdx);
                var responseToReport = upload.normalizeResponse(response, false), inProgressIdx;
                if (responseToReport.reset) {
                    chunked.reset(id);
                } else {
                    var inProgressChunksArray = handler._getFileState(id).chunking.inProgress;
                    inProgressIdx = inProgressChunksArray ? qq.indexOf(inProgressChunksArray, chunkIdx) : -1;
                    if (inProgressIdx >= 0) {
                        handler._getFileState(id).chunking.inProgress.splice(inProgressIdx, 1);
                        handler._getFileState(id).chunking.remaining.unshift(chunkIdx);
                    }
                }
                if (!handler._getFileState(id).temp.ignoreFailure) {
                    if (concurrentChunkingPossible) {
                        handler._getFileState(id).temp.ignoreFailure = true;
                        log(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.", JSON.stringify(Object.keys(handler._getXhrs(id))), JSON.stringify(handler._getFileState(id).chunking.inProgress)));
                        qq.each(handler._getXhrs(id), function(ckid, ckXhr) {
                            log(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ", id, ckid, ckXhr.readyState));
                            ckXhr.abort();
                            ckXhr._cancelled = true;
                        });
                        handler.moveInProgressToRemaining(id);
                        connectionManager.free(id, true);
                    }
                    if (!options.onAutoRetry(id, name, responseToReport, xhr)) {
                        upload.cleanup(id, responseToReport, xhr);
                    }
                }
            },
            hasMoreParts: function(id) {
                return !!handler._getFileState(id).chunking.remaining.length;
            },
            nextPart: function(id) {
                var nextIdx = handler._getFileState(id).chunking.remaining.shift();
                if (nextIdx >= handler._getTotalChunks(id)) {
                    nextIdx = null;
                }
                return nextIdx;
            },
            reset: function(id) {
                log("Server or callback has ordered chunking effort to be restarted on next attempt for item ID " + id, "error");
                handler._maybeDeletePersistedChunkData(id);
                handler.reevaluateChunking(id);
                handler._getFileState(id).loaded = 0;
                handler._getFileState(id).attemptingResume = false;
            },
            sendNext: function(id) {
                var size = options.getSize(id), name = options.getName(id), chunkIdx = chunked.nextPart(id), chunkData = handler._getChunkData(id, chunkIdx), fileState = handler._getFileState(id), resuming = fileState.attemptingResume, inProgressChunks = fileState.chunking.inProgress || [];
                if (fileState.loaded == null) {
                    fileState.loaded = 0;
                }
                if (resuming && options.onResume(id, name, chunkData, fileState.customResumeData) === false) {
                    chunked.reset(id);
                    chunkIdx = chunked.nextPart(id);
                    chunkData = handler._getChunkData(id, chunkIdx);
                    resuming = false;
                }
                if (chunkIdx == null && inProgressChunks.length === 0) {
                    chunked.finalize(id);
                } else {
                    inProgressChunks.push(chunkIdx);
                    handler._getFileState(id).chunking.inProgress = inProgressChunks;
                    if (concurrentChunkingPossible) {
                        connectionManager.open(id, chunkIdx);
                    }
                    if (concurrentChunkingPossible && connectionManager.available() && handler._getFileState(id).chunking.remaining.length) {
                        chunked.sendNext(id);
                    }
                    if (chunkData.blob.size === 0) {
                        log(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.", chunkIdx, id), "error");
                        chunked.handleFailure(chunkIdx, id, "File is no longer available", null);
                    }
                    var onUploadChunkPromise = options.onUploadChunk(id, name, handler._getChunkDataForCallback(chunkData));
                    onUploadChunkPromise.then(function(requestOverrides) {
                        if (!options.isInProgress(id)) {
                            log(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.", id, chunkIdx));
                        } else {
                            log(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.", id, chunkIdx, chunkData.start + 1, chunkData.end, size));
                            var uploadChunkData = {
                                chunkIdx: chunkIdx,
                                id: id,
                                overrides: requestOverrides,
                                resuming: resuming
                            };
                            handler.uploadChunk(uploadChunkData).then(function success(response, xhr) {
                                log("Chunked upload request succeeded for " + id + ", chunk " + chunkIdx);
                                handler.clearCachedChunk(id, chunkIdx);
                                var inProgressChunks = handler._getFileState(id).chunking.inProgress || [], responseToReport = upload.normalizeResponse(response, true), inProgressChunkIdx = qq.indexOf(inProgressChunks, chunkIdx);
                                log(qq.format("Chunk {} for file {} uploaded successfully.", chunkIdx, id));
                                chunked.done(id, chunkIdx, responseToReport, xhr);
                                if (inProgressChunkIdx >= 0) {
                                    inProgressChunks.splice(inProgressChunkIdx, 1);
                                }
                                handler._maybePersistChunkedState(id);
                                if (!chunked.hasMoreParts(id) && inProgressChunks.length === 0) {
                                    chunked.finalize(id);
                                } else if (chunked.hasMoreParts(id)) {
                                    chunked.sendNext(id);
                                } else {
                                    log(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}", id, JSON.stringify(inProgressChunks)));
                                }
                            }, function failure(response, xhr) {
                                chunked.handleFailure(chunkIdx, id, response, xhr);
                            }).done(function() {
                                handler.clearXhr(id, chunkIdx);
                            });
                        }
                    }, function(error) {
                        chunked.handleFailure(chunkIdx, id, error, null);
                    });
                }
            }
        }, connectionManager = {
            _open: [],
            _openChunks: {},
            _waiting: [],
            available: function() {
                var max = options.maxConnections, openChunkEntriesCount = 0, openChunksCount = 0;
                qq.each(connectionManager._openChunks, function(fileId, openChunkIndexes) {
                    openChunkEntriesCount++;
                    openChunksCount += openChunkIndexes.length;
                });
                return max - (connectionManager._open.length - openChunkEntriesCount + openChunksCount);
            },
            free: function(id, dontAllowNext) {
                var allowNext = !dontAllowNext, waitingIndex = qq.indexOf(connectionManager._waiting, id), connectionsIndex = qq.indexOf(connectionManager._open, id), nextId;
                delete connectionManager._openChunks[id];
                if (upload.getProxyOrBlob(id) instanceof qq.BlobProxy) {
                    log("Generated blob upload has ended for " + id + ", disposing generated blob.");
                    delete handler._getFileState(id).file;
                }
                if (waitingIndex >= 0) {
                    connectionManager._waiting.splice(waitingIndex, 1);
                } else if (allowNext && connectionsIndex >= 0) {
                    connectionManager._open.splice(connectionsIndex, 1);
                    nextId = connectionManager._waiting.shift();
                    if (nextId >= 0) {
                        connectionManager._open.push(nextId);
                        upload.start(nextId);
                    }
                }
            },
            getWaitingOrConnected: function() {
                var waitingOrConnected = [];
                qq.each(connectionManager._openChunks, function(fileId, chunks) {
                    if (chunks && chunks.length) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                qq.each(connectionManager._open, function(idx, fileId) {
                    if (!connectionManager._openChunks[fileId]) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                waitingOrConnected = waitingOrConnected.concat(connectionManager._waiting);
                return waitingOrConnected;
            },
            isUsingConnection: function(id) {
                return qq.indexOf(connectionManager._open, id) >= 0;
            },
            open: function(id, chunkIdx) {
                if (chunkIdx == null) {
                    connectionManager._waiting.push(id);
                }
                if (connectionManager.available()) {
                    if (chunkIdx == null) {
                        connectionManager._waiting.pop();
                        connectionManager._open.push(id);
                    } else {
                        (function() {
                            var openChunksEntry = connectionManager._openChunks[id] || [];
                            openChunksEntry.push(chunkIdx);
                            connectionManager._openChunks[id] = openChunksEntry;
                        })();
                    }
                    return true;
                }
                return false;
            },
            reset: function() {
                connectionManager._waiting = [];
                connectionManager._open = [];
            }
        }, simple = {
            send: function(id, name) {
                var fileState = handler._getFileState(id);
                if (!fileState) {
                    log("Ignoring send request as this upload may have been cancelled, File ID " + id, "warn");
                    return;
                }
                fileState.loaded = 0;
                log("Sending simple upload request for " + id);
                handler.uploadFile(id).then(function(response, optXhr) {
                    log("Simple upload request succeeded for " + id);
                    var responseToReport = upload.normalizeResponse(response, true), size = options.getSize(id);
                    options.onProgress(id, name, size, size);
                    upload.maybeNewUuid(id, responseToReport);
                    upload.cleanup(id, responseToReport, optXhr);
                }, function(response, optXhr) {
                    log("Simple upload request failed for " + id);
                    var responseToReport = upload.normalizeResponse(response, false);
                    if (!options.onAutoRetry(id, name, responseToReport, optXhr)) {
                        upload.cleanup(id, responseToReport, optXhr);
                    }
                });
            }
        }, upload = {
            cancel: function(id) {
                log("Cancelling " + id);
                options.paramsStore.remove(id);
                connectionManager.free(id);
            },
            cleanup: function(id, response, optXhr) {
                var name = options.getName(id);
                options.onComplete(id, name, response, optXhr);
                if (handler._getFileState(id)) {
                    handler._clearXhrs && handler._clearXhrs(id);
                }
                connectionManager.free(id);
            },
            getProxyOrBlob: function(id) {
                return handler.getProxy && handler.getProxy(id) || handler.getFile && handler.getFile(id);
            },
            initHandler: function() {
                var handlerType = namespace ? qq[namespace] : qq.traditional, handlerModuleSubtype = qq.supportedFeatures.ajaxUploading ? "Xhr" : "Form";
                handler = new handlerType[handlerModuleSubtype + "UploadHandler"](options, {
                    getCustomResumeData: options.getCustomResumeData,
                    getDataByUuid: options.getDataByUuid,
                    getName: options.getName,
                    getSize: options.getSize,
                    getUuid: options.getUuid,
                    log: log,
                    onCancel: options.onCancel,
                    onProgress: options.onProgress,
                    onUuidChanged: options.onUuidChanged,
                    onFinalizing: function(id) {
                        options.setStatus(id, qq.status.UPLOAD_FINALIZING);
                    }
                });
                if (handler._removeExpiredChunkingRecords) {
                    handler._removeExpiredChunkingRecords();
                }
            },
            isDeferredEligibleForUpload: function(id) {
                return options.isQueued(id);
            },
            maybeDefer: function(id, blob) {
                if (blob && !handler.getFile(id) && blob instanceof qq.BlobProxy) {
                    options.onUploadPrep(id);
                    log("Attempting to generate a blob on-demand for " + id);
                    blob.create().then(function(generatedBlob) {
                        log("Generated an on-demand blob for " + id);
                        handler.updateBlob(id, generatedBlob);
                        options.setSize(id, generatedBlob.size);
                        handler.reevaluateChunking(id);
                        upload.maybeSendDeferredFiles(id);
                    }, function(errorMessage) {
                        var errorResponse = {};
                        if (errorMessage) {
                            errorResponse.error = errorMessage;
                        }
                        log(qq.format("Failed to generate blob for ID {}.  Error message: {}.", id, errorMessage), "error");
                        options.onComplete(id, options.getName(id), qq.extend(errorResponse, preventRetryResponse), null);
                        upload.maybeSendDeferredFiles(id);
                        connectionManager.free(id);
                    });
                } else {
                    return upload.maybeSendDeferredFiles(id);
                }
                return false;
            },
            maybeSendDeferredFiles: function(id) {
                var idsInGroup = options.getIdsInProxyGroup(id), uploadedThisId = false;
                if (idsInGroup && idsInGroup.length) {
                    log("Maybe ready to upload proxy group file " + id);
                    qq.each(idsInGroup, function(idx, idInGroup) {
                        if (upload.isDeferredEligibleForUpload(idInGroup) && !!handler.getFile(idInGroup)) {
                            uploadedThisId = idInGroup === id;
                            upload.now(idInGroup);
                        } else if (upload.isDeferredEligibleForUpload(idInGroup)) {
                            return false;
                        }
                    });
                } else {
                    uploadedThisId = true;
                    upload.now(id);
                }
                return uploadedThisId;
            },
            maybeNewUuid: function(id, response) {
                if (response.newUuid !== undefined) {
                    options.onUuidChanged(id, response.newUuid);
                }
            },
            normalizeResponse: function(originalResponse, successful) {
                var response = originalResponse;
                if (!qq.isObject(originalResponse)) {
                    response = {};
                    if (qq.isString(originalResponse) && !successful) {
                        response.error = originalResponse;
                    }
                }
                response.success = successful;
                return response;
            },
            now: function(id) {
                var name = options.getName(id);
                if (!controller.isValid(id)) {
                    throw new qq.Error(id + " is not a valid file ID to upload!");
                }
                options.onUpload(id, name).then(function(response) {
                    if (response && response.pause) {
                        options.setStatus(id, qq.status.PAUSED);
                        handler.pause(id);
                        connectionManager.free(id);
                    } else {
                        if (chunkingPossible && handler._shouldChunkThisFile(id)) {
                            chunked.sendNext(id);
                        } else {
                            simple.send(id, name);
                        }
                    }
                }, function(error) {
                    error = error || {};
                    log(id + " upload start aborted due to rejected onUpload Promise - details: " + error, "error");
                    if (!options.onAutoRetry(id, name, error.responseJSON || {})) {
                        var response = upload.normalizeResponse(error.responseJSON, false);
                        upload.cleanup(id, response);
                    }
                });
            },
            start: function(id) {
                var blobToUpload = upload.getProxyOrBlob(id);
                if (blobToUpload) {
                    return upload.maybeDefer(id, blobToUpload);
                } else {
                    upload.now(id);
                    return true;
                }
            }
        };
        qq.extend(this, {
            add: function(id, file) {
                handler.add.apply(this, arguments);
            },
            upload: function(id) {
                if (connectionManager.open(id)) {
                    return upload.start(id);
                }
                return false;
            },
            retry: function(id) {
                if (concurrentChunkingPossible) {
                    handler._getFileState(id).temp.ignoreFailure = false;
                }
                if (connectionManager.isUsingConnection(id)) {
                    return upload.start(id);
                } else {
                    return controller.upload(id);
                }
            },
            cancel: function(id) {
                var cancelRetVal = handler.cancel(id);
                if (qq.isGenericPromise(cancelRetVal)) {
                    cancelRetVal.then(function() {
                        upload.cancel(id);
                    });
                } else if (cancelRetVal !== false) {
                    upload.cancel(id);
                }
            },
            cancelAll: function() {
                var waitingOrConnected = connectionManager.getWaitingOrConnected(), i;
                if (waitingOrConnected.length) {
                    for (i = waitingOrConnected.length - 1; i >= 0; i--) {
                        controller.cancel(waitingOrConnected[i]);
                    }
                }
                connectionManager.reset();
            },
            getFile: function(id) {
                if (handler.getProxy && handler.getProxy(id)) {
                    return handler.getProxy(id).referenceBlob;
                }
                return handler.getFile && handler.getFile(id);
            },
            isProxied: function(id) {
                return !!(handler.getProxy && handler.getProxy(id));
            },
            getInput: function(id) {
                if (handler.getInput) {
                    return handler.getInput(id);
                }
            },
            reset: function() {
                log("Resetting upload handler");
                controller.cancelAll();
                connectionManager.reset();
                handler.reset();
            },
            expunge: function(id) {
                if (controller.isValid(id)) {
                    return handler.expunge(id);
                }
            },
            isValid: function(id) {
                return handler.isValid(id);
            },
            hasResumeRecord: function(id) {
                var key = handler.isValid(id) && handler._getLocalStorageId && handler._getLocalStorageId(id);
                if (key) {
                    return !!localStorage.getItem(key);
                }
                return false;
            },
            getResumableFilesData: function() {
                if (handler.getResumableFilesData) {
                    return handler.getResumableFilesData();
                }
                return [];
            },
            getThirdPartyFileId: function(id) {
                if (controller.isValid(id)) {
                    return handler.getThirdPartyFileId(id);
                }
            },
            pause: function(id) {
                if (controller.isResumable(id) && handler.pause && controller.isValid(id) && handler.pause(id)) {
                    connectionManager.free(id);
                    handler.moveInProgressToRemaining(id);
                    return true;
                }
                return false;
            },
            isAttemptingResume: function(id) {
                return !!handler.isAttemptingResume && handler.isAttemptingResume(id);
            },
            isResumable: function(id) {
                return !!handler.isResumable && handler.isResumable(id);
            }
        });
        qq.extend(options, o);
        log = options.log;
        chunkingPossible = options.chunking.enabled && qq.supportedFeatures.chunking;
        concurrentChunkingPossible = chunkingPossible && options.chunking.concurrent.enabled;
        preventRetryResponse = function() {
            var response = {};
            response[options.preventRetryParam] = true;
            return response;
        }();
        upload.initHandler();
    };
    qq.WindowReceiveMessage = function(o) {
        "use strict";
        var options = {
            log: function(message, level) {}
        }, callbackWrapperDetachers = {};
        qq.extend(options, o);
        qq.extend(this, {
            receiveMessage: function(id, callback) {
                var onMessageCallbackWrapper = function(event) {
                    callback(event.data);
                };
                if (window.postMessage) {
                    callbackWrapperDetachers[id] = qq(window).attach("message", onMessageCallbackWrapper);
                } else {
                    log("iframe message passing not supported in this browser!", "error");
                }
            },
            stopReceivingMessages: function(id) {
                if (window.postMessage) {
                    var detacher = callbackWrapperDetachers[id];
                    if (detacher) {
                        detacher();
                    }
                }
            }
        });
    };
    qq.FormUploadHandler = function(spec) {
        "use strict";
        var options = spec.options, handler = this, proxy = spec.proxy, formHandlerInstanceId = qq.getUniqueId(), onloadCallbacks = {}, detachLoadEvents = {}, postMessageCallbackTimers = {}, isCors = options.isCors, inputName = options.inputName, getUuid = proxy.getUuid, log = proxy.log, corsMessageReceiver = new qq.WindowReceiveMessage({
            log: log
        });
        function expungeFile(id) {
            delete detachLoadEvents[id];
            if (isCors) {
                clearTimeout(postMessageCallbackTimers[id]);
                delete postMessageCallbackTimers[id];
                corsMessageReceiver.stopReceivingMessages(id);
            }
            var iframe = document.getElementById(handler._getIframeName(id));
            if (iframe) {
                iframe.setAttribute("src", "javascript:false;");
                qq(iframe).remove();
            }
        }
        function getFileIdForIframeName(iframeName) {
            return iframeName.split("_")[0];
        }
        function initIframeForUpload(name) {
            var iframe = qq.toElement("<iframe src='javascript:false;' name='" + name + "' />");
            iframe.setAttribute("id", name);
            iframe.style.display = "none";
            document.body.appendChild(iframe);
            return iframe;
        }
        function registerPostMessageCallback(iframe, callback) {
            var iframeName = iframe.id, fileId = getFileIdForIframeName(iframeName), uuid = getUuid(fileId);
            onloadCallbacks[uuid] = callback;
            detachLoadEvents[fileId] = qq(iframe).attach("load", function() {
                if (handler.getInput(fileId)) {
                    log("Received iframe load event for CORS upload request (iframe name " + iframeName + ")");
                    postMessageCallbackTimers[iframeName] = setTimeout(function() {
                        var errorMessage = "No valid message received from loaded iframe for iframe name " + iframeName;
                        log(errorMessage, "error");
                        callback({
                            error: errorMessage
                        });
                    }, 1e3);
                }
            });
            corsMessageReceiver.receiveMessage(iframeName, function(message) {
                log("Received the following window message: '" + message + "'");
                var fileId = getFileIdForIframeName(iframeName), response = handler._parseJsonResponse(message), uuid = response.uuid, onloadCallback;
                if (uuid && onloadCallbacks[uuid]) {
                    log("Handling response for iframe name " + iframeName);
                    clearTimeout(postMessageCallbackTimers[iframeName]);
                    delete postMessageCallbackTimers[iframeName];
                    handler._detachLoadEvent(iframeName);
                    onloadCallback = onloadCallbacks[uuid];
                    delete onloadCallbacks[uuid];
                    corsMessageReceiver.stopReceivingMessages(iframeName);
                    onloadCallback(response);
                } else if (!uuid) {
                    log("'" + message + "' does not contain a UUID - ignoring.");
                }
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, fileInput) {
                    super_.add(id, {
                        input: fileInput
                    });
                    fileInput.setAttribute("name", inputName);
                    if (fileInput.parentNode) {
                        qq(fileInput).remove();
                    }
                },
                expunge: function(id) {
                    expungeFile(id);
                    super_.expunge(id);
                },
                isValid: function(id) {
                    return super_.isValid(id) && handler._getFileState(id).input !== undefined;
                }
            };
        });
        qq.extend(this, {
            getInput: function(id) {
                return handler._getFileState(id).input;
            },
            _attachLoadEvent: function(iframe, callback) {
                var responseDescriptor;
                if (isCors) {
                    registerPostMessageCallback(iframe, callback);
                } else {
                    detachLoadEvents[iframe.id] = qq(iframe).attach("load", function() {
                        log("Received response for " + iframe.id);
                        if (!iframe.parentNode) {
                            return;
                        }
                        try {
                            if (iframe.contentDocument && iframe.contentDocument.body && iframe.contentDocument.body.innerHTML == "false") {
                                return;
                            }
                        } catch (error) {
                            log("Error when attempting to access iframe during handling of upload response (" + error.message + ")", "error");
                            responseDescriptor = {
                                success: false
                            };
                        }
                        callback(responseDescriptor);
                    });
                }
            },
            _createIframe: function(id) {
                var iframeName = handler._getIframeName(id);
                return initIframeForUpload(iframeName);
            },
            _detachLoadEvent: function(id) {
                if (detachLoadEvents[id] !== undefined) {
                    detachLoadEvents[id]();
                    delete detachLoadEvents[id];
                }
            },
            _getIframeName: function(fileId) {
                return fileId + "_" + formHandlerInstanceId;
            },
            _initFormForUpload: function(spec) {
                var method = spec.method, endpoint = spec.endpoint, params = spec.params, paramsInBody = spec.paramsInBody, targetName = spec.targetName, form = qq.toElement("<form method='" + method + "' enctype='multipart/form-data'></form>"), url = endpoint;
                if (paramsInBody) {
                    qq.obj2Inputs(params, form);
                } else {
                    url = qq.obj2url(params, endpoint);
                }
                form.setAttribute("action", url);
                form.setAttribute("target", targetName);
                form.style.display = "none";
                document.body.appendChild(form);
                return form;
            },
            _parseJsonResponse: function(innerHtmlOrMessage) {
                var response = {};
                try {
                    response = qq.parseJson(innerHtmlOrMessage);
                } catch (error) {
                    log("Error when attempting to parse iframe upload response (" + error.message + ")", "error");
                }
                return response;
            }
        });
    };
    qq.XhrUploadHandler = function(spec) {
        "use strict";
        var handler = this, namespace = spec.options.namespace, proxy = spec.proxy, chunking = spec.options.chunking, getChunkSize = function(id) {
            var fileState = handler._getFileState(id);
            if (fileState.chunkSize) {
                return fileState.chunkSize;
            } else {
                var chunkSize = chunking.partSize;
                if (qq.isFunction(chunkSize)) {
                    chunkSize = chunkSize(id, getSize(id));
                }
                fileState.chunkSize = chunkSize;
                return chunkSize;
            }
        }, resume = spec.options.resume, chunkFiles = chunking && spec.options.chunking.enabled && qq.supportedFeatures.chunking, resumeEnabled = resume && spec.options.resume.enabled && chunkFiles && qq.supportedFeatures.resume, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, getEndpoint = proxy.getEndpoint, getDataByUuid = proxy.getDataByUuid, onUuidChanged = proxy.onUuidChanged, onProgress = proxy.onProgress, log = proxy.log, getCustomResumeData = proxy.getCustomResumeData;
        function abort(id) {
            qq.each(handler._getXhrs(id), function(xhrId, xhr) {
                var ajaxRequester = handler._getAjaxRequester(id, xhrId);
                xhr.onreadystatechange = null;
                xhr.upload.onprogress = null;
                xhr.abort();
                ajaxRequester && ajaxRequester.canceled && ajaxRequester.canceled(id);
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, blobOrProxy) {
                    if (qq.isFile(blobOrProxy) || qq.isBlob(blobOrProxy)) {
                        super_.add(id, {
                            file: blobOrProxy
                        });
                    } else if (blobOrProxy instanceof qq.BlobProxy) {
                        super_.add(id, {
                            proxy: blobOrProxy
                        });
                    } else {
                        throw new Error("Passed obj is not a File, Blob, or proxy");
                    }
                    handler._initTempState(id);
                    resumeEnabled && handler._maybePrepareForResume(id);
                },
                expunge: function(id) {
                    abort(id);
                    handler._maybeDeletePersistedChunkData(id);
                    handler._clearXhrs(id);
                    super_.expunge(id);
                }
            };
        });
        qq.extend(this, {
            clearCachedChunk: function(id, chunkIdx) {
                var fileState = handler._getFileState(id);
                if (fileState) {
                    delete fileState.temp.cachedChunks[chunkIdx];
                }
            },
            clearXhr: function(id, chunkIdx) {
                var tempState = handler._getFileState(id).temp;
                if (tempState.xhrs) {
                    delete tempState.xhrs[chunkIdx];
                }
                if (tempState.ajaxRequesters) {
                    delete tempState.ajaxRequesters[chunkIdx];
                }
            },
            finalizeChunks: function(id, responseParser) {
                var lastChunkIdx = handler._getTotalChunks(id) - 1, xhr = handler._getXhr(id, lastChunkIdx);
                if (responseParser) {
                    return new qq.Promise().success(responseParser(xhr), xhr);
                }
                return new qq.Promise().success({}, xhr);
            },
            getFile: function(id) {
                return handler.isValid(id) && handler._getFileState(id).file;
            },
            getProxy: function(id) {
                return handler.isValid(id) && handler._getFileState(id).proxy;
            },
            getResumableFilesData: function() {
                var resumableFilesData = [];
                handler._iterateResumeRecords(function(key, uploadData) {
                    handler.moveInProgressToRemaining(null, uploadData.chunking.inProgress, uploadData.chunking.remaining);
                    var data = {
                        name: uploadData.name,
                        remaining: uploadData.chunking.remaining,
                        size: uploadData.size,
                        uuid: uploadData.uuid
                    };
                    if (uploadData.key) {
                        data.key = uploadData.key;
                    }
                    if (uploadData.customResumeData) {
                        data.customResumeData = uploadData.customResumeData;
                    }
                    resumableFilesData.push(data);
                });
                return resumableFilesData;
            },
            isAttemptingResume: function(id) {
                return handler._getFileState(id).attemptingResume;
            },
            isResumable: function(id) {
                return !!chunking && handler.isValid(id) && !handler._getFileState(id).notResumable;
            },
            moveInProgressToRemaining: function(id, optInProgress, optRemaining) {
                var fileState = handler._getFileState(id) || {}, chunkingState = fileState.chunking || {}, inProgress = optInProgress || chunkingState.inProgress, remaining = optRemaining || chunkingState.remaining;
                if (inProgress) {
                    log(qq.format("Moving these chunks from in-progress {}, to remaining.", JSON.stringify(inProgress)));
                    inProgress.reverse();
                    qq.each(inProgress, function(idx, chunkIdx) {
                        remaining.unshift(chunkIdx);
                    });
                    inProgress.length = 0;
                }
            },
            pause: function(id) {
                if (handler.isValid(id)) {
                    log(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.", id, getName(id)));
                    handler._getFileState(id).paused = true;
                    abort(id);
                    return true;
                }
            },
            reevaluateChunking: function(id) {
                if (chunking && handler.isValid(id)) {
                    var state = handler._getFileState(id), totalChunks, i;
                    delete state.chunking;
                    state.chunking = {};
                    totalChunks = handler._getTotalChunks(id);
                    if (totalChunks > 1 || chunking.mandatory) {
                        state.chunking.enabled = true;
                        state.chunking.parts = totalChunks;
                        state.chunking.remaining = [];
                        for (i = 0; i < totalChunks; i++) {
                            state.chunking.remaining.push(i);
                        }
                        handler._initTempState(id);
                    } else {
                        state.chunking.enabled = false;
                    }
                }
            },
            updateBlob: function(id, newBlob) {
                if (handler.isValid(id)) {
                    handler._getFileState(id).file = newBlob;
                }
            },
            _clearXhrs: function(id) {
                var tempState = handler._getFileState(id).temp;
                qq.each(tempState.ajaxRequesters, function(chunkId) {
                    delete tempState.ajaxRequesters[chunkId];
                });
                qq.each(tempState.xhrs, function(chunkId) {
                    delete tempState.xhrs[chunkId];
                });
            },
            _createXhr: function(id, optChunkIdx) {
                return handler._registerXhr(id, optChunkIdx, qq.createXhrInstance());
            },
            _getAjaxRequester: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.ajaxRequesters[chunkIdx];
            },
            _getChunkData: function(id, chunkIndex) {
                var chunkSize = getChunkSize(id), fileSize = getSize(id), fileOrBlob = handler.getFile(id), startBytes = chunkSize * chunkIndex, endBytes = startBytes + chunkSize >= fileSize ? fileSize : startBytes + chunkSize, totalChunks = handler._getTotalChunks(id), cachedChunks = this._getFileState(id).temp.cachedChunks, blob = cachedChunks[chunkIndex] || qq.sliceBlob(fileOrBlob, startBytes, endBytes);
                cachedChunks[chunkIndex] = blob;
                return {
                    part: chunkIndex,
                    start: startBytes,
                    end: endBytes,
                    count: totalChunks,
                    blob: blob,
                    size: endBytes - startBytes
                };
            },
            _getChunkDataForCallback: function(chunkData) {
                return {
                    partIndex: chunkData.part,
                    startByte: chunkData.start + 1,
                    endByte: chunkData.end,
                    totalParts: chunkData.count
                };
            },
            _getLocalStorageId: function(id) {
                var formatVersion = "5.0", name = getName(id), size = getSize(id), chunkSize = getChunkSize(id), endpoint = getEndpoint(id), customKeys = resume.customKeys(id), localStorageId = qq.format("qq{}resume{}-{}-{}-{}-{}", namespace, formatVersion, name, size, chunkSize, endpoint);
                customKeys.forEach(function(key) {
                    localStorageId += "-" + key;
                });
                return localStorageId;
            },
            _getMimeType: function(id) {
                return handler.getFile(id).type;
            },
            _getPersistableData: function(id) {
                return handler._getFileState(id).chunking;
            },
            _getTotalChunks: function(id) {
                if (chunking) {
                    var fileSize = getSize(id), chunkSize = getChunkSize(id);
                    return Math.ceil(fileSize / chunkSize);
                }
            },
            _getXhr: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.xhrs[chunkIdx];
            },
            _getXhrs: function(id) {
                return handler._getFileState(id).temp.xhrs;
            },
            _iterateResumeRecords: function(callback) {
                if (resumeEnabled) {
                    qq.each(localStorage, function(key, item) {
                        if (key.indexOf(qq.format("qq{}resume", namespace)) === 0) {
                            var uploadData = JSON.parse(item);
                            callback(key, uploadData);
                        }
                    });
                }
            },
            _initTempState: function(id) {
                handler._getFileState(id).temp = {
                    ajaxRequesters: {},
                    chunkProgress: {},
                    xhrs: {},
                    cachedChunks: {}
                };
            },
            _markNotResumable: function(id) {
                handler._getFileState(id).notResumable = true;
            },
            _maybeDeletePersistedChunkData: function(id) {
                var localStorageId;
                if (resumeEnabled && handler.isResumable(id)) {
                    localStorageId = handler._getLocalStorageId(id);
                    if (localStorageId && localStorage.getItem(localStorageId)) {
                        localStorage.removeItem(localStorageId);
                        return true;
                    }
                }
                return false;
            },
            _maybePrepareForResume: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && state.key === undefined) {
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = localStorage.getItem(localStorageId);
                    if (persistedData) {
                        persistedData = JSON.parse(persistedData);
                        if (getDataByUuid(persistedData.uuid)) {
                            handler._markNotResumable(id);
                        } else {
                            log(qq.format("Identified file with ID {} and name of {} as resumable.", id, getName(id)));
                            onUuidChanged(id, persistedData.uuid);
                            state.key = persistedData.key;
                            state.chunking = persistedData.chunking;
                            state.loaded = persistedData.loaded;
                            state.customResumeData = persistedData.customResumeData;
                            state.attemptingResume = true;
                            handler.moveInProgressToRemaining(id);
                        }
                    }
                }
            },
            _maybePersistChunkedState: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && handler.isResumable(id)) {
                    var customResumeData = getCustomResumeData(id);
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = {
                        name: getName(id),
                        size: getSize(id),
                        uuid: getUuid(id),
                        key: state.key,
                        chunking: state.chunking,
                        loaded: state.loaded,
                        lastUpdated: Date.now()
                    };
                    if (customResumeData) {
                        persistedData.customResumeData = customResumeData;
                    }
                    try {
                        localStorage.setItem(localStorageId, JSON.stringify(persistedData));
                    } catch (error) {
                        log(qq.format("Unable to save resume data for '{}' due to error: '{}'.", id, error.toString()), "warn");
                    }
                }
            },
            _registerProgressHandler: function(id, chunkIdx, chunkSize) {
                var xhr = handler._getXhr(id, chunkIdx), name = getName(id), progressCalculator = {
                    simple: function(loaded, total) {
                        var fileSize = getSize(id);
                        if (loaded === total) {
                            onProgress(id, name, fileSize, fileSize);
                        } else {
                            onProgress(id, name, loaded >= fileSize ? fileSize - 1 : loaded, fileSize);
                        }
                    },
                    chunked: function(loaded, total) {
                        var chunkProgress = handler._getFileState(id).temp.chunkProgress, totalSuccessfullyLoadedForFile = handler._getFileState(id).loaded, loadedForRequest = loaded, totalForRequest = total, totalFileSize = getSize(id), estActualChunkLoaded = loadedForRequest - (totalForRequest - chunkSize), totalLoadedForFile = totalSuccessfullyLoadedForFile;
                        chunkProgress[chunkIdx] = estActualChunkLoaded;
                        qq.each(chunkProgress, function(chunkIdx, chunkLoaded) {
                            totalLoadedForFile += chunkLoaded;
                        });
                        onProgress(id, name, totalLoadedForFile, totalFileSize);
                    }
                };
                xhr.upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        var type = chunkSize == null ? "simple" : "chunked";
                        progressCalculator[type](e.loaded, e.total);
                    }
                };
            },
            _registerXhr: function(id, optChunkIdx, xhr, optAjaxRequester) {
                var xhrsId = optChunkIdx == null ? -1 : optChunkIdx, tempState = handler._getFileState(id).temp;
                tempState.xhrs = tempState.xhrs || {};
                tempState.ajaxRequesters = tempState.ajaxRequesters || {};
                tempState.xhrs[xhrsId] = xhr;
                if (optAjaxRequester) {
                    tempState.ajaxRequesters[xhrsId] = optAjaxRequester;
                }
                return xhr;
            },
            _removeExpiredChunkingRecords: function() {
                var expirationDays = resume.recordsExpireIn;
                handler._iterateResumeRecords(function(key, uploadData) {
                    var expirationDate = new Date(uploadData.lastUpdated);
                    expirationDate.setDate(expirationDate.getDate() + expirationDays);
                    if (expirationDate.getTime() <= Date.now()) {
                        log("Removing expired resume record with key " + key);
                        localStorage.removeItem(key);
                    }
                });
            },
            _shouldChunkThisFile: function(id) {
                var state = handler._getFileState(id);
                if (state) {
                    if (!state.chunking) {
                        handler.reevaluateChunking(id);
                    }
                    return state.chunking.enabled;
                }
            }
        });
    };
    qq.DeleteFileAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            method: "DELETE",
            uuidParamName: "qquuid",
            endpointStore: {},
            maxConnections: 3,
            customHeaders: function(id) {
                return {};
            },
            paramsStore: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onDelete: function(id) {},
            onDeleteComplete: function(id, xhrOrXdr, isError) {}
        };
        qq.extend(options, o);
        function getMandatedParams() {
            if (options.method.toUpperCase() === "POST") {
                return {
                    _method: "DELETE"
                };
            }
            return {};
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "POST", "DELETE" ],
            method: options.method,
            endpointStore: options.endpointStore,
            paramsStore: options.paramsStore,
            mandatedParams: getMandatedParams(),
            maxConnections: options.maxConnections,
            customHeaders: function(id) {
                return options.customHeaders.get(id);
            },
            log: options.log,
            onSend: options.onDelete,
            onComplete: options.onDeleteComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            sendDelete: function(id, uuid, additionalMandatedParams) {
                var additionalOptions = additionalMandatedParams || {};
                options.log("Submitting delete file request for " + id);
                if (options.method === "DELETE") {
                    requester.initTransport(id).withPath(uuid).withParams(additionalOptions).send();
                } else {
                    additionalOptions[options.uuidParamName] = uuid;
                    requester.initTransport(id).withParams(additionalOptions).send();
                }
            }
        });
    };
    (function() {
        function detectSubsampling(img) {
            var iw = img.naturalWidth, ih = img.naturalHeight, canvas = document.createElement("canvas"), ctx;
            if (iw * ih > 1024 * 1024) {
                canvas.width = canvas.height = 1;
                ctx = canvas.getContext("2d");
                ctx.drawImage(img, -iw + 1, 0);
                return ctx.getImageData(0, 0, 1, 1).data[3] === 0;
            } else {
                return false;
            }
        }
        function detectVerticalSquash(img, iw, ih) {
            var canvas = document.createElement("canvas"), sy = 0, ey = ih, py = ih, ctx, data, alpha, ratio;
            canvas.width = 1;
            canvas.height = ih;
            ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            data = ctx.getImageData(0, 0, 1, ih).data;
            while (py > sy) {
                alpha = data[(py - 1) * 4 + 3];
                if (alpha === 0) {
                    ey = py;
                } else {
                    sy = py;
                }
                py = ey + sy >> 1;
            }
            ratio = py / ih;
            return ratio === 0 ? 1 : ratio;
        }
        function renderImageToDataURL(img, blob, options, doSquash) {
            var canvas = document.createElement("canvas"), mime = options.mime || "image/jpeg", promise = new qq.Promise();
            renderImageToCanvas(img, blob, canvas, options, doSquash).then(function() {
                promise.success(canvas.toDataURL(mime, options.quality || .8));
            });
            return promise;
        }
        function maybeCalculateDownsampledDimensions(spec) {
            var maxPixels = 5241e3;
            if (!qq.ios()) {
                throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");
            }
            if (spec.origHeight * spec.origWidth > maxPixels) {
                return {
                    newHeight: Math.round(Math.sqrt(maxPixels * (spec.origHeight / spec.origWidth))),
                    newWidth: Math.round(Math.sqrt(maxPixels * (spec.origWidth / spec.origHeight)))
                };
            }
        }
        function renderImageToCanvas(img, blob, canvas, options, doSquash) {
            var iw = img.naturalWidth, ih = img.naturalHeight, width = options.width, height = options.height, ctx = canvas.getContext("2d"), promise = new qq.Promise(), modifiedDimensions;
            ctx.save();
            if (options.resize) {
                return renderImageToCanvasWithCustomResizer({
                    blob: blob,
                    canvas: canvas,
                    image: img,
                    imageHeight: ih,
                    imageWidth: iw,
                    orientation: options.orientation,
                    resize: options.resize,
                    targetHeight: height,
                    targetWidth: width
                });
            }
            if (!qq.supportedFeatures.unlimitedScaledImageSize) {
                modifiedDimensions = maybeCalculateDownsampledDimensions({
                    origWidth: width,
                    origHeight: height
                });
                if (modifiedDimensions) {
                    qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h", width, height, modifiedDimensions.newWidth, modifiedDimensions.newHeight), "warn");
                    width = modifiedDimensions.newWidth;
                    height = modifiedDimensions.newHeight;
                }
            }
            transformCoordinate(canvas, width, height, options.orientation);
            if (qq.ios()) {
                (function() {
                    if (detectSubsampling(img)) {
                        iw /= 2;
                        ih /= 2;
                    }
                    var d = 1024, tmpCanvas = document.createElement("canvas"), vertSquashRatio = doSquash ? detectVerticalSquash(img, iw, ih) : 1, dw = Math.ceil(d * width / iw), dh = Math.ceil(d * height / ih / vertSquashRatio), sy = 0, dy = 0, tmpCtx, sx, dx;
                    tmpCanvas.width = tmpCanvas.height = d;
                    tmpCtx = tmpCanvas.getContext("2d");
                    while (sy < ih) {
                        sx = 0;
                        dx = 0;
                        while (sx < iw) {
                            tmpCtx.clearRect(0, 0, d, d);
                            tmpCtx.drawImage(img, -sx, -sy);
                            ctx.drawImage(tmpCanvas, 0, 0, d, d, dx, dy, dw, dh);
                            sx += d;
                            dx += dw;
                        }
                        sy += d;
                        dy += dh;
                    }
                    ctx.restore();
                    tmpCanvas = tmpCtx = null;
                })();
            } else {
                ctx.drawImage(img, 0, 0, width, height);
            }
            canvas.qqImageRendered && canvas.qqImageRendered();
            promise.success();
            return promise;
        }
        function renderImageToCanvasWithCustomResizer(resizeInfo) {
            var blob = resizeInfo.blob, image = resizeInfo.image, imageHeight = resizeInfo.imageHeight, imageWidth = resizeInfo.imageWidth, orientation = resizeInfo.orientation, promise = new qq.Promise(), resize = resizeInfo.resize, sourceCanvas = document.createElement("canvas"), sourceCanvasContext = sourceCanvas.getContext("2d"), targetCanvas = resizeInfo.canvas, targetHeight = resizeInfo.targetHeight, targetWidth = resizeInfo.targetWidth;
            transformCoordinate(sourceCanvas, imageWidth, imageHeight, orientation);
            targetCanvas.height = targetHeight;
            targetCanvas.width = targetWidth;
            sourceCanvasContext.drawImage(image, 0, 0);
            resize({
                blob: blob,
                height: targetHeight,
                image: image,
                sourceCanvas: sourceCanvas,
                targetCanvas: targetCanvas,
                width: targetWidth
            }).then(function success() {
                targetCanvas.qqImageRendered && targetCanvas.qqImageRendered();
                promise.success();
            }, promise.failure);
            return promise;
        }
        function transformCoordinate(canvas, width, height, orientation) {
            switch (orientation) {
              case 5:
              case 6:
              case 7:
              case 8:
                canvas.width = height;
                canvas.height = width;
                break;

              default:
                canvas.width = width;
                canvas.height = height;
            }
            var ctx = canvas.getContext("2d");
            switch (orientation) {
              case 2:
                ctx.translate(width, 0);
                ctx.scale(-1, 1);
                break;

              case 3:
                ctx.translate(width, height);
                ctx.rotate(Math.PI);
                break;

              case 4:
                ctx.translate(0, height);
                ctx.scale(1, -1);
                break;

              case 5:
                ctx.rotate(.5 * Math.PI);
                ctx.scale(1, -1);
                break;

              case 6:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(0, -height);
                break;

              case 7:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(width, -height);
                ctx.scale(-1, 1);
                break;

              case 8:
                ctx.rotate(-.5 * Math.PI);
                ctx.translate(-width, 0);
                break;

              default:
                break;
            }
        }
        function MegaPixImage(srcImage, errorCallback) {
            var self = this;
            if (window.Blob && srcImage instanceof Blob) {
                (function() {
                    var img = new Image(), URL = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                    if (!URL) {
                        throw Error("No createObjectURL function found to create blob url");
                    }
                    img.src = URL.createObjectURL(srcImage);
                    self.blob = srcImage;
                    srcImage = img;
                })();
            }
            if (!srcImage.naturalWidth && !srcImage.naturalHeight) {
                srcImage.onload = function() {
                    var listeners = self.imageLoadListeners;
                    if (listeners) {
                        self.imageLoadListeners = null;
                        setTimeout(function() {
                            for (var i = 0, len = listeners.length; i < len; i++) {
                                listeners[i]();
                            }
                        }, 0);
                    }
                };
                srcImage.onerror = errorCallback;
                this.imageLoadListeners = [];
            }
            this.srcImage = srcImage;
        }
        MegaPixImage.prototype.render = function(target, options) {
            options = options || {};
            var self = this, imgWidth = this.srcImage.naturalWidth, imgHeight = this.srcImage.naturalHeight, width = options.width, height = options.height, maxWidth = options.maxWidth, maxHeight = options.maxHeight, doSquash = !this.blob || this.blob.type === "image/jpeg", tagName = target.tagName.toLowerCase(), opt;
            if (this.imageLoadListeners) {
                this.imageLoadListeners.push(function() {
                    self.render(target, options);
                });
                return;
            }
            if (width && !height) {
                height = imgHeight * width / imgWidth << 0;
            } else if (height && !width) {
                width = imgWidth * height / imgHeight << 0;
            } else {
                width = imgWidth;
                height = imgHeight;
            }
            if (maxWidth && width > maxWidth) {
                width = maxWidth;
                height = imgHeight * width / imgWidth << 0;
            }
            if (maxHeight && height > maxHeight) {
                height = maxHeight;
                width = imgWidth * height / imgHeight << 0;
            }
            opt = {
                width: width,
                height: height
            }, qq.each(options, function(optionsKey, optionsValue) {
                opt[optionsKey] = optionsValue;
            });
            if (tagName === "img") {
                (function() {
                    var oldTargetSrc = target.src;
                    renderImageToDataURL(self.srcImage, self.blob, opt, doSquash).then(function(dataUri) {
                        target.src = dataUri;
                        oldTargetSrc === target.src && target.onload();
                    });
                })();
            } else if (tagName === "canvas") {
                renderImageToCanvas(this.srcImage, this.blob, target, opt, doSquash);
            }
            if (typeof this.onrender === "function") {
                this.onrender(target);
            }
        };
        qq.MegaPixImage = MegaPixImage;
    })();
    qq.ImageGenerator = function(log) {
        "use strict";
        function isImg(el) {
            return el.tagName.toLowerCase() === "img";
        }
        function isCanvas(el) {
            return el.tagName.toLowerCase() === "canvas";
        }
        function isImgCorsSupported() {
            return new Image().crossOrigin !== undefined;
        }
        function isCanvasSupported() {
            var canvas = document.createElement("canvas");
            return canvas.getContext && canvas.getContext("2d");
        }
        function determineMimeOfFileName(nameWithPath) {
            var pathSegments = nameWithPath.split("/"), name = pathSegments[pathSegments.length - 1].split("?")[0], extension = qq.getExtension(name);
            extension = extension && extension.toLowerCase();
            switch (extension) {
              case "jpeg":
              case "jpg":
                return "image/jpeg";

              case "png":
                return "image/png";

              case "bmp":
                return "image/bmp";

              case "gif":
                return "image/gif";

              case "tiff":
              case "tif":
                return "image/tiff";
            }
        }
        function isCrossOrigin(url) {
            var targetAnchor = document.createElement("a"), targetProtocol, targetHostname, targetPort;
            targetAnchor.href = url;
            targetProtocol = targetAnchor.protocol;
            targetPort = targetAnchor.port;
            targetHostname = targetAnchor.hostname;
            if (targetProtocol.toLowerCase() !== window.location.protocol.toLowerCase()) {
                return true;
            }
            if (targetHostname.toLowerCase() !== window.location.hostname.toLowerCase()) {
                return true;
            }
            if (targetPort !== window.location.port && !qq.ie()) {
                return true;
            }
            return false;
        }
        function registerImgLoadListeners(img, promise) {
            img.onload = function() {
                img.onload = null;
                img.onerror = null;
                promise.success(img);
            };
            img.onerror = function() {
                img.onload = null;
                img.onerror = null;
                log("Problem drawing thumbnail!", "error");
                promise.failure(img, "Problem drawing thumbnail!");
            };
        }
        function registerCanvasDrawImageListener(canvas, promise) {
            canvas.qqImageRendered = function() {
                promise.success(canvas);
            };
        }
        function registerThumbnailRenderedListener(imgOrCanvas, promise) {
            var registered = isImg(imgOrCanvas) || isCanvas(imgOrCanvas);
            if (isImg(imgOrCanvas)) {
                registerImgLoadListeners(imgOrCanvas, promise);
            } else if (isCanvas(imgOrCanvas)) {
                registerCanvasDrawImageListener(imgOrCanvas, promise);
            } else {
                promise.failure(imgOrCanvas);
                log(qq.format("Element container of type {} is not supported!", imgOrCanvas.tagName), "error");
            }
            return registered;
        }
        function draw(fileOrBlob, container, options) {
            var drawPreview = new qq.Promise(), identifier = new qq.Identify(fileOrBlob, log), maxSize = options.maxSize, orient = options.orient == null ? true : options.orient, megapixErrorHandler = function() {
                container.onerror = null;
                container.onload = null;
                log("Could not render preview, file may be too large!", "error");
                drawPreview.failure(container, "Browser cannot render image!");
            };
            identifier.isPreviewable().then(function(mime) {
                var dummyExif = {
                    parse: function() {
                        return new qq.Promise().success();
                    }
                }, exif = orient ? new qq.Exif(fileOrBlob, log) : dummyExif, mpImg = new qq.MegaPixImage(fileOrBlob, megapixErrorHandler);
                if (registerThumbnailRenderedListener(container, drawPreview)) {
                    exif.parse().then(function(exif) {
                        var orientation = exif && exif.Orientation;
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            orientation: orientation,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    }, function(failureMsg) {
                        log(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.", failureMsg));
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    });
                }
            }, function() {
                log("Not previewable");
                drawPreview.failure(container, "Not previewable");
            });
            return drawPreview;
        }
        function drawOnCanvasOrImgFromUrl(url, canvasOrImg, draw, maxSize, customResizeFunction) {
            var tempImg = new Image(), tempImgRender = new qq.Promise();
            registerThumbnailRenderedListener(tempImg, tempImgRender);
            if (isCrossOrigin(url)) {
                tempImg.crossOrigin = "anonymous";
            }
            tempImg.src = url;
            tempImgRender.then(function rendered() {
                registerThumbnailRenderedListener(canvasOrImg, draw);
                var mpImg = new qq.MegaPixImage(tempImg);
                mpImg.render(canvasOrImg, {
                    maxWidth: maxSize,
                    maxHeight: maxSize,
                    mime: determineMimeOfFileName(url),
                    resize: customResizeFunction
                });
            }, draw.failure);
        }
        function drawOnImgFromUrlWithCssScaling(url, img, draw, maxSize) {
            registerThumbnailRenderedListener(img, draw);
            qq(img).css({
                maxWidth: maxSize + "px",
                maxHeight: maxSize + "px"
            });
            img.src = url;
        }
        function drawFromUrl(url, container, options) {
            var draw = new qq.Promise(), scale = options.scale, maxSize = scale ? options.maxSize : null;
            if (scale && isImg(container)) {
                if (isCanvasSupported()) {
                    if (isCrossOrigin(url) && !isImgCorsSupported()) {
                        drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                    } else {
                        drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
                    }
                } else {
                    drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                }
            } else if (isCanvas(container)) {
                drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
            } else if (registerThumbnailRenderedListener(container, draw)) {
                container.src = url;
            }
            return draw;
        }
        qq.extend(this, {
            generate: function(fileBlobOrUrl, container, options) {
                if (qq.isString(fileBlobOrUrl)) {
                    log("Attempting to update thumbnail based on server response.");
                    return drawFromUrl(fileBlobOrUrl, container, options || {});
                } else {
                    log("Attempting to draw client-side image preview.");
                    return draw(fileBlobOrUrl, container, options || {});
                }
            }
        });
        this._testing = {};
        this._testing.isImg = isImg;
        this._testing.isCanvas = isCanvas;
        this._testing.isCrossOrigin = isCrossOrigin;
        this._testing.determineMimeOfFileName = determineMimeOfFileName;
    };
    qq.Exif = function(fileOrBlob, log) {
        "use strict";
        var TAG_IDS = [ 274 ], TAG_INFO = {
            274: {
                name: "Orientation",
                bytes: 2
            }
        };
        function parseLittleEndian(hex) {
            var result = 0, pow = 0;
            while (hex.length > 0) {
                result += parseInt(hex.substring(0, 2), 16) * Math.pow(2, pow);
                hex = hex.substring(2, hex.length);
                pow += 8;
            }
            return result;
        }
        function seekToApp1(offset, promise) {
            var theOffset = offset, thePromise = promise;
            if (theOffset === undefined) {
                theOffset = 2;
                thePromise = new qq.Promise();
            }
            qq.readBlobToHex(fileOrBlob, theOffset, 4).then(function(hex) {
                var match = /^ffe([0-9])/.exec(hex), segmentLength;
                if (match) {
                    if (match[1] !== "1") {
                        segmentLength = parseInt(hex.slice(4, 8), 16);
                        seekToApp1(theOffset + segmentLength + 2, thePromise);
                    } else {
                        thePromise.success(theOffset);
                    }
                } else {
                    thePromise.failure("No EXIF header to be found!");
                }
            });
            return thePromise;
        }
        function getApp1Offset() {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, 0, 6).then(function(hex) {
                if (hex.indexOf("ffd8") !== 0) {
                    promise.failure("Not a valid JPEG!");
                } else {
                    seekToApp1().then(function(offset) {
                        promise.success(offset);
                    }, function(error) {
                        promise.failure(error);
                    });
                }
            });
            return promise;
        }
        function isLittleEndian(app1Start) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 10, 2).then(function(hex) {
                promise.success(hex === "4949");
            });
            return promise;
        }
        function getDirEntryCount(app1Start, littleEndian) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 18, 2).then(function(hex) {
                if (littleEndian) {
                    return promise.success(parseLittleEndian(hex));
                } else {
                    promise.success(parseInt(hex, 16));
                }
            });
            return promise;
        }
        function getIfd(app1Start, dirEntries) {
            var offset = app1Start + 20, bytes = dirEntries * 12;
            return qq.readBlobToHex(fileOrBlob, offset, bytes);
        }
        function getDirEntries(ifdHex) {
            var entries = [], offset = 0;
            while (offset + 24 <= ifdHex.length) {
                entries.push(ifdHex.slice(offset, offset + 24));
                offset += 24;
            }
            return entries;
        }
        function getTagValues(littleEndian, dirEntries) {
            var TAG_VAL_OFFSET = 16, tagsToFind = qq.extend([], TAG_IDS), vals = {};
            qq.each(dirEntries, function(idx, entry) {
                var idHex = entry.slice(0, 4), id = littleEndian ? parseLittleEndian(idHex) : parseInt(idHex, 16), tagsToFindIdx = tagsToFind.indexOf(id), tagValHex, tagName, tagValLength;
                if (tagsToFindIdx >= 0) {
                    tagName = TAG_INFO[id].name;
                    tagValLength = TAG_INFO[id].bytes;
                    tagValHex = entry.slice(TAG_VAL_OFFSET, TAG_VAL_OFFSET + tagValLength * 2);
                    vals[tagName] = littleEndian ? parseLittleEndian(tagValHex) : parseInt(tagValHex, 16);
                    tagsToFind.splice(tagsToFindIdx, 1);
                }
                if (tagsToFind.length === 0) {
                    return false;
                }
            });
            return vals;
        }
        qq.extend(this, {
            parse: function() {
                var parser = new qq.Promise(), onParseFailure = function(message) {
                    log(qq.format("EXIF header parse failed: '{}' ", message));
                    parser.failure(message);
                };
                getApp1Offset().then(function(app1Offset) {
                    log(qq.format("Moving forward with EXIF header parsing for '{}'", fileOrBlob.name === undefined ? "blob" : fileOrBlob.name));
                    isLittleEndian(app1Offset).then(function(littleEndian) {
                        log(qq.format("EXIF Byte order is {} endian", littleEndian ? "little" : "big"));
                        getDirEntryCount(app1Offset, littleEndian).then(function(dirEntryCount) {
                            log(qq.format("Found {} APP1 directory entries", dirEntryCount));
                            getIfd(app1Offset, dirEntryCount).then(function(ifdHex) {
                                var dirEntries = getDirEntries(ifdHex), tagValues = getTagValues(littleEndian, dirEntries);
                                log("Successfully parsed some EXIF tags");
                                parser.success(tagValues);
                            }, onParseFailure);
                        }, onParseFailure);
                    }, onParseFailure);
                }, onParseFailure);
                return parser;
            }
        });
        this._testing = {};
        this._testing.parseLittleEndian = parseLittleEndian;
    };
    qq.Identify = function(fileOrBlob, log) {
        "use strict";
        function isIdentifiable(magicBytes, questionableBytes) {
            var identifiable = false, magicBytesEntries = [].concat(magicBytes);
            qq.each(magicBytesEntries, function(idx, magicBytesArrayEntry) {
                if (questionableBytes.indexOf(magicBytesArrayEntry) === 0) {
                    identifiable = true;
                    return false;
                }
            });
            return identifiable;
        }
        qq.extend(this, {
            isPreviewable: function() {
                var self = this, identifier = new qq.Promise(), previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                log(qq.format("Attempting to determine if {} can be rendered in this browser", name));
                log("First pass: check type attribute of blob object.");
                if (this.isPreviewableSync()) {
                    log("Second pass: check for magic bytes in file header.");
                    qq.readBlobToHex(fileOrBlob, 0, 4).then(function(hex) {
                        qq.each(self.PREVIEWABLE_MIME_TYPES, function(mime, bytes) {
                            if (isIdentifiable(bytes, hex)) {
                                if (mime !== "image/tiff" || qq.supportedFeatures.tiffPreviews) {
                                    previewable = true;
                                    identifier.success(mime);
                                }
                                return false;
                            }
                        });
                        log(qq.format("'{}' is {} able to be rendered in this browser", name, previewable ? "" : "NOT"));
                        if (!previewable) {
                            identifier.failure();
                        }
                    }, function() {
                        log("Error reading file w/ name '" + name + "'.  Not able to be rendered in this browser.");
                        identifier.failure();
                    });
                } else {
                    identifier.failure();
                }
                return identifier;
            },
            isPreviewableSync: function() {
                var fileMime = fileOrBlob.type, isRecognizedImage = qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES), fileMime) >= 0, previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                if (isRecognizedImage) {
                    if (fileMime === "image/tiff") {
                        previewable = qq.supportedFeatures.tiffPreviews;
                    } else {
                        previewable = true;
                    }
                }
                !previewable && log(name + " is not previewable in this browser per the blob's type attr");
                return previewable;
            }
        });
    };
    qq.Identify.prototype.PREVIEWABLE_MIME_TYPES = {
        "image/jpeg": "ffd8ff",
        "image/gif": "474946",
        "image/png": "89504e",
        "image/bmp": "424d",
        "image/tiff": [ "49492a00", "4d4d002a" ]
    };
    qq.ImageValidation = function(blob, log) {
        "use strict";
        function hasNonZeroLimits(limits) {
            var atLeastOne = false;
            qq.each(limits, function(limit, value) {
                if (value > 0) {
                    atLeastOne = true;
                    return false;
                }
            });
            return atLeastOne;
        }
        function getWidthHeight() {
            var sizeDetermination = new qq.Promise();
            new qq.Identify(blob, log).isPreviewable().then(function() {
                var image = new Image(), url = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                if (url) {
                    image.onerror = function() {
                        log("Cannot determine dimensions for image.  May be too large.", "error");
                        sizeDetermination.failure();
                    };
                    image.onload = function() {
                        sizeDetermination.success({
                            width: this.width,
                            height: this.height
                        });
                    };
                    image.src = url.createObjectURL(blob);
                } else {
                    log("No createObjectURL function available to generate image URL!", "error");
                    sizeDetermination.failure();
                }
            }, sizeDetermination.failure);
            return sizeDetermination;
        }
        function getFailingLimit(limits, dimensions) {
            var failingLimit;
            qq.each(limits, function(limitName, limitValue) {
                if (limitValue > 0) {
                    var limitMatcher = /(max|min)(Width|Height)/.exec(limitName), dimensionPropName = limitMatcher[2].charAt(0).toLowerCase() + limitMatcher[2].slice(1), actualValue = dimensions[dimensionPropName];
                    switch (limitMatcher[1]) {
                      case "min":
                        if (actualValue < limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;

                      case "max":
                        if (actualValue > limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;
                    }
                }
            });
            return failingLimit;
        }
        this.validate = function(limits) {
            var validationEffort = new qq.Promise();
            log("Attempting to validate image.");
            if (hasNonZeroLimits(limits)) {
                getWidthHeight().then(function(dimensions) {
                    var failingLimit = getFailingLimit(limits, dimensions);
                    if (failingLimit) {
                        validationEffort.failure(failingLimit);
                    } else {
                        validationEffort.success();
                    }
                }, validationEffort.success);
            } else {
                validationEffort.success();
            }
            return validationEffort;
        };
    };
    qq.Session = function(spec) {
        "use strict";
        var options = {
            endpoint: null,
            params: {},
            customHeaders: {},
            cors: {},
            addFileRecord: function(sessionData) {},
            log: function(message, level) {}
        };
        qq.extend(options, spec, true);
        function isJsonResponseValid(response) {
            if (qq.isArray(response)) {
                return true;
            }
            options.log("Session response is not an array.", "error");
        }
        function handleFileItems(fileItems, success, xhrOrXdr, promise) {
            var someItemsIgnored = false;
            success = success && isJsonResponseValid(fileItems);
            if (success) {
                qq.each(fileItems, function(idx, fileItem) {
                    if (fileItem.uuid == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid UUID - ignoring.", idx), "error");
                    } else if (fileItem.name == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid name - ignoring.", idx), "error");
                    } else {
                        try {
                            options.addFileRecord(fileItem);
                            return true;
                        } catch (err) {
                            someItemsIgnored = true;
                            options.log(err.message, "error");
                        }
                    }
                    return false;
                });
            }
            promise[success && !someItemsIgnored ? "success" : "failure"](fileItems, xhrOrXdr);
        }
        this.refresh = function() {
            var refreshEffort = new qq.Promise(), refreshCompleteCallback = function(response, success, xhrOrXdr) {
                handleFileItems(response, success, xhrOrXdr, refreshEffort);
            }, requesterOptions = qq.extend({}, options), requester = new qq.SessionAjaxRequester(qq.extend(requesterOptions, {
                onComplete: refreshCompleteCallback
            }));
            requester.queryServer();
            return refreshEffort;
        };
    };
    qq.SessionAjaxRequester = function(spec) {
        "use strict";
        var requester, options = {
            endpoint: null,
            customHeaders: {},
            params: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            onComplete: function(response, success, xhrOrXdr) {},
            log: function(str, level) {}
        };
        qq.extend(options, spec);
        function onComplete(id, xhrOrXdr, isError) {
            var response = null;
            if (xhrOrXdr.responseText != null) {
                try {
                    response = qq.parseJson(xhrOrXdr.responseText);
                } catch (err) {
                    options.log("Problem parsing session response: " + err.message, "error");
                    isError = true;
                }
            }
            options.onComplete(response, !isError, xhrOrXdr);
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "GET" ],
            method: "GET",
            endpointStore: {
                get: function() {
                    return options.endpoint;
                }
            },
            customHeaders: options.customHeaders,
            log: options.log,
            onComplete: onComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            queryServer: function() {
                var params = qq.extend({}, options.params);
                options.log("Session query request.");
                requester.initTransport("sessionRefresh").withParams(params).withCacheBuster().send();
            }
        });
    };
    qq.Scaler = function(spec, log) {
        "use strict";
        var self = this, customResizeFunction = spec.customResizer, includeOriginal = spec.sendOriginal, orient = spec.orient, defaultType = spec.defaultType, defaultQuality = spec.defaultQuality / 100, failedToScaleText = spec.failureText, includeExif = spec.includeExif, sizes = this._getSortedSizes(spec.sizes);
        qq.extend(this, {
            enabled: qq.supportedFeatures.scaling && sizes.length > 0,
            getFileRecords: function(originalFileUuid, originalFileName, originalBlobOrBlobData) {
                var self = this, records = [], originalBlob = originalBlobOrBlobData.blob ? originalBlobOrBlobData.blob : originalBlobOrBlobData, identifier = new qq.Identify(originalBlob, log);
                if (identifier.isPreviewableSync()) {
                    qq.each(sizes, function(idx, sizeRecord) {
                        var outputType = self._determineOutputType({
                            defaultType: defaultType,
                            requestedType: sizeRecord.type,
                            refType: originalBlob.type
                        });
                        records.push({
                            uuid: qq.getUniqueId(),
                            name: self._getName(originalFileName, {
                                name: sizeRecord.name,
                                type: outputType,
                                refType: originalBlob.type
                            }),
                            blob: new qq.BlobProxy(originalBlob, qq.bind(self._generateScaledImage, self, {
                                customResizeFunction: customResizeFunction,
                                maxSize: sizeRecord.maxSize,
                                orient: orient,
                                type: outputType,
                                quality: defaultQuality,
                                failedText: failedToScaleText,
                                includeExif: includeExif,
                                log: log
                            }))
                        });
                    });
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: includeOriginal ? originalBlob : null
                    });
                } else {
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: originalBlob
                    });
                }
                return records;
            },
            handleNewFile: function(file, name, uuid, size, fileList, batchId, uuidParamName, api) {
                var self = this, buttonId = file.qqButtonId || file.blob && file.blob.qqButtonId, scaledIds = [], originalId = null, addFileToHandler = api.addFileToHandler, uploadData = api.uploadData, paramsStore = api.paramsStore, proxyGroupId = qq.getUniqueId();
                qq.each(self.getFileRecords(uuid, name, file), function(idx, record) {
                    var blobSize = record.size, id;
                    if (record.blob instanceof qq.BlobProxy) {
                        blobSize = -1;
                    }
                    id = uploadData.addFile({
                        uuid: record.uuid,
                        name: record.name,
                        size: blobSize,
                        batchId: batchId,
                        proxyGroupId: proxyGroupId
                    });
                    if (record.blob instanceof qq.BlobProxy) {
                        scaledIds.push(id);
                    } else {
                        originalId = id;
                    }
                    if (record.blob) {
                        addFileToHandler(id, record.blob);
                        fileList.push({
                            id: id,
                            file: record.blob
                        });
                    } else {
                        uploadData.setStatus(id, qq.status.REJECTED);
                    }
                });
                if (originalId !== null) {
                    qq.each(scaledIds, function(idx, scaledId) {
                        var params = {
                            qqparentuuid: uploadData.retrieve({
                                id: originalId
                            }).uuid,
                            qqparentsize: uploadData.retrieve({
                                id: originalId
                            }).size
                        };
                        params[uuidParamName] = uploadData.retrieve({
                            id: scaledId
                        }).uuid;
                        uploadData.setParentId(scaledId, originalId);
                        paramsStore.addReadOnly(scaledId, params);
                    });
                    if (scaledIds.length) {
                        (function() {
                            var param = {};
                            param[uuidParamName] = uploadData.retrieve({
                                id: originalId
                            }).uuid;
                            paramsStore.addReadOnly(originalId, param);
                        })();
                    }
                }
            }
        });
    };
    qq.extend(qq.Scaler.prototype, {
        scaleImage: function(id, specs, api) {
            "use strict";
            if (!qq.supportedFeatures.scaling) {
                throw new qq.Error("Scaling is not supported in this browser!");
            }
            var scalingEffort = new qq.Promise(), log = api.log, file = api.getFile(id), uploadData = api.uploadData.retrieve({
                id: id
            }), name = uploadData && uploadData.name, uuid = uploadData && uploadData.uuid, scalingOptions = {
                customResizer: specs.customResizer,
                sendOriginal: false,
                orient: specs.orient,
                defaultType: specs.type || null,
                defaultQuality: specs.quality,
                failedToScaleText: "Unable to scale",
                sizes: [ {
                    name: "",
                    maxSize: specs.maxSize
                } ]
            }, scaler = new qq.Scaler(scalingOptions, log);
            if (!qq.Scaler || !qq.supportedFeatures.imagePreviews || !file) {
                scalingEffort.failure();
                log("Could not generate requested scaled image for " + id + ".  " + "Scaling is either not possible in this browser, or the file could not be located.", "error");
            } else {
                qq.bind(function() {
                    var record = scaler.getFileRecords(uuid, name, file)[0];
                    if (record && record.blob instanceof qq.BlobProxy) {
                        record.blob.create().then(scalingEffort.success, scalingEffort.failure);
                    } else {
                        log(id + " is not a scalable image!", "error");
                        scalingEffort.failure();
                    }
                }, this)();
            }
            return scalingEffort;
        },
        _determineOutputType: function(spec) {
            "use strict";
            var requestedType = spec.requestedType, defaultType = spec.defaultType, referenceType = spec.refType;
            if (!defaultType && !requestedType) {
                if (referenceType !== "image/jpeg") {
                    return "image/png";
                }
                return referenceType;
            }
            if (!requestedType) {
                return defaultType;
            }
            if (qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES), requestedType) >= 0) {
                if (requestedType === "image/tiff") {
                    return qq.supportedFeatures.tiffPreviews ? requestedType : defaultType;
                }
                return requestedType;
            }
            return defaultType;
        },
        _getName: function(originalName, scaledVersionProperties) {
            "use strict";
            var startOfExt = originalName.lastIndexOf("."), versionType = scaledVersionProperties.type || "image/png", referenceType = scaledVersionProperties.refType, scaledName = "", scaledExt = qq.getExtension(originalName), nameAppendage = "";
            if (scaledVersionProperties.name && scaledVersionProperties.name.trim().length) {
                nameAppendage = " (" + scaledVersionProperties.name + ")";
            }
            if (startOfExt >= 0) {
                scaledName = originalName.substr(0, startOfExt);
                if (referenceType !== versionType) {
                    scaledExt = versionType.split("/")[1];
                }
                scaledName += nameAppendage + "." + scaledExt;
            } else {
                scaledName = originalName + nameAppendage;
            }
            return scaledName;
        },
        _getSortedSizes: function(sizes) {
            "use strict";
            sizes = qq.extend([], sizes);
            return sizes.sort(function(a, b) {
                if (a.maxSize > b.maxSize) {
                    return 1;
                }
                if (a.maxSize < b.maxSize) {
                    return -1;
                }
                return 0;
            });
        },
        _generateScaledImage: function(spec, sourceFile) {
            "use strict";
            var self = this, customResizeFunction = spec.customResizeFunction, log = spec.log, maxSize = spec.maxSize, orient = spec.orient, type = spec.type, quality = spec.quality, failedText = spec.failedText, includeExif = spec.includeExif && sourceFile.type === "image/jpeg" && type === "image/jpeg", scalingEffort = new qq.Promise(), imageGenerator = new qq.ImageGenerator(log), canvas = document.createElement("canvas");
            log("Attempting to generate scaled version for " + sourceFile.name);
            imageGenerator.generate(sourceFile, canvas, {
                maxSize: maxSize,
                orient: orient,
                customResizeFunction: customResizeFunction
            }).then(function() {
                var scaledImageDataUri = canvas.toDataURL(type, quality), signalSuccess = function() {
                    log("Success generating scaled version for " + sourceFile.name);
                    var blob = qq.dataUriToBlob(scaledImageDataUri);
                    scalingEffort.success(blob);
                };
                if (includeExif) {
                    self._insertExifHeader(sourceFile, scaledImageDataUri, log).then(function(scaledImageDataUriWithExif) {
                        scaledImageDataUri = scaledImageDataUriWithExif;
                        signalSuccess();
                    }, function() {
                        log("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.", "error");
                        signalSuccess();
                    });
                } else {
                    signalSuccess();
                }
            }, function() {
                log("Failed attempt to generate scaled version for " + sourceFile.name, "error");
                scalingEffort.failure(failedText);
            });
            return scalingEffort;
        },
        _insertExifHeader: function(originalImage, scaledImageDataUri, log) {
            "use strict";
            var reader = new FileReader(), insertionEffort = new qq.Promise(), originalImageDataUri = "";
            reader.onload = function() {
                originalImageDataUri = reader.result;
                insertionEffort.success(qq.ExifRestorer.restore(originalImageDataUri, scaledImageDataUri));
            };
            reader.onerror = function() {
                log("Problem reading " + originalImage.name + " during attempt to transfer EXIF data to scaled version.", "error");
                insertionEffort.failure();
            };
            reader.readAsDataURL(originalImage);
            return insertionEffort;
        },
        _dataUriToBlob: function(dataUri) {
            "use strict";
            var byteString, mimeString, arrayBuffer, intArray;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return this._createBlob(arrayBuffer, mimeString);
        },
        _createBlob: function(data, mime) {
            "use strict";
            var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
            if (blobBuilder) {
                blobBuilder.append(data);
                return blobBuilder.getBlob(mime);
            } else {
                return new Blob([ data ], {
                    type: mime
                });
            }
        }
    });
    qq.ExifRestorer = function() {
        var ExifRestorer = {};
        ExifRestorer.KEY_STR = "ABCDEFGHIJKLMNOP" + "QRSTUVWXYZabcdef" + "ghijklmnopqrstuv" + "wxyz0123456789+/" + "=";
        ExifRestorer.encode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0;
            do {
                chr1 = input[i++];
                chr2 = input[i++];
                chr3 = input[i++];
                enc1 = chr1 >> 2;
                enc2 = (chr1 & 3) << 4 | chr2 >> 4;
                enc3 = (chr2 & 15) << 2 | chr3 >> 6;
                enc4 = chr3 & 63;
                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }
                output = output + this.KEY_STR.charAt(enc1) + this.KEY_STR.charAt(enc2) + this.KEY_STR.charAt(enc3) + this.KEY_STR.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return output;
        };
        ExifRestorer.restore = function(origFileBase64, resizedFileBase64) {
            var expectedBase64Header = "data:image/jpeg;base64,";
            if (!origFileBase64.match(expectedBase64Header)) {
                return resizedFileBase64;
            }
            var rawImage = this.decode64(origFileBase64.replace(expectedBase64Header, ""));
            var segments = this.slice2Segments(rawImage);
            var image = this.exifManipulation(resizedFileBase64, segments);
            return expectedBase64Header + this.encode64(image);
        };
        ExifRestorer.exifManipulation = function(resizedFileBase64, segments) {
            var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray), aBuffer = new Uint8Array(newImageArray);
            return aBuffer;
        };
        ExifRestorer.getExifArray = function(segments) {
            var seg;
            for (var x = 0; x < segments.length; x++) {
                seg = segments[x];
                if (seg[0] == 255 & seg[1] == 225) {
                    return seg;
                }
            }
            return [];
        };
        ExifRestorer.insertExif = function(resizedFileBase64, exifArray) {
            var imageData = resizedFileBase64.replace("data:image/jpeg;base64,", ""), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
            array = array.concat(exifArray);
            array = array.concat(ato);
            return array;
        };
        ExifRestorer.slice2Segments = function(rawImageArray) {
            var head = 0, segments = [];
            while (1) {
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 218) {
                    break;
                }
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 216) {
                    head += 2;
                } else {
                    var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3], endPoint = head + length + 2, seg = rawImageArray.slice(head, endPoint);
                    segments.push(seg);
                    head = endPoint;
                }
                if (head > rawImageArray.length) {
                    break;
                }
            }
            return segments;
        };
        ExifRestorer.decode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0, buf = [];
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                throw new Error("There were invalid base64 characters in the input text.  " + "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
            do {
                enc1 = this.KEY_STR.indexOf(input.charAt(i++));
                enc2 = this.KEY_STR.indexOf(input.charAt(i++));
                enc3 = this.KEY_STR.indexOf(input.charAt(i++));
                enc4 = this.KEY_STR.indexOf(input.charAt(i++));
                chr1 = enc1 << 2 | enc2 >> 4;
                chr2 = (enc2 & 15) << 4 | enc3 >> 2;
                chr3 = (enc3 & 3) << 6 | enc4;
                buf.push(chr1);
                if (enc3 != 64) {
                    buf.push(chr2);
                }
                if (enc4 != 64) {
                    buf.push(chr3);
                }
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return buf;
        };
        return ExifRestorer;
    }();
    qq.TotalProgress = function(callback, getSize) {
        "use strict";
        var perFileProgress = {}, totalLoaded = 0, totalSize = 0, lastLoadedSent = -1, lastTotalSent = -1, callbackProxy = function(loaded, total) {
            if (loaded !== lastLoadedSent || total !== lastTotalSent) {
                callback(loaded, total);
            }
            lastLoadedSent = loaded;
            lastTotalSent = total;
        }, noRetryableFiles = function(failed, retryable) {
            var none = true;
            qq.each(failed, function(idx, failedId) {
                if (qq.indexOf(retryable, failedId) >= 0) {
                    none = false;
                    return false;
                }
            });
            return none;
        }, onCancel = function(id) {
            updateTotalProgress(id, -1, -1);
            delete perFileProgress[id];
        }, onAllComplete = function(successful, failed, retryable) {
            if (failed.length === 0 || noRetryableFiles(failed, retryable)) {
                callbackProxy(totalSize, totalSize);
                this.reset();
            }
        }, onNew = function(id) {
            var size = getSize(id);
            if (size > 0) {
                updateTotalProgress(id, 0, size);
                perFileProgress[id] = {
                    loaded: 0,
                    total: size
                };
            }
        }, updateTotalProgress = function(id, newLoaded, newTotal) {
            var oldLoaded = perFileProgress[id] ? perFileProgress[id].loaded : 0, oldTotal = perFileProgress[id] ? perFileProgress[id].total : 0;
            if (newLoaded === -1 && newTotal === -1) {
                totalLoaded -= oldLoaded;
                totalSize -= oldTotal;
            } else {
                if (newLoaded) {
                    totalLoaded += newLoaded - oldLoaded;
                }
                if (newTotal) {
                    totalSize += newTotal - oldTotal;
                }
            }
            callbackProxy(totalLoaded, totalSize);
        };
        qq.extend(this, {
            onAllComplete: onAllComplete,
            onStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.CANCELED || newStatus === qq.status.REJECTED) {
                    onCancel(id);
                } else if (newStatus === qq.status.SUBMITTING) {
                    onNew(id);
                }
            },
            onIndividualProgress: function(id, loaded, total) {
                updateTotalProgress(id, loaded, total);
                perFileProgress[id] = {
                    loaded: loaded,
                    total: total
                };
            },
            onNewSize: function(id) {
                onNew(id);
            },
            reset: function() {
                perFileProgress = {};
                totalLoaded = 0;
                totalSize = 0;
            }
        });
    };
    qq.PasteSupport = function(o) {
        "use strict";
        var options, detachPasteHandler;
        options = {
            targetElement: null,
            callbacks: {
                log: function(message, level) {},
                pasteReceived: function(blob) {}
            }
        };
        function isImage(item) {
            return item.type && item.type.indexOf("image/") === 0;
        }
        function registerPasteHandler() {
            detachPasteHandler = qq(options.targetElement).attach("paste", function(event) {
                var clipboardData = event.clipboardData;
                if (clipboardData) {
                    qq.each(clipboardData.items, function(idx, item) {
                        if (isImage(item)) {
                            var blob = item.getAsFile();
                            options.callbacks.pasteReceived(blob);
                        }
                    });
                }
            });
        }
        function unregisterPasteHandler() {
            if (detachPasteHandler) {
                detachPasteHandler();
            }
        }
        qq.extend(options, o);
        registerPasteHandler();
        qq.extend(this, {
            reset: function() {
                unregisterPasteHandler();
            }
        });
    };
    qq.FormSupport = function(options, startUpload, log) {
        "use strict";
        var self = this, interceptSubmit = options.interceptSubmit, formEl = options.element, autoUpload = options.autoUpload;
        qq.extend(this, {
            newEndpoint: null,
            newAutoUpload: autoUpload,
            attachedToForm: false,
            getFormInputsAsObject: function() {
                if (formEl == null) {
                    return null;
                }
                return self._form2Obj(formEl);
            }
        });
        function determineNewEndpoint(formEl) {
            if (formEl.getAttribute("action")) {
                self.newEndpoint = formEl.getAttribute("action");
            }
        }
        function validateForm(formEl, nativeSubmit) {
            if (formEl.checkValidity && !formEl.checkValidity()) {
                log("Form did not pass validation checks - will not upload.", "error");
                nativeSubmit();
            } else {
                return true;
            }
        }
        function maybeUploadOnSubmit(formEl) {
            var nativeSubmit = formEl.submit;
            qq(formEl).attach("submit", function(event) {
                event = event || window.event;
                if (event.preventDefault) {
                    event.preventDefault();
                } else {
                    event.returnValue = false;
                }
                validateForm(formEl, nativeSubmit) && startUpload();
            });
            formEl.submit = function() {
                validateForm(formEl, nativeSubmit) && startUpload();
            };
        }
        function determineFormEl(formEl) {
            if (formEl) {
                if (qq.isString(formEl)) {
                    formEl = document.getElementById(formEl);
                }
                if (formEl) {
                    log("Attaching to form element.");
                    determineNewEndpoint(formEl);
                    interceptSubmit && maybeUploadOnSubmit(formEl);
                }
            }
            return formEl;
        }
        formEl = determineFormEl(formEl);
        this.attachedToForm = !!formEl;
    };
    qq.extend(qq.FormSupport.prototype, {
        _form2Obj: function(form) {
            "use strict";
            var obj = {}, notIrrelevantType = function(type) {
                var irrelevantTypes = [ "button", "image", "reset", "submit" ];
                return qq.indexOf(irrelevantTypes, type.toLowerCase()) < 0;
            }, radioOrCheckbox = function(type) {
                return qq.indexOf([ "checkbox", "radio" ], type.toLowerCase()) >= 0;
            }, ignoreValue = function(el) {
                if (radioOrCheckbox(el.type) && !el.checked) {
                    return true;
                }
                return el.disabled && el.type.toLowerCase() !== "hidden";
            }, selectValue = function(select) {
                var value = null;
                qq.each(qq(select).children(), function(idx, child) {
                    if (child.tagName.toLowerCase() === "option" && child.selected) {
                        value = child.value;
                        return false;
                    }
                });
                return value;
            };
            qq.each(form.elements, function(idx, el) {
                if ((qq.isInput(el, true) || el.tagName.toLowerCase() === "textarea") && notIrrelevantType(el.type) && !ignoreValue(el)) {
                    obj[el.name] = el.value;
                } else if (el.tagName.toLowerCase() === "select" && !ignoreValue(el)) {
                    var value = selectValue(el);
                    if (value !== null) {
                        obj[el.name] = value;
                    }
                }
            });
            return obj;
        }
    });
    qq.traditional = qq.traditional || {};
    qq.traditional.FormUploadHandler = function(options, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getUuid = proxy.getUuid, log = proxy.log;
        function getIframeContentJson(id, iframe) {
            var response, doc, innerHtml;
            try {
                doc = iframe.contentDocument || iframe.contentWindow.document;
                innerHtml = doc.body.innerHTML;
                log("converting iframe's innerHTML to JSON");
                log("innerHTML = " + innerHtml);
                if (innerHtml && innerHtml.match(/^<pre/i)) {
                    innerHtml = doc.body.firstChild.firstChild.nodeValue;
                }
                response = handler._parseJsonResponse(innerHtml);
            } catch (error) {
                log("Error when attempting to parse form upload response (" + error.message + ")", "error");
                response = {
                    success: false
                };
            }
            return response;
        }
        function createForm(id, iframe) {
            var params = options.paramsStore.get(id), method = options.method.toLowerCase() === "get" ? "GET" : "POST", endpoint = options.endpointStore.get(id), name = getName(id);
            params[options.uuidName] = getUuid(id);
            params[options.filenameParam] = name;
            return handler._initFormForUpload({
                method: method,
                endpoint: endpoint,
                params: params,
                paramsInBody: options.paramsInBody,
                targetName: iframe.name
            });
        }
        this.uploadFile = function(id) {
            var input = handler.getInput(id), iframe = handler._createIframe(id), promise = new qq.Promise(), form;
            form = createForm(id, iframe);
            form.appendChild(input);
            handler._attachLoadEvent(iframe, function(responseFromMessage) {
                log("iframe loaded");
                var response = responseFromMessage ? responseFromMessage : getIframeContentJson(id, iframe);
                handler._detachLoadEvent(id);
                if (!options.cors.expected) {
                    qq(iframe).remove();
                }
                if (response.success) {
                    promise.success(response);
                } else {
                    promise.failure(response);
                }
            });
            log("Sending upload request for " + id);
            form.submit();
            qq(form).remove();
            return promise;
        };
        qq.extend(this, new qq.FormUploadHandler({
            options: {
                isCors: options.cors.expected,
                inputName: options.inputName
            },
            proxy: {
                onCancel: options.onCancel,
                getName: getName,
                getUuid: getUuid,
                log: log
            }
        }));
    };
    qq.traditional = qq.traditional || {};
    qq.traditional.XhrUploadHandler = function(spec, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, log = proxy.log, multipart = spec.forceMultipart || spec.paramsInBody, addChunkingSpecificParams = function(id, params, chunkData) {
            var size = getSize(id), name = getName(id);
            if (!spec.omitDefaultParams) {
                params[spec.chunking.paramNames.partIndex] = chunkData.part;
                params[spec.chunking.paramNames.partByteOffset] = chunkData.start;
                params[spec.chunking.paramNames.chunkSize] = chunkData.size;
                params[spec.chunking.paramNames.totalParts] = chunkData.count;
                params[spec.totalFileSizeName] = size;
            }
            if (multipart && !spec.omitDefaultParams) {
                params[spec.filenameParam] = name;
            }
        }, allChunksDoneRequester = new qq.traditional.AllChunksDoneAjaxRequester({
            cors: spec.cors,
            endpoint: spec.chunking.success.endpoint,
            headers: spec.chunking.success.headers,
            jsonPayload: spec.chunking.success.jsonPayload,
            log: log,
            method: spec.chunking.success.method,
            params: spec.chunking.success.params
        }), createReadyStateChangedHandler = function(id, xhr) {
            var promise = new qq.Promise();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    var result = onUploadOrChunkComplete(id, xhr);
                    if (result.success) {
                        promise.success(result.response, xhr);
                    } else {
                        promise.failure(result.response, xhr);
                    }
                }
            };
            return promise;
        }, getChunksCompleteParams = function(id) {
            var params = spec.paramsStore.get(id), name = getName(id), size = getSize(id);
            params[spec.uuidName] = getUuid(id);
            params[spec.filenameParam] = name;
            params[spec.totalFileSizeName] = size;
            params[spec.chunking.paramNames.totalParts] = handler._getTotalChunks(id);
            return params;
        }, isErrorUploadResponse = function(xhr, response) {
            return qq.indexOf([ 200, 201, 202, 203, 204 ], xhr.status) < 0 || spec.requireSuccessJson && !response.success || response.reset;
        }, onUploadOrChunkComplete = function(id, xhr) {
            var response;
            log("xhr - server response received for " + id);
            log("responseText = " + xhr.responseText);
            response = parseResponse(true, xhr);
            return {
                success: !isErrorUploadResponse(xhr, response),
                response: response
            };
        }, parseResponse = function(upload, xhr) {
            var response = {};
            try {
                log(qq.format("Received response status {} with body: {}", xhr.status, xhr.responseText));
                response = qq.parseJson(xhr.responseText);
            } catch (error) {
                upload && spec.requireSuccessJson && log("Error when attempting to parse xhr response text (" + error.message + ")", "error");
            }
            return response;
        }, sendChunksCompleteRequest = function(id) {
            var promise = new qq.Promise();
            allChunksDoneRequester.complete(id, handler._createXhr(id), getChunksCompleteParams(id), spec.customHeaders.get(id)).then(function(xhr) {
                promise.success(parseResponse(false, xhr), xhr);
            }, function(xhr) {
                promise.failure(parseResponse(false, xhr), xhr);
            });
            return promise;
        }, setParamsAndGetEntityToSend = function(entityToSendParams) {
            var fileOrBlob = entityToSendParams.fileOrBlob;
            var id = entityToSendParams.id;
            var xhr = entityToSendParams.xhr;
            var xhrOverrides = entityToSendParams.xhrOverrides || {};
            var customParams = entityToSendParams.customParams || {};
            var defaultParams = entityToSendParams.params || {};
            var xhrOverrideParams = xhrOverrides.params || {};
            var params;
            var formData = multipart ? new FormData() : null, method = xhrOverrides.method || spec.method, endpoint = xhrOverrides.endpoint || spec.endpointStore.get(id), name = getName(id), size = getSize(id);
            if (spec.omitDefaultParams) {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
            } else {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
                qq.extend(params, defaultParams);
                params[spec.uuidName] = getUuid(id);
                params[spec.filenameParam] = name;
                if (multipart) {
                    params[spec.totalFileSizeName] = size;
                } else if (!spec.paramsInBody) {
                    params[spec.inputName] = name;
                }
            }
            if (!spec.paramsInBody) {
                endpoint = qq.obj2url(params, endpoint);
            }
            xhr.open(method, endpoint, true);
            if (spec.cors.expected && spec.cors.sendCredentials) {
                xhr.withCredentials = true;
            }
            if (multipart) {
                if (spec.paramsInBody) {
                    qq.obj2FormData(params, formData);
                }
                formData.append(spec.inputName, fileOrBlob);
                return formData;
            }
            return fileOrBlob;
        }, setUploadHeaders = function(headersOptions) {
            var headerOverrides = headersOptions.headerOverrides;
            var id = headersOptions.id;
            var xhr = headersOptions.xhr;
            if (headerOverrides) {
                qq.each(headerOverrides, function(headerName, headerValue) {
                    xhr.setRequestHeader(headerName, headerValue);
                });
            } else {
                var extraHeaders = spec.customHeaders.get(id), fileOrBlob = handler.getFile(id);
                xhr.setRequestHeader("Accept", "application/json");
                xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                xhr.setRequestHeader("Cache-Control", "no-cache");
                if (!multipart) {
                    xhr.setRequestHeader("Content-Type", "application/octet-stream");
                    xhr.setRequestHeader("X-Mime-Type", fileOrBlob.type);
                }
                qq.each(extraHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        };
        qq.extend(this, {
            uploadChunk: function(uploadChunkParams) {
                var id = uploadChunkParams.id;
                var chunkIdx = uploadChunkParams.chunkIdx;
                var overrides = uploadChunkParams.overrides || {};
                var resuming = uploadChunkParams.resuming;
                var chunkData = handler._getChunkData(id, chunkIdx), xhr = handler._createXhr(id, chunkIdx), promise, toSend, customParams, params = {};
                promise = createReadyStateChangedHandler(id, xhr);
                handler._registerProgressHandler(id, chunkIdx, chunkData.size);
                customParams = spec.paramsStore.get(id);
                addChunkingSpecificParams(id, params, chunkData);
                if (resuming) {
                    params[spec.resume.paramNames.resuming] = true;
                }
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: chunkData.blob,
                    id: id,
                    customParams: customParams,
                    params: params,
                    xhr: xhr,
                    xhrOverrides: overrides
                });
                setUploadHeaders({
                    headerOverrides: overrides.headers,
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            },
            uploadFile: function(id) {
                var fileOrBlob = handler.getFile(id), promise, xhr, customParams, toSend;
                xhr = handler._createXhr(id);
                handler._registerProgressHandler(id);
                promise = createReadyStateChangedHandler(id, xhr);
                customParams = spec.paramsStore.get(id);
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: fileOrBlob,
                    id: id,
                    customParams: customParams,
                    xhr: xhr
                });
                setUploadHeaders({
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            }
        });
        qq.extend(this, new qq.XhrUploadHandler({
            options: qq.extend({
                namespace: "traditional"
            }, spec),
            proxy: qq.extend({
                getEndpoint: spec.endpointStore.get
            }, proxy)
        }));
        qq.override(this, function(super_) {
            return {
                finalizeChunks: function(id) {
                    proxy.onFinalizing(id);
                    if (spec.chunking.success.endpoint) {
                        return sendChunksCompleteRequest(id);
                    } else {
                        return super_.finalizeChunks(id, qq.bind(parseResponse, this, true));
                    }
                }
            };
        });
    };
    qq.traditional.AllChunksDoneAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            cors: {
                allowXdr: false,
                expected: false,
                sendCredentials: false
            },
            endpoint: null,
            log: function(str, level) {},
            method: "POST"
        }, promises = {}, endpointHandler = {
            get: function(id) {
                if (qq.isFunction(options.endpoint)) {
                    return options.endpoint(id);
                }
                return options.endpoint;
            }
        };
        qq.extend(options, o);
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            contentType: options.jsonPayload ? "application/json" : "application/x-www-form-urlencoded",
            validMethods: [ options.method ],
            method: options.method,
            endpointStore: endpointHandler,
            allowXRequestedWithAndCacheControl: false,
            cors: options.cors,
            log: options.log,
            onComplete: function(id, xhr, isError) {
                var promise = promises[id];
                delete promises[id];
                if (isError) {
                    promise.failure(xhr);
                } else {
                    promise.success(xhr);
                }
            }
        }));
        qq.extend(this, {
            complete: function(id, xhr, params, headers) {
                var promise = new qq.Promise();
                options.log("Submitting All Chunks Done request for " + id);
                promises[id] = promise;
                requester.initTransport(id).withParams(options.params(id) || params).withHeaders(options.headers(id) || headers).send(xhr);
                return promise;
            }
        });
    };
    qq.DragAndDrop = function(o) {
        "use strict";
        var options, HIDE_ZONES_EVENT_NAME = "qq-hidezones", HIDE_BEFORE_ENTER_ATTR = "qq-hide-dropzone", uploadDropZones = [], droppedFiles = [], disposeSupport = new qq.DisposeSupport();
        options = {
            dropZoneElements: [],
            allowMultipleItems: true,
            classes: {
                dropActive: null
            },
            callbacks: new qq.DragAndDrop.callbacks()
        };
        qq.extend(options, o, true);
        function uploadDroppedFiles(files, uploadDropZone) {
            var filesAsArray = Array.prototype.slice.call(files);
            options.callbacks.dropLog("Grabbed " + files.length + " dropped files.");
            uploadDropZone.dropDisabled(false);
            options.callbacks.processingDroppedFilesComplete(filesAsArray, uploadDropZone.getElement());
        }
        function traverseFileTree(entry) {
            var parseEntryPromise = new qq.Promise();
            if (entry.isFile) {
                entry.file(function(file) {
                    file.qqPath = extractDirectoryPath(entry);
                    droppedFiles.push(file);
                    parseEntryPromise.success();
                }, function(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            } else if (entry.isDirectory) {
                getFilesInDirectory(entry).then(function allEntriesRead(entries) {
                    var entriesLeft = entries.length;
                    qq.each(entries, function(idx, entry) {
                        traverseFileTree(entry).done(function() {
                            entriesLeft -= 1;
                            if (entriesLeft === 0) {
                                parseEntryPromise.success();
                            }
                        });
                    });
                    if (!entries.length) {
                        parseEntryPromise.success();
                    }
                }, function readFailure(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            }
            return parseEntryPromise;
        }
        function extractDirectoryPath(entry) {
            var name = entry.name, fullPath = entry.fullPath, indexOfNameInFullPath = fullPath.lastIndexOf(name);
            fullPath = fullPath.substr(0, indexOfNameInFullPath);
            if (fullPath.charAt(0) === "/") {
                fullPath = fullPath.substr(1);
            }
            return fullPath;
        }
        function getFilesInDirectory(entry, reader, accumEntries, existingPromise) {
            var promise = existingPromise || new qq.Promise(), dirReader = reader || entry.createReader();
            dirReader.readEntries(function readSuccess(entries) {
                var newEntries = accumEntries ? accumEntries.concat(entries) : entries;
                if (entries.length) {
                    setTimeout(function() {
                        getFilesInDirectory(entry, dirReader, newEntries, promise);
                    }, 0);
                } else {
                    promise.success(newEntries);
                }
            }, promise.failure);
            return promise;
        }
        function handleDataTransfer(dataTransfer, uploadDropZone) {
            var pendingFolderPromises = [], handleDataTransferPromise = new qq.Promise();
            options.callbacks.processingDroppedFiles();
            uploadDropZone.dropDisabled(true);
            if (dataTransfer.files.length > 1 && !options.allowMultipleItems) {
                options.callbacks.processingDroppedFilesComplete([]);
                options.callbacks.dropError("tooManyFilesError", "");
                uploadDropZone.dropDisabled(false);
                handleDataTransferPromise.failure();
            } else {
                droppedFiles = [];
                if (qq.isFolderDropSupported(dataTransfer)) {
                    qq.each(dataTransfer.items, function(idx, item) {
                        var entry = item.webkitGetAsEntry();
                        if (entry) {
                            if (entry.isFile) {
                                droppedFiles.push(item.getAsFile());
                            } else {
                                pendingFolderPromises.push(traverseFileTree(entry).done(function() {
                                    pendingFolderPromises.pop();
                                    if (pendingFolderPromises.length === 0) {
                                        handleDataTransferPromise.success();
                                    }
                                }));
                            }
                        }
                    });
                } else {
                    droppedFiles = dataTransfer.files;
                }
                if (pendingFolderPromises.length === 0) {
                    handleDataTransferPromise.success();
                }
            }
            return handleDataTransferPromise;
        }
        function setupDropzone(dropArea) {
            var dropZone = new qq.UploadDropZone({
                HIDE_ZONES_EVENT_NAME: HIDE_ZONES_EVENT_NAME,
                element: dropArea,
                onEnter: function(e) {
                    qq(dropArea).addClass(options.classes.dropActive);
                    e.stopPropagation();
                },
                onLeaveNotDescendants: function(e) {
                    qq(dropArea).removeClass(options.classes.dropActive);
                },
                onDrop: function(e) {
                    handleDataTransfer(e.dataTransfer, dropZone).then(function() {
                        uploadDroppedFiles(droppedFiles, dropZone);
                    }, function() {
                        options.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.", "error");
                    });
                }
            });
            disposeSupport.addDisposer(function() {
                dropZone.dispose();
            });
            qq(dropArea).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropArea).hide();
            uploadDropZones.push(dropZone);
            return dropZone;
        }
        function isFileDrag(dragEvent) {
            var fileDrag;
            qq.each(dragEvent.dataTransfer.types, function(key, val) {
                if (val === "Files") {
                    fileDrag = true;
                    return false;
                }
            });
            return fileDrag;
        }
        function leavingDocumentOut(e) {
            if (qq.safari()) {
                return e.x < 0 || e.y < 0;
            }
            return e.x === 0 && e.y === 0;
        }
        function setupDragDrop() {
            var dropZones = options.dropZoneElements, maybeHideDropZones = function() {
                setTimeout(function() {
                    qq.each(dropZones, function(idx, dropZone) {
                        qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropZone).hide();
                        qq(dropZone).removeClass(options.classes.dropActive);
                    });
                }, 10);
            };
            qq.each(dropZones, function(idx, dropZone) {
                var uploadDropZone = setupDropzone(dropZone);
                if (dropZones.length && qq.supportedFeatures.fileDrop) {
                    disposeSupport.attach(document, "dragenter", function(e) {
                        if (!uploadDropZone.dropDisabled() && isFileDrag(e)) {
                            qq.each(dropZones, function(idx, dropZone) {
                                if (dropZone instanceof HTMLElement && qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)) {
                                    qq(dropZone).css({
                                        display: "block"
                                    });
                                }
                            });
                        }
                    });
                }
            });
            disposeSupport.attach(document, "dragleave", function(e) {
                if (leavingDocumentOut(e)) {
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(qq(document).children()[0], "mouseenter", function(e) {
                maybeHideDropZones();
            });
            disposeSupport.attach(document, "drop", function(e) {
                if (isFileDrag(e)) {
                    e.preventDefault();
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(document, HIDE_ZONES_EVENT_NAME, maybeHideDropZones);
        }
        setupDragDrop();
        qq.extend(this, {
            setupExtraDropzone: function(element) {
                options.dropZoneElements.push(element);
                setupDropzone(element);
            },
            removeDropzone: function(element) {
                var i, dzs = options.dropZoneElements;
                for (i in dzs) {
                    if (dzs[i] === element) {
                        return dzs.splice(i, 1);
                    }
                }
            },
            dispose: function() {
                disposeSupport.dispose();
                qq.each(uploadDropZones, function(idx, dropZone) {
                    dropZone.dispose();
                });
            }
        });
        this._testing = {};
        this._testing.extractDirectoryPath = extractDirectoryPath;
    };
    qq.DragAndDrop.callbacks = function() {
        "use strict";
        return {
            processingDroppedFiles: function() {},
            processingDroppedFilesComplete: function(files, targetEl) {},
            dropError: function(code, errorSpecifics) {
                qq.log("Drag & drop error code '" + code + " with these specifics: '" + errorSpecifics + "'", "error");
            },
            dropLog: function(message, level) {
                qq.log(message, level);
            }
        };
    };
    qq.UploadDropZone = function(o) {
        "use strict";
        var disposeSupport = new qq.DisposeSupport(), options, element, preventDrop, dropOutsideDisabled;
        options = {
            element: null,
            onEnter: function(e) {},
            onLeave: function(e) {},
            onLeaveNotDescendants: function(e) {},
            onDrop: function(e) {}
        };
        qq.extend(options, o);
        element = options.element;
        function dragoverShouldBeCanceled() {
            return qq.safari() || qq.firefox() && qq.windows();
        }
        function disableDropOutside(e) {
            if (!dropOutsideDisabled) {
                if (dragoverShouldBeCanceled) {
                    disposeSupport.attach(document, "dragover", function(e) {
                        e.preventDefault();
                    });
                } else {
                    disposeSupport.attach(document, "dragover", function(e) {
                        if (e.dataTransfer) {
                            e.dataTransfer.dropEffect = "none";
                            e.preventDefault();
                        }
                    });
                }
                dropOutsideDisabled = true;
            }
        }
        function isValidFileDrag(e) {
            if (!qq.supportedFeatures.fileDrop) {
                return false;
            }
            var effectTest, dt = e.dataTransfer, isSafari = qq.safari();
            effectTest = qq.ie() && qq.supportedFeatures.fileDrop ? true : dt.effectAllowed !== "none";
            return dt && effectTest && (dt.files && dt.files.length || !isSafari && dt.types.contains && dt.types.contains("Files") || dt.types.includes && dt.types.includes("Files"));
        }
        function isOrSetDropDisabled(isDisabled) {
            if (isDisabled !== undefined) {
                preventDrop = isDisabled;
            }
            return preventDrop;
        }
        function triggerHidezonesEvent() {
            var hideZonesEvent;
            function triggerUsingOldApi() {
                hideZonesEvent = document.createEvent("Event");
                hideZonesEvent.initEvent(options.HIDE_ZONES_EVENT_NAME, true, true);
            }
            if (window.CustomEvent) {
                try {
                    hideZonesEvent = new CustomEvent(options.HIDE_ZONES_EVENT_NAME);
                } catch (err) {
                    triggerUsingOldApi();
                }
            } else {
                triggerUsingOldApi();
            }
            document.dispatchEvent(hideZonesEvent);
        }
        function attachEvents() {
            disposeSupport.attach(element, "dragover", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                var effect = qq.ie() && qq.supportedFeatures.fileDrop ? null : e.dataTransfer.effectAllowed;
                if (effect === "move" || effect === "linkMove") {
                    e.dataTransfer.dropEffect = "move";
                } else {
                    e.dataTransfer.dropEffect = "copy";
                }
                e.stopPropagation();
                e.preventDefault();
            });
            disposeSupport.attach(element, "dragenter", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    options.onEnter(e);
                }
            });
            disposeSupport.attach(element, "dragleave", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                options.onLeave(e);
                var relatedTarget = document.elementFromPoint(e.clientX, e.clientY);
                if (qq(this).contains(relatedTarget)) {
                    return;
                }
                options.onLeaveNotDescendants(e);
            });
            disposeSupport.attach(element, "drop", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    e.preventDefault();
                    e.stopPropagation();
                    options.onDrop(e);
                    triggerHidezonesEvent();
                }
            });
        }
        disableDropOutside();
        attachEvents();
        qq.extend(this, {
            dropDisabled: function(isDisabled) {
                return isOrSetDropDisabled(isDisabled);
            },
            dispose: function() {
                disposeSupport.dispose();
            },
            getElement: function() {
                return element;
            }
        });
        this._testing = {};
        this._testing.isValidFileDrag = isValidFileDrag;
    };
    (function() {
        "use strict";
        qq.uiPublicApi = {
            addInitialFiles: function(cannedFileList) {
                this._parent.prototype.addInitialFiles.apply(this, arguments);
                this._templating.addCacheToDom();
            },
            clearStoredFiles: function() {
                this._parent.prototype.clearStoredFiles.apply(this, arguments);
                this._templating.clearFiles();
            },
            addExtraDropzone: function(element) {
                this._dnd && this._dnd.setupExtraDropzone(element);
            },
            removeExtraDropzone: function(element) {
                if (this._dnd) {
                    return this._dnd.removeDropzone(element);
                }
            },
            getItemByFileId: function(id) {
                if (!this._templating.isHiddenForever(id)) {
                    return this._templating.getFileContainer(id);
                }
            },
            reset: function() {
                this._parent.prototype.reset.apply(this, arguments);
                this._templating.reset();
                if (!this._options.button && this._templating.getButton()) {
                    this._defaultButtonId = this._createUploadButton({
                        element: this._templating.getButton(),
                        title: this._options.text.fileInputTitle
                    }).getButtonId();
                }
                if (this._dnd) {
                    this._dnd.dispose();
                    this._dnd = this._setupDragAndDrop();
                }
                this._totalFilesInBatch = 0;
                this._filesInBatchAddedToUi = 0;
                this._setupClickAndEditEventHandlers();
            },
            setName: function(id, newName) {
                var formattedFilename = this._options.formatFileName(newName);
                this._parent.prototype.setName.apply(this, arguments);
                this._templating.updateFilename(id, formattedFilename);
            },
            pauseUpload: function(id) {
                var paused = this._parent.prototype.pauseUpload.apply(this, arguments);
                paused && this._templating.uploadPaused(id);
                return paused;
            },
            continueUpload: function(id) {
                var continued = this._parent.prototype.continueUpload.apply(this, arguments);
                continued && this._templating.uploadContinued(id);
                return continued;
            },
            getId: function(fileContainerOrChildEl) {
                return this._templating.getFileId(fileContainerOrChildEl);
            },
            getDropTarget: function(fileId) {
                var file = this.getFile(fileId);
                return file.qqDropTarget;
            }
        };
        qq.uiPrivateApi = {
            _getButton: function(buttonId) {
                var button = this._parent.prototype._getButton.apply(this, arguments);
                if (!button) {
                    if (buttonId === this._defaultButtonId) {
                        button = this._templating.getButton();
                    }
                }
                return button;
            },
            _removeFileItem: function(fileId) {
                this._templating.removeFile(fileId);
            },
            _setupClickAndEditEventHandlers: function() {
                this._fileButtonsClickHandler = qq.FileButtonsClickHandler && this._bindFileButtonsClickEvent();
                this._focusinEventSupported = !qq.firefox();
                if (this._isEditFilenameEnabled()) {
                    this._filenameClickHandler = this._bindFilenameClickEvent();
                    this._filenameInputFocusInHandler = this._bindFilenameInputFocusInEvent();
                    this._filenameInputFocusHandler = this._bindFilenameInputFocusEvent();
                }
            },
            _setupDragAndDrop: function() {
                var self = this, dropZoneElements = this._options.dragAndDrop.extraDropzones, templating = this._templating, defaultDropZone = templating.getDropZone();
                defaultDropZone && dropZoneElements.push(defaultDropZone);
                return new qq.DragAndDrop({
                    dropZoneElements: dropZoneElements,
                    allowMultipleItems: this._options.multiple,
                    classes: {
                        dropActive: this._options.classes.dropActive
                    },
                    callbacks: {
                        processingDroppedFiles: function() {
                            templating.showDropProcessing();
                        },
                        processingDroppedFilesComplete: function(files, targetEl) {
                            templating.hideDropProcessing();
                            qq.each(files, function(idx, file) {
                                file.qqDropTarget = targetEl;
                            });
                            if (files.length) {
                                self.addFiles(files, null, null);
                            }
                        },
                        dropError: function(code, errorData) {
                            self._itemError(code, errorData);
                        },
                        dropLog: function(message, level) {
                            self.log(message, level);
                        }
                    }
                });
            },
            _bindFileButtonsClickEvent: function() {
                var self = this;
                return new qq.FileButtonsClickHandler({
                    templating: this._templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onDeleteFile: function(fileId) {
                        self.deleteFile(fileId);
                    },
                    onCancel: function(fileId) {
                        self.cancel(fileId);
                    },
                    onRetry: function(fileId) {
                        self.retry(fileId);
                    },
                    onPause: function(fileId) {
                        self.pauseUpload(fileId);
                    },
                    onContinue: function(fileId) {
                        self.continueUpload(fileId);
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    }
                });
            },
            _isEditFilenameEnabled: function() {
                return this._templating.isEditFilenamePossible() && !this._options.autoUpload && qq.FilenameClickHandler && qq.FilenameInputFocusHandler && qq.FilenameInputFocusHandler;
            },
            _filenameEditHandler: function() {
                var self = this, templating = this._templating;
                return {
                    templating: templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onGetUploadStatus: function(fileId) {
                        return self.getUploads({
                            id: fileId
                        }).status;
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    },
                    onSetName: function(id, newName) {
                        self.setName(id, newName);
                    },
                    onEditingStatusChange: function(id, isEditing) {
                        var qqInput = qq(templating.getEditInput(id)), qqFileContainer = qq(templating.getFileContainer(id));
                        if (isEditing) {
                            qqInput.addClass("qq-editing");
                            templating.hideFilename(id);
                            templating.hideEditIcon(id);
                        } else {
                            qqInput.removeClass("qq-editing");
                            templating.showFilename(id);
                            templating.showEditIcon(id);
                        }
                        qqFileContainer.addClass("qq-temp").removeClass("qq-temp");
                    }
                };
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                this._parent.prototype._onUploadStatusChange.apply(this, arguments);
                if (this._isEditFilenameEnabled()) {
                    if (this._templating.getFileContainer(id) && newStatus !== qq.status.SUBMITTED) {
                        this._templating.markFilenameEditable(id);
                        this._templating.hideEditIcon(id);
                    }
                }
                if (oldStatus === qq.status.UPLOAD_RETRYING && newStatus === qq.status.UPLOADING) {
                    this._templating.hideRetry(id);
                    this._templating.setStatusText(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.retrying);
                } else if (newStatus === qq.status.UPLOAD_FAILED) {
                    this._templating.hidePause(id);
                }
            },
            _bindFilenameInputFocusInEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusInHandler(spec);
            },
            _bindFilenameInputFocusEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusHandler(spec);
            },
            _bindFilenameClickEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameClickHandler(spec);
            },
            _storeForLater: function(id) {
                this._parent.prototype._storeForLater.apply(this, arguments);
                this._templating.hideSpinner(id);
            },
            _onAllComplete: function(successful, failed) {
                this._parent.prototype._onAllComplete.apply(this, arguments);
                this._templating.resetTotalProgress();
            },
            _onSubmit: function(id, name) {
                var file = this.getFile(id);
                if (file && file.qqPath && this._options.dragAndDrop.reportDirectoryPaths) {
                    this._paramsStore.addReadOnly(id, {
                        qqpath: file.qqPath
                    });
                }
                this._parent.prototype._onSubmit.apply(this, arguments);
                this._addToList(id, name);
            },
            _onSubmitted: function(id) {
                if (this._isEditFilenameEnabled()) {
                    this._templating.markFilenameEditable(id);
                    this._templating.showEditIcon(id);
                    if (!this._focusinEventSupported) {
                        this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(id));
                    }
                }
            },
            _onProgress: function(id, name, loaded, total) {
                this._parent.prototype._onProgress.apply(this, arguments);
                this._templating.updateProgress(id, loaded, total);
                if (total === 0 || Math.round(loaded / total * 100) === 100) {
                    this._templating.hideCancel(id);
                    this._templating.hidePause(id);
                    this._templating.hideProgress(id);
                    this._templating.setStatusText(id, this._options.text.waitingForResponse);
                    this._displayFileSize(id);
                } else {
                    this._displayFileSize(id, loaded, total);
                }
            },
            _onTotalProgress: function(loaded, total) {
                this._parent.prototype._onTotalProgress.apply(this, arguments);
                this._templating.updateTotalProgress(loaded, total);
            },
            _onComplete: function(id, name, result, xhr) {
                var parentRetVal = this._parent.prototype._onComplete.apply(this, arguments), templating = this._templating, fileContainer = templating.getFileContainer(id), self = this;
                function completeUpload(result) {
                    if (!fileContainer) {
                        return;
                    }
                    templating.setStatusText(id);
                    qq(fileContainer).removeClass(self._classes.retrying);
                    templating.hideProgress(id);
                    if (self.getUploads({
                        id: id
                    }).status !== qq.status.UPLOAD_FAILED) {
                        templating.hideCancel(id);
                    }
                    templating.hideSpinner(id);
                    if (result.success) {
                        self._markFileAsSuccessful(id);
                    } else {
                        qq(fileContainer).addClass(self._classes.fail);
                        templating.showCancel(id);
                        if (templating.isRetryPossible() && !self._preventRetries[id]) {
                            qq(fileContainer).addClass(self._classes.retryable);
                            templating.showRetry(id);
                        }
                        self._controlFailureTextDisplay(id, result);
                    }
                }
                if (parentRetVal instanceof qq.Promise) {
                    parentRetVal.done(function(newResult) {
                        completeUpload(newResult);
                    });
                } else {
                    completeUpload(result);
                }
                return parentRetVal;
            },
            _markFileAsSuccessful: function(id) {
                var templating = this._templating;
                if (this._isDeletePossible()) {
                    templating.showDeleteButton(id);
                }
                qq(templating.getFileContainer(id)).addClass(this._classes.success);
                this._maybeUpdateThumbnail(id);
            },
            _onUploadPrep: function(id) {
                this._parent.prototype._onUploadPrep.apply(this, arguments);
                this._templating.showSpinner(id);
            },
            _onUpload: function(id, name) {
                var parentRetVal = this._parent.prototype._onUpload.apply(this, arguments);
                this._templating.showSpinner(id);
                return parentRetVal;
            },
            _onUploadChunk: function(id, chunkData) {
                this._parent.prototype._onUploadChunk.apply(this, arguments);
                if (chunkData.partIndex > 0 && this._handler.isResumable(id)) {
                    this._templating.allowPause(id);
                }
            },
            _onCancel: function(id, name) {
                this._parent.prototype._onCancel.apply(this, arguments);
                this._removeFileItem(id);
                if (this._getNotFinished() === 0) {
                    this._templating.resetTotalProgress();
                }
            },
            _onBeforeAutoRetry: function(id) {
                var retryNumForDisplay, maxAuto, retryNote;
                this._parent.prototype._onBeforeAutoRetry.apply(this, arguments);
                this._showCancelLink(id);
                if (this._options.retry.showAutoRetryNote) {
                    retryNumForDisplay = this._autoRetries[id];
                    maxAuto = this._options.retry.maxAutoAttempts;
                    retryNote = this._options.retry.autoRetryNote.replace(/\{retryNum\}/g, retryNumForDisplay);
                    retryNote = retryNote.replace(/\{maxAuto\}/g, maxAuto);
                    this._templating.setStatusText(id, retryNote);
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retrying);
                }
            },
            _onBeforeManualRetry: function(id) {
                if (this._parent.prototype._onBeforeManualRetry.apply(this, arguments)) {
                    this._templating.resetProgress(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.fail);
                    this._templating.setStatusText(id);
                    this._templating.showSpinner(id);
                    this._showCancelLink(id);
                    return true;
                } else {
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retryable);
                    this._templating.showRetry(id);
                    return false;
                }
            },
            _onSubmitDelete: function(id) {
                var onSuccessCallback = qq.bind(this._onSubmitDeleteSuccess, this);
                this._parent.prototype._onSubmitDelete.call(this, id, onSuccessCallback);
            },
            _onSubmitDeleteSuccess: function(id, uuid, additionalMandatedParams) {
                if (this._options.deleteFile.forceConfirm) {
                    this._showDeleteConfirm.apply(this, arguments);
                } else {
                    this._sendDeleteRequest.apply(this, arguments);
                }
            },
            _onDeleteComplete: function(id, xhr, isError) {
                this._parent.prototype._onDeleteComplete.apply(this, arguments);
                this._templating.hideSpinner(id);
                if (isError) {
                    this._templating.setStatusText(id, this._options.deleteFile.deletingFailedText);
                    this._templating.showDeleteButton(id);
                } else {
                    this._removeFileItem(id);
                }
            },
            _sendDeleteRequest: function(id, uuid, additionalMandatedParams) {
                this._templating.hideDeleteButton(id);
                this._templating.showSpinner(id);
                this._templating.setStatusText(id, this._options.deleteFile.deletingStatusText);
                this._deleteHandler.sendDelete.apply(this, arguments);
            },
            _showDeleteConfirm: function(id, uuid, mandatedParams) {
                var fileName = this.getName(id), confirmMessage = this._options.deleteFile.confirmMessage.replace(/\{filename\}/g, fileName), uuid = this.getUuid(id), deleteRequestArgs = arguments, self = this, retVal;
                retVal = this._options.showConfirm(confirmMessage);
                if (qq.isGenericPromise(retVal)) {
                    retVal.then(function() {
                        self._sendDeleteRequest.apply(self, deleteRequestArgs);
                    });
                } else if (retVal !== false) {
                    self._sendDeleteRequest.apply(self, deleteRequestArgs);
                }
            },
            _addToList: function(id, name, canned) {
                var prependData, prependIndex = 0, dontDisplay = this._handler.isProxied(id) && this._options.scaling.hideScaled, record;
                if (this._options.display.prependFiles) {
                    if (this._totalFilesInBatch > 1 && this._filesInBatchAddedToUi > 0) {
                        prependIndex = this._filesInBatchAddedToUi - 1;
                    }
                    prependData = {
                        index: prependIndex
                    };
                }
                if (!canned) {
                    if (this._options.disableCancelForFormUploads && !qq.supportedFeatures.ajaxUploading) {
                        this._templating.disableCancel();
                    }
                    if (!this._options.multiple) {
                        record = this.getUploads({
                            id: id
                        });
                        this._handledProxyGroup = this._handledProxyGroup || record.proxyGroupId;
                        if (record.proxyGroupId !== this._handledProxyGroup || !record.proxyGroupId) {
                            this._handler.cancelAll();
                            this._clearList();
                            this._handledProxyGroup = null;
                        }
                    }
                }
                if (canned) {
                    this._templating.addFileToCache(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.updateThumbnail(id, this._thumbnailUrls[id], true, this._options.thumbnails.customResizer);
                } else {
                    this._templating.addFile(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.generatePreview(id, this.getFile(id), this._options.thumbnails.customResizer);
                }
                this._filesInBatchAddedToUi += 1;
                if (canned || this._options.display.fileSizeOnSubmit && qq.supportedFeatures.ajaxUploading) {
                    this._displayFileSize(id);
                }
            },
            _clearList: function() {
                this._templating.clearFiles();
                this.clearStoredFiles();
            },
            _displayFileSize: function(id, loadedSize, totalSize) {
                var size = this.getSize(id), sizeForDisplay = this._formatSize(size);
                if (size >= 0) {
                    if (loadedSize !== undefined && totalSize !== undefined) {
                        sizeForDisplay = this._formatProgress(loadedSize, totalSize);
                    }
                    this._templating.updateSize(id, sizeForDisplay);
                }
            },
            _formatProgress: function(uploadedSize, totalSize) {
                var message = this._options.text.formatProgress;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                r("{percent}", Math.round(uploadedSize / totalSize * 100));
                r("{total_size}", this._formatSize(totalSize));
                return message;
            },
            _controlFailureTextDisplay: function(id, response) {
                var mode, responseProperty, failureReason;
                mode = this._options.failedUploadTextDisplay.mode;
                responseProperty = this._options.failedUploadTextDisplay.responseProperty;
                if (mode === "custom") {
                    failureReason = response[responseProperty];
                    if (!failureReason) {
                        failureReason = this._options.text.failUpload;
                    }
                    this._templating.setStatusText(id, failureReason);
                    if (this._options.failedUploadTextDisplay.enableTooltip) {
                        this._showTooltip(id, failureReason);
                    }
                } else if (mode === "default") {
                    this._templating.setStatusText(id, this._options.text.failUpload);
                } else if (mode !== "none") {
                    this.log("failedUploadTextDisplay.mode value of '" + mode + "' is not valid", "warn");
                }
            },
            _showTooltip: function(id, text) {
                this._templating.getFileContainer(id).title = text;
            },
            _showCancelLink: function(id) {
                if (!this._options.disableCancelForFormUploads || qq.supportedFeatures.ajaxUploading) {
                    this._templating.showCancel(id);
                }
            },
            _itemError: function(code, name, item) {
                var message = this._parent.prototype._itemError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _batchError: function(message) {
                this._parent.prototype._batchError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _setupPastePrompt: function() {
                var self = this;
                this._options.callbacks.onPasteReceived = function() {
                    var message = self._options.paste.namePromptMessage, defaultVal = self._options.paste.defaultName;
                    return self._options.showPrompt(message, defaultVal);
                };
            },
            _fileOrBlobRejected: function(id, name) {
                this._totalFilesInBatch -= 1;
                this._parent.prototype._fileOrBlobRejected.apply(this, arguments);
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                this._totalFilesInBatch = items.length;
                this._filesInBatchAddedToUi = 0;
                this._parent.prototype._prepareItemsForUpload.apply(this, arguments);
            },
            _maybeUpdateThumbnail: function(fileId) {
                var thumbnailUrl = this._thumbnailUrls[fileId], fileStatus = this.getUploads({
                    id: fileId
                }).status;
                if (fileStatus !== qq.status.DELETED && (thumbnailUrl || this._options.thumbnails.placeholders.waitUntilResponse || !qq.supportedFeatures.imagePreviews)) {
                    this._templating.updateThumbnail(fileId, thumbnailUrl, this._options.thumbnails.customResizer);
                }
            },
            _addCannedFile: function(sessionData) {
                var id = this._parent.prototype._addCannedFile.apply(this, arguments);
                this._addToList(id, this.getName(id), true);
                this._templating.hideSpinner(id);
                this._templating.hideCancel(id);
                this._markFileAsSuccessful(id);
                return id;
            },
            _setSize: function(id, newSize) {
                this._parent.prototype._setSize.apply(this, arguments);
                this._templating.updateSize(id, this._formatSize(newSize));
            },
            _sessionRequestComplete: function() {
                this._templating.addCacheToDom();
                this._parent.prototype._sessionRequestComplete.apply(this, arguments);
            }
        };
    })();
    qq.FineUploader = function(o, namespace) {
        "use strict";
        var self = this;
        this._parent = namespace ? qq[namespace].FineUploaderBasic : qq.FineUploaderBasic;
        this._parent.apply(this, arguments);
        qq.extend(this._options, {
            element: null,
            button: null,
            listElement: null,
            dragAndDrop: {
                extraDropzones: [],
                reportDirectoryPaths: false
            },
            text: {
                formatProgress: "{percent}% of {total_size}",
                failUpload: "Upload failed",
                waitingForResponse: "Processing...",
                paused: "Paused"
            },
            template: "qq-template",
            classes: {
                retrying: "qq-upload-retrying",
                retryable: "qq-upload-retryable",
                success: "qq-upload-success",
                fail: "qq-upload-fail",
                editable: "qq-editable",
                hide: "qq-hide",
                dropActive: "qq-upload-drop-area-active"
            },
            failedUploadTextDisplay: {
                mode: "default",
                responseProperty: "error",
                enableTooltip: true
            },
            messages: {
                tooManyFilesError: "You may only drop one file",
                unsupportedBrowser: "Unrecoverable error - this browser does not permit file uploading of any kind."
            },
            retry: {
                showAutoRetryNote: true,
                autoRetryNote: "Retrying {retryNum}/{maxAuto}..."
            },
            deleteFile: {
                forceConfirm: false,
                confirmMessage: "Are you sure you want to delete {filename}?",
                deletingStatusText: "Deleting...",
                deletingFailedText: "Delete failed"
            },
            display: {
                fileSizeOnSubmit: false,
                prependFiles: false
            },
            paste: {
                promptForName: false,
                namePromptMessage: "Please name this image"
            },
            thumbnails: {
                customResizer: null,
                maxCount: 0,
                placeholders: {
                    waitUntilResponse: false,
                    notAvailablePath: null,
                    waitingPath: null
                },
                timeBetweenThumbs: 750
            },
            scaling: {
                hideScaled: false
            },
            showMessage: function(message) {
                if (self._templating.hasDialog("alert")) {
                    return self._templating.showDialog("alert", message);
                } else {
                    setTimeout(function() {
                        window.alert(message);
                    }, 0);
                }
            },
            showConfirm: function(message) {
                if (self._templating.hasDialog("confirm")) {
                    return self._templating.showDialog("confirm", message);
                } else {
                    return window.confirm(message);
                }
            },
            showPrompt: function(message, defaultValue) {
                if (self._templating.hasDialog("prompt")) {
                    return self._templating.showDialog("prompt", message, defaultValue);
                } else {
                    return window.prompt(message, defaultValue);
                }
            }
        }, true);
        qq.extend(this._options, o, true);
        this._templating = new qq.Templating({
            log: qq.bind(this.log, this),
            templateIdOrEl: this._options.template,
            containerEl: this._options.element,
            fileContainerEl: this._options.listElement,
            button: this._options.button,
            imageGenerator: this._imageGenerator,
            classes: {
                hide: this._options.classes.hide,
                editable: this._options.classes.editable
            },
            limits: {
                maxThumbs: this._options.thumbnails.maxCount,
                timeBetweenThumbs: this._options.thumbnails.timeBetweenThumbs
            },
            placeholders: {
                waitUntilUpdate: this._options.thumbnails.placeholders.waitUntilResponse,
                thumbnailNotAvailable: this._options.thumbnails.placeholders.notAvailablePath,
                waitingForThumbnail: this._options.thumbnails.placeholders.waitingPath
            },
            text: this._options.text
        });
        if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari);
        } else if (!qq.supportedFeatures.uploading || this._options.cors.expected && !qq.supportedFeatures.uploadCors) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowser);
        } else {
            this._wrapCallbacks();
            this._templating.render();
            this._classes = this._options.classes;
            if (!this._options.button && this._templating.getButton()) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._templating.getButton(),
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._setupClickAndEditEventHandlers();
            if (qq.DragAndDrop && qq.supportedFeatures.fileDrop) {
                this._dnd = this._setupDragAndDrop();
            }
            if (this._options.paste.targetElement && this._options.paste.promptForName) {
                if (qq.PasteSupport) {
                    this._setupPastePrompt();
                } else {
                    this.log("Paste support module not found.", "error");
                }
            }
            this._totalFilesInBatch = 0;
            this._filesInBatchAddedToUi = 0;
        }
    };
    qq.extend(qq.FineUploader.prototype, qq.basePublicApi);
    qq.extend(qq.FineUploader.prototype, qq.basePrivateApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPublicApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPrivateApi);
    qq.Templating = function(spec) {
        "use strict";
        var FILE_ID_ATTR = "qq-file-id", FILE_CLASS_PREFIX = "qq-file-id-", THUMBNAIL_MAX_SIZE_ATTR = "qq-max-size", THUMBNAIL_SERVER_SCALE_ATTR = "qq-server-scale", HIDE_DROPZONE_ATTR = "qq-hide-dropzone", DROPZPONE_TEXT_ATTR = "qq-drop-area-text", IN_PROGRESS_CLASS = "qq-in-progress", HIDDEN_FOREVER_CLASS = "qq-hidden-forever", fileBatch = {
            content: document.createDocumentFragment(),
            map: {}
        }, isCancelDisabled = false, generatedThumbnails = 0, thumbnailQueueMonitorRunning = false, thumbGenerationQueue = [], thumbnailMaxSize = -1, options = {
            log: null,
            limits: {
                maxThumbs: 0,
                timeBetweenThumbs: 750
            },
            templateIdOrEl: "qq-template",
            containerEl: null,
            fileContainerEl: null,
            button: null,
            imageGenerator: null,
            classes: {
                hide: "qq-hide",
                editable: "qq-editable"
            },
            placeholders: {
                waitUntilUpdate: false,
                thumbnailNotAvailable: null,
                waitingForThumbnail: null
            },
            text: {
                paused: "Paused"
            }
        }, selectorClasses = {
            button: "qq-upload-button-selector",
            alertDialog: "qq-alert-dialog-selector",
            dialogCancelButton: "qq-cancel-button-selector",
            confirmDialog: "qq-confirm-dialog-selector",
            dialogMessage: "qq-dialog-message-selector",
            dialogOkButton: "qq-ok-button-selector",
            promptDialog: "qq-prompt-dialog-selector",
            uploader: "qq-uploader-selector",
            drop: "qq-upload-drop-area-selector",
            list: "qq-upload-list-selector",
            progressBarContainer: "qq-progress-bar-container-selector",
            progressBar: "qq-progress-bar-selector",
            totalProgressBarContainer: "qq-total-progress-bar-container-selector",
            totalProgressBar: "qq-total-progress-bar-selector",
            file: "qq-upload-file-selector",
            spinner: "qq-upload-spinner-selector",
            size: "qq-upload-size-selector",
            cancel: "qq-upload-cancel-selector",
            pause: "qq-upload-pause-selector",
            continueButton: "qq-upload-continue-selector",
            deleteButton: "qq-upload-delete-selector",
            retry: "qq-upload-retry-selector",
            statusText: "qq-upload-status-text-selector",
            editFilenameInput: "qq-edit-filename-selector",
            editNameIcon: "qq-edit-filename-icon-selector",
            dropText: "qq-upload-drop-area-text-selector",
            dropProcessing: "qq-drop-processing-selector",
            dropProcessingSpinner: "qq-drop-processing-spinner-selector",
            thumbnail: "qq-thumbnail-selector"
        }, previewGeneration = {}, cachedThumbnailNotAvailableImg = new qq.Promise(), cachedWaitingForThumbnailImg = new qq.Promise(), log, isEditElementsExist, isRetryElementExist, templateDom, container, fileList, showThumbnails, serverScale, cacheThumbnailPlaceholders = function() {
            var notAvailableUrl = options.placeholders.thumbnailNotAvailable, waitingUrl = options.placeholders.waitingForThumbnail, spec = {
                maxSize: thumbnailMaxSize,
                scale: serverScale
            };
            if (showThumbnails) {
                if (notAvailableUrl) {
                    options.imageGenerator.generate(notAvailableUrl, new Image(), spec).then(function(updatedImg) {
                        cachedThumbnailNotAvailableImg.success(updatedImg);
                    }, function() {
                        cachedThumbnailNotAvailableImg.failure();
                        log("Problem loading 'not available' placeholder image at " + notAvailableUrl, "error");
                    });
                } else {
                    cachedThumbnailNotAvailableImg.failure();
                }
                if (waitingUrl) {
                    options.imageGenerator.generate(waitingUrl, new Image(), spec).then(function(updatedImg) {
                        cachedWaitingForThumbnailImg.success(updatedImg);
                    }, function() {
                        cachedWaitingForThumbnailImg.failure();
                        log("Problem loading 'waiting for thumbnail' placeholder image at " + waitingUrl, "error");
                    });
                } else {
                    cachedWaitingForThumbnailImg.failure();
                }
            }
        }, displayWaitingImg = function(thumbnail) {
            var waitingImgPlacement = new qq.Promise();
            cachedWaitingForThumbnailImg.then(function(img) {
                maybeScalePlaceholderViaCss(img, thumbnail);
                if (!thumbnail.src) {
                    thumbnail.src = img.src;
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        show(thumbnail);
                        waitingImgPlacement.success();
                    };
                } else {
                    waitingImgPlacement.success();
                }
            }, function() {
                hide(thumbnail);
                waitingImgPlacement.success();
            });
            return waitingImgPlacement;
        }, generateNewPreview = function(id, blob, spec) {
            var thumbnail = getThumbnail(id);
            log("Generating new thumbnail for " + id);
            blob.qqThumbnailId = id;
            return options.imageGenerator.generate(blob, thumbnail, spec).then(function() {
                generatedThumbnails++;
                show(thumbnail);
                previewGeneration[id].success();
            }, function() {
                previewGeneration[id].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                }
            });
        }, generateNextQueuedPreview = function() {
            if (thumbGenerationQueue.length) {
                thumbnailQueueMonitorRunning = true;
                var queuedThumbRequest = thumbGenerationQueue.shift();
                if (queuedThumbRequest.update) {
                    processUpdateQueuedPreviewRequest(queuedThumbRequest);
                } else {
                    processNewQueuedPreviewRequest(queuedThumbRequest);
                }
            } else {
                thumbnailQueueMonitorRunning = false;
            }
        }, getCancel = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.cancel);
        }, getContinue = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.continueButton);
        }, getDialog = function(type) {
            return getTemplateEl(container, selectorClasses[type + "Dialog"]);
        }, getDelete = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.deleteButton);
        }, getDropProcessing = function() {
            return getTemplateEl(container, selectorClasses.dropProcessing);
        }, getEditIcon = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.editNameIcon);
        }, getFile = function(id) {
            return fileBatch.map[id] || qq(fileList).getFirstByClass(FILE_CLASS_PREFIX + id);
        }, getFilename = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.file);
        }, getPause = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.pause);
        }, getProgress = function(id) {
            if (id == null) {
                return getTemplateEl(container, selectorClasses.totalProgressBarContainer) || getTemplateEl(container, selectorClasses.totalProgressBar);
            }
            return getTemplateEl(getFile(id), selectorClasses.progressBarContainer) || getTemplateEl(getFile(id), selectorClasses.progressBar);
        }, getRetry = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.retry);
        }, getSize = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.size);
        }, getSpinner = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.spinner);
        }, getTemplateEl = function(context, cssClass) {
            return context && qq(context).getFirstByClass(cssClass);
        }, getThumbnail = function(id) {
            return showThumbnails && getTemplateEl(getFile(id), selectorClasses.thumbnail);
        }, hide = function(el) {
            el && qq(el).addClass(options.classes.hide);
        }, maybeScalePlaceholderViaCss = function(placeholder, thumbnail) {
            var maxWidth = placeholder.style.maxWidth, maxHeight = placeholder.style.maxHeight;
            if (maxHeight && maxWidth && !thumbnail.style.maxWidth && !thumbnail.style.maxHeight) {
                qq(thumbnail).css({
                    maxWidth: maxWidth,
                    maxHeight: maxHeight
                });
            }
        }, maybeSetDisplayNotAvailableImg = function(id, thumbnail) {
            var previewing = previewGeneration[id] || new qq.Promise().failure(), notAvailableImgPlacement = new qq.Promise();
            cachedThumbnailNotAvailableImg.then(function(img) {
                previewing.then(function() {
                    notAvailableImgPlacement.success();
                }, function() {
                    maybeScalePlaceholderViaCss(img, thumbnail);
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        notAvailableImgPlacement.success();
                    };
                    thumbnail.src = img.src;
                    show(thumbnail);
                });
            });
            return notAvailableImgPlacement;
        }, parseAndGetTemplate = function() {
            var scriptEl, scriptHtml, fileListNode, tempTemplateEl, fileListEl, defaultButton, dropArea, thumbnail, dropProcessing, dropTextEl, uploaderEl;
            log("Parsing template");
            if (options.templateIdOrEl == null) {
                throw new Error("You MUST specify either a template element or ID!");
            }
            if (qq.isString(options.templateIdOrEl)) {
                scriptEl = document.getElementById(options.templateIdOrEl);
                if (scriptEl === null) {
                    throw new Error(qq.format("Cannot find template script at ID '{}'!", options.templateIdOrEl));
                }
                scriptHtml = scriptEl.innerHTML;
            } else {
                if (options.templateIdOrEl.innerHTML === undefined) {
                    throw new Error("You have specified an invalid value for the template option!  " + "It must be an ID or an Element.");
                }
                scriptHtml = options.templateIdOrEl.innerHTML;
            }
            scriptHtml = qq.trimStr(scriptHtml);
            tempTemplateEl = document.createElement("div");
            tempTemplateEl.appendChild(qq.toElement(scriptHtml));
            uploaderEl = qq(tempTemplateEl).getFirstByClass(selectorClasses.uploader);
            if (options.button) {
                defaultButton = qq(tempTemplateEl).getFirstByClass(selectorClasses.button);
                if (defaultButton) {
                    qq(defaultButton).remove();
                }
            }
            if (!qq.DragAndDrop || !qq.supportedFeatures.fileDrop) {
                dropProcessing = qq(tempTemplateEl).getFirstByClass(selectorClasses.dropProcessing);
                if (dropProcessing) {
                    qq(dropProcessing).remove();
                }
            }
            dropArea = qq(tempTemplateEl).getFirstByClass(selectorClasses.drop);
            if (dropArea && !qq.DragAndDrop) {
                log("DnD module unavailable.", "info");
                qq(dropArea).remove();
            }
            if (!qq.supportedFeatures.fileDrop) {
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (dropArea && qq(dropArea).hasAttribute(HIDE_DROPZONE_ATTR)) {
                    qq(dropArea).css({
                        display: "none"
                    });
                }
            } else if (qq(uploaderEl).hasAttribute(DROPZPONE_TEXT_ATTR) && dropArea) {
                dropTextEl = qq(dropArea).getFirstByClass(selectorClasses.dropText);
                dropTextEl && qq(dropTextEl).remove();
            }
            thumbnail = qq(tempTemplateEl).getFirstByClass(selectorClasses.thumbnail);
            if (!showThumbnails) {
                thumbnail && qq(thumbnail).remove();
            } else if (thumbnail) {
                thumbnailMaxSize = parseInt(thumbnail.getAttribute(THUMBNAIL_MAX_SIZE_ATTR));
                thumbnailMaxSize = thumbnailMaxSize > 0 ? thumbnailMaxSize : null;
                serverScale = qq(thumbnail).hasAttribute(THUMBNAIL_SERVER_SCALE_ATTR);
            }
            showThumbnails = showThumbnails && thumbnail;
            isEditElementsExist = qq(tempTemplateEl).getByClass(selectorClasses.editFilenameInput).length > 0;
            isRetryElementExist = qq(tempTemplateEl).getByClass(selectorClasses.retry).length > 0;
            fileListNode = qq(tempTemplateEl).getFirstByClass(selectorClasses.list);
            if (fileListNode == null) {
                throw new Error("Could not find the file list container in the template!");
            }
            fileListEl = fileListNode.children[0].cloneNode(true);
            fileListNode.innerHTML = "";
            if (tempTemplateEl.getElementsByTagName("DIALOG").length) {
                document.createElement("dialog");
            }
            log("Template parsing complete");
            return {
                template: tempTemplateEl,
                fileTemplate: fileListEl
            };
        }, prependFile = function(el, index, fileList) {
            var parentEl = fileList, beforeEl = parentEl.firstChild;
            if (index > 0) {
                beforeEl = qq(parentEl).children()[index].nextSibling;
            }
            parentEl.insertBefore(el, beforeEl);
        }, processNewQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, optFileOrBlob = queuedThumbRequest.optFileOrBlob, relatedThumbnailId = optFileOrBlob && optFileOrBlob.qqThumbnailId, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                maxSize: thumbnailMaxSize,
                orient: true,
                scale: true
            };
            if (qq.supportedFeatures.imagePreviews) {
                if (thumbnail) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        displayWaitingImg(thumbnail).done(function() {
                            previewGeneration[id] = new qq.Promise();
                            previewGeneration[id].done(function() {
                                setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                            });
                            if (relatedThumbnailId != null) {
                                useCachedPreview(id, relatedThumbnailId);
                            } else {
                                generateNewPreview(id, optFileOrBlob, spec);
                            }
                        });
                    }
                } else {
                    generateNextQueuedPreview();
                }
            } else if (thumbnail) {
                displayWaitingImg(thumbnail);
                generateNextQueuedPreview();
            }
        }, processUpdateQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, thumbnailUrl = queuedThumbRequest.thumbnailUrl, showWaitingImg = queuedThumbRequest.showWaitingImg, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                scale: serverScale,
                maxSize: thumbnailMaxSize
            };
            if (thumbnail) {
                if (thumbnailUrl) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        if (showWaitingImg) {
                            displayWaitingImg(thumbnail);
                        }
                        return options.imageGenerator.generate(thumbnailUrl, thumbnail, spec).then(function() {
                            show(thumbnail);
                            generatedThumbnails++;
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        }, function() {
                            maybeSetDisplayNotAvailableImg(id, thumbnail);
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        });
                    }
                } else {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                    generateNextQueuedPreview();
                }
            }
        }, setProgressBarWidth = function(id, percent) {
            var bar = getProgress(id), progressBarSelector = id == null ? selectorClasses.totalProgressBar : selectorClasses.progressBar;
            if (bar && !qq(bar).hasClass(progressBarSelector)) {
                bar = qq(bar).getFirstByClass(progressBarSelector);
            }
            if (bar) {
                qq(bar).css({
                    width: percent + "%"
                });
                bar.setAttribute("aria-valuenow", percent);
            }
        }, show = function(el) {
            el && qq(el).removeClass(options.classes.hide);
        }, useCachedPreview = function(targetThumbnailId, cachedThumbnailId) {
            var targetThumbnail = getThumbnail(targetThumbnailId), cachedThumbnail = getThumbnail(cachedThumbnailId);
            log(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.", targetThumbnailId, cachedThumbnailId, cachedThumbnailId));
            previewGeneration[cachedThumbnailId].then(function() {
                generatedThumbnails++;
                previewGeneration[targetThumbnailId].success();
                log(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.", cachedThumbnailId, targetThumbnailId));
                targetThumbnail.src = cachedThumbnail.src;
                show(targetThumbnail);
            }, function() {
                previewGeneration[targetThumbnailId].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(targetThumbnailId, targetThumbnail);
                }
            });
        };
        qq.extend(options, spec);
        log = options.log;
        if (!qq.supportedFeatures.imagePreviews) {
            options.limits.timeBetweenThumbs = 0;
            options.limits.maxThumbs = 0;
        }
        container = options.containerEl;
        showThumbnails = options.imageGenerator !== undefined;
        templateDom = parseAndGetTemplate();
        cacheThumbnailPlaceholders();
        qq.extend(this, {
            render: function() {
                log("Rendering template in DOM.");
                generatedThumbnails = 0;
                container.appendChild(templateDom.template.cloneNode(true));
                hide(getDropProcessing());
                this.hideTotalProgress();
                fileList = options.fileContainerEl || getTemplateEl(container, selectorClasses.list);
                log("Template rendering complete");
            },
            renderFailure: function(message) {
                var cantRenderEl = qq.toElement(message);
                container.innerHTML = "";
                container.appendChild(cantRenderEl);
            },
            reset: function() {
                container.innerHTML = "";
                this.render();
            },
            clearFiles: function() {
                fileList.innerHTML = "";
            },
            disableCancel: function() {
                isCancelDisabled = true;
            },
            addFile: function(id, name, prependInfo, hideForever, batch) {
                var fileEl = templateDom.fileTemplate.cloneNode(true), fileNameEl = getTemplateEl(fileEl, selectorClasses.file), uploaderEl = getTemplateEl(container, selectorClasses.uploader), fileContainer = batch ? fileBatch.content : fileList, thumb;
                if (batch) {
                    fileBatch.map[id] = fileEl;
                }
                qq(fileEl).addClass(FILE_CLASS_PREFIX + id);
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (fileNameEl) {
                    qq(fileNameEl).setText(name);
                    fileNameEl.setAttribute("title", name);
                }
                fileEl.setAttribute(FILE_ID_ATTR, id);
                if (prependInfo) {
                    prependFile(fileEl, prependInfo.index, fileContainer);
                } else {
                    fileContainer.appendChild(fileEl);
                }
                if (hideForever) {
                    fileEl.style.display = "none";
                    qq(fileEl).addClass(HIDDEN_FOREVER_CLASS);
                } else {
                    hide(getProgress(id));
                    hide(getSize(id));
                    hide(getDelete(id));
                    hide(getRetry(id));
                    hide(getPause(id));
                    hide(getContinue(id));
                    if (isCancelDisabled) {
                        this.hideCancel(id);
                    }
                    thumb = getThumbnail(id);
                    if (thumb && !thumb.src) {
                        cachedWaitingForThumbnailImg.then(function(waitingImg) {
                            thumb.src = waitingImg.src;
                            if (waitingImg.style.maxHeight && waitingImg.style.maxWidth) {
                                qq(thumb).css({
                                    maxHeight: waitingImg.style.maxHeight,
                                    maxWidth: waitingImg.style.maxWidth
                                });
                            }
                            show(thumb);
                        });
                    }
                }
            },
            addFileToCache: function(id, name, prependInfo, hideForever) {
                this.addFile(id, name, prependInfo, hideForever, true);
            },
            addCacheToDom: function() {
                fileList.appendChild(fileBatch.content);
                fileBatch.content = document.createDocumentFragment();
                fileBatch.map = {};
            },
            removeFile: function(id) {
                qq(getFile(id)).remove();
            },
            getFileId: function(el) {
                var currentNode = el;
                if (currentNode) {
                    while (currentNode.getAttribute(FILE_ID_ATTR) == null) {
                        currentNode = currentNode.parentNode;
                    }
                    return parseInt(currentNode.getAttribute(FILE_ID_ATTR));
                }
            },
            getFileList: function() {
                return fileList;
            },
            markFilenameEditable: function(id) {
                var filename = getFilename(id);
                filename && qq(filename).addClass(options.classes.editable);
            },
            updateFilename: function(id, name) {
                var filenameEl = getFilename(id);
                if (filenameEl) {
                    qq(filenameEl).setText(name);
                    filenameEl.setAttribute("title", name);
                }
            },
            hideFilename: function(id) {
                hide(getFilename(id));
            },
            showFilename: function(id) {
                show(getFilename(id));
            },
            isFileName: function(el) {
                return qq(el).hasClass(selectorClasses.file);
            },
            getButton: function() {
                return options.button || getTemplateEl(container, selectorClasses.button);
            },
            hideDropProcessing: function() {
                hide(getDropProcessing());
            },
            showDropProcessing: function() {
                show(getDropProcessing());
            },
            getDropZone: function() {
                return getTemplateEl(container, selectorClasses.drop);
            },
            isEditFilenamePossible: function() {
                return isEditElementsExist;
            },
            hideRetry: function(id) {
                hide(getRetry(id));
            },
            isRetryPossible: function() {
                return isRetryElementExist;
            },
            showRetry: function(id) {
                show(getRetry(id));
            },
            getFileContainer: function(id) {
                return getFile(id);
            },
            showEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).addClass(options.classes.editable);
            },
            isHiddenForever: function(id) {
                return qq(getFile(id)).hasClass(HIDDEN_FOREVER_CLASS);
            },
            hideEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).removeClass(options.classes.editable);
            },
            isEditIcon: function(el) {
                return qq(el).hasClass(selectorClasses.editNameIcon, true);
            },
            getEditInput: function(id) {
                return getTemplateEl(getFile(id), selectorClasses.editFilenameInput);
            },
            isEditInput: function(el) {
                return qq(el).hasClass(selectorClasses.editFilenameInput, true);
            },
            updateProgress: function(id, loaded, total) {
                var bar = getProgress(id), percent;
                if (bar && total > 0) {
                    percent = Math.round(loaded / total * 100);
                    if (percent === 100) {
                        hide(bar);
                    } else {
                        show(bar);
                    }
                    setProgressBarWidth(id, percent);
                }
            },
            updateTotalProgress: function(loaded, total) {
                this.updateProgress(null, loaded, total);
            },
            hideProgress: function(id) {
                var bar = getProgress(id);
                bar && hide(bar);
            },
            hideTotalProgress: function() {
                this.hideProgress();
            },
            resetProgress: function(id) {
                setProgressBarWidth(id, 0);
                this.hideTotalProgress(id);
            },
            resetTotalProgress: function() {
                this.resetProgress();
            },
            showCancel: function(id) {
                if (!isCancelDisabled) {
                    var cancel = getCancel(id);
                    cancel && qq(cancel).removeClass(options.classes.hide);
                }
            },
            hideCancel: function(id) {
                hide(getCancel(id));
            },
            isCancel: function(el) {
                return qq(el).hasClass(selectorClasses.cancel, true);
            },
            allowPause: function(id) {
                show(getPause(id));
                hide(getContinue(id));
            },
            uploadPaused: function(id) {
                this.setStatusText(id, options.text.paused);
                this.allowContinueButton(id);
                hide(getSpinner(id));
            },
            hidePause: function(id) {
                hide(getPause(id));
            },
            isPause: function(el) {
                return qq(el).hasClass(selectorClasses.pause, true);
            },
            isContinueButton: function(el) {
                return qq(el).hasClass(selectorClasses.continueButton, true);
            },
            allowContinueButton: function(id) {
                show(getContinue(id));
                hide(getPause(id));
            },
            uploadContinued: function(id) {
                this.setStatusText(id, "");
                this.allowPause(id);
                show(getSpinner(id));
            },
            showDeleteButton: function(id) {
                show(getDelete(id));
            },
            hideDeleteButton: function(id) {
                hide(getDelete(id));
            },
            isDeleteButton: function(el) {
                return qq(el).hasClass(selectorClasses.deleteButton, true);
            },
            isRetry: function(el) {
                return qq(el).hasClass(selectorClasses.retry, true);
            },
            updateSize: function(id, text) {
                var size = getSize(id);
                if (size) {
                    show(size);
                    qq(size).setText(text);
                }
            },
            setStatusText: function(id, text) {
                var textEl = getTemplateEl(getFile(id), selectorClasses.statusText);
                if (textEl) {
                    if (text == null) {
                        qq(textEl).clearText();
                    } else {
                        qq(textEl).setText(text);
                    }
                }
            },
            hideSpinner: function(id) {
                qq(getFile(id)).removeClass(IN_PROGRESS_CLASS);
                hide(getSpinner(id));
            },
            showSpinner: function(id) {
                qq(getFile(id)).addClass(IN_PROGRESS_CLASS);
                show(getSpinner(id));
            },
            generatePreview: function(id, optFileOrBlob, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        id: id,
                        customResizeFunction: customResizeFunction,
                        optFileOrBlob: optFileOrBlob
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            updateThumbnail: function(id, thumbnailUrl, showWaitingImg, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        customResizeFunction: customResizeFunction,
                        update: true,
                        id: id,
                        thumbnailUrl: thumbnailUrl,
                        showWaitingImg: showWaitingImg
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            hasDialog: function(type) {
                return qq.supportedFeatures.dialogElement && !!getDialog(type);
            },
            showDialog: function(type, message, defaultValue) {
                var dialog = getDialog(type), messageEl = getTemplateEl(dialog, selectorClasses.dialogMessage), inputEl = dialog.getElementsByTagName("INPUT")[0], cancelBtn = getTemplateEl(dialog, selectorClasses.dialogCancelButton), okBtn = getTemplateEl(dialog, selectorClasses.dialogOkButton), promise = new qq.Promise(), closeHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    okBtn && okBtn.removeEventListener("click", okClickHandler);
                    promise.failure();
                }, cancelClickHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    dialog.close();
                }, okClickHandler = function() {
                    dialog.removeEventListener("close", closeHandler);
                    okBtn.removeEventListener("click", okClickHandler);
                    dialog.close();
                    promise.success(inputEl && inputEl.value);
                };
                dialog.addEventListener("close", closeHandler);
                cancelBtn.addEventListener("click", cancelClickHandler);
                okBtn && okBtn.addEventListener("click", okClickHandler);
                if (inputEl) {
                    inputEl.value = defaultValue;
                }
                messageEl.textContent = message;
                dialog.showModal();
                return promise;
            }
        });
    };
    qq.UiEventHandler = function(s, protectedApi) {
        "use strict";
        var disposer = new qq.DisposeSupport(), spec = {
            eventType: "click",
            attachTo: null,
            onHandled: function(target, event) {}
        };
        qq.extend(this, {
            addHandler: function(element) {
                addHandler(element);
            },
            dispose: function() {
                disposer.dispose();
            }
        });
        function addHandler(element) {
            disposer.attach(element, spec.eventType, function(event) {
                event = event || window.event;
                var target = event.target || event.srcElement;
                spec.onHandled(target, event);
            });
        }
        qq.extend(protectedApi, {
            getFileIdFromItem: function(item) {
                return item.qqFileId;
            },
            getDisposeSupport: function() {
                return disposer;
            }
        });
        qq.extend(spec, s);
        if (spec.attachTo) {
            addHandler(spec.attachTo);
        }
    };
    qq.FileButtonsClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            onDeleteFile: function(fileId) {},
            onCancel: function(fileId) {},
            onRetry: function(fileId) {},
            onPause: function(fileId) {},
            onContinue: function(fileId) {},
            onGetName: function(fileId) {}
        }, buttonHandlers = {
            cancel: function(id) {
                spec.onCancel(id);
            },
            retry: function(id) {
                spec.onRetry(id);
            },
            deleteButton: function(id) {
                spec.onDeleteFile(id);
            },
            pause: function(id) {
                spec.onPause(id);
            },
            continueButton: function(id) {
                spec.onContinue(id);
            }
        };
        function examineEvent(target, event) {
            qq.each(buttonHandlers, function(buttonType, handler) {
                var firstLetterCapButtonType = buttonType.charAt(0).toUpperCase() + buttonType.slice(1), fileId;
                if (spec.templating["is" + firstLetterCapButtonType](target)) {
                    fileId = spec.templating.getFileId(target);
                    qq.preventDefault(event);
                    spec.log(qq.format("Detected valid file button click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    handler(fileId);
                    return false;
                }
            });
        }
        qq.extend(spec, s);
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
    };
    qq.FilenameClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            classes: {
                file: "qq-upload-file",
                editNameIcon: "qq-edit-filename-icon"
            },
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {}
        };
        qq.extend(spec, s);
        function examineEvent(target, event) {
            if (spec.templating.isFileName(target) || spec.templating.isEditIcon(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    qq.preventDefault(event);
                    inheritedInternalApi.handleFilenameEdit(fileId, target, true);
                }
            }
        }
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusInHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            onGetUploadStatus: function(fileId) {},
            log: function(message, lvl) {}
        };
        if (!inheritedInternalApi) {
            inheritedInternalApi = {};
        }
        function handleInputFocus(target, event) {
            if (spec.templating.isEditInput(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    inheritedInternalApi.handleFilenameEdit(fileId, target);
                }
            }
        }
        spec.eventType = "focusin";
        spec.onHandled = handleInputFocus;
        qq.extend(spec, s);
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusHandler = function(spec) {
        "use strict";
        spec.eventType = "focus";
        spec.attachTo = null;
        qq.extend(this, new qq.FilenameInputFocusInHandler(spec, {}));
    };
    qq.FilenameEditHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            log: function(message, lvl) {},
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {},
            onSetName: function(fileId, newName) {},
            onEditingStatusChange: function(fileId, isEditing) {}
        };
        function getFilenameSansExtension(fileId) {
            var filenameSansExt = spec.onGetName(fileId), extIdx = filenameSansExt.lastIndexOf(".");
            if (extIdx > 0) {
                filenameSansExt = filenameSansExt.substr(0, extIdx);
            }
            return filenameSansExt;
        }
        function getOriginalExtension(fileId) {
            var origName = spec.onGetName(fileId);
            return qq.getExtension(origName);
        }
        function handleNameUpdate(newFilenameInputEl, fileId) {
            var newName = newFilenameInputEl.value, origExtension;
            if (newName !== undefined && qq.trimStr(newName).length > 0) {
                origExtension = getOriginalExtension(fileId);
                if (origExtension !== undefined) {
                    newName = newName + "." + origExtension;
                }
                spec.onSetName(fileId, newName);
            }
            spec.onEditingStatusChange(fileId, false);
        }
        function registerInputBlurHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "blur", function() {
                handleNameUpdate(inputEl, fileId);
            });
        }
        function registerInputEnterKeyHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "keyup", function(event) {
                var code = event.keyCode || event.which;
                if (code === 13) {
                    handleNameUpdate(inputEl, fileId);
                }
            });
        }
        qq.extend(spec, s);
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
        qq.extend(inheritedInternalApi, {
            handleFilenameEdit: function(id, target, focusInput) {
                var newFilenameInputEl = spec.templating.getEditInput(id);
                spec.onEditingStatusChange(id, true);
                newFilenameInputEl.value = getFilenameSansExtension(id);
                if (focusInput) {
                    newFilenameInputEl.focus();
                }
                registerInputBlurHandler(newFilenameInputEl, id);
                registerInputEnterKeyHandler(newFilenameInputEl, id);
            }
        });
    };
})(window);
//# sourceMappingURL=fine-uploader.js.map

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(19);


/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

var require;var require;!function(f){if(true)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MeteorEmoji=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){!function(global,factory){if(void 0!==exports)factory(module);else{var mod={exports:{}};factory(mod),global.meteorEmoji=mod.exports}}(this,function(module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MeteorEmoji=function(){function MeteorEmoji(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeteorEmoji),this.initiate()}return _createClass(MeteorEmoji,[{key:"initiate",value:function(){var _this=this;document.querySelectorAll('[data-meteor-emoji="true"], [data-meteor-emoji-large="true"]').forEach(function(element){_this.generateElements(element)})}},{key:"generateElements",value:function(emojiInput){var clickLink=function(event){var caretPos=emojiInput.selectionStart;emojiInput.value=emojiInput.value.substring(0,caretPos)+" "+event.target.innerHTML+emojiInput.value.substring(caretPos),emojiPicker.style.display="block","undefined"!=typeof angular&&angular.element(emojiInput).triggerHandler("change")},clickCategory=function(event){emojiInput.selectionStart;emojiPicker.style.display="block";for(var hideUls=emojiPicker.querySelectorAll("ul"),i=1,l=hideUls.length;i<l;i++)hideUls[i].style.display="none";var backgroundToggle=emojiPicker.querySelectorAll(".category a");for(i=0,l=backgroundToggle.length;i<l;i++)backgroundToggle[i].style.background="none";emojiPicker.querySelector("."+event.target.id).style.display="block",emojiPicker.querySelector("#"+event.target.id).style.background="#c2c2c2"};emojiInput.style.width="100%";var emojiContainer=document.createElement("div");emojiContainer.style.position="relative",emojiInput.parentNode.replaceChild(emojiContainer,emojiInput),emojiContainer.appendChild(emojiInput);var emojiPicker=document.createElement("div");emojiPicker.tabIndex=0,emojiInput.hasAttribute("data-meteor-emoji-large")?(emojiPicker.style.zIndex="999",emojiPicker.style.display="block",emojiPicker.style.width="100%",emojiPicker.style.marginBottom="15px"):(emojiPicker.style.position="absolute",emojiPicker.style.right="0px",emojiPicker.style.top="30px",emojiPicker.style.display="none",emojiPicker.style.width="400px"),emojiPicker.style.zIndex="999",emojiPicker.style.overflow="hidden",emojiPicker.style.background="#fff",emojiPicker.style.borderRadius="5px",emojiPicker.style.boxShadow="0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",emojiPicker.style.borderRadius="2px;",emojiPicker.style.marginTop="5px",emojiPicker.style.outline="none";var emojiTrigger=document.createElement("a");emojiTrigger.style.position="absolute",emojiTrigger.style.top="10px",emojiTrigger.style.right="10px",emojiTrigger.style.textDecoration="none",emojiTrigger.setAttribute("href","javascript:void(0)"),emojiTrigger.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 12 14"><path d="M8.9 8.4q-0.3 0.9-1.1 1.5t-1.8 0.6-1.8-0.6-1.1-1.5q-0.1-0.2 0-0.4t0.3-0.2q0.2-0.1 0.4 0t0.2 0.3q0.2 0.6 0.7 1t1.2 0.4 1.2-0.4 0.7-1q0.1-0.2 0.3-0.3t0.4 0 0.3 0.2 0 0.4zM5 5q0 0.4-0.3 0.7t-0.7 0.3-0.7-0.3-0.3-0.7 0.3-0.7 0.7-0.3 0.7 0.3 0.3 0.7zM9 5q0 0.4-0.3 0.7t-0.7 0.3-0.7-0.3-0.3-0.7 0.3-0.7 0.7-0.3 0.7 0.3 0.3 0.7zM11 7q0-1-0.4-1.9t-1.1-1.6-1.6-1.1-1.9-0.4-1.9 0.4-1.6 1.1-1.1 1.6-0.4 1.9 0.4 1.9 1.1 1.6 1.6 1.1 1.9 0.4 1.9-0.4 1.6-1.1 1.1-1.6 0.4-1.9zM12 7q0 1.6-0.8 3t-2.2 2.2-3 0.8-3-0.8-2.2-2.2-0.8-3 0.8-3 2.2-2.2 3-0.8 3 0.8 2.2 2.2 0.8 3z"/></svg>',emojiTrigger.onclick=function(){"none"===emojiPicker.style.display?emojiPicker.style.display="block":"block"===emojiPicker.style.display&&(emojiPicker.style.display="none"),emojiPicker.focus()},emojiInput.hasAttribute("data-meteor-emoji-large")||emojiContainer.appendChild(emojiTrigger),window.addEventListener("click",function(e){emojiInput.hasAttribute("data-meteor-emoji-large")||"block"===emojiPicker.style.display&&(emojiPicker.contains(e.target)||emojiTrigger.contains(e.target)||(emojiPicker.style.display="none"))});var facesCategory=document.createElement("ul");facesCategory.style.padding="10px 0px",facesCategory.style.margin="0",facesCategory.style.listStyle="none",facesCategory.style.textAlign="left",facesCategory.style.marginLeft="3%",facesCategory.classList.add("faces");var animalsCategory=document.createElement("ul");animalsCategory.style.padding="10px 0px",animalsCategory.style.margin="0",animalsCategory.style.listStyle="none",animalsCategory.style.textAlign="left",animalsCategory.style.marginLeft="3%",animalsCategory.classList.add("animals"),animalsCategory.style.display="none";var foodCategory=document.createElement("ul");foodCategory.style.padding="10px 0px",foodCategory.style.margin="0",foodCategory.style.listStyle="none",foodCategory.style.textAlign="left",foodCategory.style.marginLeft="3%",foodCategory.classList.add("food"),foodCategory.style.display="none";var sportCategory=document.createElement("ul");sportCategory.style.padding="10px 0px",sportCategory.style.margin="0",sportCategory.style.listStyle="none",sportCategory.style.textAlign="left",sportCategory.style.marginLeft="3%",sportCategory.classList.add("sport"),sportCategory.style.display="none";var transportCategory=document.createElement("ul");transportCategory.style.padding="10px 0px",transportCategory.style.margin="0",transportCategory.style.listStyle="none",transportCategory.style.textAlign="left",transportCategory.style.marginLeft="3%",transportCategory.classList.add("transport"),transportCategory.style.display="none";var objectsCategory=document.createElement("ul");objectsCategory.style.padding="10px 0px",objectsCategory.style.margin="0",objectsCategory.style.listStyle="none",objectsCategory.style.textAlign="left",objectsCategory.style.marginLeft="3%",objectsCategory.classList.add("objects"),objectsCategory.style.display="none";var emojiCategory=document.createElement("ul");emojiCategory.style.padding="0px",emojiCategory.style.margin="0",emojiCategory.style.display="table",emojiCategory.style.width="100%",emojiCategory.style.background="#eff0f1",emojiCategory.style.listStyle="none",emojiCategory.classList.add("category");var emojiCategories=new Array;emojiCategories.push({name:"faces",svg:'<svg id="faces" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="faces" d="M74.34,128.48a53.5,53.5,0,1,1,37.84-15.67,53.16,53.16,0,0,1-37.84,15.67Zm0-97.89a44.4,44.4,0,1,0,31.4,13,44.07,44.07,0,0,0-31.4-13Z"/><path id="faces" d="M74.35,108A33.07,33.07,0,0,1,41.29,75a2.28,2.28,0,0,1,2.27-2.28h0A2.27,2.27,0,0,1,45.83,75a28.52,28.52,0,0,0,57,0,2.27,2.27,0,0,1,4.54,0A33.09,33.09,0,0,1,74.35,108Z"/><path id="faces" d="M58.84,62a6.81,6.81,0,1,0,6.81,6.81A6.81,6.81,0,0,0,58.84,62Z"/><path id="faces" d="M89.87,62a6.81,6.81,0,1,0,6.81,6.81A6.82,6.82,0,0,0,89.87,62Z"/></svg>'}),emojiCategories.push({name:"animals",svg:'<svg id="animals" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="animals" d="M59.9,91.75h0c-22.46,0-41.82-19.34-44.09-44A52.1,52.1,0,0,1,16,36.8a4.51,4.51,0,0,1,2.63-3.62,39.79,39.79,0,0,1,12.74-3.37c23.92-2.15,45.35,17.83,47.74,43.86a52.77,52.77,0,0,1-.15,10.93,4.56,4.56,0,0,1-2.64,3.62,39.67,39.67,0,0,1-12.73,3.36c-1.23.11-2.45.17-3.66.17ZM24.76,40.49a41.29,41.29,0,0,0,.09,6.4C26.7,67,42.09,82.66,59.9,82.67h0c.94,0,1.88,0,2.83-.14a30.39,30.39,0,0,0,7.41-1.62,41.14,41.14,0,0,0-.11-6.4C68.09,53.38,51.11,37.08,32.17,38.86a30.78,30.78,0,0,0-7.41,1.63Z"/><path id="animals" d="M36.68,125.64a4.53,4.53,0,0,1-4.33-3.17,53.32,53.32,0,0,1-2.26-11A50.42,50.42,0,0,1,39.51,76.6c7.35-9.91,17.84-16,29.5-17,1.16-.11,2.33-.13,3.47-.13a4.54,4.54,0,0,1,4.33,3.16,51.59,51.59,0,0,1,2.27,11.08,50.39,50.39,0,0,1-9.42,34.8c-7.35,9.91-17.83,16-29.5,17a17.63,17.63,0,0,1-3.48.12ZM69.09,68.69A32.41,32.41,0,0,0,46.8,82a42.57,42.57,0,0,0-6.71,34.38,32.38,32.38,0,0,0,22.28-13.32A41.35,41.35,0,0,0,70,74.51a39.38,39.38,0,0,0-.94-5.82Z"/><path id="animals" d="M90.27,91.75c-1.22,0-2.43-.06-3.66-.17a39.67,39.67,0,0,1-12.73-3.36,4.57,4.57,0,0,1-2.64-3.61,53.38,53.38,0,0,1-.17-10.93c2.41-26,23.7-46.07,47.76-43.87a39.74,39.74,0,0,1,12.73,3.37,4.57,4.57,0,0,1,2.64,3.62,53.35,53.35,0,0,1,.16,10.92c-2.28,24.69-21.65,44-44.09,44ZM80,80.91a30.57,30.57,0,0,0,7.42,1.62c19.07,1.78,35.92-14.53,37.87-35.64a42.55,42.55,0,0,0,.1-6.4A30.86,30.86,0,0,0,118,38.86C99,37.07,82.06,53.38,80.12,74.51a43.91,43.91,0,0,0-.1,6.4Z"/><path id="animals" d="M113.49,125.64h0c-1.16,0-2.3,0-3.46-.12-23.9-2.21-41.36-25.47-38.94-51.85A53.52,53.52,0,0,1,73.34,62.6a4.55,4.55,0,0,1,4.33-3.16c1.16,0,2.34,0,3.51.13,11.64,1.07,22.11,7.12,29.48,17a50.51,50.51,0,0,1,9.42,34.81,53.51,53.51,0,0,1-2.26,11,4.54,4.54,0,0,1-4.33,3.19ZM81.08,68.69a42.53,42.53,0,0,0-1,5.82c-1.94,21.1,11.45,39.71,29.95,41.88A42.38,42.38,0,0,0,103.36,82,32.42,32.42,0,0,0,81.08,68.69Z"/><path id="animals" d="M75.08,45.45a7.83,7.83,0,1,0,7.83,7.83,7.83,7.83,0,0,0-7.83-7.83Z"/><path id="animals" d="M76.29,51.89a2.26,2.26,0,0,1-2.14-3A46,46,0,0,1,92.82,25.34a2.27,2.27,0,1,1,2.4,3.86A41.4,41.4,0,0,0,78.43,50.39a2.28,2.28,0,0,1-2.14,1.5Z"/><path id="animals" d="M73.87,51.89a2.28,2.28,0,0,1-2.14-1.5A41.35,41.35,0,0,0,54.94,29.2a2.27,2.27,0,0,1,2.39-3.86A46,46,0,0,1,76,48.85a2.28,2.28,0,0,1-1.37,2.91,2.31,2.31,0,0,1-.77.13Z"/></svg>'}),emojiCategories.push({name:"food",svg:'<svg id="food" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="food" d="M104,20.76h.15c15.83.52,24.08,21.48,24.07,32.56.26,12.42-10.72,23.55-24,24.21a3.53,3.53,0,0,1-.46,0c-13.25-.66-24.23-11.8-24-24.3,0-11,8.26-31.95,24.07-32.47Zm0,47.69c8.25-.54,15.3-7.51,15.14-15,0-8.12-6.22-23.1-15.14-23.57-8.9.46-15.14,15.45-15.14,23.48-.14,7.61,6.9,14.59,15.14,15.13Z"/><path id="food" d="M97.19,69.21h.14a4.53,4.53,0,0,1,4.4,4.68l-1.48,46.92a1.59,1.59,0,0,0,.5,1.06,4.6,4.6,0,0,0,3.25,1.19h0a4.57,4.57,0,0,0,3.26-1.2,1.53,1.53,0,0,0,.49-1l-1.48-46.95a4.54,4.54,0,1,1,9.08-.28l1.47,46.91a10.42,10.42,0,0,1-3,7.65,13.65,13.65,0,0,1-9.81,4h0a13.58,13.58,0,0,1-9.79-4,10.42,10.42,0,0,1-3-7.67l1.48-46.89a4.53,4.53,0,0,1,4.53-4.4Z"/><path id="food" d="M41.84,69.21H42a4.53,4.53,0,0,1,4.4,4.68L44.9,120.81a1.57,1.57,0,0,0,.5,1.06,4.6,4.6,0,0,0,3.25,1.19h0a4.51,4.51,0,0,0,3.24-1.19,1.48,1.48,0,0,0,.5-1L50.93,73.89a4.53,4.53,0,0,1,4.39-4.68A4.4,4.4,0,0,1,60,73.61l1.48,46.91a10.49,10.49,0,0,1-3,7.66,13.57,13.57,0,0,1-9.78,4h0a13.59,13.59,0,0,1-9.78-4,10.48,10.48,0,0,1-3-7.67l1.48-46.9a4.54,4.54,0,0,1,4.54-4.4Z"/><path id="food" d="M28.59,20.76a4.54,4.54,0,0,1,4.54,4.54V51a15.52,15.52,0,0,0,31,0V25.3a4.55,4.55,0,0,1,9.09,0V51a24.61,24.61,0,1,1-49.21,0V25.3a4.54,4.54,0,0,1,4.54-4.54Z"/><path id="food" d="M55.34,20.76a4.54,4.54,0,0,1,4.54,4.54v19a4.54,4.54,0,1,1-9.08,0v-19a4.54,4.54,0,0,1,4.54-4.54Z"/><path id="food" d="M42,20.76a4.54,4.54,0,0,1,4.54,4.54v19a4.54,4.54,0,1,1-9.08,0v-19A4.54,4.54,0,0,1,42,20.76Z"/></svg>'}),emojiCategories.push({name:"sport",svg:'<svg id="sport" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="sport" d="M75.35,130.24a53.49,53.49,0,1,1,53.48-53.49,53.55,53.55,0,0,1-53.48,53.49Zm0-97.89a44.41,44.41,0,1,0,44.4,44.4,44.1,44.1,0,0,0-44.4-44.4Z"/><path id="sport" d="M119.24,84.08A51.29,51.29,0,0,1,68,32.86a49.44,49.44,0,0,1,.26-5,2.26,2.26,0,0,1,2-2c1.66-.16,3.34-.25,5-.25a51.26,51.26,0,0,1,51.21,51.21c0,1.71-.09,3.38-.25,5a2.28,2.28,0,0,1-2,2c-1.65.16-3.33.25-5,.25ZM72.64,30.16c-.06.9-.08,1.79-.08,2.7a46.73,46.73,0,0,0,46.68,46.68q1.37,0,2.7-.09c.06-.89.08-1.79.08-2.7A46.72,46.72,0,0,0,75.35,30.08c-.91,0-1.82,0-2.71.08Z"/><path id="sport" d="M75.35,128A51.28,51.28,0,0,1,24.12,76.76c0-1.7.1-3.38.25-5a2.29,2.29,0,0,1,2-2c1.66-.16,3.33-.25,5.05-.25a51.27,51.27,0,0,1,51.21,51.22c0,1.69-.09,3.37-.25,5a2.27,2.27,0,0,1-2,2c-1.66.16-3.32.25-5,.25ZM28.75,74.05c-.05.9-.09,1.8-.09,2.71a46.74,46.74,0,0,0,46.69,46.67c.91,0,1.8,0,2.7-.08,0-.9.08-1.8.08-2.7A46.73,46.73,0,0,0,31.46,74c-.91,0-1.81,0-2.71.08Z"/><polygon id="sport" points="42.69 112.61 39.48 109.4 108 40.88 111.21 44.1 42.69 112.61 42.69 112.61"/></svg>'}),emojiCategories.push({name:"transport",svg:'<svg id="transport" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="transport" d="M120.7,116H31a4.55,4.55,0,0,1-4.54-4.55V54.28A31.82,31.82,0,0,1,58.25,22.49h35.2a31.83,31.83,0,0,1,31.8,31.79v57.15A4.55,4.55,0,0,1,120.7,116Zm-85.16-9.09h80.62V54.28A22.74,22.74,0,0,0,93.45,31.57H58.25A22.74,22.74,0,0,0,35.54,54.28v52.61Z"/><path id="transport" d="M49.35,129.23c-8.53,0-13.62-2.77-13.62-7.41V115.6a4.54,4.54,0,1,1,9.08,0v4.06a21.32,21.32,0,0,0,9.09,0V115.6a4.54,4.54,0,0,1,9.08,0v6.22c0,4.64-5.09,7.41-13.63,7.41Z"/><path id="transport" d="M102.34,129.23c-8.53,0-13.62-2.77-13.62-7.41V115.6a4.54,4.54,0,0,1,9.08,0v4.06a21.28,21.28,0,0,0,9.08,0V115.6a4.55,4.55,0,0,1,9.09,0v6.22c0,4.64-5.09,7.41-13.63,7.41Z"/><path id="transport" d="M97.81,44.83H53.9a4.55,4.55,0,1,1,0-9.09H97.81a4.55,4.55,0,0,1,0,9.09Z"/><path id="transport" d="M54.28,84.2A6.8,6.8,0,1,0,61.07,91a6.8,6.8,0,0,0-6.79-6.8Z"/><path id="transport" d="M97.43,84.2a6.8,6.8,0,1,0,6.79,6.8,6.8,6.8,0,0,0-6.79-6.8Z"/><path id="transport" d="M107.08,81H44.63a6.82,6.82,0,0,1-6.82-6.82V54.28a6.82,6.82,0,0,1,6.82-6.81h62.45a6.82,6.82,0,0,1,6.81,6.81V74.15A6.83,6.83,0,0,1,107.08,81ZM44.63,52a2.28,2.28,0,0,0-2.28,2.27V74.15a2.28,2.28,0,0,0,2.28,2.27h62.45a2.27,2.27,0,0,0,2.27-2.27V54.28A2.27,2.27,0,0,0,107.08,52Z"/></svg>'}),emojiCategories.push({name:"objects",svg:'<svg id="objects" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="objects" d="M107.78,129a4.55,4.55,0,0,1-2.67-.87l-30-21.79-30,21.79a4.53,4.53,0,0,1-5.34,0,4.58,4.58,0,0,1-1.65-5.08L49.59,87.82,19.6,66a4.54,4.54,0,0,1,2.67-8.22H59.34L70.8,22.55a4.55,4.55,0,0,1,8.64,0L90.89,57.81H128A4.54,4.54,0,0,1,130.63,66l-30,21.79,11.46,35.25a4.55,4.55,0,0,1-4.32,6ZM75.12,96.2a4.53,4.53,0,0,1,2.67.87l21.35,15.51L91,87.49a4.55,4.55,0,0,1,1.65-5.08L114,66.89H87.59a4.54,4.54,0,0,1-4.32-3.13l-8.15-25.1L67,63.76a4.53,4.53,0,0,1-4.32,3.13H36.25L57.61,82.41a4.54,4.54,0,0,1,1.65,5.08l-8.17,25.09L72.45,97.07a4.53,4.53,0,0,1,2.67-.87Z"/></svg>'});emojiCategories.map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.padding="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.style.display="table-cell",emojiLink.style.textAlign="center",emojiLink.id=String(item.name),"faces"==String(item.name)&&(emojiLink.style.background="#c2c2c2"),emojiLink.innerHTML=String(item.svg),emojiLink.onmousedown=clickCategory,emojiCategory.appendChild(emojiLink)}),[128513,128514,128515,128516,128517,128518,128521,128522,128523,128524,128525,128527,128530,128531,128532,128534,128536,128538,128540,128541,128542,128544,128545,128546,128547,128548,128549,128552,128553,128554,128555,128557,128560,128561,128562,128563,128565,128567].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,facesCategory.appendChild(emojiLink)}),[128012,128013,128014,128017,128018,128020,128023,128024,128025,128026,128027,128028,128029,128030,128031,128032,128033,128034,128035,128036,128037,128038,128039,128040,128041,128043,128044,128045,128046,128047,128048,128049,128050,128051,128052,128053,128054,128055,128056,128057,128058,128059,128060].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,animalsCategory.appendChild(emojiLink)}),[127813,127814,127815,127816,127817,127818,127820,127821,127822,127823,127825,127826,127827,127828,127829,127830,127831,127832,127836,127837,127838,127839,127840,127841,127842,127843,127844,127846,127848,127849,127850,127851,127852,127853,127856,127858,127859,127860,127863,127864,127867].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,foodCategory.appendChild(emojiLink)}),[127921,127923,127934,127935,127936,127937,127938,127939,127940,127942,127944,127946,128675,128692,128693,9917,9918,9978,127907,127919,9971].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,sportCategory.appendChild(emojiLink)}),[128641,128642,128646,128648,128650,128653,128654,128656,128660,128662,128664,128667,128668,128669,128670,128671,128672,128673,128640,128643,128644,128645,128647,128649,128652,128657,128658,128659,128661,128663,128665,128666,128674,128676,128690].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,transportCategory.appendChild(emojiLink)}),[127890,127880,127881,127887,127891,127905,127906,127908,127909,127911,127912,127915,127916,127918,127919,127926,127927,127928,127929,127930,127931,127932,127968,127973,127978,128147,128148,128149,128150,128151,128152,128187,128186,128197,128213,128247].map(function(item){var emojiLi=document.createElement("li");emojiLi.style.display="inline-block",emojiLi.style.margin="5px";var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,objectsCategory.appendChild(emojiLink)}),emojiPicker.appendChild(emojiCategory),emojiPicker.appendChild(facesCategory),emojiPicker.appendChild(animalsCategory),emojiPicker.appendChild(foodCategory),emojiPicker.appendChild(sportCategory),emojiPicker.appendChild(transportCategory),emojiPicker.appendChild(objectsCategory),emojiContainer.appendChild(emojiPicker)}}]),MeteorEmoji}();module.exports=MeteorEmoji})},{}]},{},[1])(1)});

/***/ }),
/* 22 */
/***/ (function(module, exports) {

module.exports = function(module) {
	if(!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if(!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(6);


/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMTFiNWJlZGNlYjVlYzk2MmI2MTUiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyLmpzIiwid2VicGFjazovLy8uL3NyYy9jb21tb24vanMtc2VydmljZXMvY29va2llLmpzIiwid2VicGFjazovLy8uL3NyYy9jb21tb24vanMtc2VydmljZXMvdmlldy5qcyIsIndlYnBhY2s6Ly8vLi9+L3B1YnN1Yi1qcy9zcmMvcHVic3ViLmpzIiwid2VicGFjazovLy8uL3NyYy9jb21tb24vanMtc2VydmljZXMvbmV0d29yay5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYm9vdHN0cmFwLmpzIiwid2VicGFjazovLy8uL3NyYy9ibG9ja3MvY29uZmlybS1yZWcvY29uZmlybS1yZWcuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9oZWFkZXIvYnVyZ2VyLW1lbnUvYnVyZ2VyLW1lbnUuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9oZWFkZXIvaGVhZGVyLmpzIiwid2VicGFjazovLy8uL3NyYy9ibG9ja3MvaW5zdGFncmFtLWFjY291bnRzLWxpc3QvaW5zdGFncmFtLWFjY291bnRzLWxpc3QuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9sb2dpbi1mb3JtL2xvZ2luLWZvcm0uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9tZXNzYWdlcy9kYXRhU2VydmVyLmpzIiwid2VicGFjazovLy8uL3NyYy9ibG9ja3MvbWVzc2FnZXMvbWVzc2FnZXMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9yZWdpc3Rlci1mb3JtL3JlZ2lzdGVyLWZvcm0uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9hcGktdXNlci1kaXJlY3QuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhZ2VzL19hdXRoL2xvZ2luLXBhZ2UuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhZ2VzL19pbnN0YWdyYW0vaW5zdGFncmFtLmpzIiwid2VicGFjazovLy8uL3NyYy9iYXNlLnNjc3MiLCJ3ZWJwYWNrOi8vLy4vfi9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlci5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZpbmUtdXBsb2FkZXIvbGliL3RyYWRpdGlvbmFsLmpzIiwid2VicGFjazovLy8uL34vbWV0ZW9yLWVtb2ppL2Rpc3QvbWV0ZW9yRW1vamkubWluLmpzIiwid2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9tb2R1bGUuanMiXSwibmFtZXMiOlsiQ09OU1QiLCJ1cmwiLCJiYXNlIiwicmVnaXN0cmF0aW9uIiwibG9naW4iLCJjb25maXJtYXRpb24iLCJpbnN0YWdyYW1fYWRkQWNjb3VudCIsImluc3RhZ3JhbUFjY291bnRfZ2V0TWV0YURhdGEiLCJpbnN0YWdyYW1BY2NvdW50X2NoZWNrcG9pbnQiLCJpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXkiLCJpbnN0YWdyYW1EaXJlY3RfZ2V0TWV0YURhdGEiLCJ1c2VyIiwiZW1haWwiLCJwYXNzd29yZCIsInRva2VuIiwiY29va2llU3RvcmFnZSIsImVtYWlsQ29uZmlybWVkIiwidWlTZWxlY3RvcnMiLCJoZWFkZXJMb2dpbkJveCIsImhlYWRlck5hdkxvZ2luQnRuIiwiaGVhZGVyUmVnQm94IiwiaGVhZGVyUmVnQnRuIiwiaW5zdGFncmFtIiwiYWRkQWNjb3VudEJ0blNlbGVjdG9yIiwiYWRkQWNjb3VudEJ0bklkIiwiZXZlbnRzIiwiVVNFUl9MT0dHRUQiLCJVU0VSX0xPR09VVCIsIlVTRVJfRU1BSUxfQ09ORklSTUVEIiwiU1RPUF9GSVhFRF9TUElOTkVSIiwiZ2V0UGF0aCIsIm5hbWUiLCJVc2VyIiwibmV0d29yayIsInNldHRpbmdQb3N0IiwibWV0aG9kIiwiaGVhZGVycyIsImdldFRva2VuIiwiZ2V0IiwiY29va2llVG9rZW4iLCJmb3JtRGF0YSIsImNiRXJyb3IiLCJzZXR0aW5nIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZW5kUmVxdWVzdCIsInVzZXJuYW1lIiwiY2hlY2twb2ludFR5cGUiLCJrZXkiLCJ1c2VySW5zdGFuY2UiLCJDb29raWVTcnYiLCJjIiwiZG9jdW1lbnQiLCJjb29raWUiLCJtYXRjaCIsImRlY29kZVVSSUNvbXBvbmVudCIsInNldCIsInZhbHVlIiwib3B0cyIsInBhdGgiLCJkYXlzIiwiT2JqZWN0IiwiZW50cmllcyIsInJlZHVjZSIsInN0ciIsImsiLCJ2IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVtb3ZlIiwidmlld1V0aWxzIiwic2hvd0luZm9NZXNzYWdlIiwic2VsZWN0b3IiLCJtZXNzYWdlMSIsIm1lc3NhZ2UyIiwiJCIsImVtcHR5IiwiYXBwZW5kIiwiZmlsbExpc3QiLCIkbGlzdCIsImRhdGFBcnJheSIsIml0ZW1zIiwiY0xpc3QiLCJmb3JFYWNoIiwiaXRlbSIsImkiLCJsaSIsImFwcGVuZFRvIiwiYWRkQ2xhc3MiLCJ0ZXh0IiwiaXNFbWFpbCIsInJlZ2V4IiwidGVzdCIsIk5ldHdvcmsiLCJyZXN1bHQiLCIkZWwiLCJsZW5ndGgiLCJzdGF0dXMiLCJzdGF0ZSIsIm1lc3NhZ2UiLCJyZXNwb25zZSIsImVycm9yIiwiRXJyb3IiLCJzdGF0dXNUZXh0IiwiVVJMIiwiT1BUUyIsImZldGNoIiwidGhlbiIsIlByb21pc2UiLCJhbGwiLCJqc29uIiwib2siLCJjYkVycm9yRGVmYXVsdCIsImNoZWNrU3RhdHVzIiwiaGVhZGVyIiwiYnVyZ2VyTWVudSIsImluc3RhZ3JhbUFjY291bnRzIiwibWVzc2FnZXMiLCJzZWxlY3RvckNzc0xvZ2luRm9ybSIsIl9sb2dpbkJveCIsIl9mb3JtSWQiLCJfYnV0dG9uU3VibWl0SWQiLCJfc2hvd0xvZ2luQm94QnRuSWQiLCJzZWxlY3RvckNzc0xvZ2luRm9ybUluc3RhZ3JhbSIsImlzTG9naW5JbnN0YWdyYW0iLCJpbml0IiwiaW5pdEhlYWRlciIsImNvbmZpcm1hdGlvbldpdGhSZWRpcmVjdCIsInBhcnNlUXVlcnlTdHJpbmciLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsIm9ialVSTCIsInJlcGxhY2UiLCJSZWdFeHAiLCIkMCIsIiQxIiwiJDIiLCJwYXJhbXMiLCJzZW5kQ29uZmlybSIsImNvbmZpcm0iLCJkYXRhIiwiY3VzdG9tZXJzRGF0YVN0cmluZyIsInNlc3Npb25TdG9yYWdlIiwiZ2V0SXRlbSIsImNvbnNvbGUiLCJsb2ciLCJzZXRUaW1lb3V0IiwicmVkaXJlY3QiLCJwYXRobmFtZSIsImluZGV4T2YiLCJzZWxlY3RvcnNFbCIsImxlZnRNZW51IiwiaGFtYnVyZ2VyQnV0dG9uQ2xzIiwiaGFtYnVyZ2VyTWVudUNscyIsImhhbWJ1cmdlck1lbnVPcGVuZWRDbGFzcyIsImhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3MiLCJyaWdodE1lbnUiLCJzdWJIZWFkZXIiLCJ0b2dnbGVIYW1idXJnZXJNZW51IiwibWVudU5hbWUiLCJ0b2dnbGVDbGFzcyIsIm9uIiwiYmluZCIsInNlbGVjdG9yTG9naW5TdGF0ZSIsInNlbGVjdG9yRW1haWxDb25maXJtU3RhdGUiLCJjbG9zZUNsYXNzIiwib3BlbmVkQ2xhc3MiLCJlbWFpbE5vdENvbmZpcm1lZCIsIiRlbWFpbG5Nc2ciLCJjc3MiLCJvbkxvZ2luU3Vic2NyaWJlIiwibXNnIiwicmVtb3ZlQ2xhc3MiLCIkbG9naW5Nc2ciLCJpc0VtYWlsQ29uZmlybWVkIiwic2hvd0xvZ291dCIsImlzTG9nZ2VkIiwiaXNMb2dnZWRJbiIsInBhcmVudCIsInNob3ciLCJvbGRVUkwiLCJyZWZlcnJlciIsImluY2x1ZGVzIiwiJGxvZ2luQm94IiwiJHJlZ2lzdGVyQm94Iiwic3Vic2NyaWJlIiwiaGlkZSIsImFkZEluc3RhZ3JhbUFjY291bnQiLCJuZXdGb3JtRGF0YSIsIiRtc2dMaXN0IiwiY2F0Y2giLCJlcnIiLCJhZGRPbkxvYWRIYW5kbGVycyIsImUiLCJidG4iLCJ0YXJnZXQiLCIkbW9kYWxCb2R5IiwiY2xvc2VzdCIsImZpbmQiLCJ2YWwiLCJ0cmltIiwiJGZvcm0iLCJmb3JtIiwiY3NzVmFsaWRhdGlvbkNsYXNzIiwicHJldmVudERlZmF1bHQiLCJjaGVja1ZhbGlkaXR5IiwicmVwb3J0VmFsaWRpdHkiLCJhZGRMaXN0SGFuZGxlciIsIiRidXR0b24iLCJzZW5kVG8iLCJzdG9wUHJvcGFnYXRpb24iLCJtb2RhbCIsImdldFNlY3VyaXR5S2V5IiwiJG1vZGFsIiwiJGtleUlucHV0IiwiY29uZmlybVNlY3VyaXR5S2V5IiwibGVuIiwibWluTGVuIiwiTnVtYmVyIiwiYXR0ciIsIm9uSGlkZU1vZGFsIiwicmVtb3ZlQXR0ciIsInR5cGVTZWxlY3RlZCIsImNoZWNrcG9pbnRUeXBlQWN0aXZlIiwibW9kYWxDb25maWciLCJfY29uZmlnIiwiZGVmYXVsdEF2YXRhclNyYyIsImluc2VydEl0ZW0iLCJjc3NDbHMiLCJsaVRwbCIsInN0YXRzIiwiaW5mbyIsInRwbCIsImNoZWNrcG9pbnQiLCJ0eXBlIiwibWV0YWRhdGEiLCJnZXRNZXRhZGF0YSIsInJlc2VuZFJlcXVlc3QiLCJpc1NlbmRSZXFPbmNlIiwiY2hlY2tSZXNwb25zZSIsImlzUmVzZW5kUmVxdWVzdCIsImFjY291bnRzIiwiTG9naW5Gb3JtIiwic2VsZWN0b3JDc3MiLCIkZW1haWwiLCIkdGV4dEFyZWFEZXNjcmlwdGlvbiIsInVzZXJMb2dpbkhlYWRlciIsIl9mb3JtRGF0YSIsInN1Ym1pdEZvcm0iLCJmb3JtRGF0YU9iaiIsInRvTG9jYWxlTG93ZXJDYXNlIiwicHVibGlzaCIsImxvZ091dCIsImJpbmRFdmVudHMiLCIkc2hvd0xvZ2luQm94QnRuSWQiLCIkYnV0dG9uU3VibWl0IiwiZXZlbnQiLCJpc0xvZ2luQnRuQ2xpY2siLCJpc0FkZEluc3RhZ3JhbUJ0bkNsaWNrZWQiLCJoYXNDbGFzcyIsImNvbnZlcnNhdGlvbiIsInVzZXJMaXN0IiwiaXNJbk1lc3NhZ2VQYWdlIiwiJHVzZXJMaXN0IiwicmVhZHkiLCJtIiwiJHBpY2tlciIsInN0eWxlIiwic3R5bGVOZXciLCJyZXN0cmljdGVkVXBsb2FkZXIiLCJGaW5lVXBsb2FkZXIiLCJlbGVtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0ZW1wbGF0ZSIsInJlcXVlc3QiLCJlbmRwb2ludCIsInRodW1ibmFpbHMiLCJwbGFjZWhvbGRlcnMiLCJ3YWl0aW5nUGF0aCIsIm5vdEF2YWlsYWJsZVBhdGgiLCJ2YWxpZGF0aW9uIiwiYWxsb3dlZEV4dGVuc2lvbnMiLCJpdGVtTGltaXQiLCJzaXplTGltaXQiLCJpbnNlcnRNc2ciLCJzaWRlIiwidGltZXN0YW1wIiwiZmlsbFVzZXJMaXN0IiwibWV0YSIsImNvbnZlcnNhdGlvbkRldGFpbCIsImFkZENvbnZlcnNhdGlvbnMiLCJjb252ZXJzYXRpb25zIiwiaWR4IiwidG8iLCJhZGRIYW5kbGVycyIsInVzZXJNc2ciLCJhbGVydCIsInNlbGVjdG9yQ2xzIiwic3VibWl0QnRuIiwiUmVnaXN0ZXJGb3JtIiwiJHBhc3N3b3JkIiwiJHBhc3N3b3JkQ29uZmlybSIsInBhc3N3b3JkQ29uZmlybSIsInJlZ2lzdGVyIiwicmVnaXN0ZXJCb3giLCIkYnRuIiwiaXMiLCJpc1JlZ0J0bkNsaWNrIiwiVXNlckNvbnZlcnNhdGlvbiIsIkxvZ2luUGFnZSIsImhyZWYiLCJJbnN0YWdyYW0iLCJzZWxlY3RvckNTUyIsImdldEluc3RhZ3JhbUFjY291bnQiXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsbURBQTJDLGNBQWM7O0FBRXpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsbUNBQTJCLDBCQUEwQixFQUFFO0FBQ3ZELHlDQUFpQyxlQUFlO0FBQ2hE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QWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxxRUFBcUU7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0hBQW9IO0FBQ3BIO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsV0FBVztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGtDQUFrQztBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLHdDQUF3QyxrQ0FBa0M7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQix3Q0FBd0Msa0NBQWtDO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFBQTtBQUNiLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxlQUFlLHFCQUFxQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNB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Q0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUIscUNBQXFDO0FBQ3JDO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDBFQUEwRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLDZCQUE2QjtBQUM3QiwyQkFBMkI7QUFDM0IsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYix3Q0FBd0M7QUFDeEMsbUNBQW1DO0FBQ25DLDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1SUFBdUk7QUFDdkk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtB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Q2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsUUFBUTtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHNJQUFzSSx1QkFBdUIsZ0NBQWdDO0FBQzdMO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFFQUFxRTtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRDtBQUNsRCxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsK0RBQStELDBDQUEwQztBQUN6RztBQUNBLDBFQUEwRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsNkRBQTZELElBQUk7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsaUJBQWlCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGlOQUFpTixRQUFRLEdBQUcsR0FBRyxHQUFHLEdBQUc7QUFDck87QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSx1REFBdUQ7QUFDdkQ7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEMscUNBQXFDO0FBQ3JDLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFFQUFxRSxlQUFlO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLHlFQUF5RSxtQkFBbUI7QUFDNUY7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYiwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLHdDQUF3QztBQUN4QyxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxnR0FBZ0csTUFBTSxPQUFPLE1BQU07QUFDbkg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLFNBQVM7QUFDNUU7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckIsd0VBQXdFO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4RUFBOEU7QUFDOUUsaUJBQWlCO0FBQ2pCO0FBQ0EsdUVBQXVFO0FBQ3ZFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRjtBQUNsRjtBQUNBLDREQUE0RDtBQUM1RDtBQUNBLG1EQUFtRDtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QiwwQ0FBMEMsT0FBTztBQUNqRDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIsNkJBQTZCO0FBQzdCLG9CQUFvQjtBQUNwQixtREFBbUQ7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUU7QUFDdkUscUJBQXFCO0FBQ3JCO0FBQ0EsdUVBQXVFO0FBQ3ZFLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlDQUFpQztBQUM5QztBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHFFQUFxRTtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHFCQUFxQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUVBQXVFO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDBEQUEwRCxjQUFjO0FBQ3hFO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQSxhQUFhO0FBQ2IscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtB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aUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxVQUFVO0FBQ3ZGLHFEQUFxRCxTQUFTO0FBQzlEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EscUhBQXFILFVBQVU7QUFDL0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QixvQkFBb0IsV0FBVztBQUMvQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0Esa0NBQWtDLFFBQVEsTUFBTSxXQUFXO0FBQzNEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSwwQ0FBMEMsU0FBUyxFQUFFLFFBQVE7QUFDN0QsYUFBYTtBQUNiO0FBQ0E7QUFDQSxrRUFBa0UsU0FBUztBQUMzRTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyx3QkFBd0I7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRkFBb0Y7QUFDcEY7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0EsZ0NBQWdDLDBCQUEwQiwwQ0FBMEM7QUFDcEc7QUFDQTtBQUNBO0FBQ0EseUZBQXlGLFNBQVM7QUFDbEc7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFB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Qyw0UEFBNFAsOEJBQThCLHNCQUFzQiw0b0JBQTRvQix3QkFBd0IsKzRFQUErNEUsd0JBQXdCLHlqREFBeWpELHdCQUF3QixncENBQWdwQyx3QkFBd0IsczFDQUFzMUMsd0JBQXdCLHlzQkFBeXNCLEVBQUUsbUNBQW1DLDBDQUEwQyxtZEFBbWQsaVNBQWlTLDBDQUEwQyw4U0FBOFMsb1VBQW9VLDBDQUEwQyxnVEFBZ1Qsc1RBQXNULDBDQUEwQyw2U0FBNlMsa0tBQWtLLDBDQUEwQyw4U0FBOFMsNFFBQTRRLDBDQUEwQyxrVEFBa1QsbVJBQW1SLHlDQUF5QyxnRUFBZ0UsMENBQTBDLGdUQUFnVCxtVUFBbVUsZUFBZSxHQUFHLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxHQUFHLFNBQVMsRTs7Ozs7O0FDQS9vbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImluZGV4LWFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vbnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHRcbiBcdF9fd2VicGFja19yZXF1aXJlX18uaSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfTtcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMjMpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDExYjViZWRjZWI1ZWM5NjJiNjE1IiwiZXhwb3J0IGNvbnN0IENPTlNUID0ge1xyXG4gICAgdXJsOiB7XHJcbiAgICAgICAgYmFzZTogJ2h0dHA6Ly9hcGkubHV4Z3JhbS5ydS92MS8nLFxyXG4gICAgICAgIHJlZ2lzdHJhdGlvbjogJ3JlZ2lzdHJhdGlvbi9iYXNpYy8nLFxyXG4gICAgICAgIGxvZ2luOiAncmVnaXN0cmF0aW9uL2Jhc2ljL2xvZ2luJyxcclxuICAgICAgICBjb25maXJtYXRpb246ICdyZWdpc3RyYXRpb24vYmFzaWMvY29uZmlybWF0aW9uP3Rva2VuJyxcclxuICAgICAgICBpbnN0YWdyYW1fYWRkQWNjb3VudDogJ2luc3RhZ3JhbS1hY2NvdW50cy8nLFxyXG4gICAgICAgIGluc3RhZ3JhbUFjY291bnRfZ2V0TWV0YURhdGE6ICdpbnN0YWdyYW0tYWNjb3VudHMvbWV0YScsXHJcbiAgICAgICAgaW5zdGFncmFtQWNjb3VudF9jaGVja3BvaW50OiAnaW5zdGFncmFtLWFjY291bnRzL2NoZWNrcG9pbnQvJyxcclxuICAgICAgICBpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXk6ICdpbnN0YWdyYW0tYWNjb3VudHMvY2hlY2twb2ludC8nLFxyXG4gICAgICAgIGluc3RhZ3JhbURpcmVjdF9nZXRNZXRhRGF0YTogJy9pbnN0YWdyYW0tZGlyZWN0L21ldGEnXHJcbiAgICB9LFxyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgdG9rZW46ICcnXHJcbiAgICB9LFxyXG4gICAgY29va2llU3RvcmFnZToge1xyXG4gICAgICAgIHRva2VuOiAndXNlcl9sb2dnZWQnLFxyXG4gICAgICAgIGVtYWlsQ29uZmlybWVkOiAnZW1haWxfY29uZmlybWVkJ1xyXG4gICAgfSxcclxuICAgIHVpU2VsZWN0b3JzOiB7XHJcbiAgICAgICAgaGVhZGVyTG9naW5Cb3g6ICduYXYgLmxvZ2luLWJveCcsXHJcbiAgICAgICAgaGVhZGVyTmF2TG9naW5CdG46ICduYXYgdWwgbGkgLmpzX2xvZ2luJyxcclxuICAgICAgICBoZWFkZXJSZWdCb3g6ICduYXYgLnJlZ2lzdGVyLWJveCcsXHJcbiAgICAgICAgaGVhZGVyUmVnQnRuOiAnbmF2IHVsIGxpIC5qc19yZWdpc3RlcicsXHJcbiAgICAgICAgaW5zdGFncmFtOiB7XHJcbiAgICAgICAgICAgIGFkZEFjY291bnRCdG5TZWxlY3RvcjogJyNqc19zaG93LWxvZ2luLWJveCcsXHJcbiAgICAgICAgICAgIGFkZEFjY291bnRCdG5JZDogJ2pzX3Nob3ctbG9naW4tYm94J1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBldmVudHM6IHtcclxuICAgICAgICBVU0VSX0xPR0dFRDogJ3VzZXJfbG9nZ2VkJyxcclxuICAgICAgICBVU0VSX0xPR09VVDogJ3VzZXJfbG9nb3V0JyxcclxuICAgICAgICBVU0VSX0VNQUlMX0NPTkZJUk1FRDogJ3VzZXJfZW1haWxfY29uZmlybWVkJyxcclxuICAgICAgICBTVE9QX0ZJWEVEX1NQSU5ORVI6ICdzdG9wX2ZpeGVkX3NwaW5uZXInXHJcbiAgICB9LFxyXG4gICAgZ2V0UGF0aChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXJsLmJhc2UgKyB0aGlzLnVybFtuYW1lXTtcclxuICAgIH1cclxufTtcclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuL2NvbnN0cyc7XHJcbmltcG9ydCBOZXR3b3JrIGZyb20gJy4vbmV0d29yayc7XHJcbmltcG9ydCBDb29raWVTdG9yYWdlIGZyb20gJy4vY29va2llJztcclxuXHJcbmNsYXNzIFVzZXIge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMubmV0d29yayA9IG5ldyBOZXR3b3JrKCk7XHJcbiAgICAgICAgdGhpcy5jb29raWVTdG9yYWdlID0gQ29va2llU3RvcmFnZTtcclxuICAgICAgICB0aGlzLnNldHRpbmdQb3N0ID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaXNMb2dnZWRJbigpIHtcclxuICAgICAgICByZXR1cm4gISF0aGlzLmdldFRva2VuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNFbWFpbENvbmZpcm1lZCgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuY29va2llU3RvcmFnZS5nZXQoQ09OU1QuY29va2llU3RvcmFnZS5lbWFpbENvbmZpcm1lZCkgPT09ICdjb25maXJtZWQnKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUb2tlbigpIHtcclxuICAgICAgICBjb25zdCBjb29raWVUb2tlbiA9IHRoaXMuY29va2llU3RvcmFnZS5nZXQoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbik7XHJcbiAgICAgICAgcmV0dXJuIGNvb2tpZVRva2VuO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZ2luKGZvcm1EYXRhLCBjYkVycm9yKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHsuLi50aGlzLnNldHRpbmdQb3N0LCBib2R5OiBKU09OLnN0cmluZ2lmeShmb3JtRGF0YSl9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5ldHdvcmsuc2VuZFJlcXVlc3QoQ09OU1QuZ2V0UGF0aCgnbG9naW4nKSwgc2V0dGluZywgY2JFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSW5zdGFncmFtQWNjb3VudChmb3JtRGF0YSwgY2JFcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSB7XHJcbiAgICAgICAgICAgIC4uLnRoaXMuc2V0dGluZ1Bvc3QsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGZvcm1EYXRhKSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ2luc3RhZ3JhbV9hZGRBY2NvdW50JyksIHNldHRpbmcsIGNiRXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluc3RhZ3JhbUFjY291bnQoKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ2luc3RhZ3JhbV9hZGRBY2NvdW50JyksIHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpcm0odG9rZW4pIHtcclxuICAgICAgICAvLyBjb25zdCBjb25maXJtVXJsID0gQ09OU1QuZ2V0UGF0aCgnY29uZmlybWF0aW9uJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV0d29yay5zZW5kUmVxdWVzdChgJHtDT05TVC5nZXRQYXRoKCdjb25maXJtYXRpb24nKSArIHRva2VufWApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyKGZvcm1EYXRhKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZm9ybURhdGEpXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ3JlZ2lzdHJhdGlvbicpLCBzZXR0aW5nKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRNZXRhZGF0YSh0b2tlbiwgY2JFcnJvcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5ldHdvcmsuc2VuZFJlcXVlc3QoYCR7Q09OU1QuZ2V0UGF0aCgnaW5zdGFncmFtQWNjb3VudF9nZXRNZXRhRGF0YScpfWAsIHtoZWFkZXJzOiB7dG9rZW59fSwgY2JFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VjdXJpdHlLZXkodXNlcm5hbWUsIGNoZWNrcG9pbnRUeXBlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyd0eXBlJzogY2hlY2twb2ludFR5cGV9KSwgLy8gdG9kbzogdG1wIHNldCwgaXQgc2hvdWxkIGJlICd0eXBlJ1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAuLi50aGlzLnNldHRpbmdQb3N0LmhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICAndG9rZW4nOiAnM2UzMjFlNjAwMjk3MTFlOTkyNjRhMDQ4MWM4ZTE3ZDQnIC8vIHRvZG86IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KGAke0NPTlNULmdldFBhdGgoJ2luc3RhZ3JhbUFjY291bnRfY2hlY2twb2ludCcpfSR7dXNlcm5hbWV9YCwgc2V0dGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uZmlybVNlY3VyaXR5S2V5KGtleSwgdXNlcm5hbWUpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7J3NlY3VyaXR5X2NvZGUnOiBrZXl9KSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgJ3Rva2VuJzogJzNlMzIxZTYwMDI5NzExZTk5MjY0YTA0ODFjOGUxN2Q0JyAvLyB0b2RvOiB0aGlzLmdldFRva2VuKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV0d29yay5zZW5kUmVxdWVzdChgJHtDT05TVC5nZXRQYXRoKCdpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXknKX0ke3VzZXJuYW1lfWAsIHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxubGV0IHVzZXJJbnN0YW5jZSA9IG51bGw7XHJcblxyXG5pZiAoIXVzZXJJbnN0YW5jZSkge1xyXG4gICAgdXNlckluc3RhbmNlID0gbmV3IFVzZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlckluc3RhbmNlO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL3VzZXIuanMiLCJcclxuY29uc3QgQ29va2llU3J2ID0ge1xyXG4gICAgZ2V0OiBuYW1lID0+IHtcclxuICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY29va2llLm1hdGNoKGAoPzooPzpefC4qOyAqKSR7bmFtZX0gKj0gKihbXjtdKikuKiQpfF4uKiRgKVsxXTtcclxuICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGMpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZXQ6IChuYW1lLCB2YWx1ZSwgb3B0cyA9IHtwYXRoOiAnLycsIGRheXM6IDM2NX0pID0+IHtcclxuICAgICAgICBpZiAob3B0cy5kYXlzKSB7XHJcbiAgICAgICAgICAgIG9wdHNbJ21heC1hZ2UnXSA9IG9wdHMuZGF5cyAqIDYwICogNjAgKiAyNDtcclxuICAgICAgICAgICAgZGVsZXRlIG9wdHMuZGF5cztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXHJcbiAgICAgICAgb3B0cyA9IE9iamVjdC5lbnRyaWVzKG9wdHMpLnJlZHVjZSgoc3RyLCBbaywgdl0pID0+IGAke3N0cn07ICR7a309JHt2fWAsICcnKTtcclxuICAgICAgICBkb2N1bWVudC5jb29raWUgPSBgJHtuYW1lfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkgKyBvcHRzfWA7XHJcbiAgICB9LFxyXG4gICAgcmVtb3ZlOiAobmFtZSwgb3B0cykgPT4gQ29va2llU3J2LnNldChuYW1lLCAnJywgeydtYXgtYWdlJzogLTEsIHBhdGg6ICcvJywgZGF5czogMCwgLi4ub3B0c30pXHJcbiAgICAvLyBwYXRoICYgZG9tYWluIG11c3QgbWF0Y2ggY29va2llIGJlaW5nIGRlbGV0ZWRcclxufTtcclxuXHJcbi8qXHJcbmNsYXNzIENvb2tpZVN0b3JhZ2Uge1xyXG4gICAgcmVhZChrZXkpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9ICQuY29va2llKGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyBudWxsIDogdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29va2llKG5hbWUsIHZhbHVlLCBkYXlzKSB7XHJcbiAgICAgICAgbGV0IGV4cGlyZXMgPSAnJztcclxuICAgICAgICBpZiAoZGF5cykge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XHJcbiAgICAgICAgICAgIGV4cGlyZXMgPSBgOyBleHBpcmVzPSR7ZGF0ZS50b1VUQ1N0cmluZygpfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke25hbWV9ID0keyh2YWx1ZSB8fCAnJykgKyBleHBpcmVzfTsgcGF0aD0vYDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb29raWUobmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gYDsgJHtkb2N1bWVudC5jb29raWV9YDtcclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHZhbHVlLnNwbGl0KGA7ICR7bmFtZX09YCk7XHJcbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5wb3AoKS5zcGxpdCgnOycpLnNoaWZ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiovXHJcblxyXG5leHBvcnQgZGVmYXVsdCBDb29raWVTcnY7XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9jb21tb24vanMtc2VydmljZXMvY29va2llLmpzIiwiLy8gaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuLy8gaW1wb3J0IHtDT05TVH0gZnJvbSAnLi9jb25zdHMnO1xyXG5cclxuZnVuY3Rpb24gdmlld1V0aWxzKCkge1xyXG4gICAgZnVuY3Rpb24gc2hvd0luZm9NZXNzYWdlKHNlbGVjdG9yLCBtZXNzYWdlMSwgbWVzc2FnZTIpIHtcclxuICAgICAgICAkKHNlbGVjdG9yKS5lbXB0eSgpXHJcbiAgICAgICAgICAgIC5hcHBlbmQoYCR7KG1lc3NhZ2UxKSA/IGA8cD5zdGF0dXM6ICR7bWVzc2FnZTF9PC9wPmAgOiAnJ31gKVxyXG4gICAgICAgICAgICAuYXBwZW5kKGA8cD4ke21lc3NhZ2UyfSA8L3A+YCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmlsbExpc3QoJGxpc3QsIGRhdGFBcnJheSkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gZGF0YUFycmF5O1xyXG4gICAgICAgIGNvbnN0IGNMaXN0ID0gJGxpc3Q7XHJcbiAgICAgICAgY0xpc3QuZW1wdHkoKTtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpID0gJCgnPGxpIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtXCI+PC9saT4nKVxyXG4gICAgICAgICAgICAgICAgLmFwcGVuZFRvKGNMaXN0KTtcclxuICAgICAgICAgICAgJCgnPGEvPicpLmFkZENsYXNzKCd1aS1hbGwnKVxyXG4gICAgICAgICAgICAgICAgLnRleHQoaXRlbS51c2VybmFtZSlcclxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhsaSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaXNFbWFpbChlbWFpbCkge1xyXG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlICovXHJcbiAgICAgICAgY29uc3QgcmVnZXggPSAvXihbYS16QS1aMC05Xy4rLV0pK1xcQCgoW2EtekEtWjAtOS1dKStcXC4pKyhbYS16QS1aMC05XXsyLDR9KSskLztcclxuICAgICAgICByZXR1cm4gcmVnZXgudGVzdChlbWFpbCk7XHJcbiAgICAgICAgLyogZXNsaW50LWVuYWJsZSAqL1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgc2hvd0luZm9NZXNzYWdlLFxyXG4gICAgICAgIGZpbGxMaXN0LFxyXG4gICAgICAgIGlzRW1haWxcclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHZpZXdVdGlscygpO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL3ZpZXcuanMiLCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxMCwyMDExLDIwMTIsMjAxMywyMDE0IE1vcmdhbiBSb2RlcmljayBodHRwOi8vcm9kZXJpY2suZGtcbiAqIExpY2Vuc2U6IE1JVCAtIGh0dHA6Ly9tcmducmRyY2subWl0LWxpY2Vuc2Uub3JnXG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL21yb2Rlcmljay9QdWJTdWJKU1xuICovXG5cbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFB1YlN1YiA9IHt9O1xuICAgIHJvb3QuUHViU3ViID0gUHViU3ViO1xuXG4gICAgdmFyIGRlZmluZSA9IHJvb3QuZGVmaW5lO1xuXG4gICAgZmFjdG9yeShQdWJTdWIpO1xuXG4gICAgLy8gQU1EIHN1cHBvcnRcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKXtcbiAgICAgICAgZGVmaW5lKGZ1bmN0aW9uKCkgeyByZXR1cm4gUHViU3ViOyB9KTtcblxuICAgICAgICAvLyBDb21tb25KUyBhbmQgTm9kZS5qcyBtb2R1bGUgc3VwcG9ydFxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKXtcbiAgICAgICAgaWYgKG1vZHVsZSAhPT0gdW5kZWZpbmVkICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBQdWJTdWI7IC8vIE5vZGUuanMgc3BlY2lmaWMgYG1vZHVsZS5leHBvcnRzYFxuICAgICAgICB9XG4gICAgICAgIGV4cG9ydHMuUHViU3ViID0gUHViU3ViOyAvLyBDb21tb25KUyBtb2R1bGUgMS4xLjEgc3BlY1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMgPSBQdWJTdWI7IC8vIENvbW1vbkpTXG4gICAgfVxuXG59KCggdHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93ICkgfHwgdGhpcywgZnVuY3Rpb24gKFB1YlN1Yil7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIG1lc3NhZ2VzID0ge30sXG4gICAgICAgIGxhc3RVaWQgPSAtMTtcblxuICAgIGZ1bmN0aW9uIGhhc0tleXMob2JqKXtcbiAgICAgICAgdmFyIGtleTtcblxuICAgICAgICBmb3IgKGtleSBpbiBvYmope1xuICAgICAgICAgICAgaWYgKCBvYmouaGFzT3duUHJvcGVydHkoa2V5KSApe1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB0aHJvd3MgdGhlIHBhc3NlZCBleGNlcHRpb24sIGZvciB1c2UgYXMgYXJndW1lbnQgZm9yIHNldFRpbWVvdXRcbiAgICAgKiBAYWxpYXMgdGhyb3dFeGNlcHRpb25cbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcGFyYW0geyBPYmplY3QgfSBleCBBbiBFcnJvciBvYmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0aHJvd0V4Y2VwdGlvbiggZXggKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHJlVGhyb3dFeGNlcHRpb24oKXtcbiAgICAgICAgICAgIHRocm93IGV4O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhbGxTdWJzY3JpYmVyV2l0aERlbGF5ZWRFeGNlcHRpb25zKCBzdWJzY3JpYmVyLCBtZXNzYWdlLCBkYXRhICl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyKCBtZXNzYWdlLCBkYXRhICk7XG4gICAgICAgIH0gY2F0Y2goIGV4ICl7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCB0aHJvd0V4Y2VwdGlvbiggZXggKSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjYWxsU3Vic2NyaWJlcldpdGhJbW1lZGlhdGVFeGNlcHRpb25zKCBzdWJzY3JpYmVyLCBtZXNzYWdlLCBkYXRhICl7XG4gICAgICAgIHN1YnNjcmliZXIoIG1lc3NhZ2UsIGRhdGEgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWxpdmVyTWVzc2FnZSggb3JpZ2luYWxNZXNzYWdlLCBtYXRjaGVkTWVzc2FnZSwgZGF0YSwgaW1tZWRpYXRlRXhjZXB0aW9ucyApe1xuICAgICAgICB2YXIgc3Vic2NyaWJlcnMgPSBtZXNzYWdlc1ttYXRjaGVkTWVzc2FnZV0sXG4gICAgICAgICAgICBjYWxsU3Vic2NyaWJlciA9IGltbWVkaWF0ZUV4Y2VwdGlvbnMgPyBjYWxsU3Vic2NyaWJlcldpdGhJbW1lZGlhdGVFeGNlcHRpb25zIDogY2FsbFN1YnNjcmliZXJXaXRoRGVsYXllZEV4Y2VwdGlvbnMsXG4gICAgICAgICAgICBzO1xuXG4gICAgICAgIGlmICggIW1lc3NhZ2VzLmhhc093blByb3BlcnR5KCBtYXRjaGVkTWVzc2FnZSApICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChzIGluIHN1YnNjcmliZXJzKXtcbiAgICAgICAgICAgIGlmICggc3Vic2NyaWJlcnMuaGFzT3duUHJvcGVydHkocykpe1xuICAgICAgICAgICAgICAgIGNhbGxTdWJzY3JpYmVyKCBzdWJzY3JpYmVyc1tzXSwgb3JpZ2luYWxNZXNzYWdlLCBkYXRhICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVEZWxpdmVyeUZ1bmN0aW9uKCBtZXNzYWdlLCBkYXRhLCBpbW1lZGlhdGVFeGNlcHRpb25zICl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBkZWxpdmVyTmFtZXNwYWNlZCgpe1xuICAgICAgICAgICAgdmFyIHRvcGljID0gU3RyaW5nKCBtZXNzYWdlICksXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB0b3BpYy5sYXN0SW5kZXhPZiggJy4nICk7XG5cbiAgICAgICAgICAgIC8vIGRlbGl2ZXIgdGhlIG1lc3NhZ2UgYXMgaXQgaXMgbm93XG4gICAgICAgICAgICBkZWxpdmVyTWVzc2FnZShtZXNzYWdlLCBtZXNzYWdlLCBkYXRhLCBpbW1lZGlhdGVFeGNlcHRpb25zKTtcblxuICAgICAgICAgICAgLy8gdHJpbSB0aGUgaGllcmFyY2h5IGFuZCBkZWxpdmVyIG1lc3NhZ2UgdG8gZWFjaCBsZXZlbFxuICAgICAgICAgICAgd2hpbGUoIHBvc2l0aW9uICE9PSAtMSApe1xuICAgICAgICAgICAgICAgIHRvcGljID0gdG9waWMuc3Vic3RyKCAwLCBwb3NpdGlvbiApO1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdG9waWMubGFzdEluZGV4T2YoJy4nKTtcbiAgICAgICAgICAgICAgICBkZWxpdmVyTWVzc2FnZSggbWVzc2FnZSwgdG9waWMsIGRhdGEsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtZXNzYWdlSGFzU3Vic2NyaWJlcnMoIG1lc3NhZ2UgKXtcbiAgICAgICAgdmFyIHRvcGljID0gU3RyaW5nKCBtZXNzYWdlICksXG4gICAgICAgICAgICBmb3VuZCA9IEJvb2xlYW4obWVzc2FnZXMuaGFzT3duUHJvcGVydHkoIHRvcGljICkgJiYgaGFzS2V5cyhtZXNzYWdlc1t0b3BpY10pKSxcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdG9waWMubGFzdEluZGV4T2YoICcuJyApO1xuXG4gICAgICAgIHdoaWxlICggIWZvdW5kICYmIHBvc2l0aW9uICE9PSAtMSApe1xuICAgICAgICAgICAgdG9waWMgPSB0b3BpYy5zdWJzdHIoIDAsIHBvc2l0aW9uICk7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRvcGljLmxhc3RJbmRleE9mKCAnLicgKTtcbiAgICAgICAgICAgIGZvdW5kID0gQm9vbGVhbihtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eSggdG9waWMgKSAmJiBoYXNLZXlzKG1lc3NhZ2VzW3RvcGljXSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIHN5bmMsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKXtcbiAgICAgICAgbWVzc2FnZSA9ICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N5bWJvbCcpID8gbWVzc2FnZS50b1N0cmluZygpIDogbWVzc2FnZTtcblxuICAgICAgICB2YXIgZGVsaXZlciA9IGNyZWF0ZURlbGl2ZXJ5RnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKSxcbiAgICAgICAgICAgIGhhc1N1YnNjcmliZXJzID0gbWVzc2FnZUhhc1N1YnNjcmliZXJzKCBtZXNzYWdlICk7XG5cbiAgICAgICAgaWYgKCAhaGFzU3Vic2NyaWJlcnMgKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggc3luYyA9PT0gdHJ1ZSApe1xuICAgICAgICAgICAgZGVsaXZlcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0VGltZW91dCggZGVsaXZlciwgMCApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFB1Ymxpc2hlcyB0aGUgbWVzc2FnZSwgcGFzc2luZyB0aGUgZGF0YSB0byBpdCdzIHN1YnNjcmliZXJzXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQGFsaWFzIHB1Ymxpc2hcbiAgICAgKiBAcGFyYW0geyBTdHJpbmcgfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHB1Ymxpc2hcbiAgICAgKiBAcGFyYW0ge30gZGF0YSBUaGUgZGF0YSB0byBwYXNzIHRvIHN1YnNjcmliZXJzXG4gICAgICogQHJldHVybiB7IEJvb2xlYW4gfVxuICAgICAqL1xuICAgIFB1YlN1Yi5wdWJsaXNoID0gZnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEgKXtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIGZhbHNlLCBQdWJTdWIuaW1tZWRpYXRlRXhjZXB0aW9ucyApO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQdWJsaXNoZXMgdGhlIHRoZSBtZXNzYWdlIHN5bmNocm9ub3VzbHksIHBhc3NpbmcgdGhlIGRhdGEgdG8gaXQncyBzdWJzY3JpYmVyc1xuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBhbGlhcyBwdWJsaXNoU3luY1xuICAgICAqIEBwYXJhbSB7IFN0cmluZyB9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gcHVibGlzaFxuICAgICAqIEBwYXJhbSB7fSBkYXRhIFRoZSBkYXRhIHRvIHBhc3MgdG8gc3Vic2NyaWJlcnNcbiAgICAgKiBAcmV0dXJuIHsgQm9vbGVhbiB9XG4gICAgICovXG4gICAgUHViU3ViLnB1Ymxpc2hTeW5jID0gZnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEgKXtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIHRydWUsIFB1YlN1Yi5pbW1lZGlhdGVFeGNlcHRpb25zICk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgdGhlIHBhc3NlZCBmdW5jdGlvbiB0byB0aGUgcGFzc2VkIG1lc3NhZ2UuIEV2ZXJ5IHJldHVybmVkIHRva2VuIGlzIHVuaXF1ZSBhbmQgc2hvdWxkIGJlIHN0b3JlZCBpZiB5b3UgbmVlZCB0byB1bnN1YnNjcmliZVxuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBhbGlhcyBzdWJzY3JpYmVcbiAgICAgKiBAcGFyYW0geyBTdHJpbmcgfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHN1YnNjcmliZSB0b1xuICAgICAqIEBwYXJhbSB7IEZ1bmN0aW9uIH0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgbmV3IG1lc3NhZ2UgaXMgcHVibGlzaGVkXG4gICAgICogQHJldHVybiB7IFN0cmluZyB9XG4gICAgICovXG4gICAgUHViU3ViLnN1YnNjcmliZSA9IGZ1bmN0aW9uKCBtZXNzYWdlLCBmdW5jICl7XG4gICAgICAgIGlmICggdHlwZW9mIGZ1bmMgIT09ICdmdW5jdGlvbicpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbWVzc2FnZSA9ICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N5bWJvbCcpID8gbWVzc2FnZS50b1N0cmluZygpIDogbWVzc2FnZTtcblxuICAgICAgICAvLyBtZXNzYWdlIGlzIG5vdCByZWdpc3RlcmVkIHlldFxuICAgICAgICBpZiAoICFtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eSggbWVzc2FnZSApICl7XG4gICAgICAgICAgICBtZXNzYWdlc1ttZXNzYWdlXSA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZm9yY2luZyB0b2tlbiBhcyBTdHJpbmcsIHRvIGFsbG93IGZvciBmdXR1cmUgZXhwYW5zaW9ucyB3aXRob3V0IGJyZWFraW5nIHVzYWdlXG4gICAgICAgIC8vIGFuZCBhbGxvdyBmb3IgZWFzeSB1c2UgYXMga2V5IG5hbWVzIGZvciB0aGUgJ21lc3NhZ2VzJyBvYmplY3RcbiAgICAgICAgdmFyIHRva2VuID0gJ3VpZF8nICsgU3RyaW5nKCsrbGFzdFVpZCk7XG4gICAgICAgIG1lc3NhZ2VzW21lc3NhZ2VdW3Rva2VuXSA9IGZ1bmM7XG4gICAgICAgIFxuICAgICAgICAvLyByZXR1cm4gdG9rZW4gZm9yIHVuc3Vic2NyaWJpbmdcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIHRoZSBwYXNzZWQgZnVuY3Rpb24gdG8gdGhlIHBhc3NlZCBtZXNzYWdlIG9uY2VcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAYWxpYXMgc3Vic2NyaWJlT25jZVxuICAgICAqIEBwYXJhbSB7IFN0cmluZyB9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gc3Vic2NyaWJlIHRvXG4gICAgICogQHBhcmFtIHsgRnVuY3Rpb24gfSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gYSBuZXcgbWVzc2FnZSBpcyBwdWJsaXNoZWRcbiAgICAgKiBAcmV0dXJuIHsgUHViU3ViIH1cbiAgICAgKi9cbiAgICBQdWJTdWIuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uKCBtZXNzYWdlLCBmdW5jICl7XG4gICAgICAgIHZhciB0b2tlbiA9IFB1YlN1Yi5zdWJzY3JpYmUoIG1lc3NhZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvLyBiZWZvcmUgZnVuYyBhcHBseSwgdW5zdWJzY3JpYmUgbWVzc2FnZVxuICAgICAgICAgICAgUHViU3ViLnVuc3Vic2NyaWJlKCB0b2tlbiApO1xuICAgICAgICAgICAgZnVuYy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gUHViU3ViO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgYWxsIHN1YnNjcmlwdGlvbnNcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcHVibGljXG4gICAgICogQGFsaWFzIGNsZWFyQWxsU3Vic2NyaXB0aW9uc1xuICAgICAqL1xuICAgIFB1YlN1Yi5jbGVhckFsbFN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiBjbGVhckFsbFN1YnNjcmlwdGlvbnMoKXtcbiAgICAgICAgbWVzc2FnZXMgPSB7fTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgc3Vic2NyaXB0aW9ucyBieSB0aGUgdG9waWNcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcHVibGljXG4gICAgICogQGFsaWFzIGNsZWFyQWxsU3Vic2NyaXB0aW9uc1xuICAgICAqL1xuICAgIFB1YlN1Yi5jbGVhclN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiBjbGVhclN1YnNjcmlwdGlvbnModG9waWMpe1xuICAgICAgICB2YXIgbTtcbiAgICAgICAgZm9yIChtIGluIG1lc3NhZ2VzKXtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eShtKSAmJiBtLmluZGV4T2YodG9waWMpID09PSAwKXtcbiAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZXNbbV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBzdWJzY3JpcHRpb25zXG4gICAgICpcbiAgICAgKiAtIFdoZW4gcGFzc2VkIGEgdG9rZW4sIHJlbW92ZXMgYSBzcGVjaWZpYyBzdWJzY3JpcHRpb24uXG4gICAgICpcblx0ICogLSBXaGVuIHBhc3NlZCBhIGZ1bmN0aW9uLCByZW1vdmVzIGFsbCBzdWJzY3JpcHRpb25zIGZvciB0aGF0IGZ1bmN0aW9uXG4gICAgICpcblx0ICogLSBXaGVuIHBhc3NlZCBhIHRvcGljLCByZW1vdmVzIGFsbCBzdWJzY3JpcHRpb25zIGZvciB0aGF0IHRvcGljIChoaWVyYXJjaHkpXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBhbGlhcyBzdWJzY3JpYmVPbmNlXG4gICAgICogQHBhcmFtIHsgU3RyaW5nIHwgRnVuY3Rpb24gfSB2YWx1ZSBBIHRva2VuLCBmdW5jdGlvbiBvciB0b3BpYyB0byB1bnN1YnNjcmliZSBmcm9tXG4gICAgICogQGV4YW1wbGUgLy8gVW5zdWJzY3JpYmluZyB3aXRoIGEgdG9rZW5cbiAgICAgKiB2YXIgdG9rZW4gPSBQdWJTdWIuc3Vic2NyaWJlKCdteXRvcGljJywgbXlGdW5jKTtcbiAgICAgKiBQdWJTdWIudW5zdWJzY3JpYmUodG9rZW4pO1xuICAgICAqIEBleGFtcGxlIC8vIFVuc3Vic2NyaWJpbmcgd2l0aCBhIGZ1bmN0aW9uXG4gICAgICogUHViU3ViLnVuc3Vic2NyaWJlKG15RnVuYyk7XG4gICAgICogQGV4YW1wbGUgLy8gVW5zdWJzY3JpYmluZyBmcm9tIGEgdG9waWNcbiAgICAgKiBQdWJTdWIudW5zdWJzY3JpYmUoJ215dG9waWMnKTtcbiAgICAgKi9cbiAgICBQdWJTdWIudW5zdWJzY3JpYmUgPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgIHZhciBkZXNjZW5kYW50VG9waWNFeGlzdHMgPSBmdW5jdGlvbih0b3BpYykge1xuICAgICAgICAgICAgICAgIHZhciBtO1xuICAgICAgICAgICAgICAgIGZvciAoIG0gaW4gbWVzc2FnZXMgKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eShtKSAmJiBtLmluZGV4T2YodG9waWMpID09PSAwICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhIGRlc2NlbmRhbnQgb2YgdGhlIHRvcGljIGV4aXN0czpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVG9waWMgICAgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmICggbWVzc2FnZXMuaGFzT3duUHJvcGVydHkodmFsdWUpIHx8IGRlc2NlbmRhbnRUb3BpY0V4aXN0cyh2YWx1ZSkgKSxcbiAgICAgICAgICAgIGlzVG9rZW4gICAgPSAhaXNUb3BpYyAmJiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnLFxuICAgICAgICAgICAgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlLFxuICAgICAgICAgICAgbSwgbWVzc2FnZSwgdDtcblxuICAgICAgICBpZiAoaXNUb3BpYyl7XG4gICAgICAgICAgICBQdWJTdWIuY2xlYXJTdWJzY3JpcHRpb25zKHZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoIG0gaW4gbWVzc2FnZXMgKXtcbiAgICAgICAgICAgIGlmICggbWVzc2FnZXMuaGFzT3duUHJvcGVydHkoIG0gKSApe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlc1ttXTtcblxuICAgICAgICAgICAgICAgIGlmICggaXNUb2tlbiAmJiBtZXNzYWdlW3ZhbHVlXSApe1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZVt2YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAvLyB0b2tlbnMgYXJlIHVuaXF1ZSwgc28gd2UgY2FuIGp1c3Qgc3RvcCBoZXJlXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIHQgaW4gbWVzc2FnZSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaGFzT3duUHJvcGVydHkodCkgJiYgbWVzc2FnZVt0XSA9PT0gdmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlW3RdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG59KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcHVic3ViLWpzL3NyYy9wdWJzdWIuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLy8gaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuaW1wb3J0IHZpZXdVdGlscyBmcm9tICcuL3ZpZXcnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTmV0d29yayB7XHJcblxyXG4gICAgY2JFcnJvckRlZmF1bHQocmVzdWx0KSB7XHJcbiAgICAgICAgY29uc3QgJGVsID0gKCQoJyNkZXNjcmlwdGlvbicpLmxlbmd0aCkgPyAkKCcjZGVzY3JpcHRpb24nKSA6ICQoJy5lcnJvci1tc2cnKTtcclxuICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCRlbCxcclxuICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSxcclxuICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBlcnJvcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrU3RhdHVzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAmJiByZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7XHJcbiAgICAgICAgICAgIGVycm9yLnJlc3BvbnNlID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZW5kUmVxdWVzdChVUkwsIE9QVFMsIGNiRXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goVVJMLCBPUFRTKVxyXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiBQcm9taXNlLmFsbChbcmVzcG9uc2UsIHJlc3BvbnNlLmpzb24oKV0pKVxyXG4gICAgICAgICAgICAudGhlbigoW3Jlc3BvbnNlLCBqc29uXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY2JFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNiRXJyb3JEZWZhdWx0KGpzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiRXJyb3IoanNvbik7IC8vIHVwZGF0ZSB2aWV3XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tTdGF0dXMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcihqc29uLnN0YXR1cy5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBqc29uO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9uZXR3b3JrLmpzIiwiaW1wb3J0ICcuL2Jhc2Uuc2Nzcyc7XHJcbi8vIGltcG9ydCAnYm9vdHN0cmFwJztcclxuXHJcbmltcG9ydCBSZWdpc3RlckZvcm0gZnJvbSAnLi9ibG9ja3MvcmVnaXN0ZXItZm9ybS9yZWdpc3Rlci1mb3JtJztcclxuaW1wb3J0IHtMb2dpbkZvcm19IGZyb20gJy4vYmxvY2tzL2xvZ2luLWZvcm0vbG9naW4tZm9ybSc7XHJcbmltcG9ydCB7TG9naW5QYWdlfSBmcm9tICcuL3BhZ2VzL19hdXRoL2xvZ2luLXBhZ2UnO1xyXG5pbXBvcnQge2NvbmZpcm1hdGlvbldpdGhSZWRpcmVjdH0gZnJvbSAnLi9ibG9ja3MvY29uZmlybS1yZWcvY29uZmlybS1yZWcnO1xyXG5pbXBvcnQge0luc3RhZ3JhbX0gZnJvbSAnLi9wYWdlcy9faW5zdGFncmFtL2luc3RhZ3JhbSc7XHJcbmltcG9ydCAqIGFzIGhlYWRlciBmcm9tICcuL2Jsb2Nrcy9oZWFkZXIvaGVhZGVyJztcclxuaW1wb3J0ICogYXMgYnVyZ2VyTWVudSBmcm9tICcuL2Jsb2Nrcy9oZWFkZXIvYnVyZ2VyLW1lbnUvYnVyZ2VyLW1lbnUnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMnO1xyXG5pbXBvcnQgKiBhcyBpbnN0YWdyYW1BY2NvdW50cyBmcm9tICcuL2Jsb2Nrcy9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdCc7XHJcbmltcG9ydCAqIGFzIG1lc3NhZ2VzIGZyb20gJy4vYmxvY2tzL21lc3NhZ2VzL21lc3NhZ2VzJztcclxuXHJcbmNvbnN0IHNlbGVjdG9yQ3NzTG9naW5Gb3JtID0ge1xyXG4gICAgX2xvZ2luQm94OiBDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJMb2dpbkJveCxcclxuICAgIF9mb3JtSWQ6ICcjanNfbG9naW4tZm9ybScsXHJcbiAgICBfYnV0dG9uU3VibWl0SWQ6ICcjanNfbG9naW5fYnRuJyxcclxuICAgIF9zaG93TG9naW5Cb3hCdG5JZDogQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyTmF2TG9naW5CdG5cclxufTtcclxuXHJcbmNvbnN0IHNlbGVjdG9yQ3NzTG9naW5Gb3JtSW5zdGFncmFtID0ge1xyXG4gICAgX2xvZ2luQm94OiAnbWFpbiAubG9naW4tYm94JyxcclxuICAgIF9mb3JtSWQ6ICcjanNfaW5zdGFncmFtLWFkZC1hY2NvdW50JyxcclxuICAgIF9idXR0b25TdWJtaXRJZDogJyNqc19pbnN0YWdyYW0tYWRkLWFjY291bnQtLWJ0bicsXHJcbiAgICBfc2hvd0xvZ2luQm94QnRuSWQ6ICcjanNfc2hvdy1sb2dpbi1ib3gnLFxyXG4gICAgaXNMb2dpbkluc3RhZ3JhbTogdHJ1ZVxyXG59O1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIC8vIGNvbnNvbGUubG9nKCdpbml0IGpzIGhlcmUnLCBDT05TVC51c2VyKTtcclxuICAgIChuZXcgUmVnaXN0ZXJGb3JtKCkpLmluaXQoKTtcclxuICAgIExvZ2luRm9ybShzZWxlY3RvckNzc0xvZ2luRm9ybSkuaW5pdCgpO1xyXG4gICAgTG9naW5Gb3JtKHNlbGVjdG9yQ3NzTG9naW5Gb3JtSW5zdGFncmFtKS5pbml0KCk7IC8vIGluaXQgaW5zdGFncmFtIGxvZ2luIGZvcm0qIS9cclxuICAgIExvZ2luUGFnZSh7XHJcbiAgICAgICAgX2xvZ2luQm94OiAnLmF1dGgubG9naW4gLmNhcmQtc2lnbmluJyxcclxuICAgICAgICBfZm9ybUlkOiAnLmZvcm0tc2lnbmluJyxcclxuICAgICAgICBfYnV0dG9uU3VibWl0SWQ6ICcuZm9ybS1zaWduaW4gW3R5cGU9XCJzdWJtaXRcIl0nXHJcbiAgICB9KS5pbml0KCk7XHJcbiAgICBJbnN0YWdyYW0oKS5pbml0KCk7XHJcbiAgICBjb25maXJtYXRpb25XaXRoUmVkaXJlY3QoKS5pbml0KCk7XHJcbiAgICBoZWFkZXIuaW5pdEhlYWRlcigpO1xyXG4gICAgYnVyZ2VyTWVudS5pbml0KCk7XHJcbiAgICBpbnN0YWdyYW1BY2NvdW50cy5pbml0KCk7XHJcbiAgICBtZXNzYWdlcy5pbml0KCk7XHJcbn07XHJcblxyXG4oKCkgPT4gaW5pdCgpKSgpO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYm9vdHN0cmFwLmpzIiwiLyogZXNsaW50LWRpc2FibGUgc29ydC12YXJzICovXHJcbi8vIGltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyJztcclxuaW1wb3J0IHtDT05TVH0gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2NvbnN0cyc7XHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG5cclxuY29uc3QgcGFyc2VRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGNvbnN0IHN0ciA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XHJcbiAgICBjb25zdCBvYmpVUkwgPSB7fTtcclxuXHJcbiAgICBzdHIucmVwbGFjZShcclxuICAgICAgbmV3IFJlZ0V4cCgnKFtePz0mXSspKD0oW14mXSopKT8nLCAnZycpLFxyXG4gICAgICAgIGZ1bmN0aW9uKCQwLCAkMSwgJDIpIHtcclxuICAgICAgICAgICAgb2JqVVJMWyQxXSA9ICQyO1xyXG4gICAgICAgIH1cclxuICApO1xyXG4gICAgcmV0dXJuIG9ialVSTDtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb25maXJtYXRpb25XaXRoUmVkaXJlY3QoKSB7XHJcbiAgICBjb25zdCB1c2VyID0gVXNlcjtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcoKTtcclxuICAgIC8vIEV4YW1wbGUgaG93IHRvIHVzZSBpdDpcclxuXHJcbiAgICBjb25zdCBzZW5kQ29uZmlybSA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgIHVzZXIuY29uZmlybSh0b2tlbikudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzICYmIHJlc3VsdC5zdGF0dXMuc3RhdGUgPT09ICdvaycpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSBpdGVtXHJcbiAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLmVtYWlsQ29uZmlybWVkLCAnY29uZmlybWVkJyk7XHJcbiAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLnRva2VuLCByZXN1bHQuZGF0YS50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uID0gY29uZmlybS1yZWdpc3RyYXRpb24uaHRtbD90b2tlbj0nZnJvbSBzZXJ2ZXInO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIHRoZSBvYmplY3QgaW4gYSBzdHJpbmcgZm9ybVxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tZXJzRGF0YVN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2N1c3RvbWVyc0RhdGEnKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1c3RvbWVyc0RhdGFTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlcXVlc3Qgc3VjY2VlZGVkIHdpdGggSlNPTiByZXNwb25zZScsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkKCcuY29uZmlybS1yZWdpc3RyYXRpb24nKS5hcHBlbmQoYDxwPmNvbmZpcm1hdGlvbiBzdGF0dXM6ICR7cmVzdWx0LnN0YXR1cy5zdGF0ZX08L3A+YCk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnLi9wcm9maWxlLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVkaXJlY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZG90LW5vdGF0aW9uXHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBwYXJhbXNbJ3Rva2VuJ107XHJcblxyXG4gICAgICAgIGlmICghbG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignY29uZmlybS1yZWdpc3RyYXRpb24nKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZCByZXEgdG8gJywgdG9rZW4pO1xyXG4gICAgICAgICAgICBzZW5kQ29uZmlybSh0b2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgIHJlZGlyZWN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0XHJcbiAgICB9O1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvY29uZmlybS1yZWcvY29uZmlybS1yZWcuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5cclxuLy8gY29uc3QgaGFtYnVyZ2VyQnV0dG9uQ2xzID0gJyNhc2lkZV9tb2JpbGVfX2J1dHRvbic7XHJcbi8vIGNvbnN0IGhhbWJ1cmdlck1lbnVDbHMgPSAnLmFzaWRlLWJ1cmdlci1tZW51JztcclxuLy8gY29uc3QgaGFtYnVyZ2VyTWVudU9wZW5lZENsYXNzID0gJ2J1cmdlci1tZW51LS1jbG9zZWQnO1xyXG4vLyBjb25zdCBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzID0gJ2J1cmdlci1tZW51X19idXR0b24tLWNsb3NlJztcclxuY29uc3Qgc2VsZWN0b3JzRWwgPSB7XHJcbiAgICBsZWZ0TWVudToge1xyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsczogJyNhc2lkZV9tb2JpbGVfX2J1dHRvbicsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudUNsczogJy5hc2lkZS1idXJnZXItbWVudScsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudU9wZW5lZENsYXNzOiAnYnVyZ2VyLW1lbnUtLWNsb3NlZCcsXHJcbiAgICAgICAgaGFtYnVyZ2VyQnV0dG9uQ2xvc2VDbGFzczogJ2J1cmdlci1tZW51X19idXR0b24tLWNsb3NlJ1xyXG4gICAgfSxcclxuICAgIHJpZ2h0TWVudToge1xyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsczogJyNoZWFkZXJfbW9iaWxlX3RvZ2dsZXInLFxyXG4gICAgICAgIGhhbWJ1cmdlck1lbnVDbHM6ICcuci1zaWRlLWJ1cmdlci1tZW51JyxcclxuICAgICAgICBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3M6ICdyLXNpZGUtYnVyZ2VyLW1lbnUtLW9wZW4nLFxyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3M6ICdidXJnZXItbWVudS1yaWdodF9fYnV0dG9uLS1jbG9zZSdcclxuICAgIH0sXHJcbiAgICBzdWJIZWFkZXI6IHtcclxuICAgICAgICBoYW1idXJnZXJCdXR0b25DbHM6ICcjaGVhZGVyX21vYmlsZV90b3BiYXJfdG9nZ2xlcicsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudUNsczogJy5zdWItaGVhZGVyJyxcclxuICAgICAgICBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3M6ICdzdWItaGVhZGVyLS1vcGVuJyxcclxuICAgICAgICBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzOiAnc3ViLWhlYWRlci1idXR0b24tLWNsb3NlJ1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFRvZ2dsZSBoYW1idXJnZXIgbWVudSBwb3BvdmVyXHJcbiAqL1xyXG5mdW5jdGlvbiB0b2dnbGVIYW1idXJnZXJNZW51KG1lbnVOYW1lKSB7XHJcbiAgICBjb25zdCB7aGFtYnVyZ2VyTWVudUNscywgaGFtYnVyZ2VyQnV0dG9uQ2xzLCBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzLCBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3N9ID0gc2VsZWN0b3JzRWxbbWVudU5hbWVdO1xyXG4gICAgJChoYW1idXJnZXJCdXR0b25DbHMpLnRvZ2dsZUNsYXNzKGhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3MpO1xyXG4gICAgJChoYW1idXJnZXJNZW51Q2xzKS50b2dnbGVDbGFzcyhoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3MpO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoYW1idXJnZXIgbWVudVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICBjb25zdCBsZWZ0TWVudSA9ICdsZWZ0TWVudSc7XHJcbiAgICBjb25zdCByaWdodE1lbnUgPSAncmlnaHRNZW51JztcclxuICAgIGNvbnN0IHN1YkhlYWRlciA9ICdzdWJIZWFkZXInO1xyXG5cclxuICAgICQoc2VsZWN0b3JzRWxbbGVmdE1lbnVdLmhhbWJ1cmdlckJ1dHRvbkNscykub24oJ2NsaWNrJywgdG9nZ2xlSGFtYnVyZ2VyTWVudS5iaW5kKHRoaXMsIGxlZnRNZW51KSk7XHJcbiAgICAkKHNlbGVjdG9yc0VsW3JpZ2h0TWVudV0uaGFtYnVyZ2VyQnV0dG9uQ2xzKS5vbignY2xpY2snLCB0b2dnbGVIYW1idXJnZXJNZW51LmJpbmQodGhpcywgcmlnaHRNZW51KSk7XHJcbiAgICAkKHNlbGVjdG9yc0VsW3N1YkhlYWRlcl0uaGFtYnVyZ2VyQnV0dG9uQ2xzKS5vbignY2xpY2snLCB0b2dnbGVIYW1idXJnZXJNZW51LmJpbmQodGhpcywgc3ViSGVhZGVyKSk7XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9oZWFkZXIvYnVyZ2VyLW1lbnUvYnVyZ2VyLW1lbnUuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBQdWJTdWIgZnJvbSAncHVic3ViLWpzJzsgLy8gaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVic3ViLWpzXHJcbmltcG9ydCB7Q09OU1R9IGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMnO1xyXG5cclxuY29uc3Qgc2VsZWN0b3JMb2dpblN0YXRlID0gJy5qc19tZXNzYWdlX2xvZ2dlZC0tdGV4dCc7XHJcbmNvbnN0IHNlbGVjdG9yRW1haWxDb25maXJtU3RhdGUgPSAnLmpzX2VtYWlsLWNvbmZpcm0tLXRleHQnO1xyXG5jb25zdCBjbG9zZUNsYXNzID0gJ2Qtbm9uZSc7XHJcbmNvbnN0IG9wZW5lZENsYXNzID0gJ2QtYmxvY2snO1xyXG5cclxuZnVuY3Rpb24gZW1haWxOb3RDb25maXJtZWQoKSB7XHJcbiAgICBjb25zdCAkZW1haWxuTXNnID0gJChzZWxlY3RvckVtYWlsQ29uZmlybVN0YXRlKTtcclxuICAgICRlbWFpbG5Nc2cudGV4dCgnKiplbWFpbE5vdENvbmZpcm1lZCoqIEVtYWlsINC90LUg0L/QvtC00YLQstC10YDQttC00LXQvS4nKS5jc3MoJ2NvbG9yJywgJ2xpZ2h0Y29yYWwnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25Mb2dpblN1YnNjcmliZShtc2csIGRhdGEpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKG1zZywgZGF0YSk7XHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlck5hdkxvZ2luQnRuKS5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlclJlZ0J0bikuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJMb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG5cclxuICAgICQoJy5uYXYtbGluay5qc19sb2dPdXQnKS5hZGRDbGFzcyhvcGVuZWRDbGFzcykucmVtb3ZlQ2xhc3MoY2xvc2VDbGFzcyk7IC8vIHNob3dcclxuICAgIGNvbnN0ICRsb2dpbk1zZyA9ICQoc2VsZWN0b3JMb2dpblN0YXRlKTtcclxuICAgICRsb2dpbk1zZy50ZXh0KCcqKm9uTG9naW5TdWJzY3JpYmUqKiDQstGLINC30LDQu9C+0LPQuNC90LjQu9C40YHRjCDQsiBMdXhncmFtINGD0YHQv9C10YjQvdC+JykuY3NzKCdjb2xvcicsICdsaWdodGJsdWUnKTtcclxuICAgIGNvbnN0IGlzRW1haWxDb25maXJtZWQgPSBVc2VyLmlzRW1haWxDb25maXJtZWQoKTtcclxuICAgIGlmICghaXNFbWFpbENvbmZpcm1lZCkge1xyXG4gICAgICAgIGVtYWlsTm90Q29uZmlybWVkKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dMb2dvdXQoKSB7XHJcbiAgICAvLyBjaGVjayBpcyBsb2dnZWRcclxuICAgIGNvbnN0IGlzTG9nZ2VkID0gVXNlci5pc0xvZ2dlZEluKCk7XHJcbiAgICBjb25zdCBpc0VtYWlsQ29uZmlybWVkID0gVXNlci5pc0VtYWlsQ29uZmlybWVkKCk7XHJcbiAgICBpZiAoIWlzRW1haWxDb25maXJtZWQpIHtcclxuICAgICAgICBlbWFpbE5vdENvbmZpcm1lZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzTG9nZ2VkKSB7XHJcbiAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLnBhcmVudCgpLnNob3coKTtcclxuICAgICAgICAkKCcuanNfZW1haWwtY29uZmlybS0tdGV4dCcpLnRleHQoJ9Cy0Ysg0LfQsNC70L7Qs9C40L3QuNC70LjRgdGMINGD0YHQv9C10YjQvdC+Jyk7XHJcbiAgICAgICAgY29uc3Qgb2xkVVJMID0gZG9jdW1lbnQucmVmZXJyZXI7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2cob2xkVVJMKTtcclxuICAgICAgICBpZiAob2xkVVJMLmluY2x1ZGVzKCdjb25maXJtLXJlZ2lzdHJhdGlvbicpKSB7XHJcbiAgICAgICAgICAgICQoJy5qc19tZXNzYWdlX2xvZ2dlZC0tdGV4dCcpLnRleHQoJ9Cy0Ysg0L/QvtC00YLQstC10YDQtNC40LvQuCDRgNC10LPQuNGB0YLRgNCw0YbQuNGOJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9uTG9naW5TdWJzY3JpYmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJChzZWxlY3RvckxvZ2luU3RhdGUpLnRleHQoJ9Cf0YDQuNCy0LXRgiDQsNC90L7QvdC40LzQvdGL0Lkg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMJyk7XHJcbiAgICAgICAgJChzZWxlY3RvckVtYWlsQ29uZmlybVN0YXRlKS5lbXB0eSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoZWFkZXJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0SGVhZGVyKCkge1xyXG4gICAvLyBjaGVjayBvdGhlciBoYW5kbGVyIGluIGxvZ2luLWZvcm0uanNcclxuICAgIGNvbnN0ICRsb2dpbkJveCA9ICQoQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyTG9naW5Cb3gpO1xyXG4gICAgY29uc3QgJHJlZ2lzdGVyQm94ID0gJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJSZWdCb3gpO1xyXG5cclxuICAgIFB1YlN1Yi5zdWJzY3JpYmUoQ09OU1QuZXZlbnRzLlVTRVJfTE9HR0VELCBvbkxvZ2luU3Vic2NyaWJlKTtcclxuXHJcbiAgICBzaG93TG9nb3V0KCk7XHJcblxyXG4gICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJSZWdCdG4pLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAkbG9naW5Cb3guaGlkZSgpO1xyXG4gICAgICAgICRyZWdpc3RlckJveC5jc3Moeyd0b3AnOiAwLCAncmlnaHQnOiAwfSlcclxuICAgICAgICAgICAgLmFkZENsYXNzKCdiZy1saWdodCBib3JkZXIgbXQtNSBteC1hdXRvIHBvc2l0aW9uLWFic29sdXRlIHB4LTMgZC1ibG9jaycpXHJcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnZC1ub25lJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlck5hdkxvZ2luQnRuKS5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgJGxvZ2luQm94LmFkZENsYXNzKCdkLWJsb2NrJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICRyZWdpc3RlckJveC5hZGRDbGFzcygnZC1ub25lJykucmVtb3ZlQ2xhc3MoJ2QtYmxvY2snKTtcclxuICAgIH0pO1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvaGVhZGVyL2hlYWRlci5qcyIsIi8vIGltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyJztcclxuLy8gaW1wb3J0IFNwaW5uZXIgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3NwaW5uZXInO1xyXG5pbXBvcnQgdmlld1V0aWxzIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy92aWV3JztcclxuXHJcbi8qXHJcbmNvbnN0IHN0YXRpY1Jlc3AgPSB7XHJcbiAgICAnc3RhdHVzJzoge1xyXG4gICAgICAgICdzdGF0ZSc6ICdvaydcclxuICAgIH0sXHJcbiAgICAnZGF0YSc6IHtcclxuICAgICAgICAnYWNjb3VudHMnOiBbe1xyXG4gICAgICAgICAgICAnc3RhdHVzJzogJ09LJyxcclxuICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ2FuZHJleS5qYWtpdmNoeWsnLFxyXG4gICAgICAgICAgICAnY2hlY2twb2ludCc6IHtcclxuICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnQUJTRU5UJyxcclxuICAgICAgICAgICAgICAgICd0eXBlJzogJ1BIT05FJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAndGFyaWZmJzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdpbmZvJzoge1xyXG4gICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdodHRwczovL3JhbmRvbXVzZXIubWUvYXBpL3BvcnRyYWl0cy9tZW4vNTAuanBnJyxcclxuICAgICAgICAgICAgICAgICduYW1lJzogJ9CQ0L3QtNGA0LXQuSDQr9C60LjQstGH0YPQuicsXHJcbiAgICAgICAgICAgICAgICAnYmlvZ3JhcGh5JzogJycsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogJycsXHJcbiAgICAgICAgICAgICAgICAnZW1haWwnOiAnbmlkenVrdUBpbmJveC5ydScsXHJcbiAgICAgICAgICAgICAgICAncGhvbmUnOiAnJyxcclxuICAgICAgICAgICAgICAgICdtZWRpYV9jb3VudCc6IDIsXHJcbiAgICAgICAgICAgICAgICAnZm9sbG93ZXJfY291bnQnOiA0LFxyXG4gICAgICAgICAgICAgICAgJ2ZvbGxvd2luZ19jb3VudCc6IDE1XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnT0snLFxyXG4gICAgICAgICAgICAndXNlcm5hbWUnOiAnYW5kcmV5Lmpha2l2Y2h5aycsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnRU1BSUwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2luZm8nOiB7XHJcbiAgICAgICAgICAgICAgICAncHJvZmlsZV9waWNfdXJsJzogJ2h0dHBzOi8vcmFuZG9tdXNlci5tZS9hcGkvcG9ydHJhaXRzL21lbi81Mi5qcGcnLFxyXG4gICAgICAgICAgICAgICAgJ25hbWUnOiAn0JTQuNC80L7QvSDQn9Cw0YDQsNC70L7QvScsXHJcbiAgICAgICAgICAgICAgICAnYmlvZ3JhcGh5JzogJ2Jpb2dyYXBoeSB0ZXh0JyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiAnd3d3LmxlbmVuZ3JhZC5ydScsXHJcbiAgICAgICAgICAgICAgICAnZW1haWwnOiAnbmlkenVrdUBpbmJveC5ydScsXHJcbiAgICAgICAgICAgICAgICAncGhvbmUnOiAnMDExLTExMS0xMTEtMTEnLFxyXG4gICAgICAgICAgICAgICAgJ21lZGlhX2NvdW50JzogNTE1LFxyXG4gICAgICAgICAgICAgICAgJ2ZvbGxvd2luZ19jb3VudCc6IDM0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnT0snLFxyXG4gICAgICAgICAgICAndXNlcm5hbWUnOiAnYWxleC5zbWl0aCcsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdUUklHR0VSRUQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnRU1BSUxfT1JfUEhPTkUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgICAgJ3N0YXR1cyc6ICdPSycsXHJcbiAgICAgICAgICAgICd1c2VybmFtZSc6ICcyMmFuZHJleS5qYWtpdmNoeWsyJyxcclxuICAgICAgICAgICAgJ2NoZWNrcG9pbnQnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ1RSSUdHRVJFRCcsXHJcbiAgICAgICAgICAgICAgICAndHlwZSc6ICdQSE9ORSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3RhcmlmZic6IHtcclxuICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnQUJTRU5UJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgJ2F2YWlsYWJsZV9wcm94eV9wdXJjaGFzZSc6IHRydWVcclxuICAgIH1cclxufTtcclxuKi8vKlxyXG5jb25zdCBzdGF0aWNSZXNwV2l0aERlbGF5ID0ge1xyXG4gICAgJ3N0YXR1cyc6IHtcclxuICAgICAgICAnc3RhdGUnOiAnb2snXHJcbiAgICB9LFxyXG4gICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgJ2FjY291bnRzJzogW3tcclxuICAgICAgICAgICAgJ3N0YXR1cyc6ICdPSycsXHJcbiAgICAgICAgICAgICd1c2VybmFtZSc6ICdzdGF0aWNSZXNwLldpdGhEZWxheScsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnUEhPTkUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dLFxyXG4gICAgICAgICdhdmFpbGFibGVfcHJveHlfcHVyY2hhc2UnOiB0cnVlXHJcbiAgICB9XHJcbn07XHJcbiovXHJcblxyXG4vLyDQn9C+0YHQu9C1INC00L7QsdCw0LLQu9C10L3QuNGPINCw0LrQutCw0YPQvdGC0LAg0YHQvdC+0LLQsCDQtNC10YDQvdGD0YLRjCDQnNCV0KLQkCDQuCDQv9C10YDQtdGA0LjRgdC+0LLQsNGC0Ywg0YHQv9C40YHQvtC6INCw0LrQutCw0YPQvdGC0L7QslxyXG5jb25zdCBhZGRJbnN0YWdyYW1BY2NvdW50ID0gKG5ld0Zvcm1EYXRhKSA9PiB7XHJcbiAgICBjb25zdCBjYkVycm9yID0gKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUicsIHJlc3VsdCk7XHJcbiAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkKCcuZXJyb3ItbXNnJyksXHJcbiAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnTG9naW4gZXJyb3InKTtcclxuICAgICAgICAvLyAkKF9sb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgfTtcclxuXHJcbiAgICBVc2VyLmFkZEluc3RhZ3JhbUFjY291bnQobmV3Rm9ybURhdGEsIGNiRXJyb3IpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQsIHJlc3VsdC5zdGF0dXMpO1xyXG4gICAgICAgICAgICAvLyBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgY29uc3QgJG1zZ0xpc3QgPSAkKCcuYWNjb3VudHMtbGlzdCcpO1xyXG4gICAgICAgICAgICAkbXNnTGlzdC5lbXB0eSgpO1xyXG4gICAgICAgICAgICAvLyB0b2RvIDogcmVsb2FkIGxpc3RcclxuICAgICAgICAgICAgLy8gZmlsbExpc3QoJG1zZ0xpc3QsIHJlc3VsdC5kYXRhLmFjY291bnRzKTtcclxuICAgICAgICAgICAgLy8gYWRkTGlzdEhhbmRsZXIoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIC8vICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAvLyAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBlcnJvcicpO1xyXG4gICAgICAgICAgICAvLyAkKF9sb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgICAgIH1cclxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAvLyB0b2RvOiByZW5kZXIgZm9yIHVzZXJcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ3N1Ym1pdCcsIG5ld0Zvcm1EYXRhKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGFkZE9uTG9hZEhhbmRsZXJzKCkge1xyXG4gICAgLy8gJCgnLmpzX3JlcGVhdC1zZWN1cml0eS1jb2RlJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICAkKCcuanNfYWRkLWluc3RhZ3JhbS1hY2NvdW50Jykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBjb25zdCBidG4gPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICBjb25zdCAkbW9kYWxCb2R5ID0gYnRuLmNsb3Nlc3QoJy5tb2RhbCcpLmZpbmQoJy5tb2RhbC1kaWFsb2cgLm1vZGFsLWJvZHknKTtcclxuICAgICAgICBjb25zdCB1c2VybmFtZSA9ICRtb2RhbEJvZHkuZmluZCgnaW5wdXRbbmFtZT1cInVzZXJuYW1lXCJdJykudmFsKCkudHJpbSgpO1xyXG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gJG1vZGFsQm9keS5maW5kKCdpbnB1dFtuYW1lPVwicGFzc1wiXScpLnZhbCgpLnRyaW0oKTtcclxuICAgICAgICBjb25zdCAkZm9ybSA9ICQoJ2Zvcm0nLCAkbW9kYWxCb2R5KTtcclxuICAgICAgICBjb25zdCBmb3JtID0gJGZvcm0uZ2V0KDApO1xyXG4gICAgICAgIGNvbnN0IGNzc1ZhbGlkYXRpb25DbGFzcyA9ICdmb3JtLXZhbGlkYXRpb24nO1xyXG5cclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoJGZvcm0pO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbGlkYXRvci52YWxpZGF0ZSgpKTtcclxuICAgICAgICBpZiAoZm9ybS5jaGVja1ZhbGlkaXR5KCkpIHtcclxuICAgICAgICAgICAgYWRkSW5zdGFncmFtQWNjb3VudCh7dXNlcm5hbWUsIHBhc3N3b3JkfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gSGlnaGxpZ2h0IGVycm9yc1xyXG4gICAgICAgICAgICBpZiAoZm9ybS5yZXBvcnRWYWxpZGl0eSkge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5yZXBvcnRWYWxpZGl0eSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbm90IHZhbGlkIC0gRW1wdHkgZmllbGRzJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkTGlzdEhhbmRsZXIoLyogdXNlcm5hbWUqLykge1xyXG4gICAgLy8gJCgnI3lvdXJNb2RhbElEJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAvLyAgICAgdmFyIHlvdXJwYXJhbWV0ZXIgPSBlLnJlbGF0ZWRUYXJnZXQuZGF0YXNldC55b3VycGFyYW1ldGVyO1xyXG4gICAgLy8gICAgIC8vIERvIHNvbWUgc3R1ZmYgdy8gaXQuXHJcbiAgICAvLyB9KTtcclxuICAgIGxldCBjaGVja3BvaW50VHlwZSA9ICcnO1xyXG5cclxuICAgICQoJy5qc19wYXNzLWNoZWNrcG9pbnQtYnRuJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBjb25zdCAkYnV0dG9uID0gJChlLnRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSAkYnV0dG9uLmRhdGEoJ3VzZXJuYW1lJyk7XHJcbiAgICAgICAgY2hlY2twb2ludFR5cGUgPSAkYnV0dG9uLmRhdGEoJ2NoZWNrcG9pbnRUeXBlJykgfHwgY2hlY2twb2ludFR5cGU7XHJcbiAgICAgICAgLy8gJCgnI3NlY3VyaXR5LWNvZGUnKS5kYXRhKCdjaGVja3BvaW50VHlwZScsIGNoZWNrcG9pbnRUeXBlKTtcclxuICAgICAgICAvLyB0b2RvIGFkZCAnY2hlY2twb2ludFR5cGUnIHRvIG1vZGFsXHJcbiAgICAgICAgY29uc3Qgc2VuZFRvID0gKGNoZWNrcG9pbnRUeXBlID09PSAnUEhPTkUnKSA/ICfRgtC10LvQtdGE0L7QvScgOiAnZW1haWwnO1xyXG4gICAgICAgIC8vIFNwaW5uZXIuc3RhcnQoJGJ1dHRvbiwgJ2ZhLWtleScpO1xyXG5cclxuICAgICAgICBpZiAoY2hlY2twb2ludFR5cGUgPT09ICdFTUFJTF9PUl9QSE9ORScpIHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vINC40L3Qv9GD0YLRiyDRgdC/0YDRj9GC0LDQvdGLLFxyXG4gICAgICAgICAgICAvLyDQv9C+0LrQsNC30LDRgtGMINGB0LXRgNGL0LUg0L/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70LggKNCy0YvQsdGA0LDQuyDRgtC40L8pXHJcbiAgICAgICAgICAgIC8vINC10YHRgtGMINC60L3QvtC/0LrQsCDQl9Cw0L/RgNC+0YHQuNGC0Ywg0LrQvtC0INC/0L7QtNGC0LLQtdGA0LbQtNC10L3QuNC1XHJcbiAgICAgICAgICAgICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpLm1vZGFsKHtzaG93OiB0cnVlLCB1c2VybmFtZX0pO1xyXG5cclxuICAgICAgICAgICAgLy8g0L3QtSDQvtGC0L/RgNCw0LLQu9GP0LXQvCDRgNC10LrQstC10YHRglxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBVc2VyLmdldFNlY3VyaXR5S2V5KHVzZXJuYW1lLCBjaGVja3BvaW50VHlwZSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZWN1cml0eUtleSByZWNlaXZlZDonLCByZXN1bHQuc3RhdHVzLnN0YXRlKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMuc3RhdGUgPT09ICdvaycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoJyNzZWN1cml0eS1jb2RlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU3Bpbm5lci5zdG9wKCRidXR0b24sICdmYS1rZXknKTtcclxuICAgICAgICAgICAgICAgICQoJy5qc19zdWNjZXNzLWZlZWRiYWNrJywgJG1vZGFsKS5lbXB0eSgpLnRleHQoYNCa0LvRjtGHINC/0L7QtNGC0LLQtdGA0LbQtNC10L3QuNGPINCx0YvQuyDQvtGC0L/RgNCw0LLQu9C10L0g0JLQsNC8INC90LAgJHtzZW5kVG99YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGluc2lkZSBtb2RhbFxyXG4gICAgJCgnLmpzX2NvbmZpcm0tc2VjdXJpdHktY29kZScpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYnRuID0gJChlLnRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBidG4uZGF0YSgndXNlcm5hbWUnKTtcclxuICAgICAgICBjb25zdCAka2V5SW5wdXQgPSBidG4uY2xvc2VzdCgnLm1vZGFsJykuZmluZCgnLm1vZGFsLWRpYWxvZyBmb3JtIGlucHV0LmpzX2NvbmZpcm0ta2V5Jyk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gJGtleUlucHV0LnZhbCgpLnRyaW0oKTtcclxuICAgICAgICBjb25zdCAkbW9kYWwgPSBidG4uY2xvc2VzdCgnLm1vZGFsJyk7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgaWYgKGtleS5sZW5ndGggIT09IDYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBVc2VyLmNvbmZpcm1TZWN1cml0eUtleShrZXksIHVzZXJuYW1lKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMuc3RhdGUgIT09ICdvaycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnanNfY29uZmlybTonLCByZXN1bHQuc3RhdHVzLnN0YXRlLCAnY2xvc2UgbW9kYWwnKTtcclxuICAgICAgICAgICAgJG1vZGFsLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyJyk7XHJcbiAgICAgICAgICAgICQoJy5qc19zdWNjZXNzLWZlZWRiYWNrJywgJG1vZGFsKS50ZXh0KCfQl9Cw0L/RgNC+0YEg0L3QtSDQvtGC0L/RgNCw0LLQu9C10L0nKS5jc3MoJ2NvbG9yJywgJ3JlZCcpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnZm9ybSBpbnB1dFttaW5sZW5ndGhdJykub24oJ2JsdXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgbGVuID0gJCh0aGlzKS52YWwoKS50cmltKCkubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IG1pbkxlbiA9IE51bWJlcigkKHRoaXMpLmF0dHIoJ21pbmxlbmd0aCcpKTtcclxuICAgICAgICAvLyBjb25zdCBtZXNzYWdlID0gbWluTGVuIDw9IGxlbiA/ICcnIDogbWluTGVuICsgJyBjaGFyYWN0ZXJzIG1pbmltdW0nO1xyXG4gICAgICAgIGlmIChtaW5MZW4gIT09IGxlbikge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmNzcygnYm9yZGVyQ29sb3InLCAncmVkJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2JvcmRlckNvbG9yJywgJyNjZWQ0ZGEnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5zZXRDdXN0b21WYWxpZGl0eShtZXNzYWdlKVxyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gb25IaWRlTW9kYWwoZSkge1xyXG4gICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoZS50YXJnZXQpO1xyXG4gICAgICAgICRtb2RhbC5maW5kKCcuZmlyc3Qtc3RlcCcpLnJlbW92ZUNsYXNzKCdkLW5vbmUnKTtcclxuICAgICAgICAkbW9kYWwuZmluZCgnLnNlY29uZC1zdGVwJykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICQoJy5qc19jb25maXJtLWtleScpLnZhbCgnJyk7XHJcbiAgICAgICAgJCgnLmpzX3N1Y2Nlc3MtZmVlZGJhY2snLCAkbW9kYWwpLnJlbW92ZUF0dHIoJ3N0eWxlJykuZW1wdHkoKTtcclxuICAgIH1cclxuICAgICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpLm9uKCdoaWRlLmJzLm1vZGFsJywgb25IaWRlTW9kYWwpO1xyXG4gICAgJCgnI3NlY3VyaXR5LWNvZGUnKS5vbignaGlkZS5icy5tb2RhbCcsIG9uSGlkZU1vZGFsKTtcclxuXHJcbiAgICAvLyBcIlBIT05FX09SX0VNQUlMXCIgbW9kYWxcclxuICAgICQoJy5qc19nZXQtc2VjdXJpdHktY29kZS1waG9uZU9yZW1haWwnKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpO1xyXG4gICAgICAgIGNvbnN0IHR5cGVTZWxlY3RlZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJG1vZGFsKS5maW5kKCcuanNfYnRuLXR5cGUtc3dpdGNoZXIgaW5wdXQ6Y2hlY2tlZCcpO1xyXG4gICAgICAgIGNvbnN0IGNoZWNrcG9pbnRUeXBlQWN0aXZlID0gdHlwZVNlbGVjdGVkLnZhbCgpO1xyXG4gICAgICAgIGNvbnN0IHNlbmRUbyA9IChjaGVja3BvaW50VHlwZUFjdGl2ZSA9PT0gJ1BIT05FJykgPyAn0YLQtdC70LXRhNC+0L0nIDogJ2VtYWlsJztcclxuICAgICAgICBjb25zdCBtb2RhbENvbmZpZyA9ICRtb2RhbC5kYXRhKClbJ2JzLm1vZGFsJ10uX2NvbmZpZztcclxuICAgICAgICBjb25zdCB1c2VybmFtZSA9IG1vZGFsQ29uZmlnLnVzZXJuYW1lO1xyXG4gICAgICAgIFVzZXIuZ2V0U2VjdXJpdHlLZXkodXNlcm5hbWUsIGNoZWNrcG9pbnRUeXBlQWN0aXZlKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgLy8g0L/RgNC4INC90LDQttCw0YLQuNC4IFwi0JfQsNC/0YDQvtGB0LjRgtGMINC60L7QtCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjQtVwiIC0g0L7RgtC/0LDRgNC70Y/QtdGC0YHRjyDRgNC10LrQstC10YHRgiBcItGB0YLQsNGA0YIg0YfQtdC60L/QvtC40L3RglwiINC/0L7Rj9Cy0LvRj9C10YLRjNGB0Y8g0LjQvdC/0YPRgiDQuCDQutC90L7Qv9C60LAg0LTRgNGD0LPQuNGFINGC0LjQv9Cw0YVcclxuICAgICAgICAgICAgLy8gZ2V0IHNlbGVjdGVkIGJ1dHRvblxyXG5cclxuICAgICAgICAgICAgLy8g0L/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70Ywo0YHQtdGA0YvQuSkg0Lgg0LrQvdC+0L/QutCwIFwi0JfQsNC/0YDQvtGB0LjRgtGMINC60L7QtCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjQtVwiINC40YHRh9C10LfQsNGO0YJcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlY3VyaXR5S2V5IHJlY2VpdmVkOicsIHJlc3VsdC5zdGF0dXMuc3RhdGUpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cy5zdGF0ZSA9PT0gJ29rJykge1xyXG4gICAgICAgICAgICAgICAgJCgnLmZpcnN0LXN0ZXAnLCAkbW9kYWwpLmFkZENsYXNzKCdkLW5vbmUnKTtcclxuICAgICAgICAgICAgICAgICQoJy5zZWNvbmQtc3RlcCcsICRtb2RhbCkucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmpzX3N1Y2Nlc3MtZmVlZGJhY2snLCAkbW9kYWwpLmVtcHR5KCkudGV4dChg0JrQu9GO0Ycg0L/QvtC00YLQstC10YDQttC00LXQvdC40Y8g0LHRi9C7INC+0YLQv9GA0LDQstC70LXQvSDQktCw0Lwg0L3QsCAke3NlbmRUb31gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbGxMaXN0KCRsaXN0LCBkYXRhQXJyYXkpIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gZGF0YUFycmF5O1xyXG4gICAgY29uc3QgY0xpc3QgPSAkbGlzdDtcclxuICAgIGNvbnN0IGRlZmF1bHRBdmF0YXJTcmMgPSAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9qTk5UNExFLnBuZyc7XHJcbiAgICBjb25zdCBpbnNlcnRJdGVtID0gKGRhdGEsIHRleHQsIGNzc0NscykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpVHBsID0gYCR7KGRhdGEpXHJcbiAgICAgICAgICAgID8gYDxsaSBjbGFzcz1cImxpc3QtaW5saW5lLWl0ZW0gJHtjc3NDbHN9XCI+PHNwYW4gY2xhc3M9XCJmaWd1cmVcIj4ke2RhdGF9PC9zcGFuPjxzcGFuPiR7dGV4dH08L3NwYW4+PC9saT5gXHJcbiAgICAgICAgICAgIDogYDxsaSBjbGFzcz1cImxpc3QtaW5saW5lLWl0ZW0gJHtjc3NDbHN9XCI+PHNwYW4gY2xhc3M9XCJmaWd1cmVcIj4tPC9zcGFuPjxzcGFuPiR7dGV4dH08L3NwYW4+PC9saT5gfWA7XHJcbiAgICAgICAgcmV0dXJuIGxpVHBsO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHN0YXRzID0gKGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB0cGwgPSBgPGRpdiBjbGFzcz1cImNvbFwiPlxyXG4gICAgICAgICAgICA8dWwgY2xhc3M9XCJsaXN0LWlubGluZSB0ZXh0LWNlbnRlciBjb3VudHMtbGlzdFwiPlxyXG4gICAgICAgICAgICAkeyhpbmZvKVxyXG4gICAgICAgICAgICAgID8gYCR7aW5zZXJ0SXRlbShpbmZvWydtZWRpYV9jb3VudCddLCAn0J/Rg9Cx0LvQuNC60LDRhtC40LgnLCAnbWVkaWEtY291bnQnKX1cclxuICAgICAgICAgICAgICAgICR7aW5zZXJ0SXRlbShpbmZvWydmb2xsb3dlcl9jb3VudCddLCAn0J/QvtC00L/QuNGB0YfQuNC60LgnLCAnZm9sbG93ZXItY291bnQnKX1cclxuICAgICAgICAgICAgICAgICR7aW5zZXJ0SXRlbShpbmZvWydmb2xsb3dpbmdfY291bnQnXSwgJ9Cf0L7QtNC/0LjRgdC60LgnLCAnZm9sbG93aW5nLWNvdW50Jyl9YFxyXG4gICAgICAgICAgICAgIDogYCR7aW5zZXJ0SXRlbShmYWxzZSwgJ9Cf0YPQsdC70LjQutCw0YbQuNC4JywgJ21lZGlhLWNvdW50Jyl9XHJcbiAgICAgICAgICAgICAgICAke2luc2VydEl0ZW0oZmFsc2UsICfQn9C+0LTQv9C40YHRh9C40LrQuCcsICdmb2xsb3dlci1jb3VudCcpfVxyXG4gICAgICAgICAgICAgICAgJHtpbnNlcnRJdGVtKGZhbHNlLCAn0J/QvtC00L/QuNGB0LrQuCcsICdmb2xsb3dpbmctY291bnQnKX1gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgPC91bD5cclxuICAgICAgICA8L2Rpdj5gO1xyXG4gICAgICAgIHJldHVybiB0cGw7XHJcbiAgICB9O1xyXG4gICAgY0xpc3QuZW1wdHkoKS5hZGRDbGFzcygnYm9yZGVyLWxpZ2h0LWNvbG9yJyk7XHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5mbyA9IGl0ZW0uaW5mbztcclxuICAgICAgICBjb25zdCBjaGVja3BvaW50ID0gaXRlbS5jaGVja3BvaW50IHx8IGl0ZW07XHJcblxyXG4gICAgICAgIGlmICghaW5mbykge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYSBweS0zXCI+XHJcbiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwibWwtMyByb3VuZGVkXCIgYWx0PVwiZGVmYXVsdCBhdmF0YXJcIiBzcmM9XCIke2RlZmF1bHRBdmF0YXJTcmN9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVkaWEtYm9keSBkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHVzZXItaW5mb1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkeyhpdGVtLnVzZXJuYW1lKSA/IGA8aDQgY2xhc3M9XCJtdC0wIG1iLTEgbmFtZVwiPiR7aXRlbS51c2VybmFtZX08L2g0PmAgOiAnJ31cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sXCI+ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7KGNoZWNrcG9pbnQuc3RhdHVzID09PSAnVFJJR0dFUkVEJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkganNfcGFzcy1jaGVja3BvaW50LWJ0biBkLWJsb2NrIG14LWF1dG9cIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtY2hlY2twb2ludC10eXBlPVwiJHtjaGVja3BvaW50LnR5cGV9XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdXNlcm5hbWU9XCIke2l0ZW0udXNlcm5hbWUgfHwgJyd9XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdG9nZ2xlPVwibW9kYWxcIiBkYXRhLXRhcmdldD1cIiNzZWN1cml0eS1jb2RlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1rZXlcIj48L2k+0J/RgNC+0LnRgtC4INGH0LXQutC/0L7QuNC90YI8L2J1dHRvbj5gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYCh0b2RvKWNoZWNrcG9pbnQgc3RhdHVzIC0gJHtjaGVja3BvaW50LnN0YXR1c31gfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICR7c3RhdHMoKX1cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2xpPmApLmFwcGVuZFRvKGNMaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYSBweS0zXCI+XHJcbiAgICAgICAgICAgICR7KGluZm9bJ3Byb2ZpbGVfcGljX3VybCddKVxyXG4gICAgICAgICAgICAgICAgPyBgPGltZyBjbGFzcz1cIm1sLTMgcm91bmRlZFwiIGFsdD1cIlVzZXIgcGhvdG9cIiBzcmM9XCIke2luZm9bJ3Byb2ZpbGVfcGljX3VybCddfVwiPmBcclxuICAgICAgICAgICAgICAgIDogYDxpbWcgY2xhc3M9XCJtbC0zIHJvdW5kZWRcIiBhbHQ9XCJkZWZhdWx0IGF2YXRhclwiIHNyYz1cIiR7ZGVmYXVsdEF2YXRhclNyY31cIj5gfVxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVkaWEtYm9keSBkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgdXNlci1pbmZvXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgJHsoaXRlbS51c2VybmFtZSkgPyBgPHAgY2xhc3M9XCJtdC0wIG1iLTEgbmFtZVwiPiR7aXRlbS51c2VybmFtZX08L3A+YCA6ICcnfVxyXG4gICAgICAgICAgICAgICAgICAgICR7KGluZm8ubmFtZSkgPyBgPGg0IGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLm5hbWV9PC9oND5gIDogJyd9XHJcbiAgICAgICAgICAgICAgICAgICAgJHsoaW5mby5uYW1lKSA/ICcnIDogJ2NvbW1lbnRlZCcgIC8qICR7KGluZm8uZW1haWwpID8gYDxwIGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLmVtYWlsfTwvcD5gIDogJyd9XHJcbiAgICAgICAgICAgICAgICAgICAgICR7KGluZm8ucGhvbmUpID8gYDxwIGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLnBob25lfTwvcD5gIDogJyd9ICovIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbFwiPiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICR7KGNoZWNrcG9pbnQuc3RhdHVzID09PSAnVFJJR0dFUkVEJylcclxuICAgICAgICAgICAgICAgID8gYDxidXR0b24gY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGpzX3Bhc3MtY2hlY2twb2ludC1idG4gZC1ibG9jayBteC1hdXRvXCIgZGF0YS1jaGVja3BvaW50LXR5cGU9XCIke2NoZWNrcG9pbnQudHlwZX1cIiBkYXRhLXRvZ2dsZT1cIm1vZGFsXCIgZGF0YS10YXJnZXQ9XCIjc2VjdXJpdHktY29kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWtleVwiPjwvaT7Qn9GA0L7QudGC0Lgg0YfQtdC60L/QvtC40L3RgjwvYnV0dG9uPmBcclxuICAgICAgICAgICAgICAgIDogJyd9XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICR7c3RhdHMoaW5mbyl9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvbGk+YCkuYXBwZW5kVG8oY0xpc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoZWFkZXJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgY29uc3QgJG1zZ0xpc3QgPSAkKCcuYWNjb3VudHMtbGlzdCcpO1xyXG4gICAgLy8gY2hlY2sgd2UgYXJlIGluIHByb2ZpbGUgcGFnZVxyXG4gICAgaWYgKCEkbXNnTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlbiA9IFVzZXIuZ2V0VG9rZW4oKTsgLy8gdXBkIHRvOiBVc2VyLmdldFRva2VuKClcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gVXNlci5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICBjb25zdCByZXNlbmRSZXF1ZXN0ID0gKCkgPT4gVXNlci5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICBsZXQgaXNTZW5kUmVxT25jZSA9IGZhbHNlO1xyXG4gICAgY29uc3QgY2hlY2tSZXNwb25zZSA9IChyZXN1bHQsIGlzUmVzZW5kUmVxdWVzdCkgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdWx0LnN0YXR1cy5zdGF0ZSA9PT0gJ29rJyB8fCAhcmVzdWx0LmRhdGEgfHwgISRtc2dMaXN0Lmxlbmd0aCB8fCBpc1Jlc2VuZFJlcXVlc3QpIHtcclxuICAgICAgICAgICAgLy8g0L/RgNC+0LLQtdGA0Y/QvCDQvtC00LjQvSDRgNCw0Lcg0L3QsNC70LjRh9C40LUgcmVzdWx0LmRhdGEuYWNjb3VudHMuaW5mb1xyXG4gICAgICAgICAgICAkbXNnTGlzdC5lbXB0eSgpO1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lZGlhLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3M9XCJtdC0wIG1iLTNcIj7QndC4INC+0LTQvdC+0LPQviDQkNC60LrQsNGD0L3RgtCwINC90LUg0LTQvtCx0LDQstC70LXQvdC+PC9oMz5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2xpPmApLmFwcGVuZFRvKCRtc2dMaXN0KTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNlbmRSZXF1ZXN0KCkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tSZXNwb25zZShyZXN1bHQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcXVlc3QgcmVzZW5kJyk7XHJcbiAgICAgICAgICAgIH0sIDM1MDApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vINCy0YvQstC+0LQg0YDQtdC30YPQu9GM0YLQsNGC0L7QsiAoZGF0YS5hY2NvdW50cy5pbmZvKVxyXG4gICAgICAgICQoJy5wcm9maWxlLXVzZXIgLnNwaW5uZXItYm94JykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgIGZpbGxMaXN0KCRtc2dMaXN0LCByZXN1bHQuZGF0YS5hY2NvdW50cyk7XHJcbiAgICAgICAgYWRkTGlzdEhhbmRsZXIoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gY2hlY2sgd2UgYXJlIGluIHByb2ZpbGUgcGFnZVxyXG4gICAgaWYgKCEkbXNnTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYWRkT25Mb2FkSGFuZGxlcnMoKTtcclxuXHJcbiAgICAvLyDQvNC+0LbQtdGCINC40L3RhNC+INC+0YLRgdGD0YLRgdCy0L7QstCw0YLRjCAtINGB0LTQtdC70LDRgtGMINC10YnQtSDRgNCw0Lcg0LfQsNC/0YDQvtGBINGH0LXRgNC10LcgMyDRgdC10LouXHJcblxyXG4gICAgbWV0YWRhdGEudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgLy8g0L/RgNC+0LLQtdGA0Y/QvCDQvtC00LjQvSDRgNCw0Lcg0L3QsNC70LjRh9C40LUgcmVzdWx0LmRhdGEuYWNjb3VudHMuaW5mb1xyXG4gICAgICAgIGxldCBpc1Jlc2VuZFJlcXVlc3QgPSBmYWxzZTtcclxuICAgICAgICBpZiAocmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEuYWNjb3VudHMgJiYgIWlzU2VuZFJlcU9uY2UpIHtcclxuICAgICAgICAgICAgcmVzdWx0LmRhdGEuYWNjb3VudHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICBpc1Jlc2VuZFJlcXVlc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlzU2VuZFJlcU9uY2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoZWNrUmVzcG9uc2UocmVzdWx0LCBpc1Jlc2VuZFJlcXVlc3QpO1xyXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCQoJy5lcnJvci1tc2cnKSxcclxuICAgICAgICAgICAgICAgIGVyci5zdGF0dXMgfHwgJycsXHJcbiAgICAgICAgICAgICAgICAn0J3QtSDQv9C+0LvRg9GH0LjQu9C+0YHRjCDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LTQvtGB0YLRg9C/0L3Ri9C1IEluc3RhZ3JhbSDQsNC60LrQsNGD0L3RgtGLJyk7XHJcbiAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgJCgnLnNwaW5uZXItYm94JykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgfSk7XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC5qcyIsIi8qIGVzbGludC1kaXNhYmxlIHNvcnQtdmFycyAqL1xyXG4vLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBQdWJTdWIgZnJvbSAncHVic3ViLWpzJzsgLy8gaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVic3ViLWpzXHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG4vLyBpbXBvcnQgVmFsaWRhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9mb3JtLXZhbGlkYXRvcic7XHJcbmltcG9ydCB2aWV3VXRpbHMgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3ZpZXcnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29uc3RzJztcclxuXHJcbi8vIHdpbmRvdy4kID0gJDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBMb2dpbkZvcm0oc2VsZWN0b3JDc3MpIHtcclxuICAgIGNvbnN0IHtfZm9ybUlkLCBfYnV0dG9uU3VibWl0SWQsIF9zaG93TG9naW5Cb3hCdG5JZCwgX2xvZ2luQm94fSA9IHNlbGVjdG9yQ3NzO1xyXG4gICAgY29uc3QgdXNlciA9IFVzZXIsIC8vIHNlcnZpY2VcclxuICAgICAgICAkZm9ybSA9ICQoX2Zvcm1JZCksXHJcbiAgICAgICAgJGVtYWlsID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIm1haWxcIl0nKSxcclxuICAgICAgICAkdGV4dEFyZWFEZXNjcmlwdGlvbiA9ICQoJyNkZXNjcmlwdGlvbicpO1xyXG4gICAgLy8gY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAvLyBjb25zdCBjbG9zZUNsYXNzID0gJ2Qtbm9uZSc7XHJcblxyXG4gICAgY29uc3QgdXNlckxvZ2luSGVhZGVyID0gKF9mb3JtRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNiRXJyb3IgPSAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICQoX2xvZ2luQm94KS5hcHBlbmQoJzxwPnJlc3VsdC5zdGF0dXMubWVzc2FnZTwvcD4nKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gdXNlci5sb2dpbihfZm9ybURhdGEsIGNiRXJyb3IpXHJcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEudG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgY29va2llU3RvcmFnZS5zZXQoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbiwgcmVzdWx0LmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5uYXYtbGluay5qc19sb2dPdXQnKS5wYXJlbnQoKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3JlcXVlc3Qgc3VjY2VlZGVkIHdpdGggSlNPTiByZXNwb25zZScsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBzdWNjc2VzcycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGA8cD5zdGF0dXM6ICR7cmVzdWx0LnN0YXR1cy5zdGF0ZX08L3A+PHA+IG1lc3NhZ2U6ICR7cmVzdWx0LnN0YXR1cy5tZXNzYWdlfTwvcD5gKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnTG9naW4gZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHN1Ym1pdEZvcm0gPSBmdW5jdGlvbihmb3JtRGF0YU9iaikge1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gJGVtYWlsLnZhbCgpLFxyXG4gICAgICAgICAgICBwYXNzd29yZCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzXCJdJykudmFsKCksXHJcbiAgICAgICAgICAgIF9mb3JtRGF0YSA9IGZvcm1EYXRhT2JqIHx8IHtlbWFpbCwgcGFzc3dvcmR9O1xyXG5cclxuICAgICAgICBpZiAoc2VsZWN0b3JDc3MuaXNMb2dpbkluc3RhZ3JhbSkge1xyXG4gICAgICAgICAgICAvLyB0b2RvOiBkZWxldGUgbWVcclxuICAgICAgICAgICAgLy8gYWRkSW5zdGFncmFtQWNjb3VudCh7dXNlcm5hbWU6ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJ1c2VybmFtZVwiXScpLnZhbCgpLCBwYXNzd29yZH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICRlbWFpbC52YWwoJGVtYWlsLnZhbCgpLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICB1c2VyTG9naW5IZWFkZXIoX2Zvcm1EYXRhKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIFB1YlN1Yi5wdWJsaXNoKENPTlNULmV2ZW50cy5VU0VSX0xPR0dFRCwgJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbG9nT3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29va2llU3RvcmFnZS5yZW1vdmUoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbik7XHJcbiAgICAgICAgUHViU3ViLnB1Ymxpc2goQ09OU1QuZXZlbnRzLlVTRVJfTE9HT1VUKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0ICRzaG93TG9naW5Cb3hCdG5JZCA9ICQoX3Nob3dMb2dpbkJveEJ0bklkKTtcclxuICAgICAgICBjb25zdCAkbG9naW5Cb3ggPSAkKF9sb2dpbkJveCk7XHJcbiAgICAgICAgY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAgICAgY29uc3QgY2xvc2VDbGFzcyA9ICdkLW5vbmUnO1xyXG5cclxuICAgICAgICAkc2hvd0xvZ2luQm94QnRuSWQub24oJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXNlbGVjdG9yQ3NzLmlzTG9naW5JbnN0YWdyYW0pIHtcclxuICAgICAgICAgICAgICAgICRsb2dpbkJveC5jc3Moeyd0b3AnOiAwLCAncmlnaHQnOiAwfSlcclxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2JnLWxpZ2h0IGJvcmRlciBtdC01IG14LWF1dG8gcG9zaXRpb24tYWJzb2x1dGUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkbG9naW5Cb3guYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCAkYnV0dG9uU3VibWl0ID0gJChfYnV0dG9uU3VibWl0SWQpLFxyXG4gICAgICAgICAgICBjc3NWYWxpZGF0aW9uQ2xhc3MgPSAnZm9ybS12YWxpZGF0aW9uJztcclxuXHJcbiAgICAgICAgJGJ1dHRvblN1Ym1pdC5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm0gPSAkZm9ybS5nZXQoMCk7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoJGZvcm0pO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWxpZGF0b3IudmFsaWRhdGUoKSk7XHJcbiAgICAgICAgICAgIGlmIChmb3JtLmNoZWNrVmFsaWRpdHkoKSAmJiB2aWV3VXRpbHMuaXNFbWFpbCgkZW1haWwudmFsKCkpKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaWdobGlnaHQgZXJyb3JzXHJcbiAgICAgICAgICAgICAgICBpZiAoZm9ybS5yZXBvcnRWYWxpZGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0ucmVwb3J0VmFsaWRpdHkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICQoZS50YXJnZXQpLnBhcmVudCgpLmhpZGUoKTtcclxuICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbiwgJ0xvZ2dlZCBvdXQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHViU3ViLnN1YnNjcmliZShDT05TVC5ldmVudHMuVVNFUl9MT0dPVVQsIChtc2cpID0+IHtcclxuICAgICAgICAgICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJOYXZMb2dpbkJ0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpOyAvLyAuc2hvdygpO1xyXG4gICAgICAgICAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlclJlZ0J0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgICAgICAkKCcubmF2LWxpbmsuanNfbG9nT3V0JykuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpOyAvLyAuaGlkZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvckxvZ2luU3RhdGUgPSAnLmpzX21lc3NhZ2VfbG9nZ2VkLS10ZXh0JztcclxuICAgICAgICAgICAgJChzZWxlY3RvckxvZ2luU3RhdGUpLnRleHQoJ9CS0Ysg0LLRi9GI0LvQuCDQuNC3INCw0LrQutCw0YPQvdGC0LAnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzTG9naW5CdG5DbGljayA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCduYXYubmF2YmFyJykuZmluZCgkbG9naW5Cb3gpLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgaXNBZGRJbnN0YWdyYW1CdG5DbGlja2VkID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09IENPTlNULnVpU2VsZWN0b3JzLmluc3RhZ3JhbS5hZGRBY2NvdW50QnRuSWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzTG9naW5CdG5DbGljayAmJiAkbG9naW5Cb3guaGFzQ2xhc3Mob3BlbmVkQ2xhc3MpICYmICFpc0FkZEluc3RhZ3JhbUJ0bkNsaWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICRsb2dpbkJveC5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICBiaW5kRXZlbnRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0XHJcbiAgICB9O1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvbG9naW4tZm9ybS9sb2dpbi1mb3JtLmpzIiwiY29uc3QgY29udmVyc2F0aW9uID0ge1xyXG4gICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgJ21ldGEnOiB7XHJcbiAgICAgICAgICAgICdwYWdpbmF0aW9uJzoge1xyXG4gICAgICAgICAgICAgICAgJ3ByZXZfY3Vyc29yJzogJy4uLicsXHJcbiAgICAgICAgICAgICAgICAnbmV4dF9jdXJzb3InOiAnLi4uJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnbWVzc2FnZXMnOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ05pa2EnLFxyXG4gICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnaHR0cHM6Ly9pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0L3ZwL2M5ZDNhZGQ0YjM0NzQ4ZTEyYTQyMjkzNTBmYjYxMWU0LzVDQzY2N0I4L3Q1MS4yODg1LTE5L3MxNTB4MTUwLzQxNzEwNTI3XzMxOTAwNDc4ODY1NTA4Ml8xNjUxNTE1NzA2NzE5NjAwNjQwX24uanBnP19uY19odD1pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0JyxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZSc6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdwaG90bycsIC8vIHBob3RvLCB2aWRlbywgZ2lmLCBsaWtlLCBsaW5rXHJcbiAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogJ2h0dHA6Ly93d3cuenIucnUvZC9zdG9yeS9hZC85MTM1ODEvMC0wLmpwZycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxNDozMydcclxuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAn0JnQvtGDKHJpZ2h0KScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxNDozMidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ05pa2EnLFxyXG4gICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnaHR0cHM6Ly9pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0L3ZwL2M5ZDNhZGQ0YjM0NzQ4ZTEyYTQyMjkzNTBmYjYxMWU0LzVDQzY2N0I4L3Q1MS4yODg1LTE5L3MxNTB4MTUwLzQxNzEwNTI3XzMxOTAwNDc4ODY1NTA4Ml8xNjUxNTE1NzA2NzE5NjAwNjQwX24uanBnP19uY19odD1pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0JyxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZSc6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JywgLy8gcGhvdG8sIHZpZGVvLCBnaWYsIGxpa2UsIGxpbmtcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAn0JfQsNGF0L7QtNC4INGB0Y7QtNCwOiBnb29nbGUuY29tJyxcclxuICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogJzE0OjM0J1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAnTmlrYScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdodHRwczovL2luc3RhZ3JhbS5maGVsMi0xLmZuYS5mYmNkbi5uZXQvdnAvYzlkM2FkZDRiMzQ3NDhlMTJhNDIyOTM1MGZiNjExZTQvNUNDNjY3QjgvdDUxLjI4ODUtMTkvczE1MHgxNTAvNDE3MTA1MjdfMzE5MDA0Nzg4NjU1MDgyXzE2NTE1MTU3MDY3MTk2MDA2NDBfbi5qcGc/X25jX2h0PWluc3RhZ3JhbS5maGVsMi0xLmZuYS5mYmNkbi5uZXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2xpbmsnLCAvLyBwaG90bywgdmlkZW8sIGdpZiwgbGlrZSwgbGlua1xyXG4gICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6ICdodHRwOi8vd3d3LnpyLnJ1L2Qvc3RvcnkvYWQvOTEzNTgxLzAtMC5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0aW1lc3RhbXAnOiAnMTQ6MzMnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdwaG90bycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogJ2h0dHBzOi8vcy5hdXRvLmRyb20ucnUvaTI0MjI0L3B1YnMvNC82MzA2MC9nZW4zNDBfMjg4MDYzNi5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0aW1lc3RhbXAnOiAnMTk6MzgnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAnZGVtb3MgLT4gZmluZXVwbG9hZGVyLmNvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxOTozOCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3NpZGUnOiAncmlnaHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2xpbmsnLFxyXG4gICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6ICdodHRwczovL2ZpbmV1cGxvYWRlci5jb20vZGVtb3MjZ2FsbGVyeS12aWV3JyxcclxuICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogJzE5OjM4J1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgdXNlckxpc3QgPSB7XHJcbiAgICAnZGF0YSc6IHtcclxuICAgICAgICAnc2V0dGluZ3MnOiB7XHJcbiAgICAgICAgICAgICdkb19ub3RpZmljYXRpb24nOiB0cnVlLFxyXG4gICAgICAgICAgICAnaW52b2tlX2luX21pbGxpcyc6IDMwMDBcclxuICAgICAgICB9LFxyXG4gICAgICAgICdhY2NvdW50cyc6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ3RoZV9yb3N0eXNsYXYnLFxyXG4gICAgICAgICAgICAgICAgJ3VucmVhZF9jb252ZXJzYXRpb25zJzogMCxcclxuICAgICAgICAgICAgICAgICdwYWdpbmF0aW9uJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICdwcmV2X2N1cnNvcic6ICcuLi4nLFxyXG4gICAgICAgICAgICAgICAgICAgICduZXh0X2N1cnNvcic6ICcuLi4nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgJ2NvbnZlcnNhdGlvbnMnOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiAnMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogJ9Ci0LXRgdGCMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0byc6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAnZGlhbmFjb2JlcjcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFPRUFBQURoQ0FNQUFBQUpiU0pJQUFBQXlWQk1WRVgvLy8rcmUxQ1NYa1Y0UURxQXFyOWtsN0dpYlQxZU1pMXpvYmhrZTVCeE15ekRzSyttZFU2S1VESnVMQ09RV2orZmJVdm40TituZFVYWHhMV3NpWHVrYmpyYnJKaUVUejlUanFwa05UQjFQRG1wZUV1VllVT0lXMEJxSkJwWkxDdnY1K0cvbklIazYvQnhSVGFsYWpPSW5xbHpqNTJhWGgrTm5LdDFPalBOdXJLOHhNeWFlSFhOblltZWUyQzVpSE9Oc01PZ3ZzNWZBQUNEUVJuQXA1eWdkV0wzOC9EYnpjWjlRakRRdzhHVWJtcVZaVWE3bG5pdmpISE10S0tiWjBMQmtYdy9oS1NuWlNBcUk5UEtBQUFEUjBsRVFWUjRuTzNkMjFZYU1SaEFZYldDdEIwUUVLcUFGYlMwYXRYYWdrYzgxdmQvcUY0MSthbVpoZ3hKSnE2MTkrV3N5ZUZ6YnVJb2k1VVZJaUlpSWlJaUlpSWlLclhiajNHN2pTNmNOVDdFckRHTExqdzlmaGV6NDFPRUNCRWlSSWdRWVN4aFN6Y0xKdHdXYWVGTXJCMVFPR21vZ2dINzJhcHF0NitKZXVsSlFPRmVLSllVTnJWd3JXKzZZdzhoUW9RSUVTSkUrRWFGZlozNVRCTlEySnJzcWNJQnRXcDFXMmpOZCtzTlRYeWNVVnVOWUs0Y29jTzRCa0tFQ0wyRk1DK0VDQkV1RGpEM1pvVDlucVdOdTZ6NXV1eHVROS95UlNjRzVwemFvZ3Q3RzVhRzR0Y0ZVWE5vRzloRGlCQWhRb1FJRVpZczFJZXYzdENZazlBOFJjLzJUaXFrY0UzMzJkelFRVGpNbVVPc0Vsc28zMnJtNUNTMHpwWVpuMkpJb1huVDRZUk5oQWdSSWtTSUVLRjM0ZFZJZFgyemJjcCtwaEd2ejh3M1orSU82MnlaY1JjMzEzcWpWMDdDclhIMWIyM3I0bVhXVnZzY2I3a0owM2FaYWlORW1Id0lFYVlmUW9TdnFuWlZiWkcrMm5YYVg5YzJYVFcyc0NwT2dTZnZWVWRpRGhkaVY0dzcwdE9kNkt0WE5xSjM0U2l5Y0lRUUlVS0VDQkVpUk9oZk9MamZWejM4ME9tcit3TUg0VUNNRTdNOTZLdjN0dW04bjd3SEl2TmxCMkRldUp4RjRnaVRDeUhDOUVPSU1QMFEvaXNVYjd6SzN2cC9FNi9sM0lTakxkWGprK0d6RXZNZm5BaTJmOVBITk9aNmV0UWJIVGtKSmJhK1pzbitKLzJpTlcxTDF3dXpSSzJraFY3K0Z3TWhRb1FJRVNKRXVJZ3dDMVVxd2hKRGlCQmgrU0ZFaUxEOEVDSkVXSDRJRVNJc1A0UUlFWmFmSCtHMHJpcTZrVTJkRjVkcTZ1VzdMdlEzWjlqL1dKb0RmRDVUblhzQWpzSjltVWRSNGRrbjFmbnlUN0h1bTRVUUlVS0VDQkVpbkd0YTdQVGxSYWlYbmdZVWZ0ZGR1dXp1WE9jMFRuUXAxZzRvRkhYY251S3lKKy9OVGh4V1llSFNJVVNJRUNGQ2hJa0tiYmtKYk1VWFhuUnM3YnBrbmUwaXV0RGVZWFh4RHN2ZWJLRVFJa3cvaEFqVER5SEM5SHVUd3Q4N3BpbzFZMk03VERVMlRwd3pjeVdnY0tkaXFyWnV6RWxvbkRobjVocENoQWdSSWtTSU1CM2h5M2p4WHNvVUh2elN1ZXhqL1p1eHIrYWNadjZwV2ovd0lSVExPTzBqeHMwN0NCRWlSSWdRSVVLRUN3cHpYcVVsVWNXTFVCeTN6VC9TbXZrQnhMaTVoaEFoUW9RSUVTSkVpQkFoUW9RSUVTSkVpQkJoS3NJL1hpa2dRckpmOUcwQUFBQUFTVVZPUks1Q1lJST0nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1c2VybmFtZSc6ICd5b3VyX2RpZXRhJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZmlsZV9waWNfdXJsJzogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBT0VBQUFEaENBTUFBQUFKYlNKSUFBQUF3MUJNVkVYLy8vK3JlMUNSZDE1RW04WFBxWVliaGJpaWJUM2JySmlQZDE5a2U1RE1vMzJ0ZTArZWVWZjE3dW1wZUV6SW9IeXNtb21KYlZDbmRVWHE1dVBYeExYbzE4amc3UE14bE1HL25JR21lbFBhdmFUU3JJcVhlRnZ2NStFbWlydWpiRHNBaDcrcGF5NmlnMnl6aGwyK2syMEFmTFJGZ0tOK2VuWE5vbzE2czlLTmNsL053cnFIYVV5ZWUyQlRib2E0azMyOHhNeDFlNFNmaVhXd2FSdkluSEcvc3Flc2xIL010cVRqemJ2aDVlaEpaNEJxY1h6Y3dhblVzNVd2akhHN2xuaFllNWVhaTJ4b0FBQUQva2xFUVZSNG5PM2NiVmZUU0JpQVlReWxpN1NwcFVDaFVBd1ZXTjlRZDFXUWZVSDUvNzlLUDhnOFQvYzgyZW1FbVVsNnZPK1BPY25NWEMwOURHbDBZNE9JaUlpSWZybktZOWVkT253cmh3L3NDKy9rakRMTFNwdFc3dlFlMmxHSGo5M2huUnFodW00OWhUMkVDRHNUUW9RSTJ3L2hPZ2tQekc1N3lpTGR5ZUYvN1F0RjJMdTF6OGd1UE42eDZxbjhoMFBPT000djdPVU5JVUtFQ0JFaVJKaE5XRXBLK0N4ZFNsaWF4UlorTnJkWkY2TlVYYWhaekwzYzU5akVwZTJqRWo1SjA1TFFMUG9mSWdnUklrU0lFQ0hDRm9RblVqcGhhVy9WY2dpZnFBM2N1VW1NSTZ4eDVSQ3FFQ0pFaUJBaFFvVFpoQ2RtRjZPQks0SmxZSTUyYm03Z1lndFB6czJHYzlmdzhjU0JIazRUcFpOMFF2UEhjVERjTG42MlBZOGduTXR3OWdzMmFsRllSQkVXQ0JFaVJJZ1E0ZG9JWlc4MTNIYk43UzNYQ2k1cExzTU56ZEV5Q1lmZVFvZ0QvM0M1aFRXdjlFeU9iZ2NKMVhXem1wK083RUx6MHpLVGoyU2dVSzZicVhmVy9JUWpSSWdRSVVLRUhSUVdRL21XYjFZOFdsak1aTGhoa1V4WW5yb08xSU4wSWh6ZGpGMDNSNUljSFlmY1JSMnA2OVJvZWhJMXQxclJnU3cwREx0ZjlSK2FxQzlpWlVsOS8zaFZnTER5ditaOTlYcElFN2ZPYWo5TU9QRXNxWCthV1hqYTl3d3hRWWdRSVVLRUNCR3V2N0RzaVBDdnY5KzdmRU9zSVB4RGh2dkh0NUhQSlh6LzlLSDdHRUkzMnRNL0VTSkVpQkFoUW9RdENPMDdVZFBJUWpmY2ZYYmg2TnVSMWJkM1VzajkwcEU1MnRIWGdPRmlDL1VkUFYzVDcvRWZQMXgwWWVkQ2lMRDdJVVRZL1JEK1YxaE5YRTEvaWFkTHJVaVdHZmo5NGVtKzYwdkRoL0hTcFIveit5SUw5ZC9mckdsdnQ5bkRlT2xTai9udDdqVmxMUW1iUFh5UUx2VllBMEtFQ0ZzS0lVS0U3WmRTT0pPeXU5VGM2WVNGL2xjUnVZRnE3aUtkVUZuekM2MWxJRVNJRUNGQ2hBZ1RDd2NCK2YvSFlPOFEyWVY2QStmdjFXKysvR09ZcTBncERNb3ZiRGd3UW9RSUVTSkVpRENXOEdyWDFYQWRLK3hwd2x5dXF4akNqVDFYR1VSOEpYMTk0U3NJV01xU1lnQjFWeUVMVWU5UUVNRGJWV3dXUW9RSUVTSkVpSEJaR0xLQml5eFVXN1dFd3JmU1IrK1NQa2dSaEIvVjNBbUZxdkhqRngzVU9BOExJVUtFQ0JFaVJMZ3NqSENUTWFEZC9NTHJzZGxMYVI2U3VzNGUrRHE3MEc1NmVlWmFWS3Uza01zdXAyMGovcmZwNWRaRFo0dis2aTNPM0hVSVd3NGhRb1R0aHhEaGVnay9MVnlWeWFya2hFOWRFVDQvdE5xNmxMWWsyWWlkdmJHSTFSdDFocnBPajJiTzl6eWg4SERUNm5ETFU2M1FkMkhOZkFnUklrU0lFQ0hDVGdxTGhWWFJFZUgwdFdSTytHTktxMDIxMHQvdDFCazFZOWlwRmNYWXhFN3I1dkhsZTRPV2FqakhJVUtFQ0JFaVJJZ1FZV0todWpGWHcxSzN6OVpTcUxFbXNDa0xJVUtFQ0JFaVJJZ1FJVUtFQ0JFaVJJZ1FJY0l1Q3I4RFM4d2MwUGdSNFI0QUFBQUFTVVZPUks1Q1lJST0nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdsYXN0X21lc3NhZ2UnOiAn0LnQvtGDJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX3VucmVhZCc6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6ICcyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnU2VyZ2FudCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0byc6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAnZGlhbmFjb2JlcjcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFPRUFBQURoQ0FNQUFBQUpiU0pJQUFBQXhsQk1WRVgvLy8rOWttYUtTVUwvMVhsZUZ5MjJobFgvekZ4N1FWUGVEdzNBbFdpRlBUWEtzN0duZlhtSFF6eHdQRGFXVzB0WEFDbWxjVlhnQUFDNmpWNkNOeTdmemJ6cDRlQlpDeXFzZjF5U1lrMkdRajkzTzFLemhWLy8wbS9FZmxqLzl1ZDhRbFIyUGp5d2VrRC96bU82bVd2L3lFbWVibDMvMDNPRFUwS3hnVlgvMFYzY3Exbnh2bHVaYkZEeTYrUi9NU2ZYT3lyLzNwdG5MRExIbGxkbElqWjhLUjcwOFBCeU5GR1JVai9PdWJPcmUxVGtzbG5Zd2F6WFBpeWhkVldnY1d6WHg4VjZRejdCTGx0WUFBQUUyVWxFUVZSNG5PM2RXMWZUUUJRRllDOUFEYWkwY2tsTGkxS3RXdFNpb3FXS0YvVC8veWw5Nlp5ZHRmWTRtWkJKQXU3OXlKck1tYStCdFE3VFNYdm5qcUlvaXFJb2luTGJjdld3QzdsS0tGdys2a0tXQ1lYdjczVWg3eVdVVU1MV0k2R0VFcEljcFVvendvc2R5emF0dUR0SWxWMWFieHRXZEZHRDhIQzU3Y0x2NENCTGxRRy9pN2FnNVdFZHduMyt1NExDdTJuaUUxcjJKWlJRUWdrbGxGRENhd2d2RGwxK2VWbzF5ekNaY0FoVjZDcTJmOWxDNHhxNG5lWCtPcDVXYlFMTlZTTGdYNkpsNG1uZzNEcVhPM0ZDN2tKaE1oYVBSd2hXQ1NXVVVFSUpKWlN3SmlGczlEVXZER3d5MWlJOGFxSlQ4d1ZxVTJKTndzWmRMQkpLS0dIN2tWQkNDZHRQN1VKb2wwQ1lOZEhmOENJWmJlQ3FDM2NuRnFneW1ydjhUTGFiK05PS2pLQUlyR2kzRGlGZGZ6Wi83TEpJSmx4WWtUbGZob1FTU2lpaGhCSktXTDhRbWlpUGtKL2U4Z2tDZzR0Q09xSm1ZZmJLTWoxM2dZWnFNckxBWUw3MU9JRVJjSjBOemtaV1pBcURZVVYxQzFmamRYcWZOOWJKVFpnTisvazZmVGQydkJwUzRkQ21HOE4xOXFaNU5zcGRsYzg5bXk2aGNOeGI1OFFuZEQvZU9IR0R4eDRoVEdlWCtZUXduWVFTU2lpaGhCSTJMVHdxQ0U5Y0NrS1hndEJsVEUrK1pVT1lyaUIwS1FodE9oUWVWUlIrL2VKT3pJMkdMcE9WZXgyeHA1bmJpSVV0YWNQR2pnZERsb0hkdzU1ZGxpOXN4Qng3R3BmVnhFYU0zRHEvZkkwU0h1elpiWUhlYW9NbTc3dmtmTVNZNS9yVHJleUc3eDFFQ2dOL0xYSHAyUitSNWFRWHZwQ0gvb1ZMS0tHRUVrb29vWVRYRWdaN21uQ2llcHFZNlZaMUNIRlhzeCt1enRMSGh6TXNrNnJUMGEzVGF3akJXblZKbnY4dEtndlo0aVNVVUVJSkpaUlF3Z3BDK282cjdSR1ZXQndNOWdrclRrZmZjNDRVd200aVBNZWN3Y2JpTkxnaTJQTmpyL25md0hSQjRoU21neFVOcXU0bThoMWhiRkhEUXRvOUZ1OWlSTWM3OWJ5UFgzVkhPSHdXbzRUUTQ2TFRsUkRTNnhLZU5wRlFRZ2tsbEZEQ0VrSTdwNFVMeWUzMFZwd3cvL2QwL2VhRkN6dHE5OXRXZEE0bjhLS0VjTjI1VGZmYmZzcVBlQ1lVWXNjRjc3YnozcW9Na2ZXRGVFTEFzNHFFUW56OVVSamxvdE1WaEtIQkVrb29vWVFTU3RnWm9Xc3FjeFRTOXd4OVFhRjd3Zm9OQ2VsVHNsaGxNWFdCSjF1eXB6R0I2K1kybmVkcG5KcWZrdlU4Nll4RWVpOW1UMkl5QzAySDlXcCswaGtTOWJUNjdNbUQ4a0ZoTUYxNUhsOUNDU1dVVUVJSmI2MHdZcDhKZXhxZmkvWTBQcGNsblREdVV3Vm5saDhVK0FOR0JHZHI1bE1GMFJyenVZbXpEMVQ0SWVaWHM5dWZmU21oaEJKS0tLR0VOMVJvMy83Z3llV2VKU3lrdTA5aElkUzREQzBvOHRzZjRCczhQRG16ZkE4U1BWdUlRZUIzcUJKY1VSMWZ3ZVlKUDR4YVNHQVgyQ2VNTzFDWkxpV0UxU0poWTVGUVFnbmJqNFMzUUxpNXh4S0hZZG5zaXZEc2dJYTdlVGI1RkdkdDAvNmQ1NXZsODd6dHhWYUtoQkoyUHhKSzJQMUlLR0gzSTZHRTNZK0VFblkvRWtyWS9VZ29ZU3ZaT21iWmVrbHpHaUU4NVZONDZpVVVIdDluT2Q1aWVSTWxmRVBuOE5TVFVFSUpKWlJRUWdtN0k3dzhkZkc1WEM3YkZENzdhSGxOSzc2MklQYWQ1Uk1GZm9JUnlJTDVlRDFZMGJNNmhNZUJnb1hpL0haNmhQekdsYWhpcjJnOXdtREZwb1VXQ1NXVVVFSUpKYnhKd2xPV215bkVMVEhMdDdjczMyQUVYTmR0SVliZUlGOHExcEJRUWdrbGxGQkNDU1ZNTFh3Umt4c3BiQ0lTU2loaCs1RlFRZ25iajRUL2hmQVBJYUcrYWtjcFZDNEFBQUFBU1VWT1JLNUNZSUk9J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncGFyYW1fdmFsdWUnOiAnZGlhbmFjb2JlcjcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnbGFzdF9tZXNzYWdlJzogJ2hhbGxvIHN0YXRpYyBzZXJnYW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX3VucmVhZCc6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAndGhlX3Jvc3R5c2xhdjInLFxyXG4gICAgICAgICAgICAgICAgJ3VucmVhZF9jb252ZXJzYXRpb25zJzogMCxcclxuICAgICAgICAgICAgICAgICdwYWdpbmF0aW9uJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICdwcmV2X2N1cnNvcic6ICcuLi4nLFxyXG4gICAgICAgICAgICAgICAgICAgICduZXh0X2N1cnNvcic6ICcuLi4nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgJ2NvbnZlcnNhdGlvbnMnOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiAnMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogJ9Ci0LXRgdGCMjInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAndG8nOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ2RpYW5hY29iZXI3JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZmlsZV9waWNfdXJsJzogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBT0VBQUFEaENBTUFBQUFKYlNKSUFBQUF5VkJNVkVYLy8vK3JlMUNTWGtWNFFEcUFxcjlrbDdHaWJUMWVNaTF6b2Joa2U1QnhNeXpEc0srbWRVNktVREp1TENPUVdqK2ZiVXZuNE4rbmRVWFh4TFdzaVh1a2JqcmJySmlFVHo5VGpxcGtOVEIxUERtcGVFdVZZVU9JVzBCcUpCcFpMQ3Z2NStHL25JSGs2L0J4UlRhbGFqT0lucWx6ajUyYVhoK05uS3QxT2pQTnVySzh4TXlhZUhYTm5ZbWVlMkM1aUhPTnNNT2d2czVmQUFDRFFSbkFwNXlnZFdMMzgvRGJ6Y1o5UWpEUXc4R1VibXFWWlVhN2xuaXZqSEhNdEtLYlowTEJrWHcvaEtTblpTQXFJOVBLQUFBRFIwbEVRVlI0bk8zZDIxWWFNUmhBWWJXQ3RCMFFFS3FBRmJTMGF0WGFna2M4MXZkL3FGNDErYW1aaGd4SkpxNjE5K1dzeWVGemJ1SW9pNVVWSWlJaUlpSWlJaUlpS3JYYmozRzdqUzZjTlQ3RXJER0xManc5ZmhlejQxT0VDQkVpUklnUVlTeGhTemNMSnR3V2FlRk1yQjFRT0dtb2dnSDcyYXBxdDYrSmV1bEpRT0ZlS0pZVU5yVndyVys2WXc4aFFvUUlFU0pFK0VhRmZaMzVUQk5RMkpyc3FjSUJ0V3AxVzJqTmQrc05UWHljVVZ1TllLNGNvY080QmtLRUNMMkZNQytFQ0JFdURqRDNab1Q5bnFXTnU2ejV1dXh1UTkveVJTY0c1cHphb2d0N0c1YUc0dGNGVVhOb0c5aERpQkFoUW9RSUVaWXMxSWV2M3RDWWs5QThSYy8yVGlxa2NFMzMyZHpRUVRqTW1VT3NFbHNvMzJybTVDUzB6cFlabjJKSW9YblQ0WVJOaEFnUklrU0lFS0YzNGRWSWRYMnpiY3ArcGhHdno4dzNaK0lPNjJ5WmNSYzMxM3FqVjA3Q3JYSDFiMjNyNG1YV1Z2c2NiN2tKMDNhWmFpTkVtSHdJRWFZZlFvU3ZxblpWYlpHKzJuWGFYOWMyWFRXMnNDcE9nU2Z2VlVkaURoZGlWNHc3MHRPZDZLdFhOcUozNFNpeWNJUVFJVUtFQ0JFaVJPaGZPTGpmVnozODBPbXIrd01INFVDTUU3TTk2S3YzdHVtOG43d0hJdk5sQjJEZXVKeEY0Z2lUQ3lIQzlFT0lNUDBRL2lzVWI3ekszdnAvRTYvbDNJU2pMZFhqaytHekV2TWZuQWkyZjlQSE5PWjZldFFiSFRrSkpiYStac24rSi8yaU5XMUwxd3V6Uksya2hWNytGd01oUW9RSUVTSkV1SWd3QzFVcXdoSkRpQkJoK1NGRWlMRDhFQ0pFV0g0SUVTSXNQNFFJRVphZkgrRzByaXE2a1UyZEY1ZHE2dVc3THZRM1o5ai9XSm9EZkQ1VG5Yc0Fqc0o5bVVkUjRka24xZm55VDdIdW00VVFJVUtFQ0JFaW5HdGE3UFRsUmFpWG5nWVVmdGRkdXV6dVhPYzBUblFwMWc0b0ZIWGNudUt5SisvTlRoeFdZZUhTSVVTSUVDRkNoSWtLYmJrSmJNVVhYblJzN2Jwa25lMGl1dERlWVhYeERzdmViS0VRSWt3L2hBalREeUhDOUh1VHd0ODdwaW8xWTJNN1REVTJUcHd6Y3lXZ2NLZGlxclp1ekVsb25EaG41aHBDaEFnUklrU0lNQjNoeTNqeFhzb1VIdnpTdWV4ai9adXhyK2FjWnY2cFdqL3dJUlRMT08wanhzMDdDQkVpUklnUUlVS0VDd3B6WHFVbFVjV0xVQnkzelQvU212a0J4TGk1aGhBaFFvUUlFU0pFaUJBaFFvUUlFU0pFaUJCaEtzSS9YaWtnUXJKZjlHMEFBQUFBU1VWT1JLNUNZSUk9J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnbGFzdF9tZXNzYWdlJzogJ2hhbGxvIHN0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdpc191bnJlYWQnOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF1cclxuICAgIH1cclxuXHJcbn07XHJcblxyXG5leHBvcnQge3VzZXJMaXN0LCBjb252ZXJzYXRpb259O1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYmxvY2tzL21lc3NhZ2VzL2RhdGFTZXJ2ZXIuanMiLCJpbXBvcnQgKiBhcyBkYXRhIGZyb20gJy4vZGF0YVNlcnZlcic7XHJcbmltcG9ydCBNZXRlb3JFbW9qaSBmcm9tICdtZXRlb3ItZW1vamknO1xyXG5pbXBvcnQgcXEgZnJvbSAnZmluZS11cGxvYWRlcic7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyJztcclxuaW1wb3J0IFVzZXJDb252ZXJzYXRpb24gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2FwaS11c2VyLWRpcmVjdCc7XHJcblxyXG5mdW5jdGlvbiBpc0luTWVzc2FnZVBhZ2UoKSB7XHJcbiAgICBjb25zdCAkbXNnTGlzdCA9ICQoJy5tZXNzYWdlcy1saXN0Jyk7XHJcbiAgICBjb25zdCAkdXNlckxpc3QgPSAkKCcubWVzc2FnZXMtdXNlci1saXN0Jyk7XHJcbiAgICByZXR1cm4gISEkbXNnTGlzdC5sZW5ndGggJiYgISEkdXNlckxpc3QubGVuZ3RoO1xyXG59XHJcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcclxuICAgIGlmICghaXNJbk1lc3NhZ2VQYWdlKCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcclxuICAgIGNvbnN0IG0gPSBuZXcgTWV0ZW9yRW1vamkoKTtcclxuICAgIGNvbnN0ICRwaWNrZXIgPSAkKCd0ZXh0YXJlYVtkYXRhLW1ldGVvci1lbW9qaT1cInRydWVcIl0gfiBkaXYnKTtcclxuICAgIGNvbnN0IHN0eWxlID0gJHBpY2tlci5hdHRyKCdzdHlsZScpO1xyXG4gICAgY29uc3Qgc3R5bGVOZXcgPSBzdHlsZS5yZXBsYWNlKCd0b3A6IDMwcHg7JywgJ3RvcDogLTIxMHB4OycpO1xyXG4gICAgJHBpY2tlci5hdHRyKCdzdHlsZScsIHN0eWxlTmV3KTtcclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcclxuICAgIGNvbnN0IHJlc3RyaWN0ZWRVcGxvYWRlciA9IG5ldyBxcS5GaW5lVXBsb2FkZXIoe1xyXG4gICAgICAgIGVsZW1lbnQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaW5lLXVwbG9hZGVyLXZhbGlkYXRpb24nKSxcclxuICAgICAgICB0ZW1wbGF0ZTogJ3FxLXRlbXBsYXRlLXZhbGlkYXRpb24nLFxyXG4gICAgICAgIHJlcXVlc3Q6IHtcclxuICAgICAgICAgICAgZW5kcG9pbnQ6ICcvc2VydmVyL3VwbG9hZHMnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aHVtYm5haWxzOiB7XHJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyczoge1xyXG4gICAgICAgICAgICAgICAgd2FpdGluZ1BhdGg6ICdodHRwczovL2ZpbmV1cGxvYWRlci5jb20vc291cmNlL3BsYWNlaG9sZGVycy93YWl0aW5nLWdlbmVyaWMucG5nJywgLy8gJy9zb3VyY2UvcGxhY2Vob2xkZXJzL3dhaXRpbmctZ2VuZXJpYy5wbmcnLFxyXG4gICAgICAgICAgICAgICAgbm90QXZhaWxhYmxlUGF0aDogJ2h0dHBzOi8vZmluZXVwbG9hZGVyLmNvbS9zZXJ2ZXIvd2FpdGluZy1nZW5lcmljLnBuZycgLy8gJy9zb3VyY2UvcGxhY2Vob2xkZXJzL25vdF9hdmFpbGFibGUtZ2VuZXJpYy5wbmcnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbGlkYXRpb246IHtcclxuICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnM6IFsnanBlZycsICdqcGcnLCAndHh0J10sXHJcbiAgICAgICAgICAgIGl0ZW1MaW1pdDogMyxcclxuICAgICAgICAgICAgc2l6ZUxpbWl0OiA1MDAgKiAxMDI0XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZmlsbExpc3QoJGxpc3QsIGRhdGFBcnJheSkge1xyXG4gICAgY29uc3QgaXRlbXMgPSBkYXRhQXJyYXk7XHJcbiAgICBjb25zdCBjTGlzdCA9ICRsaXN0O1xyXG4gICAgLy8gY29uc3QgZGVmYXVsdEF2YXRhclNyYyA9ICdodHRwczovL2kuaW1ndXIuY29tL2pOTlQ0TEUucG5nJztcclxuICAgIGNvbnN0IGluc2VydE1zZyA9ICh2YWx1ZSwgdHlwZSwgY3NzQ2xzKSA9PiB7XHJcbiAgICAgICAgbGV0IHN0ciA9ICcnO1xyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdwaG90byc6XHJcbiAgICAgICAgICAgICAgICBzdHIgPSBgPGRpdiBjbGFzcz1cImNoYXQtaW1nXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9XCIke3ZhbHVlfVwiIGFsdD1cIkNvbnRlbnQgSW1hZ2VcIiBjbGFzcz1cImNvbnRlbnQtaW1hZ2VcIj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PmA7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbGluayc6XHJcbiAgICAgICAgICAgICAgICBzdHIgPSBgPGRpdiBjbGFzcz1cImNoYXQtaW1nXCI+XHJcbiAgICAgICAgICAgICAgICA8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiJHt2YWx1ZX1cIj4ke3ZhbHVlfTwvYT5gO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHN0ciA9IGA8ZGl2IGNsYXNzPVwiY2hhdC10ZXh0XCIgPiR7dmFsdWV9PC9kaXY+YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0cjtcclxuICAgIH07XHJcbiAgICBjTGlzdC5lbXB0eSgpLmFkZENsYXNzKCdib3JkZXItbGlnaHQtY29sb3InKTtcclxuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gaXRlbTtcclxuICAgICAgICAvLyBjb25zdCBjaGVja3BvaW50ID0gaXRlbS5jaGVja3BvaW50IHx8IGl0ZW07XHJcblxyXG4gICAgICAgIGlmIChtZXNzYWdlLnNpZGUgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJjaGF0LWl0ZW0gY2hhdC1pdGVtLWxlZnRcIiB2YWx1ZT1cIiR7bWVzc2FnZS52YWx1ZX1cIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgICR7KG1lc3NhZ2VbJ3Byb2ZpbGVfcGljX3VybCddKVxyXG4gICAgICAgICAgICAgICAgICAgID8gYDxkaXYgY2xhc3M9XCJjaGF0LWltZy1ib3hcIj4gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cIiR7bWVzc2FnZVsncHJvZmlsZV9waWNfdXJsJ119XCIgYWx0PVwiVXNlciBBdmF0YXJcIiBjbGFzcz1cIlwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gXHJcbiAgICAgICAgICAgICAgICAgICAgOiAnJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz1cImNoYXQtdXNlcm5hbWUgdGV4dC1tdXRlZFwiPiR7bWVzc2FnZS51c2VybmFtZX08L3A+XHJcbiAgICAgICAgICAgICAgICAgICAgJHtpbnNlcnRNc2cobWVzc2FnZS52YWx1ZSwgbWVzc2FnZS50eXBlKX1cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz1cImNoYXQtdGltZS10ZXh0XCI+JHttZXNzYWdlLnRpbWVzdGFtcH08L3NtYWxsPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDwvbGk+YCkuYXBwZW5kVG8oY0xpc3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICQoYDxsaSBjbGFzcz1cImNoYXQtaXRlbSBqdXN0aWZ5LWNvbnRlbnQtZW5kIGNoYXQtaXRlbS1yaWdodFwiIHZhbHVlPVwiJHttZXNzYWdlLnZhbHVlfVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICR7aW5zZXJ0TXNnKG1lc3NhZ2UudmFsdWUsIG1lc3NhZ2UudHlwZSl9XHJcbiAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPVwicHVsbC1yaWdodCBjaGF0LXRpbWUtdGV4dFwiPiR7bWVzc2FnZS50aW1lc3RhbXB9PC9zbWFsbD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9saT5gKS5hcHBlbmRUbyhjTGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZmlsbFVzZXJMaXN0KCRsaXN0LCBkYXRhQXJyYXkpIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gZGF0YUFycmF5Lm1ldGE7XHJcbiAgICBjb25zdCBjTGlzdCA9ICRsaXN0O1xyXG4gICAgY29uc3QgY29udmVyc2F0aW9uRGV0YWlsID0gZnVuY3Rpb24oaXRlbXMpIHtcclxuICAgICAgICBsZXQgdHBsID0gJyc7XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICB0cGwgKz0gYDxpbWcgc3JjPVwiJHtpdGVtWydwcm9maWxlX3BpY191cmwnXX1cIiBjbGFzcz1cIm1lZGlhLXBob3RvXCIgc3R5bGU9XCJ3aWR0aDogMjRweDtcIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZWRpYS1ib2R5XCI+XHJcbiAgICAgICAgICAgICAgICA8aDUgY2xhc3M9XCJ0aXRsZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICR7aXRlbS51c2VybmFtZX1cclxuICAgICAgICAgICAgICAgIDwvaDU+YDtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdHBsO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IGFkZENvbnZlcnNhdGlvbnMgPSBmdW5jdGlvbihjb252ZXJzYXRpb25zLCBpZHgpIHtcclxuICAgICAgICBsZXQgdHBsID0gJyc7XHJcbiAgICAgICAgY29udmVyc2F0aW9ucy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHRwbCArPSBgPGRpdiBpZD1cImNvbGxhcHNlLSR7aWR4fVwiIGNsYXNzPVwiY29sbGFwc2VcIiBhcmlhLWxhYmVsbGVkYnk9XCJoZWFkaW5nLSR7aWR4fVwiIGRhdGEtcGFyZW50PVwiI2FjY29yZGlvblwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lZGlhXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7Y29udmVyc2F0aW9uRGV0YWlsKGl0ZW0udG8pfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz1cInN1bW1hcnlcIj4ke2l0ZW1bJ2xhc3RfbWVzc2FnZSddfTwvcD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5gO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0cGw7XHJcbiAgICB9O1xyXG4gICAgY0xpc3QuZW1wdHkoKS5hZGRDbGFzcygnYm9yZGVyLWxpZ2h0LWNvbG9yJyk7XHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtLCBpZHgpID0+IHtcclxuICAgICAgICAkKGA8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW1cIiBkYXRhLXRvZ2dsZT1cImNvbGxhcHNlXCIgZGF0YS10YXJnZXQ9XCIjY29sbGFwc2UtJHtpZHh9XCIgYXJpYS1leHBhbmRlZD1cInRydWVcIiBhcmlhLWNvbnRyb2xzPVwiY29sbGFwc2UtJHtpZHh9XCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZWRpYVwiIGlkPVwiaGVhZGluZy0ke2lkeH1cIj5cclxuICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJtci0zXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9XCJodHRwczovL2kuaW1ndXIuY29tL2pOTlQ0TEUucG5nXCJcclxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm1lZGlhLXBob3RvXCI+XHJcbiAgICAgICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImJhZGdlIGJhZGdlLXNlY29uZGFyeSBwb3NpdGlvbi1hYnNvbHV0ZSBwLTJcIj4ke2l0ZW1bJ3VucmVhZF9jb252ZXJzYXRpb25zJ119PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lZGlhLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9XCJ0aXRsZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW0udXNlcm5hbWV9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9oND5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgJHthZGRDb252ZXJzYXRpb25zKGl0ZW0uY29udmVyc2F0aW9ucywgaWR4KX1cclxuICAgICAgICAgICAgPC9saT5gKS5hcHBlbmRUbyhjTGlzdCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkSGFuZGxlcnMoKSB7XHJcbiAgICAvLyBsZXQgY2hlY2twb2ludFR5cGUgPSAnJztcclxuXHJcbiAgICAkKCcjc2VuZE1lc3NhZ2VCdXR0b24nKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgIC8vIGNvbnN0ICRidXR0b24gPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICBjb25zdCB1c2VyTXNnID0gJCgnI3NlbmRNZXNzYWdlVGV4dEFyZWEnKS52YWwoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh1c2VyTXNnKTtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYWxlcnRcclxuICAgICAgICBhbGVydCh1c2VyTXNnKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkYnV0dG9uKTtcclxuICAgIH0pO1xyXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5saXN0LWdyb3VwLWl0ZW0nLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgLy8gZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdjbGljaycpO1xyXG4gICAgICAgIGNvbnN0ICRtc2dMaXN0ID0gJCgnLm1lc3NhZ2VzLWxpc3QnKTtcclxuICAgICAgICBjb25zdCB7Y29udmVyc2F0aW9ufSA9IGRhdGE7XHJcbiAgICAgICAgLy8gVXNlci5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICAgICAgZmlsbExpc3QoJG1zZ0xpc3QsIGNvbnZlcnNhdGlvbi5kYXRhLm1ldGEubWVzc2FnZXMpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgY29uc3Qgey8qIGNvbnZlcnNhdGlvbiwqL3VzZXJMaXN0fSA9IGRhdGE7XHJcbiAgICAvLyBjb25zdCAkbXNnTGlzdCA9ICQoJy5tZXNzYWdlcy1saXN0Jyk7XHJcbiAgICBjb25zdCAkdXNlckxpc3QgPSAkKCcubWVzc2FnZXMtdXNlci1saXN0Jyk7XHJcbiAgICAvLyBjaGVjayB3ZSBhcmUgaW4gY29ycmVjdCBwYWdlIChtZXNzYWdlcylcclxuICAgIGlmICghaXNJbk1lc3NhZ2VQYWdlKCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlbiA9IFVzZXIuZ2V0VG9rZW4oKTsgLy8gdXBkIHRvOiBVc2VyLmdldFRva2VuKClcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gVXNlckNvbnZlcnNhdGlvbi5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICBtZXRhZGF0YS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBmaWxsVXNlckxpc3QoJHVzZXJMaXN0LCByZXN1bHQuZGF0YSB8fCB1c2VyTGlzdC5kYXRhKTtcclxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdhZGQgb25DbGljaycpO1xyXG4gICAgICAgIFVzZXJDb252ZXJzYXRpb24uZ2V0TWV0YWRhdGEodG9rZW4pO1xyXG4gICAgICAgIC8vIGZpbGxMaXN0KCRtc2dMaXN0LCByZXN1bHQuZGF0YS5tZXRhLm1lc3NhZ2VzIHx8IGNvbnZlcnNhdGlvbi5kYXRhLm1ldGEubWVzc2FnZXMpO1xyXG4gICAgICAgIC8vIGFkZEhhbmRsZXJzKCk7XHJcbiAgICB9KTtcclxuICAgIGFkZEhhbmRsZXJzKCk7XHJcblxyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvbWVzc2FnZXMvbWVzc2FnZXMuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgUHViU3ViIGZyb20gJ3B1YnN1Yi1qcyc7IC8vIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3B1YnN1Yi1qc1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29uc3RzJztcclxuaW1wb3J0IHZpZXdVdGlscyBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdmlldyc7XHJcblxyXG5jb25zdCBzZWxlY3RvckNscyA9IHtcclxuICAgIGZvcm06ICcuYXV0aC5yZWdpc3RlciAuZm9ybS1zaWduaW4nLFxyXG4gICAgc3VibWl0QnRuOiAnW3R5cGU9XCJzdWJtaXRcIl0nXHJcbn07XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlZ2lzdGVyRm9ybSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnVzZXIgPSBVc2VyO1xyXG4gICAgICAgIHRoaXMuJGZvcm0gPSAkKHNlbGVjdG9yQ2xzLmZvcm0pO1xyXG4gICAgICAgIHRoaXMuJGVtYWlsID0gdGhpcy4kZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwibWFpbFwiXScpO1xyXG4gICAgICAgIHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24gPSAkKCcjZGVzY3JpcHRpb24nKTtcclxuICAgICAgICB0aGlzLmZvcm1EYXRhID0geydlbWFpbCc6ICd0ZXN0MV9lbWFpbEBtLnJ1JywgJ3Bhc3N3b3JkJzogJ3Bhc3N3b3JkJ307XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBpZiAoJCgnLmF1dGgucmVnaXN0ZXInKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN1Ym1pdEZvcm0oZm9ybURhdGFPYmopIHtcclxuICAgICAgICBjb25zdCBlbWFpbCA9IHRoaXMuJGVtYWlsLnZhbCgpO1xyXG4gICAgICAgIGNvbnN0ICRwYXNzd29yZCA9IHRoaXMuJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInBhc3NcIl0nKSxcclxuICAgICAgICAgICAgJHBhc3N3b3JkQ29uZmlybSA9IHRoaXMuJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInBhc3MtY29uZmlybVwiXScpLFxyXG4gICAgICAgICAgICBwYXNzd29yZCA9IHRoaXMuJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInBhc3NcIl0nKS52YWwoKSxcclxuICAgICAgICAgICAgcGFzc3dvcmRDb25maXJtID0gdGhpcy4kZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwicGFzcy1jb25maXJtXCJdJykudmFsKCk7XHJcblxyXG4gICAgICAgIGlmIChwYXNzd29yZENvbmZpcm0gIT09IHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgICRwYXNzd29yZC5hZGRDbGFzcygnaW5wdXQtZXJyb3InKTtcclxuICAgICAgICAgICAgJHBhc3N3b3JkQ29uZmlybS5hZGRDbGFzcygnaW5wdXQtZXJyb3InKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLiRlbWFpbC52YWwodGhpcy4kZW1haWwudmFsKCkudG9Mb2NhbGVMb3dlckNhc2UoKSk7XHJcbiAgICAgICAgdGhpcy5mb3JtRGF0YSA9IGZvcm1EYXRhT2JqIHx8IHtlbWFpbCwgcGFzc3dvcmR9O1xyXG5cclxuICAgICAgICB0aGlzLnVzZXIucmVnaXN0ZXIodGhpcy5mb3JtRGF0YSlcclxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kYXRhICYmIHJlc3VsdC5kYXRhLnRva2VuKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgdGhlIGl0ZW1cclxuICAgICAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLmVtYWlsQ29uZmlybWVkLCAnZmFsc2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29va2llU3RvcmFnZS5zZXQoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbiwgcmVzdWx0LmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdyZXF1ZXN0IHN1Y2NlZWRlZCB3aXRoIEpTT04gcmVzcG9uc2UnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIFB1YlN1Yi5wdWJsaXNoKENPTlNULmV2ZW50cy5VU0VSX0xPR0dFRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSh0aGlzLiR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLm1lc3NhZ2UgfHwgJ1JlZ2lzdGVyIGFuZCBMb2dpbiBzdWNjc2VzcycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnbm8gcmVzdWx0LmRhdGEgZm91bmQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UodGhpcy4kdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLmxvZ2luLWJveCcpLnNob3coKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVxdWVzdCBmYWlsZWQnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZG8gc29tZXRoaW5nJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRFdmVudHMoKSB7XHJcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJCb3ggPSBDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJSZWdCb3g7IC8vICduYXYgLnJlZ2lzdGVyLWJveCc7XHJcbiAgICAgICAgY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAgICAgY29uc3QgY2xvc2VDbGFzcyA9ICdkLW5vbmUnO1xyXG4gICAgICAgIGNvbnN0ICRidG4gPSAkKHNlbGVjdG9yQ2xzLnN1Ym1pdEJ0biksXHJcbiAgICAgICAgICAgIGNzc1ZhbGlkYXRpb25DbGFzcyA9ICdmb3JtLXZhbGlkYXRpb24nO1xyXG5cclxuICAgICAgICAkYnRuLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm0gPSB0aGlzLiRmb3JtLmdldCgwKTtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkYnRuLmlzKCc6ZGlzYWJsZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm0uY2hlY2tWYWxpZGl0eSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gJGJ0bi5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VibWl0Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBIaWdobGlnaHQgZXJyb3JzXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0ucmVwb3J0VmFsaWRpdHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5yZXBvcnRWYWxpZGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzUmVnQnRuQ2xpY2sgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgnbmF2Lm5hdmJhcicpLmZpbmQoJy5yZWdpc3Rlci1ib3gnKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzUmVnQnRuQ2xpY2sgJiYgJChyZWdpc3RlckJveCkuaGFzQ2xhc3Mob3BlbmVkQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICAkKHJlZ2lzdGVyQm94KS5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYmxvY2tzL3JlZ2lzdGVyLWZvcm0vcmVnaXN0ZXItZm9ybS5qcyIsIi8vIGltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCB7Q09OU1R9IGZyb20gJy4vY29uc3RzJztcclxuaW1wb3J0IE5ldHdvcmsgZnJvbSAnLi9uZXR3b3JrJztcclxuaW1wb3J0IENvb2tpZVN0b3JhZ2UgZnJvbSAnLi9jb29raWUnO1xyXG5cclxuY2xhc3MgVXNlckNvbnZlcnNhdGlvbiB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5uZXR3b3JrID0gbmV3IE5ldHdvcmsoKTtcclxuICAgICAgICB0aGlzLmNvb2tpZVN0b3JhZ2UgPSBDb29raWVTdG9yYWdlO1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ1Bvc3QgPSB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBpc0xvZ2dlZEluKCkge1xyXG4gICAgICAgIHJldHVybiAhIXRoaXMuZ2V0VG9rZW4oKTtcclxuICAgIH1cclxuXHJcbiAgICBpc0VtYWlsQ29uZmlybWVkKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5jb29raWVTdG9yYWdlLmdldChDT05TVC5jb29raWVTdG9yYWdlLmVtYWlsQ29uZmlybWVkKSA9PT0gJ2NvbmZpcm1lZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFRva2VuKCkge1xyXG4gICAgICAgIGNvbnN0IGNvb2tpZVRva2VuID0gdGhpcy5jb29raWVTdG9yYWdlLmdldChDT05TVC5jb29raWVTdG9yYWdlLnRva2VuKTtcclxuICAgICAgICByZXR1cm4gY29va2llVG9rZW47XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TWV0YWRhdGEodG9rZW4sIGNiRXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KGAke0NPTlNULmdldFBhdGgoJ2luc3RhZ3JhbURpcmVjdF9nZXRNZXRhRGF0YScpfWAsIHtoZWFkZXJzOiB7dG9rZW59fSwgY2JFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VjdXJpdHlLZXkodXNlcm5hbWUsIGNoZWNrcG9pbnRUeXBlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyd0eXBlJzogY2hlY2twb2ludFR5cGV9KSwgLy8gdG9kbzogdG1wIHNldCwgaXQgc2hvdWxkIGJlICd0eXBlJ1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAuLi50aGlzLnNldHRpbmdQb3N0LmhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICAndG9rZW4nOiAnM2UzMjFlNjAwMjk3MTFlOTkyNjRhMDQ4MWM4ZTE3ZDQnIC8vIHRvZG86IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KGAke0NPTlNULmdldFBhdGgoJ2luc3RhZ3JhbUFjY291bnRfY2hlY2twb2ludCcpfSR7dXNlcm5hbWV9YCwgc2V0dGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uZmlybVNlY3VyaXR5S2V5KGtleSwgdXNlcm5hbWUpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7J3NlY3VyaXR5X2NvZGUnOiBrZXl9KSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgJ3Rva2VuJzogJzNlMzIxZTYwMDI5NzExZTk5MjY0YTA0ODFjOGUxN2Q0JyAvLyB0b2RvOiB0aGlzLmdldFRva2VuKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV0d29yay5zZW5kUmVxdWVzdChgJHtDT05TVC5nZXRQYXRoKCdpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXknKX0ke3VzZXJuYW1lfWAsIHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxubGV0IHVzZXJJbnN0YW5jZSA9IG51bGw7XHJcblxyXG5pZiAoIXVzZXJJbnN0YW5jZSkge1xyXG4gICAgdXNlckluc3RhbmNlID0gbmV3IFVzZXJDb252ZXJzYXRpb24oKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlckluc3RhbmNlO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL2FwaS11c2VyLWRpcmVjdC5qcyIsIi8qIGVzbGludC1kaXNhYmxlIHNvcnQtdmFycyAqL1xyXG4vLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBQdWJTdWIgZnJvbSAncHVic3ViLWpzJzsgLy8gaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVic3ViLWpzXHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG4vLyBpbXBvcnQgVmFsaWRhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9mb3JtLXZhbGlkYXRvcic7XHJcbmltcG9ydCB2aWV3VXRpbHMgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3ZpZXcnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29uc3RzJztcclxuXHJcbi8vIHdpbmRvdy4kID0gJDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBMb2dpblBhZ2Uoc2VsZWN0b3JDc3MpIHtcclxuICAgIGNvbnN0IHtfZm9ybUlkLCBfYnV0dG9uU3VibWl0SWQsIF9sb2dpbkJveH0gPSBzZWxlY3RvckNzcztcclxuICAgIGNvbnN0IHVzZXIgPSBVc2VyLCAvLyBzZXJ2aWNlXHJcbiAgICAgICAgJGZvcm0gPSAkKF9mb3JtSWQpLFxyXG4gICAgICAgICRlbWFpbCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJtYWlsXCJdJyksXHJcbiAgICAgICAgJHRleHRBcmVhRGVzY3JpcHRpb24gPSAkKCcjZGVzY3JpcHRpb24nKTtcclxuICAgIC8vIGNvbnN0IG9wZW5lZENsYXNzID0gJ2QtYmxvY2snO1xyXG4gICAgLy8gY29uc3QgY2xvc2VDbGFzcyA9ICdkLW5vbmUnO1xyXG5cclxuICAgIGNvbnN0IHVzZXJMb2dpbkhlYWRlciA9IChfZm9ybURhdGEpID0+IHtcclxuICAgICAgICBjb25zdCBjYkVycm9yID0gKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAkKF9sb2dpbkJveCkuYXBwZW5kKCc8cD5yZXN1bHQuc3RhdHVzLm1lc3NhZ2U8L3A+Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHVzZXIubG9naW4oX2Zvcm1EYXRhLCBjYkVycm9yKVxyXG4gICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5kYXRhICYmIHJlc3VsdC5kYXRhLnRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgaXRlbVxyXG4gICAgICAgICAgICAgICAgICAgIGNvb2tpZVN0b3JhZ2Uuc2V0KENPTlNULmNvb2tpZVN0b3JhZ2UudG9rZW4sIHJlc3VsdC5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcubmF2LWxpbmsuanNfbG9nT3V0JykucGFyZW50KCkuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdyZXF1ZXN0IHN1Y2NlZWRlZCB3aXRoIEpTT04gcmVzcG9uc2UnLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnTG9naW4gc3VjY3Nlc3MnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSh0aGlzLiR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBgPHA+c3RhdHVzOiAke3Jlc3VsdC5zdGF0dXMuc3RhdGV9PC9wPjxwPiBtZXNzYWdlOiAke3Jlc3VsdC5zdGF0dXMubWVzc2FnZX08L3A+YCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLm1lc3NhZ2UgfHwgJ0xvZ2luIGVycm9yJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBzdWJtaXRGb3JtID0gZnVuY3Rpb24oZm9ybURhdGFPYmopIHtcclxuICAgICAgICBjb25zdCBlbWFpbCA9ICRlbWFpbC52YWwoKSxcclxuICAgICAgICAgICAgcGFzc3dvcmQgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwicGFzc1wiXScpLnZhbCgpLFxyXG4gICAgICAgICAgICBfZm9ybURhdGEgPSBmb3JtRGF0YU9iaiB8fCB7ZW1haWwsIHBhc3N3b3JkfTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGVjdG9yQ3NzLmlzTG9naW5JbnN0YWdyYW0pIHtcclxuICAgICAgICAgICAgLy8gdG9kbzogZGVsZXRlIG1lXHJcbiAgICAgICAgICAgIC8vIGFkZEluc3RhZ3JhbUFjY291bnQoe3VzZXJuYW1lOiAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwidXNlcm5hbWVcIl0nKS52YWwoKSwgcGFzc3dvcmR9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkZW1haWwudmFsKCRlbWFpbC52YWwoKS50b0xvY2FsZUxvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgdXNlckxvZ2luSGVhZGVyKF9mb3JtRGF0YSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBQdWJTdWIucHVibGlzaChDT05TVC5ldmVudHMuVVNFUl9MT0dHRUQsICdsb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2luc3RhZ3JhbS1pbnRlZ3JhdGlvbi9pbnN0YWdyYW0tYWNjb3VudHMuaHRtbCc7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbG9nT3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29va2llU3RvcmFnZS5yZW1vdmUoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbik7XHJcbiAgICAgICAgUHViU3ViLnB1Ymxpc2goQ09OU1QuZXZlbnRzLlVTRVJfTE9HT1VUKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNvbnN0ICRzaG93TG9naW5Cb3hCdG5JZCA9ICQoX3Nob3dMb2dpbkJveEJ0bklkKTtcclxuICAgICAgICBjb25zdCAkbG9naW5Cb3ggPSAkKF9sb2dpbkJveCk7XHJcbiAgICAgICAgY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAgICAgY29uc3QgY2xvc2VDbGFzcyA9ICdkLW5vbmUnO1xyXG5cclxuICAgICAgICAvLyAkc2hvd0xvZ2luQm94QnRuSWQub24oJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIC8vICAgICBpZiAoIXNlbGVjdG9yQ3NzLmlzTG9naW5JbnN0YWdyYW0pIHtcclxuICAgICAgICAvLyAgICAgICAgICRsb2dpbkJveC5jc3Moeyd0b3AnOiAwLCAncmlnaHQnOiAwfSlcclxuICAgICAgICAvLyAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2JnLWxpZ2h0IGJvcmRlciBtdC01IG14LWF1dG8gcG9zaXRpb24tYWJzb2x1dGUnKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vICAgICAkbG9naW5Cb3guYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgICBjb25zdCAkYnV0dG9uU3VibWl0ID0gJChfYnV0dG9uU3VibWl0SWQpLFxyXG4gICAgICAgICAgICBjc3NWYWxpZGF0aW9uQ2xhc3MgPSAnZm9ybS12YWxpZGF0aW9uJztcclxuXHJcbiAgICAgICAgJGJ1dHRvblN1Ym1pdC5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm0gPSAkZm9ybS5nZXQoMCk7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoJGZvcm0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2aWV3VXRpbHMsIHZpZXdVdGlscy5pc0VtYWlsKCRlbWFpbC52YWwoKSkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZvcm0uY2hlY2tWYWxpZGl0eSgpICYmIHZpZXdVdGlscy5pc0VtYWlsKCRlbWFpbC52YWwoKSkpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEZvcm0oKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEhpZ2hsaWdodCBlcnJvcnNcclxuICAgICAgICAgICAgICAgIGlmIChmb3JtLnJlcG9ydFZhbGlkaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5yZXBvcnRWYWxpZGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJGZvcm0uYWRkQ2xhc3MoY3NzVmFsaWRhdGlvbkNsYXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcubmF2LWxpbmsuanNfbG9nT3V0Jykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBsb2dPdXQoKTtcclxuICAgICAgICAgICAgJChlLnRhcmdldCkucGFyZW50KCkuaGlkZSgpO1xyXG4gICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCR0ZXh0QXJlYURlc2NyaXB0aW9uLCAnTG9nZ2VkIG91dCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBQdWJTdWIuc3Vic2NyaWJlKENPTlNULmV2ZW50cy5VU0VSX0xPR09VVCwgKG1zZykgPT4ge1xyXG4gICAgICAgICAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlck5hdkxvZ2luQnRuKS5hZGRDbGFzcyhvcGVuZWRDbGFzcykucmVtb3ZlQ2xhc3MoY2xvc2VDbGFzcyk7IC8vIC5zaG93KCk7XHJcbiAgICAgICAgICAgICQoQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyUmVnQnRuKS5hZGRDbGFzcyhvcGVuZWRDbGFzcykucmVtb3ZlQ2xhc3MoY2xvc2VDbGFzcyk7XHJcbiAgICAgICAgICAgICQoJy5uYXYtbGluay5qc19sb2dPdXQnKS5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7IC8vIC5oaWRlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdG9yTG9naW5TdGF0ZSA9ICcuanNfbWVzc2FnZV9sb2dnZWQtLXRleHQnO1xyXG4gICAgICAgICAgICAkKHNlbGVjdG9yTG9naW5TdGF0ZSkudGV4dCgn0JLRiyDQstGL0YjQu9C4INC40Lcg0LDQutC60LDRg9C90YLQsCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXNMb2dpbkJ0bkNsaWNrID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ25hdi5uYXZiYXInKS5maW5kKCRsb2dpbkJveCkubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBpc0FkZEluc3RhZ3JhbUJ0bkNsaWNrZWQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignaWQnKSA9PT0gQ09OU1QudWlTZWxlY3RvcnMuaW5zdGFncmFtLmFkZEFjY291bnRCdG5JZDtcclxuXHJcbiAgICAgICAgICAgIGlmICghaXNMb2dpbkJ0bkNsaWNrICYmICRsb2dpbkJveC5oYXNDbGFzcyhvcGVuZWRDbGFzcykgJiYgIWlzQWRkSW5zdGFncmFtQnRuQ2xpY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgJGxvZ2luQm94LmFkZENsYXNzKGNsb3NlQ2xhc3MpLnJlbW92ZUNsYXNzKG9wZW5lZENsYXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgIGlmICgkKCcuYXV0aC5sb2dpbicpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBiaW5kRXZlbnRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdFxyXG4gICAgfTtcclxufVxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvcGFnZXMvX2F1dGgvbG9naW4tcGFnZS5qcyIsIi8qIGVzbGludC1kaXNhYmxlIHNvcnQtdmFycyAqL1xyXG4vLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbi8vIGltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG5pbXBvcnQgdmlld1V0aWxzIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy92aWV3JztcclxuLy8gaW1wb3J0IHtDT05TVH0gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2NvbnN0cyc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gSW5zdGFncmFtKHNlbGVjdG9yQ1NTID0ge30pIHtcclxuICAgIGNvbnN0ICRidXR0b25TdWJtaXQgPSAkKCcjanNfaW5zdGFncmFtLWdldC1hY2NvdW50cy0tYnRuJyk7XHJcbiAgICBjb25zdCB1c2VyID0gVXNlciwgLy8gc2VydmljZVxyXG4gICAgICAgICRsaXN0ID0gJCgnLmluc3RhZ3JhbS1hY2NvdW50cy1saXN0Jyk7XHJcblxyXG4gICAgY29uc3Qgc3VibWl0Rm9ybSA9IGZ1bmN0aW9uKGZvcm1EYXRhT2JqKSB7XHJcbiAgICAgICAgaWYgKCRidXR0b25TdWJtaXQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHVzZXIuZ2V0SW5zdGFncmFtQWNjb3VudCgpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuZmlsbExpc3QoJGxpc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhLmFjY291bnRzIHx8ICdMb2dpbiBlcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnZXRJbnN0YWdyYW1BY2NvdW50ICcsICRidXR0b25TdWJtaXQpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBiaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJGJ1dHRvblN1Ym1pdC5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHN1Ym1pdEZvcm0oKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICBiaW5kRXZlbnRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0XHJcbiAgICB9O1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9wYWdlcy9faW5zdGFncmFtL2luc3RhZ3JhbS5qcyIsIi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvYmFzZS5zY3NzXG4vLyBtb2R1bGUgaWQgPSAxOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyBGaW5lIFVwbG9hZGVyIDUuMTYuMiAtIE1JVCBsaWNlbnNlZC4gaHR0cDovL2ZpbmV1cGxvYWRlci5jb21cbihmdW5jdGlvbihnbG9iYWwpIHtcbiAgICB2YXIgcXEgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXR0YWNoOiBmdW5jdGlvbih0eXBlLCBmbikge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGZuLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoXCJvblwiICsgdHlwZSwgZm4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGVsZW1lbnQpLmRldGFjaCh0eXBlLCBmbik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXRhY2g6IGZ1bmN0aW9uKHR5cGUsIGZuKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgZm4sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kZXRhY2hFdmVudChcIm9uXCIgKyB0eXBlLCBmbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRhaW5zOiBmdW5jdGlvbihkZXNjZW5kYW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFkZXNjZW5kYW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT09IGRlc2NlbmRhbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNvbnRhaW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmNvbnRhaW5zKGRlc2NlbmRhbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhIShkZXNjZW5kYW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGVsZW1lbnQpICYgOCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluc2VydEJlZm9yZTogZnVuY3Rpb24oZWxlbWVudEIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Qi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtZW50LCBlbGVtZW50Qik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3NzOiBmdW5jdGlvbihzdHlsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5zdHlsZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihcIkNhbid0IGFwcGx5IHN0eWxlIHRvIG5vZGUgYXMgaXQgaXMgbm90IG9uIHRoZSBIVE1MRWxlbWVudCBwcm90b3R5cGUgY2hhaW4hXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc3R5bGVzLm9wYWNpdHkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQuc3R5bGUub3BhY2l0eSAhPT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgZWxlbWVudC5maWx0ZXJzICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXMuZmlsdGVyID0gXCJhbHBoYShvcGFjaXR5PVwiICsgTWF0aC5yb3VuZCgxMDAgKiBzdHlsZXMub3BhY2l0eSkgKyBcIilcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5leHRlbmQoZWxlbWVudC5zdHlsZSwgc3R5bGVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNDbGFzczogZnVuY3Rpb24obmFtZSwgY29uc2lkZXJQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKF58IClcIiArIG5hbWUgKyBcIiggfCQpXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZS50ZXN0KGVsZW1lbnQuY2xhc3NOYW1lKSB8fCAhIShjb25zaWRlclBhcmVudCAmJiByZS50ZXN0KGVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc05hbWUpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRDbGFzczogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICAgICAgICAgIGlmICghcXEoZWxlbWVudCkuaGFzQ2xhc3MobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gXCIgXCIgKyBuYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVDbGFzczogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAoXCIoXnwgKVwiICsgbmFtZSArIFwiKCB8JClcIik7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBlbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKHJlLCBcIiBcIikucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QnlDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lLCBmaXJzdCkge1xuICAgICAgICAgICAgICAgIHZhciBjYW5kaWRhdGVzLCByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoZmlyc3QgJiYgZWxlbWVudC5xdWVyeVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuXCIgKyBjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuXCIgKyBjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYW5kaWRhdGVzID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIik7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChjYW5kaWRhdGVzLCBmdW5jdGlvbihpZHgsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEodmFsKS5oYXNDbGFzcyhjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0ID8gcmVzdWx0WzBdIDogcmVzdWx0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpcnN0QnlDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsZW1lbnQpLmdldEJ5Q2xhc3MoY2xhc3NOYW1lLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjaGlsZHJlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gW10sIGNoaWxkID0gZWxlbWVudC5maXJzdENoaWxkO1xuICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gY2hpbGQubmV4dFNpYmxpbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRUZXh0OiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lclRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsZW1lbnQpLnNldFRleHQoXCJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyVmFsO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuaGFzQXR0cmlidXRlKGF0dHJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAvXmZhbHNlJC9pLmV4ZWMoZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0ck5hbWUpKSA9PSBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJWYWwgPSBlbGVtZW50W2F0dHJOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJWYWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAvXmZhbHNlJC9pLmV4ZWMoYXR0clZhbCkgPT0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS5jYW52YXNUb0Jsb2IgPSBmdW5jdGlvbihjYW52YXMsIG1pbWUsIHF1YWxpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5kYXRhVXJpVG9CbG9iKGNhbnZhcy50b0RhdGFVUkwobWltZSwgcXVhbGl0eSkpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5kYXRhVXJpVG9CbG9iID0gZnVuY3Rpb24oZGF0YVVyaSkge1xuICAgICAgICAgICAgdmFyIGFycmF5QnVmZmVyLCBieXRlU3RyaW5nLCBjcmVhdGVCbG9iID0gZnVuY3Rpb24oZGF0YSwgbWltZSkge1xuICAgICAgICAgICAgICAgIHZhciBCbG9iQnVpbGRlciA9IHdpbmRvdy5CbG9iQnVpbGRlciB8fCB3aW5kb3cuV2ViS2l0QmxvYkJ1aWxkZXIgfHwgd2luZG93Lk1vekJsb2JCdWlsZGVyIHx8IHdpbmRvdy5NU0Jsb2JCdWlsZGVyLCBibG9iQnVpbGRlciA9IEJsb2JCdWlsZGVyICYmIG5ldyBCbG9iQnVpbGRlcigpO1xuICAgICAgICAgICAgICAgIGlmIChibG9iQnVpbGRlcikge1xuICAgICAgICAgICAgICAgICAgICBibG9iQnVpbGRlci5hcHBlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBibG9iQnVpbGRlci5nZXRCbG9iKG1pbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYihbIGRhdGEgXSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbWltZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBpbnRBcnJheSwgbWltZVN0cmluZztcbiAgICAgICAgICAgIGlmIChkYXRhVXJpLnNwbGl0KFwiLFwiKVswXS5pbmRleE9mKFwiYmFzZTY0XCIpID49IDApIHtcbiAgICAgICAgICAgICAgICBieXRlU3RyaW5nID0gYXRvYihkYXRhVXJpLnNwbGl0KFwiLFwiKVsxXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ5dGVTdHJpbmcgPSBkZWNvZGVVUkkoZGF0YVVyaS5zcGxpdChcIixcIilbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWltZVN0cmluZyA9IGRhdGFVcmkuc3BsaXQoXCIsXCIpWzBdLnNwbGl0KFwiOlwiKVsxXS5zcGxpdChcIjtcIilbMF07XG4gICAgICAgICAgICBhcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyaW5nLmxlbmd0aCk7XG4gICAgICAgICAgICBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcbiAgICAgICAgICAgIHFxLmVhY2goYnl0ZVN0cmluZywgZnVuY3Rpb24oaWR4LCBjaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgICAgICBpbnRBcnJheVtpZHhdID0gY2hhcmFjdGVyLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVCbG9iKGFycmF5QnVmZmVyLCBtaW1lU3RyaW5nKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEubG9nID0gZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuY29uc29sZSkge1xuICAgICAgICAgICAgICAgIGlmICghbGV2ZWwgfHwgbGV2ZWwgPT09IFwiaW5mb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvbnNvbGVbbGV2ZWxdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZVtsZXZlbF0obWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2coXCI8XCIgKyBsZXZlbCArIFwiPiBcIiArIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5pc09iamVjdCA9IGZ1bmN0aW9uKHZhcmlhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFyaWFibGUgJiYgIXZhcmlhYmxlLm5vZGVUeXBlICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YXJpYWJsZSkgPT09IFwiW29iamVjdCBPYmplY3RdXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRnVuY3Rpb24gPSBmdW5jdGlvbih2YXJpYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB2YXJpYWJsZSA9PT0gXCJmdW5jdGlvblwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0FycmF5ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSBcIltvYmplY3QgQXJyYXldXCIgfHwgdmFsdWUgJiYgd2luZG93LkFycmF5QnVmZmVyICYmIHZhbHVlLmJ1ZmZlciAmJiB2YWx1ZS5idWZmZXIuY29uc3RydWN0b3IgPT09IEFycmF5QnVmZmVyO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0l0ZW1MaXN0ID0gZnVuY3Rpb24obWF5YmVJdGVtTGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZUl0ZW1MaXN0KSA9PT0gXCJbb2JqZWN0IERhdGFUcmFuc2Zlckl0ZW1MaXN0XVwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc05vZGVMaXN0ID0gZnVuY3Rpb24obWF5YmVOb2RlTGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZU5vZGVMaXN0KSA9PT0gXCJbb2JqZWN0IE5vZGVMaXN0XVwiIHx8IG1heWJlTm9kZUxpc3QuaXRlbSAmJiBtYXliZU5vZGVMaXN0Lm5hbWVkSXRlbTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNTdHJpbmcgPSBmdW5jdGlvbihtYXliZVN0cmluZykge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZVN0cmluZykgPT09IFwiW29iamVjdCBTdHJpbmddXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLnRyaW1TdHIgPSBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLnRyaW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLnRyaW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmZvcm1hdCA9IGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBuZXdTdHIgPSBzdHIsIG5leHRJZHhUb1JlcGxhY2UgPSBuZXdTdHIuaW5kZXhPZihcInt9XCIpO1xuICAgICAgICAgICAgcXEuZWFjaChhcmdzLCBmdW5jdGlvbihpZHgsIHZhbCkge1xuICAgICAgICAgICAgICAgIHZhciBzdHJCZWZvcmUgPSBuZXdTdHIuc3Vic3RyaW5nKDAsIG5leHRJZHhUb1JlcGxhY2UpLCBzdHJBZnRlciA9IG5ld1N0ci5zdWJzdHJpbmcobmV4dElkeFRvUmVwbGFjZSArIDIpO1xuICAgICAgICAgICAgICAgIG5ld1N0ciA9IHN0ckJlZm9yZSArIHZhbCArIHN0ckFmdGVyO1xuICAgICAgICAgICAgICAgIG5leHRJZHhUb1JlcGxhY2UgPSBuZXdTdHIuaW5kZXhPZihcInt9XCIsIG5leHRJZHhUb1JlcGxhY2UgKyB2YWwubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dElkeFRvUmVwbGFjZSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ld1N0cjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGaWxlID0gZnVuY3Rpb24obWF5YmVGaWxlKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LkZpbGUgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlRmlsZSkgPT09IFwiW29iamVjdCBGaWxlXVwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0ZpbGVMaXN0ID0gZnVuY3Rpb24obWF5YmVGaWxlTGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5GaWxlTGlzdCAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVGaWxlTGlzdCkgPT09IFwiW29iamVjdCBGaWxlTGlzdF1cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGaWxlT3JJbnB1dCA9IGZ1bmN0aW9uKG1heWJlRmlsZU9ySW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pc0ZpbGUobWF5YmVGaWxlT3JJbnB1dCkgfHwgcXEuaXNJbnB1dChtYXliZUZpbGVPcklucHV0KTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNJbnB1dCA9IGZ1bmN0aW9uKG1heWJlSW5wdXQsIG5vdEZpbGUpIHtcbiAgICAgICAgICAgIHZhciBldmFsdWF0ZVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRUeXBlID0gdHlwZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGlmIChub3RGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVkVHlwZSAhPT0gXCJmaWxlXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVkVHlwZSA9PT0gXCJmaWxlXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5IVE1MSW5wdXRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZUlucHV0KSA9PT0gXCJbb2JqZWN0IEhUTUxJbnB1dEVsZW1lbnRdXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heWJlSW5wdXQudHlwZSAmJiBldmFsdWF0ZVR5cGUobWF5YmVJbnB1dC50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF5YmVJbnB1dC50YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1heWJlSW5wdXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heWJlSW5wdXQudHlwZSAmJiBldmFsdWF0ZVR5cGUobWF5YmVJbnB1dC50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzQmxvYiA9IGZ1bmN0aW9uKG1heWJlQmxvYikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5CbG9iICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZUJsb2IpID09PSBcIltvYmplY3QgQmxvYl1cIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5pc1hoclVwbG9hZFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgaW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0Lm11bHRpcGxlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIEZpbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIEZvcm1EYXRhICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBxcS5jcmVhdGVYaHJJbnN0YW5jZSgpLnVwbG9hZCAhPT0gXCJ1bmRlZmluZWRcIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuY3JlYXRlWGhySW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdChcIk1TWE1MMi5YTUxIVFRQLjMuMFwiKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcXEubG9nKFwiTmVpdGhlciBYSFIgb3IgQWN0aXZlWCBhcmUgc3VwcG9ydGVkIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5pc0ZvbGRlckRyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbihkYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhVHJhbnNmZXIuaXRlbXMgJiYgZGF0YVRyYW5zZmVyLml0ZW1zLmxlbmd0aCA+IDAgJiYgZGF0YVRyYW5zZmVyLml0ZW1zWzBdLndlYmtpdEdldEFzRW50cnk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRmlsZUNodW5raW5nU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gIXFxLmFuZHJvaWRTdG9jaygpICYmIHFxLmlzWGhyVXBsb2FkU3VwcG9ydGVkKCkgJiYgKEZpbGUucHJvdG90eXBlLnNsaWNlICE9PSB1bmRlZmluZWQgfHwgRmlsZS5wcm90b3R5cGUud2Via2l0U2xpY2UgIT09IHVuZGVmaW5lZCB8fCBGaWxlLnByb3RvdHlwZS5tb3pTbGljZSAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuc2xpY2VCbG9iID0gZnVuY3Rpb24oZmlsZU9yQmxvYiwgc3RhcnQsIGVuZCkge1xuICAgICAgICAgICAgdmFyIHNsaWNlciA9IGZpbGVPckJsb2Iuc2xpY2UgfHwgZmlsZU9yQmxvYi5tb3pTbGljZSB8fCBmaWxlT3JCbG9iLndlYmtpdFNsaWNlO1xuICAgICAgICAgICAgcmV0dXJuIHNsaWNlci5jYWxsKGZpbGVPckJsb2IsIHN0YXJ0LCBlbmQpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5hcnJheUJ1ZmZlclRvSGV4ID0gZnVuY3Rpb24oYnVmZmVyKSB7XG4gICAgICAgICAgICB2YXIgYnl0ZXNBc0hleCA9IFwiXCIsIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgICAgICAgICAgIHFxLmVhY2goYnl0ZXMsIGZ1bmN0aW9uKGlkeCwgYnl0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ5dGVBc0hleFN0ciA9IGJ5dC50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgaWYgKGJ5dGVBc0hleFN0ci5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ5dGVBc0hleFN0ciA9IFwiMFwiICsgYnl0ZUFzSGV4U3RyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBieXRlc0FzSGV4ICs9IGJ5dGVBc0hleFN0cjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGJ5dGVzQXNIZXg7XG4gICAgICAgIH07XG4gICAgICAgIHFxLnJlYWRCbG9iVG9IZXggPSBmdW5jdGlvbihibG9iLCBzdGFydE9mZnNldCwgbGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgaW5pdGlhbEJsb2IgPSBxcS5zbGljZUJsb2IoYmxvYiwgc3RhcnRPZmZzZXQsIHN0YXJ0T2Zmc2V0ICsgbGVuZ3RoKSwgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCksIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MocXEuYXJyYXlCdWZmZXJUb0hleChmaWxlUmVhZGVyLnJlc3VsdCkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IHByb21pc2UuZmFpbHVyZTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoaW5pdGlhbEJsb2IpO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCA9IGZ1bmN0aW9uKGZpcnN0LCBzZWNvbmQsIGV4dGVuZE5lc3RlZCkge1xuICAgICAgICAgICAgcXEuZWFjaChzZWNvbmQsIGZ1bmN0aW9uKHByb3AsIHZhbCkge1xuICAgICAgICAgICAgICAgIGlmIChleHRlbmROZXN0ZWQgJiYgcXEuaXNPYmplY3QodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RbcHJvcF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RbcHJvcF0gPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQoZmlyc3RbcHJvcF0sIHZhbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RbcHJvcF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZmlyc3Q7XG4gICAgICAgIH07XG4gICAgICAgIHFxLm92ZXJyaWRlID0gZnVuY3Rpb24odGFyZ2V0LCBzb3VyY2VGbikge1xuICAgICAgICAgICAgdmFyIHN1cGVyXyA9IHt9LCBzb3VyY2UgPSBzb3VyY2VGbihzdXBlcl8pO1xuICAgICAgICAgICAgcXEuZWFjaChzb3VyY2UsIGZ1bmN0aW9uKHNyY1Byb3BOYW1lLCBzcmNQcm9wVmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFtzcmNQcm9wTmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzdXBlcl9bc3JjUHJvcE5hbWVdID0gdGFyZ2V0W3NyY1Byb3BOYW1lXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFyZ2V0W3NyY1Byb3BOYW1lXSA9IHNyY1Byb3BWYWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmluZGV4T2YgPSBmdW5jdGlvbihhcnIsIGVsdCwgZnJvbSkge1xuICAgICAgICAgICAgaWYgKGFyci5pbmRleE9mKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyci5pbmRleE9mKGVsdCwgZnJvbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmcm9tID0gZnJvbSB8fCAwO1xuICAgICAgICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoZnJvbSA8IDApIHtcbiAgICAgICAgICAgICAgICBmcm9tICs9IGxlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoO2Zyb20gPCBsZW47IGZyb20gKz0gMSkge1xuICAgICAgICAgICAgICAgIGlmIChhcnIuaGFzT3duUHJvcGVydHkoZnJvbSkgJiYgYXJyW2Zyb21dID09PSBlbHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZyb207XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5nZXRVbmlxdWVJZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLCB2ID0gYyA9PSBcInhcIiA/IHIgOiByICYgMyB8IDg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmllID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSAhPT0gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmllNyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUUgN1wiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmllOCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUUgOFwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmllMTAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFIDEwXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaWUxMSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmllKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwicnY6MTFcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5lZGdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiRWRnZVwiKSA+PSAwO1xuICAgICAgICB9O1xuICAgICAgICBxcS5zYWZhcmkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudmVuZG9yICE9PSB1bmRlZmluZWQgJiYgbmF2aWdhdG9yLnZlbmRvci5pbmRleE9mKFwiQXBwbGVcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5jaHJvbWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudmVuZG9yICE9PSB1bmRlZmluZWQgJiYgbmF2aWdhdG9yLnZlbmRvci5pbmRleE9mKFwiR29vZ2xlXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEub3BlcmEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudmVuZG9yICE9PSB1bmRlZmluZWQgJiYgbmF2aWdhdG9yLnZlbmRvci5pbmRleE9mKFwiT3BlcmFcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5maXJlZm94ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gIXFxLmVkZ2UoKSAmJiAhcXEuaWUxMSgpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1vemlsbGFcIikgIT09IC0xICYmIG5hdmlnYXRvci52ZW5kb3IgIT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IudmVuZG9yID09PSBcIlwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS53aW5kb3dzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnBsYXRmb3JtID09PSBcIldpbjMyXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmFuZHJvaWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImFuZHJvaWRcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5hbmRyb2lkU3RvY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5hbmRyb2lkKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJjaHJvbWVcIikgPCAwO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3M2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiIE9TIDZfXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zNyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIiBPUyA3X1wiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvczggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCIgT1MgOF9cIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3M4MDAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCIgT1MgOF8wIFwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcImlQYWRcIikgIT09IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcImlQb2RcIikgIT09IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcImlQaG9uZVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvc0Nocm9tZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkNyaU9TXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zU2FmYXJpID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgIXFxLmlvc0Nocm9tZSgpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlNhZmFyaVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvc1NhZmFyaVdlYlZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiAhcXEuaW9zQ2hyb21lKCkgJiYgIXFxLmlvc1NhZmFyaSgpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLnRvRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZGl2LmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICAgICAgZGl2LnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSgpO1xuICAgICAgICBxcS5lYWNoID0gZnVuY3Rpb24oaXRlcmFibGVJdGVtLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGtleU9ySW5kZXgsIHJldFZhbDtcbiAgICAgICAgICAgIGlmIChpdGVyYWJsZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LlN0b3JhZ2UgJiYgaXRlcmFibGVJdGVtLmNvbnN0cnVjdG9yID09PSB3aW5kb3cuU3RvcmFnZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGtleU9ySW5kZXggPSAwOyBrZXlPckluZGV4IDwgaXRlcmFibGVJdGVtLmxlbmd0aDsga2V5T3JJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBjYWxsYmFjayhpdGVyYWJsZUl0ZW0ua2V5KGtleU9ySW5kZXgpLCBpdGVyYWJsZUl0ZW0uZ2V0SXRlbShpdGVyYWJsZUl0ZW0ua2V5KGtleU9ySW5kZXgpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc0FycmF5KGl0ZXJhYmxlSXRlbSkgfHwgcXEuaXNJdGVtTGlzdChpdGVyYWJsZUl0ZW0pIHx8IHFxLmlzTm9kZUxpc3QoaXRlcmFibGVJdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGtleU9ySW5kZXggPSAwOyBrZXlPckluZGV4IDwgaXRlcmFibGVJdGVtLmxlbmd0aDsga2V5T3JJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBjYWxsYmFjayhrZXlPckluZGV4LCBpdGVyYWJsZUl0ZW1ba2V5T3JJbmRleF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNTdHJpbmcoaXRlcmFibGVJdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGtleU9ySW5kZXggPSAwOyBrZXlPckluZGV4IDwgaXRlcmFibGVJdGVtLmxlbmd0aDsga2V5T3JJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBjYWxsYmFjayhrZXlPckluZGV4LCBpdGVyYWJsZUl0ZW0uY2hhckF0KGtleU9ySW5kZXgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGtleU9ySW5kZXggaW4gaXRlcmFibGVJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGl0ZXJhYmxlSXRlbSwga2V5T3JJbmRleCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBjYWxsYmFjayhrZXlPckluZGV4LCBpdGVyYWJsZUl0ZW1ba2V5T3JJbmRleF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuYmluZCA9IGZ1bmN0aW9uKG9sZEZ1bmMsIGNvbnRleHQpIHtcbiAgICAgICAgICAgIGlmIChxcS5pc0Z1bmN0aW9uKG9sZEZ1bmMpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0FyZ3MgPSBxcS5leHRlbmQoW10sIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3QXJncyA9IG5ld0FyZ3MuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRGdW5jLmFwcGx5KGNvbnRleHQsIG5ld0FyZ3MpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJmaXJzdCBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uIVwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEub2JqMnVybCA9IGZ1bmN0aW9uKG9iaiwgdGVtcCwgcHJlZml4RG9uZSkge1xuICAgICAgICAgICAgdmFyIHVyaXN0cmluZ3MgPSBbXSwgcHJlZml4ID0gXCImXCIsIGFkZCA9IGZ1bmN0aW9uKG5leHRPYmosIGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFRlbXAgPSB0ZW1wID8gL1xcW1xcXSQvLnRlc3QodGVtcCkgPyB0ZW1wIDogdGVtcCArIFwiW1wiICsgaSArIFwiXVwiIDogaTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dFRlbXAgIT09IFwidW5kZWZpbmVkXCIgJiYgaSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICB1cmlzdHJpbmdzLnB1c2godHlwZW9mIG5leHRPYmogPT09IFwib2JqZWN0XCIgPyBxcS5vYmoydXJsKG5leHRPYmosIG5leHRUZW1wLCB0cnVlKSA6IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuZXh0T2JqKSA9PT0gXCJbb2JqZWN0IEZ1bmN0aW9uXVwiID8gZW5jb2RlVVJJQ29tcG9uZW50KG5leHRUZW1wKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG5leHRPYmooKSkgOiBlbmNvZGVVUklDb21wb25lbnQobmV4dFRlbXApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQobmV4dE9iaikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoIXByZWZpeERvbmUgJiYgdGVtcCkge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9IC9cXD8vLnRlc3QodGVtcCkgPyAvXFw/JC8udGVzdCh0ZW1wKSA/IFwiXCIgOiBcIiZcIiA6IFwiP1wiO1xuICAgICAgICAgICAgICAgIHVyaXN0cmluZ3MucHVzaCh0ZW1wKTtcbiAgICAgICAgICAgICAgICB1cmlzdHJpbmdzLnB1c2gocXEub2JqMnVybChvYmopKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09IFwiW29iamVjdCBBcnJheV1cIiAmJiB0eXBlb2Ygb2JqICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChvYmosIGZ1bmN0aW9uKGlkeCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZCh2YWwsIGlkeCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmogIT09IFwidW5kZWZpbmVkXCIgJiYgb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKG9iaiwgZnVuY3Rpb24ocHJvcCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZCh2YWwsIHByb3ApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB1cmlzdHJpbmdzLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHRlbXApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGVtcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmlzdHJpbmdzLmpvaW4ocHJlZml4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVyaXN0cmluZ3Muam9pbihwcmVmaXgpLnJlcGxhY2UoL14mLywgXCJcIikucmVwbGFjZSgvJTIwL2csIFwiK1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEub2JqMkZvcm1EYXRhID0gZnVuY3Rpb24ob2JqLCBmb3JtRGF0YSwgYXJyYXlLZXlOYW1lKSB7XG4gICAgICAgICAgICBpZiAoIWZvcm1EYXRhKSB7XG4gICAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHFxLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICAgICAgICAgIGtleSA9IGFycmF5S2V5TmFtZSA/IGFycmF5S2V5TmFtZSArIFwiW1wiICsga2V5ICsgXCJdXCIgOiBrZXk7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzT2JqZWN0KHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEub2JqMkZvcm1EYXRhKHZhbCwgZm9ybURhdGEsIGtleSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc0Z1bmN0aW9uKHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGtleSwgdmFsKCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChrZXksIHZhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZm9ybURhdGE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLm9iajJJbnB1dHMgPSBmdW5jdGlvbihvYmosIGZvcm0pIHtcbiAgICAgICAgICAgIHZhciBpbnB1dDtcbiAgICAgICAgICAgIGlmICghZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHFxLm9iajJGb3JtRGF0YShvYmosIHtcbiAgICAgICAgICAgICAgICBhcHBlbmQ6IGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIGtleSk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZvcm07XG4gICAgICAgIH07XG4gICAgICAgIHFxLnBhcnNlSnNvbiA9IGZ1bmN0aW9uKGpzb24pIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuSlNPTiAmJiBxcS5pc0Z1bmN0aW9uKEpTT04ucGFyc2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBldmFsKFwiKFwiICsganNvbiArIFwiKVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZ2V0RXh0ZW5zaW9uID0gZnVuY3Rpb24oZmlsZW5hbWUpIHtcbiAgICAgICAgICAgIHZhciBleHRJZHggPSBmaWxlbmFtZS5sYXN0SW5kZXhPZihcIi5cIikgKyAxO1xuICAgICAgICAgICAgaWYgKGV4dElkeCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZW5hbWUuc3Vic3RyKGV4dElkeCwgZmlsZW5hbWUubGVuZ3RoIC0gZXh0SWR4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZ2V0RmlsZW5hbWUgPSBmdW5jdGlvbihibG9iT3JGaWxlSW5wdXQpIHtcbiAgICAgICAgICAgIGlmIChxcS5pc0lucHV0KGJsb2JPckZpbGVJbnB1dCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYk9yRmlsZUlucHV0LnZhbHVlLnJlcGxhY2UoLy4qKFxcL3xcXFxcKS8sIFwiXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc0ZpbGUoYmxvYk9yRmlsZUlucHV0KSkge1xuICAgICAgICAgICAgICAgIGlmIChibG9iT3JGaWxlSW5wdXQuZmlsZU5hbWUgIT09IG51bGwgJiYgYmxvYk9yRmlsZUlucHV0LmZpbGVOYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JPckZpbGVJbnB1dC5maWxlTmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYmxvYk9yRmlsZUlucHV0Lm5hbWU7XG4gICAgICAgIH07XG4gICAgICAgIHFxLkRpc3Bvc2VTdXBwb3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGlzcG9zZXJzID0gW107XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGlzcG9zZXI7XG4gICAgICAgICAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3Bvc2VyID0gZGlzcG9zZXJzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzcG9zZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwb3NlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChkaXNwb3Nlcik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhdHRhY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGREaXNwb3NlcihxcShhcmdzWzBdKS5hdHRhY2guYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWRkRGlzcG9zZXI6IGZ1bmN0aW9uKGRpc3Bvc2VGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBkaXNwb3NlcnMucHVzaChkaXNwb3NlRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfSkoKTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgICAgIGRlZmluZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHFxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2xvYmFsLnFxID0gcXE7XG4gICAgICAgIH1cbiAgICB9KSgpO1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLkVycm9yID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gXCJbRmluZSBVcGxvYWRlciBcIiArIHFxLnZlcnNpb24gKyBcIl0gXCIgKyBtZXNzYWdlO1xuICAgICAgICB9O1xuICAgICAgICBxcS5FcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcbiAgICB9KSgpO1xuICAgIHFxLnZlcnNpb24gPSBcIjUuMTYuMlwiO1xuICAgIHFxLnN1cHBvcnRlZEZlYXR1cmVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc3VwcG9ydHNVcGxvYWRpbmcsIHN1cHBvcnRzVXBsb2FkaW5nQmxvYnMsIHN1cHBvcnRzRmlsZURyb3AsIHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsIHN1cHBvcnRzRm9sZGVyRHJvcCwgc3VwcG9ydHNDaHVua2luZywgc3VwcG9ydHNSZXN1bWUsIHN1cHBvcnRzVXBsb2FkVmlhUGFzdGUsIHN1cHBvcnRzVXBsb2FkQ29ycywgc3VwcG9ydHNEZWxldGVGaWxlWGRyLCBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzWGhyLCBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzLCBzdXBwb3J0c0ZvbGRlclNlbGVjdGlvbiwgc3VwcG9ydHNJbWFnZVByZXZpZXdzLCBzdXBwb3J0c1VwbG9hZFByb2dyZXNzO1xuICAgICAgICBmdW5jdGlvbiB0ZXN0U3VwcG9ydHNGaWxlSW5wdXRFbGVtZW50KCkge1xuICAgICAgICAgICAgdmFyIHN1cHBvcnRlZCA9IHRydWUsIHRlbXBJbnB1dDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGVtcElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgICAgIHRlbXBJbnB1dC50eXBlID0gXCJmaWxlXCI7XG4gICAgICAgICAgICAgICAgcXEodGVtcElucHV0KS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRlbXBJbnB1dC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBzdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRlZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0Nocm9tZTE0T3JIaWdoZXIoKSB7XG4gICAgICAgICAgICByZXR1cm4gKHFxLmNocm9tZSgpIHx8IHFxLm9wZXJhKCkpICYmIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0Nocm9tZVxcL1sxXVs0LTldfENocm9tZVxcL1syLTldWzAtOV0vKSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ3Jvc3NPcmlnaW5YaHJTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHhociA9IHFxLmNyZWF0ZVhockluc3RhbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHhoci53aXRoQ3JlZGVudGlhbHMgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc1hkclN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuWERvbWFpblJlcXVlc3QgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0Nyb3NzT3JpZ2luQWpheFN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIGlmIChpc0Nyb3NzT3JpZ2luWGhyU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpc1hkclN1cHBvcnRlZCgpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzRm9sZGVyU2VsZWN0aW9uU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKS53ZWJraXRkaXJlY3RvcnkgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0xvY2FsU3RvcmFnZVN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhd2luZG93LmxvY2FsU3RvcmFnZSAmJiBxcS5pc0Z1bmN0aW9uKHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0RyYWdBbmREcm9wU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgICAgIHJldHVybiAoXCJkcmFnZ2FibGVcIiBpbiBzcGFuIHx8IFwib25kcmFnc3RhcnRcIiBpbiBzcGFuICYmIFwib25kcm9wXCIgaW4gc3BhbikgJiYgIXFxLmFuZHJvaWQoKSAmJiAhcXEuaW9zKCk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwcG9ydHNVcGxvYWRpbmcgPSB0ZXN0U3VwcG9ydHNGaWxlSW5wdXRFbGVtZW50KCk7XG4gICAgICAgIHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgPSBzdXBwb3J0c1VwbG9hZGluZyAmJiBxcS5pc1hoclVwbG9hZFN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c1VwbG9hZGluZ0Jsb2JzID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiAhcXEuYW5kcm9pZFN0b2NrKCk7XG4gICAgICAgIHN1cHBvcnRzRmlsZURyb3AgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmIGlzRHJhZ0FuZERyb3BTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNGb2xkZXJEcm9wID0gc3VwcG9ydHNGaWxlRHJvcCAmJiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgIGlucHV0LnR5cGUgPSBcImZpbGVcIjtcbiAgICAgICAgICAgIHJldHVybiAhIShcIndlYmtpdGRpcmVjdG9yeVwiIGluIChpbnB1dCB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbdHlwZT1maWxlXVwiKVswXSkpO1xuICAgICAgICB9KCk7XG4gICAgICAgIHN1cHBvcnRzQ2h1bmtpbmcgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmIHFxLmlzRmlsZUNodW5raW5nU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzUmVzdW1lID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiBzdXBwb3J0c0NodW5raW5nICYmIGlzTG9jYWxTdG9yYWdlU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzVXBsb2FkVmlhUGFzdGUgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmIGlzQ2hyb21lMTRPckhpZ2hlcigpO1xuICAgICAgICBzdXBwb3J0c1VwbG9hZENvcnMgPSBzdXBwb3J0c1VwbG9hZGluZyAmJiAod2luZG93LnBvc3RNZXNzYWdlICE9PSB1bmRlZmluZWQgfHwgc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyk7XG4gICAgICAgIHN1cHBvcnRzRGVsZXRlRmlsZUNvcnNYaHIgPSBpc0Nyb3NzT3JpZ2luWGhyU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzRGVsZXRlRmlsZVhkciA9IGlzWGRyU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzRGVsZXRlRmlsZUNvcnMgPSBpc0Nyb3NzT3JpZ2luQWpheFN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c0ZvbGRlclNlbGVjdGlvbiA9IGlzRm9sZGVyU2VsZWN0aW9uU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzSW1hZ2VQcmV2aWV3cyA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgd2luZG93LkZpbGVSZWFkZXIgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgc3VwcG9ydHNVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIXFxLmFuZHJvaWRTdG9jaygpICYmICFxcS5pb3NDaHJvbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWpheFVwbG9hZGluZzogc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyxcbiAgICAgICAgICAgIGJsb2JVcGxvYWRpbmc6IHN1cHBvcnRzVXBsb2FkaW5nQmxvYnMsXG4gICAgICAgICAgICBjYW5EZXRlcm1pbmVTaXplOiBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLFxuICAgICAgICAgICAgY2h1bmtpbmc6IHN1cHBvcnRzQ2h1bmtpbmcsXG4gICAgICAgICAgICBkZWxldGVGaWxlQ29yczogc3VwcG9ydHNEZWxldGVGaWxlQ29ycyxcbiAgICAgICAgICAgIGRlbGV0ZUZpbGVDb3JzWGRyOiBzdXBwb3J0c0RlbGV0ZUZpbGVYZHIsXG4gICAgICAgICAgICBkZWxldGVGaWxlQ29yc1hocjogc3VwcG9ydHNEZWxldGVGaWxlQ29yc1hocixcbiAgICAgICAgICAgIGRpYWxvZ0VsZW1lbnQ6ICEhd2luZG93LkhUTUxEaWFsb2dFbGVtZW50LFxuICAgICAgICAgICAgZmlsZURyb3A6IHN1cHBvcnRzRmlsZURyb3AsXG4gICAgICAgICAgICBmb2xkZXJEcm9wOiBzdXBwb3J0c0ZvbGRlckRyb3AsXG4gICAgICAgICAgICBmb2xkZXJTZWxlY3Rpb246IHN1cHBvcnRzRm9sZGVyU2VsZWN0aW9uLFxuICAgICAgICAgICAgaW1hZ2VQcmV2aWV3czogc3VwcG9ydHNJbWFnZVByZXZpZXdzLFxuICAgICAgICAgICAgaW1hZ2VWYWxpZGF0aW9uOiBzdXBwb3J0c0ltYWdlUHJldmlld3MsXG4gICAgICAgICAgICBpdGVtU2l6ZVZhbGlkYXRpb246IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsXG4gICAgICAgICAgICBwYXVzZTogc3VwcG9ydHNDaHVua2luZyxcbiAgICAgICAgICAgIHByb2dyZXNzQmFyOiBzdXBwb3J0c1VwbG9hZFByb2dyZXNzLFxuICAgICAgICAgICAgcmVzdW1lOiBzdXBwb3J0c1Jlc3VtZSxcbiAgICAgICAgICAgIHNjYWxpbmc6IHN1cHBvcnRzSW1hZ2VQcmV2aWV3cyAmJiBzdXBwb3J0c1VwbG9hZGluZ0Jsb2JzLFxuICAgICAgICAgICAgdGlmZlByZXZpZXdzOiBxcS5zYWZhcmkoKSxcbiAgICAgICAgICAgIHVubGltaXRlZFNjYWxlZEltYWdlU2l6ZTogIXFxLmlvcygpLFxuICAgICAgICAgICAgdXBsb2FkaW5nOiBzdXBwb3J0c1VwbG9hZGluZyxcbiAgICAgICAgICAgIHVwbG9hZENvcnM6IHN1cHBvcnRzVXBsb2FkQ29ycyxcbiAgICAgICAgICAgIHVwbG9hZEN1c3RvbUhlYWRlcnM6IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsXG4gICAgICAgICAgICB1cGxvYWROb25NdWx0aXBhcnQ6IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsXG4gICAgICAgICAgICB1cGxvYWRWaWFQYXN0ZTogc3VwcG9ydHNVcGxvYWRWaWFQYXN0ZVxuICAgICAgICB9O1xuICAgIH0oKTtcbiAgICBxcS5pc0dlbmVyaWNQcm9taXNlID0gZnVuY3Rpb24obWF5YmVQcm9taXNlKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICByZXR1cm4gISEobWF5YmVQcm9taXNlICYmIG1heWJlUHJvbWlzZS50aGVuICYmIHFxLmlzRnVuY3Rpb24obWF5YmVQcm9taXNlLnRoZW4pKTtcbiAgICB9O1xuICAgIHFxLlByb21pc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzdWNjZXNzQXJncywgZmFpbHVyZUFyZ3MsIHN1Y2Nlc3NDYWxsYmFja3MgPSBbXSwgZmFpbHVyZUNhbGxiYWNrcyA9IFtdLCBkb25lQ2FsbGJhY2tzID0gW10sIHN0YXRlID0gMDtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHRoZW46IGZ1bmN0aW9uKG9uU3VjY2Vzcywgb25GYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvblN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFja3MucHVzaChvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvbkZhaWx1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVDYWxsYmFja3MucHVzaChvbkZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlICYmIG9uRmFpbHVyZS5hcHBseShudWxsLCBmYWlsdXJlQXJncyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvblN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzLmFwcGx5KG51bGwsIHN1Y2Nlc3NBcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZG9uZTogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZUNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBmYWlsdXJlQXJncyA9PT0gdW5kZWZpbmVkID8gc3VjY2Vzc0FyZ3MgOiBmYWlsdXJlQXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHN0YXRlID0gMTtcbiAgICAgICAgICAgICAgICBzdWNjZXNzQXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc0NhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChzdWNjZXNzQ2FsbGJhY2tzLCBmdW5jdGlvbihpZHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBzdWNjZXNzQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZG9uZUNhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkb25lQ2FsbGJhY2tzLCBmdW5jdGlvbihpZHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBzdWNjZXNzQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsdXJlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IC0xO1xuICAgICAgICAgICAgICAgIGZhaWx1cmVBcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlQ2FsbGJhY2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGZhaWx1cmVDYWxsYmFja3MsIGZ1bmN0aW9uKGlkeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGZhaWx1cmVBcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkb25lQ2FsbGJhY2tzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRvbmVDYWxsYmFja3MsIGZ1bmN0aW9uKGlkeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGZhaWx1cmVBcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLkJsb2JQcm94eSA9IGZ1bmN0aW9uKHJlZmVyZW5jZUJsb2IsIG9uQ3JlYXRlKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcmVmZXJlbmNlQmxvYjogcmVmZXJlbmNlQmxvYixcbiAgICAgICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9uQ3JlYXRlKHJlZmVyZW5jZUJsb2IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlVwbG9hZEJ1dHRvbiA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcywgZGlzcG9zZVN1cHBvcnQgPSBuZXcgcXEuRGlzcG9zZVN1cHBvcnQoKSwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGFjY2VwdEZpbGVzOiBudWxsLFxuICAgICAgICAgICAgZWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgIGZvY3VzQ2xhc3M6IFwicXEtdXBsb2FkLWJ1dHRvbi1mb2N1c1wiLFxuICAgICAgICAgICAgZm9sZGVyczogZmFsc2UsXG4gICAgICAgICAgICBob3ZlckNsYXNzOiBcInFxLXVwbG9hZC1idXR0b24taG92ZXJcIixcbiAgICAgICAgICAgIGlvczhCcm93c2VyQ3Jhc2hXb3JrYXJvdW5kOiBmYWxzZSxcbiAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZSxcbiAgICAgICAgICAgIG5hbWU6IFwicXFmaWxlXCIsXG4gICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24oaW5wdXQpIHt9LFxuICAgICAgICAgICAgdGl0bGU6IG51bGxcbiAgICAgICAgfSwgaW5wdXQsIGJ1dHRvbklkO1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIGJ1dHRvbklkID0gcXEuZ2V0VW5pcXVlSWQoKTtcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSW5wdXQoKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUocXEuVXBsb2FkQnV0dG9uLkJVVFRPTl9JRF9BVFRSX05BTUUsIGJ1dHRvbklkKTtcbiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIG9wdGlvbnMudGl0bGUpO1xuICAgICAgICAgICAgc2VsZi5zZXRNdWx0aXBsZShvcHRpb25zLm11bHRpcGxlLCBpbnB1dCk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb2xkZXJzICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmZvbGRlclNlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIndlYmtpdGRpcmVjdG9yeVwiLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmFjY2VwdEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwiYWNjZXB0XCIsIG9wdGlvbnMuYWNjZXB0RmlsZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImZpbGVcIik7XG4gICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIG9wdGlvbnMubmFtZSk7XG4gICAgICAgICAgICBxcShpbnB1dCkuY3NzKHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBcIkFyaWFsXCIsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IHFxLmllKCkgJiYgIXFxLmllOCgpID8gXCIzNTAwcHhcIiA6IFwiMTE4cHhcIixcbiAgICAgICAgICAgICAgICBtYXJnaW46IDAsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgICAgICBjdXJzb3I6IFwicG9pbnRlclwiLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIXFxLmllNygpICYmIHFxKGlucHV0KS5jc3Moe1xuICAgICAgICAgICAgICAgIGhlaWdodDogXCIxMDAlXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb3B0aW9ucy5lbGVtZW50LmFwcGVuZENoaWxkKGlucHV0KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChpbnB1dCwgXCJjaGFuZ2VcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vbkNoYW5nZShpbnB1dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChpbnB1dCwgXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5hZGRDbGFzcyhvcHRpb25zLmhvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goaW5wdXQsIFwibW91c2VvdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5yZW1vdmVDbGFzcyhvcHRpb25zLmhvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goaW5wdXQsIFwiZm9jdXNcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5hZGRDbGFzcyhvcHRpb25zLmZvY3VzQ2xhc3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goaW5wdXQsIFwiYmx1clwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLnJlbW92ZUNsYXNzKG9wdGlvbnMuZm9jdXNDbGFzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgfVxuICAgICAgICBxcShvcHRpb25zLmVsZW1lbnQpLmNzcyh7XG4gICAgICAgICAgICBwb3NpdGlvbjogXCJyZWxhdGl2ZVwiLFxuICAgICAgICAgICAgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICBkaXJlY3Rpb246IFwibHRyXCJcbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBnZXRJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEJ1dHRvbklkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0TXVsdGlwbGU6IGZ1bmN0aW9uKGlzTXVsdGlwbGUsIG9wdElucHV0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gb3B0SW5wdXQgfHwgdGhpcy5nZXRJbnB1dCgpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmlvczhCcm93c2VyQ3Jhc2hXb3JrYXJvdW5kICYmIHFxLmlvczgoKSAmJiAocXEuaW9zQ2hyb21lKCkgfHwgcXEuaW9zU2FmYXJpV2ViVmlldygpKSkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtdWx0aXBsZVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNNdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwibXVsdGlwbGVcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5yZW1vdmVBdHRyaWJ1dGUoXCJtdWx0aXBsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRBY2NlcHRGaWxlczogZnVuY3Rpb24oYWNjZXB0RmlsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWNjZXB0RmlsZXMgIT09IG9wdGlvbnMuYWNjZXB0RmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwiYWNjZXB0XCIsIGFjY2VwdEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGlucHV0KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5yZW1vdmVDbGFzcyhvcHRpb25zLmZvY3VzQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGlucHV0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpbnB1dCA9IGNyZWF0ZUlucHV0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpbnB1dCA9IGNyZWF0ZUlucHV0KCk7XG4gICAgfTtcbiAgICBxcS5VcGxvYWRCdXR0b24uQlVUVE9OX0lEX0FUVFJfTkFNRSA9IFwicXEtYnV0dG9uLWlkXCI7XG4gICAgcXEuVXBsb2FkRGF0YSA9IGZ1bmN0aW9uKHVwbG9hZGVyUHJveHkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkYXRhID0gW10sIGJ5VXVpZCA9IHt9LCBieVN0YXR1cyA9IHt9LCBieVByb3h5R3JvdXBJZCA9IHt9LCBieUJhdGNoSWQgPSB7fTtcbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YUJ5SWRzKGlkT3JJZHMpIHtcbiAgICAgICAgICAgIGlmIChxcS5pc0FycmF5KGlkT3JJZHMpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVudHJpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGlkT3JJZHMsIGZ1bmN0aW9uKGlkeCwgaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGRhdGFbaWRdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cmllcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkYXRhW2lkT3JJZHNdO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGFCeVV1aWRzKHV1aWRzKSB7XG4gICAgICAgICAgICBpZiAocXEuaXNBcnJheSh1dWlkcykpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW50cmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIHFxLmVhY2godXVpZHMsIGZ1bmN0aW9uKGlkeCwgdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goZGF0YVtieVV1aWRbdXVpZF1dKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cmllcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkYXRhW2J5VXVpZFt1dWlkc11dO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGFCeVN0YXR1cyhzdGF0dXMpIHtcbiAgICAgICAgICAgIHZhciBzdGF0dXNSZXN1bHRzID0gW10sIHN0YXR1c2VzID0gW10uY29uY2F0KHN0YXR1cyk7XG4gICAgICAgICAgICBxcS5lYWNoKHN0YXR1c2VzLCBmdW5jdGlvbihpbmRleCwgc3RhdHVzRW51bSkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXNSZXN1bHRJbmRleGVzID0gYnlTdGF0dXNbc3RhdHVzRW51bV07XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1c1Jlc3VsdEluZGV4ZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHN0YXR1c1Jlc3VsdEluZGV4ZXMsIGZ1bmN0aW9uKGksIGRhdGFJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzUmVzdWx0cy5wdXNoKGRhdGFbZGF0YUluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1Jlc3VsdHM7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGFkZEZpbGU6IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gc3BlYy5zdGF0dXMgfHwgcXEuc3RhdHVzLlNVQk1JVFRJTkcsIGlkID0gZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogc3BlYy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbE5hbWU6IHNwZWMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdXVpZDogc3BlYy51dWlkLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBzcGVjLnNpemUgPT0gbnVsbCA/IC0xIDogc3BlYy5zaXplLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZmlsZTogc3BlYy5maWxlXG4gICAgICAgICAgICAgICAgfSkgLSAxO1xuICAgICAgICAgICAgICAgIGlmIChzcGVjLmJhdGNoSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpZF0uYmF0Y2hJZCA9IHNwZWMuYmF0Y2hJZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ5QmF0Y2hJZFtzcGVjLmJhdGNoSWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5QmF0Y2hJZFtzcGVjLmJhdGNoSWRdID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnlCYXRjaElkW3NwZWMuYmF0Y2hJZF0ucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzcGVjLnByb3h5R3JvdXBJZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2lkXS5wcm94eUdyb3VwSWQgPSBzcGVjLnByb3h5R3JvdXBJZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ5UHJveHlHcm91cElkW3NwZWMucHJveHlHcm91cElkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBieVByb3h5R3JvdXBJZFtzcGVjLnByb3h5R3JvdXBJZF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBieVByb3h5R3JvdXBJZFtzcGVjLnByb3h5R3JvdXBJZF0ucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGFbaWRdLmlkID0gaWQ7XG4gICAgICAgICAgICAgICAgYnlVdWlkW3NwZWMudXVpZF0gPSBpZDtcbiAgICAgICAgICAgICAgICBpZiAoYnlTdGF0dXNbc3RhdHVzXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ5U3RhdHVzW3N0YXR1c10gPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnlTdGF0dXNbc3RhdHVzXS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICBzcGVjLm9uQmVmb3JlU3RhdHVzQ2hhbmdlICYmIHNwZWMub25CZWZvcmVTdGF0dXNDaGFuZ2UoaWQpO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyUHJveHkub25TdGF0dXNDaGFuZ2UoaWQsIG51bGwsIHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHJpZXZlOiBmdW5jdGlvbihvcHRpb25hbEZpbHRlcikge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc09iamVjdChvcHRpb25hbEZpbHRlcikgJiYgZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbmFsRmlsdGVyLmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXREYXRhQnlJZHMob3B0aW9uYWxGaWx0ZXIuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbmFsRmlsdGVyLnV1aWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldERhdGFCeVV1aWRzKG9wdGlvbmFsRmlsdGVyLnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbmFsRmlsdGVyLnN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldERhdGFCeVN0YXR1cyhvcHRpb25hbEZpbHRlci5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHFxLmV4dGVuZChbXSwgZGF0YSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZUZpbGVSZWY6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGdldERhdGFCeUlkcyhpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmVjb3JkLmZpbGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gW107XG4gICAgICAgICAgICAgICAgYnlVdWlkID0ge307XG4gICAgICAgICAgICAgICAgYnlTdGF0dXMgPSB7fTtcbiAgICAgICAgICAgICAgICBieUJhdGNoSWQgPSB7fTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uKGlkLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2xkU3RhdHVzID0gZGF0YVtpZF0uc3RhdHVzLCBieVN0YXR1c09sZFN0YXR1c0luZGV4ID0gcXEuaW5kZXhPZihieVN0YXR1c1tvbGRTdGF0dXNdLCBpZCk7XG4gICAgICAgICAgICAgICAgYnlTdGF0dXNbb2xkU3RhdHVzXS5zcGxpY2UoYnlTdGF0dXNPbGRTdGF0dXNJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgZGF0YVtpZF0uc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICAgICAgICAgIGlmIChieVN0YXR1c1tuZXdTdGF0dXNdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnlTdGF0dXNbbmV3U3RhdHVzXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBieVN0YXR1c1tuZXdTdGF0dXNdLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyUHJveHkub25TdGF0dXNDaGFuZ2UoaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1dWlkQ2hhbmdlZDogZnVuY3Rpb24oaWQsIG5ld1V1aWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2xkVXVpZCA9IGRhdGFbaWRdLnV1aWQ7XG4gICAgICAgICAgICAgICAgZGF0YVtpZF0udXVpZCA9IG5ld1V1aWQ7XG4gICAgICAgICAgICAgICAgYnlVdWlkW25ld1V1aWRdID0gaWQ7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGJ5VXVpZFtvbGRVdWlkXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVOYW1lOiBmdW5jdGlvbihpZCwgbmV3TmFtZSkge1xuICAgICAgICAgICAgICAgIGRhdGFbaWRdLm5hbWUgPSBuZXdOYW1lO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZVNpemU6IGZ1bmN0aW9uKGlkLCBuZXdTaXplKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtpZF0uc2l6ZSA9IG5ld1NpemU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0UGFyZW50SWQ6IGZ1bmN0aW9uKHRhcmdldElkLCBwYXJlbnRJZCkge1xuICAgICAgICAgICAgICAgIGRhdGFbdGFyZ2V0SWRdLnBhcmVudElkID0gcGFyZW50SWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWRzSW5Qcm94eUdyb3VwOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBwcm94eUdyb3VwSWQgPSBkYXRhW2lkXS5wcm94eUdyb3VwSWQ7XG4gICAgICAgICAgICAgICAgaWYgKHByb3h5R3JvdXBJZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnlQcm94eUdyb3VwSWRbcHJveHlHcm91cElkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldElkc0luQmF0Y2g6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJhdGNoSWQgPSBkYXRhW2lkXS5iYXRjaElkO1xuICAgICAgICAgICAgICAgIHJldHVybiBieUJhdGNoSWRbYmF0Y2hJZF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuc3RhdHVzID0ge1xuICAgICAgICBTVUJNSVRUSU5HOiBcInN1Ym1pdHRpbmdcIixcbiAgICAgICAgU1VCTUlUVEVEOiBcInN1Ym1pdHRlZFwiLFxuICAgICAgICBSRUpFQ1RFRDogXCJyZWplY3RlZFwiLFxuICAgICAgICBRVUVVRUQ6IFwicXVldWVkXCIsXG4gICAgICAgIENBTkNFTEVEOiBcImNhbmNlbGVkXCIsXG4gICAgICAgIFBBVVNFRDogXCJwYXVzZWRcIixcbiAgICAgICAgVVBMT0FESU5HOiBcInVwbG9hZGluZ1wiLFxuICAgICAgICBVUExPQURfRklOQUxJWklORzogXCJ1cGxvYWQgZmluYWxpemluZ1wiLFxuICAgICAgICBVUExPQURfUkVUUllJTkc6IFwicmV0cnlpbmcgdXBsb2FkXCIsXG4gICAgICAgIFVQTE9BRF9TVUNDRVNTRlVMOiBcInVwbG9hZCBzdWNjZXNzZnVsXCIsXG4gICAgICAgIFVQTE9BRF9GQUlMRUQ6IFwidXBsb2FkIGZhaWxlZFwiLFxuICAgICAgICBERUxFVEVfRkFJTEVEOiBcImRlbGV0ZSBmYWlsZWRcIixcbiAgICAgICAgREVMRVRJTkc6IFwiZGVsZXRpbmdcIixcbiAgICAgICAgREVMRVRFRDogXCJkZWxldGVkXCJcbiAgICB9O1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLmJhc2VQdWJsaWNBcGkgPSB7XG4gICAgICAgICAgICBhZGRCbG9iczogZnVuY3Rpb24oYmxvYkRhdGFPckFycmF5LCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlcyhibG9iRGF0YU9yQXJyYXksIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEluaXRpYWxGaWxlczogZnVuY3Rpb24oY2FubmVkRmlsZUxpc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChjYW5uZWRGaWxlTGlzdCwgZnVuY3Rpb24oaW5kZXgsIGNhbm5lZEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fYWRkQ2FubmVkRmlsZShjYW5uZWRGaWxlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRGaWxlczogZnVuY3Rpb24oZGF0YSwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX21heWJlSGFuZGxlSW9zOFNhZmFyaVdvcmthcm91bmQoKTtcbiAgICAgICAgICAgICAgICB2YXIgYmF0Y2hJZCA9IHRoaXMuX3N0b3JlZElkcy5sZW5ndGggPT09IDAgPyBxcS5nZXRVbmlxdWVJZCgpIDogdGhpcy5fY3VycmVudEJhdGNoSWQsIHByb2Nlc3NCbG9iID0gcXEuYmluZChmdW5jdGlvbihibG9iKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU5ld0ZpbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuX29wdGlvbnMuYmxvYnMuZGVmYXVsdE5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIHByb2Nlc3NCbG9iRGF0YSA9IHFxLmJpbmQoZnVuY3Rpb24oYmxvYkRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTmV3RmlsZShibG9iRGF0YSwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIHByb2Nlc3NDYW52YXMgPSBxcS5iaW5kKGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IHFxLmNhbnZhc1RvQmxvYihjYW52YXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVOZXdGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLl9vcHRpb25zLmJsb2JzLmRlZmF1bHROYW1lICsgXCIucG5nXCJcbiAgICAgICAgICAgICAgICAgICAgfSwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIHByb2Nlc3NDYW52YXNEYXRhID0gcXEuYmluZChmdW5jdGlvbihjYW52YXNEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBub3JtYWxpemVkUXVhbGl0eSA9IGNhbnZhc0RhdGEucXVhbGl0eSAmJiBjYW52YXNEYXRhLnF1YWxpdHkgLyAxMDAsIGJsb2IgPSBxcS5jYW52YXNUb0Jsb2IoY2FudmFzRGF0YS5jYW52YXMsIGNhbnZhc0RhdGEudHlwZSwgbm9ybWFsaXplZFF1YWxpdHkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVOZXdGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjYW52YXNEYXRhLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIHByb2Nlc3NGaWxlT3JJbnB1dCA9IHFxLmJpbmQoZnVuY3Rpb24oZmlsZU9ySW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzSW5wdXQoZmlsZU9ySW5wdXQpICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZpbGVPcklucHV0LmZpbGVzKSwgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGZpbGVzLCBmdW5jdGlvbihpZHgsIGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVOZXdGaWxlKGZpbGUsIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVOZXdGaWxlKGZpbGVPcklucHV0LCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBub3JtYWxpemVEYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGVMaXN0KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtdLmNvbmNhdChkYXRhKTtcbiAgICAgICAgICAgICAgICB9LCBzZWxmID0gdGhpcywgdmVyaWZpZWRGaWxlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRCYXRjaElkID0gYmF0Y2hJZDtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZGF0YSwgZnVuY3Rpb24oaWR4LCBmaWxlQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlT3JJbnB1dChmaWxlQ29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NGaWxlT3JJbnB1dChmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNCbG9iKGZpbGVDb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0Jsb2IoZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzT2JqZWN0KGZpbGVDb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVDb250YWluZXIuYmxvYiAmJiBmaWxlQ29udGFpbmVyLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0Jsb2JEYXRhKGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZUNvbnRhaW5lci5jYW52YXMgJiYgZmlsZUNvbnRhaW5lci5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NDYW52YXNEYXRhKGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZUNvbnRhaW5lci50YWdOYW1lICYmIGZpbGVDb250YWluZXIudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImNhbnZhc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0NhbnZhcyhmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coZmlsZUNvbnRhaW5lciArIFwiIGlzIG5vdCBhIHZhbGlkIGZpbGUgY29udGFpbmVyISAgSWdub3JpbmchXCIsIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUmVjZWl2ZWQgXCIgKyB2ZXJpZmllZEZpbGVzLmxlbmd0aCArIFwiIGZpbGVzLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZUl0ZW1zRm9yVXBsb2FkKHZlcmlmaWVkRmlsZXMsIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGEgPSB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGEgJiYgdXBsb2FkRGF0YS5zdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfRklOQUxJWklORykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhxcS5mb3JtYXQoXCJJZ25vcmluZyBjYW5jZWwgZm9yIGZpbGUgSUQge30gKHt9KS4gIEZpbmFsaXppbmcgdXBsb2FkLlwiLCBpZCwgdGhpcy5nZXROYW1lKGlkKSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5jYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWxBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdG9yZWRJZHNDb3B5ID0gW10sIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChzdG9yZWRJZHNDb3B5LCB0aGlzLl9zdG9yZWRJZHMpO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goc3RvcmVkSWRzQ29weSwgZnVuY3Rpb24oaWR4LCBzdG9yZWRGaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYW5jZWwoc3RvcmVkRmlsZUlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmNhbmNlbEFsbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyU3RvcmVkRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlZElkcyA9IFtdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRpbnVlVXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMucGF1c2UgfHwgIXRoaXMuX29wdGlvbnMuY2h1bmtpbmcuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhLnN0YXR1cyA9PT0gcXEuc3RhdHVzLlBBVVNFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhxcS5mb3JtYXQoXCJQYXVzZWQgZmlsZSBJRCB7fSAoe30pIHdpbGwgYmUgY29udGludWVkLiAgTm90IHBhdXNlZC5cIiwgaWQsIHRoaXMuZ2V0TmFtZShpZCkpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKHFxLmZvcm1hdChcIklnbm9yaW5nIGNvbnRpbnVlIGZvciBmaWxlIElEIHt9ICh7fSkuICBOb3QgcGF1c2VkLlwiLCBpZCwgdGhpcy5nZXROYW1lKGlkKSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxldGVGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vblN1Ym1pdERlbGV0ZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZG9lc0V4aXN0OiBmdW5jdGlvbihmaWxlT3JCbG9iSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlci5pc1ZhbGlkKGZpbGVPckJsb2JJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZHJhd1RodW1ibmFpbDogZnVuY3Rpb24oZmlsZUlkLCBpbWdPckNhbnZhcywgbWF4U2l6ZSwgZnJvbVNlcnZlciwgY3VzdG9tUmVzaXplRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZVRvUmV0dXJuID0gbmV3IHFxLlByb21pc2UoKSwgZmlsZU9yVXJsLCBvcHRpb25zO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbWFnZUdlbmVyYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBmaWxlT3JVcmwgPSB0aGlzLl90aHVtYm5haWxVcmxzW2ZpbGVJZF07XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhTaXplOiBtYXhTaXplID4gMCA/IG1heFNpemUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IG1heFNpemUgPiAwXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmICghZnJvbVNlcnZlciAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlT3JVcmwgPSB0aGlzLmdldEZpbGUoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZU9yVXJsID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VUb1JldHVybi5mYWlsdXJlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGltZ09yQ2FudmFzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBcIkZpbGUgb3IgVVJMIG5vdCBmb3VuZC5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZUdlbmVyYXRvci5nZW5lcmF0ZShmaWxlT3JVcmwsIGltZ09yQ2FudmFzLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MobW9kaWZpZWRDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlVG9SZXR1cm4uc3VjY2Vzcyhtb2RpZmllZENvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBmYWlsdXJlKGNvbnRhaW5lciwgcmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVRvUmV0dXJuLmZhaWx1cmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHJlYXNvbiB8fCBcIlByb2JsZW0gZ2VuZXJhdGluZyB0aHVtYm5haWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlVG9SZXR1cm4uZmFpbHVyZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGltZ09yQ2FudmFzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IFwiTWlzc2luZyBpbWFnZSBnZW5lcmF0b3IgbW9kdWxlXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlVG9SZXR1cm47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QnV0dG9uOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0QnV0dG9uKHRoaXMuX2J1dHRvbklkc0ZvckZpbGVJZHNbZmlsZUlkXSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RW5kcG9pbnQ6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmRwb2ludFN0b3JlLmdldChmaWxlSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGU6IGZ1bmN0aW9uKGZpbGVPckJsb2JJZCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlID0gdGhpcy5faGFuZGxlci5nZXRGaWxlKGZpbGVPckJsb2JJZCk7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGFSZWNvcmQ7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZERhdGFSZWNvcmQgPSB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlT3JCbG9iSWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhUmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlID0gdXBsb2FkRGF0YVJlY29yZC5maWxlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlIHx8IG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5Qcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFsgcXEuc3RhdHVzLlVQTE9BRElORywgcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORywgcXEuc3RhdHVzLlFVRVVFRCBdXG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5hbWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KS5uYW1lO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBhcmVudElkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhRW50cnkgPSB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KSwgcGFyZW50SWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhRW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGFFbnRyeS5wYXJlbnRJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZCA9IHVwbG9hZERhdGFFbnRyeS5wYXJlbnRJZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50SWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVzdW1hYmxlRmlsZXNEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlci5nZXRSZXN1bWFibGVGaWxlc0RhdGEoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTaXplOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSkuc2l6ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROZXRVcGxvYWRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV0VXBsb2FkZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVtYWluaW5nQWxsb3dlZEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWxsb3dlZEl0ZW1zID0gdGhpcy5fY3VycmVudEl0ZW1MaW1pdDtcbiAgICAgICAgICAgICAgICBpZiAoYWxsb3dlZEl0ZW1zID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxsb3dlZEl0ZW1zIC0gdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VXBsb2FkczogZnVuY3Rpb24ob3B0aW9uYWxGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZShvcHRpb25hbEZpbHRlcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VXVpZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pLnV1aWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNSZXN1bWFibGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZXIuaGFzUmVzdW1lUmVjb3JkKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5kZWJ1ZyAmJiAoIWxldmVsIHx8IGxldmVsID09PSBcImluZm9cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEubG9nKFwiW0ZpbmUgVXBsb2FkZXIgXCIgKyBxcS52ZXJzaW9uICsgXCJdIFwiICsgc3RyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxldmVsICYmIGxldmVsICE9PSBcImluZm9cIikge1xuICAgICAgICAgICAgICAgICAgICBxcS5sb2coXCJbRmluZSBVcGxvYWRlciBcIiArIHFxLnZlcnNpb24gKyBcIl0gXCIgKyBzdHIsIGxldmVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2VVcGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGEgPSB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5wYXVzZSB8fCAhdGhpcy5fb3B0aW9ucy5jaHVua2luZy5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHFxLmluZGV4T2YoWyBxcS5zdGF0dXMuVVBMT0FESU5HLCBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HIF0sIHVwbG9hZERhdGEuc3RhdHVzKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9oYW5kbGVyLnBhdXNlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5QQVVTRUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhxcS5mb3JtYXQoXCJVbmFibGUgdG8gcGF1c2UgZmlsZSBJRCB7fSAoe30pLlwiLCBpZCwgdGhpcy5nZXROYW1lKGlkKSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhxcS5mb3JtYXQoXCJJZ25vcmluZyBwYXVzZSBmb3IgZmlsZSBJRCB7fSAoe30pLiAgTm90IGluIHByb2dyZXNzLlwiLCBpZCwgdGhpcy5nZXROYW1lKGlkKSksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVGaWxlUmVmOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5yZW1vdmVGaWxlUmVmKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2coXCJSZXNldHRpbmcgdXBsb2FkZXIuLi5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlZElkcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9SZXRyaWVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fcmV0cnlUaW1lb3V0cyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZlbnRSZXRyaWVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fdGh1bWJuYWlsVXJscyA9IFtdO1xuICAgICAgICAgICAgICAgIHFxLmVhY2godGhpcy5fYnV0dG9ucywgZnVuY3Rpb24oaWR4LCBidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9lbmRwb2ludFN0b3JlLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9idXR0b25JZHNGb3JGaWxlSWRzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFzdGVIYW5kbGVyICYmIHRoaXMuX3Bhc3RlSGFuZGxlci5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuc2Vzc2lvbi5yZWZyZXNoT25SZXNldCAmJiB0aGlzLl9yZWZyZXNoU2Vzc2lvbkRhdGEoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxQcm9ncmVzcyAmJiB0aGlzLl90b3RhbFByb2dyZXNzLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VzdG9tUmVzdW1lRGF0YVN0b3JlLnJlc2V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hbnVhbFJldHJ5KGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzY2FsZUltYWdlOiBmdW5jdGlvbihpZCwgc3BlY3MpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxLlNjYWxlci5wcm90b3R5cGUuc2NhbGVJbWFnZShpZCwgc3BlY3MsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBxcS5iaW5kKHNlbGYubG9nLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0RmlsZTogcXEuYmluZChzZWxmLmdldEZpbGUsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhOiBzZWxmLl91cGxvYWREYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Q3VzdG9tSGVhZGVyczogZnVuY3Rpb24oaGVhZGVycywgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXN0b21IZWFkZXJzU3RvcmUuc2V0KGhlYWRlcnMsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRDdXN0b21SZXN1bWVEYXRhOiBmdW5jdGlvbihpZCwgZGF0YSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1c3RvbVJlc3VtZURhdGFTdG9yZS5zZXQoZGF0YSwgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldERlbGV0ZUZpbGVDdXN0b21IZWFkZXJzOiBmdW5jdGlvbihoZWFkZXJzLCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVDdXN0b21IZWFkZXJzU3RvcmUuc2V0KGhlYWRlcnMsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXREZWxldGVGaWxlRW5kcG9pbnQ6IGZ1bmN0aW9uKGVuZHBvaW50LCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVFbmRwb2ludFN0b3JlLnNldChlbmRwb2ludCwgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldERlbGV0ZUZpbGVQYXJhbXM6IGZ1bmN0aW9uKHBhcmFtcywgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlUGFyYW1zU3RvcmUuc2V0KHBhcmFtcywgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEVuZHBvaW50OiBmdW5jdGlvbihlbmRwb2ludCwgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9lbmRwb2ludFN0b3JlLnNldChlbmRwb2ludCwgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEZvcm06IGZ1bmN0aW9uKGVsZW1lbnRPcklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlRm9ybVN1cHBvcnRBbmRQYXJhbXMoZWxlbWVudE9ySWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEl0ZW1MaW1pdDogZnVuY3Rpb24obmV3SXRlbUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEl0ZW1MaW1pdCA9IG5ld0l0ZW1MaW1pdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXROYW1lOiBmdW5jdGlvbihpZCwgbmV3TmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEudXBkYXRlTmFtZShpZCwgbmV3TmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0UGFyYW1zOiBmdW5jdGlvbihwYXJhbXMsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUuc2V0KHBhcmFtcywgaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFV1aWQ6IGZ1bmN0aW9uKGlkLCBuZXdVdWlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEudXVpZENoYW5nZWQoaWQsIG5ld1V1aWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFN0YXR1czogZnVuY3Rpb24oaWQsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlUmVjb3JkID0gdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWxlUmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihpZCArIFwiIGlzIG5vdCBhIHZhbGlkIGZpbGUgSUQuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgICAgY2FzZSBxcS5zdGF0dXMuREVMRVRFRDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25EZWxldGVDb21wbGV0ZShpZCwgbnVsbCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgY2FzZSBxcS5zdGF0dXMuREVMRVRFX0ZBSUxFRDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25EZWxldGVDb21wbGV0ZShpZCwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlID0gXCJNZXRob2Qgc2V0U3RhdHVzIGNhbGxlZCBvbiAnXCIgKyBuYW1lICsgXCInIG5vdCBpbXBsZW1lbnRlZCB5ZXQgZm9yIFwiICsgbmV3U3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhlcnJvck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkU3RvcmVkRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdG9yZWRJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcIm5vRmlsZXNFcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWRTdG9yZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuYmFzZVByaXZhdGVBcGkgPSB7XG4gICAgICAgICAgICBfYWRkQ2FubmVkRmlsZTogZnVuY3Rpb24oc2Vzc2lvbkRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEuYWRkRmlsZSh7XG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IHNlc3Npb25EYXRhLnV1aWQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlc3Npb25EYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHNlc3Npb25EYXRhLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogcXEuc3RhdHVzLlVQTE9BRF9TVUNDRVNTRlVMLFxuICAgICAgICAgICAgICAgICAgICBvbkJlZm9yZVN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLmRlbGV0ZUZpbGVFbmRwb2ludCAmJiBzZWxmLnNldERlbGV0ZUZpbGVFbmRwb2ludChzZXNzaW9uRGF0YS5kZWxldGVGaWxlRW5kcG9pbnQsIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLmRlbGV0ZUZpbGVQYXJhbXMgJiYgc2VsZi5zZXREZWxldGVGaWxlUGFyYW1zKHNlc3Npb25EYXRhLmRlbGV0ZUZpbGVQYXJhbXMsIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uRGF0YS50aHVtYm5haWxVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl90aHVtYm5haWxVcmxzW2lkXSA9IHNlc3Npb25EYXRhLnRodW1ibmFpbFVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX25ldFVwbG9hZGVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9uZXRVcGxvYWRlZE9yUXVldWVkKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYW5ub3RhdGVXaXRoQnV0dG9uSWQ6IGZ1bmN0aW9uKGZpbGUsIGFzc29jaWF0ZWRJbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGUoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5xcUJ1dHRvbklkID0gdGhpcy5fZ2V0QnV0dG9uSWQoYXNzb2NpYXRlZElucHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JhdGNoRXJyb3I6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKG51bGwsIG51bGwsIG1lc3NhZ2UsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZURlbGV0ZUhhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkRlbGV0ZUZpbGVBamF4UmVxdWVzdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiB0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUubWV0aG9kLnRvVXBwZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiB0aGlzLl9vcHRpb25zLm1heENvbm5lY3Rpb25zLFxuICAgICAgICAgICAgICAgICAgICB1dWlkUGFyYW1OYW1lOiB0aGlzLl9vcHRpb25zLnJlcXVlc3QudXVpZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHRoaXMuX2RlbGV0ZUZpbGVDdXN0b21IZWFkZXJzU3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0b3JlOiB0aGlzLl9kZWxldGVGaWxlUGFyYW1zU3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IHRoaXMuX2RlbGV0ZUZpbGVFbmRwb2ludFN0b3JlLFxuICAgICAgICAgICAgICAgICAgICBjb3JzOiB0aGlzLl9vcHRpb25zLmNvcnMsXG4gICAgICAgICAgICAgICAgICAgIGxvZzogcXEuYmluZChzZWxmLmxvZywgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25EZWxldGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25EZWxldGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZUNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRGVsZXRlQ29tcGxldGUoaWQsIHhock9yWGRyLCBpc0Vycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uRGVsZXRlQ29tcGxldGUoaWQsIHhock9yWGRyLCBpc0Vycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVQYXN0ZUhhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlBhc3RlU3VwcG9ydCh7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQ6IHRoaXMuX29wdGlvbnMucGFzdGUudGFyZ2V0RWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2c6IHFxLmJpbmQoc2VsZi5sb2csIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGVSZWNlaXZlZDogZnVuY3Rpb24oYmxvYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25QYXN0ZVJlY2VpdmVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uUGFzdGVSZWNlaXZlZCwgc2VsZiwgYmxvYiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogcXEuYmluZChzZWxmLl9oYW5kbGVQYXN0ZVN1Y2Nlc3MsIHNlbGYsIGJsb2IpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBcInBhc3RlZCBpbWFnZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlU3RvcmU6IGZ1bmN0aW9uKGluaXRpYWxWYWx1ZSwgX3JlYWRPbmx5VmFsdWVzXykge1xuICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHt9LCBjYXRjaGFsbCA9IGluaXRpYWxWYWx1ZSwgcGVySWRSZWFkT25seVZhbHVlcyA9IHt9LCByZWFkT25seVZhbHVlcyA9IF9yZWFkT25seVZhbHVlc18sIGNvcHkgPSBmdW5jdGlvbihvcmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc09iamVjdChvcmlnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHFxLmV4dGVuZCh7fSwgb3JpZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWc7XG4gICAgICAgICAgICAgICAgfSwgZ2V0UmVhZE9ubHlWYWx1ZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRnVuY3Rpb24ocmVhZE9ubHlWYWx1ZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhZE9ubHlWYWx1ZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhZE9ubHlWYWx1ZXM7XG4gICAgICAgICAgICAgICAgfSwgaW5jbHVkZVJlYWRPbmx5VmFsdWVzID0gZnVuY3Rpb24oaWQsIGV4aXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWFkT25seVZhbHVlcyAmJiBxcS5pc09iamVjdChleGlzdGluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChleGlzdGluZywgZ2V0UmVhZE9ubHlWYWx1ZXMoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlcklkUmVhZE9ubHlWYWx1ZXNbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQoZXhpc3RpbmcsIHBlcklkUmVhZE9ubHlWYWx1ZXNbaWRdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwsIGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hhbGwgPSBjb3B5KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlW2lkXSA9IGNvcHkodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCAhPSBudWxsICYmIHN0b3JlW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHN0b3JlW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gY29weShjYXRjaGFsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlUmVhZE9ubHlWYWx1ZXMoaWQsIHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29weSh2YWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhZGRSZWFkT25seTogZnVuY3Rpb24oaWQsIHZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzT2JqZWN0KHN0b3JlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGdW5jdGlvbih2YWx1ZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkT25seVZhbHVlcyA9IHZhbHVlcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRPbmx5VmFsdWVzID0gcmVhZE9ubHlWYWx1ZXMgfHwge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQocmVhZE9ubHlWYWx1ZXMsIHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJJZFJlYWRPbmx5VmFsdWVzW2lkXSA9IHBlcklkUmVhZE9ubHlWYWx1ZXNbaWRdIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQocGVySWRSZWFkT25seVZhbHVlc1tpZF0sIHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZSBzdG9yZVtmaWxlSWRdO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9yZSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVySWRSZWFkT25seVZhbHVlcyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hhbGwgPSBpbml0aWFsVmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVVcGxvYWREYXRhVHJhY2tlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuVXBsb2FkRGF0YSh7XG4gICAgICAgICAgICAgICAgICAgIGdldE5hbWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXVpZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFV1aWQoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRTaXplOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uVXBsb2FkU3RhdHVzQ2hhbmdlKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblN0YXR1c0NoYW5nZShpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWF5YmVBbGxDb21wbGV0ZShpZCwgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLl90b3RhbFByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdG90YWxQcm9ncmVzcy5vblN0YXR1c0NoYW5nZShpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVVwbG9hZEJ1dHRvbjogZnVuY3Rpb24oc3BlYykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgYWNjZXB0RmlsZXMgPSBzcGVjLmFjY2VwdCB8fCB0aGlzLl9vcHRpb25zLnZhbGlkYXRpb24uYWNjZXB0RmlsZXMsIGFsbG93ZWRFeHRlbnNpb25zID0gc3BlYy5hbGxvd2VkRXh0ZW5zaW9ucyB8fCB0aGlzLl9vcHRpb25zLnZhbGlkYXRpb24uYWxsb3dlZEV4dGVuc2lvbnMsIGJ1dHRvbjtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhbGxvd011bHRpcGxlKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuX29wdGlvbnMud29ya2Fyb3VuZHMuaW9zRW1wdHlWaWRlb3MgJiYgcXEuaW9zKCkgJiYgIXFxLmlvczYoKSAmJiBzZWxmLl9pc0FsbG93ZWRFeHRlbnNpb24oYWxsb3dlZEV4dGVuc2lvbnMsIFwiLm1vdlwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGVjLm11bHRpcGxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fb3B0aW9ucy5tdWx0aXBsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcGVjLm11bHRpcGxlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnV0dG9uID0gbmV3IHFxLlVwbG9hZEJ1dHRvbih7XG4gICAgICAgICAgICAgICAgICAgIGFjY2VwdEZpbGVzOiBhY2NlcHRGaWxlcyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogc3BlYy5lbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBmb2N1c0NsYXNzOiB0aGlzLl9vcHRpb25zLmNsYXNzZXMuYnV0dG9uRm9jdXMsXG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcnM6IHNwZWMuZm9sZGVycyxcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJDbGFzczogdGhpcy5fb3B0aW9ucy5jbGFzc2VzLmJ1dHRvbkhvdmVyLFxuICAgICAgICAgICAgICAgICAgICBpb3M4QnJvd3NlckNyYXNoV29ya2Fyb3VuZDogdGhpcy5fb3B0aW9ucy53b3JrYXJvdW5kcy5pb3M4QnJvd3NlckNyYXNoLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogYWxsb3dNdWx0aXBsZSgpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLl9vcHRpb25zLnJlcXVlc3QuaW5wdXROYW1lLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uSW5wdXRDaGFuZ2UoaW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogc3BlYy50aXRsZSA9PSBudWxsID8gdGhpcy5fb3B0aW9ucy50ZXh0LmZpbGVJbnB1dFRpdGxlIDogc3BlYy50aXRsZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2VTdXBwb3J0LmFkZERpc3Bvc2VyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBidXR0b24uZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNlbGYuX2J1dHRvbnMucHVzaChidXR0b24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBidXR0b247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVVwbG9hZEhhbmRsZXI6IGZ1bmN0aW9uKGFkZGl0aW9uYWxPcHRpb25zLCBuYW1lc3BhY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGxhc3RPblByb2dyZXNzID0ge30sIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnOiB0aGlzLl9vcHRpb25zLmRlYnVnLFxuICAgICAgICAgICAgICAgICAgICBtYXhDb25uZWN0aW9uczogdGhpcy5fb3B0aW9ucy5tYXhDb25uZWN0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgY29yczogdGhpcy5fb3B0aW9ucy5jb3JzLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNTdG9yZTogdGhpcy5fcGFyYW1zU3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IHRoaXMuX2VuZHBvaW50U3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIGNodW5raW5nOiB0aGlzLl9vcHRpb25zLmNodW5raW5nLFxuICAgICAgICAgICAgICAgICAgICByZXN1bWU6IHRoaXMuX29wdGlvbnMucmVzdW1lLFxuICAgICAgICAgICAgICAgICAgICBibG9iczogdGhpcy5fb3B0aW9ucy5ibG9icyxcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBxcS5iaW5kKHNlbGYubG9nLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgcHJldmVudFJldHJ5UGFyYW06IHRoaXMuX29wdGlvbnMucmV0cnkucHJldmVudFJldHJ5UmVzcG9uc2VQcm9wZXJ0eSxcbiAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24oaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkZWQgPCAwIHx8IHRvdGFsIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0T25Qcm9ncmVzc1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdE9uUHJvZ3Jlc3NbaWRdLmxvYWRlZCAhPT0gbG9hZGVkIHx8IGxhc3RPblByb2dyZXNzW2lkXS50b3RhbCAhPT0gdG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25Qcm9ncmVzcyhpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uUHJvZ3Jlc3MoaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25Qcm9ncmVzcyhpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25Qcm9ncmVzcyhpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0T25Qcm9ncmVzc1tpZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBsb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzdWx0LCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBsYXN0T25Qcm9ncmVzc1tpZF07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN0YXR1cywgcmV0VmFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9TVUNDRVNTRlVMIHx8IHN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9GQUlMRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBzZWxmLl9vbkNvbXBsZXRlKGlkLCBuYW1lLCByZXN1bHQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsIGluc3RhbmNlb2YgcXEuUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbC5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkNvbXBsZXRlKGlkLCBuYW1lLCByZXN1bHQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uQ29tcGxldGUoaWQsIG5hbWUsIHJlc3VsdCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uKGlkLCBuYW1lLCBjYW5jZWxGaW5hbGl6YXRpb25FZmZvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvbkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uQ2FuY2VsLCBzZWxmLCBpZCwgbmFtZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBwcm9taXNlLmZhaWx1cmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsRmluYWxpemF0aW9uRWZmb3J0LnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbkNhbmNlbChpZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZFByZXA6IHFxLmJpbmQodGhpcy5fb25VcGxvYWRQcmVwLCB0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblVwbG9hZChpZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb25VcGxvYWRSZXN1bHQgPSBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblVwbG9hZChpZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNHZW5lcmljUHJvbWlzZShvblVwbG9hZFJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhxcS5mb3JtYXQoXCJvblVwbG9hZCBmb3Ige30gcmV0dXJuZWQgYSBQcm9taXNlIC0gd2FpdGluZyBmb3IgcmVzb2x1dGlvbi5cIiwgaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb25VcGxvYWRSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlByb21pc2UoKS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkQ2h1bms6IGZ1bmN0aW9uKGlkLCBuYW1lLCBjaHVua0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uVXBsb2FkQ2h1bmsoaWQsIGNodW5rRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb25VcGxvYWRDaHVua1Jlc3VsdCA9IHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uVXBsb2FkQ2h1bmsoaWQsIG5hbWUsIGNodW5rRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNHZW5lcmljUHJvbWlzZShvblVwbG9hZENodW5rUmVzdWx0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKHFxLmZvcm1hdChcIm9uVXBsb2FkQ2h1bmsgZm9yIHt9Lnt9IHJldHVybmVkIGEgUHJvbWlzZSAtIHdhaXRpbmcgZm9yIHJlc29sdXRpb24uXCIsIGlkLCBjaHVua0RhdGEucGFydEluZGV4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uVXBsb2FkQ2h1bmtSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlByb21pc2UoKS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkQ2h1bmtTdWNjZXNzOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhLCByZXN1bHQsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25VcGxvYWRDaHVua1N1Y2Nlc3MoaWQsIGNodW5rRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblVwbG9hZENodW5rU3VjY2Vzcy5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblJlc3VtZTogZnVuY3Rpb24oaWQsIG5hbWUsIGNodW5rRGF0YSwgY3VzdG9tUmVzdW1lRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uUmVzdW1lKGlkLCBuYW1lLCBjaHVua0RhdGEsIGN1c3RvbVJlc3VtZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkF1dG9SZXRyeTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3BvbnNlSlNPTiwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fb25BdXRvUmV0cnkuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25VdWlkQ2hhbmdlZDogZnVuY3Rpb24oaWQsIG5ld1V1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKFwiU2VydmVyIHJlcXVlc3RlZCBVVUlEIGNoYW5nZSBmcm9tICdcIiArIHNlbGYuZ2V0VXVpZChpZCkgKyBcIicgdG8gJ1wiICsgbmV3VXVpZCArIFwiJ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0VXVpZChpZCwgbmV3VXVpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldE5hbWU6IHFxLmJpbmQoc2VsZi5nZXROYW1lLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXVpZDogcXEuYmluZChzZWxmLmdldFV1aWQsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBnZXRTaXplOiBxcS5iaW5kKHNlbGYuZ2V0U2l6ZSwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIHNldFNpemU6IHFxLmJpbmQoc2VsZi5fc2V0U2l6ZSwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIGdldERhdGFCeVV1aWQ6IGZ1bmN0aW9uKHV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBpc1F1ZXVlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1cyA9PT0gcXEuc3RhdHVzLlFVRVVFRCB8fCBzdGF0dXMgPT09IHFxLnN0YXR1cy5TVUJNSVRURUQgfHwgc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HIHx8IHN0YXR1cyA9PT0gcXEuc3RhdHVzLlBBVVNFRDtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0SWRzSW5Qcm94eUdyb3VwOiBzZWxmLl91cGxvYWREYXRhLmdldElkc0luUHJveHlHcm91cCxcbiAgICAgICAgICAgICAgICAgICAgZ2V0SWRzSW5CYXRjaDogc2VsZi5fdXBsb2FkRGF0YS5nZXRJZHNJbkJhdGNoLFxuICAgICAgICAgICAgICAgICAgICBpc0luUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRElORztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q3VzdG9tUmVzdW1lRGF0YTogcXEuYmluZChzZWxmLl9nZXRDdXN0b21SZXN1bWVEYXRhLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbihpZCwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0aGlzLl9vcHRpb25zLnJlcXVlc3QsIGZ1bmN0aW9uKHByb3AsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW3Byb3BdID0gdmFsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY3VzdG9tSGVhZGVycyA9IHRoaXMuX2N1c3RvbUhlYWRlcnNTdG9yZTtcbiAgICAgICAgICAgICAgICBpZiAoYWRkaXRpb25hbE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChhZGRpdGlvbmFsT3B0aW9ucywgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNba2V5XSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuVXBsb2FkSGFuZGxlckNvbnRyb2xsZXIob3B0aW9ucywgbmFtZXNwYWNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZmlsZU9yQmxvYlJlamVjdGVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQtLTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlJFSkVDVEVEKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZm9ybWF0U2l6ZTogZnVuY3Rpb24oYnl0ZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYnl0ZXMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ5dGVzICsgdGhpcy5fb3B0aW9ucy50ZXh0LnNpemVTeW1ib2xzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgaSA9IC0xO1xuICAgICAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAgICAgYnl0ZXMgPSBieXRlcyAvIDFlMztcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIH0gd2hpbGUgKGJ5dGVzID4gOTk5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoYnl0ZXMsIC4xKS50b0ZpeGVkKDEpICsgdGhpcy5fb3B0aW9ucy50ZXh0LnNpemVTeW1ib2xzW2ldO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZW5lcmF0ZUV4dHJhQnV0dG9uU3BlY3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLl9leHRyYUJ1dHRvblNwZWNzID0ge307XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0aGlzLl9vcHRpb25zLmV4dHJhQnV0dG9ucywgZnVuY3Rpb24oaWR4LCBleHRyYUJ1dHRvbk9wdGlvbkVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtdWx0aXBsZSA9IGV4dHJhQnV0dG9uT3B0aW9uRW50cnkubXVsdGlwbGUsIHZhbGlkYXRpb24gPSBxcS5leHRlbmQoe30sIHNlbGYuX29wdGlvbnMudmFsaWRhdGlvbiwgdHJ1ZSksIGV4dHJhQnV0dG9uU3BlYyA9IHFxLmV4dGVuZCh7fSwgZXh0cmFCdXR0b25PcHRpb25FbnRyeSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtdWx0aXBsZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZSA9IHNlbGYuX29wdGlvbnMubXVsdGlwbGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4dHJhQnV0dG9uU3BlYy52YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQodmFsaWRhdGlvbiwgZXh0cmFCdXR0b25PcHRpb25FbnRyeS52YWxpZGF0aW9uLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQoZXh0cmFCdXR0b25TcGVjLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogbXVsdGlwbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiB2YWxpZGF0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9pbml0RXh0cmFCdXR0b24oZXh0cmFCdXR0b25TcGVjKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0QnV0dG9uOiBmdW5jdGlvbihidXR0b25JZCkge1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUJ1dHRvbnNTcGVjID0gdGhpcy5fZXh0cmFCdXR0b25TcGVjc1tidXR0b25JZF07XG4gICAgICAgICAgICAgICAgaWYgKGV4dHJhQnV0dG9uc1NwZWMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4dHJhQnV0dG9uc1NwZWMuZWxlbWVudDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJ1dHRvbklkID09PSB0aGlzLl9kZWZhdWx0QnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnMuYnV0dG9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0QnV0dG9uSWQ6IGZ1bmN0aW9uKGJ1dHRvbk9yRmlsZUlucHV0T3JGaWxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0cywgZmlsZUlucHV0LCBmaWxlQmxvYk9ySW5wdXQgPSBidXR0b25PckZpbGVJbnB1dE9yRmlsZTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZUJsb2JPcklucHV0IGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVCbG9iT3JJbnB1dCA9IGZpbGVCbG9iT3JJbnB1dC5yZWZlcmVuY2VCbG9iO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZmlsZUJsb2JPcklucHV0ICYmICFxcS5pc0Jsb2IoZmlsZUJsb2JPcklucHV0KSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlKGZpbGVCbG9iT3JJbnB1dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlQmxvYk9ySW5wdXQucXFCdXR0b25JZDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlQmxvYk9ySW5wdXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIgJiYgZmlsZUJsb2JPcklucHV0LnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJmaWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlQmxvYk9ySW5wdXQuZ2V0QXR0cmlidXRlKHFxLlVwbG9hZEJ1dHRvbi5CVVRUT05fSURfQVRUUl9OQU1FKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbnB1dHMgPSBmaWxlQmxvYk9ySW5wdXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChpbnB1dHMsIGZ1bmN0aW9uKGlkeCwgaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpID09PSBcImZpbGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVJbnB1dCA9IGlucHV0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlSW5wdXQuZ2V0QXR0cmlidXRlKHFxLlVwbG9hZEJ1dHRvbi5CVVRUT05fSURfQVRUUl9OQU1FKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0Q3VzdG9tUmVzdW1lRGF0YTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1c3RvbVJlc3VtZURhdGFTdG9yZS5nZXQoZmlsZUlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0Tm90RmluaXNoZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBbIHFxLnN0YXR1cy5VUExPQURJTkcsIHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcsIHFxLnN0YXR1cy5RVUVVRUQsIHFxLnN0YXR1cy5TVUJNSVRUSU5HLCBxcS5zdGF0dXMuU1VCTUlUVEVELCBxcS5zdGF0dXMuUEFVU0VEIF1cbiAgICAgICAgICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFZhbGlkYXRpb25CYXNlOiBmdW5jdGlvbihidXR0b25JZCkge1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUJ1dHRvblNwZWMgPSB0aGlzLl9leHRyYUJ1dHRvblNwZWNzW2J1dHRvbklkXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXh0cmFCdXR0b25TcGVjID8gZXh0cmFCdXR0b25TcGVjLnZhbGlkYXRpb24gOiB0aGlzLl9vcHRpb25zLnZhbGlkYXRpb247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFZhbGlkYXRpb25EZXNjcmlwdG9yOiBmdW5jdGlvbihmaWxlV3JhcHBlcikge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlV3JhcHBlci5maWxlIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBxcS5nZXRGaWxlbmFtZShmaWxlV3JhcHBlci5maWxlLnJlZmVyZW5jZUJsb2IpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZVdyYXBwZXIuZmlsZS5yZWZlcmVuY2VCbG9iLnNpemVcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlV3JhcHBlci5pZFxuICAgICAgICAgICAgICAgICAgICB9KS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbGVXcmFwcGVyLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pLnNpemVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcnM6IGZ1bmN0aW9uKGZpbGVXcmFwcGVycykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgZmlsZURlc2NyaXB0b3JzID0gW107XG4gICAgICAgICAgICAgICAgcXEuZWFjaChmaWxlV3JhcHBlcnMsIGZ1bmN0aW9uKGlkeCwgZmlsZVdyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZURlc2NyaXB0b3JzLnB1c2goc2VsZi5fZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3IoZmlsZVdyYXBwZXIpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZURlc2NyaXB0b3JzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVDYW1lcmFBY2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmNhbWVyYS5pb3MgJiYgcXEuaW9zKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjY2VwdElvc0NhbWVyYSA9IFwiaW1hZ2UvKjtjYXB0dXJlPWNhbWVyYVwiLCBidXR0b24gPSB0aGlzLl9vcHRpb25zLmNhbWVyYS5idXR0b24sIGJ1dHRvbklkID0gYnV0dG9uID8gdGhpcy5fZ2V0QnV0dG9uSWQoYnV0dG9uKSA6IHRoaXMuX2RlZmF1bHRCdXR0b25JZCwgb3B0aW9uUm9vdCA9IHRoaXMuX29wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChidXR0b25JZCAmJiBidXR0b25JZCAhPT0gdGhpcy5fZGVmYXVsdEJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25Sb290ID0gdGhpcy5fZXh0cmFCdXR0b25TcGVjc1tidXR0b25JZF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uUm9vdC5tdWx0aXBsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uUm9vdC52YWxpZGF0aW9uLmFjY2VwdEZpbGVzID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25Sb290LnZhbGlkYXRpb24uYWNjZXB0RmlsZXMgPSBhY2NlcHRJb3NDYW1lcmE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25Sb290LnZhbGlkYXRpb24uYWNjZXB0RmlsZXMgKz0gXCIsXCIgKyBhY2NlcHRJb3NDYW1lcmE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaCh0aGlzLl9idXR0b25zLCBmdW5jdGlvbihpZHgsIGJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbi5nZXRCdXR0b25JZCgpID09PSBidXR0b25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRNdWx0aXBsZShvcHRpb25Sb290Lm11bHRpcGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0QWNjZXB0RmlsZXMob3B0aW9uUm9vdC5hY2NlcHRGaWxlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZUNoZWNrZWRDYWxsYmFjazogZnVuY3Rpb24oZGV0YWlscykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgY2FsbGJhY2tSZXRWYWwgPSBkZXRhaWxzLmNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzR2VuZXJpY1Byb21pc2UoY2FsbGJhY2tSZXRWYWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKGRldGFpbHMubmFtZSArIFwiIC0gd2FpdGluZyBmb3IgXCIgKyBkZXRhaWxzLm5hbWUgKyBcIiBwcm9taXNlIHRvIGJlIGZ1bGZpbGxlZCBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2tSZXRWYWwudGhlbihmdW5jdGlvbihzdWNjZXNzUGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGRldGFpbHMubmFtZSArIFwiIHByb21pc2Ugc3VjY2VzcyBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5vblN1Y2Nlc3Moc3VjY2Vzc1BhcmFtKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlscy5vbkZhaWx1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiBwcm9taXNlIGZhaWx1cmUgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzLm9uRmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiBwcm9taXNlIGZhaWx1cmUgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja1JldFZhbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5vblN1Y2Nlc3MoY2FsbGJhY2tSZXRWYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzLm9uRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coZGV0YWlscy5uYW1lICsgXCIgLSByZXR1cm4gdmFsdWUgd2FzICdmYWxzZScgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyICsgXCIuICBJbnZva2luZyBmYWlsdXJlIGNhbGxiYWNrLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHMub25GYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiAtIHJldHVybiB2YWx1ZSB3YXMgJ2ZhbHNlJyBmb3IgXCIgKyBkZXRhaWxzLmlkZW50aWZpZXIgKyBcIi4gIFdpbGwgbm90IHByb2NlZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFja1JldFZhbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlTmV3RmlsZTogZnVuY3Rpb24oZmlsZSwgYmF0Y2hJZCwgbmV3RmlsZVdyYXBwZXJMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCB1dWlkID0gcXEuZ2V0VW5pcXVlSWQoKSwgc2l6ZSA9IC0xLCBuYW1lID0gcXEuZ2V0RmlsZW5hbWUoZmlsZSksIGFjdHVhbEZpbGUgPSBmaWxlLmJsb2IgfHwgZmlsZSwgaGFuZGxlciA9IHRoaXMuX2N1c3RvbU5ld0ZpbGVIYW5kbGVyID8gdGhpcy5fY3VzdG9tTmV3RmlsZUhhbmRsZXIgOiBxcS5iaW5kKHNlbGYuX2hhbmRsZU5ld0ZpbGVHZW5lcmljLCBzZWxmKTtcbiAgICAgICAgICAgICAgICBpZiAoIXFxLmlzSW5wdXQoYWN0dWFsRmlsZSkgJiYgYWN0dWFsRmlsZS5zaXplID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IGFjdHVhbEZpbGUuc2l6ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaGFuZGxlcihhY3R1YWxGaWxlLCBuYW1lLCB1dWlkLCBzaXplLCBuZXdGaWxlV3JhcHBlckxpc3QsIGJhdGNoSWQsIHRoaXMuX29wdGlvbnMucmVxdWVzdC51dWlkTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhOiBzZWxmLl91cGxvYWREYXRhLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNTdG9yZTogc2VsZi5fcGFyYW1zU3RvcmUsXG4gICAgICAgICAgICAgICAgICAgIGFkZEZpbGVUb0hhbmRsZXI6IGZ1bmN0aW9uKGlkLCBmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVyLmFkZChpZCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9uZXRVcGxvYWRlZE9yUXVldWVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl90cmFja0J1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlTmV3RmlsZUdlbmVyaWM6IGZ1bmN0aW9uKGZpbGUsIG5hbWUsIHV1aWQsIHNpemUsIGZpbGVMaXN0LCBiYXRjaElkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGhpcy5fdXBsb2FkRGF0YS5hZGRGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgdXVpZDogdXVpZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hJZDogYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuYWRkKGlkLCBmaWxlKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFja0J1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZCsrO1xuICAgICAgICAgICAgICAgIGZpbGVMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlUGFzdGVTdWNjZXNzOiBmdW5jdGlvbihibG9iLCBleHRTdXBwbGllZE5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZW5zaW9uID0gYmxvYi50eXBlLnNwbGl0KFwiL1wiKVsxXSwgbmFtZSA9IGV4dFN1cHBsaWVkTmFtZTtcbiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSB0aGlzLl9vcHRpb25zLnBhc3RlLmRlZmF1bHROYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuYW1lICs9IFwiLlwiICsgZXh0ZW5zaW9uO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZXMoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZURlbGV0ZVN1Y2Nlc3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pLnN0YXR1cyAhPT0gcXEuc3RhdHVzLkRFTEVURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkLS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkLS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuREVMRVRFRCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiRGVsZXRlIHJlcXVlc3QgZm9yICdcIiArIG5hbWUgKyBcIicgaGFzIHN1Y2NlZWRlZC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVEZWxldGVGYWlsZWQ6IGZ1bmN0aW9uKGlkLCB4aHJPclhkcikge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLkRFTEVURV9GQUlMRUQpO1xuICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiRGVsZXRlIHJlcXVlc3QgZm9yICdcIiArIG5hbWUgKyBcIicgaGFzIGZhaWxlZC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIXhock9yWGRyIHx8IHhock9yWGRyLndpdGhDcmVkZW50aWFscyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IoaWQsIG5hbWUsIFwiRGVsZXRlIHJlcXVlc3QgZmFpbGVkXCIsIHhock9yWGRyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKGlkLCBuYW1lLCBcIkRlbGV0ZSByZXF1ZXN0IGZhaWxlZCB3aXRoIHJlc3BvbnNlIGNvZGUgXCIgKyB4aHJPclhkci5zdGF0dXMsIHhock9yWGRyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRFeHRyYUJ1dHRvbjogZnVuY3Rpb24oc3BlYykge1xuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVVcGxvYWRCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICBhY2NlcHQ6IHNwZWMudmFsaWRhdGlvbi5hY2NlcHRGaWxlcyxcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnM6IHNwZWMudmFsaWRhdGlvbi5hbGxvd2VkRXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogc3BlYy5lbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBmb2xkZXJzOiBzcGVjLmZvbGRlcnMsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBzcGVjLm11bHRpcGxlLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogc3BlYy5maWxlSW5wdXRUaXRsZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2V4dHJhQnV0dG9uU3BlY3NbYnV0dG9uLmdldEJ1dHRvbklkKCldID0gc3BlYztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdEZvcm1TdXBwb3J0QW5kUGFyYW1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9mb3JtU3VwcG9ydCA9IHFxLkZvcm1TdXBwb3J0ICYmIG5ldyBxcS5Gb3JtU3VwcG9ydCh0aGlzLl9vcHRpb25zLmZvcm0sIHFxLmJpbmQodGhpcy51cGxvYWRTdG9yZWRGaWxlcywgdGhpcyksIHFxLmJpbmQodGhpcy5sb2csIHRoaXMpKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZm9ybVN1cHBvcnQgJiYgdGhpcy5fZm9ybVN1cHBvcnQuYXR0YWNoZWRUb0Zvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLnJlcXVlc3QucGFyYW1zLCB0aGlzLl9mb3JtU3VwcG9ydC5nZXRGb3JtSW5wdXRzQXNPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmF1dG9VcGxvYWQgPSB0aGlzLl9mb3JtU3VwcG9ydC5uZXdBdXRvVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZm9ybVN1cHBvcnQubmV3RW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMucmVxdWVzdC5lbmRwb2ludCA9IHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0VuZHBvaW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLnJlcXVlc3QucGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2lzRGVsZXRlUG9zc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICghcXEuRGVsZXRlRmlsZUFqYXhSZXF1ZXN0ZXIgfHwgIXRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuY29ycy5leHBlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuZGVsZXRlRmlsZUNvcnNYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5kZWxldGVGaWxlQ29yc1hkciAmJiB0aGlzLl9vcHRpb25zLmNvcnMuYWxsb3dYZHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2lzQWxsb3dlZEV4dGVuc2lvbjogZnVuY3Rpb24oYWxsb3dlZCwgZmlsZU5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoIWFsbG93ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5lYWNoKGFsbG93ZWQsIGZ1bmN0aW9uKGlkeCwgYWxsb3dlZEV4dCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcoYWxsb3dlZEV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHRSZWdleCA9IG5ldyBSZWdFeHAoXCJcXFxcLlwiICsgYWxsb3dlZEV4dCArIFwiJFwiLCBcImlcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZU5hbWUubWF0Y2goZXh0UmVnZXgpICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pdGVtRXJyb3I6IGZ1bmN0aW9uKGNvZGUsIG1heWJlTmFtZU9yTmFtZXMsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMuX29wdGlvbnMubWVzc2FnZXNbY29kZV0sIGFsbG93ZWRFeHRlbnNpb25zID0gW10sIG5hbWVzID0gW10uY29uY2F0KG1heWJlTmFtZU9yTmFtZXMpLCBuYW1lID0gbmFtZXNbMF0sIGJ1dHRvbklkID0gdGhpcy5fZ2V0QnV0dG9uSWQoaXRlbSksIHZhbGlkYXRpb25CYXNlID0gdGhpcy5fZ2V0VmFsaWRhdGlvbkJhc2UoYnV0dG9uSWQpLCBleHRlbnNpb25zRm9yTWVzc2FnZSwgcGxhY2Vob2xkZXJNYXRjaDtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiByKG5hbWUsIHJlcGxhY2VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UobmFtZSwgcmVwbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcS5lYWNoKHZhbGlkYXRpb25CYXNlLmFsbG93ZWRFeHRlbnNpb25zLCBmdW5jdGlvbihpZHgsIGFsbG93ZWRFeHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKGFsbG93ZWRFeHRlbnNpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9ucy5wdXNoKGFsbG93ZWRFeHRlbnNpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uc0Zvck1lc3NhZ2UgPSBhbGxvd2VkRXh0ZW5zaW9ucy5qb2luKFwiLCBcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICByKFwie2ZpbGV9XCIsIHRoaXMuX29wdGlvbnMuZm9ybWF0RmlsZU5hbWUobmFtZSkpO1xuICAgICAgICAgICAgICAgIHIoXCJ7ZXh0ZW5zaW9uc31cIiwgZXh0ZW5zaW9uc0Zvck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHIoXCJ7c2l6ZUxpbWl0fVwiLCB0aGlzLl9mb3JtYXRTaXplKHZhbGlkYXRpb25CYXNlLnNpemVMaW1pdCkpO1xuICAgICAgICAgICAgICAgIHIoXCJ7bWluU2l6ZUxpbWl0fVwiLCB0aGlzLl9mb3JtYXRTaXplKHZhbGlkYXRpb25CYXNlLm1pblNpemVMaW1pdCkpO1xuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyTWF0Y2ggPSBtZXNzYWdlLm1hdGNoKC8oXFx7XFx3K1xcfSkvZyk7XG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlaG9sZGVyTWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChwbGFjZWhvbGRlck1hdGNoLCBmdW5jdGlvbihpZHgsIHBsYWNlaG9sZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByKHBsYWNlaG9sZGVyLCBuYW1lc1tpZHhdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uRXJyb3IobnVsbCwgbmFtZSwgbWVzc2FnZSwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWFudWFsUmV0cnk6IGZ1bmN0aW9uKGlkLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vbkJlZm9yZU1hbnVhbFJldHJ5KGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkKys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLnJldHJ5KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlQWxsQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIG5vdEZpbmlzaGVkID0gdGhpcy5fZ2V0Tm90RmluaXNoZWQoKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX1NVQ0NFU1NGVUwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfRkFJTEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobm90RmluaXNoZWQgPT09IDAgJiYgKHRoaXMuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlLmxlbmd0aCB8fCB0aGlzLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZS5sZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbkFsbENvbXBsZXRlKHNlbGYuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlLCBzZWxmLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVIYW5kbGVJb3M4U2FmYXJpV29ya2Fyb3VuZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLndvcmthcm91bmRzLmlvczhTYWZhcmlVcGxvYWRzICYmIHFxLmlvczgwMCgpICYmIHFxLmlvc1NhZmFyaSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoc2VsZi5fb3B0aW9ucy5tZXNzYWdlcy51bnN1cHBvcnRlZEJyb3dzZXJJb3M4U2FmYXJpKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcih0aGlzLl9vcHRpb25zLm1lc3NhZ2VzLnVuc3VwcG9ydGVkQnJvd3NlcklvczhTYWZhcmkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVQYXJzZUFuZFNlbmRVcGxvYWRFcnJvcjogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHhociAmJiB4aHIuc3RhdHVzICE9PSAyMDAgJiYgIXJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKGlkLCBuYW1lLCBcIlhIUiByZXR1cm5lZCByZXNwb25zZSBjb2RlIFwiICsgeGhyLnN0YXR1cywgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlYXNvbiA9IHJlc3BvbnNlLmVycm9yID8gcmVzcG9uc2UuZXJyb3IgOiB0aGlzLl9vcHRpb25zLnRleHQuZGVmYXVsdFJlc3BvbnNlRXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKGlkLCBuYW1lLCBlcnJvclJlYXNvbiwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVQcm9jZXNzTmV4dEl0ZW1BZnRlck9uVmFsaWRhdGVDYWxsYmFjazogZnVuY3Rpb24odmFsaWRJdGVtLCBpdGVtcywgaW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA+IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZEl0ZW0gfHwgIXRoaXMuX29wdGlvbnMudmFsaWRhdGlvbi5zdG9wT25GaXJzdEludmFsaWRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uRGVzY3JpcHRvciA9IHNlbGYuX2dldFZhbGlkYXRpb25EZXNjcmlwdG9yKGl0ZW1zW2luZGV4XSksIGJ1dHRvbklkID0gc2VsZi5fZ2V0QnV0dG9uSWQoaXRlbXNbaW5kZXhdLmZpbGUpLCBidXR0b24gPSBzZWxmLl9nZXRCdXR0b24oYnV0dG9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25WYWxpZGF0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZChzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblZhbGlkYXRlLCBzZWxmLCB2YWxpZGF0aW9uRGVzY3JpcHRvciwgYnV0dG9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBxcS5iaW5kKHNlbGYuX29uVmFsaWRhdGVDYWxsYmFja1N1Y2Nlc3MsIHNlbGYsIGl0ZW1zLCBpbmRleCwgcGFyYW1zLCBlbmRwb2ludCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogcXEuYmluZChzZWxmLl9vblZhbGlkYXRlQ2FsbGJhY2tGYWlsdXJlLCBzZWxmLCBpdGVtcywgaW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBcIkl0ZW0gJ1wiICsgdmFsaWRhdGlvbkRlc2NyaXB0b3IubmFtZSArIFwiJywgc2l6ZTogXCIgKyB2YWxpZGF0aW9uRGVzY3JpcHRvci5zaXplXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdmFsaWRJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDtpbmRleCA8IGl0ZW1zLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2ZpbGVPckJsb2JSZWplY3RlZChpdGVtc1tpbmRleF0uaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkFsbENvbXBsZXRlOiBmdW5jdGlvbihzdWNjZXNzZnVsLCBmYWlsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFByb2dyZXNzICYmIHRoaXMuX3RvdGFsUHJvZ3Jlc3Mub25BbGxDb21wbGV0ZShzdWNjZXNzZnVsLCBmYWlsZWQsIHRoaXMuX3ByZXZlbnRSZXRyaWVzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkFsbENvbXBsZXRlKHFxLmV4dGVuZChbXSwgc3VjY2Vzc2Z1bCksIHFxLmV4dGVuZChbXSwgZmFpbGVkKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkF1dG9SZXRyeTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3BvbnNlSlNPTiwgeGhyLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBzZWxmLl9wcmV2ZW50UmV0cmllc1tpZF0gPSByZXNwb25zZUpTT05bc2VsZi5fb3B0aW9ucy5yZXRyeS5wcmV2ZW50UmV0cnlSZXNwb25zZVByb3BlcnR5XTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fc2hvdWxkQXV0b1JldHJ5KGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0cnlXYWl0UGVyaW9kID0gc2VsZi5fb3B0aW9ucy5yZXRyeS5hdXRvQXR0ZW1wdERlbGF5ICogMWUzO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYXliZVBhcnNlQW5kU2VuZFVwbG9hZEVycm9yLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uQXV0b1JldHJ5KGlkLCBuYW1lLCBzZWxmLl9hdXRvUmV0cmllc1tpZF0pO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbkJlZm9yZUF1dG9SZXRyeShpZCwgbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcmV0cnlUaW1lb3V0c1tpZF0gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coXCJTdGFydGluZyByZXRyeSBmb3IgXCIgKyBuYW1lICsgXCIuLi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2hhbmRsZXIucmV0cnkoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCByZXRyeVdhaXRQZXJpb2QpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQmVmb3JlQXV0b1JldHJ5OiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiV2FpdGluZyBcIiArIHRoaXMuX29wdGlvbnMucmV0cnkuYXV0b0F0dGVtcHREZWxheSArIFwiIHNlY29uZHMgYmVmb3JlIHJldHJ5aW5nIFwiICsgbmFtZSArIFwiLi4uXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkJlZm9yZU1hbnVhbFJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtTGltaXQgPSB0aGlzLl9jdXJyZW50SXRlbUxpbWl0LCBmaWxlTmFtZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcHJldmVudFJldHJpZXNbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUmV0cmllcyBhcmUgZm9yYmlkZGVuIGZvciBpZCBcIiArIGlkLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2hhbmRsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSB0aGlzLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25NYW51YWxSZXRyeShpZCwgZmlsZU5hbWUpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtTGltaXQgPiAwICYmIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQgKyAxID4gaXRlbUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJyZXRyeUZhaWxUb29NYW55SXRlbXNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJSZXRyeWluZyB1cGxvYWQgZm9yICdcIiArIGZpbGVOYW1lICsgXCInIChpZDogXCIgKyBpZCArIFwiKS4uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCInXCIgKyBpZCArIFwiJyBpcyBub3QgYSB2YWxpZCBmaWxlIElEXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQ2FuY2VsOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQtLTtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fcmV0cnlUaW1lb3V0c1tpZF0pO1xuICAgICAgICAgICAgICAgIHZhciBzdG9yZWRJdGVtSW5kZXggPSBxcS5pbmRleE9mKHRoaXMuX3N0b3JlZElkcywgaWQpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy5hdXRvVXBsb2FkICYmIHN0b3JlZEl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlZElkcy5zcGxpY2Uoc3RvcmVkSXRlbUluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5DQU5DRUxFRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXN1bHQsIHhocikge1xuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZC0tO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRF9GQUlMRUQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0W3RoaXMuX29wdGlvbnMucmV0cnkucHJldmVudFJldHJ5UmVzcG9uc2VQcm9wZXJ0eV0gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZlbnRSZXRyaWVzW2lkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnRodW1ibmFpbFVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGh1bWJuYWlsVXJsc1tpZF0gPSByZXN1bHQudGh1bWJuYWlsVXJsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkKys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FEX1NVQ0NFU1NGVUwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9tYXliZVBhcnNlQW5kU2VuZFVwbG9hZEVycm9yKGlkLCBuYW1lLCByZXN1bHQsIHhocik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5zdWNjZXNzID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkRlbGV0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLkRFTEVUSU5HKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25EZWxldGVDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUZhaWxlZChpZCwgeGhyT3JYZHIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZVN1Y2Nlc3MoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25JbnB1dENoYW5nZTogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZUluZGV4O1xuICAgICAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoZmlsZUluZGV4ID0gMDsgZmlsZUluZGV4IDwgaW5wdXQuZmlsZXMubGVuZ3RoOyBmaWxlSW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5ub3RhdGVXaXRoQnV0dG9uSWQoaW5wdXQuZmlsZXNbZmlsZUluZGV4XSwgaW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZXMoaW5wdXQuZmlsZXMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXQudmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGVzKGlucHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0aGlzLl9idXR0b25zLCBmdW5jdGlvbihpZHgsIGJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICBidXR0b24ucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25Qcm9ncmVzczogZnVuY3Rpb24oaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFByb2dyZXNzICYmIHRoaXMuX3RvdGFsUHJvZ3Jlc3Mub25JbmRpdmlkdWFsUHJvZ3Jlc3MoaWQsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdDogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgX29uU3VibWl0Q2FsbGJhY2tTdWNjZXNzOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29uU3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5TVUJNSVRURUQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29uU3VibWl0dGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuYXV0b1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblN1Ym1pdHRlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWRGaWxlKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZUZvckxhdGVyKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25TdWJtaXR0ZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0RGVsZXRlOiBmdW5jdGlvbihpZCwgb25TdWNjZXNzQ2FsbGJhY2ssIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciB1dWlkID0gdGhpcy5nZXRVdWlkKGlkKSwgYWRqdXN0ZWRPblN1Y2Nlc3NDYWxsYmFjaztcbiAgICAgICAgICAgICAgICBpZiAob25TdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgYWRqdXN0ZWRPblN1Y2Nlc3NDYWxsYmFjayA9IHFxLmJpbmQob25TdWNjZXNzQ2FsbGJhY2ssIHRoaXMsIGlkLCB1dWlkLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNEZWxldGVQb3NzaWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uU3VibWl0RGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZCh0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblN1Ym1pdERlbGV0ZSwgdGhpcywgaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBhZGp1c3RlZE9uU3VjY2Vzc0NhbGxiYWNrIHx8IHFxLmJpbmQodGhpcy5fZGVsZXRlSGFuZGxlci5zZW5kRGVsZXRlLCB0aGlzLCBpZCwgdXVpZCwgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGlkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIkRlbGV0ZSByZXF1ZXN0IGlnbm9yZWQgZm9yIElEIFwiICsgaWQgKyBcIiwgZGVsZXRlIGZlYXR1cmUgaXMgZGlzYWJsZWQgb3IgcmVxdWVzdCBub3QgcG9zc2libGUgXCIgKyBcImR1ZSB0byBDT1JTIG9uIGEgdXNlciBhZ2VudCB0aGF0IGRvZXMgbm90IHN1cHBvcnQgcHJlLWZsaWdodGluZy5cIiwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdHRlZDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgX29uVG90YWxQcm9ncmVzczogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uVG90YWxQcm9ncmVzcyhsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRQcmVwOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBfb25VcGxvYWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURJTkcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZENodW5rOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhKSB7fSxcbiAgICAgICAgICAgIF9vblVwbG9hZENodW5rU3VjY2VzczogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcHJldmVudFJldHJpZXNbaWRdICYmIHRoaXMuX29wdGlvbnMucmV0cnkuZW5hYmxlQXV0bykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvUmV0cmllc1tpZF0gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5QQVVTRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3JldHJ5VGltZW91dHNbaWRdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVmFsaWRhdGVCYXRjaENhbGxiYWNrRmFpbHVyZTogZnVuY3Rpb24oZmlsZVdyYXBwZXJzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goZmlsZVdyYXBwZXJzLCBmdW5jdGlvbihpZHgsIGZpbGVXcmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2ZpbGVPckJsb2JSZWplY3RlZChmaWxlV3JhcHBlci5pZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVmFsaWRhdGVCYXRjaENhbGxiYWNrU3VjY2VzczogZnVuY3Rpb24odmFsaWRhdGlvbkRlc2NyaXB0b3JzLCBpdGVtcywgcGFyYW1zLCBlbmRwb2ludCwgYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSwgaXRlbUxpbWl0ID0gdGhpcy5fY3VycmVudEl0ZW1MaW1pdCwgcHJvcG9zZWROZXRGaWxlc1VwbG9hZGVkT3JRdWV1ZWQgPSB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtTGltaXQgPT09IDAgfHwgcHJvcG9zZWROZXRGaWxlc1VwbG9hZGVkT3JRdWV1ZWQgPD0gaXRlbUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25WYWxpZGF0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uVmFsaWRhdGUsIHRoaXMsIHZhbGlkYXRpb25EZXNjcmlwdG9yc1swXSwgYnV0dG9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IHFxLmJpbmQodGhpcy5fb25WYWxpZGF0ZUNhbGxiYWNrU3VjY2VzcywgdGhpcywgaXRlbXMsIDAsIHBhcmFtcywgZW5kcG9pbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogcXEuYmluZCh0aGlzLl9vblZhbGlkYXRlQ2FsbGJhY2tGYWlsdXJlLCB0aGlzLCBpdGVtcywgMCwgcGFyYW1zLCBlbmRwb2ludCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogXCJJdGVtICdcIiArIGl0ZW1zWzBdLmZpbGUubmFtZSArIFwiJywgc2l6ZTogXCIgKyBpdGVtc1swXS5maWxlLnNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwibm9GaWxlc0Vycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25WYWxpZGF0ZUJhdGNoQ2FsbGJhY2tGYWlsdXJlKGl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdGhpcy5fb3B0aW9ucy5tZXNzYWdlcy50b29NYW55SXRlbXNFcnJvci5yZXBsYWNlKC9cXHtuZXRJdGVtc1xcfS9nLCBwcm9wb3NlZE5ldEZpbGVzVXBsb2FkZWRPclF1ZXVlZCkucmVwbGFjZSgvXFx7aXRlbUxpbWl0XFx9L2csIGl0ZW1MaW1pdCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2JhdGNoRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVmFsaWRhdGVDYWxsYmFja0ZhaWx1cmU6IGZ1bmN0aW9uKGl0ZW1zLCBpbmRleCwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0SW5kZXggPSBpbmRleCArIDE7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZU9yQmxvYlJlamVjdGVkKGl0ZW1zW2luZGV4XS5pZCwgaXRlbXNbaW5kZXhdLmZpbGUubmFtZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF5YmVQcm9jZXNzTmV4dEl0ZW1BZnRlck9uVmFsaWRhdGVDYWxsYmFjayhmYWxzZSwgaXRlbXMsIG5leHRJbmRleCwgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVmFsaWRhdGVDYWxsYmFja1N1Y2Nlc3M6IGZ1bmN0aW9uKGl0ZW1zLCBpbmRleCwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgbmV4dEluZGV4ID0gaW5kZXggKyAxLCB2YWxpZGF0aW9uRGVzY3JpcHRvciA9IHRoaXMuX2dldFZhbGlkYXRpb25EZXNjcmlwdG9yKGl0ZW1zW2luZGV4XSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsaWRhdGVGaWxlT3JCbG9iRGF0YShpdGVtc1tpbmRleF0sIHZhbGlkYXRpb25EZXNjcmlwdG9yKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl91cGxvYWQoaXRlbXNbaW5kZXhdLmlkLCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWF5YmVQcm9jZXNzTmV4dEl0ZW1BZnRlck9uVmFsaWRhdGVDYWxsYmFjayh0cnVlLCBpdGVtcywgbmV4dEluZGV4LCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWF5YmVQcm9jZXNzTmV4dEl0ZW1BZnRlck9uVmFsaWRhdGVDYWxsYmFjayhmYWxzZSwgaXRlbXMsIG5leHRJbmRleCwgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3ByZXBhcmVJdGVtc0ZvclVwbG9hZDogZnVuY3Rpb24oaXRlbXMsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcIm5vRmlsZXNFcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdGlvbkRlc2NyaXB0b3JzID0gdGhpcy5fZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3JzKGl0ZW1zKSwgYnV0dG9uSWQgPSB0aGlzLl9nZXRCdXR0b25JZChpdGVtc1swXS5maWxlKSwgYnV0dG9uID0gdGhpcy5fZ2V0QnV0dG9uKGJ1dHRvbklkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uVmFsaWRhdGVCYXRjaFwiLFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZCh0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblZhbGlkYXRlQmF0Y2gsIHRoaXMsIHZhbGlkYXRpb25EZXNjcmlwdG9ycywgYnV0dG9uKSxcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBxcS5iaW5kKHRoaXMuX29uVmFsaWRhdGVCYXRjaENhbGxiYWNrU3VjY2VzcywgdGhpcywgdmFsaWRhdGlvbkRlc2NyaXB0b3JzLCBpdGVtcywgcGFyYW1zLCBlbmRwb2ludCwgYnV0dG9uKSxcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBxcS5iaW5kKHRoaXMuX29uVmFsaWRhdGVCYXRjaENhbGxiYWNrRmFpbHVyZSwgdGhpcywgaXRlbXMpLFxuICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBcImJhdGNoIHZhbGlkYXRpb25cIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9wcmV2ZW50TGVhdmVJblByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zZVN1cHBvcnQuYXR0YWNoKHdpbmRvdywgXCJiZWZvcmV1bmxvYWRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXRJblByb2dyZXNzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucmV0dXJuVmFsdWUgPSBzZWxmLl9vcHRpb25zLm1lc3NhZ2VzLm9uTGVhdmU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fb3B0aW9ucy5tZXNzYWdlcy5vbkxlYXZlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3JlZnJlc2hTZXNzaW9uRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBvcHRpb25zID0gdGhpcy5fb3B0aW9ucy5zZXNzaW9uO1xuICAgICAgICAgICAgICAgIGlmIChxcS5TZXNzaW9uICYmIHRoaXMuX29wdGlvbnMuc2Vzc2lvbi5lbmRwb2ludCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JzOiB0aGlzLl9vcHRpb25zLmNvcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sb2cgPSBxcS5iaW5kKHRoaXMubG9nLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWRkRmlsZVJlY29yZCA9IHFxLmJpbmQodGhpcy5fYWRkQ2FubmVkRmlsZSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXNzaW9uID0gbmV3IHFxLlNlc3Npb24ob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Nlc3Npb24ucmVmcmVzaCgpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UsIHhock9yWGRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2Vzc2lvblJlcXVlc3RDb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uU2Vzc2lvblJlcXVlc3RDb21wbGV0ZShyZXNwb25zZSwgdHJ1ZSwgeGhyT3JYZHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UsIHhock9yWGRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25TZXNzaW9uUmVxdWVzdENvbXBsZXRlKHJlc3BvbnNlLCBmYWxzZSwgeGhyT3JYZHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2Vzc2lvblJlcXVlc3RDb21wbGV0ZTogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgICAgIF9zZXRTaXplOiBmdW5jdGlvbihpZCwgbmV3U2l6ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEudXBkYXRlU2l6ZShpZCwgbmV3U2l6ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxQcm9ncmVzcyAmJiB0aGlzLl90b3RhbFByb2dyZXNzLm9uTmV3U2l6ZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3VsZEF1dG9SZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YSA9IHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3ByZXZlbnRSZXRyaWVzW2lkXSAmJiB0aGlzLl9vcHRpb25zLnJldHJ5LmVuYWJsZUF1dG8gJiYgdXBsb2FkRGF0YS5zdGF0dXMgIT09IHFxLnN0YXR1cy5QQVVTRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2F1dG9SZXRyaWVzW2lkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvUmV0cmllc1tpZF0gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hdXRvUmV0cmllc1tpZF0gPCB0aGlzLl9vcHRpb25zLnJldHJ5Lm1heEF1dG9BdHRlbXB0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0b1JldHJpZXNbaWRdICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3N0b3JlRm9yTGF0ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RvcmVkSWRzLnB1c2goaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF90cmFja0J1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uSWQ7XG4gICAgICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQgPSB0aGlzLl9oYW5kbGVyLmdldEZpbGUoaWQpLnFxQnV0dG9uSWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQgPSB0aGlzLl9nZXRCdXR0b25JZCh0aGlzLl9oYW5kbGVyLmdldElucHV0KGlkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChidXR0b25JZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9idXR0b25JZHNGb3JGaWxlSWRzW2lkXSA9IGJ1dHRvbklkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdXBkYXRlRm9ybVN1cHBvcnRBbmRQYXJhbXM6IGZ1bmN0aW9uKGZvcm1FbGVtZW50T3JJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuZm9ybS5lbGVtZW50ID0gZm9ybUVsZW1lbnRPcklkO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1TdXBwb3J0ID0gcXEuRm9ybVN1cHBvcnQgJiYgbmV3IHFxLkZvcm1TdXBwb3J0KHRoaXMuX29wdGlvbnMuZm9ybSwgcXEuYmluZCh0aGlzLnVwbG9hZFN0b3JlZEZpbGVzLCB0aGlzKSwgcXEuYmluZCh0aGlzLmxvZywgdGhpcykpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JtU3VwcG9ydCAmJiB0aGlzLl9mb3JtU3VwcG9ydC5hdHRhY2hlZFRvRm9ybSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZS5hZGRSZWFkT25seShudWxsLCB0aGlzLl9mb3JtU3VwcG9ydC5nZXRGb3JtSW5wdXRzQXNPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmF1dG9VcGxvYWQgPSB0aGlzLl9mb3JtU3VwcG9ydC5uZXdBdXRvVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZm9ybVN1cHBvcnQubmV3RW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RW5kcG9pbnQodGhpcy5fZm9ybVN1cHBvcnQubmV3RW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF91cGxvYWQ6IGZ1bmN0aW9uKGlkLCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQYXJhbXMocGFyYW1zLCBpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVuZHBvaW50KGVuZHBvaW50LCBpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNoZWNrZWRDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25TdWJtaXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQodGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25TdWJtaXQsIHRoaXMsIGlkLCBuYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBxcS5iaW5kKHRoaXMuX29uU3VibWl0Q2FsbGJhY2tTdWNjZXNzLCB0aGlzLCBpZCwgbmFtZSksXG4gICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogcXEuYmluZCh0aGlzLl9maWxlT3JCbG9iUmVqZWN0ZWQsIHRoaXMsIGlkLCBuYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdXBsb2FkRmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2hhbmRsZXIudXBsb2FkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlFVRVVFRCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF91cGxvYWRTdG9yZWRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkVG9VcGxvYWQsIHN0aWxsU3VibWl0dGluZywgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHRoaXMuX3N0b3JlZElkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWRUb1VwbG9hZCA9IHRoaXMuX3N0b3JlZElkcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWRGaWxlKGlkVG9VcGxvYWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGlsbFN1Ym1pdHRpbmcgPSB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHFxLnN0YXR1cy5TVUJNSVRUSU5HXG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChzdGlsbFN1Ym1pdHRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEubG9nKFwiU3RpbGwgd2FpdGluZyBmb3IgXCIgKyBzdGlsbFN1Ym1pdHRpbmcgKyBcIiBmaWxlcyB0byBjbGVhciBzdWJtaXQgcXVldWUuIFdpbGwgcmUtcGFyc2Ugc3RvcmVkIElEcyBhcnJheSBzaG9ydGx5LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3VwbG9hZFN0b3JlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDFlMyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF92YWxpZGF0ZUZpbGVPckJsb2JEYXRhOiBmdW5jdGlvbihmaWxlV3JhcHBlciwgdmFsaWRhdGlvbkRlc2NyaXB0b3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGZpbGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVXcmFwcGVyLmZpbGUgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlV3JhcHBlci5maWxlLnJlZmVyZW5jZUJsb2I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVXcmFwcGVyLmZpbGU7XG4gICAgICAgICAgICAgICAgfSgpLCBuYW1lID0gdmFsaWRhdGlvbkRlc2NyaXB0b3IubmFtZSwgc2l6ZSA9IHZhbGlkYXRpb25EZXNjcmlwdG9yLnNpemUsIGJ1dHRvbklkID0gdGhpcy5fZ2V0QnV0dG9uSWQoZmlsZVdyYXBwZXIuZmlsZSksIHZhbGlkYXRpb25CYXNlID0gdGhpcy5fZ2V0VmFsaWRhdGlvbkJhc2UoYnV0dG9uSWQpLCB2YWxpZGl0eUNoZWNrZXIgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIHZhbGlkaXR5Q2hlY2tlci50aGVuKGZ1bmN0aW9uKCkge30sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9maWxlT3JCbG9iUmVqZWN0ZWQoZmlsZVdyYXBwZXIuaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZpbGVPcklucHV0KGZpbGUpICYmICF0aGlzLl9pc0FsbG93ZWRFeHRlbnNpb24odmFsaWRhdGlvbkJhc2UuYWxsb3dlZEV4dGVuc2lvbnMsIG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcInR5cGVFcnJvclwiLCBuYW1lLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5Q2hlY2tlci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uLmFsbG93RW1wdHkgJiYgc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJlbXB0eUVycm9yXCIsIG5hbWUsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRpdHlDaGVja2VyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPiAwICYmIHZhbGlkYXRpb25CYXNlLnNpemVMaW1pdCAmJiBzaXplID4gdmFsaWRhdGlvbkJhc2Uuc2l6ZUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcInNpemVFcnJvclwiLCBuYW1lLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5Q2hlY2tlci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzaXplID4gMCAmJiBzaXplIDwgdmFsaWRhdGlvbkJhc2UubWluU2l6ZUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcIm1pblNpemVFcnJvclwiLCBuYW1lLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5Q2hlY2tlci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChxcS5JbWFnZVZhbGlkYXRpb24gJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cyAmJiBxcS5pc0ZpbGUoZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3IHFxLkltYWdlVmFsaWRhdGlvbihmaWxlLCBxcS5iaW5kKHNlbGYubG9nLCBzZWxmKSkudmFsaWRhdGUodmFsaWRhdGlvbkJhc2UuaW1hZ2UpLnRoZW4odmFsaWRpdHlDaGVja2VyLnN1Y2Nlc3MsIGZ1bmN0aW9uKGVycm9yQ29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faXRlbUVycm9yKGVycm9yQ29kZSArIFwiSW1hZ2VFcnJvclwiLCBuYW1lLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5Q2hlY2tlci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5Q2hlY2tlci5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eUNoZWNrZXI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3dyYXBDYWxsYmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmLCBzYWZlQ2FsbGJhY2ssIHByb3A7XG4gICAgICAgICAgICAgICAgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgc2FmZUNhbGxiYWNrID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmFwcGx5KHNlbGYsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnID0gZXhjZXB0aW9uLm1lc3NhZ2UgfHwgZXhjZXB0aW9uLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhcIkNhdWdodCBleGNlcHRpb24gaW4gJ1wiICsgbmFtZSArIFwiJyBjYWxsYmFjayAtIFwiICsgZXJyb3JNc2csIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGZvciAocHJvcCBpbiB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcykge1xuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2tOYW1lLCBjYWxsYmFja0Z1bmM7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja05hbWUgPSBwcm9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tGdW5jID0gc2VsZi5fb3B0aW9ucy5jYWxsYmFja3NbY2FsbGJhY2tOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzW2NhbGxiYWNrTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FmZUNhbGxiYWNrKGNhbGxiYWNrTmFtZSwgY2FsbGJhY2tGdW5jLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSkoKTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS5GaW5lVXBsb2FkZXJCYXNpYyA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGJ1dHRvbjogbnVsbCxcbiAgICAgICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtYXhDb25uZWN0aW9uczogMyxcbiAgICAgICAgICAgICAgICBkaXNhYmxlQ2FuY2VsRm9yRm9ybVVwbG9hZHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGF1dG9VcGxvYWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgd2FybkJlZm9yZVVubG9hZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogXCIvc2VydmVyL3VwbG9hZFwiLFxuICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZVBhcmFtOiBcInFxZmlsZW5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VNdWx0aXBhcnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlucHV0TmFtZTogXCJxcWZpbGVcIixcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgb21pdERlZmF1bHRQYXJhbXM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNJbkJvZHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVTdWNjZXNzSnNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxGaWxlU2l6ZU5hbWU6IFwicXF0b3RhbGZpbGVzaXplXCIsXG4gICAgICAgICAgICAgICAgICAgIHV1aWROYW1lOiBcInFxdXVpZFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGFsbG93ZWRFeHRlbnNpb25zOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZUxpbWl0OiAwLFxuICAgICAgICAgICAgICAgICAgICBtaW5TaXplTGltaXQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1MaW1pdDogMCxcbiAgICAgICAgICAgICAgICAgICAgc3RvcE9uRmlyc3RJbnZhbGlkRmlsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYWNjZXB0RmlsZXM6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkhlaWdodDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbldpZHRoOiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFsbG93RW1wdHk6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3BvbnNlSlNPTiwgbWF5YmVYaHIpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkFsbENvbXBsZXRlOiBmdW5jdGlvbihzdWNjZXNzZnVsLCBmYWlsZWQpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZDogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZENodW5rOiBmdW5jdGlvbihpZCwgbmFtZSwgY2h1bmtEYXRhKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRDaHVua1N1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEsIHJlc3BvbnNlSlNPTiwgeGhyKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25SZXN1bWU6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgY2h1bmtEYXRhLCBjdXN0b21SZXN1bWVEYXRhKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24oaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVhc29uLCBtYXliZVhock9yWGRyKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25BdXRvUmV0cnk6IGZ1bmN0aW9uKGlkLCBuYW1lLCBhdHRlbXB0TnVtYmVyKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25NYW51YWxSZXRyeTogZnVuY3Rpb24oaWQsIG5hbWUpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblZhbGlkYXRlQmF0Y2g6IGZ1bmN0aW9uKGZpbGVPckJsb2JEYXRhKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZTogZnVuY3Rpb24oZmlsZU9yQmxvYkRhdGEpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblN1Ym1pdERlbGV0ZTogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZTogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZUNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblBhc3RlUmVjZWl2ZWQ6IGZ1bmN0aW9uKGJsb2IpIHt9LFxuICAgICAgICAgICAgICAgICAgICBvblN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25TZXNzaW9uUmVxdWVzdENvbXBsZXRlOiBmdW5jdGlvbihyZXNwb25zZSwgc3VjY2VzcywgeGhyT3JYZHIpIHt9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlRXJyb3I6IFwie2ZpbGV9IGhhcyBhbiBpbnZhbGlkIGV4dGVuc2lvbi4gVmFsaWQgZXh0ZW5zaW9uKHMpOiB7ZXh0ZW5zaW9uc30uXCIsXG4gICAgICAgICAgICAgICAgICAgIHNpemVFcnJvcjogXCJ7ZmlsZX0gaXMgdG9vIGxhcmdlLCBtYXhpbXVtIGZpbGUgc2l6ZSBpcyB7c2l6ZUxpbWl0fS5cIixcbiAgICAgICAgICAgICAgICAgICAgbWluU2l6ZUVycm9yOiBcIntmaWxlfSBpcyB0b28gc21hbGwsIG1pbmltdW0gZmlsZSBzaXplIGlzIHttaW5TaXplTGltaXR9LlwiLFxuICAgICAgICAgICAgICAgICAgICBlbXB0eUVycm9yOiBcIntmaWxlfSBpcyBlbXB0eSwgcGxlYXNlIHNlbGVjdCBmaWxlcyBhZ2FpbiB3aXRob3V0IGl0LlwiLFxuICAgICAgICAgICAgICAgICAgICBub0ZpbGVzRXJyb3I6IFwiTm8gZmlsZXMgdG8gdXBsb2FkLlwiLFxuICAgICAgICAgICAgICAgICAgICB0b29NYW55SXRlbXNFcnJvcjogXCJUb28gbWFueSBpdGVtcyAoe25ldEl0ZW1zfSkgd291bGQgYmUgdXBsb2FkZWQuICBJdGVtIGxpbWl0IGlzIHtpdGVtTGltaXR9LlwiLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHRJbWFnZUVycm9yOiBcIkltYWdlIGlzIHRvbyB0YWxsLlwiLFxuICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aEltYWdlRXJyb3I6IFwiSW1hZ2UgaXMgdG9vIHdpZGUuXCIsXG4gICAgICAgICAgICAgICAgICAgIG1pbkhlaWdodEltYWdlRXJyb3I6IFwiSW1hZ2UgaXMgbm90IHRhbGwgZW5vdWdoLlwiLFxuICAgICAgICAgICAgICAgICAgICBtaW5XaWR0aEltYWdlRXJyb3I6IFwiSW1hZ2UgaXMgbm90IHdpZGUgZW5vdWdoLlwiLFxuICAgICAgICAgICAgICAgICAgICByZXRyeUZhaWxUb29NYW55SXRlbXM6IFwiUmV0cnkgZmFpbGVkIC0geW91IGhhdmUgcmVhY2hlZCB5b3VyIGZpbGUgbGltaXQuXCIsXG4gICAgICAgICAgICAgICAgICAgIG9uTGVhdmU6IFwiVGhlIGZpbGVzIGFyZSBiZWluZyB1cGxvYWRlZCwgaWYgeW91IGxlYXZlIG5vdyB0aGUgdXBsb2FkIHdpbGwgYmUgY2FuY2VsZWQuXCIsXG4gICAgICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkQnJvd3NlcklvczhTYWZhcmk6IFwiVW5yZWNvdmVyYWJsZSBlcnJvciAtIHRoaXMgYnJvd3NlciBkb2VzIG5vdCBwZXJtaXQgZmlsZSB1cGxvYWRpbmcgb2YgYW55IGtpbmQgZHVlIHRvIHNlcmlvdXMgYnVncyBpbiBpT1M4IFNhZmFyaS4gIFBsZWFzZSB1c2UgaU9TOCBDaHJvbWUgdW50aWwgQXBwbGUgZml4ZXMgdGhlc2UgaXNzdWVzLlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXRyeToge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVBdXRvOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4QXV0b0F0dGVtcHRzOiAzLFxuICAgICAgICAgICAgICAgICAgICBhdXRvQXR0ZW1wdERlbGF5OiA1LFxuICAgICAgICAgICAgICAgICAgICBwcmV2ZW50UmV0cnlSZXNwb25zZVByb3BlcnR5OiBcInByZXZlbnRSZXRyeVwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkhvdmVyOiBcInFxLXVwbG9hZC1idXR0b24taG92ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRm9jdXM6IFwicXEtdXBsb2FkLWJ1dHRvbi1mb2N1c1wiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjaHVua2luZzoge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29uY3VycmVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWFuZGF0b3J5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1OYW1lczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4OiBcInFxcGFydGluZGV4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0Qnl0ZU9mZnNldDogXCJxcXBhcnRieXRlb2Zmc2V0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua1NpemU6IFwicXFjaHVua3NpemVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsRmlsZVNpemU6IFwicXF0b3RhbGZpbGVzaXplXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBhcnRzOiBcInFxdG90YWxwYXJ0c1wiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhcnRTaXplOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDJlNjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25QYXlsb2FkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRPblN0YXR1czogW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVzdW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICByZWNvcmRzRXhwaXJlSW46IDcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtTmFtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtaW5nOiBcInFxcmVzdW1lXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tS2V5czogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZvcm1hdEZpbGVOYW1lOiBmdW5jdGlvbihmaWxlT3JCbG9iTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZU9yQmxvYk5hbWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRSZXNwb25zZUVycm9yOiBcIlVwbG9hZCBmYWlsdXJlIHJlYXNvbiB1bmtub3duXCIsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVJbnB1dFRpdGxlOiBcImZpbGUgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgc2l6ZVN5bWJvbHM6IFsgXCJrQlwiLCBcIk1CXCIsIFwiR0JcIiwgXCJUQlwiLCBcIlBCXCIsIFwiRUJcIiBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkZWxldGVGaWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBcIi9zZXJ2ZXIvdXBsb2FkXCIsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHt9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb3JzOiB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc2VuZENyZWRlbnRpYWxzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dYZHI6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBibG9iczoge1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TmFtZTogXCJtaXNjX2RhdGFcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcGFzdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE5hbWU6IFwicGFzdGVkX2ltYWdlXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNhbWVyYToge1xuICAgICAgICAgICAgICAgICAgICBpb3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBidXR0b246IG51bGxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGV4dHJhQnV0dG9uczogW10sXG4gICAgICAgICAgICAgICAgc2Vzc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hPblJlc2V0OiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmb3JtOiB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IFwicXEtZm9ybVwiLFxuICAgICAgICAgICAgICAgICAgICBhdXRvVXBsb2FkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJjZXB0U3VibWl0OiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzY2FsaW5nOiB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHNlbmRPcmlnaW5hbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3JpZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VHlwZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFF1YWxpdHk6IDgwLFxuICAgICAgICAgICAgICAgICAgICBmYWlsdXJlVGV4dDogXCJGYWlsZWQgdG8gc2NhbGVcIixcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZUV4aWY6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzaXplczogW11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHdvcmthcm91bmRzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlvc0VtcHR5VmlkZW9zOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpb3M4U2FmYXJpVXBsb2FkczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW9zOEJyb3dzZXJDcmFzaDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcXEuZXh0ZW5kKHRoaXMuX29wdGlvbnMsIG8sIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5fYnV0dG9ucyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fZXh0cmFCdXR0b25TcGVjcyA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fYnV0dG9uSWRzRm9yRmlsZUlkcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fd3JhcENhbGxiYWNrcygpO1xuICAgICAgICAgICAgdGhpcy5fZGlzcG9zZVN1cHBvcnQgPSBuZXcgcXEuRGlzcG9zZVN1cHBvcnQoKTtcbiAgICAgICAgICAgIHRoaXMuX3N0b3JlZElkcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fYXV0b1JldHJpZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3JldHJ5VGltZW91dHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3ByZXZlbnRSZXRyaWVzID0gW107XG4gICAgICAgICAgICB0aGlzLl90aHVtYm5haWxVcmxzID0gW107XG4gICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkID0gMDtcbiAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkID0gMDtcbiAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEgPSB0aGlzLl9jcmVhdGVVcGxvYWREYXRhVHJhY2tlcigpO1xuICAgICAgICAgICAgdGhpcy5faW5pdEZvcm1TdXBwb3J0QW5kUGFyYW1zKCk7XG4gICAgICAgICAgICB0aGlzLl9jdXN0b21IZWFkZXJzU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSh0aGlzLl9vcHRpb25zLnJlcXVlc3QuY3VzdG9tSGVhZGVycyk7XG4gICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlQ3VzdG9tSGVhZGVyc1N0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmN1c3RvbUhlYWRlcnMpO1xuICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZVBhcmFtc1N0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLnBhcmFtcyk7XG4gICAgICAgICAgICB0aGlzLl9lbmRwb2ludFN0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5yZXF1ZXN0LmVuZHBvaW50KTtcbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVFbmRwb2ludFN0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmVuZHBvaW50KTtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIgPSB0aGlzLl9jcmVhdGVVcGxvYWRIYW5kbGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9kZWxldGVIYW5kbGVyID0gcXEuRGVsZXRlRmlsZUFqYXhSZXF1ZXN0ZXIgJiYgdGhpcy5fY3JlYXRlRGVsZXRlSGFuZGxlcigpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdEJ1dHRvbklkID0gdGhpcy5fY3JlYXRlVXBsb2FkQnV0dG9uKHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy5fb3B0aW9ucy5idXR0b24sXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLl9vcHRpb25zLnRleHQuZmlsZUlucHV0VGl0bGVcbiAgICAgICAgICAgICAgICB9KS5nZXRCdXR0b25JZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGVFeHRyYUJ1dHRvblNwZWNzKCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYW1lcmFBY2Nlc3MoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLnBhc3RlLnRhcmdldEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuUGFzdGVTdXBwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Bhc3RlSGFuZGxlciA9IHRoaXMuX2NyZWF0ZVBhc3RlSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUGFzdGUgc3VwcG9ydCBtb2R1bGUgbm90IGZvdW5kXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy53YXJuQmVmb3JlVW5sb2FkICYmIHRoaXMuX3ByZXZlbnRMZWF2ZUluUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIHRoaXMuX2ltYWdlR2VuZXJhdG9yID0gcXEuSW1hZ2VHZW5lcmF0b3IgJiYgbmV3IHFxLkltYWdlR2VuZXJhdG9yKHFxLmJpbmQodGhpcy5sb2csIHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hTZXNzaW9uRGF0YSgpO1xuICAgICAgICAgICAgdGhpcy5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX2ZhaWxlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICB0aGlzLl9zY2FsZXIgPSBxcS5TY2FsZXIgJiYgbmV3IHFxLlNjYWxlcih0aGlzLl9vcHRpb25zLnNjYWxpbmcsIHFxLmJpbmQodGhpcy5sb2csIHRoaXMpKSB8fCB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9zY2FsZXIuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1c3RvbU5ld0ZpbGVIYW5kbGVyID0gcXEuYmluZCh0aGlzLl9zY2FsZXIuaGFuZGxlTmV3RmlsZSwgdGhpcy5fc2NhbGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxcS5Ub3RhbFByb2dyZXNzICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLnByb2dyZXNzQmFyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxQcm9ncmVzcyA9IG5ldyBxcS5Ub3RhbFByb2dyZXNzKHFxLmJpbmQodGhpcy5fb25Ub3RhbFByb2dyZXNzLCB0aGlzKSwgZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gc2VsZi5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnRyeSAmJiBlbnRyeS5zaXplIHx8IDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50SXRlbUxpbWl0ID0gdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uLml0ZW1MaW1pdDtcbiAgICAgICAgICAgIHRoaXMuX2N1c3RvbVJlc3VtZURhdGFTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLkZpbmVVcGxvYWRlckJhc2ljLnByb3RvdHlwZSA9IHFxLmJhc2VQdWJsaWNBcGk7XG4gICAgICAgIHFxLmV4dGVuZChxcS5GaW5lVXBsb2FkZXJCYXNpYy5wcm90b3R5cGUsIHFxLmJhc2VQcml2YXRlQXBpKTtcbiAgICB9KSgpO1xuICAgIHFxLkFqYXhSZXF1ZXN0ZXIgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgbG9nLCBzaG91bGRQYXJhbXNCZUluUXVlcnlTdHJpbmcsIHF1ZXVlID0gW10sIHJlcXVlc3REYXRhID0ge30sIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBhY2NlcHRIZWFkZXI6IG51bGwsXG4gICAgICAgICAgICB2YWxpZE1ldGhvZHM6IFsgXCJQQVRDSFwiLCBcIlBPU1RcIiwgXCJQVVRcIiBdLFxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IDMsXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IHt9LFxuICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHt9LFxuICAgICAgICAgICAgbWFuZGF0ZWRQYXJhbXM6IHt9LFxuICAgICAgICAgICAgYWxsb3dYUmVxdWVzdGVkV2l0aEFuZENhY2hlQ29udHJvbDogdHJ1ZSxcbiAgICAgICAgICAgIHN1Y2Nlc3NmdWxSZXNwb25zZUNvZGVzOiB7XG4gICAgICAgICAgICAgICAgREVMRVRFOiBbIDIwMCwgMjAyLCAyMDQgXSxcbiAgICAgICAgICAgICAgICBQQVRDSDogWyAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCBdLFxuICAgICAgICAgICAgICAgIFBPU1Q6IFsgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQgXSxcbiAgICAgICAgICAgICAgICBQVVQ6IFsgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQgXSxcbiAgICAgICAgICAgICAgICBHRVQ6IFsgMjAwIF1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb3JzOiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbmRDcmVkZW50aWFsczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHt9LFxuICAgICAgICAgICAgb25TZW5kOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHt9LFxuICAgICAgICAgICAgb25Qcm9ncmVzczogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIGxvZyA9IG9wdGlvbnMubG9nO1xuICAgICAgICBpZiAocXEuaW5kZXhPZihvcHRpb25zLnZhbGlkTWV0aG9kcywgb3B0aW9ucy5tZXRob2QpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ1wiICsgb3B0aW9ucy5tZXRob2QgKyBcIicgaXMgbm90IGEgc3VwcG9ydGVkIG1ldGhvZCBmb3IgdGhpcyB0eXBlIG9mIHJlcXVlc3QhXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzU2ltcGxlTWV0aG9kKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2YoWyBcIkdFVFwiLCBcIlBPU1RcIiwgXCJIRUFEXCIgXSwgb3B0aW9ucy5tZXRob2QpID49IDA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY29udGFpbnNOb25TaW1wbGVIZWFkZXJzKGhlYWRlcnMpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluc05vblNpbXBsZSA9IGZhbHNlO1xuICAgICAgICAgICAgcXEuZWFjaChjb250YWluc05vblNpbXBsZSwgZnVuY3Rpb24oaWR4LCBoZWFkZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaW5kZXhPZihbIFwiQWNjZXB0XCIsIFwiQWNjZXB0LUxhbmd1YWdlXCIsIFwiQ29udGVudC1MYW5ndWFnZVwiLCBcIkNvbnRlbnQtVHlwZVwiIF0sIGhlYWRlcikgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zTm9uU2ltcGxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zTm9uU2ltcGxlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzWGRyKHhocikge1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuY29ycy5leHBlY3RlZCAmJiB4aHIud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29yc0FqYXhUcmFuc3BvcnQoKSB7XG4gICAgICAgICAgICB2YXIgeGhyT3JYZHI7XG4gICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0IHx8IHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgeGhyT3JYZHIgPSBxcS5jcmVhdGVYaHJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIGlmICh4aHJPclhkci53aXRoQ3JlZGVudGlhbHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkciA9IG5ldyBYRG9tYWluUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkci5vbmxvYWQgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkci5vbmVycm9yID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIub250aW1lb3V0ID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIub25wcm9ncmVzcyA9IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHhock9yWGRyO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFhock9yWGRyKGlkLCBzdXBwbGllZFhocikge1xuICAgICAgICAgICAgdmFyIHhock9yWGRyID0gcmVxdWVzdERhdGFbaWRdICYmIHJlcXVlc3REYXRhW2lkXS54aHI7XG4gICAgICAgICAgICBpZiAoIXhock9yWGRyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN1cHBsaWVkWGhyKSB7XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyID0gc3VwcGxpZWRYaHI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29ycy5leHBlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIgPSBnZXRDb3JzQWpheFRyYW5zcG9ydCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIgPSBxcS5jcmVhdGVYaHJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhW2lkXS54aHIgPSB4aHJPclhkcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB4aHJPclhkcjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkZXF1ZXVlKGlkKSB7XG4gICAgICAgICAgICB2YXIgaSA9IHFxLmluZGV4T2YocXVldWUsIGlkKSwgbWF4ID0gb3B0aW9ucy5tYXhDb25uZWN0aW9ucywgbmV4dElkO1xuICAgICAgICAgICAgZGVsZXRlIHJlcXVlc3REYXRhW2lkXTtcbiAgICAgICAgICAgIHF1ZXVlLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGlmIChxdWV1ZS5sZW5ndGggPj0gbWF4ICYmIGkgPCBtYXgpIHtcbiAgICAgICAgICAgICAgICBuZXh0SWQgPSBxdWV1ZVttYXggLSAxXTtcbiAgICAgICAgICAgICAgICBzZW5kUmVxdWVzdChuZXh0SWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG9uQ29tcGxldGUoaWQsIHhkckVycm9yKSB7XG4gICAgICAgICAgICB2YXIgeGhyID0gZ2V0WGhyT3JYZHIoaWQpLCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCwgaXNFcnJvciA9IHhkckVycm9yID09PSB0cnVlO1xuICAgICAgICAgICAgZGVxdWV1ZShpZCk7XG4gICAgICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZyhtZXRob2QgKyBcIiByZXF1ZXN0IGZvciBcIiArIGlkICsgXCIgaGFzIGZhaWxlZFwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghaXNYZHIoeGhyKSAmJiAhaXNSZXNwb25zZVN1Y2Nlc3NmdWwoeGhyLnN0YXR1cykpIHtcbiAgICAgICAgICAgICAgICBpc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBsb2cobWV0aG9kICsgXCIgcmVxdWVzdCBmb3IgXCIgKyBpZCArIFwiIGhhcyBmYWlsZWQgLSByZXNwb25zZSBjb2RlIFwiICsgeGhyLnN0YXR1cywgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMub25Db21wbGV0ZShpZCwgeGhyLCBpc0Vycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRQYXJhbXMoaWQpIHtcbiAgICAgICAgICAgIHZhciBvbkRlbWFuZFBhcmFtcyA9IHJlcXVlc3REYXRhW2lkXS5hZGRpdGlvbmFsUGFyYW1zLCBtYW5kYXRlZFBhcmFtcyA9IG9wdGlvbnMubWFuZGF0ZWRQYXJhbXMsIHBhcmFtcztcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnBhcmFtc1N0b3JlLmdldCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IG9wdGlvbnMucGFyYW1zU3RvcmUuZ2V0KGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvbkRlbWFuZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHFxLmVhY2gob25EZW1hbmRQYXJhbXMsIGZ1bmN0aW9uKG5hbWUsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tuYW1lXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHFxLmVhY2gobWFuZGF0ZWRQYXJhbXMsIGZ1bmN0aW9uKG5hbWUsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tuYW1lXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2VuZFJlcXVlc3QoaWQsIG9wdFhocikge1xuICAgICAgICAgICAgdmFyIHhociA9IGdldFhock9yWGRyKGlkLCBvcHRYaHIpLCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCwgcGFyYW1zID0gZ2V0UGFyYW1zKGlkKSwgcGF5bG9hZCA9IHJlcXVlc3REYXRhW2lkXS5wYXlsb2FkLCB1cmw7XG4gICAgICAgICAgICBvcHRpb25zLm9uU2VuZChpZCk7XG4gICAgICAgICAgICB1cmwgPSBjcmVhdGVVcmwoaWQsIHBhcmFtcywgcmVxdWVzdERhdGFbaWRdLmFkZGl0aW9uYWxRdWVyeVBhcmFtcyk7XG4gICAgICAgICAgICBpZiAoaXNYZHIoeGhyKSkge1xuICAgICAgICAgICAgICAgIHhoci5vbmxvYWQgPSBnZXRYZHJMb2FkSGFuZGxlcihpZCk7XG4gICAgICAgICAgICAgICAgeGhyLm9uZXJyb3IgPSBnZXRYZHJFcnJvckhhbmRsZXIoaWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZ2V0WGhyUmVhZHlTdGF0ZUNoYW5nZUhhbmRsZXIoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVnaXN0ZXJGb3JVcGxvYWRQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICB4aHIub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5jb3JzLmV4cGVjdGVkICYmIG9wdGlvbnMuY29ycy5zZW5kQ3JlZGVudGlhbHMgJiYgIWlzWGRyKHhocikpIHtcbiAgICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldEhlYWRlcnMoaWQpO1xuICAgICAgICAgICAgbG9nKFwiU2VuZGluZyBcIiArIG1ldGhvZCArIFwiIHJlcXVlc3QgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgaWYgKHBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZChwYXlsb2FkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvdWxkUGFyYW1zQmVJblF1ZXJ5U3RyaW5nIHx8ICFwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMgJiYgb3B0aW9ucy5jb250ZW50VHlwZSAmJiBvcHRpb25zLmNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQocXEub2JqMnVybChwYXJhbXMsIFwiXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyYW1zICYmIG9wdGlvbnMuY29udGVudFR5cGUgJiYgb3B0aW9ucy5jb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJhcHBsaWNhdGlvbi9qc29uXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQocGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB4aHI7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXJsKGlkLCBwYXJhbXMsIGFkZGl0aW9uYWxRdWVyeVBhcmFtcykge1xuICAgICAgICAgICAgdmFyIGVuZHBvaW50ID0gb3B0aW9ucy5lbmRwb2ludFN0b3JlLmdldChpZCksIGFkZFRvUGF0aCA9IHJlcXVlc3REYXRhW2lkXS5hZGRUb1BhdGg7XG4gICAgICAgICAgICBpZiAoYWRkVG9QYXRoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50ICs9IFwiL1wiICsgYWRkVG9QYXRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNob3VsZFBhcmFtc0JlSW5RdWVyeVN0cmluZyAmJiBwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IHFxLm9iajJ1cmwocGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWRkaXRpb25hbFF1ZXJ5UGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBxcS5vYmoydXJsKGFkZGl0aW9uYWxRdWVyeVBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVuZHBvaW50O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFhoclJlYWR5U3RhdGVDaGFuZ2VIYW5kbGVyKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGdldFhock9yWGRyKGlkKS5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJGb3JVcGxvYWRQcm9ncmVzcyhpZCkge1xuICAgICAgICAgICAgdmFyIG9uUHJvZ3Jlc3MgPSBvcHRpb25zLm9uUHJvZ3Jlc3M7XG4gICAgICAgICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICAgICAgICAgIGdldFhock9yWGRyKGlkKS51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUubGVuZ3RoQ29tcHV0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzcyhpZCwgZS5sb2FkZWQsIGUudG90YWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRYZHJMb2FkSGFuZGxlcihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoaWQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRYZHJFcnJvckhhbmRsZXIoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKGlkLCB0cnVlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2V0SGVhZGVycyhpZCkge1xuICAgICAgICAgICAgdmFyIHhociA9IGdldFhock9yWGRyKGlkKSwgY3VzdG9tSGVhZGVycyA9IG9wdGlvbnMuY3VzdG9tSGVhZGVycywgb25EZW1hbmRIZWFkZXJzID0gcmVxdWVzdERhdGFbaWRdLmFkZGl0aW9uYWxIZWFkZXJzIHx8IHt9LCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCwgYWxsSGVhZGVycyA9IHt9O1xuICAgICAgICAgICAgaWYgKCFpc1hkcih4aHIpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5hY2NlcHRIZWFkZXIgJiYgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIiwgb3B0aW9ucy5hY2NlcHRIZWFkZXIpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFsbG93WFJlcXVlc3RlZFdpdGhBbmRDYWNoZUNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmNvcnMuZXhwZWN0ZWQgfHwgKCFpc1NpbXBsZU1ldGhvZCgpIHx8IGNvbnRhaW5zTm9uU2ltcGxlSGVhZGVycyhjdXN0b21IZWFkZXJzKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1SZXF1ZXN0ZWQtV2l0aFwiLCBcIlhNTEh0dHBSZXF1ZXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDYWNoZS1Db250cm9sXCIsIFwibm8tY2FjaGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29udGVudFR5cGUgJiYgKG1ldGhvZCA9PT0gXCJQT1NUXCIgfHwgbWV0aG9kID09PSBcIlBVVFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBvcHRpb25zLmNvbnRlbnRUeXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGFsbEhlYWRlcnMsIHFxLmlzRnVuY3Rpb24oY3VzdG9tSGVhZGVycykgPyBjdXN0b21IZWFkZXJzKGlkKSA6IGN1c3RvbUhlYWRlcnMpO1xuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChhbGxIZWFkZXJzLCBvbkRlbWFuZEhlYWRlcnMpO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goYWxsSGVhZGVycywgZnVuY3Rpb24obmFtZSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIHZhbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNSZXNwb25zZVN1Y2Nlc3NmdWwocmVzcG9uc2VDb2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihvcHRpb25zLnN1Y2Nlc3NmdWxSZXNwb25zZUNvZGVzW29wdGlvbnMubWV0aG9kXSwgcmVzcG9uc2VDb2RlKSA+PSAwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHByZXBhcmVUb1NlbmQoaWQsIG9wdFhociwgYWRkVG9QYXRoLCBhZGRpdGlvbmFsUGFyYW1zLCBhZGRpdGlvbmFsUXVlcnlQYXJhbXMsIGFkZGl0aW9uYWxIZWFkZXJzLCBwYXlsb2FkKSB7XG4gICAgICAgICAgICByZXF1ZXN0RGF0YVtpZF0gPSB7XG4gICAgICAgICAgICAgICAgYWRkVG9QYXRoOiBhZGRUb1BhdGgsXG4gICAgICAgICAgICAgICAgYWRkaXRpb25hbFBhcmFtczogYWRkaXRpb25hbFBhcmFtcyxcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUXVlcnlQYXJhbXM6IGFkZGl0aW9uYWxRdWVyeVBhcmFtcyxcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsSGVhZGVyczogYWRkaXRpb25hbEhlYWRlcnMsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBsZW4gPSBxdWV1ZS5wdXNoKGlkKTtcbiAgICAgICAgICAgIGlmIChsZW4gPD0gb3B0aW9ucy5tYXhDb25uZWN0aW9ucykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZW5kUmVxdWVzdChpZCwgb3B0WGhyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzaG91bGRQYXJhbXNCZUluUXVlcnlTdHJpbmcgPSBvcHRpb25zLm1ldGhvZCA9PT0gXCJHRVRcIiB8fCBvcHRpb25zLm1ldGhvZCA9PT0gXCJERUxFVEVcIjtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGluaXRUcmFuc3BvcnQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhdGgsIHBhcmFtcywgaGVhZGVycywgcGF5bG9hZCwgY2FjaGVCdXN0ZXIsIGFkZGl0aW9uYWxRdWVyeVBhcmFtcztcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB3aXRoUGF0aDogZnVuY3Rpb24oYXBwZW5kVG9QYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gYXBwZW5kVG9QYXRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHdpdGhQYXJhbXM6IGZ1bmN0aW9uKGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IGFkZGl0aW9uYWxQYXJhbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2l0aFF1ZXJ5UGFyYW1zOiBmdW5jdGlvbihfYWRkaXRpb25hbFF1ZXJ5UGFyYW1zXykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zID0gX2FkZGl0aW9uYWxRdWVyeVBhcmFtc187XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2l0aEhlYWRlcnM6IGZ1bmN0aW9uKGFkZGl0aW9uYWxIZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzID0gYWRkaXRpb25hbEhlYWRlcnM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2l0aFBheWxvYWQ6IGZ1bmN0aW9uKHRoZVBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSB0aGVQYXlsb2FkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHdpdGhDYWNoZUJ1c3RlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUJ1c3RlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24ob3B0WGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVCdXN0ZXIgJiYgcXEuaW5kZXhPZihbIFwiR0VUXCIsIFwiREVMRVRFXCIgXSwgb3B0aW9ucy5tZXRob2QpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMucXF0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmVwYXJlVG9TZW5kKGlkLCBvcHRYaHIsIHBhdGgsIHBhcmFtcywgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zLCBoZWFkZXJzLCBwYXlsb2FkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgZGVxdWV1ZShpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBwcm94eSA9IHNwZWMucHJveHksIGZpbGVTdGF0ZSA9IHt9LCBvbkNhbmNlbCA9IHByb3h5Lm9uQ2FuY2VsLCBnZXROYW1lID0gcHJveHkuZ2V0TmFtZTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oaWQsIGZpbGVJdGVtKSB7XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlW2lkXSA9IGZpbGVJdGVtO1xuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZVtpZF0udGVtcCA9IHt9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGNhbmNlbEZpbmFsaXphdGlvbkVmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCksIG9uQ2FuY2VsUmV0VmFsID0gb25DYW5jZWwoaWQsIGdldE5hbWUoaWQpLCBjYW5jZWxGaW5hbGl6YXRpb25FZmZvcnQpO1xuICAgICAgICAgICAgICAgIG9uQ2FuY2VsUmV0VmFsLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3RhdGVbaWRdLmNhbmNlbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsRmluYWxpemF0aW9uRWZmb3J0LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleHB1bmdlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWxlU3RhdGVbaWRdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFRoaXJkUGFydHlGaWxlSWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVTdGF0ZVtpZF0ua2V5O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVTdGF0ZVtpZF0gIT09IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlID0ge307XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldEZpbGVTdGF0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVN0YXRlW2lkXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0VGhpcmRQYXJ0eUZpbGVJZDogZnVuY3Rpb24oaWQsIHRoaXJkUGFydHlGaWxlSWQpIHtcbiAgICAgICAgICAgICAgICBmaWxlU3RhdGVbaWRdLmtleSA9IHRoaXJkUGFydHlGaWxlSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3dhc0NhbmNlbGVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIWZpbGVTdGF0ZVtpZF0uY2FuY2VsZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuVXBsb2FkSGFuZGxlckNvbnRyb2xsZXIgPSBmdW5jdGlvbihvLCBuYW1lc3BhY2UpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBjb250cm9sbGVyID0gdGhpcywgY2h1bmtpbmdQb3NzaWJsZSA9IGZhbHNlLCBjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSA9IGZhbHNlLCBjaHVua2luZywgcHJldmVudFJldHJ5UmVzcG9uc2UsIGxvZywgaGFuZGxlciwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHBhcmFtc1N0b3JlOiB7fSxcbiAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiAzLFxuICAgICAgICAgICAgY2h1bmtpbmc6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtdWx0aXBsZToge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHt9LFxuICAgICAgICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCBsb2FkZWQsIHRvdGFsKSB7fSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgcmVzcG9uc2UsIHhocikge30sXG4gICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24oaWQsIGZpbGVOYW1lKSB7fSxcbiAgICAgICAgICAgIG9uVXBsb2FkUHJlcDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgb25VcGxvYWQ6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSkge30sXG4gICAgICAgICAgICBvblVwbG9hZENodW5rOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIGNodW5rRGF0YSkge30sXG4gICAgICAgICAgICBvblVwbG9hZENodW5rU3VjY2VzczogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSwgcmVzcG9uc2UsIHhocikge30sXG4gICAgICAgICAgICBvbkF1dG9SZXRyeTogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCByZXNwb25zZSwgeGhyKSB7fSxcbiAgICAgICAgICAgIG9uUmVzdW1lOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIGNodW5rRGF0YSwgY3VzdG9tUmVzdW1lRGF0YSkge30sXG4gICAgICAgICAgICBvblV1aWRDaGFuZ2VkOiBmdW5jdGlvbihpZCwgbmV3VXVpZCkge30sXG4gICAgICAgICAgICBnZXROYW1lOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBzZXRTaXplOiBmdW5jdGlvbihpZCwgbmV3U2l6ZSkge30sXG4gICAgICAgICAgICBpc1F1ZXVlZDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgZ2V0SWRzSW5Qcm94eUdyb3VwOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBnZXRJZHNJbkJhdGNoOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBpc0luUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkKSB7fVxuICAgICAgICB9LCBjaHVua2VkID0ge1xuICAgICAgICAgICAgZG9uZTogZnVuY3Rpb24oaWQsIGNodW5rSWR4LCByZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rRGF0YSA9IGhhbmRsZXIuX2dldENodW5rRGF0YShpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuYXR0ZW1wdGluZ1Jlc3VtZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuY2h1bmtQcm9ncmVzc1tjaHVua0lkeF07XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5sb2FkZWQgKz0gY2h1bmtEYXRhLnNpemU7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vblVwbG9hZENodW5rU3VjY2VzcyhpZCwgaGFuZGxlci5fZ2V0Q2h1bmtEYXRhRm9yQ2FsbGJhY2soY2h1bmtEYXRhKSwgcmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmluYWxpemU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLmdldFNpemUoaWQpLCBuYW1lID0gb3B0aW9ucy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBsb2coXCJBbGwgY2h1bmtzIGhhdmUgYmVlbiB1cGxvYWRlZCBmb3IgXCIgKyBpZCArIFwiIC0gZmluYWxpemluZy4uLi5cIik7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5maW5hbGl6ZUNodW5rcyhpZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkZpbmFsaXplIHN1Y2Nlc3NmdWwgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9ybWFpemVkUmVzcG9uc2UgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uUHJvZ3Jlc3MoaWQsIG5hbWUsIHNpemUsIHNpemUpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9tYXliZURlbGV0ZVBlcnNpc3RlZENodW5rRGF0YShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCBub3JtYWl6ZWRSZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBub3JtYWxpemVkUmVzcG9uc2UgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSBmaW5hbGl6aW5nIGNodW5rcyBmb3IgZmlsZSBJRCBcIiArIGlkICsgXCIgLSBcIiArIG5vcm1hbGl6ZWRSZXNwb25zZS5lcnJvciwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRSZXNwb25zZS5yZXNldCB8fCB4aHIgJiYgb3B0aW9ucy5jaHVua2luZy5zdWNjZXNzLnJlc2V0T25TdGF0dXMuaW5kZXhPZih4aHIuc3RhdHVzKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnJlc2V0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMub25BdXRvUmV0cnkoaWQsIG5hbWUsIG5vcm1hbGl6ZWRSZXNwb25zZSwgeGhyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIG5vcm1hbGl6ZWRSZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhbmRsZUZhaWx1cmU6IGZ1bmN0aW9uKGNodW5rSWR4LCBpZCwgcmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gb3B0aW9ucy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBsb2coXCJDaHVua2VkIHVwbG9hZCByZXF1ZXN0IGZhaWxlZCBmb3IgXCIgKyBpZCArIFwiLCBjaHVuayBcIiArIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLmNsZWFyQ2FjaGVkQ2h1bmsoaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VUb1JlcG9ydCA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgZmFsc2UpLCBpblByb2dyZXNzSWR4O1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZVRvUmVwb3J0LnJlc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rZWQucmVzZXQoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpblByb2dyZXNzQ2h1bmtzQXJyYXkgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLmluUHJvZ3Jlc3M7XG4gICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3NJZHggPSBpblByb2dyZXNzQ2h1bmtzQXJyYXkgPyBxcS5pbmRleE9mKGluUHJvZ3Jlc3NDaHVua3NBcnJheSwgY2h1bmtJZHgpIDogLTE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpblByb2dyZXNzSWR4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcuaW5Qcm9ncmVzcy5zcGxpY2UoaW5Qcm9ncmVzc0lkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLnJlbWFpbmluZy51bnNoaWZ0KGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5pZ25vcmVGYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmlnbm9yZUZhaWx1cmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkdvaW5nIHRvIGF0dGVtcHQgdG8gYWJvcnQgdGhlc2UgY2h1bmtzOiB7fS4gVGhlc2UgYXJlIGN1cnJlbnRseSBpbi1wcm9ncmVzczoge30uXCIsIEpTT04uc3RyaW5naWZ5KE9iamVjdC5rZXlzKGhhbmRsZXIuX2dldFhocnMoaWQpKSksIEpTT04uc3RyaW5naWZ5KGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcuaW5Qcm9ncmVzcykpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goaGFuZGxlci5fZ2V0WGhycyhpZCksIGZ1bmN0aW9uKGNraWQsIGNrWGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkF0dGVtcHRpbmcgdG8gYWJvcnQgZmlsZSB7fS57fS4gWEhSIHJlYWR5U3RhdGUge30uIFwiLCBpZCwgY2tpZCwgY2tYaHIucmVhZHlTdGF0ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNrWGhyLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2tYaHIuX2NhbmNlbGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIubW92ZUluUHJvZ3Jlc3NUb1JlbWFpbmluZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMub25BdXRvUmV0cnkoaWQsIG5hbWUsIHJlc3BvbnNlVG9SZXBvcnQsIHhocikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCByZXNwb25zZVRvUmVwb3J0LCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc01vcmVQYXJ0czogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISFoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLnJlbWFpbmluZy5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbmV4dFBhcnQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRJZHggPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLnJlbWFpbmluZy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0SWR4ID49IGhhbmRsZXIuX2dldFRvdGFsQ2h1bmtzKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0SWR4ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHRJZHg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiU2VydmVyIG9yIGNhbGxiYWNrIGhhcyBvcmRlcmVkIGNodW5raW5nIGVmZm9ydCB0byBiZSByZXN0YXJ0ZWQgb24gbmV4dCBhdHRlbXB0IGZvciBpdGVtIElEIFwiICsgaWQsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fbWF5YmVEZWxldGVQZXJzaXN0ZWRDaHVua0RhdGEoaWQpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIucmVldmFsdWF0ZUNodW5raW5nKGlkKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmxvYWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5hdHRlbXB0aW5nUmVzdW1lID0gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VuZE5leHQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLmdldFNpemUoaWQpLCBuYW1lID0gb3B0aW9ucy5nZXROYW1lKGlkKSwgY2h1bmtJZHggPSBjaHVua2VkLm5leHRQYXJ0KGlkKSwgY2h1bmtEYXRhID0gaGFuZGxlci5fZ2V0Q2h1bmtEYXRhKGlkLCBjaHVua0lkeCksIGZpbGVTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCksIHJlc3VtaW5nID0gZmlsZVN0YXRlLmF0dGVtcHRpbmdSZXN1bWUsIGluUHJvZ3Jlc3NDaHVua3MgPSBmaWxlU3RhdGUuY2h1bmtpbmcuaW5Qcm9ncmVzcyB8fCBbXTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVN0YXRlLmxvYWRlZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVTdGF0ZS5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdW1pbmcgJiYgb3B0aW9ucy5vblJlc3VtZShpZCwgbmFtZSwgY2h1bmtEYXRhLCBmaWxlU3RhdGUuY3VzdG9tUmVzdW1lRGF0YSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rZWQucmVzZXQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBjaHVua0lkeCA9IGNodW5rZWQubmV4dFBhcnQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBjaHVua0RhdGEgPSBoYW5kbGVyLl9nZXRDaHVua0RhdGEoaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdW1pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNodW5rSWR4ID09IG51bGwgJiYgaW5Qcm9ncmVzc0NodW5rcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5maW5hbGl6ZShpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW5Qcm9ncmVzc0NodW5rcy5wdXNoKGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5pblByb2dyZXNzID0gaW5Qcm9ncmVzc0NodW5rcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5vcGVuKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlICYmIGNvbm5lY3Rpb25NYW5hZ2VyLmF2YWlsYWJsZSgpICYmIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcucmVtYWluaW5nLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5zZW5kTmV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rRGF0YS5ibG9iLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJDaHVuayB7fSBmb3IgZmlsZSB7fSB3aWxsIG5vdCBiZSB1cGxvYWRlZCwgemVybyBzaXplZCBjaHVuay5cIiwgY2h1bmtJZHgsIGlkKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuaGFuZGxlRmFpbHVyZShjaHVua0lkeCwgaWQsIFwiRmlsZSBpcyBubyBsb25nZXIgYXZhaWxhYmxlXCIsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblVwbG9hZENodW5rUHJvbWlzZSA9IG9wdGlvbnMub25VcGxvYWRDaHVuayhpZCwgbmFtZSwgaGFuZGxlci5fZ2V0Q2h1bmtEYXRhRm9yQ2FsbGJhY2soY2h1bmtEYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkQ2h1bmtQcm9taXNlLnRoZW4oZnVuY3Rpb24ocmVxdWVzdE92ZXJyaWRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmlzSW5Qcm9ncmVzcyhpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiTm90IHNlbmRpbmcgY2h1bmtlZCB1cGxvYWQgcmVxdWVzdCBmb3IgaXRlbSB7fS57fSAtIG5vIGxvbmdlciBpbiBwcm9ncmVzcy5cIiwgaWQsIGNodW5rSWR4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJTZW5kaW5nIGNodW5rZWQgdXBsb2FkIHJlcXVlc3QgZm9yIGl0ZW0ge30ue30sIGJ5dGVzIHt9LXt9IG9mIHt9LlwiLCBpZCwgY2h1bmtJZHgsIGNodW5rRGF0YS5zdGFydCArIDEsIGNodW5rRGF0YS5lbmQsIHNpemUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkQ2h1bmtEYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua0lkeDogY2h1bmtJZHgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVzOiByZXF1ZXN0T3ZlcnJpZGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bWluZzogcmVzdW1pbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIudXBsb2FkQ2h1bmsodXBsb2FkQ2h1bmtEYXRhKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MocmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJDaHVua2VkIHVwbG9hZCByZXF1ZXN0IHN1Y2NlZWRlZCBmb3IgXCIgKyBpZCArIFwiLCBjaHVuayBcIiArIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5jbGVhckNhY2hlZENodW5rKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpblByb2dyZXNzQ2h1bmtzID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5pblByb2dyZXNzIHx8IFtdLCByZXNwb25zZVRvUmVwb3J0ID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCB0cnVlKSwgaW5Qcm9ncmVzc0NodW5rSWR4ID0gcXEuaW5kZXhPZihpblByb2dyZXNzQ2h1bmtzLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJDaHVuayB7fSBmb3IgZmlsZSB7fSB1cGxvYWRlZCBzdWNjZXNzZnVsbHkuXCIsIGNodW5rSWR4LCBpZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmRvbmUoaWQsIGNodW5rSWR4LCByZXNwb25zZVRvUmVwb3J0LCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5Qcm9ncmVzc0NodW5rSWR4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3NDaHVua3Muc3BsaWNlKGluUHJvZ3Jlc3NDaHVua0lkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fbWF5YmVQZXJzaXN0Q2h1bmtlZFN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaHVua2VkLmhhc01vcmVQYXJ0cyhpZCkgJiYgaW5Qcm9ncmVzc0NodW5rcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuZmluYWxpemUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNodW5rZWQuaGFzTW9yZVBhcnRzKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5zZW5kTmV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRmlsZSBJRCB7fSBoYXMgbm8gbW9yZSBjaHVua3MgdG8gc2VuZCBhbmQgdGhlc2UgY2h1bmsgaW5kZXhlcyBhcmUgc3RpbGwgbWFya2VkIGFzIGluLXByb2dyZXNzOiB7fVwiLCBpZCwgSlNPTi5zdHJpbmdpZnkoaW5Qcm9ncmVzc0NodW5rcykpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGZhaWx1cmUocmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmhhbmRsZUZhaWx1cmUoY2h1bmtJZHgsIGlkLCByZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNsZWFyWGhyKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmhhbmRsZUZhaWx1cmUoY2h1bmtJZHgsIGlkLCBlcnJvciwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgY29ubmVjdGlvbk1hbmFnZXIgPSB7XG4gICAgICAgICAgICBfb3BlbjogW10sXG4gICAgICAgICAgICBfb3BlbkNodW5rczoge30sXG4gICAgICAgICAgICBfd2FpdGluZzogW10sXG4gICAgICAgICAgICBhdmFpbGFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBtYXggPSBvcHRpb25zLm1heENvbm5lY3Rpb25zLCBvcGVuQ2h1bmtFbnRyaWVzQ291bnQgPSAwLCBvcGVuQ2h1bmtzQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3MsIGZ1bmN0aW9uKGZpbGVJZCwgb3BlbkNodW5rSW5kZXhlcykge1xuICAgICAgICAgICAgICAgICAgICBvcGVuQ2h1bmtFbnRyaWVzQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgb3BlbkNodW5rc0NvdW50ICs9IG9wZW5DaHVua0luZGV4ZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXggLSAoY29ubmVjdGlvbk1hbmFnZXIuX29wZW4ubGVuZ3RoIC0gb3BlbkNodW5rRW50cmllc0NvdW50ICsgb3BlbkNodW5rc0NvdW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmcmVlOiBmdW5jdGlvbihpZCwgZG9udEFsbG93TmV4dCkge1xuICAgICAgICAgICAgICAgIHZhciBhbGxvd05leHQgPSAhZG9udEFsbG93TmV4dCwgd2FpdGluZ0luZGV4ID0gcXEuaW5kZXhPZihjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZywgaWQpLCBjb25uZWN0aW9uc0luZGV4ID0gcXEuaW5kZXhPZihjb25uZWN0aW9uTWFuYWdlci5fb3BlbiwgaWQpLCBuZXh0SWQ7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzW2lkXTtcbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkLmdldFByb3h5T3JCbG9iKGlkKSBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJHZW5lcmF0ZWQgYmxvYiB1cGxvYWQgaGFzIGVuZGVkIGZvciBcIiArIGlkICsgXCIsIGRpc3Bvc2luZyBnZW5lcmF0ZWQgYmxvYi5cIik7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmZpbGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZy5zcGxpY2Uod2FpdGluZ0luZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFsbG93TmV4dCAmJiBjb25uZWN0aW9uc0luZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX29wZW4uc3BsaWNlKGNvbm5lY3Rpb25zSW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICBuZXh0SWQgPSBjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dElkID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLnB1c2gobmV4dElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5zdGFydChuZXh0SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFdhaXRpbmdPckNvbm5lY3RlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdhaXRpbmdPckNvbm5lY3RlZCA9IFtdO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3MsIGZ1bmN0aW9uKGZpbGVJZCwgY2h1bmtzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHVua3MgJiYgY2h1bmtzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ09yQ29ubmVjdGVkLnB1c2gocGFyc2VJbnQoZmlsZUlkKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLCBmdW5jdGlvbihpZHgsIGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzW2ZpbGVJZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRpbmdPckNvbm5lY3RlZC5wdXNoKHBhcnNlSW50KGZpbGVJZCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgd2FpdGluZ09yQ29ubmVjdGVkID0gd2FpdGluZ09yQ29ubmVjdGVkLmNvbmNhdChjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdhaXRpbmdPckNvbm5lY3RlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1VzaW5nQ29ubmVjdGlvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihjb25uZWN0aW9uTWFuYWdlci5fb3BlbiwgaWQpID49IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24oaWQsIGNodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNodW5rSWR4ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uTWFuYWdlci5hdmFpbGFibGUoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmtJZHggPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fb3Blbi5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbkNodW5rc0VudHJ5ID0gY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3NbaWRdIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5DaHVua3NFbnRyeS5wdXNoKGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rc1tpZF0gPSBvcGVuQ2h1bmtzRW50cnk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nID0gW107XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX29wZW4gPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgc2ltcGxlID0ge1xuICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbGVTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJJZ25vcmluZyBzZW5kIHJlcXVlc3QgYXMgdGhpcyB1cGxvYWQgbWF5IGhhdmUgYmVlbiBjYW5jZWxsZWQsIEZpbGUgSUQgXCIgKyBpZCwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZS5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgICAgIGxvZyhcIlNlbmRpbmcgc2ltcGxlIHVwbG9hZCByZXF1ZXN0IGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLnVwbG9hZEZpbGUoaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UsIG9wdFhocikge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJTaW1wbGUgdXBsb2FkIHJlcXVlc3Qgc3VjY2VlZGVkIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlVG9SZXBvcnQgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIHRydWUpLCBzaXplID0gb3B0aW9ucy5nZXRTaXplKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vblByb2dyZXNzKGlkLCBuYW1lLCBzaXplLCBzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm1heWJlTmV3VXVpZChpZCwgcmVzcG9uc2VUb1JlcG9ydCk7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCByZXNwb25zZVRvUmVwb3J0LCBvcHRYaHIpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlLCBvcHRYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiU2ltcGxlIHVwbG9hZCByZXF1ZXN0IGZhaWxlZCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZVRvUmVwb3J0ID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5vbkF1dG9SZXRyeShpZCwgbmFtZSwgcmVzcG9uc2VUb1JlcG9ydCwgb3B0WGhyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNsZWFudXAoaWQsIHJlc3BvbnNlVG9SZXBvcnQsIG9wdFhocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdXBsb2FkID0ge1xuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIkNhbmNlbGxpbmcgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJhbXNTdG9yZS5yZW1vdmUoaWQpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFudXA6IGZ1bmN0aW9uKGlkLCByZXNwb25zZSwgb3B0WGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMub25Db21wbGV0ZShpZCwgbmFtZSwgcmVzcG9uc2UsIG9wdFhocik7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fY2xlYXJYaHJzICYmIGhhbmRsZXIuX2NsZWFyWGhycyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFByb3h5T3JCbG9iOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldFByb3h5ICYmIGhhbmRsZXIuZ2V0UHJveHkoaWQpIHx8IGhhbmRsZXIuZ2V0RmlsZSAmJiBoYW5kbGVyLmdldEZpbGUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluaXRIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlclR5cGUgPSBuYW1lc3BhY2UgPyBxcVtuYW1lc3BhY2VdIDogcXEudHJhZGl0aW9uYWwsIGhhbmRsZXJNb2R1bGVTdWJ0eXBlID0gcXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZyA/IFwiWGhyXCIgOiBcIkZvcm1cIjtcbiAgICAgICAgICAgICAgICBoYW5kbGVyID0gbmV3IGhhbmRsZXJUeXBlW2hhbmRsZXJNb2R1bGVTdWJ0eXBlICsgXCJVcGxvYWRIYW5kbGVyXCJdKG9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q3VzdG9tUmVzdW1lRGF0YTogb3B0aW9ucy5nZXRDdXN0b21SZXN1bWVEYXRhLFxuICAgICAgICAgICAgICAgICAgICBnZXREYXRhQnlVdWlkOiBvcHRpb25zLmdldERhdGFCeVV1aWQsXG4gICAgICAgICAgICAgICAgICAgIGdldE5hbWU6IG9wdGlvbnMuZ2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2l6ZTogb3B0aW9ucy5nZXRTaXplLFxuICAgICAgICAgICAgICAgICAgICBnZXRVdWlkOiBvcHRpb25zLmdldFV1aWQsXG4gICAgICAgICAgICAgICAgICAgIGxvZzogbG9nLFxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogb3B0aW9ucy5vbkNhbmNlbCxcbiAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzczogb3B0aW9ucy5vblByb2dyZXNzLFxuICAgICAgICAgICAgICAgICAgICBvblV1aWRDaGFuZ2VkOiBvcHRpb25zLm9uVXVpZENoYW5nZWQsXG4gICAgICAgICAgICAgICAgICAgIG9uRmluYWxpemluZzogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FEX0ZJTkFMSVpJTkcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuX3JlbW92ZUV4cGlyZWRDaHVua2luZ1JlY29yZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fcmVtb3ZlRXhwaXJlZENodW5raW5nUmVjb3JkcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0RlZmVycmVkRWxpZ2libGVGb3JVcGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuaXNRdWV1ZWQoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1heWJlRGVmZXI6IGZ1bmN0aW9uKGlkLCBibG9iKSB7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2IgJiYgIWhhbmRsZXIuZ2V0RmlsZShpZCkgJiYgYmxvYiBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uVXBsb2FkUHJlcChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkF0dGVtcHRpbmcgdG8gZ2VuZXJhdGUgYSBibG9iIG9uLWRlbWFuZCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IuY3JlYXRlKCkudGhlbihmdW5jdGlvbihnZW5lcmF0ZWRCbG9iKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJHZW5lcmF0ZWQgYW4gb24tZGVtYW5kIGJsb2IgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci51cGRhdGVCbG9iKGlkLCBnZW5lcmF0ZWRCbG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2V0U2l6ZShpZCwgZ2VuZXJhdGVkQmxvYi5zaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIucmVldmFsdWF0ZUNodW5raW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5tYXliZVNlbmREZWZlcnJlZEZpbGVzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yUmVzcG9uc2UuZXJyb3IgPSBlcnJvck1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRmFpbGVkIHRvIGdlbmVyYXRlIGJsb2IgZm9yIElEIHt9LiAgRXJyb3IgbWVzc2FnZToge30uXCIsIGlkLCBlcnJvck1lc3NhZ2UpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vbkNvbXBsZXRlKGlkLCBvcHRpb25zLmdldE5hbWUoaWQpLCBxcS5leHRlbmQoZXJyb3JSZXNwb25zZSwgcHJldmVudFJldHJ5UmVzcG9uc2UpLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5tYXliZVNlbmREZWZlcnJlZEZpbGVzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLm1heWJlU2VuZERlZmVycmVkRmlsZXMoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWF5YmVTZW5kRGVmZXJyZWRGaWxlczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWRzSW5Hcm91cCA9IG9wdGlvbnMuZ2V0SWRzSW5Qcm94eUdyb3VwKGlkKSwgdXBsb2FkZWRUaGlzSWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoaWRzSW5Hcm91cCAmJiBpZHNJbkdyb3VwLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJNYXliZSByZWFkeSB0byB1cGxvYWQgcHJveHkgZ3JvdXAgZmlsZSBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChpZHNJbkdyb3VwLCBmdW5jdGlvbihpZHgsIGlkSW5Hcm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZC5pc0RlZmVycmVkRWxpZ2libGVGb3JVcGxvYWQoaWRJbkdyb3VwKSAmJiAhIWhhbmRsZXIuZ2V0RmlsZShpZEluR3JvdXApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZWRUaGlzSWQgPSBpZEluR3JvdXAgPT09IGlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5ub3coaWRJbkdyb3VwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXBsb2FkLmlzRGVmZXJyZWRFbGlnaWJsZUZvclVwbG9hZChpZEluR3JvdXApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZFRoaXNJZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5ub3coaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkZWRUaGlzSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWF5YmVOZXdVdWlkOiBmdW5jdGlvbihpZCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubmV3VXVpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25VdWlkQ2hhbmdlZChpZCwgcmVzcG9uc2UubmV3VXVpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5vcm1hbGl6ZVJlc3BvbnNlOiBmdW5jdGlvbihvcmlnaW5hbFJlc3BvbnNlLCBzdWNjZXNzZnVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gb3JpZ2luYWxSZXNwb25zZTtcbiAgICAgICAgICAgICAgICBpZiAoIXFxLmlzT2JqZWN0KG9yaWdpbmFsUmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhvcmlnaW5hbFJlc3BvbnNlKSAmJiAhc3VjY2Vzc2Z1bCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3IgPSBvcmlnaW5hbFJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBzdWNjZXNzZnVsO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBub3c6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLmdldE5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGlmICghY29udHJvbGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoaWQgKyBcIiBpcyBub3QgYSB2YWxpZCBmaWxlIElEIHRvIHVwbG9hZCFcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wdGlvbnMub25VcGxvYWQoaWQsIG5hbWUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnBhdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlBBVVNFRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnBhdXNlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5raW5nUG9zc2libGUgJiYgaGFuZGxlci5fc2hvdWxkQ2h1bmtUaGlzRmlsZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnNlbmROZXh0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlLnNlbmQoaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBlcnJvciB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgbG9nKGlkICsgXCIgdXBsb2FkIHN0YXJ0IGFib3J0ZWQgZHVlIHRvIHJlamVjdGVkIG9uVXBsb2FkIFByb21pc2UgLSBkZXRhaWxzOiBcIiArIGVycm9yLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMub25BdXRvUmV0cnkoaWQsIG5hbWUsIGVycm9yLnJlc3BvbnNlSlNPTiB8fCB7fSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShlcnJvci5yZXNwb25zZUpTT04sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGFydDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmxvYlRvVXBsb2FkID0gdXBsb2FkLmdldFByb3h5T3JCbG9iKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoYmxvYlRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWQubWF5YmVEZWZlcihpZCwgYmxvYlRvVXBsb2FkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQubm93KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihpZCwgZmlsZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuYWRkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uTWFuYWdlci5vcGVuKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLnN0YXJ0KGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuaWdub3JlRmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbk1hbmFnZXIuaXNVc2luZ0Nvbm5lY3Rpb24oaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWQuc3RhcnQoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sbGVyLnVwbG9hZChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FuY2VsUmV0VmFsID0gaGFuZGxlci5jYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0dlbmVyaWNQcm9taXNlKGNhbmNlbFJldFZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsUmV0VmFsLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjYW5jZWxSZXRWYWwgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWxBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciB3YWl0aW5nT3JDb25uZWN0ZWQgPSBjb25uZWN0aW9uTWFuYWdlci5nZXRXYWl0aW5nT3JDb25uZWN0ZWQoKSwgaTtcbiAgICAgICAgICAgICAgICBpZiAod2FpdGluZ09yQ29ubmVjdGVkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSB3YWl0aW5nT3JDb25uZWN0ZWQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2FuY2VsKHdhaXRpbmdPckNvbm5lY3RlZFtpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIucmVzZXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmdldFByb3h5ICYmIGhhbmRsZXIuZ2V0UHJveHkoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldFByb3h5KGlkKS5yZWZlcmVuY2VCbG9iO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRGaWxlICYmIGhhbmRsZXIuZ2V0RmlsZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNQcm94aWVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIShoYW5kbGVyLmdldFByb3h5ICYmIGhhbmRsZXIuZ2V0UHJveHkoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbnB1dDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5nZXRJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRJbnB1dChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJSZXNldHRpbmcgdXBsb2FkIGhhbmRsZXJcIik7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci5jYW5jZWxBbGwoKTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5yZXNldCgpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIucmVzZXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleHB1bmdlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1ZhbGlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmlzVmFsaWQoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc1Jlc3VtZVJlY29yZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gaGFuZGxlci5pc1ZhbGlkKGlkKSAmJiBoYW5kbGVyLl9nZXRMb2NhbFN0b3JhZ2VJZCAmJiBoYW5kbGVyLl9nZXRMb2NhbFN0b3JhZ2VJZChpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISFsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVzdW1hYmxlRmlsZXNEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5nZXRSZXN1bWFibGVGaWxlc0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0UmVzdW1hYmxlRmlsZXNEYXRhKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRUaGlyZFBhcnR5RmlsZUlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldFRoaXJkUGFydHlGaWxlSWQoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci5pc1Jlc3VtYWJsZShpZCkgJiYgaGFuZGxlci5wYXVzZSAmJiBjb250cm9sbGVyLmlzVmFsaWQoaWQpICYmIGhhbmRsZXIucGF1c2UoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLmZyZWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm1vdmVJblByb2dyZXNzVG9SZW1haW5pbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzQXR0ZW1wdGluZ1Jlc3VtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISFoYW5kbGVyLmlzQXR0ZW1wdGluZ1Jlc3VtZSAmJiBoYW5kbGVyLmlzQXR0ZW1wdGluZ1Jlc3VtZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNSZXN1bWFibGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhaGFuZGxlci5pc1Jlc3VtYWJsZSAmJiBoYW5kbGVyLmlzUmVzdW1hYmxlKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgbG9nID0gb3B0aW9ucy5sb2c7XG4gICAgICAgIGNodW5raW5nUG9zc2libGUgPSBvcHRpb25zLmNodW5raW5nLmVuYWJsZWQgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuY2h1bmtpbmc7XG4gICAgICAgIGNvbmN1cnJlbnRDaHVua2luZ1Bvc3NpYmxlID0gY2h1bmtpbmdQb3NzaWJsZSAmJiBvcHRpb25zLmNodW5raW5nLmNvbmN1cnJlbnQuZW5hYmxlZDtcbiAgICAgICAgcHJldmVudFJldHJ5UmVzcG9uc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHt9O1xuICAgICAgICAgICAgcmVzcG9uc2Vbb3B0aW9ucy5wcmV2ZW50UmV0cnlQYXJhbV0gPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9KCk7XG4gICAgICAgIHVwbG9hZC5pbml0SGFuZGxlcigpO1xuICAgIH07XG4gICAgcXEuV2luZG93UmVjZWl2ZU1lc3NhZ2UgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHt9XG4gICAgICAgIH0sIGNhbGxiYWNrV3JhcHBlckRldGFjaGVycyA9IHt9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICByZWNlaXZlTWVzc2FnZTogZnVuY3Rpb24oaWQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uTWVzc2FnZUNhbGxiYWNrV3JhcHBlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5wb3N0TWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja1dyYXBwZXJEZXRhY2hlcnNbaWRdID0gcXEod2luZG93KS5hdHRhY2goXCJtZXNzYWdlXCIsIG9uTWVzc2FnZUNhbGxiYWNrV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiaWZyYW1lIG1lc3NhZ2UgcGFzc2luZyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlciFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RvcFJlY2VpdmluZ01lc3NhZ2VzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cucG9zdE1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRldGFjaGVyID0gY2FsbGJhY2tXcmFwcGVyRGV0YWNoZXJzW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRldGFjaGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhY2hlcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLkZvcm1VcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSBzcGVjLm9wdGlvbnMsIGhhbmRsZXIgPSB0aGlzLCBwcm94eSA9IHNwZWMucHJveHksIGZvcm1IYW5kbGVySW5zdGFuY2VJZCA9IHFxLmdldFVuaXF1ZUlkKCksIG9ubG9hZENhbGxiYWNrcyA9IHt9LCBkZXRhY2hMb2FkRXZlbnRzID0ge30sIHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnMgPSB7fSwgaXNDb3JzID0gb3B0aW9ucy5pc0NvcnMsIGlucHV0TmFtZSA9IG9wdGlvbnMuaW5wdXROYW1lLCBnZXRVdWlkID0gcHJveHkuZ2V0VXVpZCwgbG9nID0gcHJveHkubG9nLCBjb3JzTWVzc2FnZVJlY2VpdmVyID0gbmV3IHFxLldpbmRvd1JlY2VpdmVNZXNzYWdlKHtcbiAgICAgICAgICAgIGxvZzogbG9nXG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBleHB1bmdlRmlsZShpZCkge1xuICAgICAgICAgICAgZGVsZXRlIGRldGFjaExvYWRFdmVudHNbaWRdO1xuICAgICAgICAgICAgaWYgKGlzQ29ycykge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzW2lkXSk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnNbaWRdO1xuICAgICAgICAgICAgICAgIGNvcnNNZXNzYWdlUmVjZWl2ZXIuc3RvcFJlY2VpdmluZ01lc3NhZ2VzKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChoYW5kbGVyLl9nZXRJZnJhbWVOYW1lKGlkKSk7XG4gICAgICAgICAgICBpZiAoaWZyYW1lKSB7XG4gICAgICAgICAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImphdmFzY3JpcHQ6ZmFsc2U7XCIpO1xuICAgICAgICAgICAgICAgIHFxKGlmcmFtZSkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RmlsZUlkRm9ySWZyYW1lTmFtZShpZnJhbWVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gaWZyYW1lTmFtZS5zcGxpdChcIl9cIilbMF07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaW5pdElmcmFtZUZvclVwbG9hZChuYW1lKSB7XG4gICAgICAgICAgICB2YXIgaWZyYW1lID0gcXEudG9FbGVtZW50KFwiPGlmcmFtZSBzcmM9J2phdmFzY3JpcHQ6ZmFsc2U7JyBuYW1lPSdcIiArIG5hbWUgKyBcIicgLz5cIik7XG4gICAgICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmFtZSk7XG4gICAgICAgICAgICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGlmcmFtZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlclBvc3RNZXNzYWdlQ2FsbGJhY2soaWZyYW1lLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGlmcmFtZU5hbWUgPSBpZnJhbWUuaWQsIGZpbGVJZCA9IGdldEZpbGVJZEZvcklmcmFtZU5hbWUoaWZyYW1lTmFtZSksIHV1aWQgPSBnZXRVdWlkKGZpbGVJZCk7XG4gICAgICAgICAgICBvbmxvYWRDYWxsYmFja3NbdXVpZF0gPSBjYWxsYmFjaztcbiAgICAgICAgICAgIGRldGFjaExvYWRFdmVudHNbZmlsZUlkXSA9IHFxKGlmcmFtZSkuYXR0YWNoKFwibG9hZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5nZXRJbnB1dChmaWxlSWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlJlY2VpdmVkIGlmcmFtZSBsb2FkIGV2ZW50IGZvciBDT1JTIHVwbG9hZCByZXF1ZXN0IChpZnJhbWUgbmFtZSBcIiArIGlmcmFtZU5hbWUgKyBcIilcIik7XG4gICAgICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnNbaWZyYW1lTmFtZV0gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IFwiTm8gdmFsaWQgbWVzc2FnZSByZWNlaXZlZCBmcm9tIGxvYWRlZCBpZnJhbWUgZm9yIGlmcmFtZSBuYW1lIFwiICsgaWZyYW1lTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhlcnJvck1lc3NhZ2UsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yTWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDFlMyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb3JzTWVzc2FnZVJlY2VpdmVyLnJlY2VpdmVNZXNzYWdlKGlmcmFtZU5hbWUsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJSZWNlaXZlZCB0aGUgZm9sbG93aW5nIHdpbmRvdyBtZXNzYWdlOiAnXCIgKyBtZXNzYWdlICsgXCInXCIpO1xuICAgICAgICAgICAgICAgIHZhciBmaWxlSWQgPSBnZXRGaWxlSWRGb3JJZnJhbWVOYW1lKGlmcmFtZU5hbWUpLCByZXNwb25zZSA9IGhhbmRsZXIuX3BhcnNlSnNvblJlc3BvbnNlKG1lc3NhZ2UpLCB1dWlkID0gcmVzcG9uc2UudXVpZCwgb25sb2FkQ2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgaWYgKHV1aWQgJiYgb25sb2FkQ2FsbGJhY2tzW3V1aWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkhhbmRsaW5nIHJlc3BvbnNlIGZvciBpZnJhbWUgbmFtZSBcIiArIGlmcmFtZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVyc1tpZnJhbWVOYW1lXSk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzW2lmcmFtZU5hbWVdO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9kZXRhY2hMb2FkRXZlbnQoaWZyYW1lTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIG9ubG9hZENhbGxiYWNrID0gb25sb2FkQ2FsbGJhY2tzW3V1aWRdO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb25sb2FkQ2FsbGJhY2tzW3V1aWRdO1xuICAgICAgICAgICAgICAgICAgICBjb3JzTWVzc2FnZVJlY2VpdmVyLnN0b3BSZWNlaXZpbmdNZXNzYWdlcyhpZnJhbWVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgb25sb2FkQ2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiJ1wiICsgbWVzc2FnZSArIFwiJyBkb2VzIG5vdCBjb250YWluIGEgVVVJRCAtIGlnbm9yaW5nLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLlVwbG9hZEhhbmRsZXIoc3BlYykpO1xuICAgICAgICBxcS5vdmVycmlkZSh0aGlzLCBmdW5jdGlvbihzdXBlcl8pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihpZCwgZmlsZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyXy5hZGQoaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBmaWxlSW5wdXRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIGlucHV0TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlSW5wdXQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEoZmlsZUlucHV0KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXhwdW5nZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwdW5nZUZpbGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICBzdXBlcl8uZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpc1ZhbGlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXJfLmlzVmFsaWQoaWQpICYmIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuaW5wdXQgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGdldElucHV0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmlucHV0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hdHRhY2hMb2FkRXZlbnQ6IGZ1bmN0aW9uKGlmcmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VEZXNjcmlwdG9yO1xuICAgICAgICAgICAgICAgIGlmIChpc0NvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJQb3N0TWVzc2FnZUNhbGxiYWNrKGlmcmFtZSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFjaExvYWRFdmVudHNbaWZyYW1lLmlkXSA9IHFxKGlmcmFtZSkuYXR0YWNoKFwibG9hZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlJlY2VpdmVkIHJlc3BvbnNlIGZvciBcIiArIGlmcmFtZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlmcmFtZS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWZyYW1lLmNvbnRlbnREb2N1bWVudCAmJiBpZnJhbWUuY29udGVudERvY3VtZW50LmJvZHkgJiYgaWZyYW1lLmNvbnRlbnREb2N1bWVudC5ib2R5LmlubmVySFRNTCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiRXJyb3Igd2hlbiBhdHRlbXB0aW5nIHRvIGFjY2VzcyBpZnJhbWUgZHVyaW5nIGhhbmRsaW5nIG9mIHVwbG9hZCByZXNwb25zZSAoXCIgKyBlcnJvci5tZXNzYWdlICsgXCIpXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VEZXNjcmlwdG9yID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZURlc2NyaXB0b3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZUlmcmFtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWZyYW1lTmFtZSA9IGhhbmRsZXIuX2dldElmcmFtZU5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpbml0SWZyYW1lRm9yVXBsb2FkKGlmcmFtZU5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9kZXRhY2hMb2FkRXZlbnQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRldGFjaExvYWRFdmVudHNbaWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWNoTG9hZEV2ZW50c1tpZF0oKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGRldGFjaExvYWRFdmVudHNbaWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0SWZyYW1lTmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVJZCArIFwiX1wiICsgZm9ybUhhbmRsZXJJbnN0YW5jZUlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0Rm9ybUZvclVwbG9hZDogZnVuY3Rpb24oc3BlYykge1xuICAgICAgICAgICAgICAgIHZhciBtZXRob2QgPSBzcGVjLm1ldGhvZCwgZW5kcG9pbnQgPSBzcGVjLmVuZHBvaW50LCBwYXJhbXMgPSBzcGVjLnBhcmFtcywgcGFyYW1zSW5Cb2R5ID0gc3BlYy5wYXJhbXNJbkJvZHksIHRhcmdldE5hbWUgPSBzcGVjLnRhcmdldE5hbWUsIGZvcm0gPSBxcS50b0VsZW1lbnQoXCI8Zm9ybSBtZXRob2Q9J1wiICsgbWV0aG9kICsgXCInIGVuY3R5cGU9J211bHRpcGFydC9mb3JtLWRhdGEnPjwvZm9ybT5cIiksIHVybCA9IGVuZHBvaW50O1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXNJbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEub2JqMklucHV0cyhwYXJhbXMsIGZvcm0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVybCA9IHFxLm9iajJ1cmwocGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvcm0uc2V0QXR0cmlidXRlKFwiYWN0aW9uXCIsIHVybCk7XG4gICAgICAgICAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoXCJ0YXJnZXRcIiwgdGFyZ2V0TmFtZSk7XG4gICAgICAgICAgICAgICAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcGFyc2VKc29uUmVzcG9uc2U6IGZ1bmN0aW9uKGlubmVySHRtbE9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHt9O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcXEucGFyc2VKc29uKGlubmVySHRtbE9yTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiRXJyb3Igd2hlbiBhdHRlbXB0aW5nIHRvIHBhcnNlIGlmcmFtZSB1cGxvYWQgcmVzcG9uc2UgKFwiICsgZXJyb3IubWVzc2FnZSArIFwiKVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuWGhyVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBoYW5kbGVyID0gdGhpcywgbmFtZXNwYWNlID0gc3BlYy5vcHRpb25zLm5hbWVzcGFjZSwgcHJveHkgPSBzcGVjLnByb3h5LCBjaHVua2luZyA9IHNwZWMub3B0aW9ucy5jaHVua2luZywgZ2V0Q2h1bmtTaXplID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciBmaWxlU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpO1xuICAgICAgICAgICAgaWYgKGZpbGVTdGF0ZS5jaHVua1NpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVN0YXRlLmNodW5rU2l6ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rU2l6ZSA9IGNodW5raW5nLnBhcnRTaXplO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0Z1bmN0aW9uKGNodW5rU2l6ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtTaXplID0gY2h1bmtTaXplKGlkLCBnZXRTaXplKGlkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZS5jaHVua1NpemUgPSBjaHVua1NpemU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNodW5rU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgcmVzdW1lID0gc3BlYy5vcHRpb25zLnJlc3VtZSwgY2h1bmtGaWxlcyA9IGNodW5raW5nICYmIHNwZWMub3B0aW9ucy5jaHVua2luZy5lbmFibGVkICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmNodW5raW5nLCByZXN1bWVFbmFibGVkID0gcmVzdW1lICYmIHNwZWMub3B0aW9ucy5yZXN1bWUuZW5hYmxlZCAmJiBjaHVua0ZpbGVzICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLnJlc3VtZSwgZ2V0TmFtZSA9IHByb3h5LmdldE5hbWUsIGdldFNpemUgPSBwcm94eS5nZXRTaXplLCBnZXRVdWlkID0gcHJveHkuZ2V0VXVpZCwgZ2V0RW5kcG9pbnQgPSBwcm94eS5nZXRFbmRwb2ludCwgZ2V0RGF0YUJ5VXVpZCA9IHByb3h5LmdldERhdGFCeVV1aWQsIG9uVXVpZENoYW5nZWQgPSBwcm94eS5vblV1aWRDaGFuZ2VkLCBvblByb2dyZXNzID0gcHJveHkub25Qcm9ncmVzcywgbG9nID0gcHJveHkubG9nLCBnZXRDdXN0b21SZXN1bWVEYXRhID0gcHJveHkuZ2V0Q3VzdG9tUmVzdW1lRGF0YTtcbiAgICAgICAgZnVuY3Rpb24gYWJvcnQoaWQpIHtcbiAgICAgICAgICAgIHFxLmVhY2goaGFuZGxlci5fZ2V0WGhycyhpZCksIGZ1bmN0aW9uKHhocklkLCB4aHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWpheFJlcXVlc3RlciA9IGhhbmRsZXIuX2dldEFqYXhSZXF1ZXN0ZXIoaWQsIHhocklkKTtcbiAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBudWxsO1xuICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpO1xuICAgICAgICAgICAgICAgIGFqYXhSZXF1ZXN0ZXIgJiYgYWpheFJlcXVlc3Rlci5jYW5jZWxlZCAmJiBhamF4UmVxdWVzdGVyLmNhbmNlbGVkKGlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuVXBsb2FkSGFuZGxlcihzcGVjKSk7XG4gICAgICAgIHFxLm92ZXJyaWRlKHRoaXMsIGZ1bmN0aW9uKHN1cGVyXykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGlkLCBibG9iT3JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlKGJsb2JPclByb3h5KSB8fCBxcS5pc0Jsb2IoYmxvYk9yUHJveHkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBlcl8uYWRkKGlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogYmxvYk9yUHJveHlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJsb2JPclByb3h5IGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBlcl8uYWRkKGlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHk6IGJsb2JPclByb3h5XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhc3NlZCBvYmogaXMgbm90IGEgRmlsZSwgQmxvYiwgb3IgcHJveHlcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5faW5pdFRlbXBTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VtZUVuYWJsZWQgJiYgaGFuZGxlci5fbWF5YmVQcmVwYXJlRm9yUmVzdW1lKGlkKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGV4cHVuZ2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGFib3J0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fbWF5YmVEZWxldGVQZXJzaXN0ZWRDaHVua0RhdGEoaWQpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9jbGVhclhocnMoaWQpO1xuICAgICAgICAgICAgICAgICAgICBzdXBlcl8uZXhwdW5nZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBjbGVhckNhY2hlZENodW5rOiBmdW5jdGlvbihpZCwgY2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWxlU3RhdGUudGVtcC5jYWNoZWRDaHVua3NbY2h1bmtJZHhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhclhocjogZnVuY3Rpb24oaWQsIGNodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXBTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcDtcbiAgICAgICAgICAgICAgICBpZiAodGVtcFN0YXRlLnhocnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRlbXBTdGF0ZS54aHJzW2NodW5rSWR4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVycykge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzW2NodW5rSWR4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmluYWxpemVDaHVua3M6IGZ1bmN0aW9uKGlkLCByZXNwb25zZVBhcnNlcikge1xuICAgICAgICAgICAgICAgIHZhciBsYXN0Q2h1bmtJZHggPSBoYW5kbGVyLl9nZXRUb3RhbENodW5rcyhpZCkgLSAxLCB4aHIgPSBoYW5kbGVyLl9nZXRYaHIoaWQsIGxhc3RDaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlUGFyc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUHJvbWlzZSgpLnN1Y2Nlc3MocmVzcG9uc2VQYXJzZXIoeGhyKSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5Qcm9taXNlKCkuc3VjY2Vzcyh7fSwgeGhyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmlzVmFsaWQoaWQpICYmIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuZmlsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQcm94eTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5pc1ZhbGlkKGlkKSAmJiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnByb3h5O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlc3VtYWJsZUZpbGVzRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VtYWJsZUZpbGVzRGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2l0ZXJhdGVSZXN1bWVSZWNvcmRzKGZ1bmN0aW9uKGtleSwgdXBsb2FkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm1vdmVJblByb2dyZXNzVG9SZW1haW5pbmcobnVsbCwgdXBsb2FkRGF0YS5jaHVua2luZy5pblByb2dyZXNzLCB1cGxvYWREYXRhLmNodW5raW5nLnJlbWFpbmluZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdXBsb2FkRGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nOiB1cGxvYWREYXRhLmNodW5raW5nLnJlbWFpbmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHVwbG9hZERhdGEuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHVwbG9hZERhdGEudXVpZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YS5rZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEua2V5ID0gdXBsb2FkRGF0YS5rZXk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGEuY3VzdG9tUmVzdW1lRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXN0b21SZXN1bWVEYXRhID0gdXBsb2FkRGF0YS5jdXN0b21SZXN1bWVEYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VtYWJsZUZpbGVzRGF0YS5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bWFibGVGaWxlc0RhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNBdHRlbXB0aW5nUmVzdW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmF0dGVtcHRpbmdSZXN1bWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNSZXN1bWFibGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhY2h1bmtpbmcgJiYgaGFuZGxlci5pc1ZhbGlkKGlkKSAmJiAhaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5ub3RSZXN1bWFibGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW92ZUluUHJvZ3Jlc3NUb1JlbWFpbmluZzogZnVuY3Rpb24oaWQsIG9wdEluUHJvZ3Jlc3MsIG9wdFJlbWFpbmluZykge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpIHx8IHt9LCBjaHVua2luZ1N0YXRlID0gZmlsZVN0YXRlLmNodW5raW5nIHx8IHt9LCBpblByb2dyZXNzID0gb3B0SW5Qcm9ncmVzcyB8fCBjaHVua2luZ1N0YXRlLmluUHJvZ3Jlc3MsIHJlbWFpbmluZyA9IG9wdFJlbWFpbmluZyB8fCBjaHVua2luZ1N0YXRlLnJlbWFpbmluZztcbiAgICAgICAgICAgICAgICBpZiAoaW5Qcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiTW92aW5nIHRoZXNlIGNodW5rcyBmcm9tIGluLXByb2dyZXNzIHt9LCB0byByZW1haW5pbmcuXCIsIEpTT04uc3RyaW5naWZ5KGluUHJvZ3Jlc3MpKSk7XG4gICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3MucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGluUHJvZ3Jlc3MsIGZ1bmN0aW9uKGlkeCwgY2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZy51bnNoaWZ0KGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3MubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkFib3J0aW5nIFhIUiB1cGxvYWQgZm9yIHt9ICd7fScgZHVlIHRvIHBhdXNlIGluc3RydWN0aW9uLlwiLCBpZCwgZ2V0TmFtZShpZCkpKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5wYXVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhYm9ydChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWV2YWx1YXRlQ2h1bmtpbmc6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNodW5raW5nICYmIGhhbmRsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSwgdG90YWxDaHVua3MsIGk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jaHVua2luZztcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxDaHVua3MgPSBoYW5kbGVyLl9nZXRUb3RhbENodW5rcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbENodW5rcyA+IDEgfHwgY2h1bmtpbmcubWFuZGF0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZy5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nLnBhcnRzID0gdG90YWxDaHVua3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZy5yZW1haW5pbmcgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b3RhbENodW5rczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcucmVtYWluaW5nLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9pbml0VGVtcFN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVCbG9iOiBmdW5jdGlvbihpZCwgbmV3QmxvYikge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuZmlsZSA9IG5ld0Jsb2I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jbGVhclhocnM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXBTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcDtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVycywgZnVuY3Rpb24oY2h1bmtJZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzW2NodW5rSWRdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHFxLmVhY2godGVtcFN0YXRlLnhocnMsIGZ1bmN0aW9uKGNodW5rSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRlbXBTdGF0ZS54aHJzW2NodW5rSWRdO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVYaHI6IGZ1bmN0aW9uKGlkLCBvcHRDaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9yZWdpc3RlclhocihpZCwgb3B0Q2h1bmtJZHgsIHFxLmNyZWF0ZVhockluc3RhbmNlKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRBamF4UmVxdWVzdGVyOiBmdW5jdGlvbihpZCwgb3B0Q2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtJZHggPSBvcHRDaHVua0lkeCA9PSBudWxsID8gLTEgOiBvcHRDaHVua0lkeDtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmFqYXhSZXF1ZXN0ZXJzW2NodW5rSWR4XTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0Q2h1bmtEYXRhOiBmdW5jdGlvbihpZCwgY2h1bmtJbmRleCkge1xuICAgICAgICAgICAgICAgIHZhciBjaHVua1NpemUgPSBnZXRDaHVua1NpemUoaWQpLCBmaWxlU2l6ZSA9IGdldFNpemUoaWQpLCBmaWxlT3JCbG9iID0gaGFuZGxlci5nZXRGaWxlKGlkKSwgc3RhcnRCeXRlcyA9IGNodW5rU2l6ZSAqIGNodW5rSW5kZXgsIGVuZEJ5dGVzID0gc3RhcnRCeXRlcyArIGNodW5rU2l6ZSA+PSBmaWxlU2l6ZSA/IGZpbGVTaXplIDogc3RhcnRCeXRlcyArIGNodW5rU2l6ZSwgdG90YWxDaHVua3MgPSBoYW5kbGVyLl9nZXRUb3RhbENodW5rcyhpZCksIGNhY2hlZENodW5rcyA9IHRoaXMuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5jYWNoZWRDaHVua3MsIGJsb2IgPSBjYWNoZWRDaHVua3NbY2h1bmtJbmRleF0gfHwgcXEuc2xpY2VCbG9iKGZpbGVPckJsb2IsIHN0YXJ0Qnl0ZXMsIGVuZEJ5dGVzKTtcbiAgICAgICAgICAgICAgICBjYWNoZWRDaHVua3NbY2h1bmtJbmRleF0gPSBibG9iO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnQ6IGNodW5rSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydEJ5dGVzLFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZEJ5dGVzLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdG90YWxDaHVua3MsXG4gICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGVuZEJ5dGVzIC0gc3RhcnRCeXRlc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldENodW5rRGF0YUZvckNhbGxiYWNrOiBmdW5jdGlvbihjaHVua0RhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXg6IGNodW5rRGF0YS5wYXJ0LFxuICAgICAgICAgICAgICAgICAgICBzdGFydEJ5dGU6IGNodW5rRGF0YS5zdGFydCArIDEsXG4gICAgICAgICAgICAgICAgICAgIGVuZEJ5dGU6IGNodW5rRGF0YS5lbmQsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUGFydHM6IGNodW5rRGF0YS5jb3VudFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldExvY2FsU3RvcmFnZUlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXRWZXJzaW9uID0gXCI1LjBcIiwgbmFtZSA9IGdldE5hbWUoaWQpLCBzaXplID0gZ2V0U2l6ZShpZCksIGNodW5rU2l6ZSA9IGdldENodW5rU2l6ZShpZCksIGVuZHBvaW50ID0gZ2V0RW5kcG9pbnQoaWQpLCBjdXN0b21LZXlzID0gcmVzdW1lLmN1c3RvbUtleXMoaWQpLCBsb2NhbFN0b3JhZ2VJZCA9IHFxLmZvcm1hdChcInFxe31yZXN1bWV7fS17fS17fS17fS17fVwiLCBuYW1lc3BhY2UsIGZvcm1hdFZlcnNpb24sIG5hbWUsIHNpemUsIGNodW5rU2l6ZSwgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlSWQgKz0gXCItXCIgKyBrZXk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZUlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRNaW1lVHlwZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRGaWxlKGlkKS50eXBlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRQZXJzaXN0YWJsZURhdGE6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFRvdGFsQ2h1bmtzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjaHVua2luZykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVNpemUgPSBnZXRTaXplKGlkKSwgY2h1bmtTaXplID0gZ2V0Q2h1bmtTaXplKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChmaWxlU2l6ZSAvIGNodW5rU2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRYaHI6IGZ1bmN0aW9uKGlkLCBvcHRDaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIHZhciBjaHVua0lkeCA9IG9wdENodW5rSWR4ID09IG51bGwgPyAtMSA6IG9wdENodW5rSWR4O1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAueGhyc1tjaHVua0lkeF07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFhocnM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC54aHJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pdGVyYXRlUmVzdW1lUmVjb3JkczogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdW1lRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGxvY2FsU3RvcmFnZSwgZnVuY3Rpb24oa2V5LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YocXEuZm9ybWF0KFwicXF7fXJlc3VtZVwiLCBuYW1lc3BhY2UpKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gSlNPTi5wYXJzZShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhrZXksIHVwbG9hZERhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRUZW1wU3RhdGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wID0ge1xuICAgICAgICAgICAgICAgICAgICBhamF4UmVxdWVzdGVyczoge30sXG4gICAgICAgICAgICAgICAgICAgIGNodW5rUHJvZ3Jlc3M6IHt9LFxuICAgICAgICAgICAgICAgICAgICB4aHJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkQ2h1bmtzOiB7fVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21hcmtOb3RSZXN1bWFibGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5ub3RSZXN1bWFibGUgPSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZURlbGV0ZVBlcnNpc3RlZENodW5rRGF0YTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbG9jYWxTdG9yYWdlSWQ7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtZUVuYWJsZWQgJiYgaGFuZGxlci5pc1Jlc3VtYWJsZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlSWQgPSBoYW5kbGVyLl9nZXRMb2NhbFN0b3JhZ2VJZChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2VJZCAmJiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsb2NhbFN0b3JhZ2VJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGxvY2FsU3RvcmFnZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVQcmVwYXJlRm9yUmVzdW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCksIGxvY2FsU3RvcmFnZUlkLCBwZXJzaXN0ZWREYXRhO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bWVFbmFibGVkICYmIHN0YXRlLmtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZUlkID0gaGFuZGxlci5fZ2V0TG9jYWxTdG9yYWdlSWQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBwZXJzaXN0ZWREYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxTdG9yYWdlSWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGVyc2lzdGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdGVkRGF0YSA9IEpTT04ucGFyc2UocGVyc2lzdGVkRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0RGF0YUJ5VXVpZChwZXJzaXN0ZWREYXRhLnV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fbWFya05vdFJlc3VtYWJsZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJJZGVudGlmaWVkIGZpbGUgd2l0aCBJRCB7fSBhbmQgbmFtZSBvZiB7fSBhcyByZXN1bWFibGUuXCIsIGlkLCBnZXROYW1lKGlkKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVXVpZENoYW5nZWQoaWQsIHBlcnNpc3RlZERhdGEudXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUua2V5ID0gcGVyc2lzdGVkRGF0YS5rZXk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcgPSBwZXJzaXN0ZWREYXRhLmNodW5raW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxvYWRlZCA9IHBlcnNpc3RlZERhdGEubG9hZGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmN1c3RvbVJlc3VtZURhdGEgPSBwZXJzaXN0ZWREYXRhLmN1c3RvbVJlc3VtZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuYXR0ZW1wdGluZ1Jlc3VtZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5tb3ZlSW5Qcm9ncmVzc1RvUmVtYWluaW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVQZXJzaXN0Q2h1bmtlZFN0YXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCksIGxvY2FsU3RvcmFnZUlkLCBwZXJzaXN0ZWREYXRhO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bWVFbmFibGVkICYmIGhhbmRsZXIuaXNSZXN1bWFibGUoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXN0b21SZXN1bWVEYXRhID0gZ2V0Q3VzdG9tUmVzdW1lRGF0YShpZCk7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZUlkID0gaGFuZGxlci5fZ2V0TG9jYWxTdG9yYWdlSWQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBwZXJzaXN0ZWREYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZ2V0TmFtZShpZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBnZXRTaXplKGlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGdldFV1aWQoaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBzdGF0ZS5rZXksXG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua2luZzogc3RhdGUuY2h1bmtpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IHN0YXRlLmxvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVkOiBEYXRlLm5vdygpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXN0b21SZXN1bWVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0ZWREYXRhLmN1c3RvbVJlc3VtZURhdGEgPSBjdXN0b21SZXN1bWVEYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhZ2VJZCwgSlNPTi5zdHJpbmdpZnkocGVyc2lzdGVkRGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIlVuYWJsZSB0byBzYXZlIHJlc3VtZSBkYXRhIGZvciAne30nIGR1ZSB0byBlcnJvcjogJ3t9Jy5cIiwgaWQsIGVycm9yLnRvU3RyaW5nKCkpLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3JlZ2lzdGVyUHJvZ3Jlc3NIYW5kbGVyOiBmdW5jdGlvbihpZCwgY2h1bmtJZHgsIGNodW5rU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciB4aHIgPSBoYW5kbGVyLl9nZXRYaHIoaWQsIGNodW5rSWR4KSwgbmFtZSA9IGdldE5hbWUoaWQpLCBwcm9ncmVzc0NhbGN1bGF0b3IgPSB7XG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZTogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVTaXplID0gZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVkID09PSB0b3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MoaWQsIG5hbWUsIGZpbGVTaXplLCBmaWxlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MoaWQsIG5hbWUsIGxvYWRlZCA+PSBmaWxlU2l6ZSA/IGZpbGVTaXplIC0gMSA6IGxvYWRlZCwgZmlsZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjaHVua2VkOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2h1bmtQcm9ncmVzcyA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5jaHVua1Byb2dyZXNzLCB0b3RhbFN1Y2Nlc3NmdWxseUxvYWRlZEZvckZpbGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmxvYWRlZCwgbG9hZGVkRm9yUmVxdWVzdCA9IGxvYWRlZCwgdG90YWxGb3JSZXF1ZXN0ID0gdG90YWwsIHRvdGFsRmlsZVNpemUgPSBnZXRTaXplKGlkKSwgZXN0QWN0dWFsQ2h1bmtMb2FkZWQgPSBsb2FkZWRGb3JSZXF1ZXN0IC0gKHRvdGFsRm9yUmVxdWVzdCAtIGNodW5rU2l6ZSksIHRvdGFsTG9hZGVkRm9yRmlsZSA9IHRvdGFsU3VjY2Vzc2Z1bGx5TG9hZGVkRm9yRmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rUHJvZ3Jlc3NbY2h1bmtJZHhdID0gZXN0QWN0dWFsQ2h1bmtMb2FkZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGNodW5rUHJvZ3Jlc3MsIGZ1bmN0aW9uKGNodW5rSWR4LCBjaHVua0xvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkRm9yRmlsZSArPSBjaHVua0xvYWRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzcyhpZCwgbmFtZSwgdG90YWxMb2FkZWRGb3JGaWxlLCB0b3RhbEZpbGVTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5sZW5ndGhDb21wdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGNodW5rU2l6ZSA9PSBudWxsID8gXCJzaW1wbGVcIiA6IFwiY2h1bmtlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NDYWxjdWxhdG9yW3R5cGVdKGUubG9hZGVkLCBlLnRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3JlZ2lzdGVyWGhyOiBmdW5jdGlvbihpZCwgb3B0Q2h1bmtJZHgsIHhociwgb3B0QWpheFJlcXVlc3Rlcikge1xuICAgICAgICAgICAgICAgIHZhciB4aHJzSWQgPSBvcHRDaHVua0lkeCA9PSBudWxsID8gLTEgOiBvcHRDaHVua0lkeCwgdGVtcFN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wO1xuICAgICAgICAgICAgICAgIHRlbXBTdGF0ZS54aHJzID0gdGVtcFN0YXRlLnhocnMgfHwge307XG4gICAgICAgICAgICAgICAgdGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzID0gdGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzIHx8IHt9O1xuICAgICAgICAgICAgICAgIHRlbXBTdGF0ZS54aHJzW3hocnNJZF0gPSB4aHI7XG4gICAgICAgICAgICAgICAgaWYgKG9wdEFqYXhSZXF1ZXN0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcFN0YXRlLmFqYXhSZXF1ZXN0ZXJzW3hocnNJZF0gPSBvcHRBamF4UmVxdWVzdGVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4geGhyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9yZW1vdmVFeHBpcmVkQ2h1bmtpbmdSZWNvcmRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXhwaXJhdGlvbkRheXMgPSByZXN1bWUucmVjb3Jkc0V4cGlyZUluO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2l0ZXJhdGVSZXN1bWVSZWNvcmRzKGZ1bmN0aW9uKGtleSwgdXBsb2FkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSh1cGxvYWREYXRhLmxhc3RVcGRhdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0RGF0ZShleHBpcmF0aW9uRGF0ZS5nZXREYXRlKCkgKyBleHBpcmF0aW9uRGF5cyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCkgPD0gRGF0ZS5ub3coKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUmVtb3ZpbmcgZXhwaXJlZCByZXN1bWUgcmVjb3JkIHdpdGgga2V5IFwiICsga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvdWxkQ2h1bmtUaGlzRmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmNodW5raW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnJlZXZhbHVhdGVDaHVua2luZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmNodW5raW5nLmVuYWJsZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLkRlbGV0ZUZpbGVBamF4UmVxdWVzdGVyID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHJlcXVlc3Rlciwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgICAgIHV1aWRQYXJhbU5hbWU6IFwicXF1dWlkXCIsXG4gICAgICAgICAgICBlbmRwb2ludFN0b3JlOiB7fSxcbiAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiAzLFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHt9LFxuICAgICAgICAgICAgY29yczoge1xuICAgICAgICAgICAgICAgIGV4cGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZW5kQ3JlZGVudGlhbHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7fSxcbiAgICAgICAgICAgIG9uRGVsZXRlOiBmdW5jdGlvbihpZCkge30sXG4gICAgICAgICAgICBvbkRlbGV0ZUNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFuZGF0ZWRQYXJhbXMoKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5tZXRob2QudG9VcHBlckNhc2UoKSA9PT0gXCJQT1NUXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBfbWV0aG9kOiBcIkRFTEVURVwiXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgICByZXF1ZXN0ZXIgPSBxcS5leHRlbmQodGhpcywgbmV3IHFxLkFqYXhSZXF1ZXN0ZXIoe1xuICAgICAgICAgICAgYWNjZXB0SGVhZGVyOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIHZhbGlkTWV0aG9kczogWyBcIlBPU1RcIiwgXCJERUxFVEVcIiBdLFxuICAgICAgICAgICAgbWV0aG9kOiBvcHRpb25zLm1ldGhvZCxcbiAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IG9wdGlvbnMuZW5kcG9pbnRTdG9yZSxcbiAgICAgICAgICAgIHBhcmFtc1N0b3JlOiBvcHRpb25zLnBhcmFtc1N0b3JlLFxuICAgICAgICAgICAgbWFuZGF0ZWRQYXJhbXM6IGdldE1hbmRhdGVkUGFyYW1zKCksXG4gICAgICAgICAgICBtYXhDb25uZWN0aW9uczogb3B0aW9ucy5tYXhDb25uZWN0aW9ucyxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuY3VzdG9tSGVhZGVycy5nZXQoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZzogb3B0aW9ucy5sb2csXG4gICAgICAgICAgICBvblNlbmQ6IG9wdGlvbnMub25EZWxldGUsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBvcHRpb25zLm9uRGVsZXRlQ29tcGxldGUsXG4gICAgICAgICAgICBjb3JzOiBvcHRpb25zLmNvcnNcbiAgICAgICAgfSkpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgc2VuZERlbGV0ZTogZnVuY3Rpb24oaWQsIHV1aWQsIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBhZGRpdGlvbmFsT3B0aW9ucyA9IGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhcIlN1Ym1pdHRpbmcgZGVsZXRlIGZpbGUgcmVxdWVzdCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWV0aG9kID09PSBcIkRFTEVURVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Rlci5pbml0VHJhbnNwb3J0KGlkKS53aXRoUGF0aCh1dWlkKS53aXRoUGFyYW1zKGFkZGl0aW9uYWxPcHRpb25zKS5zZW5kKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbE9wdGlvbnNbb3B0aW9ucy51dWlkUGFyYW1OYW1lXSA9IHV1aWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Rlci5pbml0VHJhbnNwb3J0KGlkKS53aXRoUGFyYW1zKGFkZGl0aW9uYWxPcHRpb25zKS5zZW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgZnVuY3Rpb24gZGV0ZWN0U3Vic2FtcGxpbmcoaW1nKSB7XG4gICAgICAgICAgICB2YXIgaXcgPSBpbWcubmF0dXJhbFdpZHRoLCBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0LCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBjdHg7XG4gICAgICAgICAgICBpZiAoaXcgKiBpaCA+IDEwMjQgKiAxMDI0KSB7XG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDE7XG4gICAgICAgICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgLWl3ICsgMSwgMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YVszXSA9PT0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRldGVjdFZlcnRpY2FsU3F1YXNoKGltZywgaXcsIGloKSB7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgc3kgPSAwLCBleSA9IGloLCBweSA9IGloLCBjdHgsIGRhdGEsIGFscGhhLCByYXRpbztcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IDE7XG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaWg7XG4gICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgICAgICAgICAgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgaWgpLmRhdGE7XG4gICAgICAgICAgICB3aGlsZSAocHkgPiBzeSkge1xuICAgICAgICAgICAgICAgIGFscGhhID0gZGF0YVsocHkgLSAxKSAqIDQgKyAzXTtcbiAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZXkgPSBweTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzeSA9IHB5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBweSA9IGV5ICsgc3kgPj4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJhdGlvID0gcHkgLyBpaDtcbiAgICAgICAgICAgIHJldHVybiByYXRpbyA9PT0gMCA/IDEgOiByYXRpbztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZW5kZXJJbWFnZVRvRGF0YVVSTChpbWcsIGJsb2IsIG9wdGlvbnMsIGRvU3F1YXNoKSB7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgbWltZSA9IG9wdGlvbnMubWltZSB8fCBcImltYWdlL2pwZWdcIiwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICByZW5kZXJJbWFnZVRvQ2FudmFzKGltZywgYmxvYiwgY2FudmFzLCBvcHRpb25zLCBkb1NxdWFzaCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoY2FudmFzLnRvRGF0YVVSTChtaW1lLCBvcHRpb25zLnF1YWxpdHkgfHwgLjgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gbWF5YmVDYWxjdWxhdGVEb3duc2FtcGxlZERpbWVuc2lvbnMoc3BlYykge1xuICAgICAgICAgICAgdmFyIG1heFBpeGVscyA9IDUyNDFlMztcbiAgICAgICAgICAgIGlmICghcXEuaW9zKCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoXCJEb3duc2FtcGxlZCBkaW1lbnNpb25zIGNhbiBvbmx5IGJlIHJlbGlhYmx5IGNhbGN1bGF0ZWQgZm9yIGlPUyFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3BlYy5vcmlnSGVpZ2h0ICogc3BlYy5vcmlnV2lkdGggPiBtYXhQaXhlbHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuZXdIZWlnaHQ6IE1hdGgucm91bmQoTWF0aC5zcXJ0KG1heFBpeGVscyAqIChzcGVjLm9yaWdIZWlnaHQgLyBzcGVjLm9yaWdXaWR0aCkpKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3V2lkdGg6IE1hdGgucm91bmQoTWF0aC5zcXJ0KG1heFBpeGVscyAqIChzcGVjLm9yaWdXaWR0aCAvIHNwZWMub3JpZ0hlaWdodCkpKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVuZGVySW1hZ2VUb0NhbnZhcyhpbWcsIGJsb2IsIGNhbnZhcywgb3B0aW9ucywgZG9TcXVhc2gpIHtcbiAgICAgICAgICAgIHZhciBpdyA9IGltZy5uYXR1cmFsV2lkdGgsIGloID0gaW1nLm5hdHVyYWxIZWlnaHQsIHdpZHRoID0gb3B0aW9ucy53aWR0aCwgaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQsIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIiksIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpLCBtb2RpZmllZERpbWVuc2lvbnM7XG4gICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVzaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlckltYWdlVG9DYW52YXNXaXRoQ3VzdG9tUmVzaXplcih7XG4gICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhczogY2FudmFzLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZTogaW1nLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZUhlaWdodDogaWgsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlV2lkdGg6IGl3LFxuICAgICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogb3B0aW9ucy5vcmllbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBvcHRpb25zLnJlc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFdpZHRoOiB3aWR0aFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy51bmxpbWl0ZWRTY2FsZWRJbWFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICBtb2RpZmllZERpbWVuc2lvbnMgPSBtYXliZUNhbGN1bGF0ZURvd25zYW1wbGVkRGltZW5zaW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIG9yaWdXaWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIG9yaWdIZWlnaHQ6IGhlaWdodFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChtb2RpZmllZERpbWVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEubG9nKHFxLmZvcm1hdChcIkhhZCB0byByZWR1Y2UgZGltZW5zaW9ucyBkdWUgdG8gZGV2aWNlIGxpbWl0YXRpb25zIGZyb20ge313IC8ge31oIHRvIHt9dyAvIHt9aFwiLCB3aWR0aCwgaGVpZ2h0LCBtb2RpZmllZERpbWVuc2lvbnMubmV3V2lkdGgsIG1vZGlmaWVkRGltZW5zaW9ucy5uZXdIZWlnaHQpLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gbW9kaWZpZWREaW1lbnNpb25zLm5ld1dpZHRoO1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBtb2RpZmllZERpbWVuc2lvbnMubmV3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyYW5zZm9ybUNvb3JkaW5hdGUoY2FudmFzLCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zLm9yaWVudGF0aW9uKTtcbiAgICAgICAgICAgIGlmIChxcS5pb3MoKSkge1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRldGVjdFN1YnNhbXBsaW5nKGltZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl3IC89IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpaCAvPSAyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gMTAyNCwgdG1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgdmVydFNxdWFzaFJhdGlvID0gZG9TcXVhc2ggPyBkZXRlY3RWZXJ0aWNhbFNxdWFzaChpbWcsIGl3LCBpaCkgOiAxLCBkdyA9IE1hdGguY2VpbChkICogd2lkdGggLyBpdyksIGRoID0gTWF0aC5jZWlsKGQgKiBoZWlnaHQgLyBpaCAvIHZlcnRTcXVhc2hSYXRpbyksIHN5ID0gMCwgZHkgPSAwLCB0bXBDdHgsIHN4LCBkeDtcbiAgICAgICAgICAgICAgICAgICAgdG1wQ2FudmFzLndpZHRoID0gdG1wQ2FudmFzLmhlaWdodCA9IGQ7XG4gICAgICAgICAgICAgICAgICAgIHRtcEN0eCA9IHRtcENhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChzeSA8IGloKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBkeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3ggPCBpdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcEN0eC5jbGVhclJlY3QoMCwgMCwgZCwgZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wQ3R4LmRyYXdJbWFnZShpbWcsIC1zeCwgLXN5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRtcENhbnZhcywgMCwgMCwgZCwgZCwgZHgsIGR5LCBkdywgZGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN4ICs9IGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggKz0gZHc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzeSArPSBkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHkgKz0gZGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdG1wQ2FudmFzID0gdG1wQ3R4ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYW52YXMucXFJbWFnZVJlbmRlcmVkICYmIGNhbnZhcy5xcUltYWdlUmVuZGVyZWQoKTtcbiAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVuZGVySW1hZ2VUb0NhbnZhc1dpdGhDdXN0b21SZXNpemVyKHJlc2l6ZUluZm8pIHtcbiAgICAgICAgICAgIHZhciBibG9iID0gcmVzaXplSW5mby5ibG9iLCBpbWFnZSA9IHJlc2l6ZUluZm8uaW1hZ2UsIGltYWdlSGVpZ2h0ID0gcmVzaXplSW5mby5pbWFnZUhlaWdodCwgaW1hZ2VXaWR0aCA9IHJlc2l6ZUluZm8uaW1hZ2VXaWR0aCwgb3JpZW50YXRpb24gPSByZXNpemVJbmZvLm9yaWVudGF0aW9uLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKSwgcmVzaXplID0gcmVzaXplSW5mby5yZXNpemUsIHNvdXJjZUNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksIHNvdXJjZUNhbnZhc0NvbnRleHQgPSBzb3VyY2VDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLCB0YXJnZXRDYW52YXMgPSByZXNpemVJbmZvLmNhbnZhcywgdGFyZ2V0SGVpZ2h0ID0gcmVzaXplSW5mby50YXJnZXRIZWlnaHQsIHRhcmdldFdpZHRoID0gcmVzaXplSW5mby50YXJnZXRXaWR0aDtcbiAgICAgICAgICAgIHRyYW5zZm9ybUNvb3JkaW5hdGUoc291cmNlQ2FudmFzLCBpbWFnZVdpZHRoLCBpbWFnZUhlaWdodCwgb3JpZW50YXRpb24pO1xuICAgICAgICAgICAgdGFyZ2V0Q2FudmFzLmhlaWdodCA9IHRhcmdldEhlaWdodDtcbiAgICAgICAgICAgIHRhcmdldENhbnZhcy53aWR0aCA9IHRhcmdldFdpZHRoO1xuICAgICAgICAgICAgc291cmNlQ2FudmFzQ29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApO1xuICAgICAgICAgICAgcmVzaXplKHtcbiAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgIGhlaWdodDogdGFyZ2V0SGVpZ2h0LFxuICAgICAgICAgICAgICAgIGltYWdlOiBpbWFnZSxcbiAgICAgICAgICAgICAgICBzb3VyY2VDYW52YXM6IHNvdXJjZUNhbnZhcyxcbiAgICAgICAgICAgICAgICB0YXJnZXRDYW52YXM6IHRhcmdldENhbnZhcyxcbiAgICAgICAgICAgICAgICB3aWR0aDogdGFyZ2V0V2lkdGhcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRDYW52YXMucXFJbWFnZVJlbmRlcmVkICYmIHRhcmdldENhbnZhcy5xcUltYWdlUmVuZGVyZWQoKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIH0sIHByb21pc2UuZmFpbHVyZSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Db29yZGluYXRlKGNhbnZhcywgd2lkdGgsIGhlaWdodCwgb3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgIHN3aXRjaCAob3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGhlaWdodDtcbiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2lkdGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCAwKTtcbiAgICAgICAgICAgICAgICBjdHguc2NhbGUoLTEsIDEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBjdHguc2NhbGUoMSwgLTEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICBjdHgucm90YXRlKC41ICogTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgY3R4LnNjYWxlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSguNSAqIE1hdGguUEkpO1xuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgLWhlaWdodCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoLjUgKiBNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCAtaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBjdHguc2NhbGUoLTEsIDEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICBjdHgucm90YXRlKC0uNSAqIE1hdGguUEkpO1xuICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoLXdpZHRoLCAwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIE1lZ2FQaXhJbWFnZShzcmNJbWFnZSwgZXJyb3JDYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5CbG9iICYmIHNyY0ltYWdlIGluc3RhbmNlb2YgQmxvYikge1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpLCBVUkwgPSB3aW5kb3cuVVJMICYmIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMID8gd2luZG93LlVSTCA6IHdpbmRvdy53ZWJraXRVUkwgJiYgd2luZG93LndlYmtpdFVSTC5jcmVhdGVPYmplY3RVUkwgPyB3aW5kb3cud2Via2l0VVJMIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFVUkwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwiTm8gY3JlYXRlT2JqZWN0VVJMIGZ1bmN0aW9uIGZvdW5kIHRvIGNyZWF0ZSBibG9iIHVybFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChzcmNJbWFnZSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYmxvYiA9IHNyY0ltYWdlO1xuICAgICAgICAgICAgICAgICAgICBzcmNJbWFnZSA9IGltZztcbiAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzcmNJbWFnZS5uYXR1cmFsV2lkdGggJiYgIXNyY0ltYWdlLm5hdHVyYWxIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBzcmNJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVycyA9IHNlbGYuaW1hZ2VMb2FkTGlzdGVuZXJzO1xuICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmltYWdlTG9hZExpc3RlbmVycyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzW2ldKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHNyY0ltYWdlLm9uZXJyb3IgPSBlcnJvckNhbGxiYWNrO1xuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VMb2FkTGlzdGVuZXJzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNyY0ltYWdlID0gc3JjSW1hZ2U7XG4gICAgICAgIH1cbiAgICAgICAgTWVnYVBpeEltYWdlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbih0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBpbWdXaWR0aCA9IHRoaXMuc3JjSW1hZ2UubmF0dXJhbFdpZHRoLCBpbWdIZWlnaHQgPSB0aGlzLnNyY0ltYWdlLm5hdHVyYWxIZWlnaHQsIHdpZHRoID0gb3B0aW9ucy53aWR0aCwgaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQsIG1heFdpZHRoID0gb3B0aW9ucy5tYXhXaWR0aCwgbWF4SGVpZ2h0ID0gb3B0aW9ucy5tYXhIZWlnaHQsIGRvU3F1YXNoID0gIXRoaXMuYmxvYiB8fCB0aGlzLmJsb2IudHlwZSA9PT0gXCJpbWFnZS9qcGVnXCIsIHRhZ05hbWUgPSB0YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpLCBvcHQ7XG4gICAgICAgICAgICBpZiAodGhpcy5pbWFnZUxvYWRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlTG9hZExpc3RlbmVycy5wdXNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcih0YXJnZXQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3aWR0aCAmJiAhaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaW1nSGVpZ2h0ICogd2lkdGggLyBpbWdXaWR0aCA8PCAwO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoZWlnaHQgJiYgIXdpZHRoKSB7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBpbWdXaWR0aCAqIGhlaWdodCAvIGltZ0hlaWdodCA8PCAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGltZ1dpZHRoO1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGltZ0hlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXhXaWR0aCAmJiB3aWR0aCA+IG1heFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBtYXhXaWR0aDtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBpbWdIZWlnaHQgKiB3aWR0aCAvIGltZ1dpZHRoIDw8IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF4SGVpZ2h0ICYmIGhlaWdodCA+IG1heEhlaWdodCkge1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IG1heEhlaWdodDtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGltZ1dpZHRoICogaGVpZ2h0IC8gaW1nSGVpZ2h0IDw8IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHQgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgICB9LCBxcS5lYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKG9wdGlvbnNLZXksIG9wdGlvbnNWYWx1ZSkge1xuICAgICAgICAgICAgICAgIG9wdFtvcHRpb25zS2V5XSA9IG9wdGlvbnNWYWx1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRhZ05hbWUgPT09IFwiaW1nXCIpIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvbGRUYXJnZXRTcmMgPSB0YXJnZXQuc3JjO1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJJbWFnZVRvRGF0YVVSTChzZWxmLnNyY0ltYWdlLCBzZWxmLmJsb2IsIG9wdCwgZG9TcXVhc2gpLnRoZW4oZnVuY3Rpb24oZGF0YVVyaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNyYyA9IGRhdGFVcmk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRUYXJnZXRTcmMgPT09IHRhcmdldC5zcmMgJiYgdGFyZ2V0Lm9ubG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWdOYW1lID09PSBcImNhbnZhc1wiKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVySW1hZ2VUb0NhbnZhcyh0aGlzLnNyY0ltYWdlLCB0aGlzLmJsb2IsIHRhcmdldCwgb3B0LCBkb1NxdWFzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub25yZW5kZXIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMub25yZW5kZXIodGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuTWVnYVBpeEltYWdlID0gTWVnYVBpeEltYWdlO1xuICAgIH0pKCk7XG4gICAgcXEuSW1hZ2VHZW5lcmF0b3IgPSBmdW5jdGlvbihsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGZ1bmN0aW9uIGlzSW1nKGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImltZ1wiO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ2FudmFzKGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImNhbnZhc1wiO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzSW1nQ29yc1N1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgSW1hZ2UoKS5jcm9zc09yaWdpbiAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzQ2FudmFzU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgICAgICByZXR1cm4gY2FudmFzLmdldENvbnRleHQgJiYgY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkZXRlcm1pbmVNaW1lT2ZGaWxlTmFtZShuYW1lV2l0aFBhdGgpIHtcbiAgICAgICAgICAgIHZhciBwYXRoU2VnbWVudHMgPSBuYW1lV2l0aFBhdGguc3BsaXQoXCIvXCIpLCBuYW1lID0gcGF0aFNlZ21lbnRzW3BhdGhTZWdtZW50cy5sZW5ndGggLSAxXS5zcGxpdChcIj9cIilbMF0sIGV4dGVuc2lvbiA9IHFxLmdldEV4dGVuc2lvbihuYW1lKTtcbiAgICAgICAgICAgIGV4dGVuc2lvbiA9IGV4dGVuc2lvbiAmJiBleHRlbnNpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJqcGVnXCI6XG4gICAgICAgICAgICAgIGNhc2UgXCJqcGdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS9qcGVnXCI7XG5cbiAgICAgICAgICAgICAgY2FzZSBcInBuZ1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL3BuZ1wiO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJibXBcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS9ibXBcIjtcblxuICAgICAgICAgICAgICBjYXNlIFwiZ2lmXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvZ2lmXCI7XG5cbiAgICAgICAgICAgICAgY2FzZSBcInRpZmZcIjpcbiAgICAgICAgICAgICAgY2FzZSBcInRpZlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL3RpZmZcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0Nyb3NzT3JpZ2luKHVybCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldEFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLCB0YXJnZXRQcm90b2NvbCwgdGFyZ2V0SG9zdG5hbWUsIHRhcmdldFBvcnQ7XG4gICAgICAgICAgICB0YXJnZXRBbmNob3IuaHJlZiA9IHVybDtcbiAgICAgICAgICAgIHRhcmdldFByb3RvY29sID0gdGFyZ2V0QW5jaG9yLnByb3RvY29sO1xuICAgICAgICAgICAgdGFyZ2V0UG9ydCA9IHRhcmdldEFuY2hvci5wb3J0O1xuICAgICAgICAgICAgdGFyZ2V0SG9zdG5hbWUgPSB0YXJnZXRBbmNob3IuaG9zdG5hbWU7XG4gICAgICAgICAgICBpZiAodGFyZ2V0UHJvdG9jb2wudG9Mb3dlckNhc2UoKSAhPT0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXJnZXRIb3N0bmFtZS50b0xvd2VyQ2FzZSgpICE9PSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhcmdldFBvcnQgIT09IHdpbmRvdy5sb2NhdGlvbi5wb3J0ICYmICFxcS5pZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJJbWdMb2FkTGlzdGVuZXJzKGltZywgcHJvbWlzZSkge1xuICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGltZy5vbmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoaW1nKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGltZy5vbmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIGRyYXdpbmcgdGh1bWJuYWlsIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShpbWcsIFwiUHJvYmxlbSBkcmF3aW5nIHRodW1ibmFpbCFcIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQ2FudmFzRHJhd0ltYWdlTGlzdGVuZXIoY2FudmFzLCBwcm9taXNlKSB7XG4gICAgICAgICAgICBjYW52YXMucXFJbWFnZVJlbmRlcmVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKGNhbnZhcyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcihpbWdPckNhbnZhcywgcHJvbWlzZSkge1xuICAgICAgICAgICAgdmFyIHJlZ2lzdGVyZWQgPSBpc0ltZyhpbWdPckNhbnZhcykgfHwgaXNDYW52YXMoaW1nT3JDYW52YXMpO1xuICAgICAgICAgICAgaWYgKGlzSW1nKGltZ09yQ2FudmFzKSkge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVySW1nTG9hZExpc3RlbmVycyhpbWdPckNhbnZhcywgcHJvbWlzZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ2FudmFzKGltZ09yQ2FudmFzKSkge1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVyQ2FudmFzRHJhd0ltYWdlTGlzdGVuZXIoaW1nT3JDYW52YXMsIHByb21pc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoaW1nT3JDYW52YXMpO1xuICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJFbGVtZW50IGNvbnRhaW5lciBvZiB0eXBlIHt9IGlzIG5vdCBzdXBwb3J0ZWQhXCIsIGltZ09yQ2FudmFzLnRhZ05hbWUpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdGVyZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZHJhdyhmaWxlT3JCbG9iLCBjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBkcmF3UHJldmlldyA9IG5ldyBxcS5Qcm9taXNlKCksIGlkZW50aWZpZXIgPSBuZXcgcXEuSWRlbnRpZnkoZmlsZU9yQmxvYiwgbG9nKSwgbWF4U2l6ZSA9IG9wdGlvbnMubWF4U2l6ZSwgb3JpZW50ID0gb3B0aW9ucy5vcmllbnQgPT0gbnVsbCA/IHRydWUgOiBvcHRpb25zLm9yaWVudCwgbWVnYXBpeEVycm9ySGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vbmVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICBjb250YWluZXIub25sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBsb2coXCJDb3VsZCBub3QgcmVuZGVyIHByZXZpZXcsIGZpbGUgbWF5IGJlIHRvbyBsYXJnZSFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBkcmF3UHJldmlldy5mYWlsdXJlKGNvbnRhaW5lciwgXCJCcm93c2VyIGNhbm5vdCByZW5kZXIgaW1hZ2UhXCIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlkZW50aWZpZXIuaXNQcmV2aWV3YWJsZSgpLnRoZW4oZnVuY3Rpb24obWltZSkge1xuICAgICAgICAgICAgICAgIHZhciBkdW1teUV4aWYgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUHJvbWlzZSgpLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGV4aWYgPSBvcmllbnQgPyBuZXcgcXEuRXhpZihmaWxlT3JCbG9iLCBsb2cpIDogZHVtbXlFeGlmLCBtcEltZyA9IG5ldyBxcS5NZWdhUGl4SW1hZ2UoZmlsZU9yQmxvYiwgbWVnYXBpeEVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcihjb250YWluZXIsIGRyYXdQcmV2aWV3KSkge1xuICAgICAgICAgICAgICAgICAgICBleGlmLnBhcnNlKCkudGhlbihmdW5jdGlvbihleGlmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZW50YXRpb24gPSBleGlmICYmIGV4aWYuT3JpZW50YXRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICBtcEltZy5yZW5kZXIoY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiBvcmllbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW1lOiBtaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogb3B0aW9ucy5jdXN0b21SZXNpemVGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGZhaWx1cmVNc2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJFWElGIGRhdGEgY291bGQgbm90IGJlIHBhcnNlZCAoe30pLiAgQXNzdW1pbmcgb3JpZW50YXRpb24gPSAxLlwiLCBmYWlsdXJlTXNnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtcEltZy5yZW5kZXIoY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbWU6IG1pbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBvcHRpb25zLmN1c3RvbVJlc2l6ZUZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiTm90IHByZXZpZXdhYmxlXCIpO1xuICAgICAgICAgICAgICAgIGRyYXdQcmV2aWV3LmZhaWx1cmUoY29udGFpbmVyLCBcIk5vdCBwcmV2aWV3YWJsZVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRyYXdQcmV2aWV3O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRyYXdPbkNhbnZhc09ySW1nRnJvbVVybCh1cmwsIGNhbnZhc09ySW1nLCBkcmF3LCBtYXhTaXplLCBjdXN0b21SZXNpemVGdW5jdGlvbikge1xuICAgICAgICAgICAgdmFyIHRlbXBJbWcgPSBuZXcgSW1hZ2UoKSwgdGVtcEltZ1JlbmRlciA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICByZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIodGVtcEltZywgdGVtcEltZ1JlbmRlcik7XG4gICAgICAgICAgICBpZiAoaXNDcm9zc09yaWdpbih1cmwpKSB7XG4gICAgICAgICAgICAgICAgdGVtcEltZy5jcm9zc09yaWdpbiA9IFwiYW5vbnltb3VzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZW1wSW1nLnNyYyA9IHVybDtcbiAgICAgICAgICAgIHRlbXBJbWdSZW5kZXIudGhlbihmdW5jdGlvbiByZW5kZXJlZCgpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIoY2FudmFzT3JJbWcsIGRyYXcpO1xuICAgICAgICAgICAgICAgIHZhciBtcEltZyA9IG5ldyBxcS5NZWdhUGl4SW1hZ2UodGVtcEltZyk7XG4gICAgICAgICAgICAgICAgbXBJbWcucmVuZGVyKGNhbnZhc09ySW1nLCB7XG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgIG1pbWU6IGRldGVybWluZU1pbWVPZkZpbGVOYW1lKHVybCksXG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogY3VzdG9tUmVzaXplRnVuY3Rpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIGRyYXcuZmFpbHVyZSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZHJhd09uSW1nRnJvbVVybFdpdGhDc3NTY2FsaW5nKHVybCwgaW1nLCBkcmF3LCBtYXhTaXplKSB7XG4gICAgICAgICAgICByZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIoaW1nLCBkcmF3KTtcbiAgICAgICAgICAgIHFxKGltZykuY3NzKHtcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogbWF4U2l6ZSArIFwicHhcIixcbiAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG1heFNpemUgKyBcInB4XCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW1nLnNyYyA9IHVybDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkcmF3RnJvbVVybCh1cmwsIGNvbnRhaW5lciwgb3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIGRyYXcgPSBuZXcgcXEuUHJvbWlzZSgpLCBzY2FsZSA9IG9wdGlvbnMuc2NhbGUsIG1heFNpemUgPSBzY2FsZSA/IG9wdGlvbnMubWF4U2l6ZSA6IG51bGw7XG4gICAgICAgICAgICBpZiAoc2NhbGUgJiYgaXNJbWcoY29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgIGlmIChpc0NhbnZhc1N1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0Nyb3NzT3JpZ2luKHVybCkgJiYgIWlzSW1nQ29yc1N1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3T25JbWdGcm9tVXJsV2l0aENzc1NjYWxpbmcodXJsLCBjb250YWluZXIsIGRyYXcsIG1heFNpemUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd09uQ2FudmFzT3JJbWdGcm9tVXJsKHVybCwgY29udGFpbmVyLCBkcmF3LCBtYXhTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRyYXdPbkltZ0Zyb21VcmxXaXRoQ3NzU2NhbGluZyh1cmwsIGNvbnRhaW5lciwgZHJhdywgbWF4U2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NhbnZhcyhjb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgZHJhd09uQ2FudmFzT3JJbWdGcm9tVXJsKHVybCwgY29udGFpbmVyLCBkcmF3LCBtYXhTaXplKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKGNvbnRhaW5lciwgZHJhdykpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuc3JjID0gdXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRyYXc7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGdlbmVyYXRlOiBmdW5jdGlvbihmaWxlQmxvYk9yVXJsLCBjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcoZmlsZUJsb2JPclVybCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiQXR0ZW1wdGluZyB0byB1cGRhdGUgdGh1bWJuYWlsIGJhc2VkIG9uIHNlcnZlciByZXNwb25zZS5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkcmF3RnJvbVVybChmaWxlQmxvYk9yVXJsLCBjb250YWluZXIsIG9wdGlvbnMgfHwge30pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkF0dGVtcHRpbmcgdG8gZHJhdyBjbGllbnQtc2lkZSBpbWFnZSBwcmV2aWV3LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRyYXcoZmlsZUJsb2JPclVybCwgY29udGFpbmVyLCBvcHRpb25zIHx8IHt9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90ZXN0aW5nID0ge307XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuaXNJbWcgPSBpc0ltZztcbiAgICAgICAgdGhpcy5fdGVzdGluZy5pc0NhbnZhcyA9IGlzQ2FudmFzO1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmlzQ3Jvc3NPcmlnaW4gPSBpc0Nyb3NzT3JpZ2luO1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmRldGVybWluZU1pbWVPZkZpbGVOYW1lID0gZGV0ZXJtaW5lTWltZU9mRmlsZU5hbWU7XG4gICAgfTtcbiAgICBxcS5FeGlmID0gZnVuY3Rpb24oZmlsZU9yQmxvYiwgbG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgVEFHX0lEUyA9IFsgMjc0IF0sIFRBR19JTkZPID0ge1xuICAgICAgICAgICAgMjc0OiB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJPcmllbnRhdGlvblwiLFxuICAgICAgICAgICAgICAgIGJ5dGVzOiAyXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZ1bmN0aW9uIHBhcnNlTGl0dGxlRW5kaWFuKGhleCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDAsIHBvdyA9IDA7XG4gICAgICAgICAgICB3aGlsZSAoaGV4Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFyc2VJbnQoaGV4LnN1YnN0cmluZygwLCAyKSwgMTYpICogTWF0aC5wb3coMiwgcG93KTtcbiAgICAgICAgICAgICAgICBoZXggPSBoZXguc3Vic3RyaW5nKDIsIGhleC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHBvdyArPSA4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZWVrVG9BcHAxKG9mZnNldCwgcHJvbWlzZSkge1xuICAgICAgICAgICAgdmFyIHRoZU9mZnNldCA9IG9mZnNldCwgdGhlUHJvbWlzZSA9IHByb21pc2U7XG4gICAgICAgICAgICBpZiAodGhlT2Zmc2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGVPZmZzZXQgPSAyO1xuICAgICAgICAgICAgICAgIHRoZVByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCB0aGVPZmZzZXQsIDQpLnRoZW4oZnVuY3Rpb24oaGV4KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gL15mZmUoWzAtOV0pLy5leGVjKGhleCksIHNlZ21lbnRMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaFsxXSAhPT0gXCIxXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRMZW5ndGggPSBwYXJzZUludChoZXguc2xpY2UoNCwgOCksIDE2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZWtUb0FwcDEodGhlT2Zmc2V0ICsgc2VnbWVudExlbmd0aCArIDIsIHRoZVByb21pc2UpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhlUHJvbWlzZS5zdWNjZXNzKHRoZU9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGVQcm9taXNlLmZhaWx1cmUoXCJObyBFWElGIGhlYWRlciB0byBiZSBmb3VuZCFcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhlUHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRBcHAxT2Zmc2V0KCkge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCAwLCA2KS50aGVuKGZ1bmN0aW9uKGhleCkge1xuICAgICAgICAgICAgICAgIGlmIChoZXguaW5kZXhPZihcImZmZDhcIikgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKFwiTm90IGEgdmFsaWQgSlBFRyFcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vla1RvQXBwMSgpLnRoZW4oZnVuY3Rpb24ob2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3Mob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNMaXR0bGVFbmRpYW4oYXBwMVN0YXJ0KSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIGFwcDFTdGFydCArIDEwLCAyKS50aGVuKGZ1bmN0aW9uKGhleCkge1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhoZXggPT09IFwiNDk0OVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGlyRW50cnlDb3VudChhcHAxU3RhcnQsIGxpdHRsZUVuZGlhbikge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCBhcHAxU3RhcnQgKyAxOCwgMikudGhlbihmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAobGl0dGxlRW5kaWFuKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlLnN1Y2Nlc3MocGFyc2VMaXR0bGVFbmRpYW4oaGV4KSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHBhcnNlSW50KGhleCwgMTYpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldElmZChhcHAxU3RhcnQsIGRpckVudHJpZXMpIHtcbiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBhcHAxU3RhcnQgKyAyMCwgYnl0ZXMgPSBkaXJFbnRyaWVzICogMTI7XG4gICAgICAgICAgICByZXR1cm4gcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCBvZmZzZXQsIGJ5dGVzKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXREaXJFbnRyaWVzKGlmZEhleCkge1xuICAgICAgICAgICAgdmFyIGVudHJpZXMgPSBbXSwgb2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIHdoaWxlIChvZmZzZXQgKyAyNCA8PSBpZmRIZXgubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGlmZEhleC5zbGljZShvZmZzZXQsIG9mZnNldCArIDI0KSk7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVudHJpZXM7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGFnVmFsdWVzKGxpdHRsZUVuZGlhbiwgZGlyRW50cmllcykge1xuICAgICAgICAgICAgdmFyIFRBR19WQUxfT0ZGU0VUID0gMTYsIHRhZ3NUb0ZpbmQgPSBxcS5leHRlbmQoW10sIFRBR19JRFMpLCB2YWxzID0ge307XG4gICAgICAgICAgICBxcS5lYWNoKGRpckVudHJpZXMsIGZ1bmN0aW9uKGlkeCwgZW50cnkpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWRIZXggPSBlbnRyeS5zbGljZSgwLCA0KSwgaWQgPSBsaXR0bGVFbmRpYW4gPyBwYXJzZUxpdHRsZUVuZGlhbihpZEhleCkgOiBwYXJzZUludChpZEhleCwgMTYpLCB0YWdzVG9GaW5kSWR4ID0gdGFnc1RvRmluZC5pbmRleE9mKGlkKSwgdGFnVmFsSGV4LCB0YWdOYW1lLCB0YWdWYWxMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRhZ3NUb0ZpbmRJZHggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0YWdOYW1lID0gVEFHX0lORk9baWRdLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRhZ1ZhbExlbmd0aCA9IFRBR19JTkZPW2lkXS5ieXRlcztcbiAgICAgICAgICAgICAgICAgICAgdGFnVmFsSGV4ID0gZW50cnkuc2xpY2UoVEFHX1ZBTF9PRkZTRVQsIFRBR19WQUxfT0ZGU0VUICsgdGFnVmFsTGVuZ3RoICogMik7XG4gICAgICAgICAgICAgICAgICAgIHZhbHNbdGFnTmFtZV0gPSBsaXR0bGVFbmRpYW4gPyBwYXJzZUxpdHRsZUVuZGlhbih0YWdWYWxIZXgpIDogcGFyc2VJbnQodGFnVmFsSGV4LCAxNik7XG4gICAgICAgICAgICAgICAgICAgIHRhZ3NUb0ZpbmQuc3BsaWNlKHRhZ3NUb0ZpbmRJZHgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGFnc1RvRmluZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHM7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IHFxLlByb21pc2UoKSwgb25QYXJzZUZhaWx1cmUgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJFWElGIGhlYWRlciBwYXJzZSBmYWlsZWQ6ICd7fScgXCIsIG1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZhaWx1cmUobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBnZXRBcHAxT2Zmc2V0KCkudGhlbihmdW5jdGlvbihhcHAxT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJNb3ZpbmcgZm9yd2FyZCB3aXRoIEVYSUYgaGVhZGVyIHBhcnNpbmcgZm9yICd7fSdcIiwgZmlsZU9yQmxvYi5uYW1lID09PSB1bmRlZmluZWQgPyBcImJsb2JcIiA6IGZpbGVPckJsb2IubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICBpc0xpdHRsZUVuZGlhbihhcHAxT2Zmc2V0KS50aGVuKGZ1bmN0aW9uKGxpdHRsZUVuZGlhbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkVYSUYgQnl0ZSBvcmRlciBpcyB7fSBlbmRpYW5cIiwgbGl0dGxlRW5kaWFuID8gXCJsaXR0bGVcIiA6IFwiYmlnXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldERpckVudHJ5Q291bnQoYXBwMU9mZnNldCwgbGl0dGxlRW5kaWFuKS50aGVuKGZ1bmN0aW9uKGRpckVudHJ5Q291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRm91bmQge30gQVBQMSBkaXJlY3RvcnkgZW50cmllc1wiLCBkaXJFbnRyeUNvdW50KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SWZkKGFwcDFPZmZzZXQsIGRpckVudHJ5Q291bnQpLnRoZW4oZnVuY3Rpb24oaWZkSGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXJFbnRyaWVzID0gZ2V0RGlyRW50cmllcyhpZmRIZXgpLCB0YWdWYWx1ZXMgPSBnZXRUYWdWYWx1ZXMobGl0dGxlRW5kaWFuLCBkaXJFbnRyaWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiU3VjY2Vzc2Z1bGx5IHBhcnNlZCBzb21lIEVYSUYgdGFnc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnN1Y2Nlc3ModGFnVmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBvblBhcnNlRmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBvblBhcnNlRmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIG9uUGFyc2VGYWlsdXJlKTtcbiAgICAgICAgICAgICAgICB9LCBvblBhcnNlRmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcgPSB7fTtcbiAgICAgICAgdGhpcy5fdGVzdGluZy5wYXJzZUxpdHRsZUVuZGlhbiA9IHBhcnNlTGl0dGxlRW5kaWFuO1xuICAgIH07XG4gICAgcXEuSWRlbnRpZnkgPSBmdW5jdGlvbihmaWxlT3JCbG9iLCBsb2cpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmlhYmxlKG1hZ2ljQnl0ZXMsIHF1ZXN0aW9uYWJsZUJ5dGVzKSB7XG4gICAgICAgICAgICB2YXIgaWRlbnRpZmlhYmxlID0gZmFsc2UsIG1hZ2ljQnl0ZXNFbnRyaWVzID0gW10uY29uY2F0KG1hZ2ljQnl0ZXMpO1xuICAgICAgICAgICAgcXEuZWFjaChtYWdpY0J5dGVzRW50cmllcywgZnVuY3Rpb24oaWR4LCBtYWdpY0J5dGVzQXJyYXlFbnRyeSkge1xuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbmFibGVCeXRlcy5pbmRleE9mKG1hZ2ljQnl0ZXNBcnJheUVudHJ5KSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWFibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gaWRlbnRpZmlhYmxlO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBpc1ByZXZpZXdhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGlkZW50aWZpZXIgPSBuZXcgcXEuUHJvbWlzZSgpLCBwcmV2aWV3YWJsZSA9IGZhbHNlLCBuYW1lID0gZmlsZU9yQmxvYi5uYW1lID09PSB1bmRlZmluZWQgPyBcImJsb2JcIiA6IGZpbGVPckJsb2IubmFtZTtcbiAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiQXR0ZW1wdGluZyB0byBkZXRlcm1pbmUgaWYge30gY2FuIGJlIHJlbmRlcmVkIGluIHRoaXMgYnJvd3NlclwiLCBuYW1lKSk7XG4gICAgICAgICAgICAgICAgbG9nKFwiRmlyc3QgcGFzczogY2hlY2sgdHlwZSBhdHRyaWJ1dGUgb2YgYmxvYiBvYmplY3QuXCIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUHJldmlld2FibGVTeW5jKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiU2Vjb25kIHBhc3M6IGNoZWNrIGZvciBtYWdpYyBieXRlcyBpbiBmaWxlIGhlYWRlci5cIik7XG4gICAgICAgICAgICAgICAgICAgIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgMCwgNCkudGhlbihmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goc2VsZi5QUkVWSUVXQUJMRV9NSU1FX1RZUEVTLCBmdW5jdGlvbihtaW1lLCBieXRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpYWJsZShieXRlcywgaGV4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWltZSAhPT0gXCJpbWFnZS90aWZmXCIgfHwgcXEuc3VwcG9ydGVkRmVhdHVyZXMudGlmZlByZXZpZXdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3YWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyLnN1Y2Nlc3MobWltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIid7fScgaXMge30gYWJsZSB0byBiZSByZW5kZXJlZCBpbiB0aGlzIGJyb3dzZXJcIiwgbmFtZSwgcHJldmlld2FibGUgPyBcIlwiIDogXCJOT1RcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmV2aWV3YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIkVycm9yIHJlYWRpbmcgZmlsZSB3LyBuYW1lICdcIiArIG5hbWUgKyBcIicuICBOb3QgYWJsZSB0byBiZSByZW5kZXJlZCBpbiB0aGlzIGJyb3dzZXIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaWRlbnRpZmllcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1ByZXZpZXdhYmxlU3luYzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVNaW1lID0gZmlsZU9yQmxvYi50eXBlLCBpc1JlY29nbml6ZWRJbWFnZSA9IHFxLmluZGV4T2YoT2JqZWN0LmtleXModGhpcy5QUkVWSUVXQUJMRV9NSU1FX1RZUEVTKSwgZmlsZU1pbWUpID49IDAsIHByZXZpZXdhYmxlID0gZmFsc2UsIG5hbWUgPSBmaWxlT3JCbG9iLm5hbWUgPT09IHVuZGVmaW5lZCA/IFwiYmxvYlwiIDogZmlsZU9yQmxvYi5uYW1lO1xuICAgICAgICAgICAgICAgIGlmIChpc1JlY29nbml6ZWRJbWFnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZU1pbWUgPT09IFwiaW1hZ2UvdGlmZlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3YWJsZSA9IHFxLnN1cHBvcnRlZEZlYXR1cmVzLnRpZmZQcmV2aWV3cztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAhcHJldmlld2FibGUgJiYgbG9nKG5hbWUgKyBcIiBpcyBub3QgcHJldmlld2FibGUgaW4gdGhpcyBicm93c2VyIHBlciB0aGUgYmxvYidzIHR5cGUgYXR0clwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJldmlld2FibGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuSWRlbnRpZnkucHJvdG90eXBlLlBSRVZJRVdBQkxFX01JTUVfVFlQRVMgPSB7XG4gICAgICAgIFwiaW1hZ2UvanBlZ1wiOiBcImZmZDhmZlwiLFxuICAgICAgICBcImltYWdlL2dpZlwiOiBcIjQ3NDk0NlwiLFxuICAgICAgICBcImltYWdlL3BuZ1wiOiBcIjg5NTA0ZVwiLFxuICAgICAgICBcImltYWdlL2JtcFwiOiBcIjQyNGRcIixcbiAgICAgICAgXCJpbWFnZS90aWZmXCI6IFsgXCI0OTQ5MmEwMFwiLCBcIjRkNGQwMDJhXCIgXVxuICAgIH07XG4gICAgcXEuSW1hZ2VWYWxpZGF0aW9uID0gZnVuY3Rpb24oYmxvYiwgbG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBmdW5jdGlvbiBoYXNOb25aZXJvTGltaXRzKGxpbWl0cykge1xuICAgICAgICAgICAgdmFyIGF0TGVhc3RPbmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHFxLmVhY2gobGltaXRzLCBmdW5jdGlvbihsaW1pdCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0TGVhc3RPbmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYXRMZWFzdE9uZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRXaWR0aEhlaWdodCgpIHtcbiAgICAgICAgICAgIHZhciBzaXplRGV0ZXJtaW5hdGlvbiA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBuZXcgcXEuSWRlbnRpZnkoYmxvYiwgbG9nKS5pc1ByZXZpZXdhYmxlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKSwgdXJsID0gd2luZG93LlVSTCAmJiB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTCA/IHdpbmRvdy5VUkwgOiB3aW5kb3cud2Via2l0VVJMICYmIHdpbmRvdy53ZWJraXRVUkwuY3JlYXRlT2JqZWN0VVJMID8gd2luZG93LndlYmtpdFVSTCA6IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHVybCkge1xuICAgICAgICAgICAgICAgICAgICBpbWFnZS5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJDYW5ub3QgZGV0ZXJtaW5lIGRpbWVuc2lvbnMgZm9yIGltYWdlLiAgTWF5IGJlIHRvbyBsYXJnZS5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVEZXRlcm1pbmF0aW9uLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplRGV0ZXJtaW5hdGlvbi5zdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2Uuc3JjID0gdXJsLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJObyBjcmVhdGVPYmplY3RVUkwgZnVuY3Rpb24gYXZhaWxhYmxlIHRvIGdlbmVyYXRlIGltYWdlIFVSTCFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZURldGVybWluYXRpb24uZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHNpemVEZXRlcm1pbmF0aW9uLmZhaWx1cmUpO1xuICAgICAgICAgICAgcmV0dXJuIHNpemVEZXRlcm1pbmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEZhaWxpbmdMaW1pdChsaW1pdHMsIGRpbWVuc2lvbnMpIHtcbiAgICAgICAgICAgIHZhciBmYWlsaW5nTGltaXQ7XG4gICAgICAgICAgICBxcS5lYWNoKGxpbWl0cywgZnVuY3Rpb24obGltaXROYW1lLCBsaW1pdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpbWl0VmFsdWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW1pdE1hdGNoZXIgPSAvKG1heHxtaW4pKFdpZHRofEhlaWdodCkvLmV4ZWMobGltaXROYW1lKSwgZGltZW5zaW9uUHJvcE5hbWUgPSBsaW1pdE1hdGNoZXJbMl0uY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBsaW1pdE1hdGNoZXJbMl0uc2xpY2UoMSksIGFjdHVhbFZhbHVlID0gZGltZW5zaW9uc1tkaW1lbnNpb25Qcm9wTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobGltaXRNYXRjaGVyWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1pblwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdHVhbFZhbHVlIDwgbGltaXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxpbmdMaW1pdCA9IGxpbWl0TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJtYXhcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3R1YWxWYWx1ZSA+IGxpbWl0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsaW5nTGltaXQgPSBsaW1pdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmYWlsaW5nTGltaXQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52YWxpZGF0ZSA9IGZ1bmN0aW9uKGxpbWl0cykge1xuICAgICAgICAgICAgdmFyIHZhbGlkYXRpb25FZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgbG9nKFwiQXR0ZW1wdGluZyB0byB2YWxpZGF0ZSBpbWFnZS5cIik7XG4gICAgICAgICAgICBpZiAoaGFzTm9uWmVyb0xpbWl0cyhsaW1pdHMpKSB7XG4gICAgICAgICAgICAgICAgZ2V0V2lkdGhIZWlnaHQoKS50aGVuKGZ1bmN0aW9uKGRpbWVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWxpbmdMaW1pdCA9IGdldEZhaWxpbmdMaW1pdChsaW1pdHMsIGRpbWVuc2lvbnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbGluZ0xpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uRWZmb3J0LmZhaWx1cmUoZmFpbGluZ0xpbWl0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25FZmZvcnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdmFsaWRhdGlvbkVmZm9ydC5zdWNjZXNzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbkVmZm9ydC5zdWNjZXNzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvbkVmZm9ydDtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHFxLlNlc3Npb24gPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgY29yczoge30sXG4gICAgICAgICAgICBhZGRGaWxlUmVjb3JkOiBmdW5jdGlvbihzZXNzaW9uRGF0YSkge30sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgc3BlYywgdHJ1ZSk7XG4gICAgICAgIGZ1bmN0aW9uIGlzSnNvblJlc3BvbnNlVmFsaWQocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChxcS5pc0FycmF5KHJlc3BvbnNlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy5sb2coXCJTZXNzaW9uIHJlc3BvbnNlIGlzIG5vdCBhbiBhcnJheS5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVGaWxlSXRlbXMoZmlsZUl0ZW1zLCBzdWNjZXNzLCB4aHJPclhkciwgcHJvbWlzZSkge1xuICAgICAgICAgICAgdmFyIHNvbWVJdGVtc0lnbm9yZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzdWNjZXNzICYmIGlzSnNvblJlc3BvbnNlVmFsaWQoZmlsZUl0ZW1zKTtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChmaWxlSXRlbXMsIGZ1bmN0aW9uKGlkeCwgZmlsZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVJdGVtLnV1aWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29tZUl0ZW1zSWdub3JlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhxcS5mb3JtYXQoXCJTZXNzaW9uIHJlc3BvbnNlIGl0ZW0ge30gZGlkIG5vdCBpbmNsdWRlIGEgdmFsaWQgVVVJRCAtIGlnbm9yaW5nLlwiLCBpZHgpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVJdGVtLm5hbWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29tZUl0ZW1zSWdub3JlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhxcS5mb3JtYXQoXCJTZXNzaW9uIHJlc3BvbnNlIGl0ZW0ge30gZGlkIG5vdCBpbmNsdWRlIGEgdmFsaWQgbmFtZSAtIGlnbm9yaW5nLlwiLCBpZHgpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFkZEZpbGVSZWNvcmQoZmlsZUl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29tZUl0ZW1zSWdub3JlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sb2coZXJyLm1lc3NhZ2UsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJvbWlzZVtzdWNjZXNzICYmICFzb21lSXRlbXNJZ25vcmVkID8gXCJzdWNjZXNzXCIgOiBcImZhaWx1cmVcIl0oZmlsZUl0ZW1zLCB4aHJPclhkcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcmVmcmVzaEVmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCksIHJlZnJlc2hDb21wbGV0ZUNhbGxiYWNrID0gZnVuY3Rpb24ocmVzcG9uc2UsIHN1Y2Nlc3MsIHhock9yWGRyKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlRmlsZUl0ZW1zKHJlc3BvbnNlLCBzdWNjZXNzLCB4aHJPclhkciwgcmVmcmVzaEVmZm9ydCk7XG4gICAgICAgICAgICB9LCByZXF1ZXN0ZXJPcHRpb25zID0gcXEuZXh0ZW5kKHt9LCBvcHRpb25zKSwgcmVxdWVzdGVyID0gbmV3IHFxLlNlc3Npb25BamF4UmVxdWVzdGVyKHFxLmV4dGVuZChyZXF1ZXN0ZXJPcHRpb25zLCB7XG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZTogcmVmcmVzaENvbXBsZXRlQ2FsbGJhY2tcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJlcXVlc3Rlci5xdWVyeVNlcnZlcigpO1xuICAgICAgICAgICAgcmV0dXJuIHJlZnJlc2hFZmZvcnQ7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBxcS5TZXNzaW9uQWpheFJlcXVlc3RlciA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciByZXF1ZXN0ZXIsIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgICAgIGNvcnM6IHtcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VuZENyZWRlbnRpYWxzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKHJlc3BvbnNlLCBzdWNjZXNzLCB4aHJPclhkcikge30sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHt9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBzcGVjKTtcbiAgICAgICAgZnVuY3Rpb24gb25Db21wbGV0ZShpZCwgeGhyT3JYZHIsIGlzRXJyb3IpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG51bGw7XG4gICAgICAgICAgICBpZiAoeGhyT3JYZHIucmVzcG9uc2VUZXh0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHFxLnBhcnNlSnNvbih4aHJPclhkci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhcIlByb2JsZW0gcGFyc2luZyBzZXNzaW9uIHJlc3BvbnNlOiBcIiArIGVyci5tZXNzYWdlLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBpc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLm9uQ29tcGxldGUocmVzcG9uc2UsICFpc0Vycm9yLCB4aHJPclhkcik7XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdGVyID0gcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5BamF4UmVxdWVzdGVyKHtcbiAgICAgICAgICAgIGFjY2VwdEhlYWRlcjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICB2YWxpZE1ldGhvZHM6IFsgXCJHRVRcIiBdLFxuICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgZW5kcG9pbnRTdG9yZToge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmVuZHBvaW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiBvcHRpb25zLmN1c3RvbUhlYWRlcnMsXG4gICAgICAgICAgICBsb2c6IG9wdGlvbnMubG9nLFxuICAgICAgICAgICAgb25Db21wbGV0ZTogb25Db21wbGV0ZSxcbiAgICAgICAgICAgIGNvcnM6IG9wdGlvbnMuY29yc1xuICAgICAgICB9KSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBxdWVyeVNlcnZlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHFxLmV4dGVuZCh7fSwgb3B0aW9ucy5wYXJhbXMpO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKFwiU2Vzc2lvbiBxdWVyeSByZXF1ZXN0LlwiKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ZXIuaW5pdFRyYW5zcG9ydChcInNlc3Npb25SZWZyZXNoXCIpLndpdGhQYXJhbXMocGFyYW1zKS53aXRoQ2FjaGVCdXN0ZXIoKS5zZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuU2NhbGVyID0gZnVuY3Rpb24oc3BlYywgbG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uID0gc3BlYy5jdXN0b21SZXNpemVyLCBpbmNsdWRlT3JpZ2luYWwgPSBzcGVjLnNlbmRPcmlnaW5hbCwgb3JpZW50ID0gc3BlYy5vcmllbnQsIGRlZmF1bHRUeXBlID0gc3BlYy5kZWZhdWx0VHlwZSwgZGVmYXVsdFF1YWxpdHkgPSBzcGVjLmRlZmF1bHRRdWFsaXR5IC8gMTAwLCBmYWlsZWRUb1NjYWxlVGV4dCA9IHNwZWMuZmFpbHVyZVRleHQsIGluY2x1ZGVFeGlmID0gc3BlYy5pbmNsdWRlRXhpZiwgc2l6ZXMgPSB0aGlzLl9nZXRTb3J0ZWRTaXplcyhzcGVjLnNpemVzKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGVuYWJsZWQ6IHFxLnN1cHBvcnRlZEZlYXR1cmVzLnNjYWxpbmcgJiYgc2l6ZXMubGVuZ3RoID4gMCxcbiAgICAgICAgICAgIGdldEZpbGVSZWNvcmRzOiBmdW5jdGlvbihvcmlnaW5hbEZpbGVVdWlkLCBvcmlnaW5hbEZpbGVOYW1lLCBvcmlnaW5hbEJsb2JPckJsb2JEYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCByZWNvcmRzID0gW10sIG9yaWdpbmFsQmxvYiA9IG9yaWdpbmFsQmxvYk9yQmxvYkRhdGEuYmxvYiA/IG9yaWdpbmFsQmxvYk9yQmxvYkRhdGEuYmxvYiA6IG9yaWdpbmFsQmxvYk9yQmxvYkRhdGEsIGlkZW50aWZpZXIgPSBuZXcgcXEuSWRlbnRpZnkob3JpZ2luYWxCbG9iLCBsb2cpO1xuICAgICAgICAgICAgICAgIGlmIChpZGVudGlmaWVyLmlzUHJldmlld2FibGVTeW5jKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChzaXplcywgZnVuY3Rpb24oaWR4LCBzaXplUmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3V0cHV0VHlwZSA9IHNlbGYuX2RldGVybWluZU91dHB1dFR5cGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRUeXBlOiBkZWZhdWx0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ZWRUeXBlOiBzaXplUmVjb3JkLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmVHlwZTogb3JpZ2luYWxCbG9iLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBxcS5nZXRVbmlxdWVJZCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuX2dldE5hbWUob3JpZ2luYWxGaWxlTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzaXplUmVjb3JkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG91dHB1dFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlR5cGU6IG9yaWdpbmFsQmxvYi50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogbmV3IHFxLkJsb2JQcm94eShvcmlnaW5hbEJsb2IsIHFxLmJpbmQoc2VsZi5fZ2VuZXJhdGVTY2FsZWRJbWFnZSwgc2VsZiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFNpemU6IHNpemVSZWNvcmQubWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZW50OiBvcmllbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG91dHB1dFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YWxpdHk6IGRlZmF1bHRRdWFsaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWRUZXh0OiBmYWlsZWRUb1NjYWxlVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZUV4aWY6IGluY2x1ZGVFeGlmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2c6IGxvZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogb3JpZ2luYWxGaWxlVXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG9yaWdpbmFsRmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBvcmlnaW5hbEJsb2Iuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IGluY2x1ZGVPcmlnaW5hbCA/IG9yaWdpbmFsQmxvYiA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IG9yaWdpbmFsRmlsZVV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbEZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogb3JpZ2luYWxCbG9iLnNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBvcmlnaW5hbEJsb2JcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZWNvcmRzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhbmRsZU5ld0ZpbGU6IGZ1bmN0aW9uKGZpbGUsIG5hbWUsIHV1aWQsIHNpemUsIGZpbGVMaXN0LCBiYXRjaElkLCB1dWlkUGFyYW1OYW1lLCBhcGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGJ1dHRvbklkID0gZmlsZS5xcUJ1dHRvbklkIHx8IGZpbGUuYmxvYiAmJiBmaWxlLmJsb2IucXFCdXR0b25JZCwgc2NhbGVkSWRzID0gW10sIG9yaWdpbmFsSWQgPSBudWxsLCBhZGRGaWxlVG9IYW5kbGVyID0gYXBpLmFkZEZpbGVUb0hhbmRsZXIsIHVwbG9hZERhdGEgPSBhcGkudXBsb2FkRGF0YSwgcGFyYW1zU3RvcmUgPSBhcGkucGFyYW1zU3RvcmUsIHByb3h5R3JvdXBJZCA9IHFxLmdldFVuaXF1ZUlkKCk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChzZWxmLmdldEZpbGVSZWNvcmRzKHV1aWQsIG5hbWUsIGZpbGUpLCBmdW5jdGlvbihpZHgsIHJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYlNpemUgPSByZWNvcmQuc2l6ZSwgaWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuYmxvYiBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYlNpemUgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZCA9IHVwbG9hZERhdGEuYWRkRmlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiByZWNvcmQudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHJlY29yZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogYmxvYlNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXRjaElkOiBiYXRjaElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlHcm91cElkOiBwcm94eUdyb3VwSWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuYmxvYiBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVkSWRzLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxJZCA9IGlkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuYmxvYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRmlsZVRvSGFuZGxlcihpZCwgcmVjb3JkLmJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHJlY29yZC5ibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuUkVKRUNURUQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChzY2FsZWRJZHMsIGZ1bmN0aW9uKGlkeCwgc2NhbGVkSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXFwYXJlbnR1dWlkOiB1cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IG9yaWdpbmFsSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS51dWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxcGFyZW50c2l6ZTogdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvcmlnaW5hbElkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc2l6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1t1dWlkUGFyYW1OYW1lXSA9IHVwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzY2FsZWRJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudXVpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZERhdGEuc2V0UGFyZW50SWQoc2NhbGVkSWQsIG9yaWdpbmFsSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zU3RvcmUuYWRkUmVhZE9ubHkoc2NhbGVkSWQsIHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NhbGVkSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtW3V1aWRQYXJhbU5hbWVdID0gdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvcmlnaW5hbElkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudXVpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNTdG9yZS5hZGRSZWFkT25seShvcmlnaW5hbElkLCBwYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLmV4dGVuZChxcS5TY2FsZXIucHJvdG90eXBlLCB7XG4gICAgICAgIHNjYWxlSW1hZ2U6IGZ1bmN0aW9uKGlkLCBzcGVjcywgYXBpKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMuc2NhbGluZykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBxcS5FcnJvcihcIlNjYWxpbmcgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXIhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNjYWxpbmdFZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpLCBsb2cgPSBhcGkubG9nLCBmaWxlID0gYXBpLmdldEZpbGUoaWQpLCB1cGxvYWREYXRhID0gYXBpLnVwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgfSksIG5hbWUgPSB1cGxvYWREYXRhICYmIHVwbG9hZERhdGEubmFtZSwgdXVpZCA9IHVwbG9hZERhdGEgJiYgdXBsb2FkRGF0YS51dWlkLCBzY2FsaW5nT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVyOiBzcGVjcy5jdXN0b21SZXNpemVyLFxuICAgICAgICAgICAgICAgIHNlbmRPcmlnaW5hbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgb3JpZW50OiBzcGVjcy5vcmllbnQsXG4gICAgICAgICAgICAgICAgZGVmYXVsdFR5cGU6IHNwZWNzLnR5cGUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBkZWZhdWx0UXVhbGl0eTogc3BlY3MucXVhbGl0eSxcbiAgICAgICAgICAgICAgICBmYWlsZWRUb1NjYWxlVGV4dDogXCJVbmFibGUgdG8gc2NhbGVcIixcbiAgICAgICAgICAgICAgICBzaXplczogWyB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIG1heFNpemU6IHNwZWNzLm1heFNpemVcbiAgICAgICAgICAgICAgICB9IF1cbiAgICAgICAgICAgIH0sIHNjYWxlciA9IG5ldyBxcS5TY2FsZXIoc2NhbGluZ09wdGlvbnMsIGxvZyk7XG4gICAgICAgICAgICBpZiAoIXFxLlNjYWxlciB8fCAhcXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cyB8fCAhZmlsZSkge1xuICAgICAgICAgICAgICAgIHNjYWxpbmdFZmZvcnQuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIGxvZyhcIkNvdWxkIG5vdCBnZW5lcmF0ZSByZXF1ZXN0ZWQgc2NhbGVkIGltYWdlIGZvciBcIiArIGlkICsgXCIuICBcIiArIFwiU2NhbGluZyBpcyBlaXRoZXIgbm90IHBvc3NpYmxlIGluIHRoaXMgYnJvd3Nlciwgb3IgdGhlIGZpbGUgY291bGQgbm90IGJlIGxvY2F0ZWQuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHFxLmJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSBzY2FsZXIuZ2V0RmlsZVJlY29yZHModXVpZCwgbmFtZSwgZmlsZSlbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQgJiYgcmVjb3JkLmJsb2IgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZC5ibG9iLmNyZWF0ZSgpLnRoZW4oc2NhbGluZ0VmZm9ydC5zdWNjZXNzLCBzY2FsaW5nRWZmb3J0LmZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGlkICsgXCIgaXMgbm90IGEgc2NhbGFibGUgaW1hZ2UhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsaW5nRWZmb3J0LmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRoaXMpKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2NhbGluZ0VmZm9ydDtcbiAgICAgICAgfSxcbiAgICAgICAgX2RldGVybWluZU91dHB1dFR5cGU6IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIHJlcXVlc3RlZFR5cGUgPSBzcGVjLnJlcXVlc3RlZFR5cGUsIGRlZmF1bHRUeXBlID0gc3BlYy5kZWZhdWx0VHlwZSwgcmVmZXJlbmNlVHlwZSA9IHNwZWMucmVmVHlwZTtcbiAgICAgICAgICAgIGlmICghZGVmYXVsdFR5cGUgJiYgIXJlcXVlc3RlZFR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVmZXJlbmNlVHlwZSAhPT0gXCJpbWFnZS9qcGVnXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvcG5nXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZWZlcmVuY2VUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFyZXF1ZXN0ZWRUeXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHFxLmluZGV4T2YoT2JqZWN0LmtleXMocXEuSWRlbnRpZnkucHJvdG90eXBlLlBSRVZJRVdBQkxFX01JTUVfVFlQRVMpLCByZXF1ZXN0ZWRUeXBlKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3RlZFR5cGUgPT09IFwiaW1hZ2UvdGlmZlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy50aWZmUHJldmlld3MgPyByZXF1ZXN0ZWRUeXBlIDogZGVmYXVsdFR5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0ZWRUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRUeXBlO1xuICAgICAgICB9LFxuICAgICAgICBfZ2V0TmFtZTogZnVuY3Rpb24ob3JpZ2luYWxOYW1lLCBzY2FsZWRWZXJzaW9uUHJvcGVydGllcykge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgc3RhcnRPZkV4dCA9IG9yaWdpbmFsTmFtZS5sYXN0SW5kZXhPZihcIi5cIiksIHZlcnNpb25UeXBlID0gc2NhbGVkVmVyc2lvblByb3BlcnRpZXMudHlwZSB8fCBcImltYWdlL3BuZ1wiLCByZWZlcmVuY2VUeXBlID0gc2NhbGVkVmVyc2lvblByb3BlcnRpZXMucmVmVHlwZSwgc2NhbGVkTmFtZSA9IFwiXCIsIHNjYWxlZEV4dCA9IHFxLmdldEV4dGVuc2lvbihvcmlnaW5hbE5hbWUpLCBuYW1lQXBwZW5kYWdlID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChzY2FsZWRWZXJzaW9uUHJvcGVydGllcy5uYW1lICYmIHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzLm5hbWUudHJpbSgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIG5hbWVBcHBlbmRhZ2UgPSBcIiAoXCIgKyBzY2FsZWRWZXJzaW9uUHJvcGVydGllcy5uYW1lICsgXCIpXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3RhcnRPZkV4dCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgc2NhbGVkTmFtZSA9IG9yaWdpbmFsTmFtZS5zdWJzdHIoMCwgc3RhcnRPZkV4dCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZVR5cGUgIT09IHZlcnNpb25UeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlZEV4dCA9IHZlcnNpb25UeXBlLnNwbGl0KFwiL1wiKVsxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2NhbGVkTmFtZSArPSBuYW1lQXBwZW5kYWdlICsgXCIuXCIgKyBzY2FsZWRFeHQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNjYWxlZE5hbWUgPSBvcmlnaW5hbE5hbWUgKyBuYW1lQXBwZW5kYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNjYWxlZE5hbWU7XG4gICAgICAgIH0sXG4gICAgICAgIF9nZXRTb3J0ZWRTaXplczogZnVuY3Rpb24oc2l6ZXMpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgc2l6ZXMgPSBxcS5leHRlbmQoW10sIHNpemVzKTtcbiAgICAgICAgICAgIHJldHVybiBzaXplcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICBpZiAoYS5tYXhTaXplID4gYi5tYXhTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYS5tYXhTaXplIDwgYi5tYXhTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgX2dlbmVyYXRlU2NhbGVkSW1hZ2U6IGZ1bmN0aW9uKHNwZWMsIHNvdXJjZUZpbGUpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBjdXN0b21SZXNpemVGdW5jdGlvbiA9IHNwZWMuY3VzdG9tUmVzaXplRnVuY3Rpb24sIGxvZyA9IHNwZWMubG9nLCBtYXhTaXplID0gc3BlYy5tYXhTaXplLCBvcmllbnQgPSBzcGVjLm9yaWVudCwgdHlwZSA9IHNwZWMudHlwZSwgcXVhbGl0eSA9IHNwZWMucXVhbGl0eSwgZmFpbGVkVGV4dCA9IHNwZWMuZmFpbGVkVGV4dCwgaW5jbHVkZUV4aWYgPSBzcGVjLmluY2x1ZGVFeGlmICYmIHNvdXJjZUZpbGUudHlwZSA9PT0gXCJpbWFnZS9qcGVnXCIgJiYgdHlwZSA9PT0gXCJpbWFnZS9qcGVnXCIsIHNjYWxpbmdFZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpLCBpbWFnZUdlbmVyYXRvciA9IG5ldyBxcS5JbWFnZUdlbmVyYXRvcihsb2cpLCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICAgICAgbG9nKFwiQXR0ZW1wdGluZyB0byBnZW5lcmF0ZSBzY2FsZWQgdmVyc2lvbiBmb3IgXCIgKyBzb3VyY2VGaWxlLm5hbWUpO1xuICAgICAgICAgICAgaW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUoc291cmNlRmlsZSwgY2FudmFzLCB7XG4gICAgICAgICAgICAgICAgbWF4U2l6ZTogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICBvcmllbnQ6IG9yaWVudCxcbiAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVGdW5jdGlvbjogY3VzdG9tUmVzaXplRnVuY3Rpb25cbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlZEltYWdlRGF0YVVyaSA9IGNhbnZhcy50b0RhdGFVUkwodHlwZSwgcXVhbGl0eSksIHNpZ25hbFN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiU3VjY2VzcyBnZW5lcmF0aW5nIHNjYWxlZCB2ZXJzaW9uIGZvciBcIiArIHNvdXJjZUZpbGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gcXEuZGF0YVVyaVRvQmxvYihzY2FsZWRJbWFnZURhdGFVcmkpO1xuICAgICAgICAgICAgICAgICAgICBzY2FsaW5nRWZmb3J0LnN1Y2Nlc3MoYmxvYik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZUV4aWYpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5faW5zZXJ0RXhpZkhlYWRlcihzb3VyY2VGaWxlLCBzY2FsZWRJbWFnZURhdGFVcmksIGxvZykudGhlbihmdW5jdGlvbihzY2FsZWRJbWFnZURhdGFVcmlXaXRoRXhpZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVkSW1hZ2VEYXRhVXJpID0gc2NhbGVkSW1hZ2VEYXRhVXJpV2l0aEV4aWY7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduYWxTdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSBpbnNlcnRpbmcgRVhJRiBoZWFkZXIgaW50byBzY2FsZWQgaW1hZ2UuICBVc2luZyBzY2FsZWQgaW1hZ2Ugdy9vdXQgRVhJRiBkYXRhLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsU3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzaWduYWxTdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiRmFpbGVkIGF0dGVtcHQgdG8gZ2VuZXJhdGUgc2NhbGVkIHZlcnNpb24gZm9yIFwiICsgc291cmNlRmlsZS5uYW1lLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIHNjYWxpbmdFZmZvcnQuZmFpbHVyZShmYWlsZWRUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxpbmdFZmZvcnQ7XG4gICAgICAgIH0sXG4gICAgICAgIF9pbnNlcnRFeGlmSGVhZGVyOiBmdW5jdGlvbihvcmlnaW5hbEltYWdlLCBzY2FsZWRJbWFnZURhdGFVcmksIGxvZykge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKSwgaW5zZXJ0aW9uRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKSwgb3JpZ2luYWxJbWFnZURhdGFVcmkgPSBcIlwiO1xuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9yaWdpbmFsSW1hZ2VEYXRhVXJpID0gcmVhZGVyLnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpbnNlcnRpb25FZmZvcnQuc3VjY2VzcyhxcS5FeGlmUmVzdG9yZXIucmVzdG9yZShvcmlnaW5hbEltYWdlRGF0YVVyaSwgc2NhbGVkSW1hZ2VEYXRhVXJpKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIHJlYWRpbmcgXCIgKyBvcmlnaW5hbEltYWdlLm5hbWUgKyBcIiBkdXJpbmcgYXR0ZW1wdCB0byB0cmFuc2ZlciBFWElGIGRhdGEgdG8gc2NhbGVkIHZlcnNpb24uXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgaW5zZXJ0aW9uRWZmb3J0LmZhaWx1cmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChvcmlnaW5hbEltYWdlKTtcbiAgICAgICAgICAgIHJldHVybiBpbnNlcnRpb25FZmZvcnQ7XG4gICAgICAgIH0sXG4gICAgICAgIF9kYXRhVXJpVG9CbG9iOiBmdW5jdGlvbihkYXRhVXJpKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciBieXRlU3RyaW5nLCBtaW1lU3RyaW5nLCBhcnJheUJ1ZmZlciwgaW50QXJyYXk7XG4gICAgICAgICAgICBpZiAoZGF0YVVyaS5zcGxpdChcIixcIilbMF0uaW5kZXhPZihcImJhc2U2NFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVyaS5zcGxpdChcIixcIilbMV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBieXRlU3RyaW5nID0gZGVjb2RlVVJJKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1pbWVTdHJpbmcgPSBkYXRhVXJpLnNwbGl0KFwiLFwiKVswXS5zcGxpdChcIjpcIilbMV0uc3BsaXQoXCI7XCIpWzBdO1xuICAgICAgICAgICAgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpO1xuICAgICAgICAgICAgaW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7XG4gICAgICAgICAgICBxcS5lYWNoKGJ5dGVTdHJpbmcsIGZ1bmN0aW9uKGlkeCwgY2hhcmFjdGVyKSB7XG4gICAgICAgICAgICAgICAgaW50QXJyYXlbaWR4XSA9IGNoYXJhY3Rlci5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQmxvYihhcnJheUJ1ZmZlciwgbWltZVN0cmluZyk7XG4gICAgICAgIH0sXG4gICAgICAgIF9jcmVhdGVCbG9iOiBmdW5jdGlvbihkYXRhLCBtaW1lKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciBCbG9iQnVpbGRlciA9IHdpbmRvdy5CbG9iQnVpbGRlciB8fCB3aW5kb3cuV2ViS2l0QmxvYkJ1aWxkZXIgfHwgd2luZG93Lk1vekJsb2JCdWlsZGVyIHx8IHdpbmRvdy5NU0Jsb2JCdWlsZGVyLCBibG9iQnVpbGRlciA9IEJsb2JCdWlsZGVyICYmIG5ldyBCbG9iQnVpbGRlcigpO1xuICAgICAgICAgICAgaWYgKGJsb2JCdWlsZGVyKSB7XG4gICAgICAgICAgICAgICAgYmxvYkJ1aWxkZXIuYXBwZW5kKGRhdGEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBibG9iQnVpbGRlci5nZXRCbG9iKG1pbWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsb2IoWyBkYXRhIF0sIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbWltZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcXEuRXhpZlJlc3RvcmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBFeGlmUmVzdG9yZXIgPSB7fTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLktFWV9TVFIgPSBcIkFCQ0RFRkdISUpLTE1OT1BcIiArIFwiUVJTVFVWV1hZWmFiY2RlZlwiICsgXCJnaGlqa2xtbm9wcXJzdHV2XCIgKyBcInd4eXowMTIzNDU2Nzg5Ky9cIiArIFwiPVwiO1xuICAgICAgICBFeGlmUmVzdG9yZXIuZW5jb2RlNjQgPSBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgdmFyIG91dHB1dCA9IFwiXCIsIGNocjEsIGNocjIsIGNocjMgPSBcIlwiLCBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0ID0gXCJcIiwgaSA9IDA7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgY2hyMSA9IGlucHV0W2krK107XG4gICAgICAgICAgICAgICAgY2hyMiA9IGlucHV0W2krK107XG4gICAgICAgICAgICAgICAgY2hyMyA9IGlucHV0W2krK107XG4gICAgICAgICAgICAgICAgZW5jMSA9IGNocjEgPj4gMjtcbiAgICAgICAgICAgICAgICBlbmMyID0gKGNocjEgJiAzKSA8PCA0IHwgY2hyMiA+PiA0O1xuICAgICAgICAgICAgICAgIGVuYzMgPSAoY2hyMiAmIDE1KSA8PCAyIHwgY2hyMyA+PiA2O1xuICAgICAgICAgICAgICAgIGVuYzQgPSBjaHIzICYgNjM7XG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKGNocjIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVuYzMgPSBlbmM0ID0gNjQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc05hTihjaHIzKSkge1xuICAgICAgICAgICAgICAgICAgICBlbmM0ID0gNjQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jMSkgKyB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzIpICsgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmMzKSArIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jNCk7XG4gICAgICAgICAgICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgICAgICBlbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gXCJcIjtcbiAgICAgICAgICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLnJlc3RvcmUgPSBmdW5jdGlvbihvcmlnRmlsZUJhc2U2NCwgcmVzaXplZEZpbGVCYXNlNjQpIHtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZEJhc2U2NEhlYWRlciA9IFwiZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCxcIjtcbiAgICAgICAgICAgIGlmICghb3JpZ0ZpbGVCYXNlNjQubWF0Y2goZXhwZWN0ZWRCYXNlNjRIZWFkZXIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc2l6ZWRGaWxlQmFzZTY0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJhd0ltYWdlID0gdGhpcy5kZWNvZGU2NChvcmlnRmlsZUJhc2U2NC5yZXBsYWNlKGV4cGVjdGVkQmFzZTY0SGVhZGVyLCBcIlwiKSk7XG4gICAgICAgICAgICB2YXIgc2VnbWVudHMgPSB0aGlzLnNsaWNlMlNlZ21lbnRzKHJhd0ltYWdlKTtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuZXhpZk1hbmlwdWxhdGlvbihyZXNpemVkRmlsZUJhc2U2NCwgc2VnbWVudHMpO1xuICAgICAgICAgICAgcmV0dXJuIGV4cGVjdGVkQmFzZTY0SGVhZGVyICsgdGhpcy5lbmNvZGU2NChpbWFnZSk7XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5leGlmTWFuaXB1bGF0aW9uID0gZnVuY3Rpb24ocmVzaXplZEZpbGVCYXNlNjQsIHNlZ21lbnRzKSB7XG4gICAgICAgICAgICB2YXIgZXhpZkFycmF5ID0gdGhpcy5nZXRFeGlmQXJyYXkoc2VnbWVudHMpLCBuZXdJbWFnZUFycmF5ID0gdGhpcy5pbnNlcnRFeGlmKHJlc2l6ZWRGaWxlQmFzZTY0LCBleGlmQXJyYXkpLCBhQnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkobmV3SW1hZ2VBcnJheSk7XG4gICAgICAgICAgICByZXR1cm4gYUJ1ZmZlcjtcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLmdldEV4aWZBcnJheSA9IGZ1bmN0aW9uKHNlZ21lbnRzKSB7XG4gICAgICAgICAgICB2YXIgc2VnO1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzZWdtZW50cy5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgICAgIHNlZyA9IHNlZ21lbnRzW3hdO1xuICAgICAgICAgICAgICAgIGlmIChzZWdbMF0gPT0gMjU1ICYgc2VnWzFdID09IDIyNSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLmluc2VydEV4aWYgPSBmdW5jdGlvbihyZXNpemVkRmlsZUJhc2U2NCwgZXhpZkFycmF5KSB7XG4gICAgICAgICAgICB2YXIgaW1hZ2VEYXRhID0gcmVzaXplZEZpbGVCYXNlNjQucmVwbGFjZShcImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsXCIsIFwiXCIpLCBidWYgPSB0aGlzLmRlY29kZTY0KGltYWdlRGF0YSksIHNlcGFyYXRlUG9pbnQgPSBidWYuaW5kZXhPZigyNTUsIDMpLCBtYWUgPSBidWYuc2xpY2UoMCwgc2VwYXJhdGVQb2ludCksIGF0byA9IGJ1Zi5zbGljZShzZXBhcmF0ZVBvaW50KSwgYXJyYXkgPSBtYWU7XG4gICAgICAgICAgICBhcnJheSA9IGFycmF5LmNvbmNhdChleGlmQXJyYXkpO1xuICAgICAgICAgICAgYXJyYXkgPSBhcnJheS5jb25jYXQoYXRvKTtcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgfTtcbiAgICAgICAgRXhpZlJlc3RvcmVyLnNsaWNlMlNlZ21lbnRzID0gZnVuY3Rpb24ocmF3SW1hZ2VBcnJheSkge1xuICAgICAgICAgICAgdmFyIGhlYWQgPSAwLCBzZWdtZW50cyA9IFtdO1xuICAgICAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICAgICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PSAyNTUgJiByYXdJbWFnZUFycmF5W2hlYWQgKyAxXSA9PSAyMTgpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyYXdJbWFnZUFycmF5W2hlYWRdID09IDI1NSAmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09IDIxNikge1xuICAgICAgICAgICAgICAgICAgICBoZWFkICs9IDI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlbmd0aCA9IHJhd0ltYWdlQXJyYXlbaGVhZCArIDJdICogMjU2ICsgcmF3SW1hZ2VBcnJheVtoZWFkICsgM10sIGVuZFBvaW50ID0gaGVhZCArIGxlbmd0aCArIDIsIHNlZyA9IHJhd0ltYWdlQXJyYXkuc2xpY2UoaGVhZCwgZW5kUG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHNlZyk7XG4gICAgICAgICAgICAgICAgICAgIGhlYWQgPSBlbmRQb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhlYWQgPiByYXdJbWFnZUFycmF5Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2VnbWVudHM7XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5kZWNvZGU2NCA9IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgb3V0cHV0ID0gXCJcIiwgY2hyMSwgY2hyMiwgY2hyMyA9IFwiXCIsIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQgPSBcIlwiLCBpID0gMCwgYnVmID0gW107XG4gICAgICAgICAgICB2YXIgYmFzZTY0dGVzdCA9IC9bXkEtWmEtejAtOVxcK1xcL1xcPV0vZztcbiAgICAgICAgICAgIGlmIChiYXNlNjR0ZXN0LmV4ZWMoaW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlcmUgd2VyZSBpbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXJzIGluIHRoZSBpbnB1dCB0ZXh0LiAgXCIgKyBcIlZhbGlkIGJhc2U2NCBjaGFyYWN0ZXJzIGFyZSBBLVosIGEteiwgMC05LCAnKycsICcvJyxhbmQgJz0nXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9bXkEtWmEtejAtOVxcK1xcL1xcPV0vZywgXCJcIik7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgZW5jMSA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBlbmMyID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGVuYzMgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgZW5jNCA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBjaHIxID0gZW5jMSA8PCAyIHwgZW5jMiA+PiA0O1xuICAgICAgICAgICAgICAgIGNocjIgPSAoZW5jMiAmIDE1KSA8PCA0IHwgZW5jMyA+PiAyO1xuICAgICAgICAgICAgICAgIGNocjMgPSAoZW5jMyAmIDMpIDw8IDYgfCBlbmM0O1xuICAgICAgICAgICAgICAgIGJ1Zi5wdXNoKGNocjEpO1xuICAgICAgICAgICAgICAgIGlmIChlbmMzICE9IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1Zi5wdXNoKGNocjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZW5jNCAhPSA2NCkge1xuICAgICAgICAgICAgICAgICAgICBidWYucHVzaChjaHIzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgICAgICBlbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gXCJcIjtcbiAgICAgICAgICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIGJ1ZjtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIEV4aWZSZXN0b3JlcjtcbiAgICB9KCk7XG4gICAgcXEuVG90YWxQcm9ncmVzcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBnZXRTaXplKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgcGVyRmlsZVByb2dyZXNzID0ge30sIHRvdGFsTG9hZGVkID0gMCwgdG90YWxTaXplID0gMCwgbGFzdExvYWRlZFNlbnQgPSAtMSwgbGFzdFRvdGFsU2VudCA9IC0xLCBjYWxsYmFja1Byb3h5ID0gZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgaWYgKGxvYWRlZCAhPT0gbGFzdExvYWRlZFNlbnQgfHwgdG90YWwgIT09IGxhc3RUb3RhbFNlbnQpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxhc3RMb2FkZWRTZW50ID0gbG9hZGVkO1xuICAgICAgICAgICAgbGFzdFRvdGFsU2VudCA9IHRvdGFsO1xuICAgICAgICB9LCBub1JldHJ5YWJsZUZpbGVzID0gZnVuY3Rpb24oZmFpbGVkLCByZXRyeWFibGUpIHtcbiAgICAgICAgICAgIHZhciBub25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHFxLmVhY2goZmFpbGVkLCBmdW5jdGlvbihpZHgsIGZhaWxlZElkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmluZGV4T2YocmV0cnlhYmxlLCBmYWlsZWRJZCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBub25lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBub25lO1xuICAgICAgICB9LCBvbkNhbmNlbCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB1cGRhdGVUb3RhbFByb2dyZXNzKGlkLCAtMSwgLTEpO1xuICAgICAgICAgICAgZGVsZXRlIHBlckZpbGVQcm9ncmVzc1tpZF07XG4gICAgICAgIH0sIG9uQWxsQ29tcGxldGUgPSBmdW5jdGlvbihzdWNjZXNzZnVsLCBmYWlsZWQsIHJldHJ5YWJsZSkge1xuICAgICAgICAgICAgaWYgKGZhaWxlZC5sZW5ndGggPT09IDAgfHwgbm9SZXRyeWFibGVGaWxlcyhmYWlsZWQsIHJldHJ5YWJsZSkpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFja1Byb3h5KHRvdGFsU2l6ZSwgdG90YWxTaXplKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIG9uTmV3ID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICBpZiAoc2l6ZSA+IDApIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbFByb2dyZXNzKGlkLCAwLCBzaXplKTtcbiAgICAgICAgICAgICAgICBwZXJGaWxlUHJvZ3Jlc3NbaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBzaXplXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdXBkYXRlVG90YWxQcm9ncmVzcyA9IGZ1bmN0aW9uKGlkLCBuZXdMb2FkZWQsIG5ld1RvdGFsKSB7XG4gICAgICAgICAgICB2YXIgb2xkTG9hZGVkID0gcGVyRmlsZVByb2dyZXNzW2lkXSA/IHBlckZpbGVQcm9ncmVzc1tpZF0ubG9hZGVkIDogMCwgb2xkVG90YWwgPSBwZXJGaWxlUHJvZ3Jlc3NbaWRdID8gcGVyRmlsZVByb2dyZXNzW2lkXS50b3RhbCA6IDA7XG4gICAgICAgICAgICBpZiAobmV3TG9hZGVkID09PSAtMSAmJiBuZXdUb3RhbCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCAtPSBvbGRMb2FkZWQ7XG4gICAgICAgICAgICAgICAgdG90YWxTaXplIC09IG9sZFRvdGFsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3TG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkICs9IG5ld0xvYWRlZCAtIG9sZExvYWRlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5ld1RvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSArPSBuZXdUb3RhbCAtIG9sZFRvdGFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrUHJveHkodG90YWxMb2FkZWQsIHRvdGFsU2l6ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBvbkFsbENvbXBsZXRlOiBvbkFsbENvbXBsZXRlLFxuICAgICAgICAgICAgb25TdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5DQU5DRUxFRCB8fCBuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5SRUpFQ1RFRCkge1xuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5TVUJNSVRUSU5HKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uTmV3KGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25JbmRpdmlkdWFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzcyhpZCwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgcGVyRmlsZVByb2dyZXNzW2lkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBsb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25OZXdTaXplOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIG9uTmV3KGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGVyRmlsZVByb2dyZXNzID0ge307XG4gICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgPSAwO1xuICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuUGFzdGVTdXBwb3J0ID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIG9wdGlvbnMsIGRldGFjaFBhc3RlSGFuZGxlcjtcbiAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRhcmdldEVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7fSxcbiAgICAgICAgICAgICAgICBwYXN0ZVJlY2VpdmVkOiBmdW5jdGlvbihibG9iKSB7fVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBmdW5jdGlvbiBpc0ltYWdlKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLnR5cGUgJiYgaXRlbS50eXBlLmluZGV4T2YoXCJpbWFnZS9cIikgPT09IDA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJQYXN0ZUhhbmRsZXIoKSB7XG4gICAgICAgICAgICBkZXRhY2hQYXN0ZUhhbmRsZXIgPSBxcShvcHRpb25zLnRhcmdldEVsZW1lbnQpLmF0dGFjaChcInBhc3RlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNsaXBib2FyZERhdGEgPSBldmVudC5jbGlwYm9hcmREYXRhO1xuICAgICAgICAgICAgICAgIGlmIChjbGlwYm9hcmREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goY2xpcGJvYXJkRGF0YS5pdGVtcywgZnVuY3Rpb24oaWR4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbWFnZShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gaXRlbS5nZXRBc0ZpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5wYXN0ZVJlY2VpdmVkKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyUGFzdGVIYW5kbGVyKCkge1xuICAgICAgICAgICAgaWYgKGRldGFjaFBhc3RlSGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGRldGFjaFBhc3RlSGFuZGxlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgcmVnaXN0ZXJQYXN0ZUhhbmRsZXIoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyUGFzdGVIYW5kbGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuRm9ybVN1cHBvcnQgPSBmdW5jdGlvbihvcHRpb25zLCBzdGFydFVwbG9hZCwgbG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGludGVyY2VwdFN1Ym1pdCA9IG9wdGlvbnMuaW50ZXJjZXB0U3VibWl0LCBmb3JtRWwgPSBvcHRpb25zLmVsZW1lbnQsIGF1dG9VcGxvYWQgPSBvcHRpb25zLmF1dG9VcGxvYWQ7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBuZXdFbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgIG5ld0F1dG9VcGxvYWQ6IGF1dG9VcGxvYWQsXG4gICAgICAgICAgICBhdHRhY2hlZFRvRm9ybTogZmFsc2UsXG4gICAgICAgICAgICBnZXRGb3JtSW5wdXRzQXNPYmplY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChmb3JtRWwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2Zvcm0yT2JqKGZvcm1FbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBkZXRlcm1pbmVOZXdFbmRwb2ludChmb3JtRWwpIHtcbiAgICAgICAgICAgIGlmIChmb3JtRWwuZ2V0QXR0cmlidXRlKFwiYWN0aW9uXCIpKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5uZXdFbmRwb2ludCA9IGZvcm1FbC5nZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVGb3JtKGZvcm1FbCwgbmF0aXZlU3VibWl0KSB7XG4gICAgICAgICAgICBpZiAoZm9ybUVsLmNoZWNrVmFsaWRpdHkgJiYgIWZvcm1FbC5jaGVja1ZhbGlkaXR5KCkpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJGb3JtIGRpZCBub3QgcGFzcyB2YWxpZGF0aW9uIGNoZWNrcyAtIHdpbGwgbm90IHVwbG9hZC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBuYXRpdmVTdWJtaXQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gbWF5YmVVcGxvYWRPblN1Ym1pdChmb3JtRWwpIHtcbiAgICAgICAgICAgIHZhciBuYXRpdmVTdWJtaXQgPSBmb3JtRWwuc3VibWl0O1xuICAgICAgICAgICAgcXEoZm9ybUVsKS5hdHRhY2goXCJzdWJtaXRcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YWxpZGF0ZUZvcm0oZm9ybUVsLCBuYXRpdmVTdWJtaXQpICYmIHN0YXJ0VXBsb2FkKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvcm1FbC5zdWJtaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZUZvcm0oZm9ybUVsLCBuYXRpdmVTdWJtaXQpICYmIHN0YXJ0VXBsb2FkKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRldGVybWluZUZvcm1FbChmb3JtRWwpIHtcbiAgICAgICAgICAgIGlmIChmb3JtRWwpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcoZm9ybUVsKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3JtRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmb3JtRWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZm9ybUVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkF0dGFjaGluZyB0byBmb3JtIGVsZW1lbnQuXCIpO1xuICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVOZXdFbmRwb2ludChmb3JtRWwpO1xuICAgICAgICAgICAgICAgICAgICBpbnRlcmNlcHRTdWJtaXQgJiYgbWF5YmVVcGxvYWRPblN1Ym1pdChmb3JtRWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmb3JtRWw7XG4gICAgICAgIH1cbiAgICAgICAgZm9ybUVsID0gZGV0ZXJtaW5lRm9ybUVsKGZvcm1FbCk7XG4gICAgICAgIHRoaXMuYXR0YWNoZWRUb0Zvcm0gPSAhIWZvcm1FbDtcbiAgICB9O1xuICAgIHFxLmV4dGVuZChxcS5Gb3JtU3VwcG9ydC5wcm90b3R5cGUsIHtcbiAgICAgICAgX2Zvcm0yT2JqOiBmdW5jdGlvbihmb3JtKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciBvYmogPSB7fSwgbm90SXJyZWxldmFudFR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlycmVsZXZhbnRUeXBlcyA9IFsgXCJidXR0b25cIiwgXCJpbWFnZVwiLCBcInJlc2V0XCIsIFwic3VibWl0XCIgXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihpcnJlbGV2YW50VHlwZXMsIHR5cGUudG9Mb3dlckNhc2UoKSkgPCAwO1xuICAgICAgICAgICAgfSwgcmFkaW9PckNoZWNrYm94ID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKFsgXCJjaGVja2JveFwiLCBcInJhZGlvXCIgXSwgdHlwZS50b0xvd2VyQ2FzZSgpKSA+PSAwO1xuICAgICAgICAgICAgfSwgaWdub3JlVmFsdWUgPSBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIGlmIChyYWRpb09yQ2hlY2tib3goZWwudHlwZSkgJiYgIWVsLmNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBlbC5kaXNhYmxlZCAmJiBlbC50eXBlLnRvTG93ZXJDYXNlKCkgIT09IFwiaGlkZGVuXCI7XG4gICAgICAgICAgICB9LCBzZWxlY3RWYWx1ZSA9IGZ1bmN0aW9uKHNlbGVjdCkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChxcShzZWxlY3QpLmNoaWxkcmVuKCksIGZ1bmN0aW9uKGlkeCwgY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJvcHRpb25cIiAmJiBjaGlsZC5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGlsZC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBxcS5lYWNoKGZvcm0uZWxlbWVudHMsIGZ1bmN0aW9uKGlkeCwgZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoKHFxLmlzSW5wdXQoZWwsIHRydWUpIHx8IGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0ZXh0YXJlYVwiKSAmJiBub3RJcnJlbGV2YW50VHlwZShlbC50eXBlKSAmJiAhaWdub3JlVmFsdWUoZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtlbC5uYW1lXSA9IGVsLnZhbHVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInNlbGVjdFwiICYmICFpZ25vcmVWYWx1ZShlbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gc2VsZWN0VmFsdWUoZWwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtlbC5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcXEudHJhZGl0aW9uYWwgPSBxcS50cmFkaXRpb25hbCB8fCB7fTtcbiAgICBxcS50cmFkaXRpb25hbC5Gb3JtVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uKG9wdGlvbnMsIHByb3h5KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgaGFuZGxlciA9IHRoaXMsIGdldE5hbWUgPSBwcm94eS5nZXROYW1lLCBnZXRVdWlkID0gcHJveHkuZ2V0VXVpZCwgbG9nID0gcHJveHkubG9nO1xuICAgICAgICBmdW5jdGlvbiBnZXRJZnJhbWVDb250ZW50SnNvbihpZCwgaWZyYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UsIGRvYywgaW5uZXJIdG1sO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkb2MgPSBpZnJhbWUuY29udGVudERvY3VtZW50IHx8IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICAgICAgICAgICAgICAgIGlubmVySHRtbCA9IGRvYy5ib2R5LmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICBsb2coXCJjb252ZXJ0aW5nIGlmcmFtZSdzIGlubmVySFRNTCB0byBKU09OXCIpO1xuICAgICAgICAgICAgICAgIGxvZyhcImlubmVySFRNTCA9IFwiICsgaW5uZXJIdG1sKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5uZXJIdG1sICYmIGlubmVySHRtbC5tYXRjaCgvXjxwcmUvaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5uZXJIdG1sID0gZG9jLmJvZHkuZmlyc3RDaGlsZC5maXJzdENoaWxkLm5vZGVWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBoYW5kbGVyLl9wYXJzZUpzb25SZXNwb25zZShpbm5lckh0bWwpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJFcnJvciB3aGVuIGF0dGVtcHRpbmcgdG8gcGFyc2UgZm9ybSB1cGxvYWQgcmVzcG9uc2UgKFwiICsgZXJyb3IubWVzc2FnZSArIFwiKVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRm9ybShpZCwgaWZyYW1lKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gb3B0aW9ucy5wYXJhbXNTdG9yZS5nZXQoaWQpLCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZC50b0xvd2VyQ2FzZSgpID09PSBcImdldFwiID8gXCJHRVRcIiA6IFwiUE9TVFwiLCBlbmRwb2ludCA9IG9wdGlvbnMuZW5kcG9pbnRTdG9yZS5nZXQoaWQpLCBuYW1lID0gZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICBwYXJhbXNbb3B0aW9ucy51dWlkTmFtZV0gPSBnZXRVdWlkKGlkKTtcbiAgICAgICAgICAgIHBhcmFtc1tvcHRpb25zLmZpbGVuYW1lUGFyYW1dID0gbmFtZTtcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9pbml0Rm9ybUZvclVwbG9hZCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGVuZHBvaW50LFxuICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgICAgICAgIHBhcmFtc0luQm9keTogb3B0aW9ucy5wYXJhbXNJbkJvZHksXG4gICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogaWZyYW1lLm5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBsb2FkRmlsZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBoYW5kbGVyLmdldElucHV0KGlkKSwgaWZyYW1lID0gaGFuZGxlci5fY3JlYXRlSWZyYW1lKGlkKSwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCksIGZvcm07XG4gICAgICAgICAgICBmb3JtID0gY3JlYXRlRm9ybShpZCwgaWZyYW1lKTtcbiAgICAgICAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgICAgICAgICAgaGFuZGxlci5fYXR0YWNoTG9hZEV2ZW50KGlmcmFtZSwgZnVuY3Rpb24ocmVzcG9uc2VGcm9tTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGxvZyhcImlmcmFtZSBsb2FkZWRcIik7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gcmVzcG9uc2VGcm9tTWVzc2FnZSA/IHJlc3BvbnNlRnJvbU1lc3NhZ2UgOiBnZXRJZnJhbWVDb250ZW50SnNvbihpZCwgaWZyYW1lKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9kZXRhY2hMb2FkRXZlbnQoaWQpO1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb3JzLmV4cGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGlmcmFtZSkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxvZyhcIlNlbmRpbmcgdXBsb2FkIHJlcXVlc3QgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIHFxKGZvcm0pLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuRm9ybVVwbG9hZEhhbmRsZXIoe1xuICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgIGlzQ29yczogb3B0aW9ucy5jb3JzLmV4cGVjdGVkLFxuICAgICAgICAgICAgICAgIGlucHV0TmFtZTogb3B0aW9ucy5pbnB1dE5hbWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm94eToge1xuICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBvcHRpb25zLm9uQ2FuY2VsLFxuICAgICAgICAgICAgICAgIGdldE5hbWU6IGdldE5hbWUsXG4gICAgICAgICAgICAgICAgZ2V0VXVpZDogZ2V0VXVpZCxcbiAgICAgICAgICAgICAgICBsb2c6IGxvZ1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBxcS50cmFkaXRpb25hbCA9IHFxLnRyYWRpdGlvbmFsIHx8IHt9O1xuICAgIHFxLnRyYWRpdGlvbmFsLlhoclVwbG9hZEhhbmRsZXIgPSBmdW5jdGlvbihzcGVjLCBwcm94eSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLCBnZXROYW1lID0gcHJveHkuZ2V0TmFtZSwgZ2V0U2l6ZSA9IHByb3h5LmdldFNpemUsIGdldFV1aWQgPSBwcm94eS5nZXRVdWlkLCBsb2cgPSBwcm94eS5sb2csIG11bHRpcGFydCA9IHNwZWMuZm9yY2VNdWx0aXBhcnQgfHwgc3BlYy5wYXJhbXNJbkJvZHksIGFkZENodW5raW5nU3BlY2lmaWNQYXJhbXMgPSBmdW5jdGlvbihpZCwgcGFyYW1zLCBjaHVua0RhdGEpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gZ2V0U2l6ZShpZCksIG5hbWUgPSBnZXROYW1lKGlkKTtcbiAgICAgICAgICAgIGlmICghc3BlYy5vbWl0RGVmYXVsdFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmNodW5raW5nLnBhcmFtTmFtZXMucGFydEluZGV4XSA9IGNodW5rRGF0YS5wYXJ0O1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmNodW5raW5nLnBhcmFtTmFtZXMucGFydEJ5dGVPZmZzZXRdID0gY2h1bmtEYXRhLnN0YXJ0O1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmNodW5raW5nLnBhcmFtTmFtZXMuY2h1bmtTaXplXSA9IGNodW5rRGF0YS5zaXplO1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmNodW5raW5nLnBhcmFtTmFtZXMudG90YWxQYXJ0c10gPSBjaHVua0RhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMudG90YWxGaWxlU2l6ZU5hbWVdID0gc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtdWx0aXBhcnQgJiYgIXNwZWMub21pdERlZmF1bHRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5maWxlbmFtZVBhcmFtXSA9IG5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGFsbENodW5rc0RvbmVSZXF1ZXN0ZXIgPSBuZXcgcXEudHJhZGl0aW9uYWwuQWxsQ2h1bmtzRG9uZUFqYXhSZXF1ZXN0ZXIoe1xuICAgICAgICAgICAgY29yczogc3BlYy5jb3JzLFxuICAgICAgICAgICAgZW5kcG9pbnQ6IHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5lbmRwb2ludCxcbiAgICAgICAgICAgIGhlYWRlcnM6IHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5oZWFkZXJzLFxuICAgICAgICAgICAganNvblBheWxvYWQ6IHNwZWMuY2h1bmtpbmcuc3VjY2Vzcy5qc29uUGF5bG9hZCxcbiAgICAgICAgICAgIGxvZzogbG9nLFxuICAgICAgICAgICAgbWV0aG9kOiBzcGVjLmNodW5raW5nLnN1Y2Nlc3MubWV0aG9kLFxuICAgICAgICAgICAgcGFyYW1zOiBzcGVjLmNodW5raW5nLnN1Y2Nlc3MucGFyYW1zXG4gICAgICAgIH0pLCBjcmVhdGVSZWFkeVN0YXRlQ2hhbmdlZEhhbmRsZXIgPSBmdW5jdGlvbihpZCwgeGhyKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBvblVwbG9hZE9yQ2h1bmtDb21wbGV0ZShpZCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MocmVzdWx0LnJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKHJlc3VsdC5yZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfSwgZ2V0Q2h1bmtzQ29tcGxldGVQYXJhbXMgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHNwZWMucGFyYW1zU3RvcmUuZ2V0KGlkKSwgbmFtZSA9IGdldE5hbWUoaWQpLCBzaXplID0gZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICBwYXJhbXNbc3BlYy51dWlkTmFtZV0gPSBnZXRVdWlkKGlkKTtcbiAgICAgICAgICAgIHBhcmFtc1tzcGVjLmZpbGVuYW1lUGFyYW1dID0gbmFtZTtcbiAgICAgICAgICAgIHBhcmFtc1tzcGVjLnRvdGFsRmlsZVNpemVOYW1lXSA9IHNpemU7XG4gICAgICAgICAgICBwYXJhbXNbc3BlYy5jaHVua2luZy5wYXJhbU5hbWVzLnRvdGFsUGFydHNdID0gaGFuZGxlci5fZ2V0VG90YWxDaHVua3MoaWQpO1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfSwgaXNFcnJvclVwbG9hZFJlc3BvbnNlID0gZnVuY3Rpb24oeGhyLCByZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2YoWyAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCBdLCB4aHIuc3RhdHVzKSA8IDAgfHwgc3BlYy5yZXF1aXJlU3VjY2Vzc0pzb24gJiYgIXJlc3BvbnNlLnN1Y2Nlc3MgfHwgcmVzcG9uc2UucmVzZXQ7XG4gICAgICAgIH0sIG9uVXBsb2FkT3JDaHVua0NvbXBsZXRlID0gZnVuY3Rpb24oaWQsIHhocikge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlO1xuICAgICAgICAgICAgbG9nKFwieGhyIC0gc2VydmVyIHJlc3BvbnNlIHJlY2VpdmVkIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgIGxvZyhcInJlc3BvbnNlVGV4dCA9IFwiICsgeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICByZXNwb25zZSA9IHBhcnNlUmVzcG9uc2UodHJ1ZSwgeGhyKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogIWlzRXJyb3JVcGxvYWRSZXNwb25zZSh4aHIsIHJlc3BvbnNlKSxcbiAgICAgICAgICAgICAgICByZXNwb25zZTogcmVzcG9uc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sIHBhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbih1cGxvYWQsIHhocikge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0ge307XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJSZWNlaXZlZCByZXNwb25zZSBzdGF0dXMge30gd2l0aCBib2R5OiB7fVwiLCB4aHIuc3RhdHVzLCB4aHIucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBxcS5wYXJzZUpzb24oeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHVwbG9hZCAmJiBzcGVjLnJlcXVpcmVTdWNjZXNzSnNvbiAmJiBsb2coXCJFcnJvciB3aGVuIGF0dGVtcHRpbmcgdG8gcGFyc2UgeGhyIHJlc3BvbnNlIHRleHQgKFwiICsgZXJyb3IubWVzc2FnZSArIFwiKVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LCBzZW5kQ2h1bmtzQ29tcGxldGVSZXF1ZXN0ID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGFsbENodW5rc0RvbmVSZXF1ZXN0ZXIuY29tcGxldGUoaWQsIGhhbmRsZXIuX2NyZWF0ZVhocihpZCksIGdldENodW5rc0NvbXBsZXRlUGFyYW1zKGlkKSwgc3BlYy5jdXN0b21IZWFkZXJzLmdldChpZCkpLnRoZW4oZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHBhcnNlUmVzcG9uc2UoZmFsc2UsIHhociksIHhocik7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUocGFyc2VSZXNwb25zZShmYWxzZSwgeGhyKSwgeGhyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH0sIHNldFBhcmFtc0FuZEdldEVudGl0eVRvU2VuZCA9IGZ1bmN0aW9uKGVudGl0eVRvU2VuZFBhcmFtcykge1xuICAgICAgICAgICAgdmFyIGZpbGVPckJsb2IgPSBlbnRpdHlUb1NlbmRQYXJhbXMuZmlsZU9yQmxvYjtcbiAgICAgICAgICAgIHZhciBpZCA9IGVudGl0eVRvU2VuZFBhcmFtcy5pZDtcbiAgICAgICAgICAgIHZhciB4aHIgPSBlbnRpdHlUb1NlbmRQYXJhbXMueGhyO1xuICAgICAgICAgICAgdmFyIHhock92ZXJyaWRlcyA9IGVudGl0eVRvU2VuZFBhcmFtcy54aHJPdmVycmlkZXMgfHwge307XG4gICAgICAgICAgICB2YXIgY3VzdG9tUGFyYW1zID0gZW50aXR5VG9TZW5kUGFyYW1zLmN1c3RvbVBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBkZWZhdWx0UGFyYW1zID0gZW50aXR5VG9TZW5kUGFyYW1zLnBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgIHZhciB4aHJPdmVycmlkZVBhcmFtcyA9IHhock92ZXJyaWRlcy5wYXJhbXMgfHwge307XG4gICAgICAgICAgICB2YXIgcGFyYW1zO1xuICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbXVsdGlwYXJ0ID8gbmV3IEZvcm1EYXRhKCkgOiBudWxsLCBtZXRob2QgPSB4aHJPdmVycmlkZXMubWV0aG9kIHx8IHNwZWMubWV0aG9kLCBlbmRwb2ludCA9IHhock92ZXJyaWRlcy5lbmRwb2ludCB8fCBzcGVjLmVuZHBvaW50U3RvcmUuZ2V0KGlkKSwgbmFtZSA9IGdldE5hbWUoaWQpLCBzaXplID0gZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICBpZiAoc3BlYy5vbWl0RGVmYXVsdFBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHFxLmV4dGVuZCh7fSwgY3VzdG9tUGFyYW1zKTtcbiAgICAgICAgICAgICAgICBxcS5leHRlbmQocGFyYW1zLCB4aHJPdmVycmlkZVBhcmFtcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHFxLmV4dGVuZCh7fSwgY3VzdG9tUGFyYW1zKTtcbiAgICAgICAgICAgICAgICBxcS5leHRlbmQocGFyYW1zLCB4aHJPdmVycmlkZVBhcmFtcyk7XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHBhcmFtcywgZGVmYXVsdFBhcmFtcyk7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMudXVpZE5hbWVdID0gZ2V0VXVpZChpZCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuZmlsZW5hbWVQYXJhbV0gPSBuYW1lO1xuICAgICAgICAgICAgICAgIGlmIChtdWx0aXBhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMudG90YWxGaWxlU2l6ZU5hbWVdID0gc2l6ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzcGVjLnBhcmFtc0luQm9keSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5pbnB1dE5hbWVdID0gbmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXNwZWMucGFyYW1zSW5Cb2R5KSB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBxcS5vYmoydXJsKHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeGhyLm9wZW4obWV0aG9kLCBlbmRwb2ludCwgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAoc3BlYy5jb3JzLmV4cGVjdGVkICYmIHNwZWMuY29ycy5zZW5kQ3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtdWx0aXBhcnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3BlYy5wYXJhbXNJbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEub2JqMkZvcm1EYXRhKHBhcmFtcywgZm9ybURhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoc3BlYy5pbnB1dE5hbWUsIGZpbGVPckJsb2IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmb3JtRGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmaWxlT3JCbG9iO1xuICAgICAgICB9LCBzZXRVcGxvYWRIZWFkZXJzID0gZnVuY3Rpb24oaGVhZGVyc09wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXJPdmVycmlkZXMgPSBoZWFkZXJzT3B0aW9ucy5oZWFkZXJPdmVycmlkZXM7XG4gICAgICAgICAgICB2YXIgaWQgPSBoZWFkZXJzT3B0aW9ucy5pZDtcbiAgICAgICAgICAgIHZhciB4aHIgPSBoZWFkZXJzT3B0aW9ucy54aHI7XG4gICAgICAgICAgICBpZiAoaGVhZGVyT3ZlcnJpZGVzKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChoZWFkZXJPdmVycmlkZXMsIGZ1bmN0aW9uKGhlYWRlck5hbWUsIGhlYWRlclZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlck5hbWUsIGhlYWRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dHJhSGVhZGVycyA9IHNwZWMuY3VzdG9tSGVhZGVycy5nZXQoaWQpLCBmaWxlT3JCbG9iID0gaGFuZGxlci5nZXRGaWxlKGlkKTtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJYLVJlcXVlc3RlZC1XaXRoXCIsIFwiWE1MSHR0cFJlcXVlc3RcIik7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDYWNoZS1Db250cm9sXCIsIFwibm8tY2FjaGVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFtdWx0aXBhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIik7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1NaW1lLVR5cGVcIiwgZmlsZU9yQmxvYi50eXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZWFjaChleHRyYUhlYWRlcnMsIGZ1bmN0aW9uKG5hbWUsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgdXBsb2FkQ2h1bms6IGZ1bmN0aW9uKHVwbG9hZENodW5rUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdXBsb2FkQ2h1bmtQYXJhbXMuaWQ7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rSWR4ID0gdXBsb2FkQ2h1bmtQYXJhbXMuY2h1bmtJZHg7XG4gICAgICAgICAgICAgICAgdmFyIG92ZXJyaWRlcyA9IHVwbG9hZENodW5rUGFyYW1zLm92ZXJyaWRlcyB8fCB7fTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdW1pbmcgPSB1cGxvYWRDaHVua1BhcmFtcy5yZXN1bWluZztcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtEYXRhID0gaGFuZGxlci5fZ2V0Q2h1bmtEYXRhKGlkLCBjaHVua0lkeCksIHhociA9IGhhbmRsZXIuX2NyZWF0ZVhocihpZCwgY2h1bmtJZHgpLCBwcm9taXNlLCB0b1NlbmQsIGN1c3RvbVBhcmFtcywgcGFyYW1zID0ge307XG4gICAgICAgICAgICAgICAgcHJvbWlzZSA9IGNyZWF0ZVJlYWR5U3RhdGVDaGFuZ2VkSGFuZGxlcihpZCwgeGhyKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9yZWdpc3RlclByb2dyZXNzSGFuZGxlcihpZCwgY2h1bmtJZHgsIGNodW5rRGF0YS5zaXplKTtcbiAgICAgICAgICAgICAgICBjdXN0b21QYXJhbXMgPSBzcGVjLnBhcmFtc1N0b3JlLmdldChpZCk7XG4gICAgICAgICAgICAgICAgYWRkQ2h1bmtpbmdTcGVjaWZpY1BhcmFtcyhpZCwgcGFyYW1zLCBjaHVua0RhdGEpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bWluZykge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5yZXN1bWUucGFyYW1OYW1lcy5yZXN1bWluZ10gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b1NlbmQgPSBzZXRQYXJhbXNBbmRHZXRFbnRpdHlUb1NlbmQoe1xuICAgICAgICAgICAgICAgICAgICBmaWxlT3JCbG9iOiBjaHVua0RhdGEuYmxvYixcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21QYXJhbXM6IGN1c3RvbVBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIHhocjogeGhyLFxuICAgICAgICAgICAgICAgICAgICB4aHJPdmVycmlkZXM6IG92ZXJyaWRlc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNldFVwbG9hZEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJPdmVycmlkZXM6IG92ZXJyaWRlcy5oZWFkZXJzLFxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIHhocjogeGhyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQodG9TZW5kKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGxvYWRGaWxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlT3JCbG9iID0gaGFuZGxlci5nZXRGaWxlKGlkKSwgcHJvbWlzZSwgeGhyLCBjdXN0b21QYXJhbXMsIHRvU2VuZDtcbiAgICAgICAgICAgICAgICB4aHIgPSBoYW5kbGVyLl9jcmVhdGVYaHIoaWQpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX3JlZ2lzdGVyUHJvZ3Jlc3NIYW5kbGVyKGlkKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlID0gY3JlYXRlUmVhZHlTdGF0ZUNoYW5nZWRIYW5kbGVyKGlkLCB4aHIpO1xuICAgICAgICAgICAgICAgIGN1c3RvbVBhcmFtcyA9IHNwZWMucGFyYW1zU3RvcmUuZ2V0KGlkKTtcbiAgICAgICAgICAgICAgICB0b1NlbmQgPSBzZXRQYXJhbXNBbmRHZXRFbnRpdHlUb1NlbmQoe1xuICAgICAgICAgICAgICAgICAgICBmaWxlT3JCbG9iOiBmaWxlT3JCbG9iLFxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVBhcmFtczogY3VzdG9tUGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICB4aHI6IHhoclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNldFVwbG9hZEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIHhocjogeGhyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQodG9TZW5kKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuWGhyVXBsb2FkSGFuZGxlcih7XG4gICAgICAgICAgICBvcHRpb25zOiBxcS5leHRlbmQoe1xuICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogXCJ0cmFkaXRpb25hbFwiXG4gICAgICAgICAgICB9LCBzcGVjKSxcbiAgICAgICAgICAgIHByb3h5OiBxcS5leHRlbmQoe1xuICAgICAgICAgICAgICAgIGdldEVuZHBvaW50OiBzcGVjLmVuZHBvaW50U3RvcmUuZ2V0XG4gICAgICAgICAgICB9LCBwcm94eSlcbiAgICAgICAgfSkpO1xuICAgICAgICBxcS5vdmVycmlkZSh0aGlzLCBmdW5jdGlvbihzdXBlcl8pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmluYWxpemVDaHVua3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb3h5Lm9uRmluYWxpemluZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGVjLmNodW5raW5nLnN1Y2Nlc3MuZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZW5kQ2h1bmtzQ29tcGxldGVSZXF1ZXN0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlcl8uZmluYWxpemVDaHVua3MoaWQsIHFxLmJpbmQocGFyc2VSZXNwb25zZSwgdGhpcywgdHJ1ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS50cmFkaXRpb25hbC5BbGxDaHVua3NEb25lQWpheFJlcXVlc3RlciA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciByZXF1ZXN0ZXIsIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjb3JzOiB7XG4gICAgICAgICAgICAgICAgYWxsb3dYZHI6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGV4cGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZW5kQ3JlZGVudGlhbHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKHN0ciwgbGV2ZWwpIHt9LFxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIlxuICAgICAgICB9LCBwcm9taXNlcyA9IHt9LCBlbmRwb2ludEhhbmRsZXIgPSB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzRnVuY3Rpb24ob3B0aW9ucy5lbmRwb2ludCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZW5kcG9pbnQoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5lbmRwb2ludDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICByZXF1ZXN0ZXIgPSBxcS5leHRlbmQodGhpcywgbmV3IHFxLkFqYXhSZXF1ZXN0ZXIoe1xuICAgICAgICAgICAgYWNjZXB0SGVhZGVyOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBvcHRpb25zLmpzb25QYXlsb2FkID8gXCJhcHBsaWNhdGlvbi9qc29uXCIgOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgICAgdmFsaWRNZXRob2RzOiBbIG9wdGlvbnMubWV0aG9kIF0sXG4gICAgICAgICAgICBtZXRob2Q6IG9wdGlvbnMubWV0aG9kLFxuICAgICAgICAgICAgZW5kcG9pbnRTdG9yZTogZW5kcG9pbnRIYW5kbGVyLFxuICAgICAgICAgICAgYWxsb3dYUmVxdWVzdGVkV2l0aEFuZENhY2hlQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICBjb3JzOiBvcHRpb25zLmNvcnMsXG4gICAgICAgICAgICBsb2c6IG9wdGlvbnMubG9nLFxuICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIHhociwgaXNFcnJvcikge1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcHJvbWlzZXNbaWRdO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBwcm9taXNlc1tpZF07XG4gICAgICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKHhocik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHhocik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhociwgcGFyYW1zLCBoZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKFwiU3VibWl0dGluZyBBbGwgQ2h1bmtzIERvbmUgcmVxdWVzdCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXNbaWRdID0gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ZXIuaW5pdFRyYW5zcG9ydChpZCkud2l0aFBhcmFtcyhvcHRpb25zLnBhcmFtcyhpZCkgfHwgcGFyYW1zKS53aXRoSGVhZGVycyhvcHRpb25zLmhlYWRlcnMoaWQpIHx8IGhlYWRlcnMpLnNlbmQoeGhyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5EcmFnQW5kRHJvcCA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBvcHRpb25zLCBISURFX1pPTkVTX0VWRU5UX05BTUUgPSBcInFxLWhpZGV6b25lc1wiLCBISURFX0JFRk9SRV9FTlRFUl9BVFRSID0gXCJxcS1oaWRlLWRyb3B6b25lXCIsIHVwbG9hZERyb3Bab25lcyA9IFtdLCBkcm9wcGVkRmlsZXMgPSBbXSwgZGlzcG9zZVN1cHBvcnQgPSBuZXcgcXEuRGlzcG9zZVN1cHBvcnQoKTtcbiAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGRyb3Bab25lRWxlbWVudHM6IFtdLFxuICAgICAgICAgICAgYWxsb3dNdWx0aXBsZUl0ZW1zOiB0cnVlLFxuICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgIGRyb3BBY3RpdmU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxsYmFja3M6IG5ldyBxcS5EcmFnQW5kRHJvcC5jYWxsYmFja3MoKVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbywgdHJ1ZSk7XG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZERyb3BwZWRGaWxlcyhmaWxlcywgdXBsb2FkRHJvcFpvbmUpIHtcbiAgICAgICAgICAgIHZhciBmaWxlc0FzQXJyYXkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmaWxlcyk7XG4gICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5kcm9wTG9nKFwiR3JhYmJlZCBcIiArIGZpbGVzLmxlbmd0aCArIFwiIGRyb3BwZWQgZmlsZXMuXCIpO1xuICAgICAgICAgICAgdXBsb2FkRHJvcFpvbmUuZHJvcERpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLnByb2Nlc3NpbmdEcm9wcGVkRmlsZXNDb21wbGV0ZShmaWxlc0FzQXJyYXksIHVwbG9hZERyb3Bab25lLmdldEVsZW1lbnQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdHJhdmVyc2VGaWxlVHJlZShlbnRyeSkge1xuICAgICAgICAgICAgdmFyIHBhcnNlRW50cnlQcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGlmIChlbnRyeS5pc0ZpbGUpIHtcbiAgICAgICAgICAgICAgICBlbnRyeS5maWxlKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5xcVBhdGggPSBleHRyYWN0RGlyZWN0b3J5UGF0aChlbnRyeSk7XG4gICAgICAgICAgICAgICAgICAgIGRyb3BwZWRGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICBwYXJzZUVudHJ5UHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZmlsZUVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLmRyb3BMb2coXCJQcm9ibGVtIHBhcnNpbmcgJ1wiICsgZW50cnkuZnVsbFBhdGggKyBcIicuICBGaWxlRXJyb3IgY29kZSBcIiArIGZpbGVFcnJvci5jb2RlICsgXCIuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRW50cnlQcm9taXNlLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnkuaXNEaXJlY3RvcnkpIHtcbiAgICAgICAgICAgICAgICBnZXRGaWxlc0luRGlyZWN0b3J5KGVudHJ5KS50aGVuKGZ1bmN0aW9uIGFsbEVudHJpZXNSZWFkKGVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJpZXNMZWZ0ID0gZW50cmllcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZW50cmllcywgZnVuY3Rpb24oaWR4LCBlbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhdmVyc2VGaWxlVHJlZShlbnRyeSkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzTGVmdCAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRyaWVzTGVmdCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUVudHJ5UHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUVudHJ5UHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiByZWFkRmFpbHVyZShmaWxlRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MuZHJvcExvZyhcIlByb2JsZW0gcGFyc2luZyAnXCIgKyBlbnRyeS5mdWxsUGF0aCArIFwiJy4gIEZpbGVFcnJvciBjb2RlIFwiICsgZmlsZUVycm9yLmNvZGUgKyBcIi5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnRyeVByb21pc2UuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRW50cnlQcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGV4dHJhY3REaXJlY3RvcnlQYXRoKGVudHJ5KSB7XG4gICAgICAgICAgICB2YXIgbmFtZSA9IGVudHJ5Lm5hbWUsIGZ1bGxQYXRoID0gZW50cnkuZnVsbFBhdGgsIGluZGV4T2ZOYW1lSW5GdWxsUGF0aCA9IGZ1bGxQYXRoLmxhc3RJbmRleE9mKG5hbWUpO1xuICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aC5zdWJzdHIoMCwgaW5kZXhPZk5hbWVJbkZ1bGxQYXRoKTtcbiAgICAgICAgICAgIGlmIChmdWxsUGF0aC5jaGFyQXQoMCkgPT09IFwiL1wiKSB7XG4gICAgICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aC5zdWJzdHIoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZnVsbFBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RmlsZXNJbkRpcmVjdG9yeShlbnRyeSwgcmVhZGVyLCBhY2N1bUVudHJpZXMsIGV4aXN0aW5nUHJvbWlzZSkge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBleGlzdGluZ1Byb21pc2UgfHwgbmV3IHFxLlByb21pc2UoKSwgZGlyUmVhZGVyID0gcmVhZGVyIHx8IGVudHJ5LmNyZWF0ZVJlYWRlcigpO1xuICAgICAgICAgICAgZGlyUmVhZGVyLnJlYWRFbnRyaWVzKGZ1bmN0aW9uIHJlYWRTdWNjZXNzKGVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RW50cmllcyA9IGFjY3VtRW50cmllcyA/IGFjY3VtRW50cmllcy5jb25jYXQoZW50cmllcykgOiBlbnRyaWVzO1xuICAgICAgICAgICAgICAgIGlmIChlbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RmlsZXNJbkRpcmVjdG9yeShlbnRyeSwgZGlyUmVhZGVyLCBuZXdFbnRyaWVzLCBwcm9taXNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKG5ld0VudHJpZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHByb21pc2UuZmFpbHVyZSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVEYXRhVHJhbnNmZXIoZGF0YVRyYW5zZmVyLCB1cGxvYWREcm9wWm9uZSkge1xuICAgICAgICAgICAgdmFyIHBlbmRpbmdGb2xkZXJQcm9taXNlcyA9IFtdLCBoYW5kbGVEYXRhVHJhbnNmZXJQcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLnByb2Nlc3NpbmdEcm9wcGVkRmlsZXMoKTtcbiAgICAgICAgICAgIHVwbG9hZERyb3Bab25lLmRyb3BEaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICAgIGlmIChkYXRhVHJhbnNmZXIuZmlsZXMubGVuZ3RoID4gMSAmJiAhb3B0aW9ucy5hbGxvd011bHRpcGxlSXRlbXMpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5wcm9jZXNzaW5nRHJvcHBlZEZpbGVzQ29tcGxldGUoW10pO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLmRyb3BFcnJvcihcInRvb01hbnlGaWxlc0Vycm9yXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIHVwbG9hZERyb3Bab25lLmRyb3BEaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgaGFuZGxlRGF0YVRyYW5zZmVyUHJvbWlzZS5mYWlsdXJlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRyb3BwZWRGaWxlcyA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0ZvbGRlckRyb3BTdXBwb3J0ZWQoZGF0YVRyYW5zZmVyKSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRhdGFUcmFuc2Zlci5pdGVtcywgZnVuY3Rpb24oaWR4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSBpdGVtLndlYmtpdEdldEFzRW50cnkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeS5pc0ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHBlZEZpbGVzLnB1c2goaXRlbS5nZXRBc0ZpbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0ZvbGRlclByb21pc2VzLnB1c2godHJhdmVyc2VGaWxlVHJlZShlbnRyeSkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdGb2xkZXJQcm9taXNlcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nRm9sZGVyUHJvbWlzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlRGF0YVRyYW5zZmVyUHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRyb3BwZWRGaWxlcyA9IGRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdGb2xkZXJQcm9taXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRGF0YVRyYW5zZmVyUHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZURhdGFUcmFuc2ZlclByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2V0dXBEcm9wem9uZShkcm9wQXJlYSkge1xuICAgICAgICAgICAgdmFyIGRyb3Bab25lID0gbmV3IHFxLlVwbG9hZERyb3Bab25lKHtcbiAgICAgICAgICAgICAgICBISURFX1pPTkVTX0VWRU5UX05BTUU6IEhJREVfWk9ORVNfRVZFTlRfTkFNRSxcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBkcm9wQXJlYSxcbiAgICAgICAgICAgICAgICBvbkVudGVyOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGRyb3BBcmVhKS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuZHJvcEFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkxlYXZlTm90RGVzY2VuZGFudHM6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZHJvcEFyZWEpLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5kcm9wQWN0aXZlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRHJvcDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVEYXRhVHJhbnNmZXIoZS5kYXRhVHJhbnNmZXIsIGRyb3Bab25lKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkRHJvcHBlZEZpbGVzKGRyb3BwZWRGaWxlcywgZHJvcFpvbmUpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLmRyb3BMb2coXCJEcm9wIGV2ZW50IERhdGFUcmFuc2ZlciBwYXJzaW5nIGZhaWxlZC4gIE5vIGZpbGVzIHdpbGwgYmUgdXBsb2FkZWQuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYWRkRGlzcG9zZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZHJvcFpvbmUuZGlzcG9zZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBxcShkcm9wQXJlYSkuaGFzQXR0cmlidXRlKEhJREVfQkVGT1JFX0VOVEVSX0FUVFIpICYmIHFxKGRyb3BBcmVhKS5oaWRlKCk7XG4gICAgICAgICAgICB1cGxvYWREcm9wWm9uZXMucHVzaChkcm9wWm9uZSk7XG4gICAgICAgICAgICByZXR1cm4gZHJvcFpvbmU7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNGaWxlRHJhZyhkcmFnRXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBmaWxlRHJhZztcbiAgICAgICAgICAgIHFxLmVhY2goZHJhZ0V2ZW50LmRhdGFUcmFuc2Zlci50eXBlcywgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsID09PSBcIkZpbGVzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZURyYWcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZmlsZURyYWc7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gbGVhdmluZ0RvY3VtZW50T3V0KGUpIHtcbiAgICAgICAgICAgIGlmIChxcS5zYWZhcmkoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlLnggPCAwIHx8IGUueSA8IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZS54ID09PSAwICYmIGUueSA9PT0gMDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZXR1cERyYWdEcm9wKCkge1xuICAgICAgICAgICAgdmFyIGRyb3Bab25lcyA9IG9wdGlvbnMuZHJvcFpvbmVFbGVtZW50cywgbWF5YmVIaWRlRHJvcFpvbmVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkcm9wWm9uZXMsIGZ1bmN0aW9uKGlkeCwgZHJvcFpvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKGRyb3Bab25lKS5oYXNBdHRyaWJ1dGUoSElERV9CRUZPUkVfRU5URVJfQVRUUikgJiYgcXEoZHJvcFpvbmUpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKGRyb3Bab25lKS5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMuZHJvcEFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBxcS5lYWNoKGRyb3Bab25lcywgZnVuY3Rpb24oaWR4LCBkcm9wWm9uZSkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREcm9wWm9uZSA9IHNldHVwRHJvcHpvbmUoZHJvcFpvbmUpO1xuICAgICAgICAgICAgICAgIGlmIChkcm9wWm9uZXMubGVuZ3RoICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgXCJkcmFnZW50ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1cGxvYWREcm9wWm9uZS5kcm9wRGlzYWJsZWQoKSAmJiBpc0ZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkcm9wWm9uZXMsIGZ1bmN0aW9uKGlkeCwgZHJvcFpvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3Bab25lIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgcXEoZHJvcFpvbmUpLmhhc0F0dHJpYnV0ZShISURFX0JFRk9SRV9FTlRFUl9BVFRSKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEoZHJvcFpvbmUpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJibG9ja1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgXCJkcmFnbGVhdmVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChsZWF2aW5nRG9jdW1lbnRPdXQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVIaWRlRHJvcFpvbmVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2gocXEoZG9jdW1lbnQpLmNoaWxkcmVuKClbMF0sIFwibW91c2VlbnRlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgbWF5YmVIaWRlRHJvcFpvbmVzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgXCJkcm9wXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlSGlkZURyb3Bab25lcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGRvY3VtZW50LCBISURFX1pPTkVTX0VWRU5UX05BTUUsIG1heWJlSGlkZURyb3Bab25lcyk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0dXBEcmFnRHJvcCgpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgc2V0dXBFeHRyYURyb3B6b25lOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5kcm9wWm9uZUVsZW1lbnRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgc2V0dXBEcm9wem9uZShlbGVtZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVEcm9wem9uZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHZhciBpLCBkenMgPSBvcHRpb25zLmRyb3Bab25lRWxlbWVudHM7XG4gICAgICAgICAgICAgICAgZm9yIChpIGluIGR6cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZHpzW2ldID09PSBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHpzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh1cGxvYWREcm9wWm9uZXMsIGZ1bmN0aW9uKGlkeCwgZHJvcFpvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgZHJvcFpvbmUuZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGVzdGluZyA9IHt9O1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmV4dHJhY3REaXJlY3RvcnlQYXRoID0gZXh0cmFjdERpcmVjdG9yeVBhdGg7XG4gICAgfTtcbiAgICBxcS5EcmFnQW5kRHJvcC5jYWxsYmFja3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwcm9jZXNzaW5nRHJvcHBlZEZpbGVzOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0Ryb3BwZWRGaWxlc0NvbXBsZXRlOiBmdW5jdGlvbihmaWxlcywgdGFyZ2V0RWwpIHt9LFxuICAgICAgICAgICAgZHJvcEVycm9yOiBmdW5jdGlvbihjb2RlLCBlcnJvclNwZWNpZmljcykge1xuICAgICAgICAgICAgICAgIHFxLmxvZyhcIkRyYWcgJiBkcm9wIGVycm9yIGNvZGUgJ1wiICsgY29kZSArIFwiIHdpdGggdGhlc2Ugc3BlY2lmaWNzOiAnXCIgKyBlcnJvclNwZWNpZmljcyArIFwiJ1wiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRyb3BMb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7XG4gICAgICAgICAgICAgICAgcXEubG9nKG1lc3NhZ2UsIGxldmVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHFxLlVwbG9hZERyb3Bab25lID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRpc3Bvc2VTdXBwb3J0ID0gbmV3IHFxLkRpc3Bvc2VTdXBwb3J0KCksIG9wdGlvbnMsIGVsZW1lbnQsIHByZXZlbnREcm9wLCBkcm9wT3V0c2lkZURpc2FibGVkO1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgZWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uKGUpIHt9LFxuICAgICAgICAgICAgb25MZWF2ZTogZnVuY3Rpb24oZSkge30sXG4gICAgICAgICAgICBvbkxlYXZlTm90RGVzY2VuZGFudHM6IGZ1bmN0aW9uKGUpIHt9LFxuICAgICAgICAgICAgb25Ecm9wOiBmdW5jdGlvbihlKSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIGVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQ7XG4gICAgICAgIGZ1bmN0aW9uIGRyYWdvdmVyU2hvdWxkQmVDYW5jZWxlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5zYWZhcmkoKSB8fCBxcS5maXJlZm94KCkgJiYgcXEud2luZG93cygpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRpc2FibGVEcm9wT3V0c2lkZShlKSB7XG4gICAgICAgICAgICBpZiAoIWRyb3BPdXRzaWRlRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZHJhZ292ZXJTaG91bGRCZUNhbmNlbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgXCJkcmFnb3ZlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgXCJkcmFnb3ZlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5kYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZHJvcE91dHNpZGVEaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZEZpbGVEcmFnKGUpIHtcbiAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3ApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZWZmZWN0VGVzdCwgZHQgPSBlLmRhdGFUcmFuc2ZlciwgaXNTYWZhcmkgPSBxcS5zYWZhcmkoKTtcbiAgICAgICAgICAgIGVmZmVjdFRlc3QgPSBxcS5pZSgpICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wID8gdHJ1ZSA6IGR0LmVmZmVjdEFsbG93ZWQgIT09IFwibm9uZVwiO1xuICAgICAgICAgICAgcmV0dXJuIGR0ICYmIGVmZmVjdFRlc3QgJiYgKGR0LmZpbGVzICYmIGR0LmZpbGVzLmxlbmd0aCB8fCAhaXNTYWZhcmkgJiYgZHQudHlwZXMuY29udGFpbnMgJiYgZHQudHlwZXMuY29udGFpbnMoXCJGaWxlc1wiKSB8fCBkdC50eXBlcy5pbmNsdWRlcyAmJiBkdC50eXBlcy5pbmNsdWRlcyhcIkZpbGVzXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc09yU2V0RHJvcERpc2FibGVkKGlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGlmIChpc0Rpc2FibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBwcmV2ZW50RHJvcCA9IGlzRGlzYWJsZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcHJldmVudERyb3A7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdHJpZ2dlckhpZGV6b25lc0V2ZW50KCkge1xuICAgICAgICAgICAgdmFyIGhpZGVab25lc0V2ZW50O1xuICAgICAgICAgICAgZnVuY3Rpb24gdHJpZ2dlclVzaW5nT2xkQXBpKCkge1xuICAgICAgICAgICAgICAgIGhpZGVab25lc0V2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJFdmVudFwiKTtcbiAgICAgICAgICAgICAgICBoaWRlWm9uZXNFdmVudC5pbml0RXZlbnQob3B0aW9ucy5ISURFX1pPTkVTX0VWRU5UX05BTUUsIHRydWUsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdpbmRvdy5DdXN0b21FdmVudCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZGVab25lc0V2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KG9wdGlvbnMuSElERV9aT05FU19FVkVOVF9OQU1FKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlclVzaW5nT2xkQXBpKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyVXNpbmdPbGRBcGkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoaGlkZVpvbmVzRXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChlbGVtZW50LCBcImRyYWdvdmVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzVmFsaWRGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBlZmZlY3QgPSBxcS5pZSgpICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wID8gbnVsbCA6IGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQ7XG4gICAgICAgICAgICAgICAgaWYgKGVmZmVjdCA9PT0gXCJtb3ZlXCIgfHwgZWZmZWN0ID09PSBcImxpbmtNb3ZlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwibW92ZVwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBcImNvcHlcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChlbGVtZW50LCBcImRyYWdlbnRlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc09yU2V0RHJvcERpc2FibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uRW50ZXIoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZWxlbWVudCwgXCJkcmFnbGVhdmVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZEZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vbkxlYXZlKGUpO1xuICAgICAgICAgICAgICAgIHZhciByZWxhdGVkVGFyZ2V0ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICAgICAgICAgICAgaWYgKHFxKHRoaXMpLmNvbnRhaW5zKHJlbGF0ZWRUYXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vbkxlYXZlTm90RGVzY2VuZGFudHMoZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChlbGVtZW50LCBcImRyb3BcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNPclNldERyb3BEaXNhYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZEZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uRHJvcChlKTtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckhpZGV6b25lc0V2ZW50KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZGlzYWJsZURyb3BPdXRzaWRlKCk7XG4gICAgICAgIGF0dGFjaEV2ZW50cygpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgZHJvcERpc2FibGVkOiBmdW5jdGlvbihpc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzT3JTZXREcm9wRGlzYWJsZWQoaXNEaXNhYmxlZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuZGlzcG9zZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGVzdGluZyA9IHt9O1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmlzVmFsaWRGaWxlRHJhZyA9IGlzVmFsaWRGaWxlRHJhZztcbiAgICB9O1xuICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHFxLnVpUHVibGljQXBpID0ge1xuICAgICAgICAgICAgYWRkSW5pdGlhbEZpbGVzOiBmdW5jdGlvbihjYW5uZWRGaWxlTGlzdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuYWRkSW5pdGlhbEZpbGVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5hZGRDYWNoZVRvRG9tKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXJTdG9yZWRGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5jbGVhclN0b3JlZEZpbGVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5jbGVhckZpbGVzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkRXh0cmFEcm9wem9uZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RuZCAmJiB0aGlzLl9kbmQuc2V0dXBFeHRyYURyb3B6b25lKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZUV4dHJhRHJvcHpvbmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZG5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kbmQucmVtb3ZlRHJvcHpvbmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEl0ZW1CeUZpbGVJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3RlbXBsYXRpbmcuaXNIaWRkZW5Gb3JldmVyKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUucmVzZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLmJ1dHRvbiAmJiB0aGlzLl90ZW1wbGF0aW5nLmdldEJ1dHRvbigpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRCdXR0b25JZCA9IHRoaXMuX2NyZWF0ZVVwbG9hZEJ1dHRvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLl90ZW1wbGF0aW5nLmdldEJ1dHRvbigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMuX29wdGlvbnMudGV4dC5maWxlSW5wdXRUaXRsZVxuICAgICAgICAgICAgICAgICAgICB9KS5nZXRCdXR0b25JZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZG5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RuZC5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RuZCA9IHRoaXMuX3NldHVwRHJhZ0FuZERyb3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxGaWxlc0luQmF0Y2ggPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBDbGlja0FuZEVkaXRFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0TmFtZTogZnVuY3Rpb24oaWQsIG5ld05hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkRmlsZW5hbWUgPSB0aGlzLl9vcHRpb25zLmZvcm1hdEZpbGVOYW1lKG5ld05hbWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuc2V0TmFtZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlRmlsZW5hbWUoaWQsIGZvcm1hdHRlZEZpbGVuYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZVVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGF1c2VkID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5wYXVzZVVwbG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHBhdXNlZCAmJiB0aGlzLl90ZW1wbGF0aW5nLnVwbG9hZFBhdXNlZChpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdXNlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250aW51ZVVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGludWVkID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5jb250aW51ZVVwbG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlZCAmJiB0aGlzLl90ZW1wbGF0aW5nLnVwbG9hZENvbnRpbnVlZChpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRpbnVlZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJZDogZnVuY3Rpb24oZmlsZUNvbnRhaW5lck9yQ2hpbGRFbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVJZChmaWxlQ29udGFpbmVyT3JDaGlsZEVsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREcm9wVGFyZ2V0OiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZ2V0RmlsZShmaWxlSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlLnFxRHJvcFRhcmdldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEudWlQcml2YXRlQXBpID0ge1xuICAgICAgICAgICAgX2dldEJ1dHRvbjogZnVuY3Rpb24oYnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fZ2V0QnV0dG9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKCFidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbklkID09PSB0aGlzLl9kZWZhdWx0QnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IHRoaXMuX3RlbXBsYXRpbmcuZ2V0QnV0dG9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmVtb3ZlRmlsZUl0ZW06IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVtb3ZlRmlsZShmaWxlSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXR1cENsaWNrQW5kRWRpdEV2ZW50SGFuZGxlcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVCdXR0b25zQ2xpY2tIYW5kbGVyID0gcXEuRmlsZUJ1dHRvbnNDbGlja0hhbmRsZXIgJiYgdGhpcy5fYmluZEZpbGVCdXR0b25zQ2xpY2tFdmVudCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzaW5FdmVudFN1cHBvcnRlZCA9ICFxcS5maXJlZm94KCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRWRpdEZpbGVuYW1lRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lQ2xpY2tIYW5kbGVyID0gdGhpcy5fYmluZEZpbGVuYW1lQ2xpY2tFdmVudCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maWxlbmFtZUlucHV0Rm9jdXNJbkhhbmRsZXIgPSB0aGlzLl9iaW5kRmlsZW5hbWVJbnB1dEZvY3VzSW5FdmVudCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyID0gdGhpcy5fYmluZEZpbGVuYW1lSW5wdXRGb2N1c0V2ZW50KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zZXR1cERyYWdBbmREcm9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGRyb3Bab25lRWxlbWVudHMgPSB0aGlzLl9vcHRpb25zLmRyYWdBbmREcm9wLmV4dHJhRHJvcHpvbmVzLCB0ZW1wbGF0aW5nID0gdGhpcy5fdGVtcGxhdGluZywgZGVmYXVsdERyb3Bab25lID0gdGVtcGxhdGluZy5nZXREcm9wWm9uZSgpO1xuICAgICAgICAgICAgICAgIGRlZmF1bHREcm9wWm9uZSAmJiBkcm9wWm9uZUVsZW1lbnRzLnB1c2goZGVmYXVsdERyb3Bab25lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkRyYWdBbmREcm9wKHtcbiAgICAgICAgICAgICAgICAgICAgZHJvcFpvbmVFbGVtZW50czogZHJvcFpvbmVFbGVtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dNdWx0aXBsZUl0ZW1zOiB0aGlzLl9vcHRpb25zLm11bHRpcGxlLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wQWN0aXZlOiB0aGlzLl9vcHRpb25zLmNsYXNzZXMuZHJvcEFjdGl2ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NpbmdEcm9wcGVkRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd0Ryb3BQcm9jZXNzaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZ0Ryb3BwZWRGaWxlc0NvbXBsZXRlOiBmdW5jdGlvbihmaWxlcywgdGFyZ2V0RWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVEcm9wUHJvY2Vzc2luZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZmlsZXMsIGZ1bmN0aW9uKGlkeCwgZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnFxRHJvcFRhcmdldCA9IHRhcmdldEVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZGRGaWxlcyhmaWxlcywgbnVsbCwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BFcnJvcjogZnVuY3Rpb24oY29kZSwgZXJyb3JEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faXRlbUVycm9yKGNvZGUsIGVycm9yRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcExvZzogZnVuY3Rpb24obWVzc2FnZSwgbGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhtZXNzYWdlLCBsZXZlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmluZEZpbGVCdXR0b25zQ2xpY2tFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRmlsZUJ1dHRvbnNDbGlja0hhbmRsZXIoe1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nOiB0aGlzLl90ZW1wbGF0aW5nLFxuICAgICAgICAgICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cobWVzc2FnZSwgbHZsKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25EZWxldGVGaWxlOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGVsZXRlRmlsZShmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNhbmNlbChmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblJldHJ5OiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmV0cnkoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25QYXVzZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBhdXNlVXBsb2FkKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ29udGludWU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jb250aW51ZVVwbG9hZChmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkdldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0TmFtZShmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2lzRWRpdEZpbGVuYW1lRW5hYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRpbmcuaXNFZGl0RmlsZW5hbWVQb3NzaWJsZSgpICYmICF0aGlzLl9vcHRpb25zLmF1dG9VcGxvYWQgJiYgcXEuRmlsZW5hbWVDbGlja0hhbmRsZXIgJiYgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlciAmJiBxcS5GaWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9maWxlbmFtZUVkaXRIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIHRlbXBsYXRpbmcgPSB0aGlzLl90ZW1wbGF0aW5nO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmc6IHRlbXBsYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhtZXNzYWdlLCBsdmwpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkdldFVwbG9hZFN0YXR1czogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsZUlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uR2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROYW1lKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uU2V0TmFtZTogZnVuY3Rpb24oaWQsIG5ld05hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0TmFtZShpZCwgbmV3TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uRWRpdGluZ1N0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIGlzRWRpdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHFxSW5wdXQgPSBxcSh0ZW1wbGF0aW5nLmdldEVkaXRJbnB1dChpZCkpLCBxcUZpbGVDb250YWluZXIgPSBxcSh0ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0VkaXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcUlucHV0LmFkZENsYXNzKFwicXEtZWRpdGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVGaWxlbmFtZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlRWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcUlucHV0LnJlbW92ZUNsYXNzKFwicXEtZWRpdGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dGaWxlbmFtZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93RWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcXFGaWxlQ29udGFpbmVyLmFkZENsYXNzKFwicXEtdGVtcFwiKS5yZW1vdmVDbGFzcyhcInFxLXRlbXBcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZFN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25VcGxvYWRTdGF0dXNDaGFuZ2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFZGl0RmlsZW5hbWVFbmFibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkgJiYgbmV3U3RhdHVzICE9PSBxcS5zdGF0dXMuU1VCTUlUVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLm1hcmtGaWxlbmFtZUVkaXRhYmxlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZUVkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2xkU3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HICYmIG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRElORykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVSZXRyeShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHFxKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpLnJlbW92ZUNsYXNzKHRoaXMuX2NsYXNzZXMucmV0cnlpbmcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3U3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX0ZBSUxFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVQYXVzZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iaW5kRmlsZW5hbWVJbnB1dEZvY3VzSW5FdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNwZWMgPSBxcS5leHRlbmQoe30sIHRoaXMuX2ZpbGVuYW1lRWRpdEhhbmRsZXIoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5GaWxlbmFtZUlucHV0Rm9jdXNJbkhhbmRsZXIoc3BlYyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JpbmRGaWxlbmFtZUlucHV0Rm9jdXNFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNwZWMgPSBxcS5leHRlbmQoe30sIHRoaXMuX2ZpbGVuYW1lRWRpdEhhbmRsZXIoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5GaWxlbmFtZUlucHV0Rm9jdXNIYW5kbGVyKHNwZWMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iaW5kRmlsZW5hbWVDbGlja0V2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3BlYyA9IHFxLmV4dGVuZCh7fSwgdGhpcy5fZmlsZW5hbWVFZGl0SGFuZGxlcigpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkZpbGVuYW1lQ2xpY2tIYW5kbGVyKHNwZWMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zdG9yZUZvckxhdGVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX3N0b3JlRm9yTGF0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVTcGlubmVyKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25BbGxDb21wbGV0ZTogZnVuY3Rpb24oc3VjY2Vzc2Z1bCwgZmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25BbGxDb21wbGV0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVzZXRUb3RhbFByb2dyZXNzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0OiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlID0gdGhpcy5nZXRGaWxlKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSAmJiBmaWxlLnFxUGF0aCAmJiB0aGlzLl9vcHRpb25zLmRyYWdBbmREcm9wLnJlcG9ydERpcmVjdG9yeVBhdGhzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlLmFkZFJlYWRPbmx5KGlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcXBhdGg6IGZpbGUucXFQYXRoXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRvTGlzdChpZCwgbmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uU3VibWl0dGVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VkaXRGaWxlbmFtZUVuYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLm1hcmtGaWxlbmFtZUVkaXRhYmxlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93RWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2ZvY3VzaW5FdmVudFN1cHBvcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlci5hZGRIYW5kbGVyKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RWRpdElucHV0KGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25Qcm9ncmVzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlUHJvZ3Jlc3MoaWQsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgIGlmICh0b3RhbCA9PT0gMCB8fCBNYXRoLnJvdW5kKGxvYWRlZCAvIHRvdGFsICogMTAwKSA9PT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZUNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVBhdXNlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlUHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIHRoaXMuX29wdGlvbnMudGV4dC53YWl0aW5nRm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXNwbGF5RmlsZVNpemUoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlGaWxlU2l6ZShpZCwgbG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblRvdGFsUHJvZ3Jlc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVRvdGFsUHJvZ3Jlc3MobG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXN1bHQsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRSZXRWYWwgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkNvbXBsZXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRlbXBsYXRpbmcgPSB0aGlzLl90ZW1wbGF0aW5nLCBmaWxlQ29udGFpbmVyID0gdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSwgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGVVcGxvYWQocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHFxKGZpbGVDb250YWluZXIpLnJlbW92ZUNsYXNzKHNlbGYuX2NsYXNzZXMucmV0cnlpbmcpO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgIH0pLnN0YXR1cyAhPT0gcXEuc3RhdHVzLlVQTE9BRF9GQUlMRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZUNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlU3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWFya0ZpbGVBc1N1Y2Nlc3NmdWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEoZmlsZUNvbnRhaW5lcikuYWRkQ2xhc3Moc2VsZi5fY2xhc3Nlcy5mYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd0NhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGluZy5pc1JldHJ5UG9zc2libGUoKSAmJiAhc2VsZi5fcHJldmVudFJldHJpZXNbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEoZmlsZUNvbnRhaW5lcikuYWRkQ2xhc3Moc2VsZi5fY2xhc3Nlcy5yZXRyeWFibGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd1JldHJ5KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NvbnRyb2xGYWlsdXJlVGV4dERpc3BsYXkoaWQsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudFJldFZhbCBpbnN0YW5jZW9mIHFxLlByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50UmV0VmFsLmRvbmUoZnVuY3Rpb24obmV3UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZVVwbG9hZChuZXdSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZVVwbG9hZChyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50UmV0VmFsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXJrRmlsZUFzU3VjY2Vzc2Z1bDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGluZyA9IHRoaXMuX3RlbXBsYXRpbmc7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRGVsZXRlUG9zc2libGUoKSkge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dEZWxldGVCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxcSh0ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKS5hZGRDbGFzcyh0aGlzLl9jbGFzc2VzLnN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21heWJlVXBkYXRlVGh1bWJuYWlsKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRQcmVwOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uVXBsb2FkUHJlcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd1NwaW5uZXIoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50UmV0VmFsID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25VcGxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50UmV0VmFsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblVwbG9hZENodW5rOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25VcGxvYWRDaHVuay5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGlmIChjaHVua0RhdGEucGFydEluZGV4ID4gMCAmJiB0aGlzLl9oYW5kbGVyLmlzUmVzdW1hYmxlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmFsbG93UGF1c2UoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25DYW5jZWw6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25DYW5jZWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVGaWxlSXRlbShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2dldE5vdEZpbmlzaGVkKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZXNldFRvdGFsUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQmVmb3JlQXV0b1JldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciByZXRyeU51bUZvckRpc3BsYXksIG1heEF1dG8sIHJldHJ5Tm90ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vbkJlZm9yZUF1dG9SZXRyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dDYW5jZWxMaW5rKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5yZXRyeS5zaG93QXV0b1JldHJ5Tm90ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXRyeU51bUZvckRpc3BsYXkgPSB0aGlzLl9hdXRvUmV0cmllc1tpZF07XG4gICAgICAgICAgICAgICAgICAgIG1heEF1dG8gPSB0aGlzLl9vcHRpb25zLnJldHJ5Lm1heEF1dG9BdHRlbXB0cztcbiAgICAgICAgICAgICAgICAgICAgcmV0cnlOb3RlID0gdGhpcy5fb3B0aW9ucy5yZXRyeS5hdXRvUmV0cnlOb3RlLnJlcGxhY2UoL1xce3JldHJ5TnVtXFx9L2csIHJldHJ5TnVtRm9yRGlzcGxheSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHJ5Tm90ZSA9IHJldHJ5Tm90ZS5yZXBsYWNlKC9cXHttYXhBdXRvXFx9L2csIG1heEF1dG8pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIHJldHJ5Tm90ZSk7XG4gICAgICAgICAgICAgICAgICAgIHFxKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpLmFkZENsYXNzKHRoaXMuX2NsYXNzZXMucmV0cnlpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25CZWZvcmVNYW51YWxSZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25CZWZvcmVNYW51YWxSZXRyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVzZXRQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHFxKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpLnJlbW92ZUNsYXNzKHRoaXMuX2NsYXNzZXMuZmFpbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd1NwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93Q2FuY2VsTGluayhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCkpLmFkZENsYXNzKHRoaXMuX2NsYXNzZXMucmV0cnlhYmxlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93UmV0cnkoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdERlbGV0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgb25TdWNjZXNzQ2FsbGJhY2sgPSBxcS5iaW5kKHRoaXMuX29uU3VibWl0RGVsZXRlU3VjY2VzcywgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25TdWJtaXREZWxldGUuY2FsbCh0aGlzLCBpZCwgb25TdWNjZXNzQ2FsbGJhY2spO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdERlbGV0ZVN1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCB1dWlkLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmZvcmNlQ29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93RGVsZXRlQ29uZmlybS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbmREZWxldGVSZXF1ZXN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkRlbGV0ZUNvbXBsZXRlOiBmdW5jdGlvbihpZCwgeGhyLCBpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25EZWxldGVDb21wbGV0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVNwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgdGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmRlbGV0aW5nRmFpbGVkVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd0RlbGV0ZUJ1dHRvbihpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRmlsZUl0ZW0oaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2VuZERlbGV0ZVJlcXVlc3Q6IGZ1bmN0aW9uKGlkLCB1dWlkLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVEZWxldGVCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd1NwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgdGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLmRlbGV0aW5nU3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVsZXRlSGFuZGxlci5zZW5kRGVsZXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dEZWxldGVDb25maXJtOiBmdW5jdGlvbihpZCwgdXVpZCwgbWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZU5hbWUgPSB0aGlzLmdldE5hbWUoaWQpLCBjb25maXJtTWVzc2FnZSA9IHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5jb25maXJtTWVzc2FnZS5yZXBsYWNlKC9cXHtmaWxlbmFtZVxcfS9nLCBmaWxlTmFtZSksIHV1aWQgPSB0aGlzLmdldFV1aWQoaWQpLCBkZWxldGVSZXF1ZXN0QXJncyA9IGFyZ3VtZW50cywgc2VsZiA9IHRoaXMsIHJldFZhbDtcbiAgICAgICAgICAgICAgICByZXRWYWwgPSB0aGlzLl9vcHRpb25zLnNob3dDb25maXJtKGNvbmZpcm1NZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNHZW5lcmljUHJvbWlzZShyZXRWYWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldFZhbC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VuZERlbGV0ZVJlcXVlc3QuYXBwbHkoc2VsZiwgZGVsZXRlUmVxdWVzdEFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJldFZhbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VuZERlbGV0ZVJlcXVlc3QuYXBwbHkoc2VsZiwgZGVsZXRlUmVxdWVzdEFyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYWRkVG9MaXN0OiBmdW5jdGlvbihpZCwgbmFtZSwgY2FubmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByZXBlbmREYXRhLCBwcmVwZW5kSW5kZXggPSAwLCBkb250RGlzcGxheSA9IHRoaXMuX2hhbmRsZXIuaXNQcm94aWVkKGlkKSAmJiB0aGlzLl9vcHRpb25zLnNjYWxpbmcuaGlkZVNjYWxlZCwgcmVjb3JkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmRpc3BsYXkucHJlcGVuZEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90b3RhbEZpbGVzSW5CYXRjaCA+IDEgJiYgdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJlcGVuZEluZGV4ID0gdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwcmVwZW5kRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBwcmVwZW5kSW5kZXhcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFjYW5uZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZGlzYWJsZUNhbmNlbEZvckZvcm1VcGxvYWRzICYmICFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmRpc2FibGVDYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZCA9IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZWRQcm94eUdyb3VwID0gdGhpcy5faGFuZGxlZFByb3h5R3JvdXAgfHwgcmVjb3JkLnByb3h5R3JvdXBJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQucHJveHlHcm91cElkICE9PSB0aGlzLl9oYW5kbGVkUHJveHlHcm91cCB8fCAhcmVjb3JkLnByb3h5R3JvdXBJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuY2FuY2VsQWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xlYXJMaXN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlZFByb3h5R3JvdXAgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjYW5uZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5hZGRGaWxlVG9DYWNoZShpZCwgdGhpcy5fb3B0aW9ucy5mb3JtYXRGaWxlTmFtZShuYW1lKSwgcHJlcGVuZERhdGEsIGRvbnREaXNwbGF5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVUaHVtYm5haWwoaWQsIHRoaXMuX3RodW1ibmFpbFVybHNbaWRdLCB0cnVlLCB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMuY3VzdG9tUmVzaXplcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5hZGRGaWxlKGlkLCB0aGlzLl9vcHRpb25zLmZvcm1hdEZpbGVOYW1lKG5hbWUpLCBwcmVwZW5kRGF0YSwgZG9udERpc3BsYXkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmdlbmVyYXRlUHJldmlldyhpZCwgdGhpcy5nZXRGaWxlKGlkKSwgdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLmN1c3RvbVJlc2l6ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgKz0gMTtcbiAgICAgICAgICAgICAgICBpZiAoY2FubmVkIHx8IHRoaXMuX29wdGlvbnMuZGlzcGxheS5maWxlU2l6ZU9uU3VibWl0ICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzcGxheUZpbGVTaXplKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NsZWFyTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5jbGVhckZpbGVzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclN0b3JlZEZpbGVzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2Rpc3BsYXlGaWxlU2l6ZTogZnVuY3Rpb24oaWQsIGxvYWRlZFNpemUsIHRvdGFsU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5nZXRTaXplKGlkKSwgc2l6ZUZvckRpc3BsYXkgPSB0aGlzLl9mb3JtYXRTaXplKHNpemUpO1xuICAgICAgICAgICAgICAgIGlmIChzaXplID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlZFNpemUgIT09IHVuZGVmaW5lZCAmJiB0b3RhbFNpemUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZUZvckRpc3BsYXkgPSB0aGlzLl9mb3JtYXRQcm9ncmVzcyhsb2FkZWRTaXplLCB0b3RhbFNpemUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlU2l6ZShpZCwgc2l6ZUZvckRpc3BsYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZm9ybWF0UHJvZ3Jlc3M6IGZ1bmN0aW9uKHVwbG9hZGVkU2l6ZSwgdG90YWxTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLl9vcHRpb25zLnRleHQuZm9ybWF0UHJvZ3Jlc3M7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcihuYW1lLCByZXBsYWNlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKG5hbWUsIHJlcGxhY2VtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcihcIntwZXJjZW50fVwiLCBNYXRoLnJvdW5kKHVwbG9hZGVkU2l6ZSAvIHRvdGFsU2l6ZSAqIDEwMCkpO1xuICAgICAgICAgICAgICAgIHIoXCJ7dG90YWxfc2l6ZX1cIiwgdGhpcy5fZm9ybWF0U2l6ZSh0b3RhbFNpemUpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY29udHJvbEZhaWx1cmVUZXh0RGlzcGxheTogZnVuY3Rpb24oaWQsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGUsIHJlc3BvbnNlUHJvcGVydHksIGZhaWx1cmVSZWFzb247XG4gICAgICAgICAgICAgICAgbW9kZSA9IHRoaXMuX29wdGlvbnMuZmFpbGVkVXBsb2FkVGV4dERpc3BsYXkubW9kZTtcbiAgICAgICAgICAgICAgICByZXNwb25zZVByb3BlcnR5ID0gdGhpcy5fb3B0aW9ucy5mYWlsZWRVcGxvYWRUZXh0RGlzcGxheS5yZXNwb25zZVByb3BlcnR5O1xuICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZhaWx1cmVSZWFzb24gPSByZXNwb25zZVtyZXNwb25zZVByb3BlcnR5XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmYWlsdXJlUmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlUmVhc29uID0gdGhpcy5fb3B0aW9ucy50ZXh0LmZhaWxVcGxvYWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCBmYWlsdXJlUmVhc29uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZmFpbGVkVXBsb2FkVGV4dERpc3BsYXkuZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd1Rvb2x0aXAoaWQsIGZhaWx1cmVSZWFzb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIHRoaXMuX29wdGlvbnMudGV4dC5mYWlsVXBsb2FkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiZmFpbGVkVXBsb2FkVGV4dERpc3BsYXkubW9kZSB2YWx1ZSBvZiAnXCIgKyBtb2RlICsgXCInIGlzIG5vdCB2YWxpZFwiLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93VG9vbHRpcDogZnVuY3Rpb24oaWQsIHRleHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpLnRpdGxlID0gdGV4dDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd0NhbmNlbExpbms6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLmRpc2FibGVDYW5jZWxGb3JGb3JtVXBsb2FkcyB8fCBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd0NhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pdGVtRXJyb3I6IGZ1bmN0aW9uKGNvZGUsIG5hbWUsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX2l0ZW1FcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuc2hvd01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JhdGNoRXJyb3I6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9iYXRjaEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5zaG93TWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0dXBQYXN0ZVByb21wdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uUGFzdGVSZWNlaXZlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlbGYuX29wdGlvbnMucGFzdGUubmFtZVByb21wdE1lc3NhZ2UsIGRlZmF1bHRWYWwgPSBzZWxmLl9vcHRpb25zLnBhc3RlLmRlZmF1bHROYW1lO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fb3B0aW9ucy5zaG93UHJvbXB0KG1lc3NhZ2UsIGRlZmF1bHRWYWwpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2ZpbGVPckJsb2JSZWplY3RlZDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbEZpbGVzSW5CYXRjaCAtPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX2ZpbGVPckJsb2JSZWplY3RlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9wcmVwYXJlSXRlbXNGb3JVcGxvYWQ6IGZ1bmN0aW9uKGl0ZW1zLCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxGaWxlc0luQmF0Y2ggPSBpdGVtcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9wcmVwYXJlSXRlbXNGb3JVcGxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVVcGRhdGVUaHVtYm5haWw6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHZhciB0aHVtYm5haWxVcmwgPSB0aGlzLl90aHVtYm5haWxVcmxzW2ZpbGVJZF0sIGZpbGVTdGF0dXMgPSB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICBpZDogZmlsZUlkXG4gICAgICAgICAgICAgICAgfSkuc3RhdHVzO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlU3RhdHVzICE9PSBxcS5zdGF0dXMuREVMRVRFRCAmJiAodGh1bWJuYWlsVXJsIHx8IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5wbGFjZWhvbGRlcnMud2FpdFVudGlsUmVzcG9uc2UgfHwgIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlVGh1bWJuYWlsKGZpbGVJZCwgdGh1bWJuYWlsVXJsLCB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMuY3VzdG9tUmVzaXplcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hZGRDYW5uZWRGaWxlOiBmdW5jdGlvbihzZXNzaW9uRGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX2FkZENhbm5lZEZpbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRUb0xpc3QoaWQsIHRoaXMuZ2V0TmFtZShpZCksIHRydWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVNwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZUNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFya0ZpbGVBc1N1Y2Nlc3NmdWwoaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0U2l6ZTogZnVuY3Rpb24oaWQsIG5ld1NpemUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9zZXRTaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVTaXplKGlkLCB0aGlzLl9mb3JtYXRTaXplKG5ld1NpemUpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2Vzc2lvblJlcXVlc3RDb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5hZGRDYWNoZVRvRG9tKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fc2Vzc2lvblJlcXVlc3RDb21wbGV0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pKCk7XG4gICAgcXEuRmluZVVwbG9hZGVyID0gZnVuY3Rpb24obywgbmFtZXNwYWNlKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3BhcmVudCA9IG5hbWVzcGFjZSA/IHFxW25hbWVzcGFjZV0uRmluZVVwbG9hZGVyQmFzaWMgOiBxcS5GaW5lVXBsb2FkZXJCYXNpYztcbiAgICAgICAgdGhpcy5fcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLl9vcHRpb25zLCB7XG4gICAgICAgICAgICBlbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgYnV0dG9uOiBudWxsLFxuICAgICAgICAgICAgbGlzdEVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICBkcmFnQW5kRHJvcDoge1xuICAgICAgICAgICAgICAgIGV4dHJhRHJvcHpvbmVzOiBbXSxcbiAgICAgICAgICAgICAgICByZXBvcnREaXJlY3RvcnlQYXRoczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICAgICAgZm9ybWF0UHJvZ3Jlc3M6IFwie3BlcmNlbnR9JSBvZiB7dG90YWxfc2l6ZX1cIixcbiAgICAgICAgICAgICAgICBmYWlsVXBsb2FkOiBcIlVwbG9hZCBmYWlsZWRcIixcbiAgICAgICAgICAgICAgICB3YWl0aW5nRm9yUmVzcG9uc2U6IFwiUHJvY2Vzc2luZy4uLlwiLFxuICAgICAgICAgICAgICAgIHBhdXNlZDogXCJQYXVzZWRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcInFxLXRlbXBsYXRlXCIsXG4gICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgcmV0cnlpbmc6IFwicXEtdXBsb2FkLXJldHJ5aW5nXCIsXG4gICAgICAgICAgICAgICAgcmV0cnlhYmxlOiBcInFxLXVwbG9hZC1yZXRyeWFibGVcIixcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBcInFxLXVwbG9hZC1zdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgZmFpbDogXCJxcS11cGxvYWQtZmFpbFwiLFxuICAgICAgICAgICAgICAgIGVkaXRhYmxlOiBcInFxLWVkaXRhYmxlXCIsXG4gICAgICAgICAgICAgICAgaGlkZTogXCJxcS1oaWRlXCIsXG4gICAgICAgICAgICAgICAgZHJvcEFjdGl2ZTogXCJxcS11cGxvYWQtZHJvcC1hcmVhLWFjdGl2ZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmFpbGVkVXBsb2FkVGV4dERpc3BsYXk6IHtcbiAgICAgICAgICAgICAgICBtb2RlOiBcImRlZmF1bHRcIixcbiAgICAgICAgICAgICAgICByZXNwb25zZVByb3BlcnR5OiBcImVycm9yXCIsXG4gICAgICAgICAgICAgICAgZW5hYmxlVG9vbHRpcDogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgdG9vTWFueUZpbGVzRXJyb3I6IFwiWW91IG1heSBvbmx5IGRyb3Agb25lIGZpbGVcIixcbiAgICAgICAgICAgICAgICB1bnN1cHBvcnRlZEJyb3dzZXI6IFwiVW5yZWNvdmVyYWJsZSBlcnJvciAtIHRoaXMgYnJvd3NlciBkb2VzIG5vdCBwZXJtaXQgZmlsZSB1cGxvYWRpbmcgb2YgYW55IGtpbmQuXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyeToge1xuICAgICAgICAgICAgICAgIHNob3dBdXRvUmV0cnlOb3RlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF1dG9SZXRyeU5vdGU6IFwiUmV0cnlpbmcge3JldHJ5TnVtfS97bWF4QXV0b30uLi5cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlbGV0ZUZpbGU6IHtcbiAgICAgICAgICAgICAgICBmb3JjZUNvbmZpcm06IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1NZXNzYWdlOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUge2ZpbGVuYW1lfT9cIixcbiAgICAgICAgICAgICAgICBkZWxldGluZ1N0YXR1c1RleHQ6IFwiRGVsZXRpbmcuLi5cIixcbiAgICAgICAgICAgICAgICBkZWxldGluZ0ZhaWxlZFRleHQ6IFwiRGVsZXRlIGZhaWxlZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcGxheToge1xuICAgICAgICAgICAgICAgIGZpbGVTaXplT25TdWJtaXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHByZXBlbmRGaWxlczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXN0ZToge1xuICAgICAgICAgICAgICAgIHByb21wdEZvck5hbWU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG5hbWVQcm9tcHRNZXNzYWdlOiBcIlBsZWFzZSBuYW1lIHRoaXMgaW1hZ2VcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRodW1ibmFpbHM6IHtcbiAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVyOiBudWxsLFxuICAgICAgICAgICAgICAgIG1heENvdW50OiAwLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyczoge1xuICAgICAgICAgICAgICAgICAgICB3YWl0VW50aWxSZXNwb25zZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIG5vdEF2YWlsYWJsZVBhdGg6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHdhaXRpbmdQYXRoOiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aW1lQmV0d2VlblRodW1iczogNzUwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2NhbGluZzoge1xuICAgICAgICAgICAgICAgIGhpZGVTY2FsZWQ6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd01lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fdGVtcGxhdGluZy5oYXNEaWFsb2coXCJhbGVydFwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdGVtcGxhdGluZy5zaG93RGlhbG9nKFwiYWxlcnRcIiwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydChtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dDb25maXJtOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuX3RlbXBsYXRpbmcuaGFzRGlhbG9nKFwiY29uZmlybVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdGVtcGxhdGluZy5zaG93RGlhbG9nKFwiY29uZmlybVwiLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LmNvbmZpcm0obWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dQcm9tcHQ6IGZ1bmN0aW9uKG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLl90ZW1wbGF0aW5nLmhhc0RpYWxvZyhcInByb21wdFwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdGVtcGxhdGluZy5zaG93RGlhbG9nKFwicHJvbXB0XCIsIG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5wcm9tcHQobWVzc2FnZSwgZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuICAgICAgICBxcS5leHRlbmQodGhpcy5fb3B0aW9ucywgbywgdHJ1ZSk7XG4gICAgICAgIHRoaXMuX3RlbXBsYXRpbmcgPSBuZXcgcXEuVGVtcGxhdGluZyh7XG4gICAgICAgICAgICBsb2c6IHFxLmJpbmQodGhpcy5sb2csIHRoaXMpLFxuICAgICAgICAgICAgdGVtcGxhdGVJZE9yRWw6IHRoaXMuX29wdGlvbnMudGVtcGxhdGUsXG4gICAgICAgICAgICBjb250YWluZXJFbDogdGhpcy5fb3B0aW9ucy5lbGVtZW50LFxuICAgICAgICAgICAgZmlsZUNvbnRhaW5lckVsOiB0aGlzLl9vcHRpb25zLmxpc3RFbGVtZW50LFxuICAgICAgICAgICAgYnV0dG9uOiB0aGlzLl9vcHRpb25zLmJ1dHRvbixcbiAgICAgICAgICAgIGltYWdlR2VuZXJhdG9yOiB0aGlzLl9pbWFnZUdlbmVyYXRvcixcbiAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICBoaWRlOiB0aGlzLl9vcHRpb25zLmNsYXNzZXMuaGlkZSxcbiAgICAgICAgICAgICAgICBlZGl0YWJsZTogdGhpcy5fb3B0aW9ucy5jbGFzc2VzLmVkaXRhYmxlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGltaXRzOiB7XG4gICAgICAgICAgICAgICAgbWF4VGh1bWJzOiB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMubWF4Q291bnQsXG4gICAgICAgICAgICAgICAgdGltZUJldHdlZW5UaHVtYnM6IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy50aW1lQmV0d2VlblRodW1ic1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyczoge1xuICAgICAgICAgICAgICAgIHdhaXRVbnRpbFVwZGF0ZTogdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLnBsYWNlaG9sZGVycy53YWl0VW50aWxSZXNwb25zZSxcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxOb3RBdmFpbGFibGU6IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5wbGFjZWhvbGRlcnMubm90QXZhaWxhYmxlUGF0aCxcbiAgICAgICAgICAgICAgICB3YWl0aW5nRm9yVGh1bWJuYWlsOiB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMucGxhY2Vob2xkZXJzLndhaXRpbmdQYXRoXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGV4dDogdGhpcy5fb3B0aW9ucy50ZXh0XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy53b3JrYXJvdW5kcy5pb3M4U2FmYXJpVXBsb2FkcyAmJiBxcS5pb3M4MDAoKSAmJiBxcS5pb3NTYWZhcmkoKSkge1xuICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZW5kZXJGYWlsdXJlKHRoaXMuX29wdGlvbnMubWVzc2FnZXMudW5zdXBwb3J0ZWRCcm93c2VySW9zOFNhZmFyaSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnVwbG9hZGluZyB8fCB0aGlzLl9vcHRpb25zLmNvcnMuZXhwZWN0ZWQgJiYgIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnVwbG9hZENvcnMpIHtcbiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVuZGVyRmFpbHVyZSh0aGlzLl9vcHRpb25zLm1lc3NhZ2VzLnVuc3VwcG9ydGVkQnJvd3Nlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl93cmFwQ2FsbGJhY2tzKCk7XG4gICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy5fY2xhc3NlcyA9IHRoaXMuX29wdGlvbnMuY2xhc3NlcztcbiAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy5idXR0b24gJiYgdGhpcy5fdGVtcGxhdGluZy5nZXRCdXR0b24oKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRCdXR0b25JZCA9IHRoaXMuX2NyZWF0ZVVwbG9hZEJ1dHRvbih7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuX3RlbXBsYXRpbmcuZ2V0QnV0dG9uKCksXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLl9vcHRpb25zLnRleHQuZmlsZUlucHV0VGl0bGVcbiAgICAgICAgICAgICAgICB9KS5nZXRCdXR0b25JZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fc2V0dXBDbGlja0FuZEVkaXRFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgICAgICBpZiAocXEuRHJhZ0FuZERyb3AgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3ApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kbmQgPSB0aGlzLl9zZXR1cERyYWdBbmREcm9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5wYXN0ZS50YXJnZXRFbGVtZW50ICYmIHRoaXMuX29wdGlvbnMucGFzdGUucHJvbXB0Rm9yTmFtZSkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5QYXN0ZVN1cHBvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBQYXN0ZVByb21wdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUGFzdGUgc3VwcG9ydCBtb2R1bGUgbm90IGZvdW5kLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3RvdGFsRmlsZXNJbkJhdGNoID0gMDtcbiAgICAgICAgICAgIHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSA9IDA7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHFxLmV4dGVuZChxcS5GaW5lVXBsb2FkZXIucHJvdG90eXBlLCBxcS5iYXNlUHVibGljQXBpKTtcbiAgICBxcS5leHRlbmQocXEuRmluZVVwbG9hZGVyLnByb3RvdHlwZSwgcXEuYmFzZVByaXZhdGVBcGkpO1xuICAgIHFxLmV4dGVuZChxcS5GaW5lVXBsb2FkZXIucHJvdG90eXBlLCBxcS51aVB1YmxpY0FwaSk7XG4gICAgcXEuZXh0ZW5kKHFxLkZpbmVVcGxvYWRlci5wcm90b3R5cGUsIHFxLnVpUHJpdmF0ZUFwaSk7XG4gICAgcXEuVGVtcGxhdGluZyA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBGSUxFX0lEX0FUVFIgPSBcInFxLWZpbGUtaWRcIiwgRklMRV9DTEFTU19QUkVGSVggPSBcInFxLWZpbGUtaWQtXCIsIFRIVU1CTkFJTF9NQVhfU0laRV9BVFRSID0gXCJxcS1tYXgtc2l6ZVwiLCBUSFVNQk5BSUxfU0VSVkVSX1NDQUxFX0FUVFIgPSBcInFxLXNlcnZlci1zY2FsZVwiLCBISURFX0RST1BaT05FX0FUVFIgPSBcInFxLWhpZGUtZHJvcHpvbmVcIiwgRFJPUFpQT05FX1RFWFRfQVRUUiA9IFwicXEtZHJvcC1hcmVhLXRleHRcIiwgSU5fUFJPR1JFU1NfQ0xBU1MgPSBcInFxLWluLXByb2dyZXNzXCIsIEhJRERFTl9GT1JFVkVSX0NMQVNTID0gXCJxcS1oaWRkZW4tZm9yZXZlclwiLCBmaWxlQmF0Y2ggPSB7XG4gICAgICAgICAgICBjb250ZW50OiBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXG4gICAgICAgICAgICBtYXA6IHt9XG4gICAgICAgIH0sIGlzQ2FuY2VsRGlzYWJsZWQgPSBmYWxzZSwgZ2VuZXJhdGVkVGh1bWJuYWlscyA9IDAsIHRodW1ibmFpbFF1ZXVlTW9uaXRvclJ1bm5pbmcgPSBmYWxzZSwgdGh1bWJHZW5lcmF0aW9uUXVldWUgPSBbXSwgdGh1bWJuYWlsTWF4U2l6ZSA9IC0xLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbG9nOiBudWxsLFxuICAgICAgICAgICAgbGltaXRzOiB7XG4gICAgICAgICAgICAgICAgbWF4VGh1bWJzOiAwLFxuICAgICAgICAgICAgICAgIHRpbWVCZXR3ZWVuVGh1bWJzOiA3NTBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZW1wbGF0ZUlkT3JFbDogXCJxcS10ZW1wbGF0ZVwiLFxuICAgICAgICAgICAgY29udGFpbmVyRWw6IG51bGwsXG4gICAgICAgICAgICBmaWxlQ29udGFpbmVyRWw6IG51bGwsXG4gICAgICAgICAgICBidXR0b246IG51bGwsXG4gICAgICAgICAgICBpbWFnZUdlbmVyYXRvcjogbnVsbCxcbiAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICBoaWRlOiBcInFxLWhpZGVcIixcbiAgICAgICAgICAgICAgICBlZGl0YWJsZTogXCJxcS1lZGl0YWJsZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGxhY2Vob2xkZXJzOiB7XG4gICAgICAgICAgICAgICAgd2FpdFVudGlsVXBkYXRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxOb3RBdmFpbGFibGU6IG51bGwsXG4gICAgICAgICAgICAgICAgd2FpdGluZ0ZvclRodW1ibmFpbDogbnVsbFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRleHQ6IHtcbiAgICAgICAgICAgICAgICBwYXVzZWQ6IFwiUGF1c2VkXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgc2VsZWN0b3JDbGFzc2VzID0ge1xuICAgICAgICAgICAgYnV0dG9uOiBcInFxLXVwbG9hZC1idXR0b24tc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGFsZXJ0RGlhbG9nOiBcInFxLWFsZXJ0LWRpYWxvZy1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZGlhbG9nQ2FuY2VsQnV0dG9uOiBcInFxLWNhbmNlbC1idXR0b24tc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGNvbmZpcm1EaWFsb2c6IFwicXEtY29uZmlybS1kaWFsb2ctc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRpYWxvZ01lc3NhZ2U6IFwicXEtZGlhbG9nLW1lc3NhZ2Utc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRpYWxvZ09rQnV0dG9uOiBcInFxLW9rLWJ1dHRvbi1zZWxlY3RvclwiLFxuICAgICAgICAgICAgcHJvbXB0RGlhbG9nOiBcInFxLXByb21wdC1kaWFsb2ctc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHVwbG9hZGVyOiBcInFxLXVwbG9hZGVyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkcm9wOiBcInFxLXVwbG9hZC1kcm9wLWFyZWEtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGxpc3Q6IFwicXEtdXBsb2FkLWxpc3Qtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHByb2dyZXNzQmFyQ29udGFpbmVyOiBcInFxLXByb2dyZXNzLWJhci1jb250YWluZXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHByb2dyZXNzQmFyOiBcInFxLXByb2dyZXNzLWJhci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgdG90YWxQcm9ncmVzc0JhckNvbnRhaW5lcjogXCJxcS10b3RhbC1wcm9ncmVzcy1iYXItY29udGFpbmVyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICB0b3RhbFByb2dyZXNzQmFyOiBcInFxLXRvdGFsLXByb2dyZXNzLWJhci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZmlsZTogXCJxcS11cGxvYWQtZmlsZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgc3Bpbm5lcjogXCJxcS11cGxvYWQtc3Bpbm5lci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgc2l6ZTogXCJxcS11cGxvYWQtc2l6ZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgY2FuY2VsOiBcInFxLXVwbG9hZC1jYW5jZWwtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHBhdXNlOiBcInFxLXVwbG9hZC1wYXVzZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgY29udGludWVCdXR0b246IFwicXEtdXBsb2FkLWNvbnRpbnVlLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkZWxldGVCdXR0b246IFwicXEtdXBsb2FkLWRlbGV0ZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgcmV0cnk6IFwicXEtdXBsb2FkLXJldHJ5LXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBzdGF0dXNUZXh0OiBcInFxLXVwbG9hZC1zdGF0dXMtdGV4dC1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZWRpdEZpbGVuYW1lSW5wdXQ6IFwicXEtZWRpdC1maWxlbmFtZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZWRpdE5hbWVJY29uOiBcInFxLWVkaXQtZmlsZW5hbWUtaWNvbi1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZHJvcFRleHQ6IFwicXEtdXBsb2FkLWRyb3AtYXJlYS10ZXh0LXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkcm9wUHJvY2Vzc2luZzogXCJxcS1kcm9wLXByb2Nlc3Npbmctc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRyb3BQcm9jZXNzaW5nU3Bpbm5lcjogXCJxcS1kcm9wLXByb2Nlc3Npbmctc3Bpbm5lci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgdGh1bWJuYWlsOiBcInFxLXRodW1ibmFpbC1zZWxlY3RvclwiXG4gICAgICAgIH0sIHByZXZpZXdHZW5lcmF0aW9uID0ge30sIGNhY2hlZFRodW1ibmFpbE5vdEF2YWlsYWJsZUltZyA9IG5ldyBxcS5Qcm9taXNlKCksIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcgPSBuZXcgcXEuUHJvbWlzZSgpLCBsb2csIGlzRWRpdEVsZW1lbnRzRXhpc3QsIGlzUmV0cnlFbGVtZW50RXhpc3QsIHRlbXBsYXRlRG9tLCBjb250YWluZXIsIGZpbGVMaXN0LCBzaG93VGh1bWJuYWlscywgc2VydmVyU2NhbGUsIGNhY2hlVGh1bWJuYWlsUGxhY2Vob2xkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbm90QXZhaWxhYmxlVXJsID0gb3B0aW9ucy5wbGFjZWhvbGRlcnMudGh1bWJuYWlsTm90QXZhaWxhYmxlLCB3YWl0aW5nVXJsID0gb3B0aW9ucy5wbGFjZWhvbGRlcnMud2FpdGluZ0ZvclRodW1ibmFpbCwgc3BlYyA9IHtcbiAgICAgICAgICAgICAgICBtYXhTaXplOiB0aHVtYm5haWxNYXhTaXplLFxuICAgICAgICAgICAgICAgIHNjYWxlOiBzZXJ2ZXJTY2FsZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChzaG93VGh1bWJuYWlscykge1xuICAgICAgICAgICAgICAgIGlmIChub3RBdmFpbGFibGVVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pbWFnZUdlbmVyYXRvci5nZW5lcmF0ZShub3RBdmFpbGFibGVVcmwsIG5ldyBJbWFnZSgpLCBzcGVjKS50aGVuKGZ1bmN0aW9uKHVwZGF0ZWRJbWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFRodW1ibmFpbE5vdEF2YWlsYWJsZUltZy5zdWNjZXNzKHVwZGF0ZWRJbWcpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFRodW1ibmFpbE5vdEF2YWlsYWJsZUltZy5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIGxvYWRpbmcgJ25vdCBhdmFpbGFibGUnIHBsYWNlaG9sZGVyIGltYWdlIGF0IFwiICsgbm90QXZhaWxhYmxlVXJsLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZWRUaHVtYm5haWxOb3RBdmFpbGFibGVJbWcuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod2FpdGluZ1VybCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKHdhaXRpbmdVcmwsIG5ldyBJbWFnZSgpLCBzcGVjKS50aGVuKGZ1bmN0aW9uKHVwZGF0ZWRJbWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcuc3VjY2Vzcyh1cGRhdGVkSW1nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gbG9hZGluZyAnd2FpdGluZyBmb3IgdGh1bWJuYWlsJyBwbGFjZWhvbGRlciBpbWFnZSBhdCBcIiArIHdhaXRpbmdVcmwsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZGlzcGxheVdhaXRpbmdJbWcgPSBmdW5jdGlvbih0aHVtYm5haWwpIHtcbiAgICAgICAgICAgIHZhciB3YWl0aW5nSW1nUGxhY2VtZW50ID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGNhY2hlZFdhaXRpbmdGb3JUaHVtYm5haWxJbWcudGhlbihmdW5jdGlvbihpbWcpIHtcbiAgICAgICAgICAgICAgICBtYXliZVNjYWxlUGxhY2Vob2xkZXJWaWFDc3MoaW1nLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIGlmICghdGh1bWJuYWlsLnNyYykge1xuICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwuc3JjID0gaW1nLnNyYztcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93KHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YWl0aW5nSW1nUGxhY2VtZW50LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3YWl0aW5nSW1nUGxhY2VtZW50LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBoaWRlKHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgd2FpdGluZ0ltZ1BsYWNlbWVudC5zdWNjZXNzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB3YWl0aW5nSW1nUGxhY2VtZW50O1xuICAgICAgICB9LCBnZW5lcmF0ZU5ld1ByZXZpZXcgPSBmdW5jdGlvbihpZCwgYmxvYiwgc3BlYykge1xuICAgICAgICAgICAgdmFyIHRodW1ibmFpbCA9IGdldFRodW1ibmFpbChpZCk7XG4gICAgICAgICAgICBsb2coXCJHZW5lcmF0aW5nIG5ldyB0aHVtYm5haWwgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgYmxvYi5xcVRodW1ibmFpbElkID0gaWQ7XG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pbWFnZUdlbmVyYXRvci5nZW5lcmF0ZShibG9iLCB0aHVtYm5haWwsIHNwZWMpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVkVGh1bWJuYWlscysrO1xuICAgICAgICAgICAgICAgIHNob3codGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvbltpZF0uc3VjY2VzcygpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25baWRdLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMucGxhY2Vob2xkZXJzLndhaXRVbnRpbFVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcoaWQsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aHVtYkdlbmVyYXRpb25RdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxRdWV1ZU1vbml0b3JSdW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgcXVldWVkVGh1bWJSZXF1ZXN0ID0gdGh1bWJHZW5lcmF0aW9uUXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAocXVldWVkVGh1bWJSZXF1ZXN0LnVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVXBkYXRlUXVldWVkUHJldmlld1JlcXVlc3QocXVldWVkVGh1bWJSZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTmV3UXVldWVkUHJldmlld1JlcXVlc3QocXVldWVkVGh1bWJSZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRodW1ibmFpbFF1ZXVlTW9uaXRvclJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZ2V0Q2FuY2VsID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuY2FuY2VsKTtcbiAgICAgICAgfSwgZ2V0Q29udGludWUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5jb250aW51ZUJ1dHRvbik7XG4gICAgICAgIH0sIGdldERpYWxvZyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzW3R5cGUgKyBcIkRpYWxvZ1wiXSk7XG4gICAgICAgIH0sIGdldERlbGV0ZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmRlbGV0ZUJ1dHRvbik7XG4gICAgICAgIH0sIGdldERyb3BQcm9jZXNzaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy5kcm9wUHJvY2Vzc2luZyk7XG4gICAgICAgIH0sIGdldEVkaXRJY29uID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuZWRpdE5hbWVJY29uKTtcbiAgICAgICAgfSwgZ2V0RmlsZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmlsZUJhdGNoLm1hcFtpZF0gfHwgcXEoZmlsZUxpc3QpLmdldEZpcnN0QnlDbGFzcyhGSUxFX0NMQVNTX1BSRUZJWCArIGlkKTtcbiAgICAgICAgfSwgZ2V0RmlsZW5hbWUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5maWxlKTtcbiAgICAgICAgfSwgZ2V0UGF1c2UgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5wYXVzZSk7XG4gICAgICAgIH0sIGdldFByb2dyZXNzID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIGlmIChpZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMudG90YWxQcm9ncmVzc0JhckNvbnRhaW5lcikgfHwgZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy50b3RhbFByb2dyZXNzQmFyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMucHJvZ3Jlc3NCYXJDb250YWluZXIpIHx8IGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5wcm9ncmVzc0Jhcik7XG4gICAgICAgIH0sIGdldFJldHJ5ID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMucmV0cnkpO1xuICAgICAgICB9LCBnZXRTaXplID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuc2l6ZSk7XG4gICAgICAgIH0sIGdldFNwaW5uZXIgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5zcGlubmVyKTtcbiAgICAgICAgfSwgZ2V0VGVtcGxhdGVFbCA9IGZ1bmN0aW9uKGNvbnRleHQsIGNzc0NsYXNzKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGV4dCAmJiBxcShjb250ZXh0KS5nZXRGaXJzdEJ5Q2xhc3MoY3NzQ2xhc3MpO1xuICAgICAgICB9LCBnZXRUaHVtYm5haWwgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIHNob3dUaHVtYm5haWxzICYmIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy50aHVtYm5haWwpO1xuICAgICAgICB9LCBoaWRlID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgIGVsICYmIHFxKGVsKS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuaGlkZSk7XG4gICAgICAgIH0sIG1heWJlU2NhbGVQbGFjZWhvbGRlclZpYUNzcyA9IGZ1bmN0aW9uKHBsYWNlaG9sZGVyLCB0aHVtYm5haWwpIHtcbiAgICAgICAgICAgIHZhciBtYXhXaWR0aCA9IHBsYWNlaG9sZGVyLnN0eWxlLm1heFdpZHRoLCBtYXhIZWlnaHQgPSBwbGFjZWhvbGRlci5zdHlsZS5tYXhIZWlnaHQ7XG4gICAgICAgICAgICBpZiAobWF4SGVpZ2h0ICYmIG1heFdpZHRoICYmICF0aHVtYm5haWwuc3R5bGUubWF4V2lkdGggJiYgIXRodW1ibmFpbC5zdHlsZS5tYXhIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBxcSh0aHVtYm5haWwpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBtYXhIZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nID0gZnVuY3Rpb24oaWQsIHRodW1ibmFpbCkge1xuICAgICAgICAgICAgdmFyIHByZXZpZXdpbmcgPSBwcmV2aWV3R2VuZXJhdGlvbltpZF0gfHwgbmV3IHFxLlByb21pc2UoKS5mYWlsdXJlKCksIG5vdEF2YWlsYWJsZUltZ1BsYWNlbWVudCA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBjYWNoZWRUaHVtYm5haWxOb3RBdmFpbGFibGVJbWcudGhlbihmdW5jdGlvbihpbWcpIHtcbiAgICAgICAgICAgICAgICBwcmV2aWV3aW5nLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdEF2YWlsYWJsZUltZ1BsYWNlbWVudC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlU2NhbGVQbGFjZWhvbGRlclZpYUNzcyhpbWcsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5vbmxvYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90QXZhaWxhYmxlSW1nUGxhY2VtZW50LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLnNyYyA9IGltZy5zcmM7XG4gICAgICAgICAgICAgICAgICAgIHNob3codGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5vdEF2YWlsYWJsZUltZ1BsYWNlbWVudDtcbiAgICAgICAgfSwgcGFyc2VBbmRHZXRUZW1wbGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHNjcmlwdEVsLCBzY3JpcHRIdG1sLCBmaWxlTGlzdE5vZGUsIHRlbXBUZW1wbGF0ZUVsLCBmaWxlTGlzdEVsLCBkZWZhdWx0QnV0dG9uLCBkcm9wQXJlYSwgdGh1bWJuYWlsLCBkcm9wUHJvY2Vzc2luZywgZHJvcFRleHRFbCwgdXBsb2FkZXJFbDtcbiAgICAgICAgICAgIGxvZyhcIlBhcnNpbmcgdGVtcGxhdGVcIik7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50ZW1wbGF0ZUlkT3JFbCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IE1VU1Qgc3BlY2lmeSBlaXRoZXIgYSB0ZW1wbGF0ZSBlbGVtZW50IG9yIElEIVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhvcHRpb25zLnRlbXBsYXRlSWRPckVsKSkge1xuICAgICAgICAgICAgICAgIHNjcmlwdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy50ZW1wbGF0ZUlkT3JFbCk7XG4gICAgICAgICAgICAgICAgaWYgKHNjcmlwdEVsID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihxcS5mb3JtYXQoXCJDYW5ub3QgZmluZCB0ZW1wbGF0ZSBzY3JpcHQgYXQgSUQgJ3t9JyFcIiwgb3B0aW9ucy50ZW1wbGF0ZUlkT3JFbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzY3JpcHRIdG1sID0gc2NyaXB0RWwuaW5uZXJIVE1MO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50ZW1wbGF0ZUlkT3JFbC5pbm5lckhUTUwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgaGF2ZSBzcGVjaWZpZWQgYW4gaW52YWxpZCB2YWx1ZSBmb3IgdGhlIHRlbXBsYXRlIG9wdGlvbiEgIFwiICsgXCJJdCBtdXN0IGJlIGFuIElEIG9yIGFuIEVsZW1lbnQuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzY3JpcHRIdG1sID0gb3B0aW9ucy50ZW1wbGF0ZUlkT3JFbC5pbm5lckhUTUw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzY3JpcHRIdG1sID0gcXEudHJpbVN0cihzY3JpcHRIdG1sKTtcbiAgICAgICAgICAgIHRlbXBUZW1wbGF0ZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIHRlbXBUZW1wbGF0ZUVsLmFwcGVuZENoaWxkKHFxLnRvRWxlbWVudChzY3JpcHRIdG1sKSk7XG4gICAgICAgICAgICB1cGxvYWRlckVsID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMudXBsb2FkZXIpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdEJ1dHRvbiA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmJ1dHRvbik7XG4gICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZGVmYXVsdEJ1dHRvbikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFxcS5EcmFnQW5kRHJvcCB8fCAhcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3ApIHtcbiAgICAgICAgICAgICAgICBkcm9wUHJvY2Vzc2luZyA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmRyb3BQcm9jZXNzaW5nKTtcbiAgICAgICAgICAgICAgICBpZiAoZHJvcFByb2Nlc3NpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZHJvcFByb2Nlc3NpbmcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRyb3BBcmVhID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMuZHJvcCk7XG4gICAgICAgICAgICBpZiAoZHJvcEFyZWEgJiYgIXFxLkRyYWdBbmREcm9wKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiRG5EIG1vZHVsZSB1bmF2YWlsYWJsZS5cIiwgXCJpbmZvXCIpO1xuICAgICAgICAgICAgICAgIHFxKGRyb3BBcmVhKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMuZmlsZURyb3ApIHtcbiAgICAgICAgICAgICAgICB1cGxvYWRlckVsLnJlbW92ZUF0dHJpYnV0ZShEUk9QWlBPTkVfVEVYVF9BVFRSKTtcbiAgICAgICAgICAgICAgICBpZiAoZHJvcEFyZWEgJiYgcXEoZHJvcEFyZWEpLmhhc0F0dHJpYnV0ZShISURFX0RST1BaT05FX0FUVFIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGRyb3BBcmVhKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJub25lXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChxcSh1cGxvYWRlckVsKS5oYXNBdHRyaWJ1dGUoRFJPUFpQT05FX1RFWFRfQVRUUikgJiYgZHJvcEFyZWEpIHtcbiAgICAgICAgICAgICAgICBkcm9wVGV4dEVsID0gcXEoZHJvcEFyZWEpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMuZHJvcFRleHQpO1xuICAgICAgICAgICAgICAgIGRyb3BUZXh0RWwgJiYgcXEoZHJvcFRleHRFbCkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHVtYm5haWwgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy50aHVtYm5haWwpO1xuICAgICAgICAgICAgaWYgKCFzaG93VGh1bWJuYWlscykge1xuICAgICAgICAgICAgICAgIHRodW1ibmFpbCAmJiBxcSh0aHVtYm5haWwpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aHVtYm5haWwpIHtcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxNYXhTaXplID0gcGFyc2VJbnQodGh1bWJuYWlsLmdldEF0dHJpYnV0ZShUSFVNQk5BSUxfTUFYX1NJWkVfQVRUUikpO1xuICAgICAgICAgICAgICAgIHRodW1ibmFpbE1heFNpemUgPSB0aHVtYm5haWxNYXhTaXplID4gMCA/IHRodW1ibmFpbE1heFNpemUgOiBudWxsO1xuICAgICAgICAgICAgICAgIHNlcnZlclNjYWxlID0gcXEodGh1bWJuYWlsKS5oYXNBdHRyaWJ1dGUoVEhVTUJOQUlMX1NFUlZFUl9TQ0FMRV9BVFRSKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNob3dUaHVtYm5haWxzID0gc2hvd1RodW1ibmFpbHMgJiYgdGh1bWJuYWlsO1xuICAgICAgICAgICAgaXNFZGl0RWxlbWVudHNFeGlzdCA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5lZGl0RmlsZW5hbWVJbnB1dCkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGlzUmV0cnlFbGVtZW50RXhpc3QgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMucmV0cnkpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBmaWxlTGlzdE5vZGUgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5saXN0KTtcbiAgICAgICAgICAgIGlmIChmaWxlTGlzdE5vZGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIHRoZSBmaWxlIGxpc3QgY29udGFpbmVyIGluIHRoZSB0ZW1wbGF0ZSFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaWxlTGlzdEVsID0gZmlsZUxpc3ROb2RlLmNoaWxkcmVuWzBdLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgICAgIGZpbGVMaXN0Tm9kZS5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgaWYgKHRlbXBUZW1wbGF0ZUVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiRElBTE9HXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaWFsb2dcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2coXCJUZW1wbGF0ZSBwYXJzaW5nIGNvbXBsZXRlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogdGVtcFRlbXBsYXRlRWwsXG4gICAgICAgICAgICAgICAgZmlsZVRlbXBsYXRlOiBmaWxlTGlzdEVsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LCBwcmVwZW5kRmlsZSA9IGZ1bmN0aW9uKGVsLCBpbmRleCwgZmlsZUxpc3QpIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnRFbCA9IGZpbGVMaXN0LCBiZWZvcmVFbCA9IHBhcmVudEVsLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgICAgICAgICAgYmVmb3JlRWwgPSBxcShwYXJlbnRFbCkuY2hpbGRyZW4oKVtpbmRleF0ubmV4dFNpYmxpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnRFbC5pbnNlcnRCZWZvcmUoZWwsIGJlZm9yZUVsKTtcbiAgICAgICAgfSwgcHJvY2Vzc05ld1F1ZXVlZFByZXZpZXdSZXF1ZXN0ID0gZnVuY3Rpb24ocXVldWVkVGh1bWJSZXF1ZXN0KSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBxdWV1ZWRUaHVtYlJlcXVlc3QuaWQsIG9wdEZpbGVPckJsb2IgPSBxdWV1ZWRUaHVtYlJlcXVlc3Qub3B0RmlsZU9yQmxvYiwgcmVsYXRlZFRodW1ibmFpbElkID0gb3B0RmlsZU9yQmxvYiAmJiBvcHRGaWxlT3JCbG9iLnFxVGh1bWJuYWlsSWQsIHRodW1ibmFpbCA9IGdldFRodW1ibmFpbChpZCksIHNwZWMgPSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IHF1ZXVlZFRodW1iUmVxdWVzdC5jdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICBtYXhTaXplOiB0aHVtYm5haWxNYXhTaXplLFxuICAgICAgICAgICAgICAgIG9yaWVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzY2FsZTogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRodW1ibmFpbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5saW1pdHMubWF4VGh1bWJzICYmIG9wdGlvbnMubGltaXRzLm1heFRodW1icyA8PSBnZW5lcmF0ZWRUaHVtYm5haWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcoaWQsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5V2FpdGluZ0ltZyh0aHVtYm5haWwpLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25baWRdID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvbltpZF0uZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3LCBvcHRpb25zLmxpbWl0cy50aW1lQmV0d2VlblRodW1icyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbGF0ZWRUaHVtYm5haWxJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNhY2hlZFByZXZpZXcoaWQsIHJlbGF0ZWRUaHVtYm5haWxJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXdQcmV2aWV3KGlkLCBvcHRGaWxlT3JCbG9iLCBzcGVjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRodW1ibmFpbCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlXYWl0aW5nSW1nKHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBwcm9jZXNzVXBkYXRlUXVldWVkUHJldmlld1JlcXVlc3QgPSBmdW5jdGlvbihxdWV1ZWRUaHVtYlJlcXVlc3QpIHtcbiAgICAgICAgICAgIHZhciBpZCA9IHF1ZXVlZFRodW1iUmVxdWVzdC5pZCwgdGh1bWJuYWlsVXJsID0gcXVldWVkVGh1bWJSZXF1ZXN0LnRodW1ibmFpbFVybCwgc2hvd1dhaXRpbmdJbWcgPSBxdWV1ZWRUaHVtYlJlcXVlc3Quc2hvd1dhaXRpbmdJbWcsIHRodW1ibmFpbCA9IGdldFRodW1ibmFpbChpZCksIHNwZWMgPSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IHF1ZXVlZFRodW1iUmVxdWVzdC5jdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICBzY2FsZTogc2VydmVyU2NhbGUsXG4gICAgICAgICAgICAgICAgbWF4U2l6ZTogdGh1bWJuYWlsTWF4U2l6ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh0aHVtYm5haWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGh1bWJuYWlsVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmxpbWl0cy5tYXhUaHVtYnMgJiYgb3B0aW9ucy5saW1pdHMubWF4VGh1bWJzIDw9IGdlbmVyYXRlZFRodW1ibmFpbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyhpZCwgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG93V2FpdGluZ0ltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlXYWl0aW5nSW1nKHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pbWFnZUdlbmVyYXRvci5nZW5lcmF0ZSh0aHVtYm5haWxVcmwsIHRodW1ibmFpbCwgc3BlYykudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93KHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkVGh1bWJuYWlscysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldywgb3B0aW9ucy5saW1pdHMudGltZUJldHdlZW5UaHVtYnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKGlkLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldywgb3B0aW9ucy5saW1pdHMudGltZUJldHdlZW5UaHVtYnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcoaWQsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHNldFByb2dyZXNzQmFyV2lkdGggPSBmdW5jdGlvbihpZCwgcGVyY2VudCkge1xuICAgICAgICAgICAgdmFyIGJhciA9IGdldFByb2dyZXNzKGlkKSwgcHJvZ3Jlc3NCYXJTZWxlY3RvciA9IGlkID09IG51bGwgPyBzZWxlY3RvckNsYXNzZXMudG90YWxQcm9ncmVzc0JhciA6IHNlbGVjdG9yQ2xhc3Nlcy5wcm9ncmVzc0JhcjtcbiAgICAgICAgICAgIGlmIChiYXIgJiYgIXFxKGJhcikuaGFzQ2xhc3MocHJvZ3Jlc3NCYXJTZWxlY3RvcikpIHtcbiAgICAgICAgICAgICAgICBiYXIgPSBxcShiYXIpLmdldEZpcnN0QnlDbGFzcyhwcm9ncmVzc0JhclNlbGVjdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiYXIpIHtcbiAgICAgICAgICAgICAgICBxcShiYXIpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBwZXJjZW50ICsgXCIlXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBiYXIuc2V0QXR0cmlidXRlKFwiYXJpYS12YWx1ZW5vd1wiLCBwZXJjZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgc2hvdyA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICBlbCAmJiBxcShlbCkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmhpZGUpO1xuICAgICAgICB9LCB1c2VDYWNoZWRQcmV2aWV3ID0gZnVuY3Rpb24odGFyZ2V0VGh1bWJuYWlsSWQsIGNhY2hlZFRodW1ibmFpbElkKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0VGh1bWJuYWlsID0gZ2V0VGh1bWJuYWlsKHRhcmdldFRodW1ibmFpbElkKSwgY2FjaGVkVGh1bWJuYWlsID0gZ2V0VGh1bWJuYWlsKGNhY2hlZFRodW1ibmFpbElkKTtcbiAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJJRCB7fSBpcyB0aGUgc2FtZSBmaWxlIGFzIElEIHt9LiAgV2lsbCB1c2UgZ2VuZXJhdGVkIHRodW1ibmFpbCBmcm9tIElEIHt9IGluc3RlYWQuXCIsIHRhcmdldFRodW1ibmFpbElkLCBjYWNoZWRUaHVtYm5haWxJZCwgY2FjaGVkVGh1bWJuYWlsSWQpKTtcbiAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW2NhY2hlZFRodW1ibmFpbElkXS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlZFRodW1ibmFpbHMrKztcbiAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvblt0YXJnZXRUaHVtYm5haWxJZF0uc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJOb3cgdXNpbmcgcHJldmlvdXNseSBnZW5lcmF0ZWQgdGh1bWJuYWlsIGNyZWF0ZWQgZm9yIElEIHt9IG9uIElEIHt9LlwiLCBjYWNoZWRUaHVtYm5haWxJZCwgdGFyZ2V0VGh1bWJuYWlsSWQpKTtcbiAgICAgICAgICAgICAgICB0YXJnZXRUaHVtYm5haWwuc3JjID0gY2FjaGVkVGh1bWJuYWlsLnNyYztcbiAgICAgICAgICAgICAgICBzaG93KHRhcmdldFRodW1ibmFpbCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvblt0YXJnZXRUaHVtYm5haWxJZF0uZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5wbGFjZWhvbGRlcnMud2FpdFVudGlsVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyh0YXJnZXRUaHVtYm5haWxJZCwgdGFyZ2V0VGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIHNwZWMpO1xuICAgICAgICBsb2cgPSBvcHRpb25zLmxvZztcbiAgICAgICAgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzKSB7XG4gICAgICAgICAgICBvcHRpb25zLmxpbWl0cy50aW1lQmV0d2VlblRodW1icyA9IDA7XG4gICAgICAgICAgICBvcHRpb25zLmxpbWl0cy5tYXhUaHVtYnMgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lciA9IG9wdGlvbnMuY29udGFpbmVyRWw7XG4gICAgICAgIHNob3dUaHVtYm5haWxzID0gb3B0aW9ucy5pbWFnZUdlbmVyYXRvciAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB0ZW1wbGF0ZURvbSA9IHBhcnNlQW5kR2V0VGVtcGxhdGUoKTtcbiAgICAgICAgY2FjaGVUaHVtYm5haWxQbGFjZWhvbGRlcnMoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiUmVuZGVyaW5nIHRlbXBsYXRlIGluIERPTS5cIik7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVkVGh1bWJuYWlscyA9IDA7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRlbXBsYXRlRG9tLnRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICAgICAgICAgICAgaGlkZShnZXREcm9wUHJvY2Vzc2luZygpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVUb3RhbFByb2dyZXNzKCk7XG4gICAgICAgICAgICAgICAgZmlsZUxpc3QgPSBvcHRpb25zLmZpbGVDb250YWluZXJFbCB8fCBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLmxpc3QpO1xuICAgICAgICAgICAgICAgIGxvZyhcIlRlbXBsYXRlIHJlbmRlcmluZyBjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW5kZXJGYWlsdXJlOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbnRSZW5kZXJFbCA9IHFxLnRvRWxlbWVudChtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudFJlbmRlckVsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhckZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmaWxlTGlzdC5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc2FibGVDYW5jZWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlzQ2FuY2VsRGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEZpbGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCBwcmVwZW5kSW5mbywgaGlkZUZvcmV2ZXIsIGJhdGNoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVFbCA9IHRlbXBsYXRlRG9tLmZpbGVUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSksIGZpbGVOYW1lRWwgPSBnZXRUZW1wbGF0ZUVsKGZpbGVFbCwgc2VsZWN0b3JDbGFzc2VzLmZpbGUpLCB1cGxvYWRlckVsID0gZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy51cGxvYWRlciksIGZpbGVDb250YWluZXIgPSBiYXRjaCA/IGZpbGVCYXRjaC5jb250ZW50IDogZmlsZUxpc3QsIHRodW1iO1xuICAgICAgICAgICAgICAgIGlmIChiYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQmF0Y2gubWFwW2lkXSA9IGZpbGVFbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEoZmlsZUVsKS5hZGRDbGFzcyhGSUxFX0NMQVNTX1BSRUZJWCArIGlkKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlckVsLnJlbW92ZUF0dHJpYnV0ZShEUk9QWlBPTkVfVEVYVF9BVFRSKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZU5hbWVFbCkge1xuICAgICAgICAgICAgICAgICAgICBxcShmaWxlTmFtZUVsKS5zZXRUZXh0KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZUVsLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWxlRWwuc2V0QXR0cmlidXRlKEZJTEVfSURfQVRUUiwgaWQpO1xuICAgICAgICAgICAgICAgIGlmIChwcmVwZW5kSW5mbykge1xuICAgICAgICAgICAgICAgICAgICBwcmVwZW5kRmlsZShmaWxlRWwsIHByZXBlbmRJbmZvLmluZGV4LCBmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQ29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGVFbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoaWRlRm9yZXZlcikge1xuICAgICAgICAgICAgICAgICAgICBmaWxlRWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICBxcShmaWxlRWwpLmFkZENsYXNzKEhJRERFTl9GT1JFVkVSX0NMQVNTKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldFByb2dyZXNzKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0U2l6ZShpZCkpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldERlbGV0ZShpZCkpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldFJldHJ5KGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0UGF1c2UoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXRDb250aW51ZShpZCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDYW5jZWxEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGdldFRodW1ibmFpbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aHVtYiAmJiAhdGh1bWIuc3JjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nLnRoZW4oZnVuY3Rpb24od2FpdGluZ0ltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iLnNyYyA9IHdhaXRpbmdJbWcuc3JjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nSW1nLnN0eWxlLm1heEhlaWdodCAmJiB3YWl0aW5nSW1nLnN0eWxlLm1heFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxKHRodW1iKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiB3YWl0aW5nSW1nLnN0eWxlLm1heEhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiB3YWl0aW5nSW1nLnN0eWxlLm1heFdpZHRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93KHRodW1iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEZpbGVUb0NhY2hlOiBmdW5jdGlvbihpZCwgbmFtZSwgcHJlcGVuZEluZm8sIGhpZGVGb3JldmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlKGlkLCBuYW1lLCBwcmVwZW5kSW5mbywgaGlkZUZvcmV2ZXIsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZENhY2hlVG9Eb206IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZpbGVMaXN0LmFwcGVuZENoaWxkKGZpbGVCYXRjaC5jb250ZW50KTtcbiAgICAgICAgICAgICAgICBmaWxlQmF0Y2guY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgICAgICAgICBmaWxlQmF0Y2gubWFwID0ge307XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlRmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBxcShnZXRGaWxlKGlkKSkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZUlkOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Tm9kZSA9IGVsO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudE5vZGUuZ2V0QXR0cmlidXRlKEZJTEVfSURfQVRUUikgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChjdXJyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoRklMRV9JRF9BVFRSKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGVMaXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZUxpc3Q7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWFya0ZpbGVuYW1lRWRpdGFibGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZ2V0RmlsZW5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGZpbGVuYW1lICYmIHFxKGZpbGVuYW1lKS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuZWRpdGFibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUZpbGVuYW1lOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZUVsID0gZ2V0RmlsZW5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlbmFtZUVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGZpbGVuYW1lRWwpLnNldFRleHQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lRWwuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgbmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVGaWxlbmFtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldEZpbGVuYW1lKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0ZpbGVuYW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0RmlsZW5hbWUoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0ZpbGVOYW1lOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmZpbGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEJ1dHRvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuYnV0dG9uIHx8IGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMuYnV0dG9uKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlRHJvcFByb2Nlc3Npbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0RHJvcFByb2Nlc3NpbmcoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0Ryb3BQcm9jZXNzaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldERyb3BQcm9jZXNzaW5nKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERyb3Bab25lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy5kcm9wKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0VkaXRGaWxlbmFtZVBvc3NpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNFZGl0RWxlbWVudHNFeGlzdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlUmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRSZXRyeShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUmV0cnlQb3NzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzUmV0cnlFbGVtZW50RXhpc3Q7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd1JldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0UmV0cnkoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlQ29udGFpbmVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRGaWxlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93RWRpdEljb246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGljb24gPSBnZXRFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgaWNvbiAmJiBxcShpY29uKS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuZWRpdGFibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzSGlkZGVuRm9yZXZlcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZ2V0RmlsZShpZCkpLmhhc0NsYXNzKEhJRERFTl9GT1JFVkVSX0NMQVNTKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlRWRpdEljb246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGljb24gPSBnZXRFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgaWNvbiAmJiBxcShpY29uKS5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMuZWRpdGFibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRWRpdEljb246IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuZWRpdE5hbWVJY29uLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRFZGl0SW5wdXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5lZGl0RmlsZW5hbWVJbnB1dCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNFZGl0SW5wdXQ6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuZWRpdEZpbGVuYW1lSW5wdXQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzOiBmdW5jdGlvbihpZCwgbG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHZhciBiYXIgPSBnZXRQcm9ncmVzcyhpZCksIHBlcmNlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGJhciAmJiB0b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcGVyY2VudCA9IE1hdGgucm91bmQobG9hZGVkIC8gdG90YWwgKiAxMDApO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGVyY2VudCA9PT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRlKGJhcik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93KGJhcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2V0UHJvZ3Jlc3NCYXJXaWR0aChpZCwgcGVyY2VudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKG51bGwsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVQcm9ncmVzczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmFyID0gZ2V0UHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgICAgIGJhciAmJiBoaWRlKGJhcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZVRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZVByb2dyZXNzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXRQcm9ncmVzczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzZXRQcm9ncmVzc0JhcldpZHRoKGlkLCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVUb3RhbFByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldFRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRQcm9ncmVzcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dDYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0NhbmNlbERpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYW5jZWwgPSBnZXRDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWwgJiYgcXEoY2FuY2VsKS5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMuaGlkZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVDYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRDYW5jZWwoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0NhbmNlbDogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5jYW5jZWwsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFsbG93UGF1c2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRQYXVzZShpZCkpO1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0Q29udGludWUoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGxvYWRQYXVzZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXNUZXh0KGlkLCBvcHRpb25zLnRleHQucGF1c2VkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93Q29udGludWVCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0U3Bpbm5lcihpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVQYXVzZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldFBhdXNlKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNQYXVzZTogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5wYXVzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNDb250aW51ZUJ1dHRvbjogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5jb250aW51ZUJ1dHRvbiwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWxsb3dDb250aW51ZUJ1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldENvbnRpbnVlKGlkKSk7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRQYXVzZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZENvbnRpbnVlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1c1RleHQoaWQsIFwiXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dQYXVzZShpZCk7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRTcGlubmVyKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0RlbGV0ZUJ1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldERlbGV0ZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVEZWxldGVCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXREZWxldGUoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0RlbGV0ZUJ1dHRvbjogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5kZWxldGVCdXR0b24sIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUmV0cnk6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMucmV0cnksIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZVNpemU6IGZ1bmN0aW9uKGlkLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpemUgPSBnZXRTaXplKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICBzaG93KHNpemUpO1xuICAgICAgICAgICAgICAgICAgICBxcShzaXplKS5zZXRUZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRTdGF0dXNUZXh0OiBmdW5jdGlvbihpZCwgdGV4dCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXh0RWwgPSBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgaWYgKHRleHRFbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcSh0ZXh0RWwpLmNsZWFyVGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEodGV4dEVsKS5zZXRUZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVTcGlubmVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHFxKGdldEZpbGUoaWQpKS5yZW1vdmVDbGFzcyhJTl9QUk9HUkVTU19DTEFTUyk7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRTcGlubmVyKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd1NwaW5uZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcXEoZ2V0RmlsZShpZCkpLmFkZENsYXNzKElOX1BST0dSRVNTX0NMQVNTKTtcbiAgICAgICAgICAgICAgICBzaG93KGdldFNwaW5uZXIoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZW5lcmF0ZVByZXZpZXc6IGZ1bmN0aW9uKGlkLCBvcHRGaWxlT3JCbG9iLCBjdXN0b21SZXNpemVGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0hpZGRlbkZvcmV2ZXIoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRodW1iR2VuZXJhdGlvblF1ZXVlLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0RmlsZU9yQmxvYjogb3B0RmlsZU9yQmxvYlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgIXRodW1ibmFpbFF1ZXVlTW9uaXRvclJ1bm5pbmcgJiYgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVUaHVtYm5haWw6IGZ1bmN0aW9uKGlkLCB0aHVtYm5haWxVcmwsIHNob3dXYWl0aW5nSW1nLCBjdXN0b21SZXNpemVGdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0hpZGRlbkZvcmV2ZXIoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRodW1iR2VuZXJhdGlvblF1ZXVlLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsVXJsOiB0aHVtYm5haWxVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93V2FpdGluZ0ltZzogc2hvd1dhaXRpbmdJbWdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICF0aHVtYm5haWxRdWV1ZU1vbml0b3JSdW5uaW5nICYmIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzRGlhbG9nOiBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmRpYWxvZ0VsZW1lbnQgJiYgISFnZXREaWFsb2codHlwZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0RpYWxvZzogZnVuY3Rpb24odHlwZSwgbWVzc2FnZSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpYWxvZyA9IGdldERpYWxvZyh0eXBlKSwgbWVzc2FnZUVsID0gZ2V0VGVtcGxhdGVFbChkaWFsb2csIHNlbGVjdG9yQ2xhc3Nlcy5kaWFsb2dNZXNzYWdlKSwgaW5wdXRFbCA9IGRpYWxvZy5nZXRFbGVtZW50c0J5VGFnTmFtZShcIklOUFVUXCIpWzBdLCBjYW5jZWxCdG4gPSBnZXRUZW1wbGF0ZUVsKGRpYWxvZywgc2VsZWN0b3JDbGFzc2VzLmRpYWxvZ0NhbmNlbEJ1dHRvbiksIG9rQnRuID0gZ2V0VGVtcGxhdGVFbChkaWFsb2csIHNlbGVjdG9yQ2xhc3Nlcy5kaWFsb2dPa0J1dHRvbiksIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpLCBjbG9zZUhhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjYW5jZWxDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBva0J0biAmJiBva0J0bi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb2tDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9LCBjYW5jZWxDbGlja0hhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjYW5jZWxDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9LCBva0NsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsb3NlXCIsIGNsb3NlSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIG9rQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBva0NsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoaW5wdXRFbCAmJiBpbnB1dEVsLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGRpYWxvZy5hZGRFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgY2xvc2VIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNhbmNlbENsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgb2tCdG4gJiYgb2tCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG9rQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRFbCkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dEVsLnZhbHVlID0gZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtZXNzYWdlRWwudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5VaUV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uKHMsIHByb3RlY3RlZEFwaSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRpc3Bvc2VyID0gbmV3IHFxLkRpc3Bvc2VTdXBwb3J0KCksIHNwZWMgPSB7XG4gICAgICAgICAgICBldmVudFR5cGU6IFwiY2xpY2tcIixcbiAgICAgICAgICAgIGF0dGFjaFRvOiBudWxsLFxuICAgICAgICAgICAgb25IYW5kbGVkOiBmdW5jdGlvbih0YXJnZXQsIGV2ZW50KSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgYWRkSGFuZGxlcjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGFkZEhhbmRsZXIoZWxlbWVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGlzcG9zZXIuZGlzcG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gYWRkSGFuZGxlcihlbGVtZW50KSB7XG4gICAgICAgICAgICBkaXNwb3Nlci5hdHRhY2goZWxlbWVudCwgc3BlYy5ldmVudFR5cGUsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQgPSBldmVudCB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50O1xuICAgICAgICAgICAgICAgIHNwZWMub25IYW5kbGVkKHRhcmdldCwgZXZlbnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHByb3RlY3RlZEFwaSwge1xuICAgICAgICAgICAgZ2V0RmlsZUlkRnJvbUl0ZW06IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5xcUZpbGVJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREaXNwb3NlU3VwcG9ydDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRpc3Bvc2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcXEuZXh0ZW5kKHNwZWMsIHMpO1xuICAgICAgICBpZiAoc3BlYy5hdHRhY2hUbykge1xuICAgICAgICAgICAgYWRkSGFuZGxlcihzcGVjLmF0dGFjaFRvKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcXEuRmlsZUJ1dHRvbnNDbGlja0hhbmRsZXIgPSBmdW5jdGlvbihzKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgaW5oZXJpdGVkSW50ZXJuYWxBcGkgPSB7fSwgc3BlYyA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRpbmc6IG51bGwsXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge30sXG4gICAgICAgICAgICBvbkRlbGV0ZUZpbGU6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uUmV0cnk6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvblBhdXNlOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25Db250aW51ZTogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uR2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7fVxuICAgICAgICB9LCBidXR0b25IYW5kbGVycyA9IHtcbiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzcGVjLm9uQ2FuY2VsKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzcGVjLm9uUmV0cnkoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlbGV0ZUJ1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzcGVjLm9uRGVsZXRlRmlsZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc3BlYy5vblBhdXNlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250aW51ZUJ1dHRvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzcGVjLm9uQ29udGludWUoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBmdW5jdGlvbiBleGFtaW5lRXZlbnQodGFyZ2V0LCBldmVudCkge1xuICAgICAgICAgICAgcXEuZWFjaChidXR0b25IYW5kbGVycywgZnVuY3Rpb24oYnV0dG9uVHlwZSwgaGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHZhciBmaXJzdExldHRlckNhcEJ1dHRvblR5cGUgPSBidXR0b25UeXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYnV0dG9uVHlwZS5zbGljZSgxKSwgZmlsZUlkO1xuICAgICAgICAgICAgICAgIGlmIChzcGVjLnRlbXBsYXRpbmdbXCJpc1wiICsgZmlyc3RMZXR0ZXJDYXBCdXR0b25UeXBlXSh0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVJZCA9IHNwZWMudGVtcGxhdGluZy5nZXRGaWxlSWQodGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgcXEucHJldmVudERlZmF1bHQoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBzcGVjLmxvZyhxcS5mb3JtYXQoXCJEZXRlY3RlZCB2YWxpZCBmaWxlIGJ1dHRvbiBjbGljayBldmVudCBvbiBmaWxlICd7fScsIElEOiB7fS5cIiwgc3BlYy5vbkdldE5hbWUoZmlsZUlkKSwgZmlsZUlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZChzcGVjLCBzKTtcbiAgICAgICAgc3BlYy5ldmVudFR5cGUgPSBcImNsaWNrXCI7XG4gICAgICAgIHNwZWMub25IYW5kbGVkID0gZXhhbWluZUV2ZW50O1xuICAgICAgICBzcGVjLmF0dGFjaFRvID0gc3BlYy50ZW1wbGF0aW5nLmdldEZpbGVMaXN0KCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuVWlFdmVudEhhbmRsZXIoc3BlYywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpKTtcbiAgICB9O1xuICAgIHFxLkZpbGVuYW1lQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24ocykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGluaGVyaXRlZEludGVybmFsQXBpID0ge30sIHNwZWMgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0aW5nOiBudWxsLFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHt9LFxuICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgIGZpbGU6IFwicXEtdXBsb2FkLWZpbGVcIixcbiAgICAgICAgICAgICAgICBlZGl0TmFtZUljb246IFwicXEtZWRpdC1maWxlbmFtZS1pY29uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkdldFVwbG9hZFN0YXR1czogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uR2V0TmFtZTogZnVuY3Rpb24oZmlsZUlkKSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQoc3BlYywgcyk7XG4gICAgICAgIGZ1bmN0aW9uIGV4YW1pbmVFdmVudCh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoc3BlYy50ZW1wbGF0aW5nLmlzRmlsZU5hbWUodGFyZ2V0KSB8fCBzcGVjLnRlbXBsYXRpbmcuaXNFZGl0SWNvbih0YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVJZCA9IHNwZWMudGVtcGxhdGluZy5nZXRGaWxlSWQodGFyZ2V0KSwgc3RhdHVzID0gc3BlYy5vbkdldFVwbG9hZFN0YXR1cyhmaWxlSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IHFxLnN0YXR1cy5TVUJNSVRURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BlYy5sb2cocXEuZm9ybWF0KFwiRGV0ZWN0ZWQgdmFsaWQgZmlsZW5hbWUgY2xpY2sgZXZlbnQgb24gZmlsZSAne30nLCBJRDoge30uXCIsIHNwZWMub25HZXROYW1lKGZpbGVJZCksIGZpbGVJZCkpO1xuICAgICAgICAgICAgICAgICAgICBxcS5wcmV2ZW50RGVmYXVsdChldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIGluaGVyaXRlZEludGVybmFsQXBpLmhhbmRsZUZpbGVuYW1lRWRpdChmaWxlSWQsIHRhcmdldCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNwZWMuZXZlbnRUeXBlID0gXCJjbGlja1wiO1xuICAgICAgICBzcGVjLm9uSGFuZGxlZCA9IGV4YW1pbmVFdmVudDtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5GaWxlbmFtZUVkaXRIYW5kbGVyKHNwZWMsIGluaGVyaXRlZEludGVybmFsQXBpKSk7XG4gICAgfTtcbiAgICBxcS5GaWxlbmFtZUlucHV0Rm9jdXNJbkhhbmRsZXIgPSBmdW5jdGlvbihzLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNwZWMgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0aW5nOiBudWxsLFxuICAgICAgICAgICAgb25HZXRVcGxvYWRTdGF0dXM6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge31cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCFpbmhlcml0ZWRJbnRlcm5hbEFwaSkge1xuICAgICAgICAgICAgaW5oZXJpdGVkSW50ZXJuYWxBcGkgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVJbnB1dEZvY3VzKHRhcmdldCwgZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChzcGVjLnRlbXBsYXRpbmcuaXNFZGl0SW5wdXQodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlSWQgPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RmlsZUlkKHRhcmdldCksIHN0YXR1cyA9IHNwZWMub25HZXRVcGxvYWRTdGF0dXMoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBxcS5zdGF0dXMuU1VCTUlUVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwZWMubG9nKHFxLmZvcm1hdChcIkRldGVjdGVkIHZhbGlkIGZpbGVuYW1lIGlucHV0IGZvY3VzIGV2ZW50IG9uIGZpbGUgJ3t9JywgSUQ6IHt9LlwiLCBzcGVjLm9uR2V0TmFtZShmaWxlSWQpLCBmaWxlSWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaW5oZXJpdGVkSW50ZXJuYWxBcGkuaGFuZGxlRmlsZW5hbWVFZGl0KGZpbGVJZCwgdGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3BlYy5ldmVudFR5cGUgPSBcImZvY3VzaW5cIjtcbiAgICAgICAgc3BlYy5vbkhhbmRsZWQgPSBoYW5kbGVJbnB1dEZvY3VzO1xuICAgICAgICBxcS5leHRlbmQoc3BlYywgcyk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuRmlsZW5hbWVFZGl0SGFuZGxlcihzcGVjLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkpO1xuICAgIH07XG4gICAgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlciA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHNwZWMuZXZlbnRUeXBlID0gXCJmb2N1c1wiO1xuICAgICAgICBzcGVjLmF0dGFjaFRvID0gbnVsbDtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5GaWxlbmFtZUlucHV0Rm9jdXNJbkhhbmRsZXIoc3BlYywge30pKTtcbiAgICB9O1xuICAgIHFxLkZpbGVuYW1lRWRpdEhhbmRsZXIgPSBmdW5jdGlvbihzLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNwZWMgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0aW5nOiBudWxsLFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHt9LFxuICAgICAgICAgICAgb25HZXRVcGxvYWRTdGF0dXM6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvbkdldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvblNldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCwgbmV3TmFtZSkge30sXG4gICAgICAgICAgICBvbkVkaXRpbmdTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGZpbGVJZCwgaXNFZGl0aW5nKSB7fVxuICAgICAgICB9O1xuICAgICAgICBmdW5jdGlvbiBnZXRGaWxlbmFtZVNhbnNFeHRlbnNpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICB2YXIgZmlsZW5hbWVTYW5zRXh0ID0gc3BlYy5vbkdldE5hbWUoZmlsZUlkKSwgZXh0SWR4ID0gZmlsZW5hbWVTYW5zRXh0Lmxhc3RJbmRleE9mKFwiLlwiKTtcbiAgICAgICAgICAgIGlmIChleHRJZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgZmlsZW5hbWVTYW5zRXh0ID0gZmlsZW5hbWVTYW5zRXh0LnN1YnN0cigwLCBleHRJZHgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpbGVuYW1lU2Fuc0V4dDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRPcmlnaW5hbEV4dGVuc2lvbihmaWxlSWQpIHtcbiAgICAgICAgICAgIHZhciBvcmlnTmFtZSA9IHNwZWMub25HZXROYW1lKGZpbGVJZCk7XG4gICAgICAgICAgICByZXR1cm4gcXEuZ2V0RXh0ZW5zaW9uKG9yaWdOYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVOYW1lVXBkYXRlKG5ld0ZpbGVuYW1lSW5wdXRFbCwgZmlsZUlkKSB7XG4gICAgICAgICAgICB2YXIgbmV3TmFtZSA9IG5ld0ZpbGVuYW1lSW5wdXRFbC52YWx1ZSwgb3JpZ0V4dGVuc2lvbjtcbiAgICAgICAgICAgIGlmIChuZXdOYW1lICE9PSB1bmRlZmluZWQgJiYgcXEudHJpbVN0cihuZXdOYW1lKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgb3JpZ0V4dGVuc2lvbiA9IGdldE9yaWdpbmFsRXh0ZW5zaW9uKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgaWYgKG9yaWdFeHRlbnNpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdOYW1lID0gbmV3TmFtZSArIFwiLlwiICsgb3JpZ0V4dGVuc2lvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3BlYy5vblNldE5hbWUoZmlsZUlkLCBuZXdOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNwZWMub25FZGl0aW5nU3RhdHVzQ2hhbmdlKGZpbGVJZCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVySW5wdXRCbHVySGFuZGxlcihpbnB1dEVsLCBmaWxlSWQpIHtcbiAgICAgICAgICAgIGluaGVyaXRlZEludGVybmFsQXBpLmdldERpc3Bvc2VTdXBwb3J0KCkuYXR0YWNoKGlucHV0RWwsIFwiYmx1clwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVOYW1lVXBkYXRlKGlucHV0RWwsIGZpbGVJZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlcklucHV0RW50ZXJLZXlIYW5kbGVyKGlucHV0RWwsIGZpbGVJZCkge1xuICAgICAgICAgICAgaW5oZXJpdGVkSW50ZXJuYWxBcGkuZ2V0RGlzcG9zZVN1cHBvcnQoKS5hdHRhY2goaW5wdXRFbCwgXCJrZXl1cFwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaDtcbiAgICAgICAgICAgICAgICBpZiAoY29kZSA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTmFtZVVwZGF0ZShpbnB1dEVsLCBmaWxlSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZChzcGVjLCBzKTtcbiAgICAgICAgc3BlYy5hdHRhY2hUbyA9IHNwZWMudGVtcGxhdGluZy5nZXRGaWxlTGlzdCgpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLlVpRXZlbnRIYW5kbGVyKHNwZWMsIGluaGVyaXRlZEludGVybmFsQXBpKSk7XG4gICAgICAgIHFxLmV4dGVuZChpbmhlcml0ZWRJbnRlcm5hbEFwaSwge1xuICAgICAgICAgICAgaGFuZGxlRmlsZW5hbWVFZGl0OiBmdW5jdGlvbihpZCwgdGFyZ2V0LCBmb2N1c0lucHV0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0ZpbGVuYW1lSW5wdXRFbCA9IHNwZWMudGVtcGxhdGluZy5nZXRFZGl0SW5wdXQoaWQpO1xuICAgICAgICAgICAgICAgIHNwZWMub25FZGl0aW5nU3RhdHVzQ2hhbmdlKGlkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBuZXdGaWxlbmFtZUlucHV0RWwudmFsdWUgPSBnZXRGaWxlbmFtZVNhbnNFeHRlbnNpb24oaWQpO1xuICAgICAgICAgICAgICAgIGlmIChmb2N1c0lucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0ZpbGVuYW1lSW5wdXRFbC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZWdpc3RlcklucHV0Qmx1ckhhbmRsZXIobmV3RmlsZW5hbWVJbnB1dEVsLCBpZCk7XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJJbnB1dEVudGVyS2V5SGFuZGxlcihuZXdGaWxlbmFtZUlucHV0RWwsIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn0pKHdpbmRvdyk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1maW5lLXVwbG9hZGVyLmpzLm1hcFxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlci5qc1xuLy8gbW9kdWxlIGlkID0gMTlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIi4uL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlclwiKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9maW5lLXVwbG9hZGVyL2xpYi90cmFkaXRpb25hbC5qc1xuLy8gbW9kdWxlIGlkID0gMjBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiIWZ1bmN0aW9uKGYpe2lmKFwib2JqZWN0XCI9PXR5cGVvZiBleHBvcnRzJiZcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlKW1vZHVsZS5leHBvcnRzPWYoKTtlbHNlIGlmKFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZClkZWZpbmUoW10sZik7ZWxzZXsoXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6XCJ1bmRlZmluZWRcIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6XCJ1bmRlZmluZWRcIiE9dHlwZW9mIHNlbGY/c2VsZjp0aGlzKS5NZXRlb3JFbW9qaT1mKCl9fShmdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobnx8ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9Zm9yKHZhciBpPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXshZnVuY3Rpb24oZ2xvYmFsLGZhY3Rvcnkpe2lmKHZvaWQgMCE9PWV4cG9ydHMpZmFjdG9yeShtb2R1bGUpO2Vsc2V7dmFyIG1vZD17ZXhwb3J0czp7fX07ZmFjdG9yeShtb2QpLGdsb2JhbC5tZXRlb3JFbW9qaT1tb2QuZXhwb3J0c319KHRoaXMsZnVuY3Rpb24obW9kdWxlKXtcInVzZSBzdHJpY3RcIjt2YXIgX2NyZWF0ZUNsYXNzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQscHJvcHMpe2Zvcih2YXIgaT0wO2k8cHJvcHMubGVuZ3RoO2krKyl7dmFyIGRlc2NyaXB0b3I9cHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlPWRlc2NyaXB0b3IuZW51bWVyYWJsZXx8ITEsZGVzY3JpcHRvci5jb25maWd1cmFibGU9ITAsXCJ2YWx1ZVwiaW4gZGVzY3JpcHRvciYmKGRlc2NyaXB0b3Iud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsZGVzY3JpcHRvci5rZXksZGVzY3JpcHRvcil9fXJldHVybiBmdW5jdGlvbihDb25zdHJ1Y3Rvcixwcm90b1Byb3BzLHN0YXRpY1Byb3BzKXtyZXR1cm4gcHJvdG9Qcm9wcyYmZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUscHJvdG9Qcm9wcyksc3RhdGljUHJvcHMmJmRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3Isc3RhdGljUHJvcHMpLENvbnN0cnVjdG9yfX0oKSxNZXRlb3JFbW9qaT1mdW5jdGlvbigpe2Z1bmN0aW9uIE1ldGVvckVtb2ppKCl7IWZ1bmN0aW9uKGluc3RhbmNlLENvbnN0cnVjdG9yKXtpZighKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKXRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIil9KHRoaXMsTWV0ZW9yRW1vamkpLHRoaXMuaW5pdGlhdGUoKX1yZXR1cm4gX2NyZWF0ZUNsYXNzKE1ldGVvckVtb2ppLFt7a2V5OlwiaW5pdGlhdGVcIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBfdGhpcz10aGlzO2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLW1ldGVvci1lbW9qaT1cInRydWVcIl0sIFtkYXRhLW1ldGVvci1lbW9qaS1sYXJnZT1cInRydWVcIl0nKS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpe190aGlzLmdlbmVyYXRlRWxlbWVudHMoZWxlbWVudCl9KX19LHtrZXk6XCJnZW5lcmF0ZUVsZW1lbnRzXCIsdmFsdWU6ZnVuY3Rpb24oZW1vamlJbnB1dCl7dmFyIGNsaWNrTGluaz1mdW5jdGlvbihldmVudCl7dmFyIGNhcmV0UG9zPWVtb2ppSW5wdXQuc2VsZWN0aW9uU3RhcnQ7ZW1vamlJbnB1dC52YWx1ZT1lbW9qaUlucHV0LnZhbHVlLnN1YnN0cmluZygwLGNhcmV0UG9zKStcIiBcIitldmVudC50YXJnZXQuaW5uZXJIVE1MK2Vtb2ppSW5wdXQudmFsdWUuc3Vic3RyaW5nKGNhcmV0UG9zKSxlbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIixcInVuZGVmaW5lZFwiIT10eXBlb2YgYW5ndWxhciYmYW5ndWxhci5lbGVtZW50KGVtb2ppSW5wdXQpLnRyaWdnZXJIYW5kbGVyKFwiY2hhbmdlXCIpfSxjbGlja0NhdGVnb3J5PWZ1bmN0aW9uKGV2ZW50KXtlbW9qaUlucHV0LnNlbGVjdGlvblN0YXJ0O2Vtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXk9XCJibG9ja1wiO2Zvcih2YXIgaGlkZVVscz1lbW9qaVBpY2tlci5xdWVyeVNlbGVjdG9yQWxsKFwidWxcIiksaT0xLGw9aGlkZVVscy5sZW5ndGg7aTxsO2krKyloaWRlVWxzW2ldLnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIGJhY2tncm91bmRUb2dnbGU9ZW1vamlQaWNrZXIucXVlcnlTZWxlY3RvckFsbChcIi5jYXRlZ29yeSBhXCIpO2ZvcihpPTAsbD1iYWNrZ3JvdW5kVG9nZ2xlLmxlbmd0aDtpPGw7aSsrKWJhY2tncm91bmRUb2dnbGVbaV0uc3R5bGUuYmFja2dyb3VuZD1cIm5vbmVcIjtlbW9qaVBpY2tlci5xdWVyeVNlbGVjdG9yKFwiLlwiK2V2ZW50LnRhcmdldC5pZCkuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsZW1vamlQaWNrZXIucXVlcnlTZWxlY3RvcihcIiNcIitldmVudC50YXJnZXQuaWQpLnN0eWxlLmJhY2tncm91bmQ9XCIjYzJjMmMyXCJ9O2Vtb2ppSW5wdXQuc3R5bGUud2lkdGg9XCIxMDAlXCI7dmFyIGVtb2ppQ29udGFpbmVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7ZW1vamlDb250YWluZXIuc3R5bGUucG9zaXRpb249XCJyZWxhdGl2ZVwiLGVtb2ppSW5wdXQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoZW1vamlDb250YWluZXIsZW1vamlJbnB1dCksZW1vamlDb250YWluZXIuYXBwZW5kQ2hpbGQoZW1vamlJbnB1dCk7dmFyIGVtb2ppUGlja2VyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7ZW1vamlQaWNrZXIudGFiSW5kZXg9MCxlbW9qaUlucHV0Lmhhc0F0dHJpYnV0ZShcImRhdGEtbWV0ZW9yLWVtb2ppLWxhcmdlXCIpPyhlbW9qaVBpY2tlci5zdHlsZS56SW5kZXg9XCI5OTlcIixlbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIixlbW9qaVBpY2tlci5zdHlsZS53aWR0aD1cIjEwMCVcIixlbW9qaVBpY2tlci5zdHlsZS5tYXJnaW5Cb3R0b209XCIxNXB4XCIpOihlbW9qaVBpY2tlci5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsZW1vamlQaWNrZXIuc3R5bGUucmlnaHQ9XCIwcHhcIixlbW9qaVBpY2tlci5zdHlsZS50b3A9XCIzMHB4XCIsZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT1cIm5vbmVcIixlbW9qaVBpY2tlci5zdHlsZS53aWR0aD1cIjQwMHB4XCIpLGVtb2ppUGlja2VyLnN0eWxlLnpJbmRleD1cIjk5OVwiLGVtb2ppUGlja2VyLnN0eWxlLm92ZXJmbG93PVwiaGlkZGVuXCIsZW1vamlQaWNrZXIuc3R5bGUuYmFja2dyb3VuZD1cIiNmZmZcIixlbW9qaVBpY2tlci5zdHlsZS5ib3JkZXJSYWRpdXM9XCI1cHhcIixlbW9qaVBpY2tlci5zdHlsZS5ib3hTaGFkb3c9XCIwIDNweCA2cHggcmdiYSgwLDAsMCwwLjE2KSwgMCAzcHggNnB4IHJnYmEoMCwwLDAsMC4yMylcIixlbW9qaVBpY2tlci5zdHlsZS5ib3JkZXJSYWRpdXM9XCIycHg7XCIsZW1vamlQaWNrZXIuc3R5bGUubWFyZ2luVG9wPVwiNXB4XCIsZW1vamlQaWNrZXIuc3R5bGUub3V0bGluZT1cIm5vbmVcIjt2YXIgZW1vamlUcmlnZ2VyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppVHJpZ2dlci5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsZW1vamlUcmlnZ2VyLnN0eWxlLnRvcD1cIjEwcHhcIixlbW9qaVRyaWdnZXIuc3R5bGUucmlnaHQ9XCIxMHB4XCIsZW1vamlUcmlnZ2VyLnN0eWxlLnRleHREZWNvcmF0aW9uPVwibm9uZVwiLGVtb2ppVHJpZ2dlci5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCJqYXZhc2NyaXB0OnZvaWQoMClcIiksZW1vamlUcmlnZ2VyLmlubmVySFRNTD0nPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCIgdmlld0JveD1cIjAgMCAxMiAxNFwiPjxwYXRoIGQ9XCJNOC45IDguNHEtMC4zIDAuOS0xLjEgMS41dC0xLjggMC42LTEuOC0wLjYtMS4xLTEuNXEtMC4xLTAuMiAwLTAuNHQwLjMtMC4ycTAuMi0wLjEgMC40IDB0MC4yIDAuM3EwLjIgMC42IDAuNyAxdDEuMiAwLjQgMS4yLTAuNCAwLjctMXEwLjEtMC4yIDAuMy0wLjN0MC40IDAgMC4zIDAuMiAwIDAuNHpNNSA1cTAgMC40LTAuMyAwLjd0LTAuNyAwLjMtMC43LTAuMy0wLjMtMC43IDAuMy0wLjcgMC43LTAuMyAwLjcgMC4zIDAuMyAwLjd6TTkgNXEwIDAuNC0wLjMgMC43dC0wLjcgMC4zLTAuNy0wLjMtMC4zLTAuNyAwLjMtMC43IDAuNy0wLjMgMC43IDAuMyAwLjMgMC43ek0xMSA3cTAtMS0wLjQtMS45dC0xLjEtMS42LTEuNi0xLjEtMS45LTAuNC0xLjkgMC40LTEuNiAxLjEtMS4xIDEuNi0wLjQgMS45IDAuNCAxLjkgMS4xIDEuNiAxLjYgMS4xIDEuOSAwLjQgMS45LTAuNCAxLjYtMS4xIDEuMS0xLjYgMC40LTEuOXpNMTIgN3EwIDEuNi0wLjggM3QtMi4yIDIuMi0zIDAuOC0zLTAuOC0yLjItMi4yLTAuOC0zIDAuOC0zIDIuMi0yLjIgMy0wLjggMyAwLjggMi4yIDIuMiAwLjggM3pcIi8+PC9zdmc+JyxlbW9qaVRyaWdnZXIub25jbGljaz1mdW5jdGlvbigpe1wibm9uZVwiPT09ZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT9lbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIjpcImJsb2NrXCI9PT1lbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5JiYoZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT1cIm5vbmVcIiksZW1vamlQaWNrZXIuZm9jdXMoKX0sZW1vamlJbnB1dC5oYXNBdHRyaWJ1dGUoXCJkYXRhLW1ldGVvci1lbW9qaS1sYXJnZVwiKXx8ZW1vamlDb250YWluZXIuYXBwZW5kQ2hpbGQoZW1vamlUcmlnZ2VyKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsZnVuY3Rpb24oZSl7ZW1vamlJbnB1dC5oYXNBdHRyaWJ1dGUoXCJkYXRhLW1ldGVvci1lbW9qaS1sYXJnZVwiKXx8XCJibG9ja1wiPT09ZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheSYmKGVtb2ppUGlja2VyLmNvbnRhaW5zKGUudGFyZ2V0KXx8ZW1vamlUcmlnZ2VyLmNvbnRhaW5zKGUudGFyZ2V0KXx8KGVtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXk9XCJub25lXCIpKX0pO3ZhciBmYWNlc0NhdGVnb3J5PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTtmYWNlc0NhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIxMHB4IDBweFwiLGZhY2VzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLGZhY2VzQ2F0ZWdvcnkuc3R5bGUubGlzdFN0eWxlPVwibm9uZVwiLGZhY2VzQ2F0ZWdvcnkuc3R5bGUudGV4dEFsaWduPVwibGVmdFwiLGZhY2VzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsZmFjZXNDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKFwiZmFjZXNcIik7dmFyIGFuaW1hbHNDYXRlZ29yeT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7YW5pbWFsc0NhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIxMHB4IDBweFwiLGFuaW1hbHNDYXRlZ29yeS5zdHlsZS5tYXJnaW49XCIwXCIsYW5pbWFsc0NhdGVnb3J5LnN0eWxlLmxpc3RTdHlsZT1cIm5vbmVcIixhbmltYWxzQ2F0ZWdvcnkuc3R5bGUudGV4dEFsaWduPVwibGVmdFwiLGFuaW1hbHNDYXRlZ29yeS5zdHlsZS5tYXJnaW5MZWZ0PVwiMyVcIixhbmltYWxzQ2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcImFuaW1hbHNcIiksYW5pbWFsc0NhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIGZvb2RDYXRlZ29yeT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7Zm9vZENhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIxMHB4IDBweFwiLGZvb2RDYXRlZ29yeS5zdHlsZS5tYXJnaW49XCIwXCIsZm9vZENhdGVnb3J5LnN0eWxlLmxpc3RTdHlsZT1cIm5vbmVcIixmb29kQ2F0ZWdvcnkuc3R5bGUudGV4dEFsaWduPVwibGVmdFwiLGZvb2RDYXRlZ29yeS5zdHlsZS5tYXJnaW5MZWZ0PVwiMyVcIixmb29kQ2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcImZvb2RcIiksZm9vZENhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIHNwb3J0Q2F0ZWdvcnk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO3Nwb3J0Q2F0ZWdvcnkuc3R5bGUucGFkZGluZz1cIjEwcHggMHB4XCIsc3BvcnRDYXRlZ29yeS5zdHlsZS5tYXJnaW49XCIwXCIsc3BvcnRDYXRlZ29yeS5zdHlsZS5saXN0U3R5bGU9XCJub25lXCIsc3BvcnRDYXRlZ29yeS5zdHlsZS50ZXh0QWxpZ249XCJsZWZ0XCIsc3BvcnRDYXRlZ29yeS5zdHlsZS5tYXJnaW5MZWZ0PVwiMyVcIixzcG9ydENhdGVnb3J5LmNsYXNzTGlzdC5hZGQoXCJzcG9ydFwiKSxzcG9ydENhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIHRyYW5zcG9ydENhdGVnb3J5PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTt0cmFuc3BvcnRDYXRlZ29yeS5zdHlsZS5wYWRkaW5nPVwiMTBweCAwcHhcIix0cmFuc3BvcnRDYXRlZ29yeS5zdHlsZS5tYXJnaW49XCIwXCIsdHJhbnNwb3J0Q2F0ZWdvcnkuc3R5bGUubGlzdFN0eWxlPVwibm9uZVwiLHRyYW5zcG9ydENhdGVnb3J5LnN0eWxlLnRleHRBbGlnbj1cImxlZnRcIix0cmFuc3BvcnRDYXRlZ29yeS5zdHlsZS5tYXJnaW5MZWZ0PVwiMyVcIix0cmFuc3BvcnRDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKFwidHJhbnNwb3J0XCIpLHRyYW5zcG9ydENhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIG9iamVjdHNDYXRlZ29yeT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7b2JqZWN0c0NhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIxMHB4IDBweFwiLG9iamVjdHNDYXRlZ29yeS5zdHlsZS5tYXJnaW49XCIwXCIsb2JqZWN0c0NhdGVnb3J5LnN0eWxlLmxpc3RTdHlsZT1cIm5vbmVcIixvYmplY3RzQ2F0ZWdvcnkuc3R5bGUudGV4dEFsaWduPVwibGVmdFwiLG9iamVjdHNDYXRlZ29yeS5zdHlsZS5tYXJnaW5MZWZ0PVwiMyVcIixvYmplY3RzQ2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcIm9iamVjdHNcIiksb2JqZWN0c0NhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7dmFyIGVtb2ppQ2F0ZWdvcnk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO2Vtb2ppQ2F0ZWdvcnkuc3R5bGUucGFkZGluZz1cIjBweFwiLGVtb2ppQ2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLGVtb2ppQ2F0ZWdvcnkuc3R5bGUuZGlzcGxheT1cInRhYmxlXCIsZW1vamlDYXRlZ29yeS5zdHlsZS53aWR0aD1cIjEwMCVcIixlbW9qaUNhdGVnb3J5LnN0eWxlLmJhY2tncm91bmQ9XCIjZWZmMGYxXCIsZW1vamlDYXRlZ29yeS5zdHlsZS5saXN0U3R5bGU9XCJub25lXCIsZW1vamlDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKFwiY2F0ZWdvcnlcIik7dmFyIGVtb2ppQ2F0ZWdvcmllcz1uZXcgQXJyYXk7ZW1vamlDYXRlZ29yaWVzLnB1c2goe25hbWU6XCJmYWNlc1wiLHN2ZzonPHN2ZyBpZD1cImZhY2VzXCIgZGF0YS1uYW1lPVwiTGF5ZXIgMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDE1MCAxNTBcIj48cGF0aCBpZD1cImZhY2VzXCIgZD1cIk03NC4zNCwxMjguNDhhNTMuNSw1My41LDAsMSwxLDM3Ljg0LTE1LjY3LDUzLjE2LDUzLjE2LDAsMCwxLTM3Ljg0LDE1LjY3Wm0wLTk3Ljg5YTQ0LjQsNDQuNCwwLDEsMCwzMS40LDEzLDQ0LjA3LDQ0LjA3LDAsMCwwLTMxLjQtMTNaXCIvPjxwYXRoIGlkPVwiZmFjZXNcIiBkPVwiTTc0LjM1LDEwOEEzMy4wNywzMy4wNywwLDAsMSw0MS4yOSw3NWEyLjI4LDIuMjgsMCwwLDEsMi4yNy0yLjI4aDBBMi4yNywyLjI3LDAsMCwxLDQ1LjgzLDc1YTI4LjUyLDI4LjUyLDAsMCwwLDU3LDAsMi4yNywyLjI3LDAsMCwxLDQuNTQsMEEzMy4wOSwzMy4wOSwwLDAsMSw3NC4zNSwxMDhaXCIvPjxwYXRoIGlkPVwiZmFjZXNcIiBkPVwiTTU4Ljg0LDYyYTYuODEsNi44MSwwLDEsMCw2LjgxLDYuODFBNi44MSw2LjgxLDAsMCwwLDU4Ljg0LDYyWlwiLz48cGF0aCBpZD1cImZhY2VzXCIgZD1cIk04OS44Nyw2MmE2LjgxLDYuODEsMCwxLDAsNi44MSw2LjgxQTYuODIsNi44MiwwLDAsMCw4OS44Nyw2MlpcIi8+PC9zdmc+J30pLGVtb2ppQ2F0ZWdvcmllcy5wdXNoKHtuYW1lOlwiYW5pbWFsc1wiLHN2ZzonPHN2ZyBpZD1cImFuaW1hbHNcIiBkYXRhLW5hbWU9XCJMYXllciAxXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTUwIDE1MFwiPjxwYXRoIGlkPVwiYW5pbWFsc1wiIGQ9XCJNNTkuOSw5MS43NWgwYy0yMi40NiwwLTQxLjgyLTE5LjM0LTQ0LjA5LTQ0QTUyLjEsNTIuMSwwLDAsMSwxNiwzNi44YTQuNTEsNC41MSwwLDAsMSwyLjYzLTMuNjIsMzkuNzksMzkuNzksMCwwLDEsMTIuNzQtMy4zN2MyMy45Mi0yLjE1LDQ1LjM1LDE3LjgzLDQ3Ljc0LDQzLjg2YTUyLjc3LDUyLjc3LDAsMCwxLS4xNSwxMC45Myw0LjU2LDQuNTYsMCwwLDEtMi42NCwzLjYyLDM5LjY3LDM5LjY3LDAsMCwxLTEyLjczLDMuMzZjLTEuMjMuMTEtMi40NS4xNy0zLjY2LjE3Wk0yNC43Niw0MC40OWE0MS4yOSw0MS4yOSwwLDAsMCwuMDksNi40QzI2LjcsNjcsNDIuMDksODIuNjYsNTkuOSw4Mi42N2gwYy45NCwwLDEuODgsMCwyLjgzLS4xNGEzMC4zOSwzMC4zOSwwLDAsMCw3LjQxLTEuNjIsNDEuMTQsNDEuMTQsMCwwLDAtLjExLTYuNEM2OC4wOSw1My4zOCw1MS4xMSwzNy4wOCwzMi4xNywzOC44NmEzMC43OCwzMC43OCwwLDAsMC03LjQxLDEuNjNaXCIvPjxwYXRoIGlkPVwiYW5pbWFsc1wiIGQ9XCJNMzYuNjgsMTI1LjY0YTQuNTMsNC41MywwLDAsMS00LjMzLTMuMTcsNTMuMzIsNTMuMzIsMCwwLDEtMi4yNi0xMUE1MC40Miw1MC40MiwwLDAsMSwzOS41MSw3Ni42YzcuMzUtOS45MSwxNy44NC0xNiwyOS41LTE3LDEuMTYtLjExLDIuMzMtLjEzLDMuNDctLjEzYTQuNTQsNC41NCwwLDAsMSw0LjMzLDMuMTYsNTEuNTksNTEuNTksMCwwLDEsMi4yNywxMS4wOCw1MC4zOSw1MC4zOSwwLDAsMS05LjQyLDM0LjhjLTcuMzUsOS45MS0xNy44MywxNi0yOS41LDE3YTE3LjYzLDE3LjYzLDAsMCwxLTMuNDguMTJaTTY5LjA5LDY4LjY5QTMyLjQxLDMyLjQxLDAsMCwwLDQ2LjgsODJhNDIuNTcsNDIuNTcsMCwwLDAtNi43MSwzNC4zOCwzMi4zOCwzMi4zOCwwLDAsMCwyMi4yOC0xMy4zMkE0MS4zNSw0MS4zNSwwLDAsMCw3MCw3NC41MWEzOS4zOCwzOS4zOCwwLDAsMC0uOTQtNS44MlpcIi8+PHBhdGggaWQ9XCJhbmltYWxzXCIgZD1cIk05MC4yNyw5MS43NWMtMS4yMiwwLTIuNDMtLjA2LTMuNjYtLjE3YTM5LjY3LDM5LjY3LDAsMCwxLTEyLjczLTMuMzYsNC41Nyw0LjU3LDAsMCwxLTIuNjQtMy42MSw1My4zOCw1My4zOCwwLDAsMS0uMTctMTAuOTNjMi40MS0yNiwyMy43LTQ2LjA3LDQ3Ljc2LTQzLjg3YTM5Ljc0LDM5Ljc0LDAsMCwxLDEyLjczLDMuMzcsNC41Nyw0LjU3LDAsMCwxLDIuNjQsMy42Miw1My4zNSw1My4zNSwwLDAsMSwuMTYsMTAuOTJjLTIuMjgsMjQuNjktMjEuNjUsNDQtNDQuMDksNDRaTTgwLDgwLjkxYTMwLjU3LDMwLjU3LDAsMCwwLDcuNDIsMS42MmMxOS4wNywxLjc4LDM1LjkyLTE0LjUzLDM3Ljg3LTM1LjY0YTQyLjU1LDQyLjU1LDAsMCwwLC4xLTYuNEEzMC44NiwzMC44NiwwLDAsMCwxMTgsMzguODZDOTksMzcuMDcsODIuMDYsNTMuMzgsODAuMTIsNzQuNTFhNDMuOTEsNDMuOTEsMCwwLDAtLjEsNi40WlwiLz48cGF0aCBpZD1cImFuaW1hbHNcIiBkPVwiTTExMy40OSwxMjUuNjRoMGMtMS4xNiwwLTIuMywwLTMuNDYtLjEyLTIzLjktMi4yMS00MS4zNi0yNS40Ny0zOC45NC01MS44NUE1My41Miw1My41MiwwLDAsMSw3My4zNCw2Mi42YTQuNTUsNC41NSwwLDAsMSw0LjMzLTMuMTZjMS4xNiwwLDIuMzQsMCwzLjUxLjEzLDExLjY0LDEuMDcsMjIuMTEsNy4xMiwyOS40OCwxN2E1MC41MSw1MC41MSwwLDAsMSw5LjQyLDM0LjgxLDUzLjUxLDUzLjUxLDAsMCwxLTIuMjYsMTEsNC41NCw0LjU0LDAsMCwxLTQuMzMsMy4xOVpNODEuMDgsNjguNjlhNDIuNTMsNDIuNTMsMCwwLDAtMSw1LjgyYy0xLjk0LDIxLjEsMTEuNDUsMzkuNzEsMjkuOTUsNDEuODhBNDIuMzgsNDIuMzgsMCwwLDAsMTAzLjM2LDgyLDMyLjQyLDMyLjQyLDAsMCwwLDgxLjA4LDY4LjY5WlwiLz48cGF0aCBpZD1cImFuaW1hbHNcIiBkPVwiTTc1LjA4LDQ1LjQ1YTcuODMsNy44MywwLDEsMCw3LjgzLDcuODMsNy44Myw3LjgzLDAsMCwwLTcuODMtNy44M1pcIi8+PHBhdGggaWQ9XCJhbmltYWxzXCIgZD1cIk03Ni4yOSw1MS44OWEyLjI2LDIuMjYsMCwwLDEtMi4xNC0zQTQ2LDQ2LDAsMCwxLDkyLjgyLDI1LjM0YTIuMjcsMi4yNywwLDEsMSwyLjQsMy44NkE0MS40LDQxLjQsMCwwLDAsNzguNDMsNTAuMzlhMi4yOCwyLjI4LDAsMCwxLTIuMTQsMS41WlwiLz48cGF0aCBpZD1cImFuaW1hbHNcIiBkPVwiTTczLjg3LDUxLjg5YTIuMjgsMi4yOCwwLDAsMS0yLjE0LTEuNUE0MS4zNSw0MS4zNSwwLDAsMCw1NC45NCwyOS4yYTIuMjcsMi4yNywwLDAsMSwyLjM5LTMuODZBNDYsNDYsMCwwLDEsNzYsNDguODVhMi4yOCwyLjI4LDAsMCwxLTEuMzcsMi45MSwyLjMxLDIuMzEsMCwwLDEtLjc3LjEzWlwiLz48L3N2Zz4nfSksZW1vamlDYXRlZ29yaWVzLnB1c2goe25hbWU6XCJmb29kXCIsc3ZnOic8c3ZnIGlkPVwiZm9vZFwiIGRhdGEtbmFtZT1cIkxheWVyIDFcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCIgdmlld0JveD1cIjAgMCAxNTAgMTUwXCI+PHBhdGggaWQ9XCJmb29kXCIgZD1cIk0xMDQsMjAuNzZoLjE1YzE1LjgzLjUyLDI0LjA4LDIxLjQ4LDI0LjA3LDMyLjU2LjI2LDEyLjQyLTEwLjcyLDIzLjU1LTI0LDI0LjIxYTMuNTMsMy41MywwLDAsMS0uNDYsMGMtMTMuMjUtLjY2LTI0LjIzLTExLjgtMjQtMjQuMywwLTExLDguMjYtMzEuOTUsMjQuMDctMzIuNDdabTAsNDcuNjljOC4yNS0uNTQsMTUuMy03LjUxLDE1LjE0LTE1LDAtOC4xMi02LjIyLTIzLjEtMTUuMTQtMjMuNTctOC45LjQ2LTE1LjE0LDE1LjQ1LTE1LjE0LDIzLjQ4LS4xNCw3LjYxLDYuOSwxNC41OSwxNS4xNCwxNS4xM1pcIi8+PHBhdGggaWQ9XCJmb29kXCIgZD1cIk05Ny4xOSw2OS4yMWguMTRhNC41Myw0LjUzLDAsMCwxLDQuNCw0LjY4bC0xLjQ4LDQ2LjkyYTEuNTksMS41OSwwLDAsMCwuNSwxLjA2LDQuNiw0LjYsMCwwLDAsMy4yNSwxLjE5aDBhNC41Nyw0LjU3LDAsMCwwLDMuMjYtMS4yLDEuNTMsMS41MywwLDAsMCwuNDktMWwtMS40OC00Ni45NWE0LjU0LDQuNTQsMCwxLDEsOS4wOC0uMjhsMS40Nyw0Ni45MWExMC40MiwxMC40MiwwLDAsMS0zLDcuNjUsMTMuNjUsMTMuNjUsMCwwLDEtOS44MSw0aDBhMTMuNTgsMTMuNTgsMCwwLDEtOS43OS00LDEwLjQyLDEwLjQyLDAsMCwxLTMtNy42N2wxLjQ4LTQ2Ljg5YTQuNTMsNC41MywwLDAsMSw0LjUzLTQuNFpcIi8+PHBhdGggaWQ9XCJmb29kXCIgZD1cIk00MS44NCw2OS4yMUg0MmE0LjUzLDQuNTMsMCwwLDEsNC40LDQuNjhMNDQuOSwxMjAuODFhMS41NywxLjU3LDAsMCwwLC41LDEuMDYsNC42LDQuNiwwLDAsMCwzLjI1LDEuMTloMGE0LjUxLDQuNTEsMCwwLDAsMy4yNC0xLjE5LDEuNDgsMS40OCwwLDAsMCwuNS0xTDUwLjkzLDczLjg5YTQuNTMsNC41MywwLDAsMSw0LjM5LTQuNjhBNC40LDQuNCwwLDAsMSw2MCw3My42MWwxLjQ4LDQ2LjkxYTEwLjQ5LDEwLjQ5LDAsMCwxLTMsNy42NiwxMy41NywxMy41NywwLDAsMS05Ljc4LDRoMGExMy41OSwxMy41OSwwLDAsMS05Ljc4LTQsMTAuNDgsMTAuNDgsMCwwLDEtMy03LjY3bDEuNDgtNDYuOWE0LjU0LDQuNTQsMCwwLDEsNC41NC00LjRaXCIvPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNMjguNTksMjAuNzZhNC41NCw0LjU0LDAsMCwxLDQuNTQsNC41NFY1MWExNS41MiwxNS41MiwwLDAsMCwzMSwwVjI1LjNhNC41NSw0LjU1LDAsMCwxLDkuMDksMFY1MWEyNC42MSwyNC42MSwwLDEsMS00OS4yMSwwVjI1LjNhNC41NCw0LjU0LDAsMCwxLDQuNTQtNC41NFpcIi8+PHBhdGggaWQ9XCJmb29kXCIgZD1cIk01NS4zNCwyMC43NmE0LjU0LDQuNTQsMCwwLDEsNC41NCw0LjU0djE5YTQuNTQsNC41NCwwLDEsMS05LjA4LDB2LTE5YTQuNTQsNC41NCwwLDAsMSw0LjU0LTQuNTRaXCIvPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNNDIsMjAuNzZhNC41NCw0LjU0LDAsMCwxLDQuNTQsNC41NHYxOWE0LjU0LDQuNTQsMCwxLDEtOS4wOCwwdi0xOUE0LjU0LDQuNTQsMCwwLDEsNDIsMjAuNzZaXCIvPjwvc3ZnPid9KSxlbW9qaUNhdGVnb3JpZXMucHVzaCh7bmFtZTpcInNwb3J0XCIsc3ZnOic8c3ZnIGlkPVwic3BvcnRcIiBkYXRhLW5hbWU9XCJMYXllciAxXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTUwIDE1MFwiPjxwYXRoIGlkPVwic3BvcnRcIiBkPVwiTTc1LjM1LDEzMC4yNGE1My40OSw1My40OSwwLDEsMSw1My40OC01My40OSw1My41NSw1My41NSwwLDAsMS01My40OCw1My40OVptMC05Ny44OWE0NC40MSw0NC40MSwwLDEsMCw0NC40LDQ0LjQsNDQuMSw0NC4xLDAsMCwwLTQ0LjQtNDQuNFpcIi8+PHBhdGggaWQ9XCJzcG9ydFwiIGQ9XCJNMTE5LjI0LDg0LjA4QTUxLjI5LDUxLjI5LDAsMCwxLDY4LDMyLjg2YTQ5LjQ0LDQ5LjQ0LDAsMCwxLC4yNi01LDIuMjYsMi4yNiwwLDAsMSwyLTJjMS42Ni0uMTYsMy4zNC0uMjUsNS0uMjVhNTEuMjYsNTEuMjYsMCwwLDEsNTEuMjEsNTEuMjFjMCwxLjcxLS4wOSwzLjM4LS4yNSw1YTIuMjgsMi4yOCwwLDAsMS0yLDJjLTEuNjUuMTYtMy4zMy4yNS01LC4yNVpNNzIuNjQsMzAuMTZjLS4wNi45LS4wOCwxLjc5LS4wOCwyLjdhNDYuNzMsNDYuNzMsMCwwLDAsNDYuNjgsNDYuNjhxMS4zNywwLDIuNy0uMDljLjA2LS44OS4wOC0xLjc5LjA4LTIuN0E0Ni43Miw0Ni43MiwwLDAsMCw3NS4zNSwzMC4wOGMtLjkxLDAtMS44MiwwLTIuNzEuMDhaXCIvPjxwYXRoIGlkPVwic3BvcnRcIiBkPVwiTTc1LjM1LDEyOEE1MS4yOCw1MS4yOCwwLDAsMSwyNC4xMiw3Ni43NmMwLTEuNy4xLTMuMzguMjUtNWEyLjI5LDIuMjksMCwwLDEsMi0yYzEuNjYtLjE2LDMuMzMtLjI1LDUuMDUtLjI1YTUxLjI3LDUxLjI3LDAsMCwxLDUxLjIxLDUxLjIyYzAsMS42OS0uMDksMy4zNy0uMjUsNWEyLjI3LDIuMjcsMCwwLDEtMiwyYy0xLjY2LjE2LTMuMzIuMjUtNSwuMjVaTTI4Ljc1LDc0LjA1Yy0uMDUuOS0uMDksMS44LS4wOSwyLjcxYTQ2Ljc0LDQ2Ljc0LDAsMCwwLDQ2LjY5LDQ2LjY3Yy45MSwwLDEuOCwwLDIuNy0uMDgsMC0uOS4wOC0xLjguMDgtMi43QTQ2LjczLDQ2LjczLDAsMCwwLDMxLjQ2LDc0Yy0uOTEsMC0xLjgxLDAtMi43MS4wOFpcIi8+PHBvbHlnb24gaWQ9XCJzcG9ydFwiIHBvaW50cz1cIjQyLjY5IDExMi42MSAzOS40OCAxMDkuNCAxMDggNDAuODggMTExLjIxIDQ0LjEgNDIuNjkgMTEyLjYxIDQyLjY5IDExMi42MVwiLz48L3N2Zz4nfSksZW1vamlDYXRlZ29yaWVzLnB1c2goe25hbWU6XCJ0cmFuc3BvcnRcIixzdmc6JzxzdmcgaWQ9XCJ0cmFuc3BvcnRcIiBkYXRhLW5hbWU9XCJMYXllciAxXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTUwIDE1MFwiPjxwYXRoIGlkPVwidHJhbnNwb3J0XCIgZD1cIk0xMjAuNywxMTZIMzFhNC41NSw0LjU1LDAsMCwxLTQuNTQtNC41NVY1NC4yOEEzMS44MiwzMS44MiwwLDAsMSw1OC4yNSwyMi40OWgzNS4yYTMxLjgzLDMxLjgzLDAsMCwxLDMxLjgsMzEuNzl2NTcuMTVBNC41NSw0LjU1LDAsMCwxLDEyMC43LDExNlptLTg1LjE2LTkuMDloODAuNjJWNTQuMjhBMjIuNzQsMjIuNzQsMCwwLDAsOTMuNDUsMzEuNTdINTguMjVBMjIuNzQsMjIuNzQsMCwwLDAsMzUuNTQsNTQuMjh2NTIuNjFaXCIvPjxwYXRoIGlkPVwidHJhbnNwb3J0XCIgZD1cIk00OS4zNSwxMjkuMjNjLTguNTMsMC0xMy42Mi0yLjc3LTEzLjYyLTcuNDFWMTE1LjZhNC41NCw0LjU0LDAsMSwxLDkuMDgsMHY0LjA2YTIxLjMyLDIxLjMyLDAsMCwwLDkuMDksMFYxMTUuNmE0LjU0LDQuNTQsMCwwLDEsOS4wOCwwdjYuMjJjMCw0LjY0LTUuMDksNy40MS0xMy42Myw3LjQxWlwiLz48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNMTAyLjM0LDEyOS4yM2MtOC41MywwLTEzLjYyLTIuNzctMTMuNjItNy40MVYxMTUuNmE0LjU0LDQuNTQsMCwwLDEsOS4wOCwwdjQuMDZhMjEuMjgsMjEuMjgsMCwwLDAsOS4wOCwwVjExNS42YTQuNTUsNC41NSwwLDAsMSw5LjA5LDB2Ni4yMmMwLDQuNjQtNS4wOSw3LjQxLTEzLjYzLDcuNDFaXCIvPjxwYXRoIGlkPVwidHJhbnNwb3J0XCIgZD1cIk05Ny44MSw0NC44M0g1My45YTQuNTUsNC41NSwwLDEsMSwwLTkuMDlIOTcuODFhNC41NSw0LjU1LDAsMCwxLDAsOS4wOVpcIi8+PHBhdGggaWQ9XCJ0cmFuc3BvcnRcIiBkPVwiTTU0LjI4LDg0LjJBNi44LDYuOCwwLDEsMCw2MS4wNyw5MWE2LjgsNi44LDAsMCwwLTYuNzktNi44WlwiLz48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNOTcuNDMsODQuMmE2LjgsNi44LDAsMSwwLDYuNzksNi44LDYuOCw2LjgsMCwwLDAtNi43OS02LjhaXCIvPjxwYXRoIGlkPVwidHJhbnNwb3J0XCIgZD1cIk0xMDcuMDgsODFINDQuNjNhNi44Miw2LjgyLDAsMCwxLTYuODItNi44MlY1NC4yOGE2LjgyLDYuODIsMCwwLDEsNi44Mi02LjgxaDYyLjQ1YTYuODIsNi44MiwwLDAsMSw2LjgxLDYuODFWNzQuMTVBNi44Myw2LjgzLDAsMCwxLDEwNy4wOCw4MVpNNDQuNjMsNTJhMi4yOCwyLjI4LDAsMCwwLTIuMjgsMi4yN1Y3NC4xNWEyLjI4LDIuMjgsMCwwLDAsMi4yOCwyLjI3aDYyLjQ1YTIuMjcsMi4yNywwLDAsMCwyLjI3LTIuMjdWNTQuMjhBMi4yNywyLjI3LDAsMCwwLDEwNy4wOCw1MlpcIi8+PC9zdmc+J30pLGVtb2ppQ2F0ZWdvcmllcy5wdXNoKHtuYW1lOlwib2JqZWN0c1wiLHN2ZzonPHN2ZyBpZD1cIm9iamVjdHNcIiBkYXRhLW5hbWU9XCJMYXllciAxXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTUwIDE1MFwiPjxwYXRoIGlkPVwib2JqZWN0c1wiIGQ9XCJNMTA3Ljc4LDEyOWE0LjU1LDQuNTUsMCwwLDEtMi42Ny0uODdsLTMwLTIxLjc5LTMwLDIxLjc5YTQuNTMsNC41MywwLDAsMS01LjM0LDAsNC41OCw0LjU4LDAsMCwxLTEuNjUtNS4wOEw0OS41OSw4Ny44MiwxOS42LDY2YTQuNTQsNC41NCwwLDAsMSwyLjY3LTguMjJINTkuMzRMNzAuOCwyMi41NWE0LjU1LDQuNTUsMCwwLDEsOC42NCwwTDkwLjg5LDU3LjgxSDEyOEE0LjU0LDQuNTQsMCwwLDEsMTMwLjYzLDY2bC0zMCwyMS43OSwxMS40NiwzNS4yNWE0LjU1LDQuNTUsMCwwLDEtNC4zMiw2Wk03NS4xMiw5Ni4yYTQuNTMsNC41MywwLDAsMSwyLjY3Ljg3bDIxLjM1LDE1LjUxTDkxLDg3LjQ5YTQuNTUsNC41NSwwLDAsMSwxLjY1LTUuMDhMMTE0LDY2Ljg5SDg3LjU5YTQuNTQsNC41NCwwLDAsMS00LjMyLTMuMTNsLTguMTUtMjUuMUw2Nyw2My43NmE0LjUzLDQuNTMsMCwwLDEtNC4zMiwzLjEzSDM2LjI1TDU3LjYxLDgyLjQxYTQuNTQsNC41NCwwLDAsMSwxLjY1LDUuMDhsLTguMTcsMjUuMDlMNzIuNDUsOTcuMDdhNC41Myw0LjUzLDAsMCwxLDIuNjctLjg3WlwiLz48L3N2Zz4nfSk7ZW1vamlDYXRlZ29yaWVzLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUucGFkZGluZz1cIjVweFwiLGVtb2ppTGluay5zdHlsZS5wb3NpdGlvbj1cImluaXRpYWxcIixlbW9qaUxpbmsuc3R5bGUuZm9udFNpemU9XCIyNHB4XCIsZW1vamlMaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIixcImphdmFzY3JpcHQ6dm9pZCgwKVwiKSxlbW9qaUxpbmsuc3R5bGUuZGlzcGxheT1cInRhYmxlLWNlbGxcIixlbW9qaUxpbmsuc3R5bGUudGV4dEFsaWduPVwiY2VudGVyXCIsZW1vamlMaW5rLmlkPVN0cmluZyhpdGVtLm5hbWUpLFwiZmFjZXNcIj09U3RyaW5nKGl0ZW0ubmFtZSkmJihlbW9qaUxpbmsuc3R5bGUuYmFja2dyb3VuZD1cIiNjMmMyYzJcIiksZW1vamlMaW5rLmlubmVySFRNTD1TdHJpbmcoaXRlbS5zdmcpLGVtb2ppTGluay5vbm1vdXNlZG93bj1jbGlja0NhdGVnb3J5LGVtb2ppQ2F0ZWdvcnkuYXBwZW5kQ2hpbGQoZW1vamlMaW5rKX0pLFsxMjg1MTMsMTI4NTE0LDEyODUxNSwxMjg1MTYsMTI4NTE3LDEyODUxOCwxMjg1MjEsMTI4NTIyLDEyODUyMywxMjg1MjQsMTI4NTI1LDEyODUyNywxMjg1MzAsMTI4NTMxLDEyODUzMiwxMjg1MzQsMTI4NTM2LDEyODUzOCwxMjg1NDAsMTI4NTQxLDEyODU0MiwxMjg1NDQsMTI4NTQ1LDEyODU0NiwxMjg1NDcsMTI4NTQ4LDEyODU0OSwxMjg1NTIsMTI4NTUzLDEyODU1NCwxMjg1NTUsMTI4NTU3LDEyODU2MCwxMjg1NjEsMTI4NTYyLDEyODU2MywxMjg1NjUsMTI4NTY3XS5tYXAoZnVuY3Rpb24oaXRlbSl7dmFyIGVtb2ppTGluaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaUxpbmsuc3R5bGUudGV4dERlY29yYXRpb249XCJub25lXCIsZW1vamlMaW5rLnN0eWxlLm1hcmdpbj1cIjVweFwiLGVtb2ppTGluay5zdHlsZS5wb3NpdGlvbj1cImluaXRpYWxcIixlbW9qaUxpbmsuc3R5bGUuZm9udFNpemU9XCIyNHB4XCIsZW1vamlMaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIixcImphdmFzY3JpcHQ6dm9pZCgwKVwiKSxlbW9qaUxpbmsuaW5uZXJIVE1MPVN0cmluZy5mcm9tQ29kZVBvaW50KGl0ZW0pLGVtb2ppTGluay5vbm1vdXNlZG93bj1jbGlja0xpbmssZmFjZXNDYXRlZ29yeS5hcHBlbmRDaGlsZChlbW9qaUxpbmspfSksWzEyODAxMiwxMjgwMTMsMTI4MDE0LDEyODAxNywxMjgwMTgsMTI4MDIwLDEyODAyMywxMjgwMjQsMTI4MDI1LDEyODAyNiwxMjgwMjcsMTI4MDI4LDEyODAyOSwxMjgwMzAsMTI4MDMxLDEyODAzMiwxMjgwMzMsMTI4MDM0LDEyODAzNSwxMjgwMzYsMTI4MDM3LDEyODAzOCwxMjgwMzksMTI4MDQwLDEyODA0MSwxMjgwNDMsMTI4MDQ0LDEyODA0NSwxMjgwNDYsMTI4MDQ3LDEyODA0OCwxMjgwNDksMTI4MDUwLDEyODA1MSwxMjgwNTIsMTI4MDUzLDEyODA1NCwxMjgwNTUsMTI4MDU2LDEyODA1NywxMjgwNTgsMTI4MDU5LDEyODA2MF0ubWFwKGZ1bmN0aW9uKGl0ZW0pe3ZhciBlbW9qaUxpbms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7ZW1vamlMaW5rLnN0eWxlLnRleHREZWNvcmF0aW9uPVwibm9uZVwiLGVtb2ppTGluay5zdHlsZS5tYXJnaW49XCI1cHhcIixlbW9qaUxpbmsuc3R5bGUucG9zaXRpb249XCJpbml0aWFsXCIsZW1vamlMaW5rLnN0eWxlLmZvbnRTaXplPVwiMjRweFwiLGVtb2ppTGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCJqYXZhc2NyaXB0OnZvaWQoMClcIiksZW1vamlMaW5rLmlubmVySFRNTD1TdHJpbmcuZnJvbUNvZGVQb2ludChpdGVtKSxlbW9qaUxpbmsub25tb3VzZWRvd249Y2xpY2tMaW5rLGFuaW1hbHNDYXRlZ29yeS5hcHBlbmRDaGlsZChlbW9qaUxpbmspfSksWzEyNzgxMywxMjc4MTQsMTI3ODE1LDEyNzgxNiwxMjc4MTcsMTI3ODE4LDEyNzgyMCwxMjc4MjEsMTI3ODIyLDEyNzgyMywxMjc4MjUsMTI3ODI2LDEyNzgyNywxMjc4MjgsMTI3ODI5LDEyNzgzMCwxMjc4MzEsMTI3ODMyLDEyNzgzNiwxMjc4MzcsMTI3ODM4LDEyNzgzOSwxMjc4NDAsMTI3ODQxLDEyNzg0MiwxMjc4NDMsMTI3ODQ0LDEyNzg0NiwxMjc4NDgsMTI3ODQ5LDEyNzg1MCwxMjc4NTEsMTI3ODUyLDEyNzg1MywxMjc4NTYsMTI3ODU4LDEyNzg1OSwxMjc4NjAsMTI3ODYzLDEyNzg2NCwxMjc4NjddLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUubWFyZ2luPVwiNXB4XCIsZW1vamlMaW5rLnN0eWxlLnBvc2l0aW9uPVwiaW5pdGlhbFwiLGVtb2ppTGluay5zdHlsZS5mb250U2l6ZT1cIjI0cHhcIixlbW9qaUxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nLmZyb21Db2RlUG9pbnQoaXRlbSksZW1vamlMaW5rLm9ubW91c2Vkb3duPWNsaWNrTGluayxmb29kQ2F0ZWdvcnkuYXBwZW5kQ2hpbGQoZW1vamlMaW5rKX0pLFsxMjc5MjEsMTI3OTIzLDEyNzkzNCwxMjc5MzUsMTI3OTM2LDEyNzkzNywxMjc5MzgsMTI3OTM5LDEyNzk0MCwxMjc5NDIsMTI3OTQ0LDEyNzk0NiwxMjg2NzUsMTI4NjkyLDEyODY5Myw5OTE3LDk5MTgsOTk3OCwxMjc5MDcsMTI3OTE5LDk5NzFdLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUubWFyZ2luPVwiNXB4XCIsZW1vamlMaW5rLnN0eWxlLnBvc2l0aW9uPVwiaW5pdGlhbFwiLGVtb2ppTGluay5zdHlsZS5mb250U2l6ZT1cIjI0cHhcIixlbW9qaUxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nLmZyb21Db2RlUG9pbnQoaXRlbSksZW1vamlMaW5rLm9ubW91c2Vkb3duPWNsaWNrTGluayxzcG9ydENhdGVnb3J5LmFwcGVuZENoaWxkKGVtb2ppTGluayl9KSxbMTI4NjQxLDEyODY0MiwxMjg2NDYsMTI4NjQ4LDEyODY1MCwxMjg2NTMsMTI4NjU0LDEyODY1NiwxMjg2NjAsMTI4NjYyLDEyODY2NCwxMjg2NjcsMTI4NjY4LDEyODY2OSwxMjg2NzAsMTI4NjcxLDEyODY3MiwxMjg2NzMsMTI4NjQwLDEyODY0MywxMjg2NDQsMTI4NjQ1LDEyODY0NywxMjg2NDksMTI4NjUyLDEyODY1NywxMjg2NTgsMTI4NjU5LDEyODY2MSwxMjg2NjMsMTI4NjY1LDEyODY2NiwxMjg2NzQsMTI4Njc2LDEyODY5MF0ubWFwKGZ1bmN0aW9uKGl0ZW0pe3ZhciBlbW9qaUxpbms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7ZW1vamlMaW5rLnN0eWxlLnRleHREZWNvcmF0aW9uPVwibm9uZVwiLGVtb2ppTGluay5zdHlsZS5tYXJnaW49XCI1cHhcIixlbW9qaUxpbmsuc3R5bGUucG9zaXRpb249XCJpbml0aWFsXCIsZW1vamlMaW5rLnN0eWxlLmZvbnRTaXplPVwiMjRweFwiLGVtb2ppTGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCJqYXZhc2NyaXB0OnZvaWQoMClcIiksZW1vamlMaW5rLmlubmVySFRNTD1TdHJpbmcuZnJvbUNvZGVQb2ludChpdGVtKSxlbW9qaUxpbmsub25tb3VzZWRvd249Y2xpY2tMaW5rLHRyYW5zcG9ydENhdGVnb3J5LmFwcGVuZENoaWxkKGVtb2ppTGluayl9KSxbMTI3ODkwLDEyNzg4MCwxMjc4ODEsMTI3ODg3LDEyNzg5MSwxMjc5MDUsMTI3OTA2LDEyNzkwOCwxMjc5MDksMTI3OTExLDEyNzkxMiwxMjc5MTUsMTI3OTE2LDEyNzkxOCwxMjc5MTksMTI3OTI2LDEyNzkyNywxMjc5MjgsMTI3OTI5LDEyNzkzMCwxMjc5MzEsMTI3OTMyLDEyNzk2OCwxMjc5NzMsMTI3OTc4LDEyODE0NywxMjgxNDgsMTI4MTQ5LDEyODE1MCwxMjgxNTEsMTI4MTUyLDEyODE4NywxMjgxODYsMTI4MTk3LDEyODIxMywxMjgyNDddLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7ZW1vamlMaS5zdHlsZS5kaXNwbGF5PVwiaW5saW5lLWJsb2NrXCIsZW1vamlMaS5zdHlsZS5tYXJnaW49XCI1cHhcIjt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUubWFyZ2luPVwiNXB4XCIsZW1vamlMaW5rLnN0eWxlLnBvc2l0aW9uPVwiaW5pdGlhbFwiLGVtb2ppTGluay5zdHlsZS5mb250U2l6ZT1cIjI0cHhcIixlbW9qaUxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nLmZyb21Db2RlUG9pbnQoaXRlbSksZW1vamlMaW5rLm9ubW91c2Vkb3duPWNsaWNrTGluayxvYmplY3RzQ2F0ZWdvcnkuYXBwZW5kQ2hpbGQoZW1vamlMaW5rKX0pLGVtb2ppUGlja2VyLmFwcGVuZENoaWxkKGVtb2ppQ2F0ZWdvcnkpLGVtb2ppUGlja2VyLmFwcGVuZENoaWxkKGZhY2VzQ2F0ZWdvcnkpLGVtb2ppUGlja2VyLmFwcGVuZENoaWxkKGFuaW1hbHNDYXRlZ29yeSksZW1vamlQaWNrZXIuYXBwZW5kQ2hpbGQoZm9vZENhdGVnb3J5KSxlbW9qaVBpY2tlci5hcHBlbmRDaGlsZChzcG9ydENhdGVnb3J5KSxlbW9qaVBpY2tlci5hcHBlbmRDaGlsZCh0cmFuc3BvcnRDYXRlZ29yeSksZW1vamlQaWNrZXIuYXBwZW5kQ2hpbGQob2JqZWN0c0NhdGVnb3J5KSxlbW9qaUNvbnRhaW5lci5hcHBlbmRDaGlsZChlbW9qaVBpY2tlcil9fV0pLE1ldGVvckVtb2ppfSgpO21vZHVsZS5leHBvcnRzPU1ldGVvckVtb2ppfSl9LHt9XX0se30sWzFdKSgxKX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9tZXRlb3ItZW1vamkvZGlzdC9tZXRlb3JFbW9qaS5taW4uanNcbi8vIG1vZHVsZSBpZCA9IDIxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XHJcblx0aWYoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcclxuXHRcdG1vZHVsZS5kZXByZWNhdGUgPSBmdW5jdGlvbigpIHt9O1xyXG5cdFx0bW9kdWxlLnBhdGhzID0gW107XHJcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcclxuXHRcdGlmKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJsb2FkZWRcIiwge1xyXG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHJldHVybiBtb2R1bGUubDtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImlkXCIsIHtcclxuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcclxuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XHJcblx0fVxyXG5cdHJldHVybiBtb2R1bGU7XHJcbn07XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL21vZHVsZS5qc1xuLy8gbW9kdWxlIGlkID0gMjJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==