/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 22);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var CONST = exports.CONST = {
    url: {
        base: 'http://api.luxgram.ru/v1/',
        registration: 'registration/basic/',
        login: 'registration/basic/login',
        confirmation: 'registration/basic/confirmation?token',
        instagram_addAccount: 'instagram-accounts/',
        instagramAccount_getMetaData: 'instagram-accounts/meta',
        instagramAccount_checkpoint: 'instagram-accounts/checkpoint/',
        instagramAccount_confirmKey: 'instagram-accounts/checkpoint/'
    },
    user: {
        email: '',
        password: '',
        token: ''
    },
    cookieStorage: {
        token: 'user_logged',
        emailConfirmed: 'email_confirmed'
    },
    uiSelectors: {
        headerLoginBox: 'nav .login-box',
        headerNavLoginBtn: 'nav ul li .js_login',
        headerRegBox: 'nav .register-box',
        headerRegBtn: 'nav ul li .js_register',
        instagram: {
            addAccountBtnSelector: '#js_show-login-box',
            addAccountBtnId: 'js_show-login-box'
        }
    },
    events: {
        USER_LOGGED: 'user_logged',
        USER_LOGOUT: 'user_logout',
        USER_EMAIL_CONFIRMED: 'user_email_confirmed',
        STOP_FIXED_SPINNER: 'stop_fixed_spinner'
    },
    getPath: function getPath(name) {
        return this.url.base + this.url[name];
    }
};

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';


var _consts = __webpack_require__(0);

var _network = __webpack_require__(14);

var _network2 = _interopRequireDefault(_network);

var _cookie = __webpack_require__(3);

var _cookie2 = _interopRequireDefault(_cookie);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var User = function () {
    function User() {
        _classCallCheck(this, User);

        this.network = new _network2.default();
        this.cookieStorage = _cookie2.default;
        this.settingPost = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        };
    }

    _createClass(User, [{
        key: 'isLoggedIn',
        value: function isLoggedIn() {
            return !!this.getToken();
        }
    }, {
        key: 'isEmailConfirmed',
        value: function isEmailConfirmed() {
            return this.cookieStorage.get(_consts.CONST.cookieStorage.emailConfirmed) === 'confirmed';
        }
    }, {
        key: 'getToken',
        value: function getToken() {
            var cookieToken = this.cookieStorage.get(_consts.CONST.cookieStorage.token);
            return cookieToken;
        }
    }, {
        key: 'login',
        value: function login(formData, cbError) {
            var setting = _extends({}, this.settingPost, { body: JSON.stringify(formData) });
            return this.network.sendRequest(_consts.CONST.getPath('login'), setting, cbError);
        }
    }, {
        key: 'addInstagramAccount',
        value: function addInstagramAccount(formData, cbError) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify(formData),
                headers: _extends({}, this.settingPost.headers, {
                    token: this.getToken()
                })
            });
            return this.network.sendRequest(_consts.CONST.getPath('instagram_addAccount'), setting, cbError);
        }
    }, {
        key: 'getInstagramAccount',
        value: function getInstagramAccount() {
            var setting = _extends({}, this.settingPost, {
                method: 'GET',
                headers: _extends({}, this.settingPost.headers, {
                    token: this.getToken()
                })
            });
            return this.network.sendRequest(_consts.CONST.getPath('instagram_addAccount'), setting);
        }
    }, {
        key: 'confirm',
        value: function confirm(token) {
            // const confirmUrl = CONST.getPath('confirmation');
            return this.network.sendRequest('' + (_consts.CONST.getPath('confirmation') + token));
        }
    }, {
        key: 'register',
        value: function register(formData) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify(formData)
            });
            return this.network.sendRequest(_consts.CONST.getPath('registration'), setting);
        }
    }, {
        key: 'getMetadata',
        value: function getMetadata(token, cbError) {
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_getMetaData'), { headers: { token: token } }, cbError);
        }
    }, {
        key: 'getSecurityKey',
        value: function getSecurityKey(username, checkpointType) {
            var setting = _extends({}, this.settingPost, {
                body: JSON.stringify({ 'type': checkpointType }), // todo: tmp set, it should be 'type'
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            });
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_checkpoint') + username, setting);
        }
    }, {
        key: 'confirmSecurityKey',
        value: function confirmSecurityKey(key, username) {
            var setting = {
                method: 'DELETE',
                body: JSON.stringify({ 'security_code': key }),
                headers: _extends({}, this.settingPost.headers, {
                    'token': '3e321e60029711e99264a0481c8e17d4' // todo: this.getToken()
                })
            };
            return this.network.sendRequest('' + _consts.CONST.getPath('instagramAccount_confirmKey') + username, setting);
        }
    }]);

    return User;
}();

var userInstance = null;

if (!userInstance) {
    userInstance = new User();
}

exports.default = userInstance;

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// import $ from 'jquery';
// import {CONST} from './consts';

function viewUtils() {
    function showInfoMessage(selector, message1, message2) {
        $(selector).empty().append('' + (message1 ? '<p>status: ' + message1 + '</p>' : '')).append('<p>' + message2 + ' </p>');
    }

    function fillList($list, dataArray) {
        var items = dataArray;
        var cList = $list;
        cList.empty();
        items.forEach(function (item, i) {
            var li = $('<li class="list-group-item"></li>').appendTo(cList);
            $('<a/>').addClass('ui-all').text(item.username).appendTo(li);
        });
    }

    function isEmail(email) {
        /* eslint-disable */
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
        /* eslint-enable */
    }

    return {
        showInfoMessage: showInfoMessage,
        fillList: fillList,
        isEmail: isEmail
    };
}

exports.default = viewUtils();

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var CookieSrv = {
    get: function get(name) {
        var c = document.cookie.match('(?:(?:^|.*; *)' + name + ' *= *([^;]*).*$)|^.*$')[1];
        if (c) {
            return decodeURIComponent(c);
        }
    },
    set: function set(name, value) {
        var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : { path: '/', days: 365 };

        if (opts.days) {
            opts['max-age'] = opts.days * 60 * 60 * 24;
            delete opts.days;
        }
        // eslint-disable-next-line no-param-reassign
        opts = Object.entries(opts).reduce(function (str, _ref) {
            var _ref2 = _slicedToArray(_ref, 2),
                k = _ref2[0],
                v = _ref2[1];

            return str + '; ' + k + '=' + v;
        }, '');
        document.cookie = name + '=' + (encodeURIComponent(value) + opts);
    },
    remove: function remove(name, opts) {
        return CookieSrv.set(name, '', _extends({ 'max-age': -1, path: '/', days: 0 }, opts));
    }
    // path & domain must match cookie being deleted
};

/*
class CookieStorage {
    read(key) {
        const value = $.cookie(key);
        return value === undefined ? null : value;
    }

    setCookie(name, value, days) {
        let expires = '';
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = `; expires=${date.toUTCString()}`;
        }
        document.cookie = `${name} =${(value || '') + expires}; path=/`;
    }

    getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length == 2) {
            return parts.pop().split(';').shift();
        }
    }
}
*/

exports.default = CookieSrv;

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {/**
 * Copyright (c) 2010,2011,2012,2013,2014 Morgan Roderick http://roderick.dk
 * License: MIT - http://mrgnrdrck.mit-license.org
 *
 * https://github.com/mroderick/PubSubJS
 */

(function (root, factory){
    'use strict';

    var PubSub = {};
    root.PubSub = PubSub;

    var define = root.define;

    factory(PubSub);

    // AMD support
    if (typeof define === 'function' && define.amd){
        define(function() { return PubSub; });

        // CommonJS and Node.js module support
    } else if (true){
        if (module !== undefined && module.exports) {
            exports = module.exports = PubSub; // Node.js specific `module.exports`
        }
        exports.PubSub = PubSub; // CommonJS module 1.1.1 spec
        module.exports = exports = PubSub; // CommonJS
    }

}(( typeof window === 'object' && window ) || this, function (PubSub){
    'use strict';

    var messages = {},
        lastUid = -1;

    function hasKeys(obj){
        var key;

        for (key in obj){
            if ( obj.hasOwnProperty(key) ){
                return true;
            }
        }
        return false;
    }

    /**
     * Returns a function that throws the passed exception, for use as argument for setTimeout
     * @alias throwException
     * @function
     * @param { Object } ex An Error object
     */
    function throwException( ex ){
        return function reThrowException(){
            throw ex;
        };
    }

    function callSubscriberWithDelayedExceptions( subscriber, message, data ){
        try {
            subscriber( message, data );
        } catch( ex ){
            setTimeout( throwException( ex ), 0);
        }
    }

    function callSubscriberWithImmediateExceptions( subscriber, message, data ){
        subscriber( message, data );
    }

    function deliverMessage( originalMessage, matchedMessage, data, immediateExceptions ){
        var subscribers = messages[matchedMessage],
            callSubscriber = immediateExceptions ? callSubscriberWithImmediateExceptions : callSubscriberWithDelayedExceptions,
            s;

        if ( !messages.hasOwnProperty( matchedMessage ) ) {
            return;
        }

        for (s in subscribers){
            if ( subscribers.hasOwnProperty(s)){
                callSubscriber( subscribers[s], originalMessage, data );
            }
        }
    }

    function createDeliveryFunction( message, data, immediateExceptions ){
        return function deliverNamespaced(){
            var topic = String( message ),
                position = topic.lastIndexOf( '.' );

            // deliver the message as it is now
            deliverMessage(message, message, data, immediateExceptions);

            // trim the hierarchy and deliver message to each level
            while( position !== -1 ){
                topic = topic.substr( 0, position );
                position = topic.lastIndexOf('.');
                deliverMessage( message, topic, data, immediateExceptions );
            }
        };
    }

    function messageHasSubscribers( message ){
        var topic = String( message ),
            found = Boolean(messages.hasOwnProperty( topic ) && hasKeys(messages[topic])),
            position = topic.lastIndexOf( '.' );

        while ( !found && position !== -1 ){
            topic = topic.substr( 0, position );
            position = topic.lastIndexOf( '.' );
            found = Boolean(messages.hasOwnProperty( topic ) && hasKeys(messages[topic]));
        }

        return found;
    }

    function publish( message, data, sync, immediateExceptions ){
        message = (typeof message === 'symbol') ? message.toString() : message;

        var deliver = createDeliveryFunction( message, data, immediateExceptions ),
            hasSubscribers = messageHasSubscribers( message );

        if ( !hasSubscribers ){
            return false;
        }

        if ( sync === true ){
            deliver();
        } else {
            setTimeout( deliver, 0 );
        }
        return true;
    }

    /**
     * Publishes the message, passing the data to it's subscribers
     * @function
     * @alias publish
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    PubSub.publish = function( message, data ){
        return publish( message, data, false, PubSub.immediateExceptions );
    };

    /**
     * Publishes the the message synchronously, passing the data to it's subscribers
     * @function
     * @alias publishSync
     * @param { String } message The message to publish
     * @param {} data The data to pass to subscribers
     * @return { Boolean }
     */
    PubSub.publishSync = function( message, data ){
        return publish( message, data, true, PubSub.immediateExceptions );
    };

    /**
     * Subscribes the passed function to the passed message. Every returned token is unique and should be stored if you need to unsubscribe
     * @function
     * @alias subscribe
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { String }
     */
    PubSub.subscribe = function( message, func ){
        if ( typeof func !== 'function'){
            return false;
        }

        message = (typeof message === 'symbol') ? message.toString() : message;

        // message is not registered yet
        if ( !messages.hasOwnProperty( message ) ){
            messages[message] = {};
        }

        // forcing token as String, to allow for future expansions without breaking usage
        // and allow for easy use as key names for the 'messages' object
        var token = 'uid_' + String(++lastUid);
        messages[message][token] = func;
        
        // return token for unsubscribing
        return token;
    };

    /**
     * Subscribes the passed function to the passed message once
     * @function
     * @alias subscribeOnce
     * @param { String } message The message to subscribe to
     * @param { Function } func The function to call when a new message is published
     * @return { PubSub }
     */
    PubSub.subscribeOnce = function( message, func ){
        var token = PubSub.subscribe( message, function(){
            // before func apply, unsubscribe message
            PubSub.unsubscribe( token );
            func.apply( this, arguments );
        });
        return PubSub;
    };

    /**
     * Clears all subscriptions
     * @function
     * @public
     * @alias clearAllSubscriptions
     */
    PubSub.clearAllSubscriptions = function clearAllSubscriptions(){
        messages = {};
    };

    /**
     * Clear subscriptions by the topic
     * @function
     * @public
     * @alias clearAllSubscriptions
     */
    PubSub.clearSubscriptions = function clearSubscriptions(topic){
        var m;
        for (m in messages){
            if (messages.hasOwnProperty(m) && m.indexOf(topic) === 0){
                delete messages[m];
            }
        }
    };

    /**
     * Removes subscriptions
     *
     * - When passed a token, removes a specific subscription.
     *
	 * - When passed a function, removes all subscriptions for that function
     *
	 * - When passed a topic, removes all subscriptions for that topic (hierarchy)
     * @function
     * @public
     * @alias subscribeOnce
     * @param { String | Function } value A token, function or topic to unsubscribe from
     * @example // Unsubscribing with a token
     * var token = PubSub.subscribe('mytopic', myFunc);
     * PubSub.unsubscribe(token);
     * @example // Unsubscribing with a function
     * PubSub.unsubscribe(myFunc);
     * @example // Unsubscribing from a topic
     * PubSub.unsubscribe('mytopic');
     */
    PubSub.unsubscribe = function(value){
        var descendantTopicExists = function(topic) {
                var m;
                for ( m in messages ){
                    if ( messages.hasOwnProperty(m) && m.indexOf(topic) === 0 ){
                        // a descendant of the topic exists:
                        return true;
                    }
                }

                return false;
            },
            isTopic    = typeof value === 'string' && ( messages.hasOwnProperty(value) || descendantTopicExists(value) ),
            isToken    = !isTopic && typeof value === 'string',
            isFunction = typeof value === 'function',
            result = false,
            m, message, t;

        if (isTopic){
            PubSub.clearSubscriptions(value);
            return;
        }

        for ( m in messages ){
            if ( messages.hasOwnProperty( m ) ){
                message = messages[m];

                if ( isToken && message[value] ){
                    delete message[value];
                    result = value;
                    // tokens are unique, so we can just stop here
                    break;
                }

                if (isFunction) {
                    for ( t in message ){
                        if (message.hasOwnProperty(t) && message[t] === value){
                            delete message[t];
                            result = true;
                        }
                    }
                }
            }
        }

        return result;
    };
}));

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(21)(module)))

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


__webpack_require__(17);

var _registerForm = __webpack_require__(13);

var _registerForm2 = _interopRequireDefault(_registerForm);

var _loginForm = __webpack_require__(10);

var _loginPage = __webpack_require__(15);

var _confirmReg = __webpack_require__(6);

var _instagram = __webpack_require__(16);

var _header = __webpack_require__(8);

var header = _interopRequireWildcard(_header);

var _burgerMenu = __webpack_require__(7);

var burgerMenu = _interopRequireWildcard(_burgerMenu);

var _consts = __webpack_require__(0);

var _instagramAccountsList = __webpack_require__(9);

var instagramAccounts = _interopRequireWildcard(_instagramAccountsList);

var _messages = __webpack_require__(12);

var messages = _interopRequireWildcard(_messages);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import 'bootstrap';

var selectorCssLoginForm = {
    _loginBox: _consts.CONST.uiSelectors.headerLoginBox,
    _formId: '#js_login-form',
    _buttonSubmitId: '#js_login_btn',
    _showLoginBoxBtnId: _consts.CONST.uiSelectors.headerNavLoginBtn
};

var selectorCssLoginFormInstagram = {
    _loginBox: 'main .login-box',
    _formId: '#js_instagram-add-account',
    _buttonSubmitId: '#js_instagram-add-account--btn',
    _showLoginBoxBtnId: '#js_show-login-box',
    isLoginInstagram: true
};

var init = function init() {
    // console.log('init js here', CONST.user);
    new _registerForm2.default().init();
    (0, _loginForm.LoginForm)(selectorCssLoginForm).init();
    (0, _loginForm.LoginForm)(selectorCssLoginFormInstagram).init(); // init instagram login form*!/
    (0, _loginPage.LoginPage)({
        _loginBox: '.auth.login .card-signin',
        _formId: '.form-signin',
        _buttonSubmitId: '.form-signin [type="submit"]'
    }).init();
    (0, _instagram.Instagram)().init();
    (0, _confirmReg.confirmationWithRedirect)().init();
    header.initHeader();
    burgerMenu.init();
    instagramAccounts.init();
    messages.init();
};

(function () {
    return init();
})();

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.confirmationWithRedirect = confirmationWithRedirect;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _consts = __webpack_require__(0);

var _cookie = __webpack_require__(3);

var _cookie2 = _interopRequireDefault(_cookie);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var parseQueryString = function parseQueryString() {

    var str = window.location.search;
    var objURL = {};

    str.replace(new RegExp('([^?=&]+)(=([^&]*))?', 'g'), function ($0, $1, $2) {
        objURL[$1] = $2;
    });
    return objURL;
}; /* eslint-disable sort-vars */
// import $ from 'jquery';
function confirmationWithRedirect() {
    var user = _user2.default;
    var params = parseQueryString();
    // Example how to use it:

    var sendConfirm = function sendConfirm(token) {
        user.confirm(token).then(function (result) {
            if (result.status && result.status.state === 'ok') {

                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.emailConfirmed, 'confirmed');
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);

                // window.location = confirm-registration.html?token='from server';

                // retrieve the object in a string form
                var customersDataString = sessionStorage.getItem('customersData');
                console.log(customersDataString);
                console.log('request succeeded with JSON response', result);
                $('.confirm-registration').append('<p>confirmation status: ' + result.status.state + '</p>');
                setTimeout(function () {
                    window.location = './profile.html';
                }, 1000);
            } else if (result.status) {
                console.log(result);
            } else {
                console.log(result);
            }
        });
    };

    var redirect = function redirect() {
        // eslint-disable-next-line dot-notation
        var token = params['token'];

        if (!location.pathname.indexOf('confirm-registration')) {
            return;
        }
        if (token) {
            console.log('send req to ', token);
            sendConfirm(token);
        }
    };

    function init() {
        redirect();
    }

    return {
        init: init
    };
}

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;
// import $ from 'jquery';

// const hamburgerButtonCls = '#aside_mobile__button';
// const hamburgerMenuCls = '.aside-burger-menu';
// const hamburgerMenuOpenedClass = 'burger-menu--closed';
// const hamburgerButtonCloseClass = 'burger-menu__button--close';
var selectorsEl = {
    leftMenu: {
        hamburgerButtonCls: '#aside_mobile__button',
        hamburgerMenuCls: '.aside-burger-menu',
        hamburgerMenuOpenedClass: 'burger-menu--closed',
        hamburgerButtonCloseClass: 'burger-menu__button--close'
    },
    rightMenu: {
        hamburgerButtonCls: '#header_mobile_toggler',
        hamburgerMenuCls: '.r-side-burger-menu',
        hamburgerMenuOpenedClass: 'r-side-burger-menu--open',
        hamburgerButtonCloseClass: 'burger-menu-right__button--close'
    },
    subHeader: {
        hamburgerButtonCls: '#header_mobile_topbar_toggler',
        hamburgerMenuCls: '.sub-header',
        hamburgerMenuOpenedClass: 'sub-header--open',
        hamburgerButtonCloseClass: 'sub-header-button--close'
    }
};

/**
 * Toggle hamburger menu popover
 */
function toggleHamburgerMenu(menuName) {
    var _selectorsEl$menuName = selectorsEl[menuName],
        hamburgerMenuCls = _selectorsEl$menuName.hamburgerMenuCls,
        hamburgerButtonCls = _selectorsEl$menuName.hamburgerButtonCls,
        hamburgerButtonCloseClass = _selectorsEl$menuName.hamburgerButtonCloseClass,
        hamburgerMenuOpenedClass = _selectorsEl$menuName.hamburgerMenuOpenedClass;

    $(hamburgerButtonCls).toggleClass(hamburgerButtonCloseClass);
    $(hamburgerMenuCls).toggleClass(hamburgerMenuOpenedClass);
}

/**
 * Init hamburger menu
 */
function init() {
    var leftMenu = 'leftMenu';
    var rightMenu = 'rightMenu';
    var subHeader = 'subHeader';

    $(selectorsEl[leftMenu].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, leftMenu));
    $(selectorsEl[rightMenu].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, rightMenu));
    $(selectorsEl[subHeader].hamburgerButtonCls).on('click', toggleHamburgerMenu.bind(this, subHeader));
}

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.initHeader = initHeader;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var selectorLoginState = '.js_message_logged--text'; // https://www.npmjs.com/package/pubsub-js
// import $ from 'jquery';

var selectorEmailConfirmState = '.js_email-confirm--text';
var closeClass = 'd-none';
var openedClass = 'd-block';

function emailNotConfirmed() {
    var $emailnMsg = $(selectorEmailConfirmState);
    $emailnMsg.text('**emailNotConfirmed** Email не подтвержден.').css('color', 'lightcoral');
}

function onLoginSubscribe(msg, data) {
    // console.log(msg, data);
    $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(closeClass).removeClass(openedClass);
    $(_consts.CONST.uiSelectors.headerRegBtn).addClass(closeClass).removeClass(openedClass);
    $(_consts.CONST.uiSelectors.headerLoginBox).addClass(closeClass).removeClass(openedClass);

    $('.nav-link.js_logOut').addClass(openedClass).removeClass(closeClass); // show
    var $loginMsg = $(selectorLoginState);
    $loginMsg.text('**onLoginSubscribe** вы залогинились в Luxgram успешно').css('color', 'lightblue');
    var isEmailConfirmed = _user2.default.isEmailConfirmed();
    if (!isEmailConfirmed) {
        emailNotConfirmed();
    }
}

function showLogout() {
    // check is logged
    var isLogged = _user2.default.isLoggedIn();
    var isEmailConfirmed = _user2.default.isEmailConfirmed();
    if (!isEmailConfirmed) {
        emailNotConfirmed();
    }
    if (isLogged) {
        $('.nav-link.js_logOut').parent().show();
        $('.js_email-confirm--text').text('вы залогинились успешно');
        var oldURL = document.referrer;
        // console.log(oldURL);
        if (oldURL.includes('confirm-registration')) {
            $('.js_message_logged--text').text('вы подтвердили регистрацию');
        }
        onLoginSubscribe();
    } else {
        $(selectorLoginState).text('Привет анонимный пользователь');
        $(selectorEmailConfirmState).empty();
    }
}

/**
 * Init header
 */
function initHeader() {
    // check other handler in login-form.js
    var $loginBox = $(_consts.CONST.uiSelectors.headerLoginBox);
    var $registerBox = $(_consts.CONST.uiSelectors.headerRegBox);

    _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGGED, onLoginSubscribe);

    showLogout();

    $(_consts.CONST.uiSelectors.headerRegBtn).on('click', function () {
        $loginBox.hide();
        $registerBox.css({ 'top': 0, 'right': 0 }).addClass('bg-light border mt-5 mx-auto position-absolute px-3 d-block').removeClass('d-none');
    });

    $(_consts.CONST.uiSelectors.headerNavLoginBtn).on('click', function () {
        $loginBox.addClass('d-block').removeClass('d-none');
        $registerBox.addClass('d-none').removeClass('d-block');
    });
}

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
const staticResp = {
    'status': {
        'state': 'ok'
    },
    'data': {
        'accounts': [{
            'status': 'OK',
            'username': 'andrey.jakivchyk',
            'checkpoint': {
                'status': 'ABSENT',
                'type': 'PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            },
            'info': {
                'profile_pic_url': 'https://randomuser.me/api/portraits/men/50.jpg',
                'name': 'Андрей Якивчук',
                'biography': '',
                'url': '',
                'email': 'nidzuku@inbox.ru',
                'phone': '',
                'media_count': 2,
                'follower_count': 4,
                'following_count': 15
            }
        }, {
            'status': 'OK',
            'username': 'andrey.jakivchyk',
            'checkpoint': {
                'status': 'ABSENT',
                'type': 'EMAIL'
            },
            'tariff': {
                'status': 'ABSENT'
            },
            'info': {
                'profile_pic_url': 'https://randomuser.me/api/portraits/men/52.jpg',
                'name': 'Димон Паралон',
                'biography': 'biography text',
                'url': 'www.lenengrad.ru',
                'email': 'nidzuku@inbox.ru',
                'phone': '011-111-111-11',
                'media_count': 515,
                'following_count': 34
            }
        }, {
            'status': 'OK',
            'username': 'alex.smith',
            'checkpoint': {
                'status': 'TRIGGERED',
                'type': 'EMAIL_OR_PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            }
        }, {
            'status': 'OK',
            'username': '22andrey.jakivchyk2',
            'checkpoint': {
                'status': 'TRIGGERED',
                'type': 'PHONE'
            },
            'tariff': {
                'status': 'ABSENT'
            }
        }
        ],
        'available_proxy_purchase': true
    }
};
*/ /*
   const staticRespWithDelay = {
     'status': {
         'state': 'ok'
     },
     'data': {
         'accounts': [{
             'status': 'OK',
             'username': 'staticResp.WithDelay',
             'checkpoint': {
                 'status': 'ABSENT',
                 'type': 'PHONE'
             },
             'tariff': {
                 'status': 'ABSENT'
             }
         }],
         'available_proxy_purchase': true
     }
   };
   */

// После добавления аккаунта снова дернуть МЕТА и перерисовать список аккаунтов
// import $ from 'jquery';
var addInstagramAccount = function addInstagramAccount(newFormData) {
    var cbError = function cbError(result) {
        console.log('ERROR', result);
        _view2.default.showInfoMessage($('.error-msg'), result.status.state, result.status.message || 'Login error');
        // $(_loginBox).addClass(closeClass).removeClass(openedClass);
    };

    _user2.default.addInstagramAccount(newFormData, cbError).then(function (result) {
        if (result && result.status) {
            console.log(result, result.status);
            // debugger;
            var $msgList = $('.accounts-list');
            $msgList.empty();
            // todo : reload list
            // fillList($msgList, result.data.accounts);
            // addListHandler();

            // viewUtils.showInfoMessage($textAreaDescription,
            //     result.status.state,
            //     result.status.message || 'Login error');
            // $(_loginBox).addClass(closeClass).removeClass(openedClass);
        }
    }).catch(function (err) {
        // todo: render for user
        console.log(err);
    });

    console.log('submit', newFormData);
};
// import Spinner from '../../common/js-services/spinner';


function addOnLoadHandlers() {
    // $('.js_repeat-security-code').on('click', (e) => {

    // });

    $('.js_add-instagram-account').on('click', function (e) {
        var btn = $(e.target);
        var $modalBody = btn.closest('.modal').find('.modal-dialog .modal-body');
        var username = $modalBody.find('input[name="username"]').val().trim();
        var password = $modalBody.find('input[name="pass"]').val().trim();
        var $form = $('form', $modalBody);
        var form = $form.get(0);
        var cssValidationClass = 'form-validation';

        e.preventDefault();

        // const validator = new Validator($form);
        // console.log(validator.validate());
        if (form.checkValidity()) {
            addInstagramAccount({ username: username, password: password });
        } else {
            // Highlight errors
            if (form.reportValidity) {
                form.reportValidity();
            }
            $form.addClass(cssValidationClass);
        }

        if (!username || !password) {
            console.log('not valid - Empty fields');
            return;
        }
    });
}

function addListHandler() /* username*/{
    // $('#yourModalID').on('show.bs.modal', function(e) {
    //     var yourparameter = e.relatedTarget.dataset.yourparameter;
    //     // Do some stuff w/ it.
    // });
    var checkpointType = '';

    $('.js_pass-checkpoint-btn').on('click', function (e) {
        var $button = $(e.target);
        var username = $button.data('username');
        checkpointType = $button.data('checkpointType') || checkpointType;
        // $('#security-code').data('checkpointType', checkpointType);
        // todo add 'checkpointType' to modal
        var sendTo = checkpointType === 'PHONE' ? 'телефон' : 'email';
        // Spinner.start($button, 'fa-key');

        if (checkpointType === 'EMAIL_OR_PHONE') {
            e.stopPropagation();

            // инпуты спрятаны,
            // показать серые переключатели (выбрал тип)
            // есть кнопка Запросить код подтверждение
            $('#security-code-phoneOremail').modal({ show: true, username: username });

            // не отправляем реквест
            return;
        }

        _user2.default.getSecurityKey(username, checkpointType).then(function (result) {
            console.log('SecurityKey received:', result.status.state);
            if (result.status.state === 'ok') {
                var $modal = $('#security-code');

                // Spinner.stop($button, 'fa-key');
                $('.js_success-feedback', $modal).empty().text('\u041A\u043B\u044E\u0447 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0431\u044B\u043B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u0412\u0430\u043C \u043D\u0430 ' + sendTo);
            }
        });
    });

    // inside modal
    $('.js_confirm-security-code').on('click', function (e) {
        var btn = $(e.target);
        var username = btn.data('username');
        var $keyInput = btn.closest('.modal').find('.modal-dialog form input.js_confirm-key');
        var key = $keyInput.val().trim();
        var $modal = btn.closest('.modal');
        e.stopPropagation();

        if (key.length !== 6) {
            return;
        }
        _user2.default.confirmSecurityKey(key, username).then(function (result) {
            if (result.status.state !== 'ok') {
                return;
            }
            console.log('js_confirm:', result.status.state, 'close modal');
            $modal.modal('hide');
        }).catch(function (err) {
            console.log('err');
            $('.js_success-feedback', $modal).text('Запрос не отправлен').css('color', 'red');
            console.log(err);
        });
    });

    $('form input[minlength]').on('blur', function () {
        var len = $(this).val().trim().length;
        var minLen = Number($(this).attr('minlength'));
        // const message = minLen <= len ? '' : minLen + ' characters minimum';
        if (minLen !== len) {
            $(this).css('borderColor', 'red');
        } else {
            $(this).css('borderColor', '#ced4da');
        }
        // this.setCustomValidity(message)
    });

    function onHideModal(e) {
        var $modal = $(e.target);
        $modal.find('.first-step').removeClass('d-none');
        $modal.find('.second-step').addClass('d-none');
        $('.js_confirm-key').val('');
        $('.js_success-feedback', $modal).removeAttr('style').empty();
    }
    $('#security-code-phoneOremail').on('hide.bs.modal', onHideModal);
    $('#security-code').on('hide.bs.modal', onHideModal);

    // "PHONE_OR_EMAIL" modal
    $('.js_get-security-code-phoneOremail').on('click', function (e) {
        var $modal = $('#security-code-phoneOremail');
        var typeSelected = $(e.target).closest($modal).find('.js_btn-type-switcher input:checked');
        var checkpointTypeActive = typeSelected.val();
        var sendTo = checkpointTypeActive === 'PHONE' ? 'телефон' : 'email';
        var modalConfig = $modal.data()['bs.modal']._config;
        var username = modalConfig.username;
        _user2.default.getSecurityKey(username, checkpointTypeActive).then(function (result) {
            // при нажатии "Запросить код подтверждение" - отпарляется реквест "старт чекпоинт" появляеться инпут и кнопка других типах
            // get selected button

            // переключатель(серый) и кнопка "Запросить код подтверждение" исчезают
            console.log('SecurityKey received:', result.status.state);
            if (result.status.state === 'ok') {
                $('.first-step', $modal).addClass('d-none');
                $('.second-step', $modal).removeClass('d-none');
                $('.js_success-feedback', $modal).empty().text('\u041A\u043B\u044E\u0447 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0431\u044B\u043B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D \u0412\u0430\u043C \u043D\u0430 ' + sendTo);
            }
        });
    });
}

function fillList($list, dataArray) {
    var items = dataArray;
    var cList = $list;
    var defaultAvatarSrc = 'https://i.imgur.com/jNNT4LE.png';
    var insertItem = function insertItem(data, text, cssCls) {
        var liTpl = '' + (data ? '<li class="list-inline-item ' + cssCls + '"><span class="figure">' + data + '</span><span>' + text + '</span></li>' : '<li class="list-inline-item ' + cssCls + '"><span class="figure">-</span><span>' + text + '</span></li>');
        return liTpl;
    };
    var stats = function stats(info) {
        var tpl = '<div class="col">\n            <ul class="list-inline text-center counts-list">\n            ' + (info ? insertItem(info['media_count'], 'Публикации', 'media-count') + '\n                ' + insertItem(info['follower_count'], 'Подписчики', 'follower-count') + '\n                ' + insertItem(info['following_count'], 'Подписки', 'following-count') : insertItem(false, 'Публикации', 'media-count') + '\n                ' + insertItem(false, 'Подписчики', 'follower-count') + '\n                ' + insertItem(false, 'Подписки', 'following-count')) + '\n            </ul>\n        </div>';
        return tpl;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item) {
        var info = item.info;
        var checkpoint = item.checkpoint || item;

        if (!info) {
            $('<li class="media py-3">\n                <img class="ml-3 rounded" alt="default avatar" src="' + defaultAvatarSrc + '">\n                <div class="media-body d-flex">\n                    <div class="col user-info">\n                        ' + (item.username ? '<h4 class="mt-0 mb-1 name">' + item.username + '</h4>' : '') + '\n                    </div>\n                    <div class="col">                        \n                        ' + (checkpoint.status === 'TRIGGERED' ? '<button class="btn btn-outline-secondary js_pass-checkpoint-btn d-block mx-auto" \n                            data-checkpoint-type="' + checkpoint.type + '"\n                            data-username="' + (item.username || '') + '"\n                            data-toggle="modal" data-target="#security-code">\n                            <i class="fas fa-key"></i>\u041F\u0440\u043E\u0439\u0442\u0438 \u0447\u0435\u043A\u043F\u043E\u0438\u043D\u0442</button>' : '(todo)checkpoint status - ' + checkpoint.status) + '\n                    </div>\n                    ' + stats() + '\n                </div>\n            </li>').appendTo(cList);
        } else {
            $('<li class="media py-3">\n            ' + (info['profile_pic_url'] ? '<img class="ml-3 rounded" alt="User photo" src="' + info['profile_pic_url'] + '">' : '<img class="ml-3 rounded" alt="default avatar" src="' + defaultAvatarSrc + '">') + '\n            <div class="media-body d-flex">\n                <div class="col user-info">\n                    ' + (item.username ? '<p class="mt-0 mb-1 name">' + item.username + '</p>' : '') + '\n                    ' + (info.name ? '<h4 class="mt-0 mb-1">' + info.name + '</h4>' : '') + '\n                    ' + (info.name ? '' : 'commented' /* ${(info.email) ? `<p class="mt-0 mb-1">${info.email}</p>` : ''}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ${(info.phone) ? `<p class="mt-0 mb-1">${info.phone}</p>` : ''} */) + '\n                    \n                </div>\n                <div class="col">                        \n                    ' + (checkpoint.status === 'TRIGGERED' ? '<button class="btn btn-outline-secondary js_pass-checkpoint-btn d-block mx-auto" data-checkpoint-type="' + checkpoint.type + '" data-toggle="modal" data-target="#security-code">\n                    <i class="fas fa-key"></i>\u041F\u0440\u043E\u0439\u0442\u0438 \u0447\u0435\u043A\u043F\u043E\u0438\u043D\u0442</button>' : '') + '\n                </div>\n                ' + stats(info) + '\n            </div>\n        </li>').appendTo(cList);
        }
    });
}

/**
 * Init header
 */
function init() {
    var $msgList = $('.accounts-list');
    // check we are in profile page
    if (!$msgList.length) {
        return;
    }
    var token = _user2.default.getToken(); // upd to: User.getToken()
    var metadata = _user2.default.getMetadata(token);
    var resendRequest = function resendRequest() {
        return _user2.default.getMetadata(token);
    };
    var isSendReqOnce = false;
    var checkResponse = function checkResponse(result, isResendRequest) {
        if (!result.status.state === 'ok' || !result.data || !$msgList.length || isResendRequest) {
            // проверям один раз наличие result.data.accounts.info
            $msgList.empty();
            $('<li class="media">\n                <div class="media-body">\n                    <h3 class="mt-0 mb-3">\u041D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0410\u043A\u043A\u0430\u0443\u043D\u0442\u0430 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E</h3>\n                </div>\n            </li>').appendTo($msgList);
            setTimeout(function () {
                resendRequest().then(function (result) {
                    checkResponse(result, false);
                });
                console.log('Request resend');
            }, 3500);
            return;
        }
        // вывод результатов (data.accounts.info)
        $('.profile-user .spinner-box').addClass('d-none');
        fillList($msgList, result.data.accounts);
        addListHandler();
    };

    // check we are in profile page
    if (!$msgList.length) {
        return;
    }

    addOnLoadHandlers();

    // может инфо отсутсвовать - сделать еще раз запрос через 3 сек.

    metadata.then(function (result) {
        // проверям один раз наличие result.data.accounts.info
        var isResendRequest = false;
        if (result.data && result.data.accounts && !isSendReqOnce) {
            result.data.accounts.forEach(function (item) {
                if (!item.info) {
                    isResendRequest = true;
                    isSendReqOnce = true;
                    return;
                }
            });
        }
        checkResponse(result, isResendRequest);
    }).catch(function (err) {
        setTimeout(function () {
            _view2.default.showInfoMessage($('.error-msg'), err.status || '', 'Не получилось загрузить доступные Instagram аккаунты');
        }, 3000);
        $('.spinner-box').addClass('d-none');
    });
}

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.LoginForm = LoginForm;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _cookie = __webpack_require__(3);

var _cookie2 = _interopRequireDefault(_cookie);

var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// window.$ = $;

// import Validator from '../../common/js-services/form-validator';
function LoginForm(selectorCss) {
    var _this = this;

    var _formId = selectorCss._formId,
        _buttonSubmitId = selectorCss._buttonSubmitId,
        _showLoginBoxBtnId = selectorCss._showLoginBoxBtnId,
        _loginBox = selectorCss._loginBox;

    var user = _user2.default,
        // service
    $form = $(_formId),
        $email = $form.find('input[name="mail"]'),
        $textAreaDescription = $('#description');
    // const openedClass = 'd-block';
    // const closeClass = 'd-none';

    var userLoginHeader = function userLoginHeader(_formData) {
        var cbError = function cbError(result) {
            $(_loginBox).append('<p>result.status.message</p>');
        };

        return user.login(_formData, cbError).then(function (result) {
            if (result && result.data && result.data.token) {
                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                $('.nav-link.js_logOut').parent().show();
                // console.log('request succeeded with JSON response', result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login succsess');
            } else if (result.status) {
                console.log(result);
                _view2.default.showInfoMessage(_this.$textAreaDescription, '<p>status: ' + result.status.state + '</p><p> message: ' + result.status.message + '</p>');
            } else {
                console.log(result);
            }
        }).then(function (result) {
            if (result && result.status) {
                console.log(result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login error');
            }
        });
    };

    var submitForm = function submitForm(formDataObj) {
        var email = $email.val(),
            password = $form.find('input[name="pass"]').val(),
            _formData = formDataObj || { email: email, password: password };

        if (selectorCss.isLoginInstagram) {
            // todo: delete me
            // addInstagramAccount({username: $form.find('input[name="username"]').val(), password});
        } else {
            $email.val($email.val().toLocaleLowerCase());
            userLoginHeader(_formData).then(function () {
                _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGGED, 'login');
            });
        }
    };

    var logOut = function logOut() {
        _cookie2.default.remove(_consts.CONST.cookieStorage.token);
        _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGOUT);
    };

    var bindEvents = function bindEvents() {
        var $showLoginBoxBtnId = $(_showLoginBoxBtnId);
        var $loginBox = $(_loginBox);
        var openedClass = 'd-block';
        var closeClass = 'd-none';

        $showLoginBoxBtnId.on('click', function () {
            if (!selectorCss.isLoginInstagram) {
                $loginBox.css({ 'top': 0, 'right': 0 }).addClass('bg-light border mt-5 mx-auto position-absolute');
            }
            $loginBox.addClass(openedClass).removeClass(closeClass);
        });

        var $buttonSubmit = $(_buttonSubmitId),
            cssValidationClass = 'form-validation';

        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            var form = $form.get(0);
            // const validator = new Validator($form);
            // console.log(validator.validate());
            if (form.checkValidity() && _view2.default.isEmail($email.val())) {
                submitForm();
            } else {
                // Highlight errors
                if (form.reportValidity) {
                    form.reportValidity();
                }
                $form.addClass(cssValidationClass);
            }
        });

        $('.nav-link.js_logOut').on('click', function (e) {
            e.preventDefault();
            logOut();
            $(e.target).parent().hide();
            _view2.default.showInfoMessage($textAreaDescription, 'Logged out');
        });

        _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGOUT, function (msg) {
            $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(openedClass).removeClass(closeClass); // .show();
            $(_consts.CONST.uiSelectors.headerRegBtn).addClass(openedClass).removeClass(closeClass);
            $('.nav-link.js_logOut').addClass(closeClass).removeClass(openedClass); // .hide();
            var selectorLoginState = '.js_message_logged--text';
            $(selectorLoginState).text('Вы вышли из аккаунта');
        });

        $(document).on('click', function (event) {
            var isLoginBtnClick = $(event.target).closest('nav.navbar').find($loginBox).length;
            var isAddInstagramBtnClicked = $(event.target).attr('id') === _consts.CONST.uiSelectors.instagram.addAccountBtnId;

            if (!isLoginBtnClick && $loginBox.hasClass(openedClass) && !isAddInstagramBtnClicked) {
                $loginBox.addClass(closeClass).removeClass(openedClass);
            }
        });
    };

    function init() {
        bindEvents();
    }

    return {
        init: init
    };
} // https://www.npmjs.com/package/pubsub-js
/* eslint-disable sort-vars */
// import $ from 'jquery';

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var conversation = {
    'data': {
        'meta': {
            'pagination': {
                'prev_cursor': '...',
                'next_cursor': '...'
            },
            'messages': [{
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'photo', // photo, video, gif, like, link
                'value': 'http://www.zr.ru/d/story/ad/913581/0-0.jpg',
                'timestamp': '14:33'

            }, {
                'side': 'right',
                'type': 'text',
                'value': 'Йоу(right)',
                'timestamp': '14:32'
            }, {
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'text', // photo, video, gif, like, link
                'value': 'Заходи сюда: google.com',
                'timestamp': '14:34'
            }, {
                'username': 'Nika',
                'profile_pic_url': 'https://instagram.fhel2-1.fna.fbcdn.net/vp/c9d3add4b34748e12a4229350fb611e4/5CC667B8/t51.2885-19/s150x150/41710527_319004788655082_1651515706719600640_n.jpg?_nc_ht=instagram.fhel2-1.fna.fbcdn.net',
                'side': 'left',
                'type': 'link', // photo, video, gif, like, link
                'value': 'http://www.zr.ru/d/story/ad/913581/0-0.jpg',
                'timestamp': '14:33'
            }, {
                'side': 'right',
                'type': 'photo',
                'value': 'https://s.auto.drom.ru/i24224/pubs/4/63060/gen340_2880636.jpg',
                'timestamp': '19:38'
            }, {
                'side': 'right',
                'type': 'text',
                'value': 'demos -> fineuploader.com',
                'timestamp': '19:38'
            }, {
                'side': 'right',
                'type': 'link',
                'value': 'https://fineuploader.com/demos#gallery-view',
                'timestamp': '19:38'
            }]
        }
    }
};

var userList = {
    'data': {
        'settings': {
            'do_notification': true,
            'invoke_in_millis': 3000
        },
        'meta': [{
            'username': 'the_rostyslav',
            'unread_conversations': 0,
            'pagination': {
                'prev_cursor': '...',
                'next_cursor': '...'
            },
            'conversations': [{
                'id': '1',
                'name': 'Тест1',
                'to': [{
                    'username': 'dianacober7',
                    'profile_pic_url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAyVBMVEX///+re1CSXkV4QDqAqr9kl7GibT1eMi1zobhke5BxMyzDsK+mdU6KUDJuLCOQWj+fbUvn4N+ndUXXxLWsiXukbjrbrJiETz9TjqpkNTB1PDmpeEuVYUOIW0BqJBpZLCvv5+G/nIHk6/BxRTalajOInqlzj52aXh+NnKt1OjPNurK8xMyaeHXNnYmee2C5iHONsMOgvs5fAACDQRnAp5ygdWL38/DbzcZ9QjDQw8GUbmqVZUa7lnivjHHMtKKbZ0LBkXw/hKSnZSAqI9PKAAADR0lEQVR4nO3d21YaMRhAYbWCtB0QEKqAFbS0atXagkc81vd/qF41+amZhgxJJq619+WsyeFzbuIoi5UVIiIiIiIiIiIiKrXbj3G7jS6cNT7ErDGLLjw9fhez41OECBEiRIgQYSxhSzcLJtwWaeFMrB1QOGmoggH72apqt6+JeulJQOFeKJYUNrVwrW+6Yw8hQoQIESJE+EaFfZ35TBNQ2JrsqcIBtWp1W2jNd+sNTXycUVuNYK4cocO4BkKECL2FMC+ECBEuDjD3ZoT9nqWNu6z5uuxuQ9/yRScG5pzaogt7G5aG4tcFUXNoG9hDiBAhQoQIEZYs1Iev3tCYk9A8Rc/2TiqkcE332dzQQTjMmUOsElso32rm5CS0zpYZn2JIoXnT4YRNhAgRIkSIEKF34dVIdX2zbcp+phGvz8w3Z+IO62yZcRc313qjV07CrXH1b23r4mXWVvscb7kJ03aZaiNEmHwIEaYfQoSvqnZVbZG+2nXaX9c2XTW2sCpOgSfvVUdiDhdiV4w70tOd6KtXNqJ34SiycIQQIUKECBEiROhfOLjfVz380Omr+wMH4UCME7M96Kv3tum8n7wHIvNlB2DeuJxF4giTCyHC9EOIMP0Q/isUb7zK3vp/E6/l3ISjLdXjk+GzEvMfnAi2f9PHNOZ6etQbHTkJJba+Zsn+J/2iNW1L1wuzRK2khV7+FwMhQoQIESJEuIgwC1UqwhJDiBBh+SFEiLD8ECJEWH4IESIsP4QIEZafH+G0riq6kU2dF5dq6uW7LvQ3Z9j/WJoDfD5TnXsAjsJ9mUdR4dkn1fnyT7Hum4UQIUKECBEinGta7PTlRaiXngYUftdduuzuXOc0TnQp1g4oFHXcnuKyJ+/NThxWYeHSIUSIECFChIkKbbkJbMUXXnRs7bpkne0iutDeYXXxDsvebKEQIkw/hAjTDyHC9HuTwt87pio1Y2M7TDU2TpwzcyWgcKdiqrZuzElonDhn5hpChAgRIkSIMB3hy3jxXsoUHvzSuexj/Zuxr+acZv6pWj/wIRTLOO0jxs07CBEiRIgQIUKECwpzXqUlUcWLUBy3zT/SmvkBxLi5hhAhQoQIESJEiBAhQoQIESJEiBBhKsI/XikgQrJf9G0AAAAASUVORK5CYII='
                }, {
                    'username': 'your_dieta',
                    'profile_pic_url': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAw1BMVEX///+re1CRd15Em8XPqYYbhbiibT3brJiPd19ke5DMo32te0+eeVf17umpeEzIoHysmomJbVCndUXq5uPXxLXo18jg7PMxlMG/nIGmelPavaTSrIqXeFvv5+EmirujbDsAh7+pay6ig2yzhl2+k20AfLRFgKN+enXNoo16s9KNcl/NwrqHaUyee2BTboa4k328xMx1e4SfiXWwaRvInHG/sqeslH/MtqTjzbvh5ehJZ4BqcXzcwanUs5WvjHG7lnhYe5eai2xoAAAD/klEQVR4nO3cbVfTSBiAYQyli7SppUChUAwVWN9Qd1WQfUH5/79KP8g8T/c82emEmUl6vO+POcnMXC09DGl0Y4OIiIiIfrnKY9edOnwrhw/sC+/kjDLLSptW7vQe2lGHj93hnRqhum49hT2ECDsTQoQI2w/hOgkPzG57yiLdyeF/7QtF2Lu1z8guPN6x6qn8h0POOM4v7OUNIUKECBEiRJhNWEpK+CxdSliaxRZ+NrdZF6NUXahZzL3c59jEpe2jEj5J05LQLPofIggRIkSIECHCFoQnUjphaW/VcgifqA3cuUmMI6xx5RCqECJEiBAhQoTZhCdmF6OBK4JlYI52bm7gYgtPzs2Gc9fw8cSBHk4TpZN0QvPHcTDcLn62PY8gnMtw9gs2alFYRBEWCBEiRIgQ4doIZW813HbN7S3XCi5pLsMNzdEyCYfeQogD/3C5hTWv9EyObgcJ1XWzmp+O7ELz0zKTj2SgUK6bqXfW/IQjRIgQIUKEHRQWQ/mWb1Y8WljMZLhhkUxYnroO1IN0IhzdjF03R5IcHYfcRR2p69RoehI1t1rRgSw0DLtf9R+aqC9iZUl9/3hVgLDyv+Z99XpIE7fOaj9MOPEsqX+aWXja9wwxQYgQIUKECBGuv7DsiPCvv9+7fEOsIPxDhvvHt5HPJXz/9KH7GEI32tM/ESJEiBAhQoQtCO07UdPIQjfcfXbh6NuR1bd3Usj90pE52tHXgOFiC/UdPV3T7/EfP1x0YedCiLD7IUTY/RD+V1hNXE1/iadLrUiWGfj94em+60vDh/HSpR/z+yIL9d/frGlvt9nDeOlSj/nt7jVlLQmbPXyQLvVYA0KECFsKIUKE7ZdSOJOyu9Tc6YSF/lcRuYFq7iKdUFnzC61lIESIECFChAgTCwcB+f/HYO8Q2YV6A+fv1W++/GOYq0gpDMovbDgwQoQIESJEiDCW8GrX1XAdK+xpwlyuqxjCjT1XGUR8JX194SsIWMqSYgB1VyELUe9QEMDbVWwWQoQIESJEiHBZGLKBiyxUW7WEwrfSR++SPkgRhB/V3AmFqvHjFx3UOA8LIUKECBEiRLgsjHCTMaDd/MLrsdlLaR6Sus4e+Dq70G56eeZaVKu3kMsup20j/rfp5dZDZ4v+6i3O3HUIWw4hQoTthxDhegk/LVyVyarkhE9dET4/tNq6lLYk2YidvbGI1Rt1hrpOj2bO9zyh8HDT6nDLU63Qd2HNfAgRIkSIECHCTgqLhVXREeH0tWRO+GNKq0210t/t1Bk1Y9ipFcXYxE7r5vHle4OWajjHIUKECBEiRIgQYWKhujFXw1K3z9ZSqLEmsCkLIUKECBEiRIgQIUKECBEiRIgQIcIuCr8DS8wc0PgR4R4AAAAASUVORK5CYII='
                }],
                'last_message': 'йоу',
                'is_unread': false
            }, {
                'id': '2',
                'name': 'Sergant',
                'to': [{
                    'username': 'dianacober7',
                    'profile_pic_url': 'data:image/png;base64,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'
                }],
                'param_value': 'dianacober7',
                'last_message': '\u0416\u0456\u043D\u043E\u0447\u043A\u043E \uD83D\uDE0A',
                'is_unread': false
            }]
        }]
    }

};

exports.userList = userList;
exports.conversation = conversation;

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.init = init;

var _dataServer = __webpack_require__(11);

var data = _interopRequireWildcard(_dataServer);

var _meteorEmoji = __webpack_require__(20);

var _meteorEmoji2 = _interopRequireDefault(_meteorEmoji);

var _fineUploader = __webpack_require__(19);

var _fineUploader2 = _interopRequireDefault(_fineUploader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

$(document).ready(function () {
    // eslint-disable-next-line no-unused-vars
    var m = new _meteorEmoji2.default();
    var $picker = $('textarea[data-meteor-emoji="true"] ~ div');
    var style = $picker.attr('style');
    var styleNew = style.replace('top: 30px;', 'top: -210px;');
    $picker.attr('style', styleNew);
});

$(document).ready(function () {
    // eslint-disable-next-line no-unused-vars
    var restrictedUploader = new _fineUploader2.default.FineUploader({
        element: document.getElementById('fine-uploader-validation'),
        template: 'qq-template-validation',
        request: {
            endpoint: '/server/uploads'
        },
        thumbnails: {
            placeholders: {
                waitingPath: 'https://fineuploader.com/source/placeholders/waiting-generic.png', // '/source/placeholders/waiting-generic.png',
                notAvailablePath: 'https://fineuploader.com/server/waiting-generic.png' // '/source/placeholders/not_available-generic.png'
            }
        },
        validation: {
            allowedExtensions: ['jpeg', 'jpg', 'txt'],
            itemLimit: 3,
            sizeLimit: 500 * 1024
        }
    });
});

function fillList($list, dataArray) {
    var items = dataArray;
    var cList = $list;
    // const defaultAvatarSrc = 'https://i.imgur.com/jNNT4LE.png';
    var insertMsg = function insertMsg(value, type, cssCls) {
        var str = '';
        switch (type) {
            case 'photo':
                str = '<div class="chat-img">\n                    <img src="' + value + '" alt="Content Image" class="content-image">\n                </div>';
                break;
            case 'link':
                str = '<div class="chat-img">\n                <a target="_blank" href="' + value + '">' + value + '</a>';
                break;
            default:
                str = '<div class="chat-text" >' + value + '</div>';
        }
        return str;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item) {
        var message = item;
        // const checkpoint = item.checkpoint || item;

        if (message.side === 'left') {
            $('<li class="chat-item chat-item-left" value="' + message.value + '">\n                <div class="d-flex">\n                ' + (message['profile_pic_url'] ? '<div class="chat-img-box"> \n                         <img src="' + message['profile_pic_url'] + '" alt="User Avatar" class="">\n                        </div>' : '') + '\n                <div>\n                    <p class="chat-username text-muted">' + message.username + '</p>\n                    ' + insertMsg(message.value, message.type) + '\n                </div>\n                    <small class="chat-time-text">' + message.timestamp + '</small>\n                </div>\n            </li>').appendTo(cList);
        } else {
            $('<li class="chat-item justify-content-end chat-item-right" value="' + message.value + '">\n                <div class="d-flex">\n                    ' + insertMsg(message.value, message.type) + '\n                    <small class="pull-right chat-time-text">' + message.timestamp + '</small>\n                    </div>\n            </li>').appendTo(cList);
        }
    });
}
function fillUserList($list, dataArray) {
    var items = dataArray;
    var cList = $list;
    var to = function to(items) {
        var tpl = '';
        items.forEach(function (item) {
            tpl += '<div>\n                <img src="' + item['profile_pic_url'] + '" class="media-photo" style="width: 24px;">\n                ' + item.username + '\n            </div>';
        });
        return tpl;
    };
    cList.empty().addClass('border-light-color');
    items.forEach(function (item) {
        $('<li class="list-group-item">\n            <div class="media">\n                <a href="#" class="mr-3">\n                    <img src="https://i.imgur.com/jNNT4LE.png"\n                    class="media-photo">\n                </a>\n            <span class="badge badge-secondary position-absolute p-2">3</span>\n            <div class="media-body">\n                <h4 class="title">\n                    ' + item.name + '\n                    <small class="text-muted time">11.02.2018</small>\n                </h4>\n                ' + to(item.to) + '\n                <p class="summary">' + item['last_message'] + '</p>\n            </div>\n            </li>').appendTo(cList);
    });
}

function addHandlers() {
    // let checkpointType = '';

    $('#sendMessageButton').on('click', function (e) {
        // const $button = $(e.target);
        var userMsg = $('#sendMessageTextArea').val();
        console.log(userMsg);
        // console.log($button);
    });
}

function init() {
    var conversation = data.conversation,
        userList = data.userList;

    var $msgList = $('.messages-list');
    var $userList = $('.messages-user-list');
    // check we are in correct page (messages)
    if (!$msgList.length) {
        return;
    }
    fillList($msgList, conversation.data.meta.messages);
    fillUserList($userList, userList.data.meta[0].conversations);
    addHandlers();
}

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';
// https://www.npmjs.com/package/pubsub-js


var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _cookie = __webpack_require__(3);

var _cookie2 = _interopRequireDefault(_cookie);

var _consts = __webpack_require__(0);

var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var selectorCls = {
    form: '.auth.register .form-signin',
    submitBtn: '[type="submit"]'
};

var RegisterForm = function () {
    function RegisterForm() {
        _classCallCheck(this, RegisterForm);

        this.user = _user2.default;
        this.$form = $(selectorCls.form);
        this.$email = this.$form.find('input[name="mail"]');
        this.$textAreaDescription = $('#description');
        this.formData = { 'email': 'test1_email@m.ru', 'password': 'password' };
    }

    _createClass(RegisterForm, [{
        key: 'init',
        value: function init() {
            if ($('.auth.register').length) {
                this.bindEvents();
            }
        }
    }, {
        key: 'submitForm',
        value: function submitForm(formDataObj) {
            var _this = this;

            var email = this.$email.val();
            var $password = this.$form.find('input[name="pass"]'),
                $passwordConfirm = this.$form.find('input[name="pass-confirm"]'),
                password = this.$form.find('input[name="pass"]').val(),
                passwordConfirm = this.$form.find('input[name="pass-confirm"]').val();

            if (passwordConfirm !== password) {
                $password.addClass('input-error');
                $passwordConfirm.addClass('input-error');
                return;
            }
            this.$email.val(this.$email.val().toLocaleLowerCase());
            this.formData = formDataObj || { email: email, password: password };

            this.user.register(this.formData).then(function (result) {
                if (result.data && result.data.token) {

                    // save the item
                    _cookie2.default.set(_consts.CONST.cookieStorage.emailConfirmed, 'false');

                    _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                    // console.log('request succeeded with JSON response', result);
                    _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGGED);
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state, result.status.message || 'Register and Login succsess');
                } else {
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state, result.status.message || 'no result.data found');
                }
            }).then(function (result) {
                if (result && result.status) {
                    console.log(result);
                    _view2.default.showInfoMessage(_this.$textAreaDescription, result.status.state);
                    $('.login-box').show();
                }
            }).catch(function (error) {
                console.log('request failed', error);
                _view2.default.showInfoMessage(_this.$textAreaDescription, error.message);
                console.log('do something');
            });
        }
    }, {
        key: 'bindEvents',
        value: function bindEvents() {
            var _this2 = this;

            var registerBox = _consts.CONST.uiSelectors.headerRegBox; // 'nav .register-box';
            var openedClass = 'd-block';
            var closeClass = 'd-none';
            var $btn = $(selectorCls.submitBtn),
                cssValidationClass = 'form-validation';

            $btn.on('click', function (e) {
                var form = _this2.$form.get(0);
                e.preventDefault();

                if (!$btn.is(':disabled')) {
                    if (form.checkValidity()) {
                        // $btn.attr('disabled', true);
                        _this2.submitForm();
                    } else {
                        // Highlight errors
                        if (form.reportValidity) {
                            form.reportValidity();
                        }
                        _this2.$form.addClass(cssValidationClass);
                    }
                }
            });

            $(document).on('click', function (event) {
                var isRegBtnClick = $(event.target).closest('nav.navbar').find('.register-box').length;

                if (!isRegBtnClick && $(registerBox).hasClass(openedClass)) {
                    $(registerBox).addClass(closeClass).removeClass(openedClass);
                }
            });
        }
    }]);

    return RegisterForm;
}();

exports.default = RegisterForm;

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import $ from 'jquery';


var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Network = function () {
    function Network() {
        _classCallCheck(this, Network);
    }

    _createClass(Network, [{
        key: 'cbErrorDefault',
        value: function cbErrorDefault(result) {
            var $el = $('#description').length ? $('#description') : $('.error-msg');
            _view2.default.showInfoMessage($el, result.status.state, result.status.message || 'Login error');
        }
    }, {
        key: 'checkStatus',
        value: function checkStatus(response) {
            if (response.status && response.status >= 200 && response.status < 300) {
                return response;
            } else {
                var error = new Error(response.statusText);
                error.response = response;
                throw error;
            }
        }
    }, {
        key: 'sendRequest',
        value: function sendRequest(URL, OPTS, cbError) {
            var _this = this;

            return fetch(URL, OPTS).then(function (response) {
                return Promise.all([response, response.json()]);
            }).then(function (_ref) {
                var _ref2 = _slicedToArray(_ref, 2),
                    response = _ref2[0],
                    json = _ref2[1];

                if (!response.ok) {
                    if (!cbError) {
                        _this.cbErrorDefault(json);
                    } else {
                        cbError(json); // update view
                    }
                    _this.checkStatus(response);
                    // throw new Error(json.status.message);
                }
                return json;
            });
        }
    }]);

    return Network;
}();

exports.default = Network;

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.LoginPage = LoginPage;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _pubsubJs = __webpack_require__(4);

var _pubsubJs2 = _interopRequireDefault(_pubsubJs);

var _cookie = __webpack_require__(3);

var _cookie2 = _interopRequireDefault(_cookie);

var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

var _consts = __webpack_require__(0);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// window.$ = $;

// import Validator from '../../common/js-services/form-validator';
function LoginPage(selectorCss) {
    var _this = this;

    var _formId = selectorCss._formId,
        _buttonSubmitId = selectorCss._buttonSubmitId,
        _loginBox = selectorCss._loginBox;

    var user = _user2.default,
        // service
    $form = $(_formId),
        $email = $form.find('input[name="mail"]'),
        $textAreaDescription = $('#description');
    // const openedClass = 'd-block';
    // const closeClass = 'd-none';

    var userLoginHeader = function userLoginHeader(_formData) {
        var cbError = function cbError(result) {
            $(_loginBox).append('<p>result.status.message</p>');
        };

        return user.login(_formData, cbError).then(function (result) {
            if (result && result.data && result.data.token) {
                // save the item
                _cookie2.default.set(_consts.CONST.cookieStorage.token, result.data.token);
                $('.nav-link.js_logOut').parent().show();
                // console.log('request succeeded with JSON response', result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login succsess');
            } else if (result.status) {
                console.log(result);
                _view2.default.showInfoMessage(_this.$textAreaDescription, '<p>status: ' + result.status.state + '</p><p> message: ' + result.status.message + '</p>');
            } else {
                console.log(result);
            }
        }).then(function (result) {
            if (result && result.status) {
                console.log(result);
                _view2.default.showInfoMessage($textAreaDescription, result.status.state, result.status.message || 'Login error');
            }
        });
    };

    var submitForm = function submitForm(formDataObj) {
        var email = $email.val(),
            password = $form.find('input[name="pass"]').val(),
            _formData = formDataObj || { email: email, password: password };

        if (selectorCss.isLoginInstagram) {
            // todo: delete me
            // addInstagramAccount({username: $form.find('input[name="username"]').val(), password});
        } else {
            $email.val($email.val().toLocaleLowerCase());
            userLoginHeader(_formData).then(function () {
                // PubSub.publish(CONST.events.USER_LOGGED, 'login');
                window.location.href = '/instagram-integration/instagram-accounts.html';
            });
        }
    };

    var logOut = function logOut() {
        _cookie2.default.remove(_consts.CONST.cookieStorage.token);
        _pubsubJs2.default.publish(_consts.CONST.events.USER_LOGOUT);
    };

    var bindEvents = function bindEvents() {
        // const $showLoginBoxBtnId = $(_showLoginBoxBtnId);
        var $loginBox = $(_loginBox);
        var openedClass = 'd-block';
        var closeClass = 'd-none';

        // $showLoginBoxBtnId.on('click', () => {
        //     if (!selectorCss.isLoginInstagram) {
        //         $loginBox.css({'top': 0, 'right': 0})
        //             .addClass('bg-light border mt-5 mx-auto position-absolute');
        //     }
        //     $loginBox.addClass(openedClass).removeClass(closeClass);
        // });

        var $buttonSubmit = $(_buttonSubmitId),
            cssValidationClass = 'form-validation';

        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            var form = $form.get(0);
            // const validator = new Validator($form);
            console.log(_view2.default, _view2.default.isEmail($email.val()));

            if (form.checkValidity() && _view2.default.isEmail($email.val())) {
                submitForm();
            } else {
                // Highlight errors
                if (form.reportValidity) {
                    form.reportValidity();
                }
                $form.addClass(cssValidationClass);
            }
        });

        $('.nav-link.js_logOut').on('click', function (e) {
            e.preventDefault();
            logOut();
            $(e.target).parent().hide();
            _view2.default.showInfoMessage($textAreaDescription, 'Logged out');
        });

        _pubsubJs2.default.subscribe(_consts.CONST.events.USER_LOGOUT, function (msg) {
            $(_consts.CONST.uiSelectors.headerNavLoginBtn).addClass(openedClass).removeClass(closeClass); // .show();
            $(_consts.CONST.uiSelectors.headerRegBtn).addClass(openedClass).removeClass(closeClass);
            $('.nav-link.js_logOut').addClass(closeClass).removeClass(openedClass); // .hide();
            var selectorLoginState = '.js_message_logged--text';
            $(selectorLoginState).text('Вы вышли из аккаунта');
        });

        $(document).on('click', function (event) {
            var isLoginBtnClick = $(event.target).closest('nav.navbar').find($loginBox).length;
            var isAddInstagramBtnClicked = $(event.target).attr('id') === _consts.CONST.uiSelectors.instagram.addAccountBtnId;

            if (!isLoginBtnClick && $loginBox.hasClass(openedClass) && !isAddInstagramBtnClicked) {
                $loginBox.addClass(closeClass).removeClass(openedClass);
            }
        });
    };

    function init() {
        if ($('.auth.login').length) {
            bindEvents();
        }
    }

    return {
        init: init
    };
} // https://www.npmjs.com/package/pubsub-js
/* eslint-disable sort-vars */
// import $ from 'jquery';

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Instagram = Instagram;

var _user = __webpack_require__(1);

var _user2 = _interopRequireDefault(_user);

var _view = __webpack_require__(2);

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import {CONST} from '../../common/js-services/consts';

/* eslint-disable sort-vars */
// import $ from 'jquery';
function Instagram() {
    var selectorCSS = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var $buttonSubmit = $('#js_instagram-get-accounts--btn');
    var user = _user2.default,
        // service
    $list = $('.instagram-accounts-list');

    var submitForm = function submitForm(formDataObj) {
        if ($buttonSubmit.length) {
            user.getInstagramAccount().then(function (result) {
                if (result && result.status) {
                    console.log(result);
                    _view2.default.fillList($list, result.data.accounts || 'Login error');
                }
            });

            console.log('getInstagramAccount ', $buttonSubmit);
            return;
        }
    };

    var bindEvents = function bindEvents() {
        $buttonSubmit.on('click', function (e) {
            e.preventDefault();
            submitForm();
        });
    };

    function init() {
        bindEvents();
    }

    return {
        init: init
    };
}
// import cookieStorage from '../../common/js-services/cookie';

/***/ }),
/* 17 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;// Fine Uploader 5.16.2 - MIT licensed. http://fineuploader.com
(function(global) {
    var qq = function(element) {
        "use strict";
        return {
            hide: function() {
                element.style.display = "none";
                return this;
            },
            attach: function(type, fn) {
                if (element.addEventListener) {
                    element.addEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.attachEvent("on" + type, fn);
                }
                return function() {
                    qq(element).detach(type, fn);
                };
            },
            detach: function(type, fn) {
                if (element.removeEventListener) {
                    element.removeEventListener(type, fn, false);
                } else if (element.attachEvent) {
                    element.detachEvent("on" + type, fn);
                }
                return this;
            },
            contains: function(descendant) {
                if (!descendant) {
                    return false;
                }
                if (element === descendant) {
                    return true;
                }
                if (element.contains) {
                    return element.contains(descendant);
                } else {
                    return !!(descendant.compareDocumentPosition(element) & 8);
                }
            },
            insertBefore: function(elementB) {
                elementB.parentNode.insertBefore(element, elementB);
                return this;
            },
            remove: function() {
                element.parentNode.removeChild(element);
                return this;
            },
            css: function(styles) {
                if (element.style == null) {
                    throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");
                }
                if (styles.opacity != null) {
                    if (typeof element.style.opacity !== "string" && typeof element.filters !== "undefined") {
                        styles.filter = "alpha(opacity=" + Math.round(100 * styles.opacity) + ")";
                    }
                }
                qq.extend(element.style, styles);
                return this;
            },
            hasClass: function(name, considerParent) {
                var re = new RegExp("(^| )" + name + "( |$)");
                return re.test(element.className) || !!(considerParent && re.test(element.parentNode.className));
            },
            addClass: function(name) {
                if (!qq(element).hasClass(name)) {
                    element.className += " " + name;
                }
                return this;
            },
            removeClass: function(name) {
                var re = new RegExp("(^| )" + name + "( |$)");
                element.className = element.className.replace(re, " ").replace(/^\s+|\s+$/g, "");
                return this;
            },
            getByClass: function(className, first) {
                var candidates, result = [];
                if (first && element.querySelector) {
                    return element.querySelector("." + className);
                } else if (element.querySelectorAll) {
                    return element.querySelectorAll("." + className);
                }
                candidates = element.getElementsByTagName("*");
                qq.each(candidates, function(idx, val) {
                    if (qq(val).hasClass(className)) {
                        result.push(val);
                    }
                });
                return first ? result[0] : result;
            },
            getFirstByClass: function(className) {
                return qq(element).getByClass(className, true);
            },
            children: function() {
                var children = [], child = element.firstChild;
                while (child) {
                    if (child.nodeType === 1) {
                        children.push(child);
                    }
                    child = child.nextSibling;
                }
                return children;
            },
            setText: function(text) {
                element.innerText = text;
                element.textContent = text;
                return this;
            },
            clearText: function() {
                return qq(element).setText("");
            },
            hasAttribute: function(attrName) {
                var attrVal;
                if (element.hasAttribute) {
                    if (!element.hasAttribute(attrName)) {
                        return false;
                    }
                    return /^false$/i.exec(element.getAttribute(attrName)) == null;
                } else {
                    attrVal = element[attrName];
                    if (attrVal === undefined) {
                        return false;
                    }
                    return /^false$/i.exec(attrVal) == null;
                }
            }
        };
    };
    (function() {
        "use strict";
        qq.canvasToBlob = function(canvas, mime, quality) {
            return qq.dataUriToBlob(canvas.toDataURL(mime, quality));
        };
        qq.dataUriToBlob = function(dataUri) {
            var arrayBuffer, byteString, createBlob = function(data, mime) {
                var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
                if (blobBuilder) {
                    blobBuilder.append(data);
                    return blobBuilder.getBlob(mime);
                } else {
                    return new Blob([ data ], {
                        type: mime
                    });
                }
            }, intArray, mimeString;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return createBlob(arrayBuffer, mimeString);
        };
        qq.log = function(message, level) {
            if (window.console) {
                if (!level || level === "info") {
                    window.console.log(message);
                } else {
                    if (window.console[level]) {
                        window.console[level](message);
                    } else {
                        window.console.log("<" + level + "> " + message);
                    }
                }
            }
        };
        qq.isObject = function(variable) {
            return variable && !variable.nodeType && Object.prototype.toString.call(variable) === "[object Object]";
        };
        qq.isFunction = function(variable) {
            return typeof variable === "function";
        };
        qq.isArray = function(value) {
            return Object.prototype.toString.call(value) === "[object Array]" || value && window.ArrayBuffer && value.buffer && value.buffer.constructor === ArrayBuffer;
        };
        qq.isItemList = function(maybeItemList) {
            return Object.prototype.toString.call(maybeItemList) === "[object DataTransferItemList]";
        };
        qq.isNodeList = function(maybeNodeList) {
            return Object.prototype.toString.call(maybeNodeList) === "[object NodeList]" || maybeNodeList.item && maybeNodeList.namedItem;
        };
        qq.isString = function(maybeString) {
            return Object.prototype.toString.call(maybeString) === "[object String]";
        };
        qq.trimStr = function(string) {
            if (String.prototype.trim) {
                return string.trim();
            }
            return string.replace(/^\s+|\s+$/g, "");
        };
        qq.format = function(str) {
            var args = Array.prototype.slice.call(arguments, 1), newStr = str, nextIdxToReplace = newStr.indexOf("{}");
            qq.each(args, function(idx, val) {
                var strBefore = newStr.substring(0, nextIdxToReplace), strAfter = newStr.substring(nextIdxToReplace + 2);
                newStr = strBefore + val + strAfter;
                nextIdxToReplace = newStr.indexOf("{}", nextIdxToReplace + val.length);
                if (nextIdxToReplace < 0) {
                    return false;
                }
            });
            return newStr;
        };
        qq.isFile = function(maybeFile) {
            return window.File && Object.prototype.toString.call(maybeFile) === "[object File]";
        };
        qq.isFileList = function(maybeFileList) {
            return window.FileList && Object.prototype.toString.call(maybeFileList) === "[object FileList]";
        };
        qq.isFileOrInput = function(maybeFileOrInput) {
            return qq.isFile(maybeFileOrInput) || qq.isInput(maybeFileOrInput);
        };
        qq.isInput = function(maybeInput, notFile) {
            var evaluateType = function(type) {
                var normalizedType = type.toLowerCase();
                if (notFile) {
                    return normalizedType !== "file";
                }
                return normalizedType === "file";
            };
            if (window.HTMLInputElement) {
                if (Object.prototype.toString.call(maybeInput) === "[object HTMLInputElement]") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            if (maybeInput.tagName) {
                if (maybeInput.tagName.toLowerCase() === "input") {
                    if (maybeInput.type && evaluateType(maybeInput.type)) {
                        return true;
                    }
                }
            }
            return false;
        };
        qq.isBlob = function(maybeBlob) {
            if (window.Blob && Object.prototype.toString.call(maybeBlob) === "[object Blob]") {
                return true;
            }
        };
        qq.isXhrUploadSupported = function() {
            var input = document.createElement("input");
            input.type = "file";
            return input.multiple !== undefined && typeof File !== "undefined" && typeof FormData !== "undefined" && typeof qq.createXhrInstance().upload !== "undefined";
        };
        qq.createXhrInstance = function() {
            if (window.XMLHttpRequest) {
                return new XMLHttpRequest();
            }
            try {
                return new ActiveXObject("MSXML2.XMLHTTP.3.0");
            } catch (error) {
                qq.log("Neither XHR or ActiveX are supported!", "error");
                return null;
            }
        };
        qq.isFolderDropSupported = function(dataTransfer) {
            return dataTransfer.items && dataTransfer.items.length > 0 && dataTransfer.items[0].webkitGetAsEntry;
        };
        qq.isFileChunkingSupported = function() {
            return !qq.androidStock() && qq.isXhrUploadSupported() && (File.prototype.slice !== undefined || File.prototype.webkitSlice !== undefined || File.prototype.mozSlice !== undefined);
        };
        qq.sliceBlob = function(fileOrBlob, start, end) {
            var slicer = fileOrBlob.slice || fileOrBlob.mozSlice || fileOrBlob.webkitSlice;
            return slicer.call(fileOrBlob, start, end);
        };
        qq.arrayBufferToHex = function(buffer) {
            var bytesAsHex = "", bytes = new Uint8Array(buffer);
            qq.each(bytes, function(idx, byt) {
                var byteAsHexStr = byt.toString(16);
                if (byteAsHexStr.length < 2) {
                    byteAsHexStr = "0" + byteAsHexStr;
                }
                bytesAsHex += byteAsHexStr;
            });
            return bytesAsHex;
        };
        qq.readBlobToHex = function(blob, startOffset, length) {
            var initialBlob = qq.sliceBlob(blob, startOffset, startOffset + length), fileReader = new FileReader(), promise = new qq.Promise();
            fileReader.onload = function() {
                promise.success(qq.arrayBufferToHex(fileReader.result));
            };
            fileReader.onerror = promise.failure;
            fileReader.readAsArrayBuffer(initialBlob);
            return promise;
        };
        qq.extend = function(first, second, extendNested) {
            qq.each(second, function(prop, val) {
                if (extendNested && qq.isObject(val)) {
                    if (first[prop] === undefined) {
                        first[prop] = {};
                    }
                    qq.extend(first[prop], val, true);
                } else {
                    first[prop] = val;
                }
            });
            return first;
        };
        qq.override = function(target, sourceFn) {
            var super_ = {}, source = sourceFn(super_);
            qq.each(source, function(srcPropName, srcPropVal) {
                if (target[srcPropName] !== undefined) {
                    super_[srcPropName] = target[srcPropName];
                }
                target[srcPropName] = srcPropVal;
            });
            return target;
        };
        qq.indexOf = function(arr, elt, from) {
            if (arr.indexOf) {
                return arr.indexOf(elt, from);
            }
            from = from || 0;
            var len = arr.length;
            if (from < 0) {
                from += len;
            }
            for (;from < len; from += 1) {
                if (arr.hasOwnProperty(from) && arr[from] === elt) {
                    return from;
                }
            }
            return -1;
        };
        qq.getUniqueId = function() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == "x" ? r : r & 3 | 8;
                return v.toString(16);
            });
        };
        qq.ie = function() {
            return navigator.userAgent.indexOf("MSIE") !== -1 || navigator.userAgent.indexOf("Trident") !== -1;
        };
        qq.ie7 = function() {
            return navigator.userAgent.indexOf("MSIE 7") !== -1;
        };
        qq.ie8 = function() {
            return navigator.userAgent.indexOf("MSIE 8") !== -1;
        };
        qq.ie10 = function() {
            return navigator.userAgent.indexOf("MSIE 10") !== -1;
        };
        qq.ie11 = function() {
            return qq.ie() && navigator.userAgent.indexOf("rv:11") !== -1;
        };
        qq.edge = function() {
            return navigator.userAgent.indexOf("Edge") >= 0;
        };
        qq.safari = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Apple") !== -1;
        };
        qq.chrome = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Google") !== -1;
        };
        qq.opera = function() {
            return navigator.vendor !== undefined && navigator.vendor.indexOf("Opera") !== -1;
        };
        qq.firefox = function() {
            return !qq.edge() && !qq.ie11() && navigator.userAgent.indexOf("Mozilla") !== -1 && navigator.vendor !== undefined && navigator.vendor === "";
        };
        qq.windows = function() {
            return navigator.platform === "Win32";
        };
        qq.android = function() {
            return navigator.userAgent.toLowerCase().indexOf("android") !== -1;
        };
        qq.androidStock = function() {
            return qq.android() && navigator.userAgent.toLowerCase().indexOf("chrome") < 0;
        };
        qq.ios6 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 6_") !== -1;
        };
        qq.ios7 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 7_") !== -1;
        };
        qq.ios8 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_") !== -1;
        };
        qq.ios800 = function() {
            return qq.ios() && navigator.userAgent.indexOf(" OS 8_0 ") !== -1;
        };
        qq.ios = function() {
            return navigator.userAgent.indexOf("iPad") !== -1 || navigator.userAgent.indexOf("iPod") !== -1 || navigator.userAgent.indexOf("iPhone") !== -1;
        };
        qq.iosChrome = function() {
            return qq.ios() && navigator.userAgent.indexOf("CriOS") !== -1;
        };
        qq.iosSafari = function() {
            return qq.ios() && !qq.iosChrome() && navigator.userAgent.indexOf("Safari") !== -1;
        };
        qq.iosSafariWebView = function() {
            return qq.ios() && !qq.iosChrome() && !qq.iosSafari();
        };
        qq.preventDefault = function(e) {
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
        };
        qq.toElement = function() {
            var div = document.createElement("div");
            return function(html) {
                div.innerHTML = html;
                var element = div.firstChild;
                div.removeChild(element);
                return element;
            };
        }();
        qq.each = function(iterableItem, callback) {
            var keyOrIndex, retVal;
            if (iterableItem) {
                if (window.Storage && iterableItem.constructor === window.Storage) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(iterableItem.key(keyOrIndex), iterableItem.getItem(iterableItem.key(keyOrIndex)));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isArray(iterableItem) || qq.isItemList(iterableItem) || qq.isNodeList(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                        if (retVal === false) {
                            break;
                        }
                    }
                } else if (qq.isString(iterableItem)) {
                    for (keyOrIndex = 0; keyOrIndex < iterableItem.length; keyOrIndex++) {
                        retVal = callback(keyOrIndex, iterableItem.charAt(keyOrIndex));
                        if (retVal === false) {
                            break;
                        }
                    }
                } else {
                    for (keyOrIndex in iterableItem) {
                        if (Object.prototype.hasOwnProperty.call(iterableItem, keyOrIndex)) {
                            retVal = callback(keyOrIndex, iterableItem[keyOrIndex]);
                            if (retVal === false) {
                                break;
                            }
                        }
                    }
                }
            }
        };
        qq.bind = function(oldFunc, context) {
            if (qq.isFunction(oldFunc)) {
                var args = Array.prototype.slice.call(arguments, 2);
                return function() {
                    var newArgs = qq.extend([], args);
                    if (arguments.length) {
                        newArgs = newArgs.concat(Array.prototype.slice.call(arguments));
                    }
                    return oldFunc.apply(context, newArgs);
                };
            }
            throw new Error("first parameter must be a function!");
        };
        qq.obj2url = function(obj, temp, prefixDone) {
            var uristrings = [], prefix = "&", add = function(nextObj, i) {
                var nextTemp = temp ? /\[\]$/.test(temp) ? temp : temp + "[" + i + "]" : i;
                if (nextTemp !== "undefined" && i !== "undefined") {
                    uristrings.push(typeof nextObj === "object" ? qq.obj2url(nextObj, nextTemp, true) : Object.prototype.toString.call(nextObj) === "[object Function]" ? encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj()) : encodeURIComponent(nextTemp) + "=" + encodeURIComponent(nextObj));
                }
            };
            if (!prefixDone && temp) {
                prefix = /\?/.test(temp) ? /\?$/.test(temp) ? "" : "&" : "?";
                uristrings.push(temp);
                uristrings.push(qq.obj2url(obj));
            } else if (Object.prototype.toString.call(obj) === "[object Array]" && typeof obj !== "undefined") {
                qq.each(obj, function(idx, val) {
                    add(val, idx);
                });
            } else if (typeof obj !== "undefined" && obj !== null && typeof obj === "object") {
                qq.each(obj, function(prop, val) {
                    add(val, prop);
                });
            } else {
                uristrings.push(encodeURIComponent(temp) + "=" + encodeURIComponent(obj));
            }
            if (temp) {
                return uristrings.join(prefix);
            } else {
                return uristrings.join(prefix).replace(/^&/, "").replace(/%20/g, "+");
            }
        };
        qq.obj2FormData = function(obj, formData, arrayKeyName) {
            if (!formData) {
                formData = new FormData();
            }
            qq.each(obj, function(key, val) {
                key = arrayKeyName ? arrayKeyName + "[" + key + "]" : key;
                if (qq.isObject(val)) {
                    qq.obj2FormData(val, formData, key);
                } else if (qq.isFunction(val)) {
                    formData.append(key, val());
                } else {
                    formData.append(key, val);
                }
            });
            return formData;
        };
        qq.obj2Inputs = function(obj, form) {
            var input;
            if (!form) {
                form = document.createElement("form");
            }
            qq.obj2FormData(obj, {
                append: function(key, val) {
                    input = document.createElement("input");
                    input.setAttribute("name", key);
                    input.setAttribute("value", val);
                    form.appendChild(input);
                }
            });
            return form;
        };
        qq.parseJson = function(json) {
            if (window.JSON && qq.isFunction(JSON.parse)) {
                return JSON.parse(json);
            } else {
                return eval("(" + json + ")");
            }
        };
        qq.getExtension = function(filename) {
            var extIdx = filename.lastIndexOf(".") + 1;
            if (extIdx > 0) {
                return filename.substr(extIdx, filename.length - extIdx);
            }
        };
        qq.getFilename = function(blobOrFileInput) {
            if (qq.isInput(blobOrFileInput)) {
                return blobOrFileInput.value.replace(/.*(\/|\\)/, "");
            } else if (qq.isFile(blobOrFileInput)) {
                if (blobOrFileInput.fileName !== null && blobOrFileInput.fileName !== undefined) {
                    return blobOrFileInput.fileName;
                }
            }
            return blobOrFileInput.name;
        };
        qq.DisposeSupport = function() {
            var disposers = [];
            return {
                dispose: function() {
                    var disposer;
                    do {
                        disposer = disposers.shift();
                        if (disposer) {
                            disposer();
                        }
                    } while (disposer);
                },
                attach: function() {
                    var args = arguments;
                    this.addDisposer(qq(args[0]).attach.apply(this, Array.prototype.slice.call(arguments, 1)));
                },
                addDisposer: function(disposeFunction) {
                    disposers.push(disposeFunction);
                }
            };
        };
    })();
    (function() {
        "use strict";
        if (true) {
            !(__WEBPACK_AMD_DEFINE_RESULT__ = function() {
                return qq;
            }.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
        } else if (typeof module !== "undefined" && module.exports) {
            module.exports = qq;
        } else {
            global.qq = qq;
        }
    })();
    (function() {
        "use strict";
        qq.Error = function(message) {
            this.message = "[Fine Uploader " + qq.version + "] " + message;
        };
        qq.Error.prototype = new Error();
    })();
    qq.version = "5.16.2";
    qq.supportedFeatures = function() {
        "use strict";
        var supportsUploading, supportsUploadingBlobs, supportsFileDrop, supportsAjaxFileUploading, supportsFolderDrop, supportsChunking, supportsResume, supportsUploadViaPaste, supportsUploadCors, supportsDeleteFileXdr, supportsDeleteFileCorsXhr, supportsDeleteFileCors, supportsFolderSelection, supportsImagePreviews, supportsUploadProgress;
        function testSupportsFileInputElement() {
            var supported = true, tempInput;
            try {
                tempInput = document.createElement("input");
                tempInput.type = "file";
                qq(tempInput).hide();
                if (tempInput.disabled) {
                    supported = false;
                }
            } catch (ex) {
                supported = false;
            }
            return supported;
        }
        function isChrome14OrHigher() {
            return (qq.chrome() || qq.opera()) && navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/) !== undefined;
        }
        function isCrossOriginXhrSupported() {
            if (window.XMLHttpRequest) {
                var xhr = qq.createXhrInstance();
                return xhr.withCredentials !== undefined;
            }
            return false;
        }
        function isXdrSupported() {
            return window.XDomainRequest !== undefined;
        }
        function isCrossOriginAjaxSupported() {
            if (isCrossOriginXhrSupported()) {
                return true;
            }
            return isXdrSupported();
        }
        function isFolderSelectionSupported() {
            return document.createElement("input").webkitdirectory !== undefined;
        }
        function isLocalStorageSupported() {
            try {
                return !!window.localStorage && qq.isFunction(window.localStorage.setItem);
            } catch (error) {
                return false;
            }
        }
        function isDragAndDropSupported() {
            var span = document.createElement("span");
            return ("draggable" in span || "ondragstart" in span && "ondrop" in span) && !qq.android() && !qq.ios();
        }
        supportsUploading = testSupportsFileInputElement();
        supportsAjaxFileUploading = supportsUploading && qq.isXhrUploadSupported();
        supportsUploadingBlobs = supportsAjaxFileUploading && !qq.androidStock();
        supportsFileDrop = supportsAjaxFileUploading && isDragAndDropSupported();
        supportsFolderDrop = supportsFileDrop && function() {
            var input = document.createElement("input");
            input.type = "file";
            return !!("webkitdirectory" in (input || document.querySelectorAll("input[type=file]")[0]));
        }();
        supportsChunking = supportsAjaxFileUploading && qq.isFileChunkingSupported();
        supportsResume = supportsAjaxFileUploading && supportsChunking && isLocalStorageSupported();
        supportsUploadViaPaste = supportsAjaxFileUploading && isChrome14OrHigher();
        supportsUploadCors = supportsUploading && (window.postMessage !== undefined || supportsAjaxFileUploading);
        supportsDeleteFileCorsXhr = isCrossOriginXhrSupported();
        supportsDeleteFileXdr = isXdrSupported();
        supportsDeleteFileCors = isCrossOriginAjaxSupported();
        supportsFolderSelection = isFolderSelectionSupported();
        supportsImagePreviews = supportsAjaxFileUploading && window.FileReader !== undefined;
        supportsUploadProgress = function() {
            if (supportsAjaxFileUploading) {
                return !qq.androidStock() && !qq.iosChrome();
            }
            return false;
        }();
        return {
            ajaxUploading: supportsAjaxFileUploading,
            blobUploading: supportsUploadingBlobs,
            canDetermineSize: supportsAjaxFileUploading,
            chunking: supportsChunking,
            deleteFileCors: supportsDeleteFileCors,
            deleteFileCorsXdr: supportsDeleteFileXdr,
            deleteFileCorsXhr: supportsDeleteFileCorsXhr,
            dialogElement: !!window.HTMLDialogElement,
            fileDrop: supportsFileDrop,
            folderDrop: supportsFolderDrop,
            folderSelection: supportsFolderSelection,
            imagePreviews: supportsImagePreviews,
            imageValidation: supportsImagePreviews,
            itemSizeValidation: supportsAjaxFileUploading,
            pause: supportsChunking,
            progressBar: supportsUploadProgress,
            resume: supportsResume,
            scaling: supportsImagePreviews && supportsUploadingBlobs,
            tiffPreviews: qq.safari(),
            unlimitedScaledImageSize: !qq.ios(),
            uploading: supportsUploading,
            uploadCors: supportsUploadCors,
            uploadCustomHeaders: supportsAjaxFileUploading,
            uploadNonMultipart: supportsAjaxFileUploading,
            uploadViaPaste: supportsUploadViaPaste
        };
    }();
    qq.isGenericPromise = function(maybePromise) {
        "use strict";
        return !!(maybePromise && maybePromise.then && qq.isFunction(maybePromise.then));
    };
    qq.Promise = function() {
        "use strict";
        var successArgs, failureArgs, successCallbacks = [], failureCallbacks = [], doneCallbacks = [], state = 0;
        qq.extend(this, {
            then: function(onSuccess, onFailure) {
                if (state === 0) {
                    if (onSuccess) {
                        successCallbacks.push(onSuccess);
                    }
                    if (onFailure) {
                        failureCallbacks.push(onFailure);
                    }
                } else if (state === -1) {
                    onFailure && onFailure.apply(null, failureArgs);
                } else if (onSuccess) {
                    onSuccess.apply(null, successArgs);
                }
                return this;
            },
            done: function(callback) {
                if (state === 0) {
                    doneCallbacks.push(callback);
                } else {
                    callback.apply(null, failureArgs === undefined ? successArgs : failureArgs);
                }
                return this;
            },
            success: function() {
                state = 1;
                successArgs = arguments;
                if (successCallbacks.length) {
                    qq.each(successCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, successArgs);
                    });
                }
                return this;
            },
            failure: function() {
                state = -1;
                failureArgs = arguments;
                if (failureCallbacks.length) {
                    qq.each(failureCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                if (doneCallbacks.length) {
                    qq.each(doneCallbacks, function(idx, callback) {
                        callback.apply(null, failureArgs);
                    });
                }
                return this;
            }
        });
    };
    qq.BlobProxy = function(referenceBlob, onCreate) {
        "use strict";
        qq.extend(this, {
            referenceBlob: referenceBlob,
            create: function() {
                return onCreate(referenceBlob);
            }
        });
    };
    qq.UploadButton = function(o) {
        "use strict";
        var self = this, disposeSupport = new qq.DisposeSupport(), options = {
            acceptFiles: null,
            element: null,
            focusClass: "qq-upload-button-focus",
            folders: false,
            hoverClass: "qq-upload-button-hover",
            ios8BrowserCrashWorkaround: false,
            multiple: false,
            name: "qqfile",
            onChange: function(input) {},
            title: null
        }, input, buttonId;
        qq.extend(options, o);
        buttonId = qq.getUniqueId();
        function createInput() {
            var input = document.createElement("input");
            input.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME, buttonId);
            input.setAttribute("title", options.title);
            self.setMultiple(options.multiple, input);
            if (options.folders && qq.supportedFeatures.folderSelection) {
                input.setAttribute("webkitdirectory", "");
            }
            if (options.acceptFiles) {
                input.setAttribute("accept", options.acceptFiles);
            }
            input.setAttribute("type", "file");
            input.setAttribute("name", options.name);
            qq(input).css({
                position: "absolute",
                right: 0,
                top: 0,
                fontFamily: "Arial",
                fontSize: qq.ie() && !qq.ie8() ? "3500px" : "118px",
                margin: 0,
                padding: 0,
                cursor: "pointer",
                opacity: 0
            });
            !qq.ie7() && qq(input).css({
                height: "100%"
            });
            options.element.appendChild(input);
            disposeSupport.attach(input, "change", function() {
                options.onChange(input);
            });
            disposeSupport.attach(input, "mouseover", function() {
                qq(options.element).addClass(options.hoverClass);
            });
            disposeSupport.attach(input, "mouseout", function() {
                qq(options.element).removeClass(options.hoverClass);
            });
            disposeSupport.attach(input, "focus", function() {
                qq(options.element).addClass(options.focusClass);
            });
            disposeSupport.attach(input, "blur", function() {
                qq(options.element).removeClass(options.focusClass);
            });
            return input;
        }
        qq(options.element).css({
            position: "relative",
            overflow: "hidden",
            direction: "ltr"
        });
        qq.extend(this, {
            getInput: function() {
                return input;
            },
            getButtonId: function() {
                return buttonId;
            },
            setMultiple: function(isMultiple, optInput) {
                var input = optInput || this.getInput();
                if (options.ios8BrowserCrashWorkaround && qq.ios8() && (qq.iosChrome() || qq.iosSafariWebView())) {
                    input.setAttribute("multiple", "");
                } else {
                    if (isMultiple) {
                        input.setAttribute("multiple", "");
                    } else {
                        input.removeAttribute("multiple");
                    }
                }
            },
            setAcceptFiles: function(acceptFiles) {
                if (acceptFiles !== options.acceptFiles) {
                    input.setAttribute("accept", acceptFiles);
                }
            },
            reset: function() {
                if (input.parentNode) {
                    qq(input).remove();
                }
                qq(options.element).removeClass(options.focusClass);
                input = null;
                input = createInput();
            }
        });
        input = createInput();
    };
    qq.UploadButton.BUTTON_ID_ATTR_NAME = "qq-button-id";
    qq.UploadData = function(uploaderProxy) {
        "use strict";
        var data = [], byUuid = {}, byStatus = {}, byProxyGroupId = {}, byBatchId = {};
        function getDataByIds(idOrIds) {
            if (qq.isArray(idOrIds)) {
                var entries = [];
                qq.each(idOrIds, function(idx, id) {
                    entries.push(data[id]);
                });
                return entries;
            }
            return data[idOrIds];
        }
        function getDataByUuids(uuids) {
            if (qq.isArray(uuids)) {
                var entries = [];
                qq.each(uuids, function(idx, uuid) {
                    entries.push(data[byUuid[uuid]]);
                });
                return entries;
            }
            return data[byUuid[uuids]];
        }
        function getDataByStatus(status) {
            var statusResults = [], statuses = [].concat(status);
            qq.each(statuses, function(index, statusEnum) {
                var statusResultIndexes = byStatus[statusEnum];
                if (statusResultIndexes !== undefined) {
                    qq.each(statusResultIndexes, function(i, dataIndex) {
                        statusResults.push(data[dataIndex]);
                    });
                }
            });
            return statusResults;
        }
        qq.extend(this, {
            addFile: function(spec) {
                var status = spec.status || qq.status.SUBMITTING, id = data.push({
                    name: spec.name,
                    originalName: spec.name,
                    uuid: spec.uuid,
                    size: spec.size == null ? -1 : spec.size,
                    status: status,
                    file: spec.file
                }) - 1;
                if (spec.batchId) {
                    data[id].batchId = spec.batchId;
                    if (byBatchId[spec.batchId] === undefined) {
                        byBatchId[spec.batchId] = [];
                    }
                    byBatchId[spec.batchId].push(id);
                }
                if (spec.proxyGroupId) {
                    data[id].proxyGroupId = spec.proxyGroupId;
                    if (byProxyGroupId[spec.proxyGroupId] === undefined) {
                        byProxyGroupId[spec.proxyGroupId] = [];
                    }
                    byProxyGroupId[spec.proxyGroupId].push(id);
                }
                data[id].id = id;
                byUuid[spec.uuid] = id;
                if (byStatus[status] === undefined) {
                    byStatus[status] = [];
                }
                byStatus[status].push(id);
                spec.onBeforeStatusChange && spec.onBeforeStatusChange(id);
                uploaderProxy.onStatusChange(id, null, status);
                return id;
            },
            retrieve: function(optionalFilter) {
                if (qq.isObject(optionalFilter) && data.length) {
                    if (optionalFilter.id !== undefined) {
                        return getDataByIds(optionalFilter.id);
                    } else if (optionalFilter.uuid !== undefined) {
                        return getDataByUuids(optionalFilter.uuid);
                    } else if (optionalFilter.status) {
                        return getDataByStatus(optionalFilter.status);
                    }
                } else {
                    return qq.extend([], data, true);
                }
            },
            removeFileRef: function(id) {
                var record = getDataByIds(id);
                if (record) {
                    delete record.file;
                }
            },
            reset: function() {
                data = [];
                byUuid = {};
                byStatus = {};
                byBatchId = {};
            },
            setStatus: function(id, newStatus) {
                var oldStatus = data[id].status, byStatusOldStatusIndex = qq.indexOf(byStatus[oldStatus], id);
                byStatus[oldStatus].splice(byStatusOldStatusIndex, 1);
                data[id].status = newStatus;
                if (byStatus[newStatus] === undefined) {
                    byStatus[newStatus] = [];
                }
                byStatus[newStatus].push(id);
                uploaderProxy.onStatusChange(id, oldStatus, newStatus);
            },
            uuidChanged: function(id, newUuid) {
                var oldUuid = data[id].uuid;
                data[id].uuid = newUuid;
                byUuid[newUuid] = id;
                delete byUuid[oldUuid];
            },
            updateName: function(id, newName) {
                data[id].name = newName;
            },
            updateSize: function(id, newSize) {
                data[id].size = newSize;
            },
            setParentId: function(targetId, parentId) {
                data[targetId].parentId = parentId;
            },
            getIdsInProxyGroup: function(id) {
                var proxyGroupId = data[id].proxyGroupId;
                if (proxyGroupId) {
                    return byProxyGroupId[proxyGroupId];
                }
                return [];
            },
            getIdsInBatch: function(id) {
                var batchId = data[id].batchId;
                return byBatchId[batchId];
            }
        });
    };
    qq.status = {
        SUBMITTING: "submitting",
        SUBMITTED: "submitted",
        REJECTED: "rejected",
        QUEUED: "queued",
        CANCELED: "canceled",
        PAUSED: "paused",
        UPLOADING: "uploading",
        UPLOAD_FINALIZING: "upload finalizing",
        UPLOAD_RETRYING: "retrying upload",
        UPLOAD_SUCCESSFUL: "upload successful",
        UPLOAD_FAILED: "upload failed",
        DELETE_FAILED: "delete failed",
        DELETING: "deleting",
        DELETED: "deleted"
    };
    (function() {
        "use strict";
        qq.basePublicApi = {
            addBlobs: function(blobDataOrArray, params, endpoint) {
                this.addFiles(blobDataOrArray, params, endpoint);
            },
            addInitialFiles: function(cannedFileList) {
                var self = this;
                qq.each(cannedFileList, function(index, cannedFile) {
                    self._addCannedFile(cannedFile);
                });
            },
            addFiles: function(data, params, endpoint) {
                this._maybeHandleIos8SafariWorkaround();
                var batchId = this._storedIds.length === 0 ? qq.getUniqueId() : this._currentBatchId, processBlob = qq.bind(function(blob) {
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName
                    }, batchId, verifiedFiles);
                }, this), processBlobData = qq.bind(function(blobData) {
                    this._handleNewFile(blobData, batchId, verifiedFiles);
                }, this), processCanvas = qq.bind(function(canvas) {
                    var blob = qq.canvasToBlob(canvas);
                    this._handleNewFile({
                        blob: blob,
                        name: this._options.blobs.defaultName + ".png"
                    }, batchId, verifiedFiles);
                }, this), processCanvasData = qq.bind(function(canvasData) {
                    var normalizedQuality = canvasData.quality && canvasData.quality / 100, blob = qq.canvasToBlob(canvasData.canvas, canvasData.type, normalizedQuality);
                    this._handleNewFile({
                        blob: blob,
                        name: canvasData.name
                    }, batchId, verifiedFiles);
                }, this), processFileOrInput = qq.bind(function(fileOrInput) {
                    if (qq.isInput(fileOrInput) && qq.supportedFeatures.ajaxUploading) {
                        var files = Array.prototype.slice.call(fileOrInput.files), self = this;
                        qq.each(files, function(idx, file) {
                            self._handleNewFile(file, batchId, verifiedFiles);
                        });
                    } else {
                        this._handleNewFile(fileOrInput, batchId, verifiedFiles);
                    }
                }, this), normalizeData = function() {
                    if (qq.isFileList(data)) {
                        data = Array.prototype.slice.call(data);
                    }
                    data = [].concat(data);
                }, self = this, verifiedFiles = [];
                this._currentBatchId = batchId;
                if (data) {
                    normalizeData();
                    qq.each(data, function(idx, fileContainer) {
                        if (qq.isFileOrInput(fileContainer)) {
                            processFileOrInput(fileContainer);
                        } else if (qq.isBlob(fileContainer)) {
                            processBlob(fileContainer);
                        } else if (qq.isObject(fileContainer)) {
                            if (fileContainer.blob && fileContainer.name) {
                                processBlobData(fileContainer);
                            } else if (fileContainer.canvas && fileContainer.name) {
                                processCanvasData(fileContainer);
                            }
                        } else if (fileContainer.tagName && fileContainer.tagName.toLowerCase() === "canvas") {
                            processCanvas(fileContainer);
                        } else {
                            self.log(fileContainer + " is not a valid file container!  Ignoring!", "warn");
                        }
                    });
                    this.log("Received " + verifiedFiles.length + " files.");
                    this._prepareItemsForUpload(verifiedFiles, params, endpoint);
                }
            },
            cancel: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (uploadData && uploadData.status === qq.status.UPLOAD_FINALIZING) {
                    this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.", id, this.getName(id)), "error");
                } else {
                    this._handler.cancel(id);
                }
            },
            cancelAll: function() {
                var storedIdsCopy = [], self = this;
                qq.extend(storedIdsCopy, this._storedIds);
                qq.each(storedIdsCopy, function(idx, storedFileId) {
                    self.cancel(storedFileId);
                });
                this._handler.cancelAll();
            },
            clearStoredFiles: function() {
                this._storedIds = [];
            },
            continueUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (uploadData.status === qq.status.PAUSED) {
                    this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.", id, this.getName(id)));
                    this._uploadFile(id);
                    return true;
                } else {
                    this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.", id, this.getName(id)), "error");
                }
                return false;
            },
            deleteFile: function(id) {
                return this._onSubmitDelete(id);
            },
            doesExist: function(fileOrBlobId) {
                return this._handler.isValid(fileOrBlobId);
            },
            drawThumbnail: function(fileId, imgOrCanvas, maxSize, fromServer, customResizeFunction) {
                var promiseToReturn = new qq.Promise(), fileOrUrl, options;
                if (this._imageGenerator) {
                    fileOrUrl = this._thumbnailUrls[fileId];
                    options = {
                        customResizeFunction: customResizeFunction,
                        maxSize: maxSize > 0 ? maxSize : null,
                        scale: maxSize > 0
                    };
                    if (!fromServer && qq.supportedFeatures.imagePreviews) {
                        fileOrUrl = this.getFile(fileId);
                    }
                    if (fileOrUrl == null) {
                        promiseToReturn.failure({
                            container: imgOrCanvas,
                            error: "File or URL not found."
                        });
                    } else {
                        this._imageGenerator.generate(fileOrUrl, imgOrCanvas, options).then(function success(modifiedContainer) {
                            promiseToReturn.success(modifiedContainer);
                        }, function failure(container, reason) {
                            promiseToReturn.failure({
                                container: container,
                                error: reason || "Problem generating thumbnail"
                            });
                        });
                    }
                } else {
                    promiseToReturn.failure({
                        container: imgOrCanvas,
                        error: "Missing image generator module"
                    });
                }
                return promiseToReturn;
            },
            getButton: function(fileId) {
                return this._getButton(this._buttonIdsForFileIds[fileId]);
            },
            getEndpoint: function(fileId) {
                return this._endpointStore.get(fileId);
            },
            getFile: function(fileOrBlobId) {
                var file = this._handler.getFile(fileOrBlobId);
                var uploadDataRecord;
                if (!file) {
                    uploadDataRecord = this._uploadData.retrieve({
                        id: fileOrBlobId
                    });
                    if (uploadDataRecord) {
                        file = uploadDataRecord.file;
                    }
                }
                return file || null;
            },
            getInProgress: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED ]
                }).length;
            },
            getName: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).name;
            },
            getParentId: function(id) {
                var uploadDataEntry = this.getUploads({
                    id: id
                }), parentId = null;
                if (uploadDataEntry) {
                    if (uploadDataEntry.parentId !== undefined) {
                        parentId = uploadDataEntry.parentId;
                    }
                }
                return parentId;
            },
            getResumableFilesData: function() {
                return this._handler.getResumableFilesData();
            },
            getSize: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).size;
            },
            getNetUploads: function() {
                return this._netUploaded;
            },
            getRemainingAllowedItems: function() {
                var allowedItems = this._currentItemLimit;
                if (allowedItems > 0) {
                    return allowedItems - this._netUploadedOrQueued;
                }
                return null;
            },
            getUploads: function(optionalFilter) {
                return this._uploadData.retrieve(optionalFilter);
            },
            getUuid: function(id) {
                return this._uploadData.retrieve({
                    id: id
                }).uuid;
            },
            isResumable: function(id) {
                return this._handler.hasResumeRecord(id);
            },
            log: function(str, level) {
                if (this._options.debug && (!level || level === "info")) {
                    qq.log("[Fine Uploader " + qq.version + "] " + str);
                } else if (level && level !== "info") {
                    qq.log("[Fine Uploader " + qq.version + "] " + str, level);
                }
            },
            pauseUpload: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!qq.supportedFeatures.pause || !this._options.chunking.enabled) {
                    return false;
                }
                if (qq.indexOf([ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING ], uploadData.status) >= 0) {
                    if (this._handler.pause(id)) {
                        this._uploadData.setStatus(id, qq.status.PAUSED);
                        return true;
                    } else {
                        this.log(qq.format("Unable to pause file ID {} ({}).", id, this.getName(id)), "error");
                    }
                } else {
                    this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.", id, this.getName(id)), "error");
                }
                return false;
            },
            removeFileRef: function(id) {
                this._handler.expunge(id);
                this._uploadData.removeFileRef(id);
            },
            reset: function() {
                this.log("Resetting uploader...");
                this._handler.reset();
                this._storedIds = [];
                this._autoRetries = [];
                this._retryTimeouts = [];
                this._preventRetries = [];
                this._thumbnailUrls = [];
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
                this._paramsStore.reset();
                this._endpointStore.reset();
                this._netUploadedOrQueued = 0;
                this._netUploaded = 0;
                this._uploadData.reset();
                this._buttonIdsForFileIds = [];
                this._pasteHandler && this._pasteHandler.reset();
                this._options.session.refreshOnReset && this._refreshSessionData();
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
                this._totalProgress && this._totalProgress.reset();
                this._customResumeDataStore.reset();
            },
            retry: function(id) {
                return this._manualRetry(id);
            },
            scaleImage: function(id, specs) {
                var self = this;
                return qq.Scaler.prototype.scaleImage(id, specs, {
                    log: qq.bind(self.log, self),
                    getFile: qq.bind(self.getFile, self),
                    uploadData: self._uploadData
                });
            },
            setCustomHeaders: function(headers, id) {
                this._customHeadersStore.set(headers, id);
            },
            setCustomResumeData: function(id, data) {
                this._customResumeDataStore.set(data, id);
            },
            setDeleteFileCustomHeaders: function(headers, id) {
                this._deleteFileCustomHeadersStore.set(headers, id);
            },
            setDeleteFileEndpoint: function(endpoint, id) {
                this._deleteFileEndpointStore.set(endpoint, id);
            },
            setDeleteFileParams: function(params, id) {
                this._deleteFileParamsStore.set(params, id);
            },
            setEndpoint: function(endpoint, id) {
                this._endpointStore.set(endpoint, id);
            },
            setForm: function(elementOrId) {
                this._updateFormSupportAndParams(elementOrId);
            },
            setItemLimit: function(newItemLimit) {
                this._currentItemLimit = newItemLimit;
            },
            setName: function(id, newName) {
                this._uploadData.updateName(id, newName);
            },
            setParams: function(params, id) {
                this._paramsStore.set(params, id);
            },
            setUuid: function(id, newUuid) {
                return this._uploadData.uuidChanged(id, newUuid);
            },
            setStatus: function(id, newStatus) {
                var fileRecord = this.getUploads({
                    id: id
                });
                if (!fileRecord) {
                    throw new qq.Error(id + " is not a valid file ID.");
                }
                switch (newStatus) {
                  case qq.status.DELETED:
                    this._onDeleteComplete(id, null, false);
                    break;

                  case qq.status.DELETE_FAILED:
                    this._onDeleteComplete(id, null, true);
                    break;

                  default:
                    var errorMessage = "Method setStatus called on '" + name + "' not implemented yet for " + newStatus;
                    this.log(errorMessage);
                    throw new qq.Error(errorMessage);
                }
            },
            uploadStoredFiles: function() {
                if (this._storedIds.length === 0) {
                    this._itemError("noFilesError");
                } else {
                    this._uploadStoredFiles();
                }
            }
        };
        qq.basePrivateApi = {
            _addCannedFile: function(sessionData) {
                var self = this;
                return this._uploadData.addFile({
                    uuid: sessionData.uuid,
                    name: sessionData.name,
                    size: sessionData.size,
                    status: qq.status.UPLOAD_SUCCESSFUL,
                    onBeforeStatusChange: function(id) {
                        sessionData.deleteFileEndpoint && self.setDeleteFileEndpoint(sessionData.deleteFileEndpoint, id);
                        sessionData.deleteFileParams && self.setDeleteFileParams(sessionData.deleteFileParams, id);
                        if (sessionData.thumbnailUrl) {
                            self._thumbnailUrls[id] = sessionData.thumbnailUrl;
                        }
                        self._netUploaded++;
                        self._netUploadedOrQueued++;
                    }
                });
            },
            _annotateWithButtonId: function(file, associatedInput) {
                if (qq.isFile(file)) {
                    file.qqButtonId = this._getButtonId(associatedInput);
                }
            },
            _batchError: function(message) {
                this._options.callbacks.onError(null, null, message, undefined);
            },
            _createDeleteHandler: function() {
                var self = this;
                return new qq.DeleteFileAjaxRequester({
                    method: this._options.deleteFile.method.toUpperCase(),
                    maxConnections: this._options.maxConnections,
                    uuidParamName: this._options.request.uuidName,
                    customHeaders: this._deleteFileCustomHeadersStore,
                    paramsStore: this._deleteFileParamsStore,
                    endpointStore: this._deleteFileEndpointStore,
                    cors: this._options.cors,
                    log: qq.bind(self.log, self),
                    onDelete: function(id) {
                        self._onDelete(id);
                        self._options.callbacks.onDelete(id);
                    },
                    onDeleteComplete: function(id, xhrOrXdr, isError) {
                        self._onDeleteComplete(id, xhrOrXdr, isError);
                        self._options.callbacks.onDeleteComplete(id, xhrOrXdr, isError);
                    }
                });
            },
            _createPasteHandler: function() {
                var self = this;
                return new qq.PasteSupport({
                    targetElement: this._options.paste.targetElement,
                    callbacks: {
                        log: qq.bind(self.log, self),
                        pasteReceived: function(blob) {
                            self._handleCheckedCallback({
                                name: "onPasteReceived",
                                callback: qq.bind(self._options.callbacks.onPasteReceived, self, blob),
                                onSuccess: qq.bind(self._handlePasteSuccess, self, blob),
                                identifier: "pasted image"
                            });
                        }
                    }
                });
            },
            _createStore: function(initialValue, _readOnlyValues_) {
                var store = {}, catchall = initialValue, perIdReadOnlyValues = {}, readOnlyValues = _readOnlyValues_, copy = function(orig) {
                    if (qq.isObject(orig)) {
                        return qq.extend({}, orig);
                    }
                    return orig;
                }, getReadOnlyValues = function() {
                    if (qq.isFunction(readOnlyValues)) {
                        return readOnlyValues();
                    }
                    return readOnlyValues;
                }, includeReadOnlyValues = function(id, existing) {
                    if (readOnlyValues && qq.isObject(existing)) {
                        qq.extend(existing, getReadOnlyValues());
                    }
                    if (perIdReadOnlyValues[id]) {
                        qq.extend(existing, perIdReadOnlyValues[id]);
                    }
                };
                return {
                    set: function(val, id) {
                        if (id == null) {
                            store = {};
                            catchall = copy(val);
                        } else {
                            store[id] = copy(val);
                        }
                    },
                    get: function(id) {
                        var values;
                        if (id != null && store[id]) {
                            values = store[id];
                        } else {
                            values = copy(catchall);
                        }
                        includeReadOnlyValues(id, values);
                        return copy(values);
                    },
                    addReadOnly: function(id, values) {
                        if (qq.isObject(store)) {
                            if (id === null) {
                                if (qq.isFunction(values)) {
                                    readOnlyValues = values;
                                } else {
                                    readOnlyValues = readOnlyValues || {};
                                    qq.extend(readOnlyValues, values);
                                }
                            } else {
                                perIdReadOnlyValues[id] = perIdReadOnlyValues[id] || {};
                                qq.extend(perIdReadOnlyValues[id], values);
                            }
                        }
                    },
                    remove: function(fileId) {
                        return delete store[fileId];
                    },
                    reset: function() {
                        store = {};
                        perIdReadOnlyValues = {};
                        catchall = initialValue;
                    }
                };
            },
            _createUploadDataTracker: function() {
                var self = this;
                return new qq.UploadData({
                    getName: function(id) {
                        return self.getName(id);
                    },
                    getUuid: function(id) {
                        return self.getUuid(id);
                    },
                    getSize: function(id) {
                        return self.getSize(id);
                    },
                    onStatusChange: function(id, oldStatus, newStatus) {
                        self._onUploadStatusChange(id, oldStatus, newStatus);
                        self._options.callbacks.onStatusChange(id, oldStatus, newStatus);
                        self._maybeAllComplete(id, newStatus);
                        if (self._totalProgress) {
                            setTimeout(function() {
                                self._totalProgress.onStatusChange(id, oldStatus, newStatus);
                            }, 0);
                        }
                    }
                });
            },
            _createUploadButton: function(spec) {
                var self = this, acceptFiles = spec.accept || this._options.validation.acceptFiles, allowedExtensions = spec.allowedExtensions || this._options.validation.allowedExtensions, button;
                function allowMultiple() {
                    if (qq.supportedFeatures.ajaxUploading) {
                        if (self._options.workarounds.iosEmptyVideos && qq.ios() && !qq.ios6() && self._isAllowedExtension(allowedExtensions, ".mov")) {
                            return false;
                        }
                        if (spec.multiple === undefined) {
                            return self._options.multiple;
                        }
                        return spec.multiple;
                    }
                    return false;
                }
                button = new qq.UploadButton({
                    acceptFiles: acceptFiles,
                    element: spec.element,
                    focusClass: this._options.classes.buttonFocus,
                    folders: spec.folders,
                    hoverClass: this._options.classes.buttonHover,
                    ios8BrowserCrashWorkaround: this._options.workarounds.ios8BrowserCrash,
                    multiple: allowMultiple(),
                    name: this._options.request.inputName,
                    onChange: function(input) {
                        self._onInputChange(input);
                    },
                    title: spec.title == null ? this._options.text.fileInputTitle : spec.title
                });
                this._disposeSupport.addDisposer(function() {
                    button.dispose();
                });
                self._buttons.push(button);
                return button;
            },
            _createUploadHandler: function(additionalOptions, namespace) {
                var self = this, lastOnProgress = {}, options = {
                    debug: this._options.debug,
                    maxConnections: this._options.maxConnections,
                    cors: this._options.cors,
                    paramsStore: this._paramsStore,
                    endpointStore: this._endpointStore,
                    chunking: this._options.chunking,
                    resume: this._options.resume,
                    blobs: this._options.blobs,
                    log: qq.bind(self.log, self),
                    preventRetryParam: this._options.retry.preventRetryResponseProperty,
                    onProgress: function(id, name, loaded, total) {
                        if (loaded < 0 || total < 0) {
                            return;
                        }
                        if (lastOnProgress[id]) {
                            if (lastOnProgress[id].loaded !== loaded || lastOnProgress[id].total !== total) {
                                self._onProgress(id, name, loaded, total);
                                self._options.callbacks.onProgress(id, name, loaded, total);
                            }
                        } else {
                            self._onProgress(id, name, loaded, total);
                            self._options.callbacks.onProgress(id, name, loaded, total);
                        }
                        lastOnProgress[id] = {
                            loaded: loaded,
                            total: total
                        };
                    },
                    onComplete: function(id, name, result, xhr) {
                        delete lastOnProgress[id];
                        var status = self.getUploads({
                            id: id
                        }).status, retVal;
                        if (status === qq.status.UPLOAD_SUCCESSFUL || status === qq.status.UPLOAD_FAILED) {
                            return;
                        }
                        retVal = self._onComplete(id, name, result, xhr);
                        if (retVal instanceof qq.Promise) {
                            retVal.done(function() {
                                self._options.callbacks.onComplete(id, name, result, xhr);
                            });
                        } else {
                            self._options.callbacks.onComplete(id, name, result, xhr);
                        }
                    },
                    onCancel: function(id, name, cancelFinalizationEffort) {
                        var promise = new qq.Promise();
                        self._handleCheckedCallback({
                            name: "onCancel",
                            callback: qq.bind(self._options.callbacks.onCancel, self, id, name),
                            onFailure: promise.failure,
                            onSuccess: function() {
                                cancelFinalizationEffort.then(function() {
                                    self._onCancel(id, name);
                                });
                                promise.success();
                            },
                            identifier: id
                        });
                        return promise;
                    },
                    onUploadPrep: qq.bind(this._onUploadPrep, this),
                    onUpload: function(id, name) {
                        self._onUpload(id, name);
                        var onUploadResult = self._options.callbacks.onUpload(id, name);
                        if (qq.isGenericPromise(onUploadResult)) {
                            self.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.", id));
                            return onUploadResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunk: function(id, name, chunkData) {
                        self._onUploadChunk(id, chunkData);
                        var onUploadChunkResult = self._options.callbacks.onUploadChunk(id, name, chunkData);
                        if (qq.isGenericPromise(onUploadChunkResult)) {
                            self.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.", id, chunkData.partIndex));
                            return onUploadChunkResult;
                        }
                        return new qq.Promise().success();
                    },
                    onUploadChunkSuccess: function(id, chunkData, result, xhr) {
                        self._onUploadChunkSuccess(id, chunkData);
                        self._options.callbacks.onUploadChunkSuccess.apply(self, arguments);
                    },
                    onResume: function(id, name, chunkData, customResumeData) {
                        return self._options.callbacks.onResume(id, name, chunkData, customResumeData);
                    },
                    onAutoRetry: function(id, name, responseJSON, xhr) {
                        return self._onAutoRetry.apply(self, arguments);
                    },
                    onUuidChanged: function(id, newUuid) {
                        self.log("Server requested UUID change from '" + self.getUuid(id) + "' to '" + newUuid + "'");
                        self.setUuid(id, newUuid);
                    },
                    getName: qq.bind(self.getName, self),
                    getUuid: qq.bind(self.getUuid, self),
                    getSize: qq.bind(self.getSize, self),
                    setSize: qq.bind(self._setSize, self),
                    getDataByUuid: function(uuid) {
                        return self.getUploads({
                            uuid: uuid
                        });
                    },
                    isQueued: function(id) {
                        var status = self.getUploads({
                            id: id
                        }).status;
                        return status === qq.status.QUEUED || status === qq.status.SUBMITTED || status === qq.status.UPLOAD_RETRYING || status === qq.status.PAUSED;
                    },
                    getIdsInProxyGroup: self._uploadData.getIdsInProxyGroup,
                    getIdsInBatch: self._uploadData.getIdsInBatch,
                    isInProgress: function(id) {
                        return self.getUploads({
                            id: id
                        }).status === qq.status.UPLOADING;
                    },
                    getCustomResumeData: qq.bind(self._getCustomResumeData, self),
                    setStatus: function(id, status) {
                        self._uploadData.setStatus(id, status);
                    }
                };
                qq.each(this._options.request, function(prop, val) {
                    options[prop] = val;
                });
                options.customHeaders = this._customHeadersStore;
                if (additionalOptions) {
                    qq.each(additionalOptions, function(key, val) {
                        options[key] = val;
                    });
                }
                return new qq.UploadHandlerController(options, namespace);
            },
            _fileOrBlobRejected: function(id) {
                this._netUploadedOrQueued--;
                this._uploadData.setStatus(id, qq.status.REJECTED);
            },
            _formatSize: function(bytes) {
                if (bytes === 0) {
                    return bytes + this._options.text.sizeSymbols[0];
                }
                var i = -1;
                do {
                    bytes = bytes / 1e3;
                    i++;
                } while (bytes > 999);
                return Math.max(bytes, .1).toFixed(1) + this._options.text.sizeSymbols[i];
            },
            _generateExtraButtonSpecs: function() {
                var self = this;
                this._extraButtonSpecs = {};
                qq.each(this._options.extraButtons, function(idx, extraButtonOptionEntry) {
                    var multiple = extraButtonOptionEntry.multiple, validation = qq.extend({}, self._options.validation, true), extraButtonSpec = qq.extend({}, extraButtonOptionEntry);
                    if (multiple === undefined) {
                        multiple = self._options.multiple;
                    }
                    if (extraButtonSpec.validation) {
                        qq.extend(validation, extraButtonOptionEntry.validation, true);
                    }
                    qq.extend(extraButtonSpec, {
                        multiple: multiple,
                        validation: validation
                    }, true);
                    self._initExtraButton(extraButtonSpec);
                });
            },
            _getButton: function(buttonId) {
                var extraButtonsSpec = this._extraButtonSpecs[buttonId];
                if (extraButtonsSpec) {
                    return extraButtonsSpec.element;
                } else if (buttonId === this._defaultButtonId) {
                    return this._options.button;
                }
            },
            _getButtonId: function(buttonOrFileInputOrFile) {
                var inputs, fileInput, fileBlobOrInput = buttonOrFileInputOrFile;
                if (fileBlobOrInput instanceof qq.BlobProxy) {
                    fileBlobOrInput = fileBlobOrInput.referenceBlob;
                }
                if (fileBlobOrInput && !qq.isBlob(fileBlobOrInput)) {
                    if (qq.isFile(fileBlobOrInput)) {
                        return fileBlobOrInput.qqButtonId;
                    } else if (fileBlobOrInput.tagName.toLowerCase() === "input" && fileBlobOrInput.type.toLowerCase() === "file") {
                        return fileBlobOrInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                    inputs = fileBlobOrInput.getElementsByTagName("input");
                    qq.each(inputs, function(idx, input) {
                        if (input.getAttribute("type") === "file") {
                            fileInput = input;
                            return false;
                        }
                    });
                    if (fileInput) {
                        return fileInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);
                    }
                }
            },
            _getCustomResumeData: function(fileId) {
                return this._customResumeDataStore.get(fileId);
            },
            _getNotFinished: function() {
                return this._uploadData.retrieve({
                    status: [ qq.status.UPLOADING, qq.status.UPLOAD_RETRYING, qq.status.QUEUED, qq.status.SUBMITTING, qq.status.SUBMITTED, qq.status.PAUSED ]
                }).length;
            },
            _getValidationBase: function(buttonId) {
                var extraButtonSpec = this._extraButtonSpecs[buttonId];
                return extraButtonSpec ? extraButtonSpec.validation : this._options.validation;
            },
            _getValidationDescriptor: function(fileWrapper) {
                if (fileWrapper.file instanceof qq.BlobProxy) {
                    return {
                        name: qq.getFilename(fileWrapper.file.referenceBlob),
                        size: fileWrapper.file.referenceBlob.size
                    };
                }
                return {
                    name: this.getUploads({
                        id: fileWrapper.id
                    }).name,
                    size: this.getUploads({
                        id: fileWrapper.id
                    }).size
                };
            },
            _getValidationDescriptors: function(fileWrappers) {
                var self = this, fileDescriptors = [];
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    fileDescriptors.push(self._getValidationDescriptor(fileWrapper));
                });
                return fileDescriptors;
            },
            _handleCameraAccess: function() {
                if (this._options.camera.ios && qq.ios()) {
                    var acceptIosCamera = "image/*;capture=camera", button = this._options.camera.button, buttonId = button ? this._getButtonId(button) : this._defaultButtonId, optionRoot = this._options;
                    if (buttonId && buttonId !== this._defaultButtonId) {
                        optionRoot = this._extraButtonSpecs[buttonId];
                    }
                    optionRoot.multiple = false;
                    if (optionRoot.validation.acceptFiles === null) {
                        optionRoot.validation.acceptFiles = acceptIosCamera;
                    } else {
                        optionRoot.validation.acceptFiles += "," + acceptIosCamera;
                    }
                    qq.each(this._buttons, function(idx, button) {
                        if (button.getButtonId() === buttonId) {
                            button.setMultiple(optionRoot.multiple);
                            button.setAcceptFiles(optionRoot.acceptFiles);
                            return false;
                        }
                    });
                }
            },
            _handleCheckedCallback: function(details) {
                var self = this, callbackRetVal = details.callback();
                if (qq.isGenericPromise(callbackRetVal)) {
                    this.log(details.name + " - waiting for " + details.name + " promise to be fulfilled for " + details.identifier);
                    return callbackRetVal.then(function(successParam) {
                        self.log(details.name + " promise success for " + details.identifier);
                        details.onSuccess(successParam);
                    }, function() {
                        if (details.onFailure) {
                            self.log(details.name + " promise failure for " + details.identifier);
                            details.onFailure();
                        } else {
                            self.log(details.name + " promise failure for " + details.identifier);
                        }
                    });
                }
                if (callbackRetVal !== false) {
                    details.onSuccess(callbackRetVal);
                } else {
                    if (details.onFailure) {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Invoking failure callback.");
                        details.onFailure();
                    } else {
                        this.log(details.name + " - return value was 'false' for " + details.identifier + ".  Will not proceed.");
                    }
                }
                return callbackRetVal;
            },
            _handleNewFile: function(file, batchId, newFileWrapperList) {
                var self = this, uuid = qq.getUniqueId(), size = -1, name = qq.getFilename(file), actualFile = file.blob || file, handler = this._customNewFileHandler ? this._customNewFileHandler : qq.bind(self._handleNewFileGeneric, self);
                if (!qq.isInput(actualFile) && actualFile.size >= 0) {
                    size = actualFile.size;
                }
                handler(actualFile, name, uuid, size, newFileWrapperList, batchId, this._options.request.uuidName, {
                    uploadData: self._uploadData,
                    paramsStore: self._paramsStore,
                    addFileToHandler: function(id, file) {
                        self._handler.add(id, file);
                        self._netUploadedOrQueued++;
                        self._trackButton(id);
                    }
                });
            },
            _handleNewFileGeneric: function(file, name, uuid, size, fileList, batchId) {
                var id = this._uploadData.addFile({
                    uuid: uuid,
                    name: name,
                    size: size,
                    batchId: batchId,
                    file: file
                });
                this._handler.add(id, file);
                this._trackButton(id);
                this._netUploadedOrQueued++;
                fileList.push({
                    id: id,
                    file: file
                });
            },
            _handlePasteSuccess: function(blob, extSuppliedName) {
                var extension = blob.type.split("/")[1], name = extSuppliedName;
                if (name == null) {
                    name = this._options.paste.defaultName;
                }
                name += "." + extension;
                this.addFiles({
                    name: name,
                    blob: blob
                });
            },
            _handleDeleteSuccess: function(id) {
                if (this.getUploads({
                    id: id
                }).status !== qq.status.DELETED) {
                    var name = this.getName(id);
                    this._netUploadedOrQueued--;
                    this._netUploaded--;
                    this._handler.expunge(id);
                    this._uploadData.setStatus(id, qq.status.DELETED);
                    this.log("Delete request for '" + name + "' has succeeded.");
                }
            },
            _handleDeleteFailed: function(id, xhrOrXdr) {
                var name = this.getName(id);
                this._uploadData.setStatus(id, qq.status.DELETE_FAILED);
                this.log("Delete request for '" + name + "' has failed.", "error");
                if (!xhrOrXdr || xhrOrXdr.withCredentials === undefined) {
                    this._options.callbacks.onError(id, name, "Delete request failed", xhrOrXdr);
                } else {
                    this._options.callbacks.onError(id, name, "Delete request failed with response code " + xhrOrXdr.status, xhrOrXdr);
                }
            },
            _initExtraButton: function(spec) {
                var button = this._createUploadButton({
                    accept: spec.validation.acceptFiles,
                    allowedExtensions: spec.validation.allowedExtensions,
                    element: spec.element,
                    folders: spec.folders,
                    multiple: spec.multiple,
                    title: spec.fileInputTitle
                });
                this._extraButtonSpecs[button.getButtonId()] = spec;
            },
            _initFormSupportAndParams: function() {
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore = this._createStore(this._options.request.params, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this._options.request.endpoint = this._formSupport.newEndpoint;
                    }
                } else {
                    this._paramsStore = this._createStore(this._options.request.params);
                }
            },
            _isDeletePossible: function() {
                if (!qq.DeleteFileAjaxRequester || !this._options.deleteFile.enabled) {
                    return false;
                }
                if (this._options.cors.expected) {
                    if (qq.supportedFeatures.deleteFileCorsXhr) {
                        return true;
                    }
                    if (qq.supportedFeatures.deleteFileCorsXdr && this._options.cors.allowXdr) {
                        return true;
                    }
                    return false;
                }
                return true;
            },
            _isAllowedExtension: function(allowed, fileName) {
                var valid = false;
                if (!allowed.length) {
                    return true;
                }
                qq.each(allowed, function(idx, allowedExt) {
                    if (qq.isString(allowedExt)) {
                        var extRegex = new RegExp("\\." + allowedExt + "$", "i");
                        if (fileName.match(extRegex) != null) {
                            valid = true;
                            return false;
                        }
                    }
                });
                return valid;
            },
            _itemError: function(code, maybeNameOrNames, item) {
                var message = this._options.messages[code], allowedExtensions = [], names = [].concat(maybeNameOrNames), name = names[0], buttonId = this._getButtonId(item), validationBase = this._getValidationBase(buttonId), extensionsForMessage, placeholderMatch;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                qq.each(validationBase.allowedExtensions, function(idx, allowedExtension) {
                    if (qq.isString(allowedExtension)) {
                        allowedExtensions.push(allowedExtension);
                    }
                });
                extensionsForMessage = allowedExtensions.join(", ").toLowerCase();
                r("{file}", this._options.formatFileName(name));
                r("{extensions}", extensionsForMessage);
                r("{sizeLimit}", this._formatSize(validationBase.sizeLimit));
                r("{minSizeLimit}", this._formatSize(validationBase.minSizeLimit));
                placeholderMatch = message.match(/(\{\w+\})/g);
                if (placeholderMatch !== null) {
                    qq.each(placeholderMatch, function(idx, placeholder) {
                        r(placeholder, names[idx]);
                    });
                }
                this._options.callbacks.onError(null, name, message, undefined);
                return message;
            },
            _manualRetry: function(id, callback) {
                if (this._onBeforeManualRetry(id)) {
                    this._netUploadedOrQueued++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    if (callback) {
                        callback(id);
                    } else {
                        this._handler.retry(id);
                    }
                    return true;
                }
            },
            _maybeAllComplete: function(id, status) {
                var self = this, notFinished = this._getNotFinished();
                if (status === qq.status.UPLOAD_SUCCESSFUL) {
                    this._succeededSinceLastAllComplete.push(id);
                } else if (status === qq.status.UPLOAD_FAILED) {
                    this._failedSinceLastAllComplete.push(id);
                }
                if (notFinished === 0 && (this._succeededSinceLastAllComplete.length || this._failedSinceLastAllComplete.length)) {
                    setTimeout(function() {
                        self._onAllComplete(self._succeededSinceLastAllComplete, self._failedSinceLastAllComplete);
                    }, 0);
                }
            },
            _maybeHandleIos8SafariWorkaround: function() {
                var self = this;
                if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
                    setTimeout(function() {
                        window.alert(self._options.messages.unsupportedBrowserIos8Safari);
                    }, 0);
                    throw new qq.Error(this._options.messages.unsupportedBrowserIos8Safari);
                }
            },
            _maybeParseAndSendUploadError: function(id, name, response, xhr) {
                if (!response.success) {
                    if (xhr && xhr.status !== 200 && !response.error) {
                        this._options.callbacks.onError(id, name, "XHR returned response code " + xhr.status, xhr);
                    } else {
                        var errorReason = response.error ? response.error : this._options.text.defaultResponseError;
                        this._options.callbacks.onError(id, name, errorReason, xhr);
                    }
                }
            },
            _maybeProcessNextItemAfterOnValidateCallback: function(validItem, items, index, params, endpoint) {
                var self = this;
                if (items.length > index) {
                    if (validItem || !this._options.validation.stopOnFirstInvalidFile) {
                        setTimeout(function() {
                            var validationDescriptor = self._getValidationDescriptor(items[index]), buttonId = self._getButtonId(items[index].file), button = self._getButton(buttonId);
                            self._handleCheckedCallback({
                                name: "onValidate",
                                callback: qq.bind(self._options.callbacks.onValidate, self, validationDescriptor, button),
                                onSuccess: qq.bind(self._onValidateCallbackSuccess, self, items, index, params, endpoint),
                                onFailure: qq.bind(self._onValidateCallbackFailure, self, items, index, params, endpoint),
                                identifier: "Item '" + validationDescriptor.name + "', size: " + validationDescriptor.size
                            });
                        }, 0);
                    } else if (!validItem) {
                        for (;index < items.length; index++) {
                            self._fileOrBlobRejected(items[index].id);
                        }
                    }
                }
            },
            _onAllComplete: function(successful, failed) {
                this._totalProgress && this._totalProgress.onAllComplete(successful, failed, this._preventRetries);
                this._options.callbacks.onAllComplete(qq.extend([], successful), qq.extend([], failed));
                this._succeededSinceLastAllComplete = [];
                this._failedSinceLastAllComplete = [];
            },
            _onAutoRetry: function(id, name, responseJSON, xhr, callback) {
                var self = this;
                self._preventRetries[id] = responseJSON[self._options.retry.preventRetryResponseProperty];
                if (self._shouldAutoRetry(id)) {
                    var retryWaitPeriod = self._options.retry.autoAttemptDelay * 1e3;
                    self._maybeParseAndSendUploadError.apply(self, arguments);
                    self._options.callbacks.onAutoRetry(id, name, self._autoRetries[id]);
                    self._onBeforeAutoRetry(id, name);
                    self._uploadData.setStatus(id, qq.status.UPLOAD_RETRYING);
                    self._retryTimeouts[id] = setTimeout(function() {
                        self.log("Starting retry for " + name + "...");
                        if (callback) {
                            callback(id);
                        } else {
                            self._handler.retry(id);
                        }
                    }, retryWaitPeriod);
                    return true;
                }
            },
            _onBeforeAutoRetry: function(id, name) {
                this.log("Waiting " + this._options.retry.autoAttemptDelay + " seconds before retrying " + name + "...");
            },
            _onBeforeManualRetry: function(id) {
                var itemLimit = this._currentItemLimit, fileName;
                if (this._preventRetries[id]) {
                    this.log("Retries are forbidden for id " + id, "warn");
                    return false;
                } else if (this._handler.isValid(id)) {
                    fileName = this.getName(id);
                    if (this._options.callbacks.onManualRetry(id, fileName) === false) {
                        return false;
                    }
                    if (itemLimit > 0 && this._netUploadedOrQueued + 1 > itemLimit) {
                        this._itemError("retryFailTooManyItems");
                        return false;
                    }
                    this.log("Retrying upload for '" + fileName + "' (id: " + id + ")...");
                    return true;
                } else {
                    this.log("'" + id + "' is not a valid file ID", "error");
                    return false;
                }
            },
            _onCancel: function(id, name) {
                this._netUploadedOrQueued--;
                clearTimeout(this._retryTimeouts[id]);
                var storedItemIndex = qq.indexOf(this._storedIds, id);
                if (!this._options.autoUpload && storedItemIndex >= 0) {
                    this._storedIds.splice(storedItemIndex, 1);
                }
                this._uploadData.setStatus(id, qq.status.CANCELED);
            },
            _onComplete: function(id, name, result, xhr) {
                if (!result.success) {
                    this._netUploadedOrQueued--;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_FAILED);
                    if (result[this._options.retry.preventRetryResponseProperty] === true) {
                        this._preventRetries[id] = true;
                    }
                } else {
                    if (result.thumbnailUrl) {
                        this._thumbnailUrls[id] = result.thumbnailUrl;
                    }
                    this._netUploaded++;
                    this._uploadData.setStatus(id, qq.status.UPLOAD_SUCCESSFUL);
                }
                this._maybeParseAndSendUploadError(id, name, result, xhr);
                return result.success ? true : false;
            },
            _onDelete: function(id) {
                this._uploadData.setStatus(id, qq.status.DELETING);
            },
            _onDeleteComplete: function(id, xhrOrXdr, isError) {
                var name = this.getName(id);
                if (isError) {
                    this._handleDeleteFailed(id, xhrOrXdr);
                } else {
                    this._handleDeleteSuccess(id);
                }
            },
            _onInputChange: function(input) {
                var fileIndex;
                if (qq.supportedFeatures.ajaxUploading) {
                    for (fileIndex = 0; fileIndex < input.files.length; fileIndex++) {
                        this._annotateWithButtonId(input.files[fileIndex], input);
                    }
                    this.addFiles(input.files);
                } else if (input.value.length > 0) {
                    this.addFiles(input);
                }
                qq.each(this._buttons, function(idx, button) {
                    button.reset();
                });
            },
            _onProgress: function(id, name, loaded, total) {
                this._totalProgress && this._totalProgress.onIndividualProgress(id, loaded, total);
            },
            _onSubmit: function(id, name) {},
            _onSubmitCallbackSuccess: function(id, name) {
                this._onSubmit.apply(this, arguments);
                this._uploadData.setStatus(id, qq.status.SUBMITTED);
                this._onSubmitted.apply(this, arguments);
                if (this._options.autoUpload) {
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                    this._uploadFile(id);
                } else {
                    this._storeForLater(id);
                    this._options.callbacks.onSubmitted.apply(this, arguments);
                }
            },
            _onSubmitDelete: function(id, onSuccessCallback, additionalMandatedParams) {
                var uuid = this.getUuid(id), adjustedOnSuccessCallback;
                if (onSuccessCallback) {
                    adjustedOnSuccessCallback = qq.bind(onSuccessCallback, this, id, uuid, additionalMandatedParams);
                }
                if (this._isDeletePossible()) {
                    this._handleCheckedCallback({
                        name: "onSubmitDelete",
                        callback: qq.bind(this._options.callbacks.onSubmitDelete, this, id),
                        onSuccess: adjustedOnSuccessCallback || qq.bind(this._deleteHandler.sendDelete, this, id, uuid, additionalMandatedParams),
                        identifier: id
                    });
                    return true;
                } else {
                    this.log("Delete request ignored for ID " + id + ", delete feature is disabled or request not possible " + "due to CORS on a user agent that does not support pre-flighting.", "warn");
                    return false;
                }
            },
            _onSubmitted: function(id) {},
            _onTotalProgress: function(loaded, total) {
                this._options.callbacks.onTotalProgress(loaded, total);
            },
            _onUploadPrep: function(id) {},
            _onUpload: function(id, name) {
                this._uploadData.setStatus(id, qq.status.UPLOADING);
            },
            _onUploadChunk: function(id, chunkData) {},
            _onUploadChunkSuccess: function(id, chunkData) {
                if (!this._preventRetries[id] && this._options.retry.enableAuto) {
                    this._autoRetries[id] = 0;
                }
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.PAUSED) {
                    clearTimeout(this._retryTimeouts[id]);
                }
            },
            _onValidateBatchCallbackFailure: function(fileWrappers) {
                var self = this;
                qq.each(fileWrappers, function(idx, fileWrapper) {
                    self._fileOrBlobRejected(fileWrapper.id);
                });
            },
            _onValidateBatchCallbackSuccess: function(validationDescriptors, items, params, endpoint, button) {
                var errorMessage, itemLimit = this._currentItemLimit, proposedNetFilesUploadedOrQueued = this._netUploadedOrQueued;
                if (itemLimit === 0 || proposedNetFilesUploadedOrQueued <= itemLimit) {
                    if (items.length > 0) {
                        this._handleCheckedCallback({
                            name: "onValidate",
                            callback: qq.bind(this._options.callbacks.onValidate, this, validationDescriptors[0], button),
                            onSuccess: qq.bind(this._onValidateCallbackSuccess, this, items, 0, params, endpoint),
                            onFailure: qq.bind(this._onValidateCallbackFailure, this, items, 0, params, endpoint),
                            identifier: "Item '" + items[0].file.name + "', size: " + items[0].file.size
                        });
                    } else {
                        this._itemError("noFilesError");
                    }
                } else {
                    this._onValidateBatchCallbackFailure(items);
                    errorMessage = this._options.messages.tooManyItemsError.replace(/\{netItems\}/g, proposedNetFilesUploadedOrQueued).replace(/\{itemLimit\}/g, itemLimit);
                    this._batchError(errorMessage);
                }
            },
            _onValidateCallbackFailure: function(items, index, params, endpoint) {
                var nextIndex = index + 1;
                this._fileOrBlobRejected(items[index].id, items[index].file.name);
                this._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
            },
            _onValidateCallbackSuccess: function(items, index, params, endpoint) {
                var self = this, nextIndex = index + 1, validationDescriptor = this._getValidationDescriptor(items[index]);
                this._validateFileOrBlobData(items[index], validationDescriptor).then(function() {
                    self._upload(items[index].id, params, endpoint);
                    self._maybeProcessNextItemAfterOnValidateCallback(true, items, nextIndex, params, endpoint);
                }, function() {
                    self._maybeProcessNextItemAfterOnValidateCallback(false, items, nextIndex, params, endpoint);
                });
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                if (items.length === 0) {
                    this._itemError("noFilesError");
                    return;
                }
                var validationDescriptors = this._getValidationDescriptors(items), buttonId = this._getButtonId(items[0].file), button = this._getButton(buttonId);
                this._handleCheckedCallback({
                    name: "onValidateBatch",
                    callback: qq.bind(this._options.callbacks.onValidateBatch, this, validationDescriptors, button),
                    onSuccess: qq.bind(this._onValidateBatchCallbackSuccess, this, validationDescriptors, items, params, endpoint, button),
                    onFailure: qq.bind(this._onValidateBatchCallbackFailure, this, items),
                    identifier: "batch validation"
                });
            },
            _preventLeaveInProgress: function() {
                var self = this;
                this._disposeSupport.attach(window, "beforeunload", function(e) {
                    if (self.getInProgress()) {
                        e = e || window.event;
                        e.returnValue = self._options.messages.onLeave;
                        return self._options.messages.onLeave;
                    }
                });
            },
            _refreshSessionData: function() {
                var self = this, options = this._options.session;
                if (qq.Session && this._options.session.endpoint != null) {
                    if (!this._session) {
                        qq.extend(options, {
                            cors: this._options.cors
                        });
                        options.log = qq.bind(this.log, this);
                        options.addFileRecord = qq.bind(this._addCannedFile, this);
                        this._session = new qq.Session(options);
                    }
                    setTimeout(function() {
                        self._session.refresh().then(function(response, xhrOrXdr) {
                            self._sessionRequestComplete();
                            self._options.callbacks.onSessionRequestComplete(response, true, xhrOrXdr);
                        }, function(response, xhrOrXdr) {
                            self._options.callbacks.onSessionRequestComplete(response, false, xhrOrXdr);
                        });
                    }, 0);
                }
            },
            _sessionRequestComplete: function() {},
            _setSize: function(id, newSize) {
                this._uploadData.updateSize(id, newSize);
                this._totalProgress && this._totalProgress.onNewSize(id);
            },
            _shouldAutoRetry: function(id) {
                var uploadData = this._uploadData.retrieve({
                    id: id
                });
                if (!this._preventRetries[id] && this._options.retry.enableAuto && uploadData.status !== qq.status.PAUSED) {
                    if (this._autoRetries[id] === undefined) {
                        this._autoRetries[id] = 0;
                    }
                    if (this._autoRetries[id] < this._options.retry.maxAutoAttempts) {
                        this._autoRetries[id] += 1;
                        return true;
                    }
                }
                return false;
            },
            _storeForLater: function(id) {
                this._storedIds.push(id);
            },
            _trackButton: function(id) {
                var buttonId;
                if (qq.supportedFeatures.ajaxUploading) {
                    buttonId = this._handler.getFile(id).qqButtonId;
                } else {
                    buttonId = this._getButtonId(this._handler.getInput(id));
                }
                if (buttonId) {
                    this._buttonIdsForFileIds[id] = buttonId;
                }
            },
            _updateFormSupportAndParams: function(formElementOrId) {
                this._options.form.element = formElementOrId;
                this._formSupport = qq.FormSupport && new qq.FormSupport(this._options.form, qq.bind(this.uploadStoredFiles, this), qq.bind(this.log, this));
                if (this._formSupport && this._formSupport.attachedToForm) {
                    this._paramsStore.addReadOnly(null, this._formSupport.getFormInputsAsObject);
                    this._options.autoUpload = this._formSupport.newAutoUpload;
                    if (this._formSupport.newEndpoint) {
                        this.setEndpoint(this._formSupport.newEndpoint);
                    }
                }
            },
            _upload: function(id, params, endpoint) {
                var name = this.getName(id);
                if (params) {
                    this.setParams(params, id);
                }
                if (endpoint) {
                    this.setEndpoint(endpoint, id);
                }
                this._handleCheckedCallback({
                    name: "onSubmit",
                    callback: qq.bind(this._options.callbacks.onSubmit, this, id, name),
                    onSuccess: qq.bind(this._onSubmitCallbackSuccess, this, id, name),
                    onFailure: qq.bind(this._fileOrBlobRejected, this, id, name),
                    identifier: id
                });
            },
            _uploadFile: function(id) {
                if (!this._handler.upload(id)) {
                    this._uploadData.setStatus(id, qq.status.QUEUED);
                }
            },
            _uploadStoredFiles: function() {
                var idToUpload, stillSubmitting, self = this;
                while (this._storedIds.length) {
                    idToUpload = this._storedIds.shift();
                    this._uploadFile(idToUpload);
                }
                stillSubmitting = this.getUploads({
                    status: qq.status.SUBMITTING
                }).length;
                if (stillSubmitting) {
                    qq.log("Still waiting for " + stillSubmitting + " files to clear submit queue. Will re-parse stored IDs array shortly.");
                    setTimeout(function() {
                        self._uploadStoredFiles();
                    }, 1e3);
                }
            },
            _validateFileOrBlobData: function(fileWrapper, validationDescriptor) {
                var self = this, file = function() {
                    if (fileWrapper.file instanceof qq.BlobProxy) {
                        return fileWrapper.file.referenceBlob;
                    }
                    return fileWrapper.file;
                }(), name = validationDescriptor.name, size = validationDescriptor.size, buttonId = this._getButtonId(fileWrapper.file), validationBase = this._getValidationBase(buttonId), validityChecker = new qq.Promise();
                validityChecker.then(function() {}, function() {
                    self._fileOrBlobRejected(fileWrapper.id, name);
                });
                if (qq.isFileOrInput(file) && !this._isAllowedExtension(validationBase.allowedExtensions, name)) {
                    this._itemError("typeError", name, file);
                    return validityChecker.failure();
                }
                if (!this._options.validation.allowEmpty && size === 0) {
                    this._itemError("emptyError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && validationBase.sizeLimit && size > validationBase.sizeLimit) {
                    this._itemError("sizeError", name, file);
                    return validityChecker.failure();
                }
                if (size > 0 && size < validationBase.minSizeLimit) {
                    this._itemError("minSizeError", name, file);
                    return validityChecker.failure();
                }
                if (qq.ImageValidation && qq.supportedFeatures.imagePreviews && qq.isFile(file)) {
                    new qq.ImageValidation(file, qq.bind(self.log, self)).validate(validationBase.image).then(validityChecker.success, function(errorCode) {
                        self._itemError(errorCode + "ImageError", name, file);
                        validityChecker.failure();
                    });
                } else {
                    validityChecker.success();
                }
                return validityChecker;
            },
            _wrapCallbacks: function() {
                var self, safeCallback, prop;
                self = this;
                safeCallback = function(name, callback, args) {
                    var errorMsg;
                    try {
                        return callback.apply(self, args);
                    } catch (exception) {
                        errorMsg = exception.message || exception.toString();
                        self.log("Caught exception in '" + name + "' callback - " + errorMsg, "error");
                    }
                };
                for (prop in this._options.callbacks) {
                    (function() {
                        var callbackName, callbackFunc;
                        callbackName = prop;
                        callbackFunc = self._options.callbacks[callbackName];
                        self._options.callbacks[callbackName] = function() {
                            return safeCallback(callbackName, callbackFunc, arguments);
                        };
                    })();
                }
            }
        };
    })();
    (function() {
        "use strict";
        qq.FineUploaderBasic = function(o) {
            var self = this;
            this._options = {
                debug: false,
                button: null,
                multiple: true,
                maxConnections: 3,
                disableCancelForFormUploads: false,
                autoUpload: true,
                warnBeforeUnload: true,
                request: {
                    customHeaders: {},
                    endpoint: "/server/upload",
                    filenameParam: "qqfilename",
                    forceMultipart: true,
                    inputName: "qqfile",
                    method: "POST",
                    omitDefaultParams: false,
                    params: {},
                    paramsInBody: true,
                    requireSuccessJson: true,
                    totalFileSizeName: "qqtotalfilesize",
                    uuidName: "qquuid"
                },
                validation: {
                    allowedExtensions: [],
                    sizeLimit: 0,
                    minSizeLimit: 0,
                    itemLimit: 0,
                    stopOnFirstInvalidFile: true,
                    acceptFiles: null,
                    image: {
                        maxHeight: 0,
                        maxWidth: 0,
                        minHeight: 0,
                        minWidth: 0
                    },
                    allowEmpty: false
                },
                callbacks: {
                    onSubmit: function(id, name) {},
                    onSubmitted: function(id, name) {},
                    onComplete: function(id, name, responseJSON, maybeXhr) {},
                    onAllComplete: function(successful, failed) {},
                    onCancel: function(id, name) {},
                    onUpload: function(id, name) {},
                    onUploadChunk: function(id, name, chunkData) {},
                    onUploadChunkSuccess: function(id, chunkData, responseJSON, xhr) {},
                    onResume: function(id, fileName, chunkData, customResumeData) {},
                    onProgress: function(id, name, loaded, total) {},
                    onTotalProgress: function(loaded, total) {},
                    onError: function(id, name, reason, maybeXhrOrXdr) {},
                    onAutoRetry: function(id, name, attemptNumber) {},
                    onManualRetry: function(id, name) {},
                    onValidateBatch: function(fileOrBlobData) {},
                    onValidate: function(fileOrBlobData) {},
                    onSubmitDelete: function(id) {},
                    onDelete: function(id) {},
                    onDeleteComplete: function(id, xhrOrXdr, isError) {},
                    onPasteReceived: function(blob) {},
                    onStatusChange: function(id, oldStatus, newStatus) {},
                    onSessionRequestComplete: function(response, success, xhrOrXdr) {}
                },
                messages: {
                    typeError: "{file} has an invalid extension. Valid extension(s): {extensions}.",
                    sizeError: "{file} is too large, maximum file size is {sizeLimit}.",
                    minSizeError: "{file} is too small, minimum file size is {minSizeLimit}.",
                    emptyError: "{file} is empty, please select files again without it.",
                    noFilesError: "No files to upload.",
                    tooManyItemsError: "Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",
                    maxHeightImageError: "Image is too tall.",
                    maxWidthImageError: "Image is too wide.",
                    minHeightImageError: "Image is not tall enough.",
                    minWidthImageError: "Image is not wide enough.",
                    retryFailTooManyItems: "Retry failed - you have reached your file limit.",
                    onLeave: "The files are being uploaded, if you leave now the upload will be canceled.",
                    unsupportedBrowserIos8Safari: "Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."
                },
                retry: {
                    enableAuto: false,
                    maxAutoAttempts: 3,
                    autoAttemptDelay: 5,
                    preventRetryResponseProperty: "preventRetry"
                },
                classes: {
                    buttonHover: "qq-upload-button-hover",
                    buttonFocus: "qq-upload-button-focus"
                },
                chunking: {
                    enabled: false,
                    concurrent: {
                        enabled: false
                    },
                    mandatory: false,
                    paramNames: {
                        partIndex: "qqpartindex",
                        partByteOffset: "qqpartbyteoffset",
                        chunkSize: "qqchunksize",
                        totalFileSize: "qqtotalfilesize",
                        totalParts: "qqtotalparts"
                    },
                    partSize: function(id) {
                        return 2e6;
                    },
                    success: {
                        endpoint: null,
                        headers: function(id) {
                            return null;
                        },
                        jsonPayload: false,
                        method: "POST",
                        params: function(id) {
                            return null;
                        },
                        resetOnStatus: []
                    }
                },
                resume: {
                    enabled: false,
                    recordsExpireIn: 7,
                    paramNames: {
                        resuming: "qqresume"
                    },
                    customKeys: function(fileId) {
                        return [];
                    }
                },
                formatFileName: function(fileOrBlobName) {
                    return fileOrBlobName;
                },
                text: {
                    defaultResponseError: "Upload failure reason unknown",
                    fileInputTitle: "file input",
                    sizeSymbols: [ "kB", "MB", "GB", "TB", "PB", "EB" ]
                },
                deleteFile: {
                    enabled: false,
                    method: "DELETE",
                    endpoint: "/server/upload",
                    customHeaders: {},
                    params: {}
                },
                cors: {
                    expected: false,
                    sendCredentials: false,
                    allowXdr: false
                },
                blobs: {
                    defaultName: "misc_data"
                },
                paste: {
                    targetElement: null,
                    defaultName: "pasted_image"
                },
                camera: {
                    ios: false,
                    button: null
                },
                extraButtons: [],
                session: {
                    endpoint: null,
                    params: {},
                    customHeaders: {},
                    refreshOnReset: true
                },
                form: {
                    element: "qq-form",
                    autoUpload: false,
                    interceptSubmit: true
                },
                scaling: {
                    customResizer: null,
                    sendOriginal: true,
                    orient: true,
                    defaultType: null,
                    defaultQuality: 80,
                    failureText: "Failed to scale",
                    includeExif: false,
                    sizes: []
                },
                workarounds: {
                    iosEmptyVideos: true,
                    ios8SafariUploads: true,
                    ios8BrowserCrash: false
                }
            };
            qq.extend(this._options, o, true);
            this._buttons = [];
            this._extraButtonSpecs = {};
            this._buttonIdsForFileIds = [];
            this._wrapCallbacks();
            this._disposeSupport = new qq.DisposeSupport();
            this._storedIds = [];
            this._autoRetries = [];
            this._retryTimeouts = [];
            this._preventRetries = [];
            this._thumbnailUrls = [];
            this._netUploadedOrQueued = 0;
            this._netUploaded = 0;
            this._uploadData = this._createUploadDataTracker();
            this._initFormSupportAndParams();
            this._customHeadersStore = this._createStore(this._options.request.customHeaders);
            this._deleteFileCustomHeadersStore = this._createStore(this._options.deleteFile.customHeaders);
            this._deleteFileParamsStore = this._createStore(this._options.deleteFile.params);
            this._endpointStore = this._createStore(this._options.request.endpoint);
            this._deleteFileEndpointStore = this._createStore(this._options.deleteFile.endpoint);
            this._handler = this._createUploadHandler();
            this._deleteHandler = qq.DeleteFileAjaxRequester && this._createDeleteHandler();
            if (this._options.button) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._options.button,
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._generateExtraButtonSpecs();
            this._handleCameraAccess();
            if (this._options.paste.targetElement) {
                if (qq.PasteSupport) {
                    this._pasteHandler = this._createPasteHandler();
                } else {
                    this.log("Paste support module not found", "error");
                }
            }
            this._options.warnBeforeUnload && this._preventLeaveInProgress();
            this._imageGenerator = qq.ImageGenerator && new qq.ImageGenerator(qq.bind(this.log, this));
            this._refreshSessionData();
            this._succeededSinceLastAllComplete = [];
            this._failedSinceLastAllComplete = [];
            this._scaler = qq.Scaler && new qq.Scaler(this._options.scaling, qq.bind(this.log, this)) || {};
            if (this._scaler.enabled) {
                this._customNewFileHandler = qq.bind(this._scaler.handleNewFile, this._scaler);
            }
            if (qq.TotalProgress && qq.supportedFeatures.progressBar) {
                this._totalProgress = new qq.TotalProgress(qq.bind(this._onTotalProgress, this), function(id) {
                    var entry = self._uploadData.retrieve({
                        id: id
                    });
                    return entry && entry.size || 0;
                });
            }
            this._currentItemLimit = this._options.validation.itemLimit;
            this._customResumeDataStore = this._createStore();
        };
        qq.FineUploaderBasic.prototype = qq.basePublicApi;
        qq.extend(qq.FineUploaderBasic.prototype, qq.basePrivateApi);
    })();
    qq.AjaxRequester = function(o) {
        "use strict";
        var log, shouldParamsBeInQueryString, queue = [], requestData = {}, options = {
            acceptHeader: null,
            validMethods: [ "PATCH", "POST", "PUT" ],
            method: "POST",
            contentType: "application/x-www-form-urlencoded",
            maxConnections: 3,
            customHeaders: {},
            endpointStore: {},
            paramsStore: {},
            mandatedParams: {},
            allowXRequestedWithAndCacheControl: true,
            successfulResponseCodes: {
                DELETE: [ 200, 202, 204 ],
                PATCH: [ 200, 201, 202, 203, 204 ],
                POST: [ 200, 201, 202, 203, 204 ],
                PUT: [ 200, 201, 202, 203, 204 ],
                GET: [ 200 ]
            },
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onSend: function(id) {},
            onComplete: function(id, xhrOrXdr, isError) {},
            onProgress: null
        };
        qq.extend(options, o);
        log = options.log;
        if (qq.indexOf(options.validMethods, options.method) < 0) {
            throw new Error("'" + options.method + "' is not a supported method for this type of request!");
        }
        function isSimpleMethod() {
            return qq.indexOf([ "GET", "POST", "HEAD" ], options.method) >= 0;
        }
        function containsNonSimpleHeaders(headers) {
            var containsNonSimple = false;
            qq.each(containsNonSimple, function(idx, header) {
                if (qq.indexOf([ "Accept", "Accept-Language", "Content-Language", "Content-Type" ], header) < 0) {
                    containsNonSimple = true;
                    return false;
                }
            });
            return containsNonSimple;
        }
        function isXdr(xhr) {
            return options.cors.expected && xhr.withCredentials === undefined;
        }
        function getCorsAjaxTransport() {
            var xhrOrXdr;
            if (window.XMLHttpRequest || window.ActiveXObject) {
                xhrOrXdr = qq.createXhrInstance();
                if (xhrOrXdr.withCredentials === undefined) {
                    xhrOrXdr = new XDomainRequest();
                    xhrOrXdr.onload = function() {};
                    xhrOrXdr.onerror = function() {};
                    xhrOrXdr.ontimeout = function() {};
                    xhrOrXdr.onprogress = function() {};
                }
            }
            return xhrOrXdr;
        }
        function getXhrOrXdr(id, suppliedXhr) {
            var xhrOrXdr = requestData[id] && requestData[id].xhr;
            if (!xhrOrXdr) {
                if (suppliedXhr) {
                    xhrOrXdr = suppliedXhr;
                } else {
                    if (options.cors.expected) {
                        xhrOrXdr = getCorsAjaxTransport();
                    } else {
                        xhrOrXdr = qq.createXhrInstance();
                    }
                }
                requestData[id].xhr = xhrOrXdr;
            }
            return xhrOrXdr;
        }
        function dequeue(id) {
            var i = qq.indexOf(queue, id), max = options.maxConnections, nextId;
            delete requestData[id];
            queue.splice(i, 1);
            if (queue.length >= max && i < max) {
                nextId = queue[max - 1];
                sendRequest(nextId);
            }
        }
        function onComplete(id, xdrError) {
            var xhr = getXhrOrXdr(id), method = options.method, isError = xdrError === true;
            dequeue(id);
            if (isError) {
                log(method + " request for " + id + " has failed", "error");
            } else if (!isXdr(xhr) && !isResponseSuccessful(xhr.status)) {
                isError = true;
                log(method + " request for " + id + " has failed - response code " + xhr.status, "error");
            }
            options.onComplete(id, xhr, isError);
        }
        function getParams(id) {
            var onDemandParams = requestData[id].additionalParams, mandatedParams = options.mandatedParams, params;
            if (options.paramsStore.get) {
                params = options.paramsStore.get(id);
            }
            if (onDemandParams) {
                qq.each(onDemandParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            if (mandatedParams) {
                qq.each(mandatedParams, function(name, val) {
                    params = params || {};
                    params[name] = val;
                });
            }
            return params;
        }
        function sendRequest(id, optXhr) {
            var xhr = getXhrOrXdr(id, optXhr), method = options.method, params = getParams(id), payload = requestData[id].payload, url;
            options.onSend(id);
            url = createUrl(id, params, requestData[id].additionalQueryParams);
            if (isXdr(xhr)) {
                xhr.onload = getXdrLoadHandler(id);
                xhr.onerror = getXdrErrorHandler(id);
            } else {
                xhr.onreadystatechange = getXhrReadyStateChangeHandler(id);
            }
            registerForUploadProgress(id);
            xhr.open(method, url, true);
            if (options.cors.expected && options.cors.sendCredentials && !isXdr(xhr)) {
                xhr.withCredentials = true;
            }
            setHeaders(id);
            log("Sending " + method + " request for " + id);
            if (payload) {
                xhr.send(payload);
            } else if (shouldParamsBeInQueryString || !params) {
                xhr.send();
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded") >= 0) {
                xhr.send(qq.obj2url(params, ""));
            } else if (params && options.contentType && options.contentType.toLowerCase().indexOf("application/json") >= 0) {
                xhr.send(JSON.stringify(params));
            } else {
                xhr.send(params);
            }
            return xhr;
        }
        function createUrl(id, params, additionalQueryParams) {
            var endpoint = options.endpointStore.get(id), addToPath = requestData[id].addToPath;
            if (addToPath != undefined) {
                endpoint += "/" + addToPath;
            }
            if (shouldParamsBeInQueryString && params) {
                endpoint = qq.obj2url(params, endpoint);
            }
            if (additionalQueryParams) {
                endpoint = qq.obj2url(additionalQueryParams, endpoint);
            }
            return endpoint;
        }
        function getXhrReadyStateChangeHandler(id) {
            return function() {
                if (getXhrOrXdr(id).readyState === 4) {
                    onComplete(id);
                }
            };
        }
        function registerForUploadProgress(id) {
            var onProgress = options.onProgress;
            if (onProgress) {
                getXhrOrXdr(id).upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        onProgress(id, e.loaded, e.total);
                    }
                };
            }
        }
        function getXdrLoadHandler(id) {
            return function() {
                onComplete(id);
            };
        }
        function getXdrErrorHandler(id) {
            return function() {
                onComplete(id, true);
            };
        }
        function setHeaders(id) {
            var xhr = getXhrOrXdr(id), customHeaders = options.customHeaders, onDemandHeaders = requestData[id].additionalHeaders || {}, method = options.method, allHeaders = {};
            if (!isXdr(xhr)) {
                options.acceptHeader && xhr.setRequestHeader("Accept", options.acceptHeader);
                if (options.allowXRequestedWithAndCacheControl) {
                    if (!options.cors.expected || (!isSimpleMethod() || containsNonSimpleHeaders(customHeaders))) {
                        xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                        xhr.setRequestHeader("Cache-Control", "no-cache");
                    }
                }
                if (options.contentType && (method === "POST" || method === "PUT")) {
                    xhr.setRequestHeader("Content-Type", options.contentType);
                }
                qq.extend(allHeaders, qq.isFunction(customHeaders) ? customHeaders(id) : customHeaders);
                qq.extend(allHeaders, onDemandHeaders);
                qq.each(allHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        }
        function isResponseSuccessful(responseCode) {
            return qq.indexOf(options.successfulResponseCodes[options.method], responseCode) >= 0;
        }
        function prepareToSend(id, optXhr, addToPath, additionalParams, additionalQueryParams, additionalHeaders, payload) {
            requestData[id] = {
                addToPath: addToPath,
                additionalParams: additionalParams,
                additionalQueryParams: additionalQueryParams,
                additionalHeaders: additionalHeaders,
                payload: payload
            };
            var len = queue.push(id);
            if (len <= options.maxConnections) {
                return sendRequest(id, optXhr);
            }
        }
        shouldParamsBeInQueryString = options.method === "GET" || options.method === "DELETE";
        qq.extend(this, {
            initTransport: function(id) {
                var path, params, headers, payload, cacheBuster, additionalQueryParams;
                return {
                    withPath: function(appendToPath) {
                        path = appendToPath;
                        return this;
                    },
                    withParams: function(additionalParams) {
                        params = additionalParams;
                        return this;
                    },
                    withQueryParams: function(_additionalQueryParams_) {
                        additionalQueryParams = _additionalQueryParams_;
                        return this;
                    },
                    withHeaders: function(additionalHeaders) {
                        headers = additionalHeaders;
                        return this;
                    },
                    withPayload: function(thePayload) {
                        payload = thePayload;
                        return this;
                    },
                    withCacheBuster: function() {
                        cacheBuster = true;
                        return this;
                    },
                    send: function(optXhr) {
                        if (cacheBuster && qq.indexOf([ "GET", "DELETE" ], options.method) >= 0) {
                            params.qqtimestamp = new Date().getTime();
                        }
                        return prepareToSend(id, optXhr, path, params, additionalQueryParams, headers, payload);
                    }
                };
            },
            canceled: function(id) {
                dequeue(id);
            }
        });
    };
    qq.UploadHandler = function(spec) {
        "use strict";
        var proxy = spec.proxy, fileState = {}, onCancel = proxy.onCancel, getName = proxy.getName;
        qq.extend(this, {
            add: function(id, fileItem) {
                fileState[id] = fileItem;
                fileState[id].temp = {};
            },
            cancel: function(id) {
                var self = this, cancelFinalizationEffort = new qq.Promise(), onCancelRetVal = onCancel(id, getName(id), cancelFinalizationEffort);
                onCancelRetVal.then(function() {
                    if (self.isValid(id)) {
                        fileState[id].canceled = true;
                        self.expunge(id);
                    }
                    cancelFinalizationEffort.success();
                });
            },
            expunge: function(id) {
                delete fileState[id];
            },
            getThirdPartyFileId: function(id) {
                return fileState[id].key;
            },
            isValid: function(id) {
                return fileState[id] !== undefined;
            },
            reset: function() {
                fileState = {};
            },
            _getFileState: function(id) {
                return fileState[id];
            },
            _setThirdPartyFileId: function(id, thirdPartyFileId) {
                fileState[id].key = thirdPartyFileId;
            },
            _wasCanceled: function(id) {
                return !!fileState[id].canceled;
            }
        });
    };
    qq.UploadHandlerController = function(o, namespace) {
        "use strict";
        var controller = this, chunkingPossible = false, concurrentChunkingPossible = false, chunking, preventRetryResponse, log, handler, options = {
            paramsStore: {},
            maxConnections: 3,
            chunking: {
                enabled: false,
                multiple: {
                    enabled: false
                }
            },
            log: function(str, level) {},
            onProgress: function(id, fileName, loaded, total) {},
            onComplete: function(id, fileName, response, xhr) {},
            onCancel: function(id, fileName) {},
            onUploadPrep: function(id) {},
            onUpload: function(id, fileName) {},
            onUploadChunk: function(id, fileName, chunkData) {},
            onUploadChunkSuccess: function(id, chunkData, response, xhr) {},
            onAutoRetry: function(id, fileName, response, xhr) {},
            onResume: function(id, fileName, chunkData, customResumeData) {},
            onUuidChanged: function(id, newUuid) {},
            getName: function(id) {},
            setSize: function(id, newSize) {},
            isQueued: function(id) {},
            getIdsInProxyGroup: function(id) {},
            getIdsInBatch: function(id) {},
            isInProgress: function(id) {}
        }, chunked = {
            done: function(id, chunkIdx, response, xhr) {
                var chunkData = handler._getChunkData(id, chunkIdx);
                handler._getFileState(id).attemptingResume = false;
                delete handler._getFileState(id).temp.chunkProgress[chunkIdx];
                handler._getFileState(id).loaded += chunkData.size;
                options.onUploadChunkSuccess(id, handler._getChunkDataForCallback(chunkData), response, xhr);
            },
            finalize: function(id) {
                var size = options.getSize(id), name = options.getName(id);
                log("All chunks have been uploaded for " + id + " - finalizing....");
                handler.finalizeChunks(id).then(function(response, xhr) {
                    log("Finalize successful for " + id);
                    var normaizedResponse = upload.normalizeResponse(response, true);
                    options.onProgress(id, name, size, size);
                    handler._maybeDeletePersistedChunkData(id);
                    upload.cleanup(id, normaizedResponse, xhr);
                }, function(response, xhr) {
                    var normalizedResponse = upload.normalizeResponse(response, false);
                    log("Problem finalizing chunks for file ID " + id + " - " + normalizedResponse.error, "error");
                    if (normalizedResponse.reset || xhr && options.chunking.success.resetOnStatus.indexOf(xhr.status) >= 0) {
                        chunked.reset(id);
                    }
                    if (!options.onAutoRetry(id, name, normalizedResponse, xhr)) {
                        upload.cleanup(id, normalizedResponse, xhr);
                    }
                });
            },
            handleFailure: function(chunkIdx, id, response, xhr) {
                var name = options.getName(id);
                log("Chunked upload request failed for " + id + ", chunk " + chunkIdx);
                handler.clearCachedChunk(id, chunkIdx);
                var responseToReport = upload.normalizeResponse(response, false), inProgressIdx;
                if (responseToReport.reset) {
                    chunked.reset(id);
                } else {
                    var inProgressChunksArray = handler._getFileState(id).chunking.inProgress;
                    inProgressIdx = inProgressChunksArray ? qq.indexOf(inProgressChunksArray, chunkIdx) : -1;
                    if (inProgressIdx >= 0) {
                        handler._getFileState(id).chunking.inProgress.splice(inProgressIdx, 1);
                        handler._getFileState(id).chunking.remaining.unshift(chunkIdx);
                    }
                }
                if (!handler._getFileState(id).temp.ignoreFailure) {
                    if (concurrentChunkingPossible) {
                        handler._getFileState(id).temp.ignoreFailure = true;
                        log(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.", JSON.stringify(Object.keys(handler._getXhrs(id))), JSON.stringify(handler._getFileState(id).chunking.inProgress)));
                        qq.each(handler._getXhrs(id), function(ckid, ckXhr) {
                            log(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ", id, ckid, ckXhr.readyState));
                            ckXhr.abort();
                            ckXhr._cancelled = true;
                        });
                        handler.moveInProgressToRemaining(id);
                        connectionManager.free(id, true);
                    }
                    if (!options.onAutoRetry(id, name, responseToReport, xhr)) {
                        upload.cleanup(id, responseToReport, xhr);
                    }
                }
            },
            hasMoreParts: function(id) {
                return !!handler._getFileState(id).chunking.remaining.length;
            },
            nextPart: function(id) {
                var nextIdx = handler._getFileState(id).chunking.remaining.shift();
                if (nextIdx >= handler._getTotalChunks(id)) {
                    nextIdx = null;
                }
                return nextIdx;
            },
            reset: function(id) {
                log("Server or callback has ordered chunking effort to be restarted on next attempt for item ID " + id, "error");
                handler._maybeDeletePersistedChunkData(id);
                handler.reevaluateChunking(id);
                handler._getFileState(id).loaded = 0;
                handler._getFileState(id).attemptingResume = false;
            },
            sendNext: function(id) {
                var size = options.getSize(id), name = options.getName(id), chunkIdx = chunked.nextPart(id), chunkData = handler._getChunkData(id, chunkIdx), fileState = handler._getFileState(id), resuming = fileState.attemptingResume, inProgressChunks = fileState.chunking.inProgress || [];
                if (fileState.loaded == null) {
                    fileState.loaded = 0;
                }
                if (resuming && options.onResume(id, name, chunkData, fileState.customResumeData) === false) {
                    chunked.reset(id);
                    chunkIdx = chunked.nextPart(id);
                    chunkData = handler._getChunkData(id, chunkIdx);
                    resuming = false;
                }
                if (chunkIdx == null && inProgressChunks.length === 0) {
                    chunked.finalize(id);
                } else {
                    inProgressChunks.push(chunkIdx);
                    handler._getFileState(id).chunking.inProgress = inProgressChunks;
                    if (concurrentChunkingPossible) {
                        connectionManager.open(id, chunkIdx);
                    }
                    if (concurrentChunkingPossible && connectionManager.available() && handler._getFileState(id).chunking.remaining.length) {
                        chunked.sendNext(id);
                    }
                    if (chunkData.blob.size === 0) {
                        log(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.", chunkIdx, id), "error");
                        chunked.handleFailure(chunkIdx, id, "File is no longer available", null);
                    }
                    var onUploadChunkPromise = options.onUploadChunk(id, name, handler._getChunkDataForCallback(chunkData));
                    onUploadChunkPromise.then(function(requestOverrides) {
                        if (!options.isInProgress(id)) {
                            log(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.", id, chunkIdx));
                        } else {
                            log(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.", id, chunkIdx, chunkData.start + 1, chunkData.end, size));
                            var uploadChunkData = {
                                chunkIdx: chunkIdx,
                                id: id,
                                overrides: requestOverrides,
                                resuming: resuming
                            };
                            handler.uploadChunk(uploadChunkData).then(function success(response, xhr) {
                                log("Chunked upload request succeeded for " + id + ", chunk " + chunkIdx);
                                handler.clearCachedChunk(id, chunkIdx);
                                var inProgressChunks = handler._getFileState(id).chunking.inProgress || [], responseToReport = upload.normalizeResponse(response, true), inProgressChunkIdx = qq.indexOf(inProgressChunks, chunkIdx);
                                log(qq.format("Chunk {} for file {} uploaded successfully.", chunkIdx, id));
                                chunked.done(id, chunkIdx, responseToReport, xhr);
                                if (inProgressChunkIdx >= 0) {
                                    inProgressChunks.splice(inProgressChunkIdx, 1);
                                }
                                handler._maybePersistChunkedState(id);
                                if (!chunked.hasMoreParts(id) && inProgressChunks.length === 0) {
                                    chunked.finalize(id);
                                } else if (chunked.hasMoreParts(id)) {
                                    chunked.sendNext(id);
                                } else {
                                    log(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}", id, JSON.stringify(inProgressChunks)));
                                }
                            }, function failure(response, xhr) {
                                chunked.handleFailure(chunkIdx, id, response, xhr);
                            }).done(function() {
                                handler.clearXhr(id, chunkIdx);
                            });
                        }
                    }, function(error) {
                        chunked.handleFailure(chunkIdx, id, error, null);
                    });
                }
            }
        }, connectionManager = {
            _open: [],
            _openChunks: {},
            _waiting: [],
            available: function() {
                var max = options.maxConnections, openChunkEntriesCount = 0, openChunksCount = 0;
                qq.each(connectionManager._openChunks, function(fileId, openChunkIndexes) {
                    openChunkEntriesCount++;
                    openChunksCount += openChunkIndexes.length;
                });
                return max - (connectionManager._open.length - openChunkEntriesCount + openChunksCount);
            },
            free: function(id, dontAllowNext) {
                var allowNext = !dontAllowNext, waitingIndex = qq.indexOf(connectionManager._waiting, id), connectionsIndex = qq.indexOf(connectionManager._open, id), nextId;
                delete connectionManager._openChunks[id];
                if (upload.getProxyOrBlob(id) instanceof qq.BlobProxy) {
                    log("Generated blob upload has ended for " + id + ", disposing generated blob.");
                    delete handler._getFileState(id).file;
                }
                if (waitingIndex >= 0) {
                    connectionManager._waiting.splice(waitingIndex, 1);
                } else if (allowNext && connectionsIndex >= 0) {
                    connectionManager._open.splice(connectionsIndex, 1);
                    nextId = connectionManager._waiting.shift();
                    if (nextId >= 0) {
                        connectionManager._open.push(nextId);
                        upload.start(nextId);
                    }
                }
            },
            getWaitingOrConnected: function() {
                var waitingOrConnected = [];
                qq.each(connectionManager._openChunks, function(fileId, chunks) {
                    if (chunks && chunks.length) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                qq.each(connectionManager._open, function(idx, fileId) {
                    if (!connectionManager._openChunks[fileId]) {
                        waitingOrConnected.push(parseInt(fileId));
                    }
                });
                waitingOrConnected = waitingOrConnected.concat(connectionManager._waiting);
                return waitingOrConnected;
            },
            isUsingConnection: function(id) {
                return qq.indexOf(connectionManager._open, id) >= 0;
            },
            open: function(id, chunkIdx) {
                if (chunkIdx == null) {
                    connectionManager._waiting.push(id);
                }
                if (connectionManager.available()) {
                    if (chunkIdx == null) {
                        connectionManager._waiting.pop();
                        connectionManager._open.push(id);
                    } else {
                        (function() {
                            var openChunksEntry = connectionManager._openChunks[id] || [];
                            openChunksEntry.push(chunkIdx);
                            connectionManager._openChunks[id] = openChunksEntry;
                        })();
                    }
                    return true;
                }
                return false;
            },
            reset: function() {
                connectionManager._waiting = [];
                connectionManager._open = [];
            }
        }, simple = {
            send: function(id, name) {
                var fileState = handler._getFileState(id);
                if (!fileState) {
                    log("Ignoring send request as this upload may have been cancelled, File ID " + id, "warn");
                    return;
                }
                fileState.loaded = 0;
                log("Sending simple upload request for " + id);
                handler.uploadFile(id).then(function(response, optXhr) {
                    log("Simple upload request succeeded for " + id);
                    var responseToReport = upload.normalizeResponse(response, true), size = options.getSize(id);
                    options.onProgress(id, name, size, size);
                    upload.maybeNewUuid(id, responseToReport);
                    upload.cleanup(id, responseToReport, optXhr);
                }, function(response, optXhr) {
                    log("Simple upload request failed for " + id);
                    var responseToReport = upload.normalizeResponse(response, false);
                    if (!options.onAutoRetry(id, name, responseToReport, optXhr)) {
                        upload.cleanup(id, responseToReport, optXhr);
                    }
                });
            }
        }, upload = {
            cancel: function(id) {
                log("Cancelling " + id);
                options.paramsStore.remove(id);
                connectionManager.free(id);
            },
            cleanup: function(id, response, optXhr) {
                var name = options.getName(id);
                options.onComplete(id, name, response, optXhr);
                if (handler._getFileState(id)) {
                    handler._clearXhrs && handler._clearXhrs(id);
                }
                connectionManager.free(id);
            },
            getProxyOrBlob: function(id) {
                return handler.getProxy && handler.getProxy(id) || handler.getFile && handler.getFile(id);
            },
            initHandler: function() {
                var handlerType = namespace ? qq[namespace] : qq.traditional, handlerModuleSubtype = qq.supportedFeatures.ajaxUploading ? "Xhr" : "Form";
                handler = new handlerType[handlerModuleSubtype + "UploadHandler"](options, {
                    getCustomResumeData: options.getCustomResumeData,
                    getDataByUuid: options.getDataByUuid,
                    getName: options.getName,
                    getSize: options.getSize,
                    getUuid: options.getUuid,
                    log: log,
                    onCancel: options.onCancel,
                    onProgress: options.onProgress,
                    onUuidChanged: options.onUuidChanged,
                    onFinalizing: function(id) {
                        options.setStatus(id, qq.status.UPLOAD_FINALIZING);
                    }
                });
                if (handler._removeExpiredChunkingRecords) {
                    handler._removeExpiredChunkingRecords();
                }
            },
            isDeferredEligibleForUpload: function(id) {
                return options.isQueued(id);
            },
            maybeDefer: function(id, blob) {
                if (blob && !handler.getFile(id) && blob instanceof qq.BlobProxy) {
                    options.onUploadPrep(id);
                    log("Attempting to generate a blob on-demand for " + id);
                    blob.create().then(function(generatedBlob) {
                        log("Generated an on-demand blob for " + id);
                        handler.updateBlob(id, generatedBlob);
                        options.setSize(id, generatedBlob.size);
                        handler.reevaluateChunking(id);
                        upload.maybeSendDeferredFiles(id);
                    }, function(errorMessage) {
                        var errorResponse = {};
                        if (errorMessage) {
                            errorResponse.error = errorMessage;
                        }
                        log(qq.format("Failed to generate blob for ID {}.  Error message: {}.", id, errorMessage), "error");
                        options.onComplete(id, options.getName(id), qq.extend(errorResponse, preventRetryResponse), null);
                        upload.maybeSendDeferredFiles(id);
                        connectionManager.free(id);
                    });
                } else {
                    return upload.maybeSendDeferredFiles(id);
                }
                return false;
            },
            maybeSendDeferredFiles: function(id) {
                var idsInGroup = options.getIdsInProxyGroup(id), uploadedThisId = false;
                if (idsInGroup && idsInGroup.length) {
                    log("Maybe ready to upload proxy group file " + id);
                    qq.each(idsInGroup, function(idx, idInGroup) {
                        if (upload.isDeferredEligibleForUpload(idInGroup) && !!handler.getFile(idInGroup)) {
                            uploadedThisId = idInGroup === id;
                            upload.now(idInGroup);
                        } else if (upload.isDeferredEligibleForUpload(idInGroup)) {
                            return false;
                        }
                    });
                } else {
                    uploadedThisId = true;
                    upload.now(id);
                }
                return uploadedThisId;
            },
            maybeNewUuid: function(id, response) {
                if (response.newUuid !== undefined) {
                    options.onUuidChanged(id, response.newUuid);
                }
            },
            normalizeResponse: function(originalResponse, successful) {
                var response = originalResponse;
                if (!qq.isObject(originalResponse)) {
                    response = {};
                    if (qq.isString(originalResponse) && !successful) {
                        response.error = originalResponse;
                    }
                }
                response.success = successful;
                return response;
            },
            now: function(id) {
                var name = options.getName(id);
                if (!controller.isValid(id)) {
                    throw new qq.Error(id + " is not a valid file ID to upload!");
                }
                options.onUpload(id, name).then(function(response) {
                    if (response && response.pause) {
                        options.setStatus(id, qq.status.PAUSED);
                        handler.pause(id);
                        connectionManager.free(id);
                    } else {
                        if (chunkingPossible && handler._shouldChunkThisFile(id)) {
                            chunked.sendNext(id);
                        } else {
                            simple.send(id, name);
                        }
                    }
                }, function(error) {
                    error = error || {};
                    log(id + " upload start aborted due to rejected onUpload Promise - details: " + error, "error");
                    if (!options.onAutoRetry(id, name, error.responseJSON || {})) {
                        var response = upload.normalizeResponse(error.responseJSON, false);
                        upload.cleanup(id, response);
                    }
                });
            },
            start: function(id) {
                var blobToUpload = upload.getProxyOrBlob(id);
                if (blobToUpload) {
                    return upload.maybeDefer(id, blobToUpload);
                } else {
                    upload.now(id);
                    return true;
                }
            }
        };
        qq.extend(this, {
            add: function(id, file) {
                handler.add.apply(this, arguments);
            },
            upload: function(id) {
                if (connectionManager.open(id)) {
                    return upload.start(id);
                }
                return false;
            },
            retry: function(id) {
                if (concurrentChunkingPossible) {
                    handler._getFileState(id).temp.ignoreFailure = false;
                }
                if (connectionManager.isUsingConnection(id)) {
                    return upload.start(id);
                } else {
                    return controller.upload(id);
                }
            },
            cancel: function(id) {
                var cancelRetVal = handler.cancel(id);
                if (qq.isGenericPromise(cancelRetVal)) {
                    cancelRetVal.then(function() {
                        upload.cancel(id);
                    });
                } else if (cancelRetVal !== false) {
                    upload.cancel(id);
                }
            },
            cancelAll: function() {
                var waitingOrConnected = connectionManager.getWaitingOrConnected(), i;
                if (waitingOrConnected.length) {
                    for (i = waitingOrConnected.length - 1; i >= 0; i--) {
                        controller.cancel(waitingOrConnected[i]);
                    }
                }
                connectionManager.reset();
            },
            getFile: function(id) {
                if (handler.getProxy && handler.getProxy(id)) {
                    return handler.getProxy(id).referenceBlob;
                }
                return handler.getFile && handler.getFile(id);
            },
            isProxied: function(id) {
                return !!(handler.getProxy && handler.getProxy(id));
            },
            getInput: function(id) {
                if (handler.getInput) {
                    return handler.getInput(id);
                }
            },
            reset: function() {
                log("Resetting upload handler");
                controller.cancelAll();
                connectionManager.reset();
                handler.reset();
            },
            expunge: function(id) {
                if (controller.isValid(id)) {
                    return handler.expunge(id);
                }
            },
            isValid: function(id) {
                return handler.isValid(id);
            },
            hasResumeRecord: function(id) {
                var key = handler.isValid(id) && handler._getLocalStorageId && handler._getLocalStorageId(id);
                if (key) {
                    return !!localStorage.getItem(key);
                }
                return false;
            },
            getResumableFilesData: function() {
                if (handler.getResumableFilesData) {
                    return handler.getResumableFilesData();
                }
                return [];
            },
            getThirdPartyFileId: function(id) {
                if (controller.isValid(id)) {
                    return handler.getThirdPartyFileId(id);
                }
            },
            pause: function(id) {
                if (controller.isResumable(id) && handler.pause && controller.isValid(id) && handler.pause(id)) {
                    connectionManager.free(id);
                    handler.moveInProgressToRemaining(id);
                    return true;
                }
                return false;
            },
            isAttemptingResume: function(id) {
                return !!handler.isAttemptingResume && handler.isAttemptingResume(id);
            },
            isResumable: function(id) {
                return !!handler.isResumable && handler.isResumable(id);
            }
        });
        qq.extend(options, o);
        log = options.log;
        chunkingPossible = options.chunking.enabled && qq.supportedFeatures.chunking;
        concurrentChunkingPossible = chunkingPossible && options.chunking.concurrent.enabled;
        preventRetryResponse = function() {
            var response = {};
            response[options.preventRetryParam] = true;
            return response;
        }();
        upload.initHandler();
    };
    qq.WindowReceiveMessage = function(o) {
        "use strict";
        var options = {
            log: function(message, level) {}
        }, callbackWrapperDetachers = {};
        qq.extend(options, o);
        qq.extend(this, {
            receiveMessage: function(id, callback) {
                var onMessageCallbackWrapper = function(event) {
                    callback(event.data);
                };
                if (window.postMessage) {
                    callbackWrapperDetachers[id] = qq(window).attach("message", onMessageCallbackWrapper);
                } else {
                    log("iframe message passing not supported in this browser!", "error");
                }
            },
            stopReceivingMessages: function(id) {
                if (window.postMessage) {
                    var detacher = callbackWrapperDetachers[id];
                    if (detacher) {
                        detacher();
                    }
                }
            }
        });
    };
    qq.FormUploadHandler = function(spec) {
        "use strict";
        var options = spec.options, handler = this, proxy = spec.proxy, formHandlerInstanceId = qq.getUniqueId(), onloadCallbacks = {}, detachLoadEvents = {}, postMessageCallbackTimers = {}, isCors = options.isCors, inputName = options.inputName, getUuid = proxy.getUuid, log = proxy.log, corsMessageReceiver = new qq.WindowReceiveMessage({
            log: log
        });
        function expungeFile(id) {
            delete detachLoadEvents[id];
            if (isCors) {
                clearTimeout(postMessageCallbackTimers[id]);
                delete postMessageCallbackTimers[id];
                corsMessageReceiver.stopReceivingMessages(id);
            }
            var iframe = document.getElementById(handler._getIframeName(id));
            if (iframe) {
                iframe.setAttribute("src", "javascript:false;");
                qq(iframe).remove();
            }
        }
        function getFileIdForIframeName(iframeName) {
            return iframeName.split("_")[0];
        }
        function initIframeForUpload(name) {
            var iframe = qq.toElement("<iframe src='javascript:false;' name='" + name + "' />");
            iframe.setAttribute("id", name);
            iframe.style.display = "none";
            document.body.appendChild(iframe);
            return iframe;
        }
        function registerPostMessageCallback(iframe, callback) {
            var iframeName = iframe.id, fileId = getFileIdForIframeName(iframeName), uuid = getUuid(fileId);
            onloadCallbacks[uuid] = callback;
            detachLoadEvents[fileId] = qq(iframe).attach("load", function() {
                if (handler.getInput(fileId)) {
                    log("Received iframe load event for CORS upload request (iframe name " + iframeName + ")");
                    postMessageCallbackTimers[iframeName] = setTimeout(function() {
                        var errorMessage = "No valid message received from loaded iframe for iframe name " + iframeName;
                        log(errorMessage, "error");
                        callback({
                            error: errorMessage
                        });
                    }, 1e3);
                }
            });
            corsMessageReceiver.receiveMessage(iframeName, function(message) {
                log("Received the following window message: '" + message + "'");
                var fileId = getFileIdForIframeName(iframeName), response = handler._parseJsonResponse(message), uuid = response.uuid, onloadCallback;
                if (uuid && onloadCallbacks[uuid]) {
                    log("Handling response for iframe name " + iframeName);
                    clearTimeout(postMessageCallbackTimers[iframeName]);
                    delete postMessageCallbackTimers[iframeName];
                    handler._detachLoadEvent(iframeName);
                    onloadCallback = onloadCallbacks[uuid];
                    delete onloadCallbacks[uuid];
                    corsMessageReceiver.stopReceivingMessages(iframeName);
                    onloadCallback(response);
                } else if (!uuid) {
                    log("'" + message + "' does not contain a UUID - ignoring.");
                }
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, fileInput) {
                    super_.add(id, {
                        input: fileInput
                    });
                    fileInput.setAttribute("name", inputName);
                    if (fileInput.parentNode) {
                        qq(fileInput).remove();
                    }
                },
                expunge: function(id) {
                    expungeFile(id);
                    super_.expunge(id);
                },
                isValid: function(id) {
                    return super_.isValid(id) && handler._getFileState(id).input !== undefined;
                }
            };
        });
        qq.extend(this, {
            getInput: function(id) {
                return handler._getFileState(id).input;
            },
            _attachLoadEvent: function(iframe, callback) {
                var responseDescriptor;
                if (isCors) {
                    registerPostMessageCallback(iframe, callback);
                } else {
                    detachLoadEvents[iframe.id] = qq(iframe).attach("load", function() {
                        log("Received response for " + iframe.id);
                        if (!iframe.parentNode) {
                            return;
                        }
                        try {
                            if (iframe.contentDocument && iframe.contentDocument.body && iframe.contentDocument.body.innerHTML == "false") {
                                return;
                            }
                        } catch (error) {
                            log("Error when attempting to access iframe during handling of upload response (" + error.message + ")", "error");
                            responseDescriptor = {
                                success: false
                            };
                        }
                        callback(responseDescriptor);
                    });
                }
            },
            _createIframe: function(id) {
                var iframeName = handler._getIframeName(id);
                return initIframeForUpload(iframeName);
            },
            _detachLoadEvent: function(id) {
                if (detachLoadEvents[id] !== undefined) {
                    detachLoadEvents[id]();
                    delete detachLoadEvents[id];
                }
            },
            _getIframeName: function(fileId) {
                return fileId + "_" + formHandlerInstanceId;
            },
            _initFormForUpload: function(spec) {
                var method = spec.method, endpoint = spec.endpoint, params = spec.params, paramsInBody = spec.paramsInBody, targetName = spec.targetName, form = qq.toElement("<form method='" + method + "' enctype='multipart/form-data'></form>"), url = endpoint;
                if (paramsInBody) {
                    qq.obj2Inputs(params, form);
                } else {
                    url = qq.obj2url(params, endpoint);
                }
                form.setAttribute("action", url);
                form.setAttribute("target", targetName);
                form.style.display = "none";
                document.body.appendChild(form);
                return form;
            },
            _parseJsonResponse: function(innerHtmlOrMessage) {
                var response = {};
                try {
                    response = qq.parseJson(innerHtmlOrMessage);
                } catch (error) {
                    log("Error when attempting to parse iframe upload response (" + error.message + ")", "error");
                }
                return response;
            }
        });
    };
    qq.XhrUploadHandler = function(spec) {
        "use strict";
        var handler = this, namespace = spec.options.namespace, proxy = spec.proxy, chunking = spec.options.chunking, getChunkSize = function(id) {
            var fileState = handler._getFileState(id);
            if (fileState.chunkSize) {
                return fileState.chunkSize;
            } else {
                var chunkSize = chunking.partSize;
                if (qq.isFunction(chunkSize)) {
                    chunkSize = chunkSize(id, getSize(id));
                }
                fileState.chunkSize = chunkSize;
                return chunkSize;
            }
        }, resume = spec.options.resume, chunkFiles = chunking && spec.options.chunking.enabled && qq.supportedFeatures.chunking, resumeEnabled = resume && spec.options.resume.enabled && chunkFiles && qq.supportedFeatures.resume, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, getEndpoint = proxy.getEndpoint, getDataByUuid = proxy.getDataByUuid, onUuidChanged = proxy.onUuidChanged, onProgress = proxy.onProgress, log = proxy.log, getCustomResumeData = proxy.getCustomResumeData;
        function abort(id) {
            qq.each(handler._getXhrs(id), function(xhrId, xhr) {
                var ajaxRequester = handler._getAjaxRequester(id, xhrId);
                xhr.onreadystatechange = null;
                xhr.upload.onprogress = null;
                xhr.abort();
                ajaxRequester && ajaxRequester.canceled && ajaxRequester.canceled(id);
            });
        }
        qq.extend(this, new qq.UploadHandler(spec));
        qq.override(this, function(super_) {
            return {
                add: function(id, blobOrProxy) {
                    if (qq.isFile(blobOrProxy) || qq.isBlob(blobOrProxy)) {
                        super_.add(id, {
                            file: blobOrProxy
                        });
                    } else if (blobOrProxy instanceof qq.BlobProxy) {
                        super_.add(id, {
                            proxy: blobOrProxy
                        });
                    } else {
                        throw new Error("Passed obj is not a File, Blob, or proxy");
                    }
                    handler._initTempState(id);
                    resumeEnabled && handler._maybePrepareForResume(id);
                },
                expunge: function(id) {
                    abort(id);
                    handler._maybeDeletePersistedChunkData(id);
                    handler._clearXhrs(id);
                    super_.expunge(id);
                }
            };
        });
        qq.extend(this, {
            clearCachedChunk: function(id, chunkIdx) {
                var fileState = handler._getFileState(id);
                if (fileState) {
                    delete fileState.temp.cachedChunks[chunkIdx];
                }
            },
            clearXhr: function(id, chunkIdx) {
                var tempState = handler._getFileState(id).temp;
                if (tempState.xhrs) {
                    delete tempState.xhrs[chunkIdx];
                }
                if (tempState.ajaxRequesters) {
                    delete tempState.ajaxRequesters[chunkIdx];
                }
            },
            finalizeChunks: function(id, responseParser) {
                var lastChunkIdx = handler._getTotalChunks(id) - 1, xhr = handler._getXhr(id, lastChunkIdx);
                if (responseParser) {
                    return new qq.Promise().success(responseParser(xhr), xhr);
                }
                return new qq.Promise().success({}, xhr);
            },
            getFile: function(id) {
                return handler.isValid(id) && handler._getFileState(id).file;
            },
            getProxy: function(id) {
                return handler.isValid(id) && handler._getFileState(id).proxy;
            },
            getResumableFilesData: function() {
                var resumableFilesData = [];
                handler._iterateResumeRecords(function(key, uploadData) {
                    handler.moveInProgressToRemaining(null, uploadData.chunking.inProgress, uploadData.chunking.remaining);
                    var data = {
                        name: uploadData.name,
                        remaining: uploadData.chunking.remaining,
                        size: uploadData.size,
                        uuid: uploadData.uuid
                    };
                    if (uploadData.key) {
                        data.key = uploadData.key;
                    }
                    if (uploadData.customResumeData) {
                        data.customResumeData = uploadData.customResumeData;
                    }
                    resumableFilesData.push(data);
                });
                return resumableFilesData;
            },
            isAttemptingResume: function(id) {
                return handler._getFileState(id).attemptingResume;
            },
            isResumable: function(id) {
                return !!chunking && handler.isValid(id) && !handler._getFileState(id).notResumable;
            },
            moveInProgressToRemaining: function(id, optInProgress, optRemaining) {
                var fileState = handler._getFileState(id) || {}, chunkingState = fileState.chunking || {}, inProgress = optInProgress || chunkingState.inProgress, remaining = optRemaining || chunkingState.remaining;
                if (inProgress) {
                    log(qq.format("Moving these chunks from in-progress {}, to remaining.", JSON.stringify(inProgress)));
                    inProgress.reverse();
                    qq.each(inProgress, function(idx, chunkIdx) {
                        remaining.unshift(chunkIdx);
                    });
                    inProgress.length = 0;
                }
            },
            pause: function(id) {
                if (handler.isValid(id)) {
                    log(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.", id, getName(id)));
                    handler._getFileState(id).paused = true;
                    abort(id);
                    return true;
                }
            },
            reevaluateChunking: function(id) {
                if (chunking && handler.isValid(id)) {
                    var state = handler._getFileState(id), totalChunks, i;
                    delete state.chunking;
                    state.chunking = {};
                    totalChunks = handler._getTotalChunks(id);
                    if (totalChunks > 1 || chunking.mandatory) {
                        state.chunking.enabled = true;
                        state.chunking.parts = totalChunks;
                        state.chunking.remaining = [];
                        for (i = 0; i < totalChunks; i++) {
                            state.chunking.remaining.push(i);
                        }
                        handler._initTempState(id);
                    } else {
                        state.chunking.enabled = false;
                    }
                }
            },
            updateBlob: function(id, newBlob) {
                if (handler.isValid(id)) {
                    handler._getFileState(id).file = newBlob;
                }
            },
            _clearXhrs: function(id) {
                var tempState = handler._getFileState(id).temp;
                qq.each(tempState.ajaxRequesters, function(chunkId) {
                    delete tempState.ajaxRequesters[chunkId];
                });
                qq.each(tempState.xhrs, function(chunkId) {
                    delete tempState.xhrs[chunkId];
                });
            },
            _createXhr: function(id, optChunkIdx) {
                return handler._registerXhr(id, optChunkIdx, qq.createXhrInstance());
            },
            _getAjaxRequester: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.ajaxRequesters[chunkIdx];
            },
            _getChunkData: function(id, chunkIndex) {
                var chunkSize = getChunkSize(id), fileSize = getSize(id), fileOrBlob = handler.getFile(id), startBytes = chunkSize * chunkIndex, endBytes = startBytes + chunkSize >= fileSize ? fileSize : startBytes + chunkSize, totalChunks = handler._getTotalChunks(id), cachedChunks = this._getFileState(id).temp.cachedChunks, blob = cachedChunks[chunkIndex] || qq.sliceBlob(fileOrBlob, startBytes, endBytes);
                cachedChunks[chunkIndex] = blob;
                return {
                    part: chunkIndex,
                    start: startBytes,
                    end: endBytes,
                    count: totalChunks,
                    blob: blob,
                    size: endBytes - startBytes
                };
            },
            _getChunkDataForCallback: function(chunkData) {
                return {
                    partIndex: chunkData.part,
                    startByte: chunkData.start + 1,
                    endByte: chunkData.end,
                    totalParts: chunkData.count
                };
            },
            _getLocalStorageId: function(id) {
                var formatVersion = "5.0", name = getName(id), size = getSize(id), chunkSize = getChunkSize(id), endpoint = getEndpoint(id), customKeys = resume.customKeys(id), localStorageId = qq.format("qq{}resume{}-{}-{}-{}-{}", namespace, formatVersion, name, size, chunkSize, endpoint);
                customKeys.forEach(function(key) {
                    localStorageId += "-" + key;
                });
                return localStorageId;
            },
            _getMimeType: function(id) {
                return handler.getFile(id).type;
            },
            _getPersistableData: function(id) {
                return handler._getFileState(id).chunking;
            },
            _getTotalChunks: function(id) {
                if (chunking) {
                    var fileSize = getSize(id), chunkSize = getChunkSize(id);
                    return Math.ceil(fileSize / chunkSize);
                }
            },
            _getXhr: function(id, optChunkIdx) {
                var chunkIdx = optChunkIdx == null ? -1 : optChunkIdx;
                return handler._getFileState(id).temp.xhrs[chunkIdx];
            },
            _getXhrs: function(id) {
                return handler._getFileState(id).temp.xhrs;
            },
            _iterateResumeRecords: function(callback) {
                if (resumeEnabled) {
                    qq.each(localStorage, function(key, item) {
                        if (key.indexOf(qq.format("qq{}resume", namespace)) === 0) {
                            var uploadData = JSON.parse(item);
                            callback(key, uploadData);
                        }
                    });
                }
            },
            _initTempState: function(id) {
                handler._getFileState(id).temp = {
                    ajaxRequesters: {},
                    chunkProgress: {},
                    xhrs: {},
                    cachedChunks: {}
                };
            },
            _markNotResumable: function(id) {
                handler._getFileState(id).notResumable = true;
            },
            _maybeDeletePersistedChunkData: function(id) {
                var localStorageId;
                if (resumeEnabled && handler.isResumable(id)) {
                    localStorageId = handler._getLocalStorageId(id);
                    if (localStorageId && localStorage.getItem(localStorageId)) {
                        localStorage.removeItem(localStorageId);
                        return true;
                    }
                }
                return false;
            },
            _maybePrepareForResume: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && state.key === undefined) {
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = localStorage.getItem(localStorageId);
                    if (persistedData) {
                        persistedData = JSON.parse(persistedData);
                        if (getDataByUuid(persistedData.uuid)) {
                            handler._markNotResumable(id);
                        } else {
                            log(qq.format("Identified file with ID {} and name of {} as resumable.", id, getName(id)));
                            onUuidChanged(id, persistedData.uuid);
                            state.key = persistedData.key;
                            state.chunking = persistedData.chunking;
                            state.loaded = persistedData.loaded;
                            state.customResumeData = persistedData.customResumeData;
                            state.attemptingResume = true;
                            handler.moveInProgressToRemaining(id);
                        }
                    }
                }
            },
            _maybePersistChunkedState: function(id) {
                var state = handler._getFileState(id), localStorageId, persistedData;
                if (resumeEnabled && handler.isResumable(id)) {
                    var customResumeData = getCustomResumeData(id);
                    localStorageId = handler._getLocalStorageId(id);
                    persistedData = {
                        name: getName(id),
                        size: getSize(id),
                        uuid: getUuid(id),
                        key: state.key,
                        chunking: state.chunking,
                        loaded: state.loaded,
                        lastUpdated: Date.now()
                    };
                    if (customResumeData) {
                        persistedData.customResumeData = customResumeData;
                    }
                    try {
                        localStorage.setItem(localStorageId, JSON.stringify(persistedData));
                    } catch (error) {
                        log(qq.format("Unable to save resume data for '{}' due to error: '{}'.", id, error.toString()), "warn");
                    }
                }
            },
            _registerProgressHandler: function(id, chunkIdx, chunkSize) {
                var xhr = handler._getXhr(id, chunkIdx), name = getName(id), progressCalculator = {
                    simple: function(loaded, total) {
                        var fileSize = getSize(id);
                        if (loaded === total) {
                            onProgress(id, name, fileSize, fileSize);
                        } else {
                            onProgress(id, name, loaded >= fileSize ? fileSize - 1 : loaded, fileSize);
                        }
                    },
                    chunked: function(loaded, total) {
                        var chunkProgress = handler._getFileState(id).temp.chunkProgress, totalSuccessfullyLoadedForFile = handler._getFileState(id).loaded, loadedForRequest = loaded, totalForRequest = total, totalFileSize = getSize(id), estActualChunkLoaded = loadedForRequest - (totalForRequest - chunkSize), totalLoadedForFile = totalSuccessfullyLoadedForFile;
                        chunkProgress[chunkIdx] = estActualChunkLoaded;
                        qq.each(chunkProgress, function(chunkIdx, chunkLoaded) {
                            totalLoadedForFile += chunkLoaded;
                        });
                        onProgress(id, name, totalLoadedForFile, totalFileSize);
                    }
                };
                xhr.upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        var type = chunkSize == null ? "simple" : "chunked";
                        progressCalculator[type](e.loaded, e.total);
                    }
                };
            },
            _registerXhr: function(id, optChunkIdx, xhr, optAjaxRequester) {
                var xhrsId = optChunkIdx == null ? -1 : optChunkIdx, tempState = handler._getFileState(id).temp;
                tempState.xhrs = tempState.xhrs || {};
                tempState.ajaxRequesters = tempState.ajaxRequesters || {};
                tempState.xhrs[xhrsId] = xhr;
                if (optAjaxRequester) {
                    tempState.ajaxRequesters[xhrsId] = optAjaxRequester;
                }
                return xhr;
            },
            _removeExpiredChunkingRecords: function() {
                var expirationDays = resume.recordsExpireIn;
                handler._iterateResumeRecords(function(key, uploadData) {
                    var expirationDate = new Date(uploadData.lastUpdated);
                    expirationDate.setDate(expirationDate.getDate() + expirationDays);
                    if (expirationDate.getTime() <= Date.now()) {
                        log("Removing expired resume record with key " + key);
                        localStorage.removeItem(key);
                    }
                });
            },
            _shouldChunkThisFile: function(id) {
                var state = handler._getFileState(id);
                if (state) {
                    if (!state.chunking) {
                        handler.reevaluateChunking(id);
                    }
                    return state.chunking.enabled;
                }
            }
        });
    };
    qq.DeleteFileAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            method: "DELETE",
            uuidParamName: "qquuid",
            endpointStore: {},
            maxConnections: 3,
            customHeaders: function(id) {
                return {};
            },
            paramsStore: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            log: function(str, level) {},
            onDelete: function(id) {},
            onDeleteComplete: function(id, xhrOrXdr, isError) {}
        };
        qq.extend(options, o);
        function getMandatedParams() {
            if (options.method.toUpperCase() === "POST") {
                return {
                    _method: "DELETE"
                };
            }
            return {};
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "POST", "DELETE" ],
            method: options.method,
            endpointStore: options.endpointStore,
            paramsStore: options.paramsStore,
            mandatedParams: getMandatedParams(),
            maxConnections: options.maxConnections,
            customHeaders: function(id) {
                return options.customHeaders.get(id);
            },
            log: options.log,
            onSend: options.onDelete,
            onComplete: options.onDeleteComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            sendDelete: function(id, uuid, additionalMandatedParams) {
                var additionalOptions = additionalMandatedParams || {};
                options.log("Submitting delete file request for " + id);
                if (options.method === "DELETE") {
                    requester.initTransport(id).withPath(uuid).withParams(additionalOptions).send();
                } else {
                    additionalOptions[options.uuidParamName] = uuid;
                    requester.initTransport(id).withParams(additionalOptions).send();
                }
            }
        });
    };
    (function() {
        function detectSubsampling(img) {
            var iw = img.naturalWidth, ih = img.naturalHeight, canvas = document.createElement("canvas"), ctx;
            if (iw * ih > 1024 * 1024) {
                canvas.width = canvas.height = 1;
                ctx = canvas.getContext("2d");
                ctx.drawImage(img, -iw + 1, 0);
                return ctx.getImageData(0, 0, 1, 1).data[3] === 0;
            } else {
                return false;
            }
        }
        function detectVerticalSquash(img, iw, ih) {
            var canvas = document.createElement("canvas"), sy = 0, ey = ih, py = ih, ctx, data, alpha, ratio;
            canvas.width = 1;
            canvas.height = ih;
            ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            data = ctx.getImageData(0, 0, 1, ih).data;
            while (py > sy) {
                alpha = data[(py - 1) * 4 + 3];
                if (alpha === 0) {
                    ey = py;
                } else {
                    sy = py;
                }
                py = ey + sy >> 1;
            }
            ratio = py / ih;
            return ratio === 0 ? 1 : ratio;
        }
        function renderImageToDataURL(img, blob, options, doSquash) {
            var canvas = document.createElement("canvas"), mime = options.mime || "image/jpeg", promise = new qq.Promise();
            renderImageToCanvas(img, blob, canvas, options, doSquash).then(function() {
                promise.success(canvas.toDataURL(mime, options.quality || .8));
            });
            return promise;
        }
        function maybeCalculateDownsampledDimensions(spec) {
            var maxPixels = 5241e3;
            if (!qq.ios()) {
                throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");
            }
            if (spec.origHeight * spec.origWidth > maxPixels) {
                return {
                    newHeight: Math.round(Math.sqrt(maxPixels * (spec.origHeight / spec.origWidth))),
                    newWidth: Math.round(Math.sqrt(maxPixels * (spec.origWidth / spec.origHeight)))
                };
            }
        }
        function renderImageToCanvas(img, blob, canvas, options, doSquash) {
            var iw = img.naturalWidth, ih = img.naturalHeight, width = options.width, height = options.height, ctx = canvas.getContext("2d"), promise = new qq.Promise(), modifiedDimensions;
            ctx.save();
            if (options.resize) {
                return renderImageToCanvasWithCustomResizer({
                    blob: blob,
                    canvas: canvas,
                    image: img,
                    imageHeight: ih,
                    imageWidth: iw,
                    orientation: options.orientation,
                    resize: options.resize,
                    targetHeight: height,
                    targetWidth: width
                });
            }
            if (!qq.supportedFeatures.unlimitedScaledImageSize) {
                modifiedDimensions = maybeCalculateDownsampledDimensions({
                    origWidth: width,
                    origHeight: height
                });
                if (modifiedDimensions) {
                    qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h", width, height, modifiedDimensions.newWidth, modifiedDimensions.newHeight), "warn");
                    width = modifiedDimensions.newWidth;
                    height = modifiedDimensions.newHeight;
                }
            }
            transformCoordinate(canvas, width, height, options.orientation);
            if (qq.ios()) {
                (function() {
                    if (detectSubsampling(img)) {
                        iw /= 2;
                        ih /= 2;
                    }
                    var d = 1024, tmpCanvas = document.createElement("canvas"), vertSquashRatio = doSquash ? detectVerticalSquash(img, iw, ih) : 1, dw = Math.ceil(d * width / iw), dh = Math.ceil(d * height / ih / vertSquashRatio), sy = 0, dy = 0, tmpCtx, sx, dx;
                    tmpCanvas.width = tmpCanvas.height = d;
                    tmpCtx = tmpCanvas.getContext("2d");
                    while (sy < ih) {
                        sx = 0;
                        dx = 0;
                        while (sx < iw) {
                            tmpCtx.clearRect(0, 0, d, d);
                            tmpCtx.drawImage(img, -sx, -sy);
                            ctx.drawImage(tmpCanvas, 0, 0, d, d, dx, dy, dw, dh);
                            sx += d;
                            dx += dw;
                        }
                        sy += d;
                        dy += dh;
                    }
                    ctx.restore();
                    tmpCanvas = tmpCtx = null;
                })();
            } else {
                ctx.drawImage(img, 0, 0, width, height);
            }
            canvas.qqImageRendered && canvas.qqImageRendered();
            promise.success();
            return promise;
        }
        function renderImageToCanvasWithCustomResizer(resizeInfo) {
            var blob = resizeInfo.blob, image = resizeInfo.image, imageHeight = resizeInfo.imageHeight, imageWidth = resizeInfo.imageWidth, orientation = resizeInfo.orientation, promise = new qq.Promise(), resize = resizeInfo.resize, sourceCanvas = document.createElement("canvas"), sourceCanvasContext = sourceCanvas.getContext("2d"), targetCanvas = resizeInfo.canvas, targetHeight = resizeInfo.targetHeight, targetWidth = resizeInfo.targetWidth;
            transformCoordinate(sourceCanvas, imageWidth, imageHeight, orientation);
            targetCanvas.height = targetHeight;
            targetCanvas.width = targetWidth;
            sourceCanvasContext.drawImage(image, 0, 0);
            resize({
                blob: blob,
                height: targetHeight,
                image: image,
                sourceCanvas: sourceCanvas,
                targetCanvas: targetCanvas,
                width: targetWidth
            }).then(function success() {
                targetCanvas.qqImageRendered && targetCanvas.qqImageRendered();
                promise.success();
            }, promise.failure);
            return promise;
        }
        function transformCoordinate(canvas, width, height, orientation) {
            switch (orientation) {
              case 5:
              case 6:
              case 7:
              case 8:
                canvas.width = height;
                canvas.height = width;
                break;

              default:
                canvas.width = width;
                canvas.height = height;
            }
            var ctx = canvas.getContext("2d");
            switch (orientation) {
              case 2:
                ctx.translate(width, 0);
                ctx.scale(-1, 1);
                break;

              case 3:
                ctx.translate(width, height);
                ctx.rotate(Math.PI);
                break;

              case 4:
                ctx.translate(0, height);
                ctx.scale(1, -1);
                break;

              case 5:
                ctx.rotate(.5 * Math.PI);
                ctx.scale(1, -1);
                break;

              case 6:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(0, -height);
                break;

              case 7:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(width, -height);
                ctx.scale(-1, 1);
                break;

              case 8:
                ctx.rotate(-.5 * Math.PI);
                ctx.translate(-width, 0);
                break;

              default:
                break;
            }
        }
        function MegaPixImage(srcImage, errorCallback) {
            var self = this;
            if (window.Blob && srcImage instanceof Blob) {
                (function() {
                    var img = new Image(), URL = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                    if (!URL) {
                        throw Error("No createObjectURL function found to create blob url");
                    }
                    img.src = URL.createObjectURL(srcImage);
                    self.blob = srcImage;
                    srcImage = img;
                })();
            }
            if (!srcImage.naturalWidth && !srcImage.naturalHeight) {
                srcImage.onload = function() {
                    var listeners = self.imageLoadListeners;
                    if (listeners) {
                        self.imageLoadListeners = null;
                        setTimeout(function() {
                            for (var i = 0, len = listeners.length; i < len; i++) {
                                listeners[i]();
                            }
                        }, 0);
                    }
                };
                srcImage.onerror = errorCallback;
                this.imageLoadListeners = [];
            }
            this.srcImage = srcImage;
        }
        MegaPixImage.prototype.render = function(target, options) {
            options = options || {};
            var self = this, imgWidth = this.srcImage.naturalWidth, imgHeight = this.srcImage.naturalHeight, width = options.width, height = options.height, maxWidth = options.maxWidth, maxHeight = options.maxHeight, doSquash = !this.blob || this.blob.type === "image/jpeg", tagName = target.tagName.toLowerCase(), opt;
            if (this.imageLoadListeners) {
                this.imageLoadListeners.push(function() {
                    self.render(target, options);
                });
                return;
            }
            if (width && !height) {
                height = imgHeight * width / imgWidth << 0;
            } else if (height && !width) {
                width = imgWidth * height / imgHeight << 0;
            } else {
                width = imgWidth;
                height = imgHeight;
            }
            if (maxWidth && width > maxWidth) {
                width = maxWidth;
                height = imgHeight * width / imgWidth << 0;
            }
            if (maxHeight && height > maxHeight) {
                height = maxHeight;
                width = imgWidth * height / imgHeight << 0;
            }
            opt = {
                width: width,
                height: height
            }, qq.each(options, function(optionsKey, optionsValue) {
                opt[optionsKey] = optionsValue;
            });
            if (tagName === "img") {
                (function() {
                    var oldTargetSrc = target.src;
                    renderImageToDataURL(self.srcImage, self.blob, opt, doSquash).then(function(dataUri) {
                        target.src = dataUri;
                        oldTargetSrc === target.src && target.onload();
                    });
                })();
            } else if (tagName === "canvas") {
                renderImageToCanvas(this.srcImage, this.blob, target, opt, doSquash);
            }
            if (typeof this.onrender === "function") {
                this.onrender(target);
            }
        };
        qq.MegaPixImage = MegaPixImage;
    })();
    qq.ImageGenerator = function(log) {
        "use strict";
        function isImg(el) {
            return el.tagName.toLowerCase() === "img";
        }
        function isCanvas(el) {
            return el.tagName.toLowerCase() === "canvas";
        }
        function isImgCorsSupported() {
            return new Image().crossOrigin !== undefined;
        }
        function isCanvasSupported() {
            var canvas = document.createElement("canvas");
            return canvas.getContext && canvas.getContext("2d");
        }
        function determineMimeOfFileName(nameWithPath) {
            var pathSegments = nameWithPath.split("/"), name = pathSegments[pathSegments.length - 1].split("?")[0], extension = qq.getExtension(name);
            extension = extension && extension.toLowerCase();
            switch (extension) {
              case "jpeg":
              case "jpg":
                return "image/jpeg";

              case "png":
                return "image/png";

              case "bmp":
                return "image/bmp";

              case "gif":
                return "image/gif";

              case "tiff":
              case "tif":
                return "image/tiff";
            }
        }
        function isCrossOrigin(url) {
            var targetAnchor = document.createElement("a"), targetProtocol, targetHostname, targetPort;
            targetAnchor.href = url;
            targetProtocol = targetAnchor.protocol;
            targetPort = targetAnchor.port;
            targetHostname = targetAnchor.hostname;
            if (targetProtocol.toLowerCase() !== window.location.protocol.toLowerCase()) {
                return true;
            }
            if (targetHostname.toLowerCase() !== window.location.hostname.toLowerCase()) {
                return true;
            }
            if (targetPort !== window.location.port && !qq.ie()) {
                return true;
            }
            return false;
        }
        function registerImgLoadListeners(img, promise) {
            img.onload = function() {
                img.onload = null;
                img.onerror = null;
                promise.success(img);
            };
            img.onerror = function() {
                img.onload = null;
                img.onerror = null;
                log("Problem drawing thumbnail!", "error");
                promise.failure(img, "Problem drawing thumbnail!");
            };
        }
        function registerCanvasDrawImageListener(canvas, promise) {
            canvas.qqImageRendered = function() {
                promise.success(canvas);
            };
        }
        function registerThumbnailRenderedListener(imgOrCanvas, promise) {
            var registered = isImg(imgOrCanvas) || isCanvas(imgOrCanvas);
            if (isImg(imgOrCanvas)) {
                registerImgLoadListeners(imgOrCanvas, promise);
            } else if (isCanvas(imgOrCanvas)) {
                registerCanvasDrawImageListener(imgOrCanvas, promise);
            } else {
                promise.failure(imgOrCanvas);
                log(qq.format("Element container of type {} is not supported!", imgOrCanvas.tagName), "error");
            }
            return registered;
        }
        function draw(fileOrBlob, container, options) {
            var drawPreview = new qq.Promise(), identifier = new qq.Identify(fileOrBlob, log), maxSize = options.maxSize, orient = options.orient == null ? true : options.orient, megapixErrorHandler = function() {
                container.onerror = null;
                container.onload = null;
                log("Could not render preview, file may be too large!", "error");
                drawPreview.failure(container, "Browser cannot render image!");
            };
            identifier.isPreviewable().then(function(mime) {
                var dummyExif = {
                    parse: function() {
                        return new qq.Promise().success();
                    }
                }, exif = orient ? new qq.Exif(fileOrBlob, log) : dummyExif, mpImg = new qq.MegaPixImage(fileOrBlob, megapixErrorHandler);
                if (registerThumbnailRenderedListener(container, drawPreview)) {
                    exif.parse().then(function(exif) {
                        var orientation = exif && exif.Orientation;
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            orientation: orientation,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    }, function(failureMsg) {
                        log(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.", failureMsg));
                        mpImg.render(container, {
                            maxWidth: maxSize,
                            maxHeight: maxSize,
                            mime: mime,
                            resize: options.customResizeFunction
                        });
                    });
                }
            }, function() {
                log("Not previewable");
                drawPreview.failure(container, "Not previewable");
            });
            return drawPreview;
        }
        function drawOnCanvasOrImgFromUrl(url, canvasOrImg, draw, maxSize, customResizeFunction) {
            var tempImg = new Image(), tempImgRender = new qq.Promise();
            registerThumbnailRenderedListener(tempImg, tempImgRender);
            if (isCrossOrigin(url)) {
                tempImg.crossOrigin = "anonymous";
            }
            tempImg.src = url;
            tempImgRender.then(function rendered() {
                registerThumbnailRenderedListener(canvasOrImg, draw);
                var mpImg = new qq.MegaPixImage(tempImg);
                mpImg.render(canvasOrImg, {
                    maxWidth: maxSize,
                    maxHeight: maxSize,
                    mime: determineMimeOfFileName(url),
                    resize: customResizeFunction
                });
            }, draw.failure);
        }
        function drawOnImgFromUrlWithCssScaling(url, img, draw, maxSize) {
            registerThumbnailRenderedListener(img, draw);
            qq(img).css({
                maxWidth: maxSize + "px",
                maxHeight: maxSize + "px"
            });
            img.src = url;
        }
        function drawFromUrl(url, container, options) {
            var draw = new qq.Promise(), scale = options.scale, maxSize = scale ? options.maxSize : null;
            if (scale && isImg(container)) {
                if (isCanvasSupported()) {
                    if (isCrossOrigin(url) && !isImgCorsSupported()) {
                        drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                    } else {
                        drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
                    }
                } else {
                    drawOnImgFromUrlWithCssScaling(url, container, draw, maxSize);
                }
            } else if (isCanvas(container)) {
                drawOnCanvasOrImgFromUrl(url, container, draw, maxSize);
            } else if (registerThumbnailRenderedListener(container, draw)) {
                container.src = url;
            }
            return draw;
        }
        qq.extend(this, {
            generate: function(fileBlobOrUrl, container, options) {
                if (qq.isString(fileBlobOrUrl)) {
                    log("Attempting to update thumbnail based on server response.");
                    return drawFromUrl(fileBlobOrUrl, container, options || {});
                } else {
                    log("Attempting to draw client-side image preview.");
                    return draw(fileBlobOrUrl, container, options || {});
                }
            }
        });
        this._testing = {};
        this._testing.isImg = isImg;
        this._testing.isCanvas = isCanvas;
        this._testing.isCrossOrigin = isCrossOrigin;
        this._testing.determineMimeOfFileName = determineMimeOfFileName;
    };
    qq.Exif = function(fileOrBlob, log) {
        "use strict";
        var TAG_IDS = [ 274 ], TAG_INFO = {
            274: {
                name: "Orientation",
                bytes: 2
            }
        };
        function parseLittleEndian(hex) {
            var result = 0, pow = 0;
            while (hex.length > 0) {
                result += parseInt(hex.substring(0, 2), 16) * Math.pow(2, pow);
                hex = hex.substring(2, hex.length);
                pow += 8;
            }
            return result;
        }
        function seekToApp1(offset, promise) {
            var theOffset = offset, thePromise = promise;
            if (theOffset === undefined) {
                theOffset = 2;
                thePromise = new qq.Promise();
            }
            qq.readBlobToHex(fileOrBlob, theOffset, 4).then(function(hex) {
                var match = /^ffe([0-9])/.exec(hex), segmentLength;
                if (match) {
                    if (match[1] !== "1") {
                        segmentLength = parseInt(hex.slice(4, 8), 16);
                        seekToApp1(theOffset + segmentLength + 2, thePromise);
                    } else {
                        thePromise.success(theOffset);
                    }
                } else {
                    thePromise.failure("No EXIF header to be found!");
                }
            });
            return thePromise;
        }
        function getApp1Offset() {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, 0, 6).then(function(hex) {
                if (hex.indexOf("ffd8") !== 0) {
                    promise.failure("Not a valid JPEG!");
                } else {
                    seekToApp1().then(function(offset) {
                        promise.success(offset);
                    }, function(error) {
                        promise.failure(error);
                    });
                }
            });
            return promise;
        }
        function isLittleEndian(app1Start) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 10, 2).then(function(hex) {
                promise.success(hex === "4949");
            });
            return promise;
        }
        function getDirEntryCount(app1Start, littleEndian) {
            var promise = new qq.Promise();
            qq.readBlobToHex(fileOrBlob, app1Start + 18, 2).then(function(hex) {
                if (littleEndian) {
                    return promise.success(parseLittleEndian(hex));
                } else {
                    promise.success(parseInt(hex, 16));
                }
            });
            return promise;
        }
        function getIfd(app1Start, dirEntries) {
            var offset = app1Start + 20, bytes = dirEntries * 12;
            return qq.readBlobToHex(fileOrBlob, offset, bytes);
        }
        function getDirEntries(ifdHex) {
            var entries = [], offset = 0;
            while (offset + 24 <= ifdHex.length) {
                entries.push(ifdHex.slice(offset, offset + 24));
                offset += 24;
            }
            return entries;
        }
        function getTagValues(littleEndian, dirEntries) {
            var TAG_VAL_OFFSET = 16, tagsToFind = qq.extend([], TAG_IDS), vals = {};
            qq.each(dirEntries, function(idx, entry) {
                var idHex = entry.slice(0, 4), id = littleEndian ? parseLittleEndian(idHex) : parseInt(idHex, 16), tagsToFindIdx = tagsToFind.indexOf(id), tagValHex, tagName, tagValLength;
                if (tagsToFindIdx >= 0) {
                    tagName = TAG_INFO[id].name;
                    tagValLength = TAG_INFO[id].bytes;
                    tagValHex = entry.slice(TAG_VAL_OFFSET, TAG_VAL_OFFSET + tagValLength * 2);
                    vals[tagName] = littleEndian ? parseLittleEndian(tagValHex) : parseInt(tagValHex, 16);
                    tagsToFind.splice(tagsToFindIdx, 1);
                }
                if (tagsToFind.length === 0) {
                    return false;
                }
            });
            return vals;
        }
        qq.extend(this, {
            parse: function() {
                var parser = new qq.Promise(), onParseFailure = function(message) {
                    log(qq.format("EXIF header parse failed: '{}' ", message));
                    parser.failure(message);
                };
                getApp1Offset().then(function(app1Offset) {
                    log(qq.format("Moving forward with EXIF header parsing for '{}'", fileOrBlob.name === undefined ? "blob" : fileOrBlob.name));
                    isLittleEndian(app1Offset).then(function(littleEndian) {
                        log(qq.format("EXIF Byte order is {} endian", littleEndian ? "little" : "big"));
                        getDirEntryCount(app1Offset, littleEndian).then(function(dirEntryCount) {
                            log(qq.format("Found {} APP1 directory entries", dirEntryCount));
                            getIfd(app1Offset, dirEntryCount).then(function(ifdHex) {
                                var dirEntries = getDirEntries(ifdHex), tagValues = getTagValues(littleEndian, dirEntries);
                                log("Successfully parsed some EXIF tags");
                                parser.success(tagValues);
                            }, onParseFailure);
                        }, onParseFailure);
                    }, onParseFailure);
                }, onParseFailure);
                return parser;
            }
        });
        this._testing = {};
        this._testing.parseLittleEndian = parseLittleEndian;
    };
    qq.Identify = function(fileOrBlob, log) {
        "use strict";
        function isIdentifiable(magicBytes, questionableBytes) {
            var identifiable = false, magicBytesEntries = [].concat(magicBytes);
            qq.each(magicBytesEntries, function(idx, magicBytesArrayEntry) {
                if (questionableBytes.indexOf(magicBytesArrayEntry) === 0) {
                    identifiable = true;
                    return false;
                }
            });
            return identifiable;
        }
        qq.extend(this, {
            isPreviewable: function() {
                var self = this, identifier = new qq.Promise(), previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                log(qq.format("Attempting to determine if {} can be rendered in this browser", name));
                log("First pass: check type attribute of blob object.");
                if (this.isPreviewableSync()) {
                    log("Second pass: check for magic bytes in file header.");
                    qq.readBlobToHex(fileOrBlob, 0, 4).then(function(hex) {
                        qq.each(self.PREVIEWABLE_MIME_TYPES, function(mime, bytes) {
                            if (isIdentifiable(bytes, hex)) {
                                if (mime !== "image/tiff" || qq.supportedFeatures.tiffPreviews) {
                                    previewable = true;
                                    identifier.success(mime);
                                }
                                return false;
                            }
                        });
                        log(qq.format("'{}' is {} able to be rendered in this browser", name, previewable ? "" : "NOT"));
                        if (!previewable) {
                            identifier.failure();
                        }
                    }, function() {
                        log("Error reading file w/ name '" + name + "'.  Not able to be rendered in this browser.");
                        identifier.failure();
                    });
                } else {
                    identifier.failure();
                }
                return identifier;
            },
            isPreviewableSync: function() {
                var fileMime = fileOrBlob.type, isRecognizedImage = qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES), fileMime) >= 0, previewable = false, name = fileOrBlob.name === undefined ? "blob" : fileOrBlob.name;
                if (isRecognizedImage) {
                    if (fileMime === "image/tiff") {
                        previewable = qq.supportedFeatures.tiffPreviews;
                    } else {
                        previewable = true;
                    }
                }
                !previewable && log(name + " is not previewable in this browser per the blob's type attr");
                return previewable;
            }
        });
    };
    qq.Identify.prototype.PREVIEWABLE_MIME_TYPES = {
        "image/jpeg": "ffd8ff",
        "image/gif": "474946",
        "image/png": "89504e",
        "image/bmp": "424d",
        "image/tiff": [ "49492a00", "4d4d002a" ]
    };
    qq.ImageValidation = function(blob, log) {
        "use strict";
        function hasNonZeroLimits(limits) {
            var atLeastOne = false;
            qq.each(limits, function(limit, value) {
                if (value > 0) {
                    atLeastOne = true;
                    return false;
                }
            });
            return atLeastOne;
        }
        function getWidthHeight() {
            var sizeDetermination = new qq.Promise();
            new qq.Identify(blob, log).isPreviewable().then(function() {
                var image = new Image(), url = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null;
                if (url) {
                    image.onerror = function() {
                        log("Cannot determine dimensions for image.  May be too large.", "error");
                        sizeDetermination.failure();
                    };
                    image.onload = function() {
                        sizeDetermination.success({
                            width: this.width,
                            height: this.height
                        });
                    };
                    image.src = url.createObjectURL(blob);
                } else {
                    log("No createObjectURL function available to generate image URL!", "error");
                    sizeDetermination.failure();
                }
            }, sizeDetermination.failure);
            return sizeDetermination;
        }
        function getFailingLimit(limits, dimensions) {
            var failingLimit;
            qq.each(limits, function(limitName, limitValue) {
                if (limitValue > 0) {
                    var limitMatcher = /(max|min)(Width|Height)/.exec(limitName), dimensionPropName = limitMatcher[2].charAt(0).toLowerCase() + limitMatcher[2].slice(1), actualValue = dimensions[dimensionPropName];
                    switch (limitMatcher[1]) {
                      case "min":
                        if (actualValue < limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;

                      case "max":
                        if (actualValue > limitValue) {
                            failingLimit = limitName;
                            return false;
                        }
                        break;
                    }
                }
            });
            return failingLimit;
        }
        this.validate = function(limits) {
            var validationEffort = new qq.Promise();
            log("Attempting to validate image.");
            if (hasNonZeroLimits(limits)) {
                getWidthHeight().then(function(dimensions) {
                    var failingLimit = getFailingLimit(limits, dimensions);
                    if (failingLimit) {
                        validationEffort.failure(failingLimit);
                    } else {
                        validationEffort.success();
                    }
                }, validationEffort.success);
            } else {
                validationEffort.success();
            }
            return validationEffort;
        };
    };
    qq.Session = function(spec) {
        "use strict";
        var options = {
            endpoint: null,
            params: {},
            customHeaders: {},
            cors: {},
            addFileRecord: function(sessionData) {},
            log: function(message, level) {}
        };
        qq.extend(options, spec, true);
        function isJsonResponseValid(response) {
            if (qq.isArray(response)) {
                return true;
            }
            options.log("Session response is not an array.", "error");
        }
        function handleFileItems(fileItems, success, xhrOrXdr, promise) {
            var someItemsIgnored = false;
            success = success && isJsonResponseValid(fileItems);
            if (success) {
                qq.each(fileItems, function(idx, fileItem) {
                    if (fileItem.uuid == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid UUID - ignoring.", idx), "error");
                    } else if (fileItem.name == null) {
                        someItemsIgnored = true;
                        options.log(qq.format("Session response item {} did not include a valid name - ignoring.", idx), "error");
                    } else {
                        try {
                            options.addFileRecord(fileItem);
                            return true;
                        } catch (err) {
                            someItemsIgnored = true;
                            options.log(err.message, "error");
                        }
                    }
                    return false;
                });
            }
            promise[success && !someItemsIgnored ? "success" : "failure"](fileItems, xhrOrXdr);
        }
        this.refresh = function() {
            var refreshEffort = new qq.Promise(), refreshCompleteCallback = function(response, success, xhrOrXdr) {
                handleFileItems(response, success, xhrOrXdr, refreshEffort);
            }, requesterOptions = qq.extend({}, options), requester = new qq.SessionAjaxRequester(qq.extend(requesterOptions, {
                onComplete: refreshCompleteCallback
            }));
            requester.queryServer();
            return refreshEffort;
        };
    };
    qq.SessionAjaxRequester = function(spec) {
        "use strict";
        var requester, options = {
            endpoint: null,
            customHeaders: {},
            params: {},
            cors: {
                expected: false,
                sendCredentials: false
            },
            onComplete: function(response, success, xhrOrXdr) {},
            log: function(str, level) {}
        };
        qq.extend(options, spec);
        function onComplete(id, xhrOrXdr, isError) {
            var response = null;
            if (xhrOrXdr.responseText != null) {
                try {
                    response = qq.parseJson(xhrOrXdr.responseText);
                } catch (err) {
                    options.log("Problem parsing session response: " + err.message, "error");
                    isError = true;
                }
            }
            options.onComplete(response, !isError, xhrOrXdr);
        }
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            validMethods: [ "GET" ],
            method: "GET",
            endpointStore: {
                get: function() {
                    return options.endpoint;
                }
            },
            customHeaders: options.customHeaders,
            log: options.log,
            onComplete: onComplete,
            cors: options.cors
        }));
        qq.extend(this, {
            queryServer: function() {
                var params = qq.extend({}, options.params);
                options.log("Session query request.");
                requester.initTransport("sessionRefresh").withParams(params).withCacheBuster().send();
            }
        });
    };
    qq.Scaler = function(spec, log) {
        "use strict";
        var self = this, customResizeFunction = spec.customResizer, includeOriginal = spec.sendOriginal, orient = spec.orient, defaultType = spec.defaultType, defaultQuality = spec.defaultQuality / 100, failedToScaleText = spec.failureText, includeExif = spec.includeExif, sizes = this._getSortedSizes(spec.sizes);
        qq.extend(this, {
            enabled: qq.supportedFeatures.scaling && sizes.length > 0,
            getFileRecords: function(originalFileUuid, originalFileName, originalBlobOrBlobData) {
                var self = this, records = [], originalBlob = originalBlobOrBlobData.blob ? originalBlobOrBlobData.blob : originalBlobOrBlobData, identifier = new qq.Identify(originalBlob, log);
                if (identifier.isPreviewableSync()) {
                    qq.each(sizes, function(idx, sizeRecord) {
                        var outputType = self._determineOutputType({
                            defaultType: defaultType,
                            requestedType: sizeRecord.type,
                            refType: originalBlob.type
                        });
                        records.push({
                            uuid: qq.getUniqueId(),
                            name: self._getName(originalFileName, {
                                name: sizeRecord.name,
                                type: outputType,
                                refType: originalBlob.type
                            }),
                            blob: new qq.BlobProxy(originalBlob, qq.bind(self._generateScaledImage, self, {
                                customResizeFunction: customResizeFunction,
                                maxSize: sizeRecord.maxSize,
                                orient: orient,
                                type: outputType,
                                quality: defaultQuality,
                                failedText: failedToScaleText,
                                includeExif: includeExif,
                                log: log
                            }))
                        });
                    });
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: includeOriginal ? originalBlob : null
                    });
                } else {
                    records.push({
                        uuid: originalFileUuid,
                        name: originalFileName,
                        size: originalBlob.size,
                        blob: originalBlob
                    });
                }
                return records;
            },
            handleNewFile: function(file, name, uuid, size, fileList, batchId, uuidParamName, api) {
                var self = this, buttonId = file.qqButtonId || file.blob && file.blob.qqButtonId, scaledIds = [], originalId = null, addFileToHandler = api.addFileToHandler, uploadData = api.uploadData, paramsStore = api.paramsStore, proxyGroupId = qq.getUniqueId();
                qq.each(self.getFileRecords(uuid, name, file), function(idx, record) {
                    var blobSize = record.size, id;
                    if (record.blob instanceof qq.BlobProxy) {
                        blobSize = -1;
                    }
                    id = uploadData.addFile({
                        uuid: record.uuid,
                        name: record.name,
                        size: blobSize,
                        batchId: batchId,
                        proxyGroupId: proxyGroupId
                    });
                    if (record.blob instanceof qq.BlobProxy) {
                        scaledIds.push(id);
                    } else {
                        originalId = id;
                    }
                    if (record.blob) {
                        addFileToHandler(id, record.blob);
                        fileList.push({
                            id: id,
                            file: record.blob
                        });
                    } else {
                        uploadData.setStatus(id, qq.status.REJECTED);
                    }
                });
                if (originalId !== null) {
                    qq.each(scaledIds, function(idx, scaledId) {
                        var params = {
                            qqparentuuid: uploadData.retrieve({
                                id: originalId
                            }).uuid,
                            qqparentsize: uploadData.retrieve({
                                id: originalId
                            }).size
                        };
                        params[uuidParamName] = uploadData.retrieve({
                            id: scaledId
                        }).uuid;
                        uploadData.setParentId(scaledId, originalId);
                        paramsStore.addReadOnly(scaledId, params);
                    });
                    if (scaledIds.length) {
                        (function() {
                            var param = {};
                            param[uuidParamName] = uploadData.retrieve({
                                id: originalId
                            }).uuid;
                            paramsStore.addReadOnly(originalId, param);
                        })();
                    }
                }
            }
        });
    };
    qq.extend(qq.Scaler.prototype, {
        scaleImage: function(id, specs, api) {
            "use strict";
            if (!qq.supportedFeatures.scaling) {
                throw new qq.Error("Scaling is not supported in this browser!");
            }
            var scalingEffort = new qq.Promise(), log = api.log, file = api.getFile(id), uploadData = api.uploadData.retrieve({
                id: id
            }), name = uploadData && uploadData.name, uuid = uploadData && uploadData.uuid, scalingOptions = {
                customResizer: specs.customResizer,
                sendOriginal: false,
                orient: specs.orient,
                defaultType: specs.type || null,
                defaultQuality: specs.quality,
                failedToScaleText: "Unable to scale",
                sizes: [ {
                    name: "",
                    maxSize: specs.maxSize
                } ]
            }, scaler = new qq.Scaler(scalingOptions, log);
            if (!qq.Scaler || !qq.supportedFeatures.imagePreviews || !file) {
                scalingEffort.failure();
                log("Could not generate requested scaled image for " + id + ".  " + "Scaling is either not possible in this browser, or the file could not be located.", "error");
            } else {
                qq.bind(function() {
                    var record = scaler.getFileRecords(uuid, name, file)[0];
                    if (record && record.blob instanceof qq.BlobProxy) {
                        record.blob.create().then(scalingEffort.success, scalingEffort.failure);
                    } else {
                        log(id + " is not a scalable image!", "error");
                        scalingEffort.failure();
                    }
                }, this)();
            }
            return scalingEffort;
        },
        _determineOutputType: function(spec) {
            "use strict";
            var requestedType = spec.requestedType, defaultType = spec.defaultType, referenceType = spec.refType;
            if (!defaultType && !requestedType) {
                if (referenceType !== "image/jpeg") {
                    return "image/png";
                }
                return referenceType;
            }
            if (!requestedType) {
                return defaultType;
            }
            if (qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES), requestedType) >= 0) {
                if (requestedType === "image/tiff") {
                    return qq.supportedFeatures.tiffPreviews ? requestedType : defaultType;
                }
                return requestedType;
            }
            return defaultType;
        },
        _getName: function(originalName, scaledVersionProperties) {
            "use strict";
            var startOfExt = originalName.lastIndexOf("."), versionType = scaledVersionProperties.type || "image/png", referenceType = scaledVersionProperties.refType, scaledName = "", scaledExt = qq.getExtension(originalName), nameAppendage = "";
            if (scaledVersionProperties.name && scaledVersionProperties.name.trim().length) {
                nameAppendage = " (" + scaledVersionProperties.name + ")";
            }
            if (startOfExt >= 0) {
                scaledName = originalName.substr(0, startOfExt);
                if (referenceType !== versionType) {
                    scaledExt = versionType.split("/")[1];
                }
                scaledName += nameAppendage + "." + scaledExt;
            } else {
                scaledName = originalName + nameAppendage;
            }
            return scaledName;
        },
        _getSortedSizes: function(sizes) {
            "use strict";
            sizes = qq.extend([], sizes);
            return sizes.sort(function(a, b) {
                if (a.maxSize > b.maxSize) {
                    return 1;
                }
                if (a.maxSize < b.maxSize) {
                    return -1;
                }
                return 0;
            });
        },
        _generateScaledImage: function(spec, sourceFile) {
            "use strict";
            var self = this, customResizeFunction = spec.customResizeFunction, log = spec.log, maxSize = spec.maxSize, orient = spec.orient, type = spec.type, quality = spec.quality, failedText = spec.failedText, includeExif = spec.includeExif && sourceFile.type === "image/jpeg" && type === "image/jpeg", scalingEffort = new qq.Promise(), imageGenerator = new qq.ImageGenerator(log), canvas = document.createElement("canvas");
            log("Attempting to generate scaled version for " + sourceFile.name);
            imageGenerator.generate(sourceFile, canvas, {
                maxSize: maxSize,
                orient: orient,
                customResizeFunction: customResizeFunction
            }).then(function() {
                var scaledImageDataUri = canvas.toDataURL(type, quality), signalSuccess = function() {
                    log("Success generating scaled version for " + sourceFile.name);
                    var blob = qq.dataUriToBlob(scaledImageDataUri);
                    scalingEffort.success(blob);
                };
                if (includeExif) {
                    self._insertExifHeader(sourceFile, scaledImageDataUri, log).then(function(scaledImageDataUriWithExif) {
                        scaledImageDataUri = scaledImageDataUriWithExif;
                        signalSuccess();
                    }, function() {
                        log("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.", "error");
                        signalSuccess();
                    });
                } else {
                    signalSuccess();
                }
            }, function() {
                log("Failed attempt to generate scaled version for " + sourceFile.name, "error");
                scalingEffort.failure(failedText);
            });
            return scalingEffort;
        },
        _insertExifHeader: function(originalImage, scaledImageDataUri, log) {
            "use strict";
            var reader = new FileReader(), insertionEffort = new qq.Promise(), originalImageDataUri = "";
            reader.onload = function() {
                originalImageDataUri = reader.result;
                insertionEffort.success(qq.ExifRestorer.restore(originalImageDataUri, scaledImageDataUri));
            };
            reader.onerror = function() {
                log("Problem reading " + originalImage.name + " during attempt to transfer EXIF data to scaled version.", "error");
                insertionEffort.failure();
            };
            reader.readAsDataURL(originalImage);
            return insertionEffort;
        },
        _dataUriToBlob: function(dataUri) {
            "use strict";
            var byteString, mimeString, arrayBuffer, intArray;
            if (dataUri.split(",")[0].indexOf("base64") >= 0) {
                byteString = atob(dataUri.split(",")[1]);
            } else {
                byteString = decodeURI(dataUri.split(",")[1]);
            }
            mimeString = dataUri.split(",")[0].split(":")[1].split(";")[0];
            arrayBuffer = new ArrayBuffer(byteString.length);
            intArray = new Uint8Array(arrayBuffer);
            qq.each(byteString, function(idx, character) {
                intArray[idx] = character.charCodeAt(0);
            });
            return this._createBlob(arrayBuffer, mimeString);
        },
        _createBlob: function(data, mime) {
            "use strict";
            var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, blobBuilder = BlobBuilder && new BlobBuilder();
            if (blobBuilder) {
                blobBuilder.append(data);
                return blobBuilder.getBlob(mime);
            } else {
                return new Blob([ data ], {
                    type: mime
                });
            }
        }
    });
    qq.ExifRestorer = function() {
        var ExifRestorer = {};
        ExifRestorer.KEY_STR = "ABCDEFGHIJKLMNOP" + "QRSTUVWXYZabcdef" + "ghijklmnopqrstuv" + "wxyz0123456789+/" + "=";
        ExifRestorer.encode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0;
            do {
                chr1 = input[i++];
                chr2 = input[i++];
                chr3 = input[i++];
                enc1 = chr1 >> 2;
                enc2 = (chr1 & 3) << 4 | chr2 >> 4;
                enc3 = (chr2 & 15) << 2 | chr3 >> 6;
                enc4 = chr3 & 63;
                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }
                output = output + this.KEY_STR.charAt(enc1) + this.KEY_STR.charAt(enc2) + this.KEY_STR.charAt(enc3) + this.KEY_STR.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return output;
        };
        ExifRestorer.restore = function(origFileBase64, resizedFileBase64) {
            var expectedBase64Header = "data:image/jpeg;base64,";
            if (!origFileBase64.match(expectedBase64Header)) {
                return resizedFileBase64;
            }
            var rawImage = this.decode64(origFileBase64.replace(expectedBase64Header, ""));
            var segments = this.slice2Segments(rawImage);
            var image = this.exifManipulation(resizedFileBase64, segments);
            return expectedBase64Header + this.encode64(image);
        };
        ExifRestorer.exifManipulation = function(resizedFileBase64, segments) {
            var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray), aBuffer = new Uint8Array(newImageArray);
            return aBuffer;
        };
        ExifRestorer.getExifArray = function(segments) {
            var seg;
            for (var x = 0; x < segments.length; x++) {
                seg = segments[x];
                if (seg[0] == 255 & seg[1] == 225) {
                    return seg;
                }
            }
            return [];
        };
        ExifRestorer.insertExif = function(resizedFileBase64, exifArray) {
            var imageData = resizedFileBase64.replace("data:image/jpeg;base64,", ""), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
            array = array.concat(exifArray);
            array = array.concat(ato);
            return array;
        };
        ExifRestorer.slice2Segments = function(rawImageArray) {
            var head = 0, segments = [];
            while (1) {
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 218) {
                    break;
                }
                if (rawImageArray[head] == 255 & rawImageArray[head + 1] == 216) {
                    head += 2;
                } else {
                    var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3], endPoint = head + length + 2, seg = rawImageArray.slice(head, endPoint);
                    segments.push(seg);
                    head = endPoint;
                }
                if (head > rawImageArray.length) {
                    break;
                }
            }
            return segments;
        };
        ExifRestorer.decode64 = function(input) {
            var output = "", chr1, chr2, chr3 = "", enc1, enc2, enc3, enc4 = "", i = 0, buf = [];
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                throw new Error("There were invalid base64 characters in the input text.  " + "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
            do {
                enc1 = this.KEY_STR.indexOf(input.charAt(i++));
                enc2 = this.KEY_STR.indexOf(input.charAt(i++));
                enc3 = this.KEY_STR.indexOf(input.charAt(i++));
                enc4 = this.KEY_STR.indexOf(input.charAt(i++));
                chr1 = enc1 << 2 | enc2 >> 4;
                chr2 = (enc2 & 15) << 4 | enc3 >> 2;
                chr3 = (enc3 & 3) << 6 | enc4;
                buf.push(chr1);
                if (enc3 != 64) {
                    buf.push(chr2);
                }
                if (enc4 != 64) {
                    buf.push(chr3);
                }
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);
            return buf;
        };
        return ExifRestorer;
    }();
    qq.TotalProgress = function(callback, getSize) {
        "use strict";
        var perFileProgress = {}, totalLoaded = 0, totalSize = 0, lastLoadedSent = -1, lastTotalSent = -1, callbackProxy = function(loaded, total) {
            if (loaded !== lastLoadedSent || total !== lastTotalSent) {
                callback(loaded, total);
            }
            lastLoadedSent = loaded;
            lastTotalSent = total;
        }, noRetryableFiles = function(failed, retryable) {
            var none = true;
            qq.each(failed, function(idx, failedId) {
                if (qq.indexOf(retryable, failedId) >= 0) {
                    none = false;
                    return false;
                }
            });
            return none;
        }, onCancel = function(id) {
            updateTotalProgress(id, -1, -1);
            delete perFileProgress[id];
        }, onAllComplete = function(successful, failed, retryable) {
            if (failed.length === 0 || noRetryableFiles(failed, retryable)) {
                callbackProxy(totalSize, totalSize);
                this.reset();
            }
        }, onNew = function(id) {
            var size = getSize(id);
            if (size > 0) {
                updateTotalProgress(id, 0, size);
                perFileProgress[id] = {
                    loaded: 0,
                    total: size
                };
            }
        }, updateTotalProgress = function(id, newLoaded, newTotal) {
            var oldLoaded = perFileProgress[id] ? perFileProgress[id].loaded : 0, oldTotal = perFileProgress[id] ? perFileProgress[id].total : 0;
            if (newLoaded === -1 && newTotal === -1) {
                totalLoaded -= oldLoaded;
                totalSize -= oldTotal;
            } else {
                if (newLoaded) {
                    totalLoaded += newLoaded - oldLoaded;
                }
                if (newTotal) {
                    totalSize += newTotal - oldTotal;
                }
            }
            callbackProxy(totalLoaded, totalSize);
        };
        qq.extend(this, {
            onAllComplete: onAllComplete,
            onStatusChange: function(id, oldStatus, newStatus) {
                if (newStatus === qq.status.CANCELED || newStatus === qq.status.REJECTED) {
                    onCancel(id);
                } else if (newStatus === qq.status.SUBMITTING) {
                    onNew(id);
                }
            },
            onIndividualProgress: function(id, loaded, total) {
                updateTotalProgress(id, loaded, total);
                perFileProgress[id] = {
                    loaded: loaded,
                    total: total
                };
            },
            onNewSize: function(id) {
                onNew(id);
            },
            reset: function() {
                perFileProgress = {};
                totalLoaded = 0;
                totalSize = 0;
            }
        });
    };
    qq.PasteSupport = function(o) {
        "use strict";
        var options, detachPasteHandler;
        options = {
            targetElement: null,
            callbacks: {
                log: function(message, level) {},
                pasteReceived: function(blob) {}
            }
        };
        function isImage(item) {
            return item.type && item.type.indexOf("image/") === 0;
        }
        function registerPasteHandler() {
            detachPasteHandler = qq(options.targetElement).attach("paste", function(event) {
                var clipboardData = event.clipboardData;
                if (clipboardData) {
                    qq.each(clipboardData.items, function(idx, item) {
                        if (isImage(item)) {
                            var blob = item.getAsFile();
                            options.callbacks.pasteReceived(blob);
                        }
                    });
                }
            });
        }
        function unregisterPasteHandler() {
            if (detachPasteHandler) {
                detachPasteHandler();
            }
        }
        qq.extend(options, o);
        registerPasteHandler();
        qq.extend(this, {
            reset: function() {
                unregisterPasteHandler();
            }
        });
    };
    qq.FormSupport = function(options, startUpload, log) {
        "use strict";
        var self = this, interceptSubmit = options.interceptSubmit, formEl = options.element, autoUpload = options.autoUpload;
        qq.extend(this, {
            newEndpoint: null,
            newAutoUpload: autoUpload,
            attachedToForm: false,
            getFormInputsAsObject: function() {
                if (formEl == null) {
                    return null;
                }
                return self._form2Obj(formEl);
            }
        });
        function determineNewEndpoint(formEl) {
            if (formEl.getAttribute("action")) {
                self.newEndpoint = formEl.getAttribute("action");
            }
        }
        function validateForm(formEl, nativeSubmit) {
            if (formEl.checkValidity && !formEl.checkValidity()) {
                log("Form did not pass validation checks - will not upload.", "error");
                nativeSubmit();
            } else {
                return true;
            }
        }
        function maybeUploadOnSubmit(formEl) {
            var nativeSubmit = formEl.submit;
            qq(formEl).attach("submit", function(event) {
                event = event || window.event;
                if (event.preventDefault) {
                    event.preventDefault();
                } else {
                    event.returnValue = false;
                }
                validateForm(formEl, nativeSubmit) && startUpload();
            });
            formEl.submit = function() {
                validateForm(formEl, nativeSubmit) && startUpload();
            };
        }
        function determineFormEl(formEl) {
            if (formEl) {
                if (qq.isString(formEl)) {
                    formEl = document.getElementById(formEl);
                }
                if (formEl) {
                    log("Attaching to form element.");
                    determineNewEndpoint(formEl);
                    interceptSubmit && maybeUploadOnSubmit(formEl);
                }
            }
            return formEl;
        }
        formEl = determineFormEl(formEl);
        this.attachedToForm = !!formEl;
    };
    qq.extend(qq.FormSupport.prototype, {
        _form2Obj: function(form) {
            "use strict";
            var obj = {}, notIrrelevantType = function(type) {
                var irrelevantTypes = [ "button", "image", "reset", "submit" ];
                return qq.indexOf(irrelevantTypes, type.toLowerCase()) < 0;
            }, radioOrCheckbox = function(type) {
                return qq.indexOf([ "checkbox", "radio" ], type.toLowerCase()) >= 0;
            }, ignoreValue = function(el) {
                if (radioOrCheckbox(el.type) && !el.checked) {
                    return true;
                }
                return el.disabled && el.type.toLowerCase() !== "hidden";
            }, selectValue = function(select) {
                var value = null;
                qq.each(qq(select).children(), function(idx, child) {
                    if (child.tagName.toLowerCase() === "option" && child.selected) {
                        value = child.value;
                        return false;
                    }
                });
                return value;
            };
            qq.each(form.elements, function(idx, el) {
                if ((qq.isInput(el, true) || el.tagName.toLowerCase() === "textarea") && notIrrelevantType(el.type) && !ignoreValue(el)) {
                    obj[el.name] = el.value;
                } else if (el.tagName.toLowerCase() === "select" && !ignoreValue(el)) {
                    var value = selectValue(el);
                    if (value !== null) {
                        obj[el.name] = value;
                    }
                }
            });
            return obj;
        }
    });
    qq.traditional = qq.traditional || {};
    qq.traditional.FormUploadHandler = function(options, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getUuid = proxy.getUuid, log = proxy.log;
        function getIframeContentJson(id, iframe) {
            var response, doc, innerHtml;
            try {
                doc = iframe.contentDocument || iframe.contentWindow.document;
                innerHtml = doc.body.innerHTML;
                log("converting iframe's innerHTML to JSON");
                log("innerHTML = " + innerHtml);
                if (innerHtml && innerHtml.match(/^<pre/i)) {
                    innerHtml = doc.body.firstChild.firstChild.nodeValue;
                }
                response = handler._parseJsonResponse(innerHtml);
            } catch (error) {
                log("Error when attempting to parse form upload response (" + error.message + ")", "error");
                response = {
                    success: false
                };
            }
            return response;
        }
        function createForm(id, iframe) {
            var params = options.paramsStore.get(id), method = options.method.toLowerCase() === "get" ? "GET" : "POST", endpoint = options.endpointStore.get(id), name = getName(id);
            params[options.uuidName] = getUuid(id);
            params[options.filenameParam] = name;
            return handler._initFormForUpload({
                method: method,
                endpoint: endpoint,
                params: params,
                paramsInBody: options.paramsInBody,
                targetName: iframe.name
            });
        }
        this.uploadFile = function(id) {
            var input = handler.getInput(id), iframe = handler._createIframe(id), promise = new qq.Promise(), form;
            form = createForm(id, iframe);
            form.appendChild(input);
            handler._attachLoadEvent(iframe, function(responseFromMessage) {
                log("iframe loaded");
                var response = responseFromMessage ? responseFromMessage : getIframeContentJson(id, iframe);
                handler._detachLoadEvent(id);
                if (!options.cors.expected) {
                    qq(iframe).remove();
                }
                if (response.success) {
                    promise.success(response);
                } else {
                    promise.failure(response);
                }
            });
            log("Sending upload request for " + id);
            form.submit();
            qq(form).remove();
            return promise;
        };
        qq.extend(this, new qq.FormUploadHandler({
            options: {
                isCors: options.cors.expected,
                inputName: options.inputName
            },
            proxy: {
                onCancel: options.onCancel,
                getName: getName,
                getUuid: getUuid,
                log: log
            }
        }));
    };
    qq.traditional = qq.traditional || {};
    qq.traditional.XhrUploadHandler = function(spec, proxy) {
        "use strict";
        var handler = this, getName = proxy.getName, getSize = proxy.getSize, getUuid = proxy.getUuid, log = proxy.log, multipart = spec.forceMultipart || spec.paramsInBody, addChunkingSpecificParams = function(id, params, chunkData) {
            var size = getSize(id), name = getName(id);
            if (!spec.omitDefaultParams) {
                params[spec.chunking.paramNames.partIndex] = chunkData.part;
                params[spec.chunking.paramNames.partByteOffset] = chunkData.start;
                params[spec.chunking.paramNames.chunkSize] = chunkData.size;
                params[spec.chunking.paramNames.totalParts] = chunkData.count;
                params[spec.totalFileSizeName] = size;
            }
            if (multipart && !spec.omitDefaultParams) {
                params[spec.filenameParam] = name;
            }
        }, allChunksDoneRequester = new qq.traditional.AllChunksDoneAjaxRequester({
            cors: spec.cors,
            endpoint: spec.chunking.success.endpoint,
            headers: spec.chunking.success.headers,
            jsonPayload: spec.chunking.success.jsonPayload,
            log: log,
            method: spec.chunking.success.method,
            params: spec.chunking.success.params
        }), createReadyStateChangedHandler = function(id, xhr) {
            var promise = new qq.Promise();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    var result = onUploadOrChunkComplete(id, xhr);
                    if (result.success) {
                        promise.success(result.response, xhr);
                    } else {
                        promise.failure(result.response, xhr);
                    }
                }
            };
            return promise;
        }, getChunksCompleteParams = function(id) {
            var params = spec.paramsStore.get(id), name = getName(id), size = getSize(id);
            params[spec.uuidName] = getUuid(id);
            params[spec.filenameParam] = name;
            params[spec.totalFileSizeName] = size;
            params[spec.chunking.paramNames.totalParts] = handler._getTotalChunks(id);
            return params;
        }, isErrorUploadResponse = function(xhr, response) {
            return qq.indexOf([ 200, 201, 202, 203, 204 ], xhr.status) < 0 || spec.requireSuccessJson && !response.success || response.reset;
        }, onUploadOrChunkComplete = function(id, xhr) {
            var response;
            log("xhr - server response received for " + id);
            log("responseText = " + xhr.responseText);
            response = parseResponse(true, xhr);
            return {
                success: !isErrorUploadResponse(xhr, response),
                response: response
            };
        }, parseResponse = function(upload, xhr) {
            var response = {};
            try {
                log(qq.format("Received response status {} with body: {}", xhr.status, xhr.responseText));
                response = qq.parseJson(xhr.responseText);
            } catch (error) {
                upload && spec.requireSuccessJson && log("Error when attempting to parse xhr response text (" + error.message + ")", "error");
            }
            return response;
        }, sendChunksCompleteRequest = function(id) {
            var promise = new qq.Promise();
            allChunksDoneRequester.complete(id, handler._createXhr(id), getChunksCompleteParams(id), spec.customHeaders.get(id)).then(function(xhr) {
                promise.success(parseResponse(false, xhr), xhr);
            }, function(xhr) {
                promise.failure(parseResponse(false, xhr), xhr);
            });
            return promise;
        }, setParamsAndGetEntityToSend = function(entityToSendParams) {
            var fileOrBlob = entityToSendParams.fileOrBlob;
            var id = entityToSendParams.id;
            var xhr = entityToSendParams.xhr;
            var xhrOverrides = entityToSendParams.xhrOverrides || {};
            var customParams = entityToSendParams.customParams || {};
            var defaultParams = entityToSendParams.params || {};
            var xhrOverrideParams = xhrOverrides.params || {};
            var params;
            var formData = multipart ? new FormData() : null, method = xhrOverrides.method || spec.method, endpoint = xhrOverrides.endpoint || spec.endpointStore.get(id), name = getName(id), size = getSize(id);
            if (spec.omitDefaultParams) {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
            } else {
                params = qq.extend({}, customParams);
                qq.extend(params, xhrOverrideParams);
                qq.extend(params, defaultParams);
                params[spec.uuidName] = getUuid(id);
                params[spec.filenameParam] = name;
                if (multipart) {
                    params[spec.totalFileSizeName] = size;
                } else if (!spec.paramsInBody) {
                    params[spec.inputName] = name;
                }
            }
            if (!spec.paramsInBody) {
                endpoint = qq.obj2url(params, endpoint);
            }
            xhr.open(method, endpoint, true);
            if (spec.cors.expected && spec.cors.sendCredentials) {
                xhr.withCredentials = true;
            }
            if (multipart) {
                if (spec.paramsInBody) {
                    qq.obj2FormData(params, formData);
                }
                formData.append(spec.inputName, fileOrBlob);
                return formData;
            }
            return fileOrBlob;
        }, setUploadHeaders = function(headersOptions) {
            var headerOverrides = headersOptions.headerOverrides;
            var id = headersOptions.id;
            var xhr = headersOptions.xhr;
            if (headerOverrides) {
                qq.each(headerOverrides, function(headerName, headerValue) {
                    xhr.setRequestHeader(headerName, headerValue);
                });
            } else {
                var extraHeaders = spec.customHeaders.get(id), fileOrBlob = handler.getFile(id);
                xhr.setRequestHeader("Accept", "application/json");
                xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                xhr.setRequestHeader("Cache-Control", "no-cache");
                if (!multipart) {
                    xhr.setRequestHeader("Content-Type", "application/octet-stream");
                    xhr.setRequestHeader("X-Mime-Type", fileOrBlob.type);
                }
                qq.each(extraHeaders, function(name, val) {
                    xhr.setRequestHeader(name, val);
                });
            }
        };
        qq.extend(this, {
            uploadChunk: function(uploadChunkParams) {
                var id = uploadChunkParams.id;
                var chunkIdx = uploadChunkParams.chunkIdx;
                var overrides = uploadChunkParams.overrides || {};
                var resuming = uploadChunkParams.resuming;
                var chunkData = handler._getChunkData(id, chunkIdx), xhr = handler._createXhr(id, chunkIdx), promise, toSend, customParams, params = {};
                promise = createReadyStateChangedHandler(id, xhr);
                handler._registerProgressHandler(id, chunkIdx, chunkData.size);
                customParams = spec.paramsStore.get(id);
                addChunkingSpecificParams(id, params, chunkData);
                if (resuming) {
                    params[spec.resume.paramNames.resuming] = true;
                }
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: chunkData.blob,
                    id: id,
                    customParams: customParams,
                    params: params,
                    xhr: xhr,
                    xhrOverrides: overrides
                });
                setUploadHeaders({
                    headerOverrides: overrides.headers,
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            },
            uploadFile: function(id) {
                var fileOrBlob = handler.getFile(id), promise, xhr, customParams, toSend;
                xhr = handler._createXhr(id);
                handler._registerProgressHandler(id);
                promise = createReadyStateChangedHandler(id, xhr);
                customParams = spec.paramsStore.get(id);
                toSend = setParamsAndGetEntityToSend({
                    fileOrBlob: fileOrBlob,
                    id: id,
                    customParams: customParams,
                    xhr: xhr
                });
                setUploadHeaders({
                    id: id,
                    xhr: xhr
                });
                xhr.send(toSend);
                return promise;
            }
        });
        qq.extend(this, new qq.XhrUploadHandler({
            options: qq.extend({
                namespace: "traditional"
            }, spec),
            proxy: qq.extend({
                getEndpoint: spec.endpointStore.get
            }, proxy)
        }));
        qq.override(this, function(super_) {
            return {
                finalizeChunks: function(id) {
                    proxy.onFinalizing(id);
                    if (spec.chunking.success.endpoint) {
                        return sendChunksCompleteRequest(id);
                    } else {
                        return super_.finalizeChunks(id, qq.bind(parseResponse, this, true));
                    }
                }
            };
        });
    };
    qq.traditional.AllChunksDoneAjaxRequester = function(o) {
        "use strict";
        var requester, options = {
            cors: {
                allowXdr: false,
                expected: false,
                sendCredentials: false
            },
            endpoint: null,
            log: function(str, level) {},
            method: "POST"
        }, promises = {}, endpointHandler = {
            get: function(id) {
                if (qq.isFunction(options.endpoint)) {
                    return options.endpoint(id);
                }
                return options.endpoint;
            }
        };
        qq.extend(options, o);
        requester = qq.extend(this, new qq.AjaxRequester({
            acceptHeader: "application/json",
            contentType: options.jsonPayload ? "application/json" : "application/x-www-form-urlencoded",
            validMethods: [ options.method ],
            method: options.method,
            endpointStore: endpointHandler,
            allowXRequestedWithAndCacheControl: false,
            cors: options.cors,
            log: options.log,
            onComplete: function(id, xhr, isError) {
                var promise = promises[id];
                delete promises[id];
                if (isError) {
                    promise.failure(xhr);
                } else {
                    promise.success(xhr);
                }
            }
        }));
        qq.extend(this, {
            complete: function(id, xhr, params, headers) {
                var promise = new qq.Promise();
                options.log("Submitting All Chunks Done request for " + id);
                promises[id] = promise;
                requester.initTransport(id).withParams(options.params(id) || params).withHeaders(options.headers(id) || headers).send(xhr);
                return promise;
            }
        });
    };
    qq.DragAndDrop = function(o) {
        "use strict";
        var options, HIDE_ZONES_EVENT_NAME = "qq-hidezones", HIDE_BEFORE_ENTER_ATTR = "qq-hide-dropzone", uploadDropZones = [], droppedFiles = [], disposeSupport = new qq.DisposeSupport();
        options = {
            dropZoneElements: [],
            allowMultipleItems: true,
            classes: {
                dropActive: null
            },
            callbacks: new qq.DragAndDrop.callbacks()
        };
        qq.extend(options, o, true);
        function uploadDroppedFiles(files, uploadDropZone) {
            var filesAsArray = Array.prototype.slice.call(files);
            options.callbacks.dropLog("Grabbed " + files.length + " dropped files.");
            uploadDropZone.dropDisabled(false);
            options.callbacks.processingDroppedFilesComplete(filesAsArray, uploadDropZone.getElement());
        }
        function traverseFileTree(entry) {
            var parseEntryPromise = new qq.Promise();
            if (entry.isFile) {
                entry.file(function(file) {
                    file.qqPath = extractDirectoryPath(entry);
                    droppedFiles.push(file);
                    parseEntryPromise.success();
                }, function(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            } else if (entry.isDirectory) {
                getFilesInDirectory(entry).then(function allEntriesRead(entries) {
                    var entriesLeft = entries.length;
                    qq.each(entries, function(idx, entry) {
                        traverseFileTree(entry).done(function() {
                            entriesLeft -= 1;
                            if (entriesLeft === 0) {
                                parseEntryPromise.success();
                            }
                        });
                    });
                    if (!entries.length) {
                        parseEntryPromise.success();
                    }
                }, function readFailure(fileError) {
                    options.callbacks.dropLog("Problem parsing '" + entry.fullPath + "'.  FileError code " + fileError.code + ".", "error");
                    parseEntryPromise.failure();
                });
            }
            return parseEntryPromise;
        }
        function extractDirectoryPath(entry) {
            var name = entry.name, fullPath = entry.fullPath, indexOfNameInFullPath = fullPath.lastIndexOf(name);
            fullPath = fullPath.substr(0, indexOfNameInFullPath);
            if (fullPath.charAt(0) === "/") {
                fullPath = fullPath.substr(1);
            }
            return fullPath;
        }
        function getFilesInDirectory(entry, reader, accumEntries, existingPromise) {
            var promise = existingPromise || new qq.Promise(), dirReader = reader || entry.createReader();
            dirReader.readEntries(function readSuccess(entries) {
                var newEntries = accumEntries ? accumEntries.concat(entries) : entries;
                if (entries.length) {
                    setTimeout(function() {
                        getFilesInDirectory(entry, dirReader, newEntries, promise);
                    }, 0);
                } else {
                    promise.success(newEntries);
                }
            }, promise.failure);
            return promise;
        }
        function handleDataTransfer(dataTransfer, uploadDropZone) {
            var pendingFolderPromises = [], handleDataTransferPromise = new qq.Promise();
            options.callbacks.processingDroppedFiles();
            uploadDropZone.dropDisabled(true);
            if (dataTransfer.files.length > 1 && !options.allowMultipleItems) {
                options.callbacks.processingDroppedFilesComplete([]);
                options.callbacks.dropError("tooManyFilesError", "");
                uploadDropZone.dropDisabled(false);
                handleDataTransferPromise.failure();
            } else {
                droppedFiles = [];
                if (qq.isFolderDropSupported(dataTransfer)) {
                    qq.each(dataTransfer.items, function(idx, item) {
                        var entry = item.webkitGetAsEntry();
                        if (entry) {
                            if (entry.isFile) {
                                droppedFiles.push(item.getAsFile());
                            } else {
                                pendingFolderPromises.push(traverseFileTree(entry).done(function() {
                                    pendingFolderPromises.pop();
                                    if (pendingFolderPromises.length === 0) {
                                        handleDataTransferPromise.success();
                                    }
                                }));
                            }
                        }
                    });
                } else {
                    droppedFiles = dataTransfer.files;
                }
                if (pendingFolderPromises.length === 0) {
                    handleDataTransferPromise.success();
                }
            }
            return handleDataTransferPromise;
        }
        function setupDropzone(dropArea) {
            var dropZone = new qq.UploadDropZone({
                HIDE_ZONES_EVENT_NAME: HIDE_ZONES_EVENT_NAME,
                element: dropArea,
                onEnter: function(e) {
                    qq(dropArea).addClass(options.classes.dropActive);
                    e.stopPropagation();
                },
                onLeaveNotDescendants: function(e) {
                    qq(dropArea).removeClass(options.classes.dropActive);
                },
                onDrop: function(e) {
                    handleDataTransfer(e.dataTransfer, dropZone).then(function() {
                        uploadDroppedFiles(droppedFiles, dropZone);
                    }, function() {
                        options.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.", "error");
                    });
                }
            });
            disposeSupport.addDisposer(function() {
                dropZone.dispose();
            });
            qq(dropArea).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropArea).hide();
            uploadDropZones.push(dropZone);
            return dropZone;
        }
        function isFileDrag(dragEvent) {
            var fileDrag;
            qq.each(dragEvent.dataTransfer.types, function(key, val) {
                if (val === "Files") {
                    fileDrag = true;
                    return false;
                }
            });
            return fileDrag;
        }
        function leavingDocumentOut(e) {
            if (qq.safari()) {
                return e.x < 0 || e.y < 0;
            }
            return e.x === 0 && e.y === 0;
        }
        function setupDragDrop() {
            var dropZones = options.dropZoneElements, maybeHideDropZones = function() {
                setTimeout(function() {
                    qq.each(dropZones, function(idx, dropZone) {
                        qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR) && qq(dropZone).hide();
                        qq(dropZone).removeClass(options.classes.dropActive);
                    });
                }, 10);
            };
            qq.each(dropZones, function(idx, dropZone) {
                var uploadDropZone = setupDropzone(dropZone);
                if (dropZones.length && qq.supportedFeatures.fileDrop) {
                    disposeSupport.attach(document, "dragenter", function(e) {
                        if (!uploadDropZone.dropDisabled() && isFileDrag(e)) {
                            qq.each(dropZones, function(idx, dropZone) {
                                if (dropZone instanceof HTMLElement && qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)) {
                                    qq(dropZone).css({
                                        display: "block"
                                    });
                                }
                            });
                        }
                    });
                }
            });
            disposeSupport.attach(document, "dragleave", function(e) {
                if (leavingDocumentOut(e)) {
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(qq(document).children()[0], "mouseenter", function(e) {
                maybeHideDropZones();
            });
            disposeSupport.attach(document, "drop", function(e) {
                if (isFileDrag(e)) {
                    e.preventDefault();
                    maybeHideDropZones();
                }
            });
            disposeSupport.attach(document, HIDE_ZONES_EVENT_NAME, maybeHideDropZones);
        }
        setupDragDrop();
        qq.extend(this, {
            setupExtraDropzone: function(element) {
                options.dropZoneElements.push(element);
                setupDropzone(element);
            },
            removeDropzone: function(element) {
                var i, dzs = options.dropZoneElements;
                for (i in dzs) {
                    if (dzs[i] === element) {
                        return dzs.splice(i, 1);
                    }
                }
            },
            dispose: function() {
                disposeSupport.dispose();
                qq.each(uploadDropZones, function(idx, dropZone) {
                    dropZone.dispose();
                });
            }
        });
        this._testing = {};
        this._testing.extractDirectoryPath = extractDirectoryPath;
    };
    qq.DragAndDrop.callbacks = function() {
        "use strict";
        return {
            processingDroppedFiles: function() {},
            processingDroppedFilesComplete: function(files, targetEl) {},
            dropError: function(code, errorSpecifics) {
                qq.log("Drag & drop error code '" + code + " with these specifics: '" + errorSpecifics + "'", "error");
            },
            dropLog: function(message, level) {
                qq.log(message, level);
            }
        };
    };
    qq.UploadDropZone = function(o) {
        "use strict";
        var disposeSupport = new qq.DisposeSupport(), options, element, preventDrop, dropOutsideDisabled;
        options = {
            element: null,
            onEnter: function(e) {},
            onLeave: function(e) {},
            onLeaveNotDescendants: function(e) {},
            onDrop: function(e) {}
        };
        qq.extend(options, o);
        element = options.element;
        function dragoverShouldBeCanceled() {
            return qq.safari() || qq.firefox() && qq.windows();
        }
        function disableDropOutside(e) {
            if (!dropOutsideDisabled) {
                if (dragoverShouldBeCanceled) {
                    disposeSupport.attach(document, "dragover", function(e) {
                        e.preventDefault();
                    });
                } else {
                    disposeSupport.attach(document, "dragover", function(e) {
                        if (e.dataTransfer) {
                            e.dataTransfer.dropEffect = "none";
                            e.preventDefault();
                        }
                    });
                }
                dropOutsideDisabled = true;
            }
        }
        function isValidFileDrag(e) {
            if (!qq.supportedFeatures.fileDrop) {
                return false;
            }
            var effectTest, dt = e.dataTransfer, isSafari = qq.safari();
            effectTest = qq.ie() && qq.supportedFeatures.fileDrop ? true : dt.effectAllowed !== "none";
            return dt && effectTest && (dt.files && dt.files.length || !isSafari && dt.types.contains && dt.types.contains("Files") || dt.types.includes && dt.types.includes("Files"));
        }
        function isOrSetDropDisabled(isDisabled) {
            if (isDisabled !== undefined) {
                preventDrop = isDisabled;
            }
            return preventDrop;
        }
        function triggerHidezonesEvent() {
            var hideZonesEvent;
            function triggerUsingOldApi() {
                hideZonesEvent = document.createEvent("Event");
                hideZonesEvent.initEvent(options.HIDE_ZONES_EVENT_NAME, true, true);
            }
            if (window.CustomEvent) {
                try {
                    hideZonesEvent = new CustomEvent(options.HIDE_ZONES_EVENT_NAME);
                } catch (err) {
                    triggerUsingOldApi();
                }
            } else {
                triggerUsingOldApi();
            }
            document.dispatchEvent(hideZonesEvent);
        }
        function attachEvents() {
            disposeSupport.attach(element, "dragover", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                var effect = qq.ie() && qq.supportedFeatures.fileDrop ? null : e.dataTransfer.effectAllowed;
                if (effect === "move" || effect === "linkMove") {
                    e.dataTransfer.dropEffect = "move";
                } else {
                    e.dataTransfer.dropEffect = "copy";
                }
                e.stopPropagation();
                e.preventDefault();
            });
            disposeSupport.attach(element, "dragenter", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    options.onEnter(e);
                }
            });
            disposeSupport.attach(element, "dragleave", function(e) {
                if (!isValidFileDrag(e)) {
                    return;
                }
                options.onLeave(e);
                var relatedTarget = document.elementFromPoint(e.clientX, e.clientY);
                if (qq(this).contains(relatedTarget)) {
                    return;
                }
                options.onLeaveNotDescendants(e);
            });
            disposeSupport.attach(element, "drop", function(e) {
                if (!isOrSetDropDisabled()) {
                    if (!isValidFileDrag(e)) {
                        return;
                    }
                    e.preventDefault();
                    e.stopPropagation();
                    options.onDrop(e);
                    triggerHidezonesEvent();
                }
            });
        }
        disableDropOutside();
        attachEvents();
        qq.extend(this, {
            dropDisabled: function(isDisabled) {
                return isOrSetDropDisabled(isDisabled);
            },
            dispose: function() {
                disposeSupport.dispose();
            },
            getElement: function() {
                return element;
            }
        });
        this._testing = {};
        this._testing.isValidFileDrag = isValidFileDrag;
    };
    (function() {
        "use strict";
        qq.uiPublicApi = {
            addInitialFiles: function(cannedFileList) {
                this._parent.prototype.addInitialFiles.apply(this, arguments);
                this._templating.addCacheToDom();
            },
            clearStoredFiles: function() {
                this._parent.prototype.clearStoredFiles.apply(this, arguments);
                this._templating.clearFiles();
            },
            addExtraDropzone: function(element) {
                this._dnd && this._dnd.setupExtraDropzone(element);
            },
            removeExtraDropzone: function(element) {
                if (this._dnd) {
                    return this._dnd.removeDropzone(element);
                }
            },
            getItemByFileId: function(id) {
                if (!this._templating.isHiddenForever(id)) {
                    return this._templating.getFileContainer(id);
                }
            },
            reset: function() {
                this._parent.prototype.reset.apply(this, arguments);
                this._templating.reset();
                if (!this._options.button && this._templating.getButton()) {
                    this._defaultButtonId = this._createUploadButton({
                        element: this._templating.getButton(),
                        title: this._options.text.fileInputTitle
                    }).getButtonId();
                }
                if (this._dnd) {
                    this._dnd.dispose();
                    this._dnd = this._setupDragAndDrop();
                }
                this._totalFilesInBatch = 0;
                this._filesInBatchAddedToUi = 0;
                this._setupClickAndEditEventHandlers();
            },
            setName: function(id, newName) {
                var formattedFilename = this._options.formatFileName(newName);
                this._parent.prototype.setName.apply(this, arguments);
                this._templating.updateFilename(id, formattedFilename);
            },
            pauseUpload: function(id) {
                var paused = this._parent.prototype.pauseUpload.apply(this, arguments);
                paused && this._templating.uploadPaused(id);
                return paused;
            },
            continueUpload: function(id) {
                var continued = this._parent.prototype.continueUpload.apply(this, arguments);
                continued && this._templating.uploadContinued(id);
                return continued;
            },
            getId: function(fileContainerOrChildEl) {
                return this._templating.getFileId(fileContainerOrChildEl);
            },
            getDropTarget: function(fileId) {
                var file = this.getFile(fileId);
                return file.qqDropTarget;
            }
        };
        qq.uiPrivateApi = {
            _getButton: function(buttonId) {
                var button = this._parent.prototype._getButton.apply(this, arguments);
                if (!button) {
                    if (buttonId === this._defaultButtonId) {
                        button = this._templating.getButton();
                    }
                }
                return button;
            },
            _removeFileItem: function(fileId) {
                this._templating.removeFile(fileId);
            },
            _setupClickAndEditEventHandlers: function() {
                this._fileButtonsClickHandler = qq.FileButtonsClickHandler && this._bindFileButtonsClickEvent();
                this._focusinEventSupported = !qq.firefox();
                if (this._isEditFilenameEnabled()) {
                    this._filenameClickHandler = this._bindFilenameClickEvent();
                    this._filenameInputFocusInHandler = this._bindFilenameInputFocusInEvent();
                    this._filenameInputFocusHandler = this._bindFilenameInputFocusEvent();
                }
            },
            _setupDragAndDrop: function() {
                var self = this, dropZoneElements = this._options.dragAndDrop.extraDropzones, templating = this._templating, defaultDropZone = templating.getDropZone();
                defaultDropZone && dropZoneElements.push(defaultDropZone);
                return new qq.DragAndDrop({
                    dropZoneElements: dropZoneElements,
                    allowMultipleItems: this._options.multiple,
                    classes: {
                        dropActive: this._options.classes.dropActive
                    },
                    callbacks: {
                        processingDroppedFiles: function() {
                            templating.showDropProcessing();
                        },
                        processingDroppedFilesComplete: function(files, targetEl) {
                            templating.hideDropProcessing();
                            qq.each(files, function(idx, file) {
                                file.qqDropTarget = targetEl;
                            });
                            if (files.length) {
                                self.addFiles(files, null, null);
                            }
                        },
                        dropError: function(code, errorData) {
                            self._itemError(code, errorData);
                        },
                        dropLog: function(message, level) {
                            self.log(message, level);
                        }
                    }
                });
            },
            _bindFileButtonsClickEvent: function() {
                var self = this;
                return new qq.FileButtonsClickHandler({
                    templating: this._templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onDeleteFile: function(fileId) {
                        self.deleteFile(fileId);
                    },
                    onCancel: function(fileId) {
                        self.cancel(fileId);
                    },
                    onRetry: function(fileId) {
                        self.retry(fileId);
                    },
                    onPause: function(fileId) {
                        self.pauseUpload(fileId);
                    },
                    onContinue: function(fileId) {
                        self.continueUpload(fileId);
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    }
                });
            },
            _isEditFilenameEnabled: function() {
                return this._templating.isEditFilenamePossible() && !this._options.autoUpload && qq.FilenameClickHandler && qq.FilenameInputFocusHandler && qq.FilenameInputFocusHandler;
            },
            _filenameEditHandler: function() {
                var self = this, templating = this._templating;
                return {
                    templating: templating,
                    log: function(message, lvl) {
                        self.log(message, lvl);
                    },
                    onGetUploadStatus: function(fileId) {
                        return self.getUploads({
                            id: fileId
                        }).status;
                    },
                    onGetName: function(fileId) {
                        return self.getName(fileId);
                    },
                    onSetName: function(id, newName) {
                        self.setName(id, newName);
                    },
                    onEditingStatusChange: function(id, isEditing) {
                        var qqInput = qq(templating.getEditInput(id)), qqFileContainer = qq(templating.getFileContainer(id));
                        if (isEditing) {
                            qqInput.addClass("qq-editing");
                            templating.hideFilename(id);
                            templating.hideEditIcon(id);
                        } else {
                            qqInput.removeClass("qq-editing");
                            templating.showFilename(id);
                            templating.showEditIcon(id);
                        }
                        qqFileContainer.addClass("qq-temp").removeClass("qq-temp");
                    }
                };
            },
            _onUploadStatusChange: function(id, oldStatus, newStatus) {
                this._parent.prototype._onUploadStatusChange.apply(this, arguments);
                if (this._isEditFilenameEnabled()) {
                    if (this._templating.getFileContainer(id) && newStatus !== qq.status.SUBMITTED) {
                        this._templating.markFilenameEditable(id);
                        this._templating.hideEditIcon(id);
                    }
                }
                if (oldStatus === qq.status.UPLOAD_RETRYING && newStatus === qq.status.UPLOADING) {
                    this._templating.hideRetry(id);
                    this._templating.setStatusText(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.retrying);
                } else if (newStatus === qq.status.UPLOAD_FAILED) {
                    this._templating.hidePause(id);
                }
            },
            _bindFilenameInputFocusInEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusInHandler(spec);
            },
            _bindFilenameInputFocusEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameInputFocusHandler(spec);
            },
            _bindFilenameClickEvent: function() {
                var spec = qq.extend({}, this._filenameEditHandler());
                return new qq.FilenameClickHandler(spec);
            },
            _storeForLater: function(id) {
                this._parent.prototype._storeForLater.apply(this, arguments);
                this._templating.hideSpinner(id);
            },
            _onAllComplete: function(successful, failed) {
                this._parent.prototype._onAllComplete.apply(this, arguments);
                this._templating.resetTotalProgress();
            },
            _onSubmit: function(id, name) {
                var file = this.getFile(id);
                if (file && file.qqPath && this._options.dragAndDrop.reportDirectoryPaths) {
                    this._paramsStore.addReadOnly(id, {
                        qqpath: file.qqPath
                    });
                }
                this._parent.prototype._onSubmit.apply(this, arguments);
                this._addToList(id, name);
            },
            _onSubmitted: function(id) {
                if (this._isEditFilenameEnabled()) {
                    this._templating.markFilenameEditable(id);
                    this._templating.showEditIcon(id);
                    if (!this._focusinEventSupported) {
                        this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(id));
                    }
                }
            },
            _onProgress: function(id, name, loaded, total) {
                this._parent.prototype._onProgress.apply(this, arguments);
                this._templating.updateProgress(id, loaded, total);
                if (total === 0 || Math.round(loaded / total * 100) === 100) {
                    this._templating.hideCancel(id);
                    this._templating.hidePause(id);
                    this._templating.hideProgress(id);
                    this._templating.setStatusText(id, this._options.text.waitingForResponse);
                    this._displayFileSize(id);
                } else {
                    this._displayFileSize(id, loaded, total);
                }
            },
            _onTotalProgress: function(loaded, total) {
                this._parent.prototype._onTotalProgress.apply(this, arguments);
                this._templating.updateTotalProgress(loaded, total);
            },
            _onComplete: function(id, name, result, xhr) {
                var parentRetVal = this._parent.prototype._onComplete.apply(this, arguments), templating = this._templating, fileContainer = templating.getFileContainer(id), self = this;
                function completeUpload(result) {
                    if (!fileContainer) {
                        return;
                    }
                    templating.setStatusText(id);
                    qq(fileContainer).removeClass(self._classes.retrying);
                    templating.hideProgress(id);
                    if (self.getUploads({
                        id: id
                    }).status !== qq.status.UPLOAD_FAILED) {
                        templating.hideCancel(id);
                    }
                    templating.hideSpinner(id);
                    if (result.success) {
                        self._markFileAsSuccessful(id);
                    } else {
                        qq(fileContainer).addClass(self._classes.fail);
                        templating.showCancel(id);
                        if (templating.isRetryPossible() && !self._preventRetries[id]) {
                            qq(fileContainer).addClass(self._classes.retryable);
                            templating.showRetry(id);
                        }
                        self._controlFailureTextDisplay(id, result);
                    }
                }
                if (parentRetVal instanceof qq.Promise) {
                    parentRetVal.done(function(newResult) {
                        completeUpload(newResult);
                    });
                } else {
                    completeUpload(result);
                }
                return parentRetVal;
            },
            _markFileAsSuccessful: function(id) {
                var templating = this._templating;
                if (this._isDeletePossible()) {
                    templating.showDeleteButton(id);
                }
                qq(templating.getFileContainer(id)).addClass(this._classes.success);
                this._maybeUpdateThumbnail(id);
            },
            _onUploadPrep: function(id) {
                this._parent.prototype._onUploadPrep.apply(this, arguments);
                this._templating.showSpinner(id);
            },
            _onUpload: function(id, name) {
                var parentRetVal = this._parent.prototype._onUpload.apply(this, arguments);
                this._templating.showSpinner(id);
                return parentRetVal;
            },
            _onUploadChunk: function(id, chunkData) {
                this._parent.prototype._onUploadChunk.apply(this, arguments);
                if (chunkData.partIndex > 0 && this._handler.isResumable(id)) {
                    this._templating.allowPause(id);
                }
            },
            _onCancel: function(id, name) {
                this._parent.prototype._onCancel.apply(this, arguments);
                this._removeFileItem(id);
                if (this._getNotFinished() === 0) {
                    this._templating.resetTotalProgress();
                }
            },
            _onBeforeAutoRetry: function(id) {
                var retryNumForDisplay, maxAuto, retryNote;
                this._parent.prototype._onBeforeAutoRetry.apply(this, arguments);
                this._showCancelLink(id);
                if (this._options.retry.showAutoRetryNote) {
                    retryNumForDisplay = this._autoRetries[id];
                    maxAuto = this._options.retry.maxAutoAttempts;
                    retryNote = this._options.retry.autoRetryNote.replace(/\{retryNum\}/g, retryNumForDisplay);
                    retryNote = retryNote.replace(/\{maxAuto\}/g, maxAuto);
                    this._templating.setStatusText(id, retryNote);
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retrying);
                }
            },
            _onBeforeManualRetry: function(id) {
                if (this._parent.prototype._onBeforeManualRetry.apply(this, arguments)) {
                    this._templating.resetProgress(id);
                    qq(this._templating.getFileContainer(id)).removeClass(this._classes.fail);
                    this._templating.setStatusText(id);
                    this._templating.showSpinner(id);
                    this._showCancelLink(id);
                    return true;
                } else {
                    qq(this._templating.getFileContainer(id)).addClass(this._classes.retryable);
                    this._templating.showRetry(id);
                    return false;
                }
            },
            _onSubmitDelete: function(id) {
                var onSuccessCallback = qq.bind(this._onSubmitDeleteSuccess, this);
                this._parent.prototype._onSubmitDelete.call(this, id, onSuccessCallback);
            },
            _onSubmitDeleteSuccess: function(id, uuid, additionalMandatedParams) {
                if (this._options.deleteFile.forceConfirm) {
                    this._showDeleteConfirm.apply(this, arguments);
                } else {
                    this._sendDeleteRequest.apply(this, arguments);
                }
            },
            _onDeleteComplete: function(id, xhr, isError) {
                this._parent.prototype._onDeleteComplete.apply(this, arguments);
                this._templating.hideSpinner(id);
                if (isError) {
                    this._templating.setStatusText(id, this._options.deleteFile.deletingFailedText);
                    this._templating.showDeleteButton(id);
                } else {
                    this._removeFileItem(id);
                }
            },
            _sendDeleteRequest: function(id, uuid, additionalMandatedParams) {
                this._templating.hideDeleteButton(id);
                this._templating.showSpinner(id);
                this._templating.setStatusText(id, this._options.deleteFile.deletingStatusText);
                this._deleteHandler.sendDelete.apply(this, arguments);
            },
            _showDeleteConfirm: function(id, uuid, mandatedParams) {
                var fileName = this.getName(id), confirmMessage = this._options.deleteFile.confirmMessage.replace(/\{filename\}/g, fileName), uuid = this.getUuid(id), deleteRequestArgs = arguments, self = this, retVal;
                retVal = this._options.showConfirm(confirmMessage);
                if (qq.isGenericPromise(retVal)) {
                    retVal.then(function() {
                        self._sendDeleteRequest.apply(self, deleteRequestArgs);
                    });
                } else if (retVal !== false) {
                    self._sendDeleteRequest.apply(self, deleteRequestArgs);
                }
            },
            _addToList: function(id, name, canned) {
                var prependData, prependIndex = 0, dontDisplay = this._handler.isProxied(id) && this._options.scaling.hideScaled, record;
                if (this._options.display.prependFiles) {
                    if (this._totalFilesInBatch > 1 && this._filesInBatchAddedToUi > 0) {
                        prependIndex = this._filesInBatchAddedToUi - 1;
                    }
                    prependData = {
                        index: prependIndex
                    };
                }
                if (!canned) {
                    if (this._options.disableCancelForFormUploads && !qq.supportedFeatures.ajaxUploading) {
                        this._templating.disableCancel();
                    }
                    if (!this._options.multiple) {
                        record = this.getUploads({
                            id: id
                        });
                        this._handledProxyGroup = this._handledProxyGroup || record.proxyGroupId;
                        if (record.proxyGroupId !== this._handledProxyGroup || !record.proxyGroupId) {
                            this._handler.cancelAll();
                            this._clearList();
                            this._handledProxyGroup = null;
                        }
                    }
                }
                if (canned) {
                    this._templating.addFileToCache(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.updateThumbnail(id, this._thumbnailUrls[id], true, this._options.thumbnails.customResizer);
                } else {
                    this._templating.addFile(id, this._options.formatFileName(name), prependData, dontDisplay);
                    this._templating.generatePreview(id, this.getFile(id), this._options.thumbnails.customResizer);
                }
                this._filesInBatchAddedToUi += 1;
                if (canned || this._options.display.fileSizeOnSubmit && qq.supportedFeatures.ajaxUploading) {
                    this._displayFileSize(id);
                }
            },
            _clearList: function() {
                this._templating.clearFiles();
                this.clearStoredFiles();
            },
            _displayFileSize: function(id, loadedSize, totalSize) {
                var size = this.getSize(id), sizeForDisplay = this._formatSize(size);
                if (size >= 0) {
                    if (loadedSize !== undefined && totalSize !== undefined) {
                        sizeForDisplay = this._formatProgress(loadedSize, totalSize);
                    }
                    this._templating.updateSize(id, sizeForDisplay);
                }
            },
            _formatProgress: function(uploadedSize, totalSize) {
                var message = this._options.text.formatProgress;
                function r(name, replacement) {
                    message = message.replace(name, replacement);
                }
                r("{percent}", Math.round(uploadedSize / totalSize * 100));
                r("{total_size}", this._formatSize(totalSize));
                return message;
            },
            _controlFailureTextDisplay: function(id, response) {
                var mode, responseProperty, failureReason;
                mode = this._options.failedUploadTextDisplay.mode;
                responseProperty = this._options.failedUploadTextDisplay.responseProperty;
                if (mode === "custom") {
                    failureReason = response[responseProperty];
                    if (!failureReason) {
                        failureReason = this._options.text.failUpload;
                    }
                    this._templating.setStatusText(id, failureReason);
                    if (this._options.failedUploadTextDisplay.enableTooltip) {
                        this._showTooltip(id, failureReason);
                    }
                } else if (mode === "default") {
                    this._templating.setStatusText(id, this._options.text.failUpload);
                } else if (mode !== "none") {
                    this.log("failedUploadTextDisplay.mode value of '" + mode + "' is not valid", "warn");
                }
            },
            _showTooltip: function(id, text) {
                this._templating.getFileContainer(id).title = text;
            },
            _showCancelLink: function(id) {
                if (!this._options.disableCancelForFormUploads || qq.supportedFeatures.ajaxUploading) {
                    this._templating.showCancel(id);
                }
            },
            _itemError: function(code, name, item) {
                var message = this._parent.prototype._itemError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _batchError: function(message) {
                this._parent.prototype._batchError.apply(this, arguments);
                this._options.showMessage(message);
            },
            _setupPastePrompt: function() {
                var self = this;
                this._options.callbacks.onPasteReceived = function() {
                    var message = self._options.paste.namePromptMessage, defaultVal = self._options.paste.defaultName;
                    return self._options.showPrompt(message, defaultVal);
                };
            },
            _fileOrBlobRejected: function(id, name) {
                this._totalFilesInBatch -= 1;
                this._parent.prototype._fileOrBlobRejected.apply(this, arguments);
            },
            _prepareItemsForUpload: function(items, params, endpoint) {
                this._totalFilesInBatch = items.length;
                this._filesInBatchAddedToUi = 0;
                this._parent.prototype._prepareItemsForUpload.apply(this, arguments);
            },
            _maybeUpdateThumbnail: function(fileId) {
                var thumbnailUrl = this._thumbnailUrls[fileId], fileStatus = this.getUploads({
                    id: fileId
                }).status;
                if (fileStatus !== qq.status.DELETED && (thumbnailUrl || this._options.thumbnails.placeholders.waitUntilResponse || !qq.supportedFeatures.imagePreviews)) {
                    this._templating.updateThumbnail(fileId, thumbnailUrl, this._options.thumbnails.customResizer);
                }
            },
            _addCannedFile: function(sessionData) {
                var id = this._parent.prototype._addCannedFile.apply(this, arguments);
                this._addToList(id, this.getName(id), true);
                this._templating.hideSpinner(id);
                this._templating.hideCancel(id);
                this._markFileAsSuccessful(id);
                return id;
            },
            _setSize: function(id, newSize) {
                this._parent.prototype._setSize.apply(this, arguments);
                this._templating.updateSize(id, this._formatSize(newSize));
            },
            _sessionRequestComplete: function() {
                this._templating.addCacheToDom();
                this._parent.prototype._sessionRequestComplete.apply(this, arguments);
            }
        };
    })();
    qq.FineUploader = function(o, namespace) {
        "use strict";
        var self = this;
        this._parent = namespace ? qq[namespace].FineUploaderBasic : qq.FineUploaderBasic;
        this._parent.apply(this, arguments);
        qq.extend(this._options, {
            element: null,
            button: null,
            listElement: null,
            dragAndDrop: {
                extraDropzones: [],
                reportDirectoryPaths: false
            },
            text: {
                formatProgress: "{percent}% of {total_size}",
                failUpload: "Upload failed",
                waitingForResponse: "Processing...",
                paused: "Paused"
            },
            template: "qq-template",
            classes: {
                retrying: "qq-upload-retrying",
                retryable: "qq-upload-retryable",
                success: "qq-upload-success",
                fail: "qq-upload-fail",
                editable: "qq-editable",
                hide: "qq-hide",
                dropActive: "qq-upload-drop-area-active"
            },
            failedUploadTextDisplay: {
                mode: "default",
                responseProperty: "error",
                enableTooltip: true
            },
            messages: {
                tooManyFilesError: "You may only drop one file",
                unsupportedBrowser: "Unrecoverable error - this browser does not permit file uploading of any kind."
            },
            retry: {
                showAutoRetryNote: true,
                autoRetryNote: "Retrying {retryNum}/{maxAuto}..."
            },
            deleteFile: {
                forceConfirm: false,
                confirmMessage: "Are you sure you want to delete {filename}?",
                deletingStatusText: "Deleting...",
                deletingFailedText: "Delete failed"
            },
            display: {
                fileSizeOnSubmit: false,
                prependFiles: false
            },
            paste: {
                promptForName: false,
                namePromptMessage: "Please name this image"
            },
            thumbnails: {
                customResizer: null,
                maxCount: 0,
                placeholders: {
                    waitUntilResponse: false,
                    notAvailablePath: null,
                    waitingPath: null
                },
                timeBetweenThumbs: 750
            },
            scaling: {
                hideScaled: false
            },
            showMessage: function(message) {
                if (self._templating.hasDialog("alert")) {
                    return self._templating.showDialog("alert", message);
                } else {
                    setTimeout(function() {
                        window.alert(message);
                    }, 0);
                }
            },
            showConfirm: function(message) {
                if (self._templating.hasDialog("confirm")) {
                    return self._templating.showDialog("confirm", message);
                } else {
                    return window.confirm(message);
                }
            },
            showPrompt: function(message, defaultValue) {
                if (self._templating.hasDialog("prompt")) {
                    return self._templating.showDialog("prompt", message, defaultValue);
                } else {
                    return window.prompt(message, defaultValue);
                }
            }
        }, true);
        qq.extend(this._options, o, true);
        this._templating = new qq.Templating({
            log: qq.bind(this.log, this),
            templateIdOrEl: this._options.template,
            containerEl: this._options.element,
            fileContainerEl: this._options.listElement,
            button: this._options.button,
            imageGenerator: this._imageGenerator,
            classes: {
                hide: this._options.classes.hide,
                editable: this._options.classes.editable
            },
            limits: {
                maxThumbs: this._options.thumbnails.maxCount,
                timeBetweenThumbs: this._options.thumbnails.timeBetweenThumbs
            },
            placeholders: {
                waitUntilUpdate: this._options.thumbnails.placeholders.waitUntilResponse,
                thumbnailNotAvailable: this._options.thumbnails.placeholders.notAvailablePath,
                waitingForThumbnail: this._options.thumbnails.placeholders.waitingPath
            },
            text: this._options.text
        });
        if (this._options.workarounds.ios8SafariUploads && qq.ios800() && qq.iosSafari()) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari);
        } else if (!qq.supportedFeatures.uploading || this._options.cors.expected && !qq.supportedFeatures.uploadCors) {
            this._templating.renderFailure(this._options.messages.unsupportedBrowser);
        } else {
            this._wrapCallbacks();
            this._templating.render();
            this._classes = this._options.classes;
            if (!this._options.button && this._templating.getButton()) {
                this._defaultButtonId = this._createUploadButton({
                    element: this._templating.getButton(),
                    title: this._options.text.fileInputTitle
                }).getButtonId();
            }
            this._setupClickAndEditEventHandlers();
            if (qq.DragAndDrop && qq.supportedFeatures.fileDrop) {
                this._dnd = this._setupDragAndDrop();
            }
            if (this._options.paste.targetElement && this._options.paste.promptForName) {
                if (qq.PasteSupport) {
                    this._setupPastePrompt();
                } else {
                    this.log("Paste support module not found.", "error");
                }
            }
            this._totalFilesInBatch = 0;
            this._filesInBatchAddedToUi = 0;
        }
    };
    qq.extend(qq.FineUploader.prototype, qq.basePublicApi);
    qq.extend(qq.FineUploader.prototype, qq.basePrivateApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPublicApi);
    qq.extend(qq.FineUploader.prototype, qq.uiPrivateApi);
    qq.Templating = function(spec) {
        "use strict";
        var FILE_ID_ATTR = "qq-file-id", FILE_CLASS_PREFIX = "qq-file-id-", THUMBNAIL_MAX_SIZE_ATTR = "qq-max-size", THUMBNAIL_SERVER_SCALE_ATTR = "qq-server-scale", HIDE_DROPZONE_ATTR = "qq-hide-dropzone", DROPZPONE_TEXT_ATTR = "qq-drop-area-text", IN_PROGRESS_CLASS = "qq-in-progress", HIDDEN_FOREVER_CLASS = "qq-hidden-forever", fileBatch = {
            content: document.createDocumentFragment(),
            map: {}
        }, isCancelDisabled = false, generatedThumbnails = 0, thumbnailQueueMonitorRunning = false, thumbGenerationQueue = [], thumbnailMaxSize = -1, options = {
            log: null,
            limits: {
                maxThumbs: 0,
                timeBetweenThumbs: 750
            },
            templateIdOrEl: "qq-template",
            containerEl: null,
            fileContainerEl: null,
            button: null,
            imageGenerator: null,
            classes: {
                hide: "qq-hide",
                editable: "qq-editable"
            },
            placeholders: {
                waitUntilUpdate: false,
                thumbnailNotAvailable: null,
                waitingForThumbnail: null
            },
            text: {
                paused: "Paused"
            }
        }, selectorClasses = {
            button: "qq-upload-button-selector",
            alertDialog: "qq-alert-dialog-selector",
            dialogCancelButton: "qq-cancel-button-selector",
            confirmDialog: "qq-confirm-dialog-selector",
            dialogMessage: "qq-dialog-message-selector",
            dialogOkButton: "qq-ok-button-selector",
            promptDialog: "qq-prompt-dialog-selector",
            uploader: "qq-uploader-selector",
            drop: "qq-upload-drop-area-selector",
            list: "qq-upload-list-selector",
            progressBarContainer: "qq-progress-bar-container-selector",
            progressBar: "qq-progress-bar-selector",
            totalProgressBarContainer: "qq-total-progress-bar-container-selector",
            totalProgressBar: "qq-total-progress-bar-selector",
            file: "qq-upload-file-selector",
            spinner: "qq-upload-spinner-selector",
            size: "qq-upload-size-selector",
            cancel: "qq-upload-cancel-selector",
            pause: "qq-upload-pause-selector",
            continueButton: "qq-upload-continue-selector",
            deleteButton: "qq-upload-delete-selector",
            retry: "qq-upload-retry-selector",
            statusText: "qq-upload-status-text-selector",
            editFilenameInput: "qq-edit-filename-selector",
            editNameIcon: "qq-edit-filename-icon-selector",
            dropText: "qq-upload-drop-area-text-selector",
            dropProcessing: "qq-drop-processing-selector",
            dropProcessingSpinner: "qq-drop-processing-spinner-selector",
            thumbnail: "qq-thumbnail-selector"
        }, previewGeneration = {}, cachedThumbnailNotAvailableImg = new qq.Promise(), cachedWaitingForThumbnailImg = new qq.Promise(), log, isEditElementsExist, isRetryElementExist, templateDom, container, fileList, showThumbnails, serverScale, cacheThumbnailPlaceholders = function() {
            var notAvailableUrl = options.placeholders.thumbnailNotAvailable, waitingUrl = options.placeholders.waitingForThumbnail, spec = {
                maxSize: thumbnailMaxSize,
                scale: serverScale
            };
            if (showThumbnails) {
                if (notAvailableUrl) {
                    options.imageGenerator.generate(notAvailableUrl, new Image(), spec).then(function(updatedImg) {
                        cachedThumbnailNotAvailableImg.success(updatedImg);
                    }, function() {
                        cachedThumbnailNotAvailableImg.failure();
                        log("Problem loading 'not available' placeholder image at " + notAvailableUrl, "error");
                    });
                } else {
                    cachedThumbnailNotAvailableImg.failure();
                }
                if (waitingUrl) {
                    options.imageGenerator.generate(waitingUrl, new Image(), spec).then(function(updatedImg) {
                        cachedWaitingForThumbnailImg.success(updatedImg);
                    }, function() {
                        cachedWaitingForThumbnailImg.failure();
                        log("Problem loading 'waiting for thumbnail' placeholder image at " + waitingUrl, "error");
                    });
                } else {
                    cachedWaitingForThumbnailImg.failure();
                }
            }
        }, displayWaitingImg = function(thumbnail) {
            var waitingImgPlacement = new qq.Promise();
            cachedWaitingForThumbnailImg.then(function(img) {
                maybeScalePlaceholderViaCss(img, thumbnail);
                if (!thumbnail.src) {
                    thumbnail.src = img.src;
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        show(thumbnail);
                        waitingImgPlacement.success();
                    };
                } else {
                    waitingImgPlacement.success();
                }
            }, function() {
                hide(thumbnail);
                waitingImgPlacement.success();
            });
            return waitingImgPlacement;
        }, generateNewPreview = function(id, blob, spec) {
            var thumbnail = getThumbnail(id);
            log("Generating new thumbnail for " + id);
            blob.qqThumbnailId = id;
            return options.imageGenerator.generate(blob, thumbnail, spec).then(function() {
                generatedThumbnails++;
                show(thumbnail);
                previewGeneration[id].success();
            }, function() {
                previewGeneration[id].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                }
            });
        }, generateNextQueuedPreview = function() {
            if (thumbGenerationQueue.length) {
                thumbnailQueueMonitorRunning = true;
                var queuedThumbRequest = thumbGenerationQueue.shift();
                if (queuedThumbRequest.update) {
                    processUpdateQueuedPreviewRequest(queuedThumbRequest);
                } else {
                    processNewQueuedPreviewRequest(queuedThumbRequest);
                }
            } else {
                thumbnailQueueMonitorRunning = false;
            }
        }, getCancel = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.cancel);
        }, getContinue = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.continueButton);
        }, getDialog = function(type) {
            return getTemplateEl(container, selectorClasses[type + "Dialog"]);
        }, getDelete = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.deleteButton);
        }, getDropProcessing = function() {
            return getTemplateEl(container, selectorClasses.dropProcessing);
        }, getEditIcon = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.editNameIcon);
        }, getFile = function(id) {
            return fileBatch.map[id] || qq(fileList).getFirstByClass(FILE_CLASS_PREFIX + id);
        }, getFilename = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.file);
        }, getPause = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.pause);
        }, getProgress = function(id) {
            if (id == null) {
                return getTemplateEl(container, selectorClasses.totalProgressBarContainer) || getTemplateEl(container, selectorClasses.totalProgressBar);
            }
            return getTemplateEl(getFile(id), selectorClasses.progressBarContainer) || getTemplateEl(getFile(id), selectorClasses.progressBar);
        }, getRetry = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.retry);
        }, getSize = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.size);
        }, getSpinner = function(id) {
            return getTemplateEl(getFile(id), selectorClasses.spinner);
        }, getTemplateEl = function(context, cssClass) {
            return context && qq(context).getFirstByClass(cssClass);
        }, getThumbnail = function(id) {
            return showThumbnails && getTemplateEl(getFile(id), selectorClasses.thumbnail);
        }, hide = function(el) {
            el && qq(el).addClass(options.classes.hide);
        }, maybeScalePlaceholderViaCss = function(placeholder, thumbnail) {
            var maxWidth = placeholder.style.maxWidth, maxHeight = placeholder.style.maxHeight;
            if (maxHeight && maxWidth && !thumbnail.style.maxWidth && !thumbnail.style.maxHeight) {
                qq(thumbnail).css({
                    maxWidth: maxWidth,
                    maxHeight: maxHeight
                });
            }
        }, maybeSetDisplayNotAvailableImg = function(id, thumbnail) {
            var previewing = previewGeneration[id] || new qq.Promise().failure(), notAvailableImgPlacement = new qq.Promise();
            cachedThumbnailNotAvailableImg.then(function(img) {
                previewing.then(function() {
                    notAvailableImgPlacement.success();
                }, function() {
                    maybeScalePlaceholderViaCss(img, thumbnail);
                    thumbnail.onload = function() {
                        thumbnail.onload = null;
                        notAvailableImgPlacement.success();
                    };
                    thumbnail.src = img.src;
                    show(thumbnail);
                });
            });
            return notAvailableImgPlacement;
        }, parseAndGetTemplate = function() {
            var scriptEl, scriptHtml, fileListNode, tempTemplateEl, fileListEl, defaultButton, dropArea, thumbnail, dropProcessing, dropTextEl, uploaderEl;
            log("Parsing template");
            if (options.templateIdOrEl == null) {
                throw new Error("You MUST specify either a template element or ID!");
            }
            if (qq.isString(options.templateIdOrEl)) {
                scriptEl = document.getElementById(options.templateIdOrEl);
                if (scriptEl === null) {
                    throw new Error(qq.format("Cannot find template script at ID '{}'!", options.templateIdOrEl));
                }
                scriptHtml = scriptEl.innerHTML;
            } else {
                if (options.templateIdOrEl.innerHTML === undefined) {
                    throw new Error("You have specified an invalid value for the template option!  " + "It must be an ID or an Element.");
                }
                scriptHtml = options.templateIdOrEl.innerHTML;
            }
            scriptHtml = qq.trimStr(scriptHtml);
            tempTemplateEl = document.createElement("div");
            tempTemplateEl.appendChild(qq.toElement(scriptHtml));
            uploaderEl = qq(tempTemplateEl).getFirstByClass(selectorClasses.uploader);
            if (options.button) {
                defaultButton = qq(tempTemplateEl).getFirstByClass(selectorClasses.button);
                if (defaultButton) {
                    qq(defaultButton).remove();
                }
            }
            if (!qq.DragAndDrop || !qq.supportedFeatures.fileDrop) {
                dropProcessing = qq(tempTemplateEl).getFirstByClass(selectorClasses.dropProcessing);
                if (dropProcessing) {
                    qq(dropProcessing).remove();
                }
            }
            dropArea = qq(tempTemplateEl).getFirstByClass(selectorClasses.drop);
            if (dropArea && !qq.DragAndDrop) {
                log("DnD module unavailable.", "info");
                qq(dropArea).remove();
            }
            if (!qq.supportedFeatures.fileDrop) {
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (dropArea && qq(dropArea).hasAttribute(HIDE_DROPZONE_ATTR)) {
                    qq(dropArea).css({
                        display: "none"
                    });
                }
            } else if (qq(uploaderEl).hasAttribute(DROPZPONE_TEXT_ATTR) && dropArea) {
                dropTextEl = qq(dropArea).getFirstByClass(selectorClasses.dropText);
                dropTextEl && qq(dropTextEl).remove();
            }
            thumbnail = qq(tempTemplateEl).getFirstByClass(selectorClasses.thumbnail);
            if (!showThumbnails) {
                thumbnail && qq(thumbnail).remove();
            } else if (thumbnail) {
                thumbnailMaxSize = parseInt(thumbnail.getAttribute(THUMBNAIL_MAX_SIZE_ATTR));
                thumbnailMaxSize = thumbnailMaxSize > 0 ? thumbnailMaxSize : null;
                serverScale = qq(thumbnail).hasAttribute(THUMBNAIL_SERVER_SCALE_ATTR);
            }
            showThumbnails = showThumbnails && thumbnail;
            isEditElementsExist = qq(tempTemplateEl).getByClass(selectorClasses.editFilenameInput).length > 0;
            isRetryElementExist = qq(tempTemplateEl).getByClass(selectorClasses.retry).length > 0;
            fileListNode = qq(tempTemplateEl).getFirstByClass(selectorClasses.list);
            if (fileListNode == null) {
                throw new Error("Could not find the file list container in the template!");
            }
            fileListEl = fileListNode.children[0].cloneNode(true);
            fileListNode.innerHTML = "";
            if (tempTemplateEl.getElementsByTagName("DIALOG").length) {
                document.createElement("dialog");
            }
            log("Template parsing complete");
            return {
                template: tempTemplateEl,
                fileTemplate: fileListEl
            };
        }, prependFile = function(el, index, fileList) {
            var parentEl = fileList, beforeEl = parentEl.firstChild;
            if (index > 0) {
                beforeEl = qq(parentEl).children()[index].nextSibling;
            }
            parentEl.insertBefore(el, beforeEl);
        }, processNewQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, optFileOrBlob = queuedThumbRequest.optFileOrBlob, relatedThumbnailId = optFileOrBlob && optFileOrBlob.qqThumbnailId, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                maxSize: thumbnailMaxSize,
                orient: true,
                scale: true
            };
            if (qq.supportedFeatures.imagePreviews) {
                if (thumbnail) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        displayWaitingImg(thumbnail).done(function() {
                            previewGeneration[id] = new qq.Promise();
                            previewGeneration[id].done(function() {
                                setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                            });
                            if (relatedThumbnailId != null) {
                                useCachedPreview(id, relatedThumbnailId);
                            } else {
                                generateNewPreview(id, optFileOrBlob, spec);
                            }
                        });
                    }
                } else {
                    generateNextQueuedPreview();
                }
            } else if (thumbnail) {
                displayWaitingImg(thumbnail);
                generateNextQueuedPreview();
            }
        }, processUpdateQueuedPreviewRequest = function(queuedThumbRequest) {
            var id = queuedThumbRequest.id, thumbnailUrl = queuedThumbRequest.thumbnailUrl, showWaitingImg = queuedThumbRequest.showWaitingImg, thumbnail = getThumbnail(id), spec = {
                customResizeFunction: queuedThumbRequest.customResizeFunction,
                scale: serverScale,
                maxSize: thumbnailMaxSize
            };
            if (thumbnail) {
                if (thumbnailUrl) {
                    if (options.limits.maxThumbs && options.limits.maxThumbs <= generatedThumbnails) {
                        maybeSetDisplayNotAvailableImg(id, thumbnail);
                        generateNextQueuedPreview();
                    } else {
                        if (showWaitingImg) {
                            displayWaitingImg(thumbnail);
                        }
                        return options.imageGenerator.generate(thumbnailUrl, thumbnail, spec).then(function() {
                            show(thumbnail);
                            generatedThumbnails++;
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        }, function() {
                            maybeSetDisplayNotAvailableImg(id, thumbnail);
                            setTimeout(generateNextQueuedPreview, options.limits.timeBetweenThumbs);
                        });
                    }
                } else {
                    maybeSetDisplayNotAvailableImg(id, thumbnail);
                    generateNextQueuedPreview();
                }
            }
        }, setProgressBarWidth = function(id, percent) {
            var bar = getProgress(id), progressBarSelector = id == null ? selectorClasses.totalProgressBar : selectorClasses.progressBar;
            if (bar && !qq(bar).hasClass(progressBarSelector)) {
                bar = qq(bar).getFirstByClass(progressBarSelector);
            }
            if (bar) {
                qq(bar).css({
                    width: percent + "%"
                });
                bar.setAttribute("aria-valuenow", percent);
            }
        }, show = function(el) {
            el && qq(el).removeClass(options.classes.hide);
        }, useCachedPreview = function(targetThumbnailId, cachedThumbnailId) {
            var targetThumbnail = getThumbnail(targetThumbnailId), cachedThumbnail = getThumbnail(cachedThumbnailId);
            log(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.", targetThumbnailId, cachedThumbnailId, cachedThumbnailId));
            previewGeneration[cachedThumbnailId].then(function() {
                generatedThumbnails++;
                previewGeneration[targetThumbnailId].success();
                log(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.", cachedThumbnailId, targetThumbnailId));
                targetThumbnail.src = cachedThumbnail.src;
                show(targetThumbnail);
            }, function() {
                previewGeneration[targetThumbnailId].failure();
                if (!options.placeholders.waitUntilUpdate) {
                    maybeSetDisplayNotAvailableImg(targetThumbnailId, targetThumbnail);
                }
            });
        };
        qq.extend(options, spec);
        log = options.log;
        if (!qq.supportedFeatures.imagePreviews) {
            options.limits.timeBetweenThumbs = 0;
            options.limits.maxThumbs = 0;
        }
        container = options.containerEl;
        showThumbnails = options.imageGenerator !== undefined;
        templateDom = parseAndGetTemplate();
        cacheThumbnailPlaceholders();
        qq.extend(this, {
            render: function() {
                log("Rendering template in DOM.");
                generatedThumbnails = 0;
                container.appendChild(templateDom.template.cloneNode(true));
                hide(getDropProcessing());
                this.hideTotalProgress();
                fileList = options.fileContainerEl || getTemplateEl(container, selectorClasses.list);
                log("Template rendering complete");
            },
            renderFailure: function(message) {
                var cantRenderEl = qq.toElement(message);
                container.innerHTML = "";
                container.appendChild(cantRenderEl);
            },
            reset: function() {
                container.innerHTML = "";
                this.render();
            },
            clearFiles: function() {
                fileList.innerHTML = "";
            },
            disableCancel: function() {
                isCancelDisabled = true;
            },
            addFile: function(id, name, prependInfo, hideForever, batch) {
                var fileEl = templateDom.fileTemplate.cloneNode(true), fileNameEl = getTemplateEl(fileEl, selectorClasses.file), uploaderEl = getTemplateEl(container, selectorClasses.uploader), fileContainer = batch ? fileBatch.content : fileList, thumb;
                if (batch) {
                    fileBatch.map[id] = fileEl;
                }
                qq(fileEl).addClass(FILE_CLASS_PREFIX + id);
                uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR);
                if (fileNameEl) {
                    qq(fileNameEl).setText(name);
                    fileNameEl.setAttribute("title", name);
                }
                fileEl.setAttribute(FILE_ID_ATTR, id);
                if (prependInfo) {
                    prependFile(fileEl, prependInfo.index, fileContainer);
                } else {
                    fileContainer.appendChild(fileEl);
                }
                if (hideForever) {
                    fileEl.style.display = "none";
                    qq(fileEl).addClass(HIDDEN_FOREVER_CLASS);
                } else {
                    hide(getProgress(id));
                    hide(getSize(id));
                    hide(getDelete(id));
                    hide(getRetry(id));
                    hide(getPause(id));
                    hide(getContinue(id));
                    if (isCancelDisabled) {
                        this.hideCancel(id);
                    }
                    thumb = getThumbnail(id);
                    if (thumb && !thumb.src) {
                        cachedWaitingForThumbnailImg.then(function(waitingImg) {
                            thumb.src = waitingImg.src;
                            if (waitingImg.style.maxHeight && waitingImg.style.maxWidth) {
                                qq(thumb).css({
                                    maxHeight: waitingImg.style.maxHeight,
                                    maxWidth: waitingImg.style.maxWidth
                                });
                            }
                            show(thumb);
                        });
                    }
                }
            },
            addFileToCache: function(id, name, prependInfo, hideForever) {
                this.addFile(id, name, prependInfo, hideForever, true);
            },
            addCacheToDom: function() {
                fileList.appendChild(fileBatch.content);
                fileBatch.content = document.createDocumentFragment();
                fileBatch.map = {};
            },
            removeFile: function(id) {
                qq(getFile(id)).remove();
            },
            getFileId: function(el) {
                var currentNode = el;
                if (currentNode) {
                    while (currentNode.getAttribute(FILE_ID_ATTR) == null) {
                        currentNode = currentNode.parentNode;
                    }
                    return parseInt(currentNode.getAttribute(FILE_ID_ATTR));
                }
            },
            getFileList: function() {
                return fileList;
            },
            markFilenameEditable: function(id) {
                var filename = getFilename(id);
                filename && qq(filename).addClass(options.classes.editable);
            },
            updateFilename: function(id, name) {
                var filenameEl = getFilename(id);
                if (filenameEl) {
                    qq(filenameEl).setText(name);
                    filenameEl.setAttribute("title", name);
                }
            },
            hideFilename: function(id) {
                hide(getFilename(id));
            },
            showFilename: function(id) {
                show(getFilename(id));
            },
            isFileName: function(el) {
                return qq(el).hasClass(selectorClasses.file);
            },
            getButton: function() {
                return options.button || getTemplateEl(container, selectorClasses.button);
            },
            hideDropProcessing: function() {
                hide(getDropProcessing());
            },
            showDropProcessing: function() {
                show(getDropProcessing());
            },
            getDropZone: function() {
                return getTemplateEl(container, selectorClasses.drop);
            },
            isEditFilenamePossible: function() {
                return isEditElementsExist;
            },
            hideRetry: function(id) {
                hide(getRetry(id));
            },
            isRetryPossible: function() {
                return isRetryElementExist;
            },
            showRetry: function(id) {
                show(getRetry(id));
            },
            getFileContainer: function(id) {
                return getFile(id);
            },
            showEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).addClass(options.classes.editable);
            },
            isHiddenForever: function(id) {
                return qq(getFile(id)).hasClass(HIDDEN_FOREVER_CLASS);
            },
            hideEditIcon: function(id) {
                var icon = getEditIcon(id);
                icon && qq(icon).removeClass(options.classes.editable);
            },
            isEditIcon: function(el) {
                return qq(el).hasClass(selectorClasses.editNameIcon, true);
            },
            getEditInput: function(id) {
                return getTemplateEl(getFile(id), selectorClasses.editFilenameInput);
            },
            isEditInput: function(el) {
                return qq(el).hasClass(selectorClasses.editFilenameInput, true);
            },
            updateProgress: function(id, loaded, total) {
                var bar = getProgress(id), percent;
                if (bar && total > 0) {
                    percent = Math.round(loaded / total * 100);
                    if (percent === 100) {
                        hide(bar);
                    } else {
                        show(bar);
                    }
                    setProgressBarWidth(id, percent);
                }
            },
            updateTotalProgress: function(loaded, total) {
                this.updateProgress(null, loaded, total);
            },
            hideProgress: function(id) {
                var bar = getProgress(id);
                bar && hide(bar);
            },
            hideTotalProgress: function() {
                this.hideProgress();
            },
            resetProgress: function(id) {
                setProgressBarWidth(id, 0);
                this.hideTotalProgress(id);
            },
            resetTotalProgress: function() {
                this.resetProgress();
            },
            showCancel: function(id) {
                if (!isCancelDisabled) {
                    var cancel = getCancel(id);
                    cancel && qq(cancel).removeClass(options.classes.hide);
                }
            },
            hideCancel: function(id) {
                hide(getCancel(id));
            },
            isCancel: function(el) {
                return qq(el).hasClass(selectorClasses.cancel, true);
            },
            allowPause: function(id) {
                show(getPause(id));
                hide(getContinue(id));
            },
            uploadPaused: function(id) {
                this.setStatusText(id, options.text.paused);
                this.allowContinueButton(id);
                hide(getSpinner(id));
            },
            hidePause: function(id) {
                hide(getPause(id));
            },
            isPause: function(el) {
                return qq(el).hasClass(selectorClasses.pause, true);
            },
            isContinueButton: function(el) {
                return qq(el).hasClass(selectorClasses.continueButton, true);
            },
            allowContinueButton: function(id) {
                show(getContinue(id));
                hide(getPause(id));
            },
            uploadContinued: function(id) {
                this.setStatusText(id, "");
                this.allowPause(id);
                show(getSpinner(id));
            },
            showDeleteButton: function(id) {
                show(getDelete(id));
            },
            hideDeleteButton: function(id) {
                hide(getDelete(id));
            },
            isDeleteButton: function(el) {
                return qq(el).hasClass(selectorClasses.deleteButton, true);
            },
            isRetry: function(el) {
                return qq(el).hasClass(selectorClasses.retry, true);
            },
            updateSize: function(id, text) {
                var size = getSize(id);
                if (size) {
                    show(size);
                    qq(size).setText(text);
                }
            },
            setStatusText: function(id, text) {
                var textEl = getTemplateEl(getFile(id), selectorClasses.statusText);
                if (textEl) {
                    if (text == null) {
                        qq(textEl).clearText();
                    } else {
                        qq(textEl).setText(text);
                    }
                }
            },
            hideSpinner: function(id) {
                qq(getFile(id)).removeClass(IN_PROGRESS_CLASS);
                hide(getSpinner(id));
            },
            showSpinner: function(id) {
                qq(getFile(id)).addClass(IN_PROGRESS_CLASS);
                show(getSpinner(id));
            },
            generatePreview: function(id, optFileOrBlob, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        id: id,
                        customResizeFunction: customResizeFunction,
                        optFileOrBlob: optFileOrBlob
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            updateThumbnail: function(id, thumbnailUrl, showWaitingImg, customResizeFunction) {
                if (!this.isHiddenForever(id)) {
                    thumbGenerationQueue.push({
                        customResizeFunction: customResizeFunction,
                        update: true,
                        id: id,
                        thumbnailUrl: thumbnailUrl,
                        showWaitingImg: showWaitingImg
                    });
                    !thumbnailQueueMonitorRunning && generateNextQueuedPreview();
                }
            },
            hasDialog: function(type) {
                return qq.supportedFeatures.dialogElement && !!getDialog(type);
            },
            showDialog: function(type, message, defaultValue) {
                var dialog = getDialog(type), messageEl = getTemplateEl(dialog, selectorClasses.dialogMessage), inputEl = dialog.getElementsByTagName("INPUT")[0], cancelBtn = getTemplateEl(dialog, selectorClasses.dialogCancelButton), okBtn = getTemplateEl(dialog, selectorClasses.dialogOkButton), promise = new qq.Promise(), closeHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    okBtn && okBtn.removeEventListener("click", okClickHandler);
                    promise.failure();
                }, cancelClickHandler = function() {
                    cancelBtn.removeEventListener("click", cancelClickHandler);
                    dialog.close();
                }, okClickHandler = function() {
                    dialog.removeEventListener("close", closeHandler);
                    okBtn.removeEventListener("click", okClickHandler);
                    dialog.close();
                    promise.success(inputEl && inputEl.value);
                };
                dialog.addEventListener("close", closeHandler);
                cancelBtn.addEventListener("click", cancelClickHandler);
                okBtn && okBtn.addEventListener("click", okClickHandler);
                if (inputEl) {
                    inputEl.value = defaultValue;
                }
                messageEl.textContent = message;
                dialog.showModal();
                return promise;
            }
        });
    };
    qq.UiEventHandler = function(s, protectedApi) {
        "use strict";
        var disposer = new qq.DisposeSupport(), spec = {
            eventType: "click",
            attachTo: null,
            onHandled: function(target, event) {}
        };
        qq.extend(this, {
            addHandler: function(element) {
                addHandler(element);
            },
            dispose: function() {
                disposer.dispose();
            }
        });
        function addHandler(element) {
            disposer.attach(element, spec.eventType, function(event) {
                event = event || window.event;
                var target = event.target || event.srcElement;
                spec.onHandled(target, event);
            });
        }
        qq.extend(protectedApi, {
            getFileIdFromItem: function(item) {
                return item.qqFileId;
            },
            getDisposeSupport: function() {
                return disposer;
            }
        });
        qq.extend(spec, s);
        if (spec.attachTo) {
            addHandler(spec.attachTo);
        }
    };
    qq.FileButtonsClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            onDeleteFile: function(fileId) {},
            onCancel: function(fileId) {},
            onRetry: function(fileId) {},
            onPause: function(fileId) {},
            onContinue: function(fileId) {},
            onGetName: function(fileId) {}
        }, buttonHandlers = {
            cancel: function(id) {
                spec.onCancel(id);
            },
            retry: function(id) {
                spec.onRetry(id);
            },
            deleteButton: function(id) {
                spec.onDeleteFile(id);
            },
            pause: function(id) {
                spec.onPause(id);
            },
            continueButton: function(id) {
                spec.onContinue(id);
            }
        };
        function examineEvent(target, event) {
            qq.each(buttonHandlers, function(buttonType, handler) {
                var firstLetterCapButtonType = buttonType.charAt(0).toUpperCase() + buttonType.slice(1), fileId;
                if (spec.templating["is" + firstLetterCapButtonType](target)) {
                    fileId = spec.templating.getFileId(target);
                    qq.preventDefault(event);
                    spec.log(qq.format("Detected valid file button click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    handler(fileId);
                    return false;
                }
            });
        }
        qq.extend(spec, s);
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
    };
    qq.FilenameClickHandler = function(s) {
        "use strict";
        var inheritedInternalApi = {}, spec = {
            templating: null,
            log: function(message, lvl) {},
            classes: {
                file: "qq-upload-file",
                editNameIcon: "qq-edit-filename-icon"
            },
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {}
        };
        qq.extend(spec, s);
        function examineEvent(target, event) {
            if (spec.templating.isFileName(target) || spec.templating.isEditIcon(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename click event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    qq.preventDefault(event);
                    inheritedInternalApi.handleFilenameEdit(fileId, target, true);
                }
            }
        }
        spec.eventType = "click";
        spec.onHandled = examineEvent;
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusInHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            onGetUploadStatus: function(fileId) {},
            log: function(message, lvl) {}
        };
        if (!inheritedInternalApi) {
            inheritedInternalApi = {};
        }
        function handleInputFocus(target, event) {
            if (spec.templating.isEditInput(target)) {
                var fileId = spec.templating.getFileId(target), status = spec.onGetUploadStatus(fileId);
                if (status === qq.status.SUBMITTED) {
                    spec.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.", spec.onGetName(fileId), fileId));
                    inheritedInternalApi.handleFilenameEdit(fileId, target);
                }
            }
        }
        spec.eventType = "focusin";
        spec.onHandled = handleInputFocus;
        qq.extend(spec, s);
        qq.extend(this, new qq.FilenameEditHandler(spec, inheritedInternalApi));
    };
    qq.FilenameInputFocusHandler = function(spec) {
        "use strict";
        spec.eventType = "focus";
        spec.attachTo = null;
        qq.extend(this, new qq.FilenameInputFocusInHandler(spec, {}));
    };
    qq.FilenameEditHandler = function(s, inheritedInternalApi) {
        "use strict";
        var spec = {
            templating: null,
            log: function(message, lvl) {},
            onGetUploadStatus: function(fileId) {},
            onGetName: function(fileId) {},
            onSetName: function(fileId, newName) {},
            onEditingStatusChange: function(fileId, isEditing) {}
        };
        function getFilenameSansExtension(fileId) {
            var filenameSansExt = spec.onGetName(fileId), extIdx = filenameSansExt.lastIndexOf(".");
            if (extIdx > 0) {
                filenameSansExt = filenameSansExt.substr(0, extIdx);
            }
            return filenameSansExt;
        }
        function getOriginalExtension(fileId) {
            var origName = spec.onGetName(fileId);
            return qq.getExtension(origName);
        }
        function handleNameUpdate(newFilenameInputEl, fileId) {
            var newName = newFilenameInputEl.value, origExtension;
            if (newName !== undefined && qq.trimStr(newName).length > 0) {
                origExtension = getOriginalExtension(fileId);
                if (origExtension !== undefined) {
                    newName = newName + "." + origExtension;
                }
                spec.onSetName(fileId, newName);
            }
            spec.onEditingStatusChange(fileId, false);
        }
        function registerInputBlurHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "blur", function() {
                handleNameUpdate(inputEl, fileId);
            });
        }
        function registerInputEnterKeyHandler(inputEl, fileId) {
            inheritedInternalApi.getDisposeSupport().attach(inputEl, "keyup", function(event) {
                var code = event.keyCode || event.which;
                if (code === 13) {
                    handleNameUpdate(inputEl, fileId);
                }
            });
        }
        qq.extend(spec, s);
        spec.attachTo = spec.templating.getFileList();
        qq.extend(this, new qq.UiEventHandler(spec, inheritedInternalApi));
        qq.extend(inheritedInternalApi, {
            handleFilenameEdit: function(id, target, focusInput) {
                var newFilenameInputEl = spec.templating.getEditInput(id);
                spec.onEditingStatusChange(id, true);
                newFilenameInputEl.value = getFilenameSansExtension(id);
                if (focusInput) {
                    newFilenameInputEl.focus();
                }
                registerInputBlurHandler(newFilenameInputEl, id);
                registerInputEnterKeyHandler(newFilenameInputEl, id);
            }
        });
    };
})(window);
//# sourceMappingURL=fine-uploader.js.map

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(18);


/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

var require;var require;!function(f){if(true)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MeteorEmoji=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){!function(global,factory){if(void 0!==exports)factory(module);else{var mod={exports:{}};factory(mod),global.meteorEmoji=mod.exports}}(this,function(module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MeteorEmoji=function(){function MeteorEmoji(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeteorEmoji),this.initiate()}return _createClass(MeteorEmoji,[{key:"initiate",value:function(){var _this=this;document.querySelectorAll('[data-meteor-emoji="true"], [data-meteor-emoji-large="true"]').forEach(function(element){_this.generateElements(element)})}},{key:"generateElements",value:function(emojiInput){var clickLink=function(event){var caretPos=emojiInput.selectionStart;emojiInput.value=emojiInput.value.substring(0,caretPos)+" "+event.target.innerHTML+emojiInput.value.substring(caretPos),emojiPicker.style.display="block","undefined"!=typeof angular&&angular.element(emojiInput).triggerHandler("change")},clickCategory=function(event){emojiInput.selectionStart;emojiPicker.style.display="block";for(var hideUls=emojiPicker.querySelectorAll("ul"),i=1,l=hideUls.length;i<l;i++)hideUls[i].style.display="none";var backgroundToggle=emojiPicker.querySelectorAll(".category a");for(i=0,l=backgroundToggle.length;i<l;i++)backgroundToggle[i].style.background="none";emojiPicker.querySelector("."+event.target.id).style.display="block",emojiPicker.querySelector("#"+event.target.id).style.background="#c2c2c2"};emojiInput.style.width="100%";var emojiContainer=document.createElement("div");emojiContainer.style.position="relative",emojiInput.parentNode.replaceChild(emojiContainer,emojiInput),emojiContainer.appendChild(emojiInput);var emojiPicker=document.createElement("div");emojiPicker.tabIndex=0,emojiInput.hasAttribute("data-meteor-emoji-large")?(emojiPicker.style.zIndex="999",emojiPicker.style.display="block",emojiPicker.style.width="100%",emojiPicker.style.marginBottom="15px"):(emojiPicker.style.position="absolute",emojiPicker.style.right="0px",emojiPicker.style.top="30px",emojiPicker.style.display="none",emojiPicker.style.width="400px"),emojiPicker.style.zIndex="999",emojiPicker.style.overflow="hidden",emojiPicker.style.background="#fff",emojiPicker.style.borderRadius="5px",emojiPicker.style.boxShadow="0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",emojiPicker.style.borderRadius="2px;",emojiPicker.style.marginTop="5px",emojiPicker.style.outline="none";var emojiTrigger=document.createElement("a");emojiTrigger.style.position="absolute",emojiTrigger.style.top="10px",emojiTrigger.style.right="10px",emojiTrigger.style.textDecoration="none",emojiTrigger.setAttribute("href","javascript:void(0)"),emojiTrigger.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 12 14"><path d="M8.9 8.4q-0.3 0.9-1.1 1.5t-1.8 0.6-1.8-0.6-1.1-1.5q-0.1-0.2 0-0.4t0.3-0.2q0.2-0.1 0.4 0t0.2 0.3q0.2 0.6 0.7 1t1.2 0.4 1.2-0.4 0.7-1q0.1-0.2 0.3-0.3t0.4 0 0.3 0.2 0 0.4zM5 5q0 0.4-0.3 0.7t-0.7 0.3-0.7-0.3-0.3-0.7 0.3-0.7 0.7-0.3 0.7 0.3 0.3 0.7zM9 5q0 0.4-0.3 0.7t-0.7 0.3-0.7-0.3-0.3-0.7 0.3-0.7 0.7-0.3 0.7 0.3 0.3 0.7zM11 7q0-1-0.4-1.9t-1.1-1.6-1.6-1.1-1.9-0.4-1.9 0.4-1.6 1.1-1.1 1.6-0.4 1.9 0.4 1.9 1.1 1.6 1.6 1.1 1.9 0.4 1.9-0.4 1.6-1.1 1.1-1.6 0.4-1.9zM12 7q0 1.6-0.8 3t-2.2 2.2-3 0.8-3-0.8-2.2-2.2-0.8-3 0.8-3 2.2-2.2 3-0.8 3 0.8 2.2 2.2 0.8 3z"/></svg>',emojiTrigger.onclick=function(){"none"===emojiPicker.style.display?emojiPicker.style.display="block":"block"===emojiPicker.style.display&&(emojiPicker.style.display="none"),emojiPicker.focus()},emojiInput.hasAttribute("data-meteor-emoji-large")||emojiContainer.appendChild(emojiTrigger),window.addEventListener("click",function(e){emojiInput.hasAttribute("data-meteor-emoji-large")||"block"===emojiPicker.style.display&&(emojiPicker.contains(e.target)||emojiTrigger.contains(e.target)||(emojiPicker.style.display="none"))});var facesCategory=document.createElement("ul");facesCategory.style.padding="10px 0px",facesCategory.style.margin="0",facesCategory.style.listStyle="none",facesCategory.style.textAlign="left",facesCategory.style.marginLeft="3%",facesCategory.classList.add("faces");var animalsCategory=document.createElement("ul");animalsCategory.style.padding="10px 0px",animalsCategory.style.margin="0",animalsCategory.style.listStyle="none",animalsCategory.style.textAlign="left",animalsCategory.style.marginLeft="3%",animalsCategory.classList.add("animals"),animalsCategory.style.display="none";var foodCategory=document.createElement("ul");foodCategory.style.padding="10px 0px",foodCategory.style.margin="0",foodCategory.style.listStyle="none",foodCategory.style.textAlign="left",foodCategory.style.marginLeft="3%",foodCategory.classList.add("food"),foodCategory.style.display="none";var sportCategory=document.createElement("ul");sportCategory.style.padding="10px 0px",sportCategory.style.margin="0",sportCategory.style.listStyle="none",sportCategory.style.textAlign="left",sportCategory.style.marginLeft="3%",sportCategory.classList.add("sport"),sportCategory.style.display="none";var transportCategory=document.createElement("ul");transportCategory.style.padding="10px 0px",transportCategory.style.margin="0",transportCategory.style.listStyle="none",transportCategory.style.textAlign="left",transportCategory.style.marginLeft="3%",transportCategory.classList.add("transport"),transportCategory.style.display="none";var objectsCategory=document.createElement("ul");objectsCategory.style.padding="10px 0px",objectsCategory.style.margin="0",objectsCategory.style.listStyle="none",objectsCategory.style.textAlign="left",objectsCategory.style.marginLeft="3%",objectsCategory.classList.add("objects"),objectsCategory.style.display="none";var emojiCategory=document.createElement("ul");emojiCategory.style.padding="0px",emojiCategory.style.margin="0",emojiCategory.style.display="table",emojiCategory.style.width="100%",emojiCategory.style.background="#eff0f1",emojiCategory.style.listStyle="none",emojiCategory.classList.add("category");var emojiCategories=new Array;emojiCategories.push({name:"faces",svg:'<svg id="faces" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="faces" d="M74.34,128.48a53.5,53.5,0,1,1,37.84-15.67,53.16,53.16,0,0,1-37.84,15.67Zm0-97.89a44.4,44.4,0,1,0,31.4,13,44.07,44.07,0,0,0-31.4-13Z"/><path id="faces" d="M74.35,108A33.07,33.07,0,0,1,41.29,75a2.28,2.28,0,0,1,2.27-2.28h0A2.27,2.27,0,0,1,45.83,75a28.52,28.52,0,0,0,57,0,2.27,2.27,0,0,1,4.54,0A33.09,33.09,0,0,1,74.35,108Z"/><path id="faces" d="M58.84,62a6.81,6.81,0,1,0,6.81,6.81A6.81,6.81,0,0,0,58.84,62Z"/><path id="faces" d="M89.87,62a6.81,6.81,0,1,0,6.81,6.81A6.82,6.82,0,0,0,89.87,62Z"/></svg>'}),emojiCategories.push({name:"animals",svg:'<svg id="animals" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="animals" d="M59.9,91.75h0c-22.46,0-41.82-19.34-44.09-44A52.1,52.1,0,0,1,16,36.8a4.51,4.51,0,0,1,2.63-3.62,39.79,39.79,0,0,1,12.74-3.37c23.92-2.15,45.35,17.83,47.74,43.86a52.77,52.77,0,0,1-.15,10.93,4.56,4.56,0,0,1-2.64,3.62,39.67,39.67,0,0,1-12.73,3.36c-1.23.11-2.45.17-3.66.17ZM24.76,40.49a41.29,41.29,0,0,0,.09,6.4C26.7,67,42.09,82.66,59.9,82.67h0c.94,0,1.88,0,2.83-.14a30.39,30.39,0,0,0,7.41-1.62,41.14,41.14,0,0,0-.11-6.4C68.09,53.38,51.11,37.08,32.17,38.86a30.78,30.78,0,0,0-7.41,1.63Z"/><path id="animals" d="M36.68,125.64a4.53,4.53,0,0,1-4.33-3.17,53.32,53.32,0,0,1-2.26-11A50.42,50.42,0,0,1,39.51,76.6c7.35-9.91,17.84-16,29.5-17,1.16-.11,2.33-.13,3.47-.13a4.54,4.54,0,0,1,4.33,3.16,51.59,51.59,0,0,1,2.27,11.08,50.39,50.39,0,0,1-9.42,34.8c-7.35,9.91-17.83,16-29.5,17a17.63,17.63,0,0,1-3.48.12ZM69.09,68.69A32.41,32.41,0,0,0,46.8,82a42.57,42.57,0,0,0-6.71,34.38,32.38,32.38,0,0,0,22.28-13.32A41.35,41.35,0,0,0,70,74.51a39.38,39.38,0,0,0-.94-5.82Z"/><path id="animals" d="M90.27,91.75c-1.22,0-2.43-.06-3.66-.17a39.67,39.67,0,0,1-12.73-3.36,4.57,4.57,0,0,1-2.64-3.61,53.38,53.38,0,0,1-.17-10.93c2.41-26,23.7-46.07,47.76-43.87a39.74,39.74,0,0,1,12.73,3.37,4.57,4.57,0,0,1,2.64,3.62,53.35,53.35,0,0,1,.16,10.92c-2.28,24.69-21.65,44-44.09,44ZM80,80.91a30.57,30.57,0,0,0,7.42,1.62c19.07,1.78,35.92-14.53,37.87-35.64a42.55,42.55,0,0,0,.1-6.4A30.86,30.86,0,0,0,118,38.86C99,37.07,82.06,53.38,80.12,74.51a43.91,43.91,0,0,0-.1,6.4Z"/><path id="animals" d="M113.49,125.64h0c-1.16,0-2.3,0-3.46-.12-23.9-2.21-41.36-25.47-38.94-51.85A53.52,53.52,0,0,1,73.34,62.6a4.55,4.55,0,0,1,4.33-3.16c1.16,0,2.34,0,3.51.13,11.64,1.07,22.11,7.12,29.48,17a50.51,50.51,0,0,1,9.42,34.81,53.51,53.51,0,0,1-2.26,11,4.54,4.54,0,0,1-4.33,3.19ZM81.08,68.69a42.53,42.53,0,0,0-1,5.82c-1.94,21.1,11.45,39.71,29.95,41.88A42.38,42.38,0,0,0,103.36,82,32.42,32.42,0,0,0,81.08,68.69Z"/><path id="animals" d="M75.08,45.45a7.83,7.83,0,1,0,7.83,7.83,7.83,7.83,0,0,0-7.83-7.83Z"/><path id="animals" d="M76.29,51.89a2.26,2.26,0,0,1-2.14-3A46,46,0,0,1,92.82,25.34a2.27,2.27,0,1,1,2.4,3.86A41.4,41.4,0,0,0,78.43,50.39a2.28,2.28,0,0,1-2.14,1.5Z"/><path id="animals" d="M73.87,51.89a2.28,2.28,0,0,1-2.14-1.5A41.35,41.35,0,0,0,54.94,29.2a2.27,2.27,0,0,1,2.39-3.86A46,46,0,0,1,76,48.85a2.28,2.28,0,0,1-1.37,2.91,2.31,2.31,0,0,1-.77.13Z"/></svg>'}),emojiCategories.push({name:"food",svg:'<svg id="food" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="food" d="M104,20.76h.15c15.83.52,24.08,21.48,24.07,32.56.26,12.42-10.72,23.55-24,24.21a3.53,3.53,0,0,1-.46,0c-13.25-.66-24.23-11.8-24-24.3,0-11,8.26-31.95,24.07-32.47Zm0,47.69c8.25-.54,15.3-7.51,15.14-15,0-8.12-6.22-23.1-15.14-23.57-8.9.46-15.14,15.45-15.14,23.48-.14,7.61,6.9,14.59,15.14,15.13Z"/><path id="food" d="M97.19,69.21h.14a4.53,4.53,0,0,1,4.4,4.68l-1.48,46.92a1.59,1.59,0,0,0,.5,1.06,4.6,4.6,0,0,0,3.25,1.19h0a4.57,4.57,0,0,0,3.26-1.2,1.53,1.53,0,0,0,.49-1l-1.48-46.95a4.54,4.54,0,1,1,9.08-.28l1.47,46.91a10.42,10.42,0,0,1-3,7.65,13.65,13.65,0,0,1-9.81,4h0a13.58,13.58,0,0,1-9.79-4,10.42,10.42,0,0,1-3-7.67l1.48-46.89a4.53,4.53,0,0,1,4.53-4.4Z"/><path id="food" d="M41.84,69.21H42a4.53,4.53,0,0,1,4.4,4.68L44.9,120.81a1.57,1.57,0,0,0,.5,1.06,4.6,4.6,0,0,0,3.25,1.19h0a4.51,4.51,0,0,0,3.24-1.19,1.48,1.48,0,0,0,.5-1L50.93,73.89a4.53,4.53,0,0,1,4.39-4.68A4.4,4.4,0,0,1,60,73.61l1.48,46.91a10.49,10.49,0,0,1-3,7.66,13.57,13.57,0,0,1-9.78,4h0a13.59,13.59,0,0,1-9.78-4,10.48,10.48,0,0,1-3-7.67l1.48-46.9a4.54,4.54,0,0,1,4.54-4.4Z"/><path id="food" d="M28.59,20.76a4.54,4.54,0,0,1,4.54,4.54V51a15.52,15.52,0,0,0,31,0V25.3a4.55,4.55,0,0,1,9.09,0V51a24.61,24.61,0,1,1-49.21,0V25.3a4.54,4.54,0,0,1,4.54-4.54Z"/><path id="food" d="M55.34,20.76a4.54,4.54,0,0,1,4.54,4.54v19a4.54,4.54,0,1,1-9.08,0v-19a4.54,4.54,0,0,1,4.54-4.54Z"/><path id="food" d="M42,20.76a4.54,4.54,0,0,1,4.54,4.54v19a4.54,4.54,0,1,1-9.08,0v-19A4.54,4.54,0,0,1,42,20.76Z"/></svg>'}),emojiCategories.push({name:"sport",svg:'<svg id="sport" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="sport" d="M75.35,130.24a53.49,53.49,0,1,1,53.48-53.49,53.55,53.55,0,0,1-53.48,53.49Zm0-97.89a44.41,44.41,0,1,0,44.4,44.4,44.1,44.1,0,0,0-44.4-44.4Z"/><path id="sport" d="M119.24,84.08A51.29,51.29,0,0,1,68,32.86a49.44,49.44,0,0,1,.26-5,2.26,2.26,0,0,1,2-2c1.66-.16,3.34-.25,5-.25a51.26,51.26,0,0,1,51.21,51.21c0,1.71-.09,3.38-.25,5a2.28,2.28,0,0,1-2,2c-1.65.16-3.33.25-5,.25ZM72.64,30.16c-.06.9-.08,1.79-.08,2.7a46.73,46.73,0,0,0,46.68,46.68q1.37,0,2.7-.09c.06-.89.08-1.79.08-2.7A46.72,46.72,0,0,0,75.35,30.08c-.91,0-1.82,0-2.71.08Z"/><path id="sport" d="M75.35,128A51.28,51.28,0,0,1,24.12,76.76c0-1.7.1-3.38.25-5a2.29,2.29,0,0,1,2-2c1.66-.16,3.33-.25,5.05-.25a51.27,51.27,0,0,1,51.21,51.22c0,1.69-.09,3.37-.25,5a2.27,2.27,0,0,1-2,2c-1.66.16-3.32.25-5,.25ZM28.75,74.05c-.05.9-.09,1.8-.09,2.71a46.74,46.74,0,0,0,46.69,46.67c.91,0,1.8,0,2.7-.08,0-.9.08-1.8.08-2.7A46.73,46.73,0,0,0,31.46,74c-.91,0-1.81,0-2.71.08Z"/><polygon id="sport" points="42.69 112.61 39.48 109.4 108 40.88 111.21 44.1 42.69 112.61 42.69 112.61"/></svg>'}),emojiCategories.push({name:"transport",svg:'<svg id="transport" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="transport" d="M120.7,116H31a4.55,4.55,0,0,1-4.54-4.55V54.28A31.82,31.82,0,0,1,58.25,22.49h35.2a31.83,31.83,0,0,1,31.8,31.79v57.15A4.55,4.55,0,0,1,120.7,116Zm-85.16-9.09h80.62V54.28A22.74,22.74,0,0,0,93.45,31.57H58.25A22.74,22.74,0,0,0,35.54,54.28v52.61Z"/><path id="transport" d="M49.35,129.23c-8.53,0-13.62-2.77-13.62-7.41V115.6a4.54,4.54,0,1,1,9.08,0v4.06a21.32,21.32,0,0,0,9.09,0V115.6a4.54,4.54,0,0,1,9.08,0v6.22c0,4.64-5.09,7.41-13.63,7.41Z"/><path id="transport" d="M102.34,129.23c-8.53,0-13.62-2.77-13.62-7.41V115.6a4.54,4.54,0,0,1,9.08,0v4.06a21.28,21.28,0,0,0,9.08,0V115.6a4.55,4.55,0,0,1,9.09,0v6.22c0,4.64-5.09,7.41-13.63,7.41Z"/><path id="transport" d="M97.81,44.83H53.9a4.55,4.55,0,1,1,0-9.09H97.81a4.55,4.55,0,0,1,0,9.09Z"/><path id="transport" d="M54.28,84.2A6.8,6.8,0,1,0,61.07,91a6.8,6.8,0,0,0-6.79-6.8Z"/><path id="transport" d="M97.43,84.2a6.8,6.8,0,1,0,6.79,6.8,6.8,6.8,0,0,0-6.79-6.8Z"/><path id="transport" d="M107.08,81H44.63a6.82,6.82,0,0,1-6.82-6.82V54.28a6.82,6.82,0,0,1,6.82-6.81h62.45a6.82,6.82,0,0,1,6.81,6.81V74.15A6.83,6.83,0,0,1,107.08,81ZM44.63,52a2.28,2.28,0,0,0-2.28,2.27V74.15a2.28,2.28,0,0,0,2.28,2.27h62.45a2.27,2.27,0,0,0,2.27-2.27V54.28A2.27,2.27,0,0,0,107.08,52Z"/></svg>'}),emojiCategories.push({name:"objects",svg:'<svg id="objects" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 150 150"><path id="objects" d="M107.78,129a4.55,4.55,0,0,1-2.67-.87l-30-21.79-30,21.79a4.53,4.53,0,0,1-5.34,0,4.58,4.58,0,0,1-1.65-5.08L49.59,87.82,19.6,66a4.54,4.54,0,0,1,2.67-8.22H59.34L70.8,22.55a4.55,4.55,0,0,1,8.64,0L90.89,57.81H128A4.54,4.54,0,0,1,130.63,66l-30,21.79,11.46,35.25a4.55,4.55,0,0,1-4.32,6ZM75.12,96.2a4.53,4.53,0,0,1,2.67.87l21.35,15.51L91,87.49a4.55,4.55,0,0,1,1.65-5.08L114,66.89H87.59a4.54,4.54,0,0,1-4.32-3.13l-8.15-25.1L67,63.76a4.53,4.53,0,0,1-4.32,3.13H36.25L57.61,82.41a4.54,4.54,0,0,1,1.65,5.08l-8.17,25.09L72.45,97.07a4.53,4.53,0,0,1,2.67-.87Z"/></svg>'});emojiCategories.map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.padding="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.style.display="table-cell",emojiLink.style.textAlign="center",emojiLink.id=String(item.name),"faces"==String(item.name)&&(emojiLink.style.background="#c2c2c2"),emojiLink.innerHTML=String(item.svg),emojiLink.onmousedown=clickCategory,emojiCategory.appendChild(emojiLink)}),[128513,128514,128515,128516,128517,128518,128521,128522,128523,128524,128525,128527,128530,128531,128532,128534,128536,128538,128540,128541,128542,128544,128545,128546,128547,128548,128549,128552,128553,128554,128555,128557,128560,128561,128562,128563,128565,128567].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,facesCategory.appendChild(emojiLink)}),[128012,128013,128014,128017,128018,128020,128023,128024,128025,128026,128027,128028,128029,128030,128031,128032,128033,128034,128035,128036,128037,128038,128039,128040,128041,128043,128044,128045,128046,128047,128048,128049,128050,128051,128052,128053,128054,128055,128056,128057,128058,128059,128060].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,animalsCategory.appendChild(emojiLink)}),[127813,127814,127815,127816,127817,127818,127820,127821,127822,127823,127825,127826,127827,127828,127829,127830,127831,127832,127836,127837,127838,127839,127840,127841,127842,127843,127844,127846,127848,127849,127850,127851,127852,127853,127856,127858,127859,127860,127863,127864,127867].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,foodCategory.appendChild(emojiLink)}),[127921,127923,127934,127935,127936,127937,127938,127939,127940,127942,127944,127946,128675,128692,128693,9917,9918,9978,127907,127919,9971].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,sportCategory.appendChild(emojiLink)}),[128641,128642,128646,128648,128650,128653,128654,128656,128660,128662,128664,128667,128668,128669,128670,128671,128672,128673,128640,128643,128644,128645,128647,128649,128652,128657,128658,128659,128661,128663,128665,128666,128674,128676,128690].map(function(item){var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,transportCategory.appendChild(emojiLink)}),[127890,127880,127881,127887,127891,127905,127906,127908,127909,127911,127912,127915,127916,127918,127919,127926,127927,127928,127929,127930,127931,127932,127968,127973,127978,128147,128148,128149,128150,128151,128152,128187,128186,128197,128213,128247].map(function(item){var emojiLi=document.createElement("li");emojiLi.style.display="inline-block",emojiLi.style.margin="5px";var emojiLink=document.createElement("a");emojiLink.style.textDecoration="none",emojiLink.style.margin="5px",emojiLink.style.position="initial",emojiLink.style.fontSize="24px",emojiLink.setAttribute("href","javascript:void(0)"),emojiLink.innerHTML=String.fromCodePoint(item),emojiLink.onmousedown=clickLink,objectsCategory.appendChild(emojiLink)}),emojiPicker.appendChild(emojiCategory),emojiPicker.appendChild(facesCategory),emojiPicker.appendChild(animalsCategory),emojiPicker.appendChild(foodCategory),emojiPicker.appendChild(sportCategory),emojiPicker.appendChild(transportCategory),emojiPicker.appendChild(objectsCategory),emojiContainer.appendChild(emojiPicker)}}]),MeteorEmoji}();module.exports=MeteorEmoji})},{}]},{},[1])(1)});

/***/ }),
/* 21 */
/***/ (function(module, exports) {

module.exports = function(module) {
	if(!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if(!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(5);


/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgYzVjMmY4YTdkNTBkMjVjMTFhZGQiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyLmpzIiwid2VicGFjazovLy8uL3NyYy9jb21tb24vanMtc2VydmljZXMvdmlldy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL2Nvb2tpZS5qcyIsIndlYnBhY2s6Ly8vLi9+L3B1YnN1Yi1qcy9zcmMvcHVic3ViLmpzIiwid2VicGFjazovLy8uL3NyYy9ib290c3RyYXAuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9jb25maXJtLXJlZy9jb25maXJtLXJlZy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmxvY2tzL2hlYWRlci9idXJnZXItbWVudS9idXJnZXItbWVudS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmxvY2tzL2hlYWRlci9oZWFkZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmxvY2tzL2xvZ2luLWZvcm0vbG9naW4tZm9ybS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmxvY2tzL21lc3NhZ2VzL2RhdGFTZXJ2ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Jsb2Nrcy9tZXNzYWdlcy9tZXNzYWdlcy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmxvY2tzL3JlZ2lzdGVyLWZvcm0vcmVnaXN0ZXItZm9ybS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL25ldHdvcmsuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhZ2VzL19hdXRoL2xvZ2luLXBhZ2UuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BhZ2VzL19pbnN0YWdyYW0vaW5zdGFncmFtLmpzIiwid2VicGFjazovLy8uL3NyYy9iYXNlLnNjc3MiLCJ3ZWJwYWNrOi8vLy4vfi9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXIvZmluZS11cGxvYWRlci5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZpbmUtdXBsb2FkZXIvbGliL3RyYWRpdGlvbmFsLmpzIiwid2VicGFjazovLy8uL34vbWV0ZW9yLWVtb2ppL2Rpc3QvbWV0ZW9yRW1vamkubWluLmpzIiwid2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9tb2R1bGUuanMiXSwibmFtZXMiOlsiQ09OU1QiLCJ1cmwiLCJiYXNlIiwicmVnaXN0cmF0aW9uIiwibG9naW4iLCJjb25maXJtYXRpb24iLCJpbnN0YWdyYW1fYWRkQWNjb3VudCIsImluc3RhZ3JhbUFjY291bnRfZ2V0TWV0YURhdGEiLCJpbnN0YWdyYW1BY2NvdW50X2NoZWNrcG9pbnQiLCJpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXkiLCJ1c2VyIiwiZW1haWwiLCJwYXNzd29yZCIsInRva2VuIiwiY29va2llU3RvcmFnZSIsImVtYWlsQ29uZmlybWVkIiwidWlTZWxlY3RvcnMiLCJoZWFkZXJMb2dpbkJveCIsImhlYWRlck5hdkxvZ2luQnRuIiwiaGVhZGVyUmVnQm94IiwiaGVhZGVyUmVnQnRuIiwiaW5zdGFncmFtIiwiYWRkQWNjb3VudEJ0blNlbGVjdG9yIiwiYWRkQWNjb3VudEJ0bklkIiwiZXZlbnRzIiwiVVNFUl9MT0dHRUQiLCJVU0VSX0xPR09VVCIsIlVTRVJfRU1BSUxfQ09ORklSTUVEIiwiU1RPUF9GSVhFRF9TUElOTkVSIiwiZ2V0UGF0aCIsIm5hbWUiLCJVc2VyIiwibmV0d29yayIsIk5ldHdvcmsiLCJDb29raWVTdG9yYWdlIiwic2V0dGluZ1Bvc3QiLCJtZXRob2QiLCJoZWFkZXJzIiwiZ2V0VG9rZW4iLCJnZXQiLCJjb29raWVUb2tlbiIsImZvcm1EYXRhIiwiY2JFcnJvciIsInNldHRpbmciLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInNlbmRSZXF1ZXN0IiwidXNlcm5hbWUiLCJjaGVja3BvaW50VHlwZSIsImtleSIsInVzZXJJbnN0YW5jZSIsInZpZXdVdGlscyIsInNob3dJbmZvTWVzc2FnZSIsInNlbGVjdG9yIiwibWVzc2FnZTEiLCJtZXNzYWdlMiIsIiQiLCJlbXB0eSIsImFwcGVuZCIsImZpbGxMaXN0IiwiJGxpc3QiLCJkYXRhQXJyYXkiLCJpdGVtcyIsImNMaXN0IiwiZm9yRWFjaCIsIml0ZW0iLCJpIiwibGkiLCJhcHBlbmRUbyIsImFkZENsYXNzIiwidGV4dCIsImlzRW1haWwiLCJyZWdleCIsInRlc3QiLCJDb29raWVTcnYiLCJjIiwiZG9jdW1lbnQiLCJjb29raWUiLCJtYXRjaCIsImRlY29kZVVSSUNvbXBvbmVudCIsInNldCIsInZhbHVlIiwib3B0cyIsInBhdGgiLCJkYXlzIiwiT2JqZWN0IiwiZW50cmllcyIsInJlZHVjZSIsInN0ciIsImsiLCJ2IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVtb3ZlIiwiaGVhZGVyIiwiYnVyZ2VyTWVudSIsImluc3RhZ3JhbUFjY291bnRzIiwibWVzc2FnZXMiLCJzZWxlY3RvckNzc0xvZ2luRm9ybSIsIl9sb2dpbkJveCIsIl9mb3JtSWQiLCJfYnV0dG9uU3VibWl0SWQiLCJfc2hvd0xvZ2luQm94QnRuSWQiLCJzZWxlY3RvckNzc0xvZ2luRm9ybUluc3RhZ3JhbSIsImlzTG9naW5JbnN0YWdyYW0iLCJpbml0IiwiUmVnaXN0ZXJGb3JtIiwiaW5pdEhlYWRlciIsImNvbmZpcm1hdGlvbldpdGhSZWRpcmVjdCIsInBhcnNlUXVlcnlTdHJpbmciLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsIm9ialVSTCIsInJlcGxhY2UiLCJSZWdFeHAiLCIkMCIsIiQxIiwiJDIiLCJwYXJhbXMiLCJzZW5kQ29uZmlybSIsImNvbmZpcm0iLCJ0aGVuIiwicmVzdWx0Iiwic3RhdHVzIiwic3RhdGUiLCJkYXRhIiwiY3VzdG9tZXJzRGF0YVN0cmluZyIsInNlc3Npb25TdG9yYWdlIiwiZ2V0SXRlbSIsImNvbnNvbGUiLCJsb2ciLCJzZXRUaW1lb3V0IiwicmVkaXJlY3QiLCJwYXRobmFtZSIsImluZGV4T2YiLCJzZWxlY3RvcnNFbCIsImxlZnRNZW51IiwiaGFtYnVyZ2VyQnV0dG9uQ2xzIiwiaGFtYnVyZ2VyTWVudUNscyIsImhhbWJ1cmdlck1lbnVPcGVuZWRDbGFzcyIsImhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3MiLCJyaWdodE1lbnUiLCJzdWJIZWFkZXIiLCJ0b2dnbGVIYW1idXJnZXJNZW51IiwibWVudU5hbWUiLCJ0b2dnbGVDbGFzcyIsIm9uIiwiYmluZCIsInNlbGVjdG9yTG9naW5TdGF0ZSIsInNlbGVjdG9yRW1haWxDb25maXJtU3RhdGUiLCJjbG9zZUNsYXNzIiwib3BlbmVkQ2xhc3MiLCJlbWFpbE5vdENvbmZpcm1lZCIsIiRlbWFpbG5Nc2ciLCJjc3MiLCJvbkxvZ2luU3Vic2NyaWJlIiwibXNnIiwicmVtb3ZlQ2xhc3MiLCIkbG9naW5Nc2ciLCJpc0VtYWlsQ29uZmlybWVkIiwic2hvd0xvZ291dCIsImlzTG9nZ2VkIiwiaXNMb2dnZWRJbiIsInBhcmVudCIsInNob3ciLCJvbGRVUkwiLCJyZWZlcnJlciIsImluY2x1ZGVzIiwiJGxvZ2luQm94IiwiJHJlZ2lzdGVyQm94IiwiUHViU3ViIiwic3Vic2NyaWJlIiwiaGlkZSIsImFkZEluc3RhZ3JhbUFjY291bnQiLCJuZXdGb3JtRGF0YSIsIm1lc3NhZ2UiLCIkbXNnTGlzdCIsImNhdGNoIiwiZXJyIiwiYWRkT25Mb2FkSGFuZGxlcnMiLCJlIiwiYnRuIiwidGFyZ2V0IiwiJG1vZGFsQm9keSIsImNsb3Nlc3QiLCJmaW5kIiwidmFsIiwidHJpbSIsIiRmb3JtIiwiZm9ybSIsImNzc1ZhbGlkYXRpb25DbGFzcyIsInByZXZlbnREZWZhdWx0IiwiY2hlY2tWYWxpZGl0eSIsInJlcG9ydFZhbGlkaXR5IiwiYWRkTGlzdEhhbmRsZXIiLCIkYnV0dG9uIiwic2VuZFRvIiwic3RvcFByb3BhZ2F0aW9uIiwibW9kYWwiLCJnZXRTZWN1cml0eUtleSIsIiRtb2RhbCIsIiRrZXlJbnB1dCIsImxlbmd0aCIsImNvbmZpcm1TZWN1cml0eUtleSIsImxlbiIsIm1pbkxlbiIsIk51bWJlciIsImF0dHIiLCJvbkhpZGVNb2RhbCIsInJlbW92ZUF0dHIiLCJ0eXBlU2VsZWN0ZWQiLCJjaGVja3BvaW50VHlwZUFjdGl2ZSIsIm1vZGFsQ29uZmlnIiwiX2NvbmZpZyIsImRlZmF1bHRBdmF0YXJTcmMiLCJpbnNlcnRJdGVtIiwiY3NzQ2xzIiwibGlUcGwiLCJzdGF0cyIsImluZm8iLCJ0cGwiLCJjaGVja3BvaW50IiwidHlwZSIsIm1ldGFkYXRhIiwiZ2V0TWV0YWRhdGEiLCJyZXNlbmRSZXF1ZXN0IiwiaXNTZW5kUmVxT25jZSIsImNoZWNrUmVzcG9uc2UiLCJpc1Jlc2VuZFJlcXVlc3QiLCJhY2NvdW50cyIsIkxvZ2luRm9ybSIsInNlbGVjdG9yQ3NzIiwiJGVtYWlsIiwiJHRleHRBcmVhRGVzY3JpcHRpb24iLCJ1c2VyTG9naW5IZWFkZXIiLCJfZm9ybURhdGEiLCJzdWJtaXRGb3JtIiwiZm9ybURhdGFPYmoiLCJ0b0xvY2FsZUxvd2VyQ2FzZSIsInB1Ymxpc2giLCJsb2dPdXQiLCJiaW5kRXZlbnRzIiwiJHNob3dMb2dpbkJveEJ0bklkIiwiJGJ1dHRvblN1Ym1pdCIsImV2ZW50IiwiaXNMb2dpbkJ0bkNsaWNrIiwiaXNBZGRJbnN0YWdyYW1CdG5DbGlja2VkIiwiaGFzQ2xhc3MiLCJjb252ZXJzYXRpb24iLCJ1c2VyTGlzdCIsInJlYWR5IiwibSIsIk1ldGVvckVtb2ppIiwiJHBpY2tlciIsInN0eWxlIiwic3R5bGVOZXciLCJyZXN0cmljdGVkVXBsb2FkZXIiLCJxcSIsIkZpbmVVcGxvYWRlciIsImVsZW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRlbXBsYXRlIiwicmVxdWVzdCIsImVuZHBvaW50IiwidGh1bWJuYWlscyIsInBsYWNlaG9sZGVycyIsIndhaXRpbmdQYXRoIiwibm90QXZhaWxhYmxlUGF0aCIsInZhbGlkYXRpb24iLCJhbGxvd2VkRXh0ZW5zaW9ucyIsIml0ZW1MaW1pdCIsInNpemVMaW1pdCIsImluc2VydE1zZyIsInNpZGUiLCJ0aW1lc3RhbXAiLCJmaWxsVXNlckxpc3QiLCJ0byIsImFkZEhhbmRsZXJzIiwidXNlck1zZyIsIiR1c2VyTGlzdCIsIm1ldGEiLCJjb252ZXJzYXRpb25zIiwic2VsZWN0b3JDbHMiLCJzdWJtaXRCdG4iLCIkcGFzc3dvcmQiLCIkcGFzc3dvcmRDb25maXJtIiwicGFzc3dvcmRDb25maXJtIiwicmVnaXN0ZXIiLCJlcnJvciIsInJlZ2lzdGVyQm94IiwiJGJ0biIsImlzIiwiaXNSZWdCdG5DbGljayIsIiRlbCIsInJlc3BvbnNlIiwiRXJyb3IiLCJzdGF0dXNUZXh0IiwiVVJMIiwiT1BUUyIsImZldGNoIiwiUHJvbWlzZSIsImFsbCIsImpzb24iLCJvayIsImNiRXJyb3JEZWZhdWx0IiwiY2hlY2tTdGF0dXMiLCJMb2dpblBhZ2UiLCJocmVmIiwiSW5zdGFncmFtIiwic2VsZWN0b3JDU1MiLCJnZXRJbnN0YWdyYW1BY2NvdW50Il0sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLG1EQUEyQyxjQUFjOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1DQUEyQiwwQkFBMEIsRUFBRTtBQUN2RCx5Q0FBaUMsZUFBZTtBQUNoRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4REFBc0QsK0RBQStEOztBQUVySDtBQUNBOztBQUVBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUNoRU8sSUFBTUEsd0JBQVE7QUFDakJDLFNBQUs7QUFDREMsY0FBTSwyQkFETDtBQUVEQyxzQkFBYyxxQkFGYjtBQUdEQyxlQUFPLDBCQUhOO0FBSURDLHNCQUFjLHVDQUpiO0FBS0RDLDhCQUFzQixxQkFMckI7QUFNREMsc0NBQThCLHlCQU43QjtBQU9EQyxxQ0FBNkIsZ0NBUDVCO0FBUURDLHFDQUE2QjtBQVI1QixLQURZO0FBV2pCQyxVQUFNO0FBQ0ZDLGVBQU8sRUFETDtBQUVGQyxrQkFBVSxFQUZSO0FBR0ZDLGVBQU87QUFITCxLQVhXO0FBZ0JqQkMsbUJBQWU7QUFDWEQsZUFBTyxhQURJO0FBRVhFLHdCQUFnQjtBQUZMLEtBaEJFO0FBb0JqQkMsaUJBQWE7QUFDVEMsd0JBQWdCLGdCQURQO0FBRVRDLDJCQUFtQixxQkFGVjtBQUdUQyxzQkFBYyxtQkFITDtBQUlUQyxzQkFBYyx3QkFKTDtBQUtUQyxtQkFBVztBQUNQQyxtQ0FBdUIsb0JBRGhCO0FBRVBDLDZCQUFpQjtBQUZWO0FBTEYsS0FwQkk7QUE4QmpCQyxZQUFRO0FBQ0pDLHFCQUFhLGFBRFQ7QUFFSkMscUJBQWEsYUFGVDtBQUdKQyw4QkFBc0Isc0JBSGxCO0FBSUpDLDRCQUFvQjtBQUpoQixLQTlCUztBQW9DakJDLFdBcENpQixtQkFvQ1RDLElBcENTLEVBb0NIO0FBQ1YsZUFBTyxLQUFLN0IsR0FBTCxDQUFTQyxJQUFULEdBQWdCLEtBQUtELEdBQUwsQ0FBUzZCLElBQVQsQ0FBdkI7QUFDSDtBQXRDZ0IsQ0FBZCxDOzs7Ozs7Ozs7Ozs7Ozs7cWpCQ0FQOzs7QUFDQTs7QUFDQTs7OztBQUNBOzs7Ozs7OztJQUVNQyxJO0FBRUYsb0JBQWM7QUFBQTs7QUFDVixhQUFLQyxPQUFMLEdBQWUsSUFBSUMsaUJBQUosRUFBZjtBQUNBLGFBQUtuQixhQUFMLEdBQXFCb0IsZ0JBQXJCO0FBQ0EsYUFBS0MsV0FBTCxHQUFtQjtBQUNmQyxvQkFBUSxNQURPO0FBRWZDLHFCQUFTO0FBQ0wsZ0NBQWdCLGtCQURYO0FBRUwsMEJBQVU7QUFGTDtBQUZNLFNBQW5CO0FBT0g7Ozs7cUNBRVk7QUFDVCxtQkFBTyxDQUFDLENBQUMsS0FBS0MsUUFBTCxFQUFUO0FBQ0g7OzsyQ0FFa0I7QUFDZixtQkFBUSxLQUFLeEIsYUFBTCxDQUFtQnlCLEdBQW5CLENBQXVCdkMsY0FBTWMsYUFBTixDQUFvQkMsY0FBM0MsTUFBK0QsV0FBdkU7QUFDSDs7O21DQUVVO0FBQ1AsZ0JBQU15QixjQUFjLEtBQUsxQixhQUFMLENBQW1CeUIsR0FBbkIsQ0FBdUJ2QyxjQUFNYyxhQUFOLENBQW9CRCxLQUEzQyxDQUFwQjtBQUNBLG1CQUFPMkIsV0FBUDtBQUNIOzs7OEJBRUtDLFEsRUFBVUMsTyxFQUFTO0FBQ3JCLGdCQUFNQyx1QkFBYyxLQUFLUixXQUFuQixJQUFnQ1MsTUFBTUMsS0FBS0MsU0FBTCxDQUFlTCxRQUFmLENBQXRDLEdBQU47QUFDQSxtQkFBTyxLQUFLVCxPQUFMLENBQWFlLFdBQWIsQ0FBeUIvQyxjQUFNNkIsT0FBTixDQUFjLE9BQWQsQ0FBekIsRUFBaURjLE9BQWpELEVBQTBERCxPQUExRCxDQUFQO0FBQ0g7Ozs0Q0FFbUJELFEsRUFBVUMsTyxFQUFTO0FBQ25DLGdCQUFNQyx1QkFDQyxLQUFLUixXQUROO0FBRUZTLHNCQUFNQyxLQUFLQyxTQUFMLENBQWVMLFFBQWYsQ0FGSjtBQUdGSixzQ0FDTyxLQUFLRixXQUFMLENBQWlCRSxPQUR4QjtBQUVJeEIsMkJBQU8sS0FBS3lCLFFBQUw7QUFGWDtBQUhFLGNBQU47QUFRQSxtQkFBTyxLQUFLTixPQUFMLENBQWFlLFdBQWIsQ0FBeUIvQyxjQUFNNkIsT0FBTixDQUFjLHNCQUFkLENBQXpCLEVBQWdFYyxPQUFoRSxFQUF5RUQsT0FBekUsQ0FBUDtBQUNIOzs7OENBRXFCO0FBQ2xCLGdCQUFNQyx1QkFDQyxLQUFLUixXQUROO0FBRUZDLHdCQUFRLEtBRk47QUFHRkMsc0NBQ08sS0FBS0YsV0FBTCxDQUFpQkUsT0FEeEI7QUFFSXhCLDJCQUFPLEtBQUt5QixRQUFMO0FBRlg7QUFIRSxjQUFOO0FBUUEsbUJBQU8sS0FBS04sT0FBTCxDQUFhZSxXQUFiLENBQXlCL0MsY0FBTTZCLE9BQU4sQ0FBYyxzQkFBZCxDQUF6QixFQUFnRWMsT0FBaEUsQ0FBUDtBQUNIOzs7Z0NBRU85QixLLEVBQU87QUFDWDtBQUNBLG1CQUFPLEtBQUttQixPQUFMLENBQWFlLFdBQWIsT0FBNEIvQyxjQUFNNkIsT0FBTixDQUFjLGNBQWQsSUFBZ0NoQixLQUE1RCxFQUFQO0FBQ0g7OztpQ0FFUTRCLFEsRUFBVTtBQUNmLGdCQUFNRSx1QkFDQyxLQUFLUixXQUROO0FBRUZTLHNCQUFNQyxLQUFLQyxTQUFMLENBQWVMLFFBQWY7QUFGSixjQUFOO0FBSUEsbUJBQU8sS0FBS1QsT0FBTCxDQUFhZSxXQUFiLENBQXlCL0MsY0FBTTZCLE9BQU4sQ0FBYyxjQUFkLENBQXpCLEVBQXdEYyxPQUF4RCxDQUFQO0FBQ0g7OztvQ0FFVzlCLEssRUFBTzZCLE8sRUFBUztBQUN4QixtQkFBTyxLQUFLVixPQUFMLENBQWFlLFdBQWIsTUFBNEIvQyxjQUFNNkIsT0FBTixDQUFjLDhCQUFkLENBQTVCLEVBQTZFLEVBQUNRLFNBQVMsRUFBQ3hCLFlBQUQsRUFBVixFQUE3RSxFQUFpRzZCLE9BQWpHLENBQVA7QUFDSDs7O3VDQUVjTSxRLEVBQVVDLGMsRUFBZ0I7QUFDckMsZ0JBQU1OLHVCQUNDLEtBQUtSLFdBRE47QUFFRlMsc0JBQU1DLEtBQUtDLFNBQUwsQ0FBZSxFQUFDLFFBQVFHLGNBQVQsRUFBZixDQUZKLEVBRThDO0FBQ2hEWixzQ0FDTyxLQUFLRixXQUFMLENBQWlCRSxPQUR4QjtBQUVJLDZCQUFTLGtDQUZiLENBRWdEO0FBRmhEO0FBSEUsY0FBTjtBQVFBLG1CQUFPLEtBQUtMLE9BQUwsQ0FBYWUsV0FBYixNQUE0Qi9DLGNBQU02QixPQUFOLENBQWMsNkJBQWQsQ0FBNUIsR0FBMkVtQixRQUEzRSxFQUF1RkwsT0FBdkYsQ0FBUDtBQUNIOzs7MkNBRWtCTyxHLEVBQUtGLFEsRUFBVTtBQUM5QixnQkFBTUwsVUFBVTtBQUNaUCx3QkFBUSxRQURJO0FBRVpRLHNCQUFNQyxLQUFLQyxTQUFMLENBQWUsRUFBQyxpQkFBaUJJLEdBQWxCLEVBQWYsQ0FGTTtBQUdaYixzQ0FDTyxLQUFLRixXQUFMLENBQWlCRSxPQUR4QjtBQUVJLDZCQUFTLGtDQUZiLENBRWdEO0FBRmhEO0FBSFksYUFBaEI7QUFRQSxtQkFBTyxLQUFLTCxPQUFMLENBQWFlLFdBQWIsTUFBNEIvQyxjQUFNNkIsT0FBTixDQUFjLDZCQUFkLENBQTVCLEdBQTJFbUIsUUFBM0UsRUFBdUZMLE9BQXZGLENBQVA7QUFDSDs7Ozs7O0FBSUwsSUFBSVEsZUFBZSxJQUFuQjs7QUFFQSxJQUFJLENBQUNBLFlBQUwsRUFBbUI7QUFDZkEsbUJBQWUsSUFBSXBCLElBQUosRUFBZjtBQUNIOztrQkFFY29CLFk7Ozs7Ozs7Ozs7OztBQzlHZjtBQUNBOztBQUVBLFNBQVNDLFNBQVQsR0FBcUI7QUFDakIsYUFBU0MsZUFBVCxDQUF5QkMsUUFBekIsRUFBbUNDLFFBQW5DLEVBQTZDQyxRQUE3QyxFQUF1RDtBQUNuREMsVUFBRUgsUUFBRixFQUFZSSxLQUFaLEdBQ0tDLE1BREwsT0FDZ0JKLFFBQUQsbUJBQTJCQSxRQUEzQixZQUE0QyxFQUQzRCxHQUVLSSxNQUZMLFNBRWtCSCxRQUZsQjtBQUdIOztBQUVELGFBQVNJLFFBQVQsQ0FBa0JDLEtBQWxCLEVBQXlCQyxTQUF6QixFQUFvQztBQUNoQyxZQUFNQyxRQUFRRCxTQUFkO0FBQ0EsWUFBTUUsUUFBUUgsS0FBZDtBQUNBRyxjQUFNTixLQUFOO0FBQ0FLLGNBQU1FLE9BQU4sQ0FBYyxVQUFDQyxJQUFELEVBQU9DLENBQVAsRUFBYTtBQUN2QixnQkFBTUMsS0FBS1gsRUFBRSxtQ0FBRixFQUNOWSxRQURNLENBQ0dMLEtBREgsQ0FBWDtBQUVBUCxjQUFFLE1BQUYsRUFBVWEsUUFBVixDQUFtQixRQUFuQixFQUNLQyxJQURMLENBQ1VMLEtBQUtsQixRQURmLEVBRUtxQixRQUZMLENBRWNELEVBRmQ7QUFHSCxTQU5EO0FBT0g7O0FBRUQsYUFBU0ksT0FBVCxDQUFpQjdELEtBQWpCLEVBQXdCO0FBQ3BCO0FBQ0EsWUFBTThELFFBQVEsK0RBQWQ7QUFDQSxlQUFPQSxNQUFNQyxJQUFOLENBQVcvRCxLQUFYLENBQVA7QUFDQTtBQUNIOztBQUVELFdBQU87QUFDSDBDLHdDQURHO0FBRUhPLDBCQUZHO0FBR0hZO0FBSEcsS0FBUDtBQUtIOztrQkFFY3BCLFc7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDcENmLElBQU11QixZQUFZO0FBQ2RwQyxTQUFLLG1CQUFRO0FBQ1QsWUFBTXFDLElBQUlDLFNBQVNDLE1BQVQsQ0FBZ0JDLEtBQWhCLG9CQUF1Q2pELElBQXZDLDRCQUFvRSxDQUFwRSxDQUFWO0FBQ0EsWUFBSThDLENBQUosRUFBTztBQUNILG1CQUFPSSxtQkFBbUJKLENBQW5CLENBQVA7QUFDSDtBQUNKLEtBTmE7QUFPZEssU0FBSyxhQUFDbkQsSUFBRCxFQUFPb0QsS0FBUCxFQUFnRDtBQUFBLFlBQWxDQyxJQUFrQyx1RUFBM0IsRUFBQ0MsTUFBTSxHQUFQLEVBQVlDLE1BQU0sR0FBbEIsRUFBMkI7O0FBQ2pELFlBQUlGLEtBQUtFLElBQVQsRUFBZTtBQUNYRixpQkFBSyxTQUFMLElBQWtCQSxLQUFLRSxJQUFMLEdBQVksRUFBWixHQUFpQixFQUFqQixHQUFzQixFQUF4QztBQUNBLG1CQUFPRixLQUFLRSxJQUFaO0FBQ0g7QUFDRDtBQUNBRixlQUFPRyxPQUFPQyxPQUFQLENBQWVKLElBQWYsRUFBcUJLLE1BQXJCLENBQTRCLFVBQUNDLEdBQUQ7QUFBQTtBQUFBLGdCQUFPQyxDQUFQO0FBQUEsZ0JBQVVDLENBQVY7O0FBQUEsbUJBQW9CRixHQUFwQixVQUE0QkMsQ0FBNUIsU0FBaUNDLENBQWpDO0FBQUEsU0FBNUIsRUFBa0UsRUFBbEUsQ0FBUDtBQUNBZCxpQkFBU0MsTUFBVCxHQUFxQmhELElBQXJCLFVBQTZCOEQsbUJBQW1CVixLQUFuQixJQUE0QkMsSUFBekQ7QUFDSCxLQWZhO0FBZ0JkVSxZQUFRLGdCQUFDL0QsSUFBRCxFQUFPcUQsSUFBUDtBQUFBLGVBQWdCUixVQUFVTSxHQUFWLENBQWNuRCxJQUFkLEVBQW9CLEVBQXBCLGFBQXlCLFdBQVcsQ0FBQyxDQUFyQyxFQUF3Q3NELE1BQU0sR0FBOUMsRUFBbURDLE1BQU0sQ0FBekQsSUFBK0RGLElBQS9ELEVBQWhCO0FBQUE7QUFDUjtBQWpCYyxDQUFsQjs7QUFvQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztrQkEyQmVSLFM7Ozs7OztBQ2hEZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkIsZUFBZSxFQUFFOztBQUU1QztBQUNBLEtBQUssVUFBVSxJQUEyQjtBQUMxQztBQUNBLDhDQUE4QztBQUM5QztBQUNBLGdDQUFnQztBQUNoQywwQ0FBMEM7QUFDMUM7O0FBRUEsQ0FBQztBQUNEOztBQUVBLHFCQUFxQjtBQUNyQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCLGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFNBQVM7QUFDeEIsZ0JBQWdCO0FBQ2hCLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QixlQUFlLFdBQVc7QUFDMUIsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCLGVBQWUsV0FBVztBQUMxQixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsb0JBQW9CO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQzFTRDs7QUFHQTs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztJQUFZbUIsTTs7QUFDWjs7SUFBWUMsVTs7QUFDWjs7QUFDQTs7SUFBWUMsaUI7O0FBQ1o7O0lBQVlDLFE7Ozs7OztBQVhaOztBQWFBLElBQU1DLHVCQUF1QjtBQUN6QkMsZUFBV25HLGNBQU1nQixXQUFOLENBQWtCQyxjQURKO0FBRXpCbUYsYUFBUyxnQkFGZ0I7QUFHekJDLHFCQUFpQixlQUhRO0FBSXpCQyx3QkFBb0J0RyxjQUFNZ0IsV0FBTixDQUFrQkU7QUFKYixDQUE3Qjs7QUFPQSxJQUFNcUYsZ0NBQWdDO0FBQ2xDSixlQUFXLGlCQUR1QjtBQUVsQ0MsYUFBUywyQkFGeUI7QUFHbENDLHFCQUFpQixnQ0FIaUI7QUFJbENDLHdCQUFvQixvQkFKYztBQUtsQ0Usc0JBQWtCO0FBTGdCLENBQXRDOztBQVFBLElBQU1DLE9BQU8sU0FBUEEsSUFBTyxHQUFNO0FBQ2Y7QUFDQyxRQUFJQyxzQkFBSixFQUFELENBQXFCRCxJQUFyQjtBQUNBLDhCQUFVUCxvQkFBVixFQUFnQ08sSUFBaEM7QUFDQSw4QkFBVUYsNkJBQVYsRUFBeUNFLElBQXpDLEdBSmUsQ0FJa0M7QUFDakQsOEJBQVU7QUFDTk4sbUJBQVcsMEJBREw7QUFFTkMsaUJBQVMsY0FGSDtBQUdOQyx5QkFBaUI7QUFIWCxLQUFWLEVBSUdJLElBSkg7QUFLQSxnQ0FBWUEsSUFBWjtBQUNBLGdEQUEyQkEsSUFBM0I7QUFDQVgsV0FBT2EsVUFBUDtBQUNBWixlQUFXVSxJQUFYO0FBQ0FULHNCQUFrQlMsSUFBbEI7QUFDQVIsYUFBU1EsSUFBVDtBQUNILENBaEJEOztBQWtCQSxDQUFDO0FBQUEsV0FBTUEsTUFBTjtBQUFBLENBQUQsSTs7Ozs7Ozs7Ozs7O1FDM0JnQkcsd0IsR0FBQUEsd0I7O0FBbEJoQjs7OztBQUNBOztBQUNBOzs7Ozs7QUFFQSxJQUFNQyxtQkFBbUIsU0FBbkJBLGdCQUFtQixHQUFXOztBQUVoQyxRQUFNcEIsTUFBTXFCLE9BQU9DLFFBQVAsQ0FBZ0JDLE1BQTVCO0FBQ0EsUUFBTUMsU0FBUyxFQUFmOztBQUVBeEIsUUFBSXlCLE9BQUosQ0FDRSxJQUFJQyxNQUFKLENBQVcsc0JBQVgsRUFBbUMsR0FBbkMsQ0FERixFQUVJLFVBQVNDLEVBQVQsRUFBYUMsRUFBYixFQUFpQkMsRUFBakIsRUFBcUI7QUFDakJMLGVBQU9JLEVBQVAsSUFBYUMsRUFBYjtBQUNILEtBSkw7QUFNQSxXQUFPTCxNQUFQO0FBQ0gsQ0FaRCxDLENBTkE7QUFDQTtBQW1CTyxTQUFTTCx3QkFBVCxHQUFvQztBQUN2QyxRQUFNbEcsT0FBT3FCLGNBQWI7QUFDQSxRQUFNd0YsU0FBU1Ysa0JBQWY7QUFDQTs7QUFFQSxRQUFNVyxjQUFjLFNBQWRBLFdBQWMsQ0FBVTNHLEtBQVYsRUFBaUI7QUFDakNILGFBQUsrRyxPQUFMLENBQWE1RyxLQUFiLEVBQW9CNkcsSUFBcEIsQ0FBeUIsVUFBQ0MsTUFBRCxFQUFZO0FBQ2pDLGdCQUFJQSxPQUFPQyxNQUFQLElBQWlCRCxPQUFPQyxNQUFQLENBQWNDLEtBQWQsS0FBd0IsSUFBN0MsRUFBbUQ7O0FBRS9DO0FBQ0EvRyxpQ0FBY21FLEdBQWQsQ0FBa0JqRixjQUFNYyxhQUFOLENBQW9CQyxjQUF0QyxFQUFzRCxXQUF0RDtBQUNBRCxpQ0FBY21FLEdBQWQsQ0FBa0JqRixjQUFNYyxhQUFOLENBQW9CRCxLQUF0QyxFQUE2QzhHLE9BQU9HLElBQVAsQ0FBWWpILEtBQXpEOztBQUVBOztBQUVBO0FBQ0Esb0JBQU1rSCxzQkFBc0JDLGVBQWVDLE9BQWYsQ0FBdUIsZUFBdkIsQ0FBNUI7QUFDQUMsd0JBQVFDLEdBQVIsQ0FBWUosbUJBQVo7QUFDQUcsd0JBQVFDLEdBQVIsQ0FBWSxzQ0FBWixFQUFvRFIsTUFBcEQ7QUFDQWxFLGtCQUFFLHVCQUFGLEVBQTJCRSxNQUEzQiw4QkFBNkRnRSxPQUFPQyxNQUFQLENBQWNDLEtBQTNFO0FBQ0FPLDJCQUFXLFlBQU07QUFDYnRCLDJCQUFPQyxRQUFQLEdBQWtCLGdCQUFsQjtBQUNILGlCQUZELEVBRUcsSUFGSDtBQUdILGFBaEJELE1BZ0JPLElBQUlZLE9BQU9DLE1BQVgsRUFBbUI7QUFDdEJNLHdCQUFRQyxHQUFSLENBQVlSLE1BQVo7QUFDSCxhQUZNLE1BRUE7QUFDSE8sd0JBQVFDLEdBQVIsQ0FBWVIsTUFBWjtBQUNIO0FBQ0osU0F0QkQ7QUF1QkgsS0F4QkQ7O0FBMEJBLFFBQU1VLFdBQVcsU0FBWEEsUUFBVyxHQUFXO0FBQ3hCO0FBQ0EsWUFBTXhILFFBQVEwRyxPQUFPLE9BQVAsQ0FBZDs7QUFFQSxZQUFJLENBQUNSLFNBQVN1QixRQUFULENBQWtCQyxPQUFsQixDQUEwQixzQkFBMUIsQ0FBTCxFQUF3RDtBQUNwRDtBQUNIO0FBQ0QsWUFBSTFILEtBQUosRUFBVztBQUNQcUgsb0JBQVFDLEdBQVIsQ0FBWSxjQUFaLEVBQTRCdEgsS0FBNUI7QUFDQTJHLHdCQUFZM0csS0FBWjtBQUNIO0FBQ0osS0FYRDs7QUFhQSxhQUFTNEYsSUFBVCxHQUFnQjtBQUNaNEI7QUFDSDs7QUFFRCxXQUFPO0FBQ0g1QjtBQURHLEtBQVA7QUFHSCxDOzs7Ozs7Ozs7Ozs7UUNoQ2VBLEksR0FBQUEsSTtBQXZDaEI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNK0IsY0FBYztBQUNoQkMsY0FBVTtBQUNOQyw0QkFBb0IsdUJBRGQ7QUFFTkMsMEJBQWtCLG9CQUZaO0FBR05DLGtDQUEwQixxQkFIcEI7QUFJTkMsbUNBQTJCO0FBSnJCLEtBRE07QUFPaEJDLGVBQVc7QUFDUEosNEJBQW9CLHdCQURiO0FBRVBDLDBCQUFrQixxQkFGWDtBQUdQQyxrQ0FBMEIsMEJBSG5CO0FBSVBDLG1DQUEyQjtBQUpwQixLQVBLO0FBYWhCRSxlQUFXO0FBQ1BMLDRCQUFvQiwrQkFEYjtBQUVQQywwQkFBa0IsYUFGWDtBQUdQQyxrQ0FBMEIsa0JBSG5CO0FBSVBDLG1DQUEyQjtBQUpwQjtBQWJLLENBQXBCOztBQXFCQTs7O0FBR0EsU0FBU0csbUJBQVQsQ0FBNkJDLFFBQTdCLEVBQXVDO0FBQUEsZ0NBQ2lFVCxZQUFZUyxRQUFaLENBRGpFO0FBQUEsUUFDNUJOLGdCQUQ0Qix5QkFDNUJBLGdCQUQ0QjtBQUFBLFFBQ1ZELGtCQURVLHlCQUNWQSxrQkFEVTtBQUFBLFFBQ1VHLHlCQURWLHlCQUNVQSx5QkFEVjtBQUFBLFFBQ3FDRCx3QkFEckMseUJBQ3FDQSx3QkFEckM7O0FBRW5DbkYsTUFBRWlGLGtCQUFGLEVBQXNCUSxXQUF0QixDQUFrQ0wseUJBQWxDO0FBQ0FwRixNQUFFa0YsZ0JBQUYsRUFBb0JPLFdBQXBCLENBQWdDTix3QkFBaEM7QUFDSDs7QUFFRDs7O0FBR08sU0FBU25DLElBQVQsR0FBZ0I7QUFDbkIsUUFBTWdDLFdBQVcsVUFBakI7QUFDQSxRQUFNSyxZQUFZLFdBQWxCO0FBQ0EsUUFBTUMsWUFBWSxXQUFsQjs7QUFFQXRGLE1BQUUrRSxZQUFZQyxRQUFaLEVBQXNCQyxrQkFBeEIsRUFBNENTLEVBQTVDLENBQStDLE9BQS9DLEVBQXdESCxvQkFBb0JJLElBQXBCLENBQXlCLElBQXpCLEVBQStCWCxRQUEvQixDQUF4RDtBQUNBaEYsTUFBRStFLFlBQVlNLFNBQVosRUFBdUJKLGtCQUF6QixFQUE2Q1MsRUFBN0MsQ0FBZ0QsT0FBaEQsRUFBeURILG9CQUFvQkksSUFBcEIsQ0FBeUIsSUFBekIsRUFBK0JOLFNBQS9CLENBQXpEO0FBQ0FyRixNQUFFK0UsWUFBWU8sU0FBWixFQUF1Qkwsa0JBQXpCLEVBQTZDUyxFQUE3QyxDQUFnRCxPQUFoRCxFQUF5REgsb0JBQW9CSSxJQUFwQixDQUF5QixJQUF6QixFQUErQkwsU0FBL0IsQ0FBekQ7QUFDSCxDOzs7Ozs7Ozs7Ozs7UUNRZXBDLFUsR0FBQUEsVTs7QUF0RGhCOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBLElBQU0wQyxxQkFBcUIsMEJBQTNCLEMsQ0FIZ0M7QUFGaEM7O0FBTUEsSUFBTUMsNEJBQTRCLHlCQUFsQztBQUNBLElBQU1DLGFBQWEsUUFBbkI7QUFDQSxJQUFNQyxjQUFjLFNBQXBCOztBQUVBLFNBQVNDLGlCQUFULEdBQTZCO0FBQ3pCLFFBQU1DLGFBQWFqRyxFQUFFNkYseUJBQUYsQ0FBbkI7QUFDQUksZUFBV25GLElBQVgsQ0FBZ0IsNkNBQWhCLEVBQStEb0YsR0FBL0QsQ0FBbUUsT0FBbkUsRUFBNEUsWUFBNUU7QUFDSDs7QUFFRCxTQUFTQyxnQkFBVCxDQUEwQkMsR0FBMUIsRUFBK0IvQixJQUEvQixFQUFxQztBQUNqQztBQUNBckUsTUFBRXpELGNBQU1nQixXQUFOLENBQWtCRSxpQkFBcEIsRUFBdUNvRCxRQUF2QyxDQUFnRGlGLFVBQWhELEVBQTRETyxXQUE1RCxDQUF3RU4sV0FBeEU7QUFDQS9GLE1BQUV6RCxjQUFNZ0IsV0FBTixDQUFrQkksWUFBcEIsRUFBa0NrRCxRQUFsQyxDQUEyQ2lGLFVBQTNDLEVBQXVETyxXQUF2RCxDQUFtRU4sV0FBbkU7QUFDQS9GLE1BQUV6RCxjQUFNZ0IsV0FBTixDQUFrQkMsY0FBcEIsRUFBb0NxRCxRQUFwQyxDQUE2Q2lGLFVBQTdDLEVBQXlETyxXQUF6RCxDQUFxRU4sV0FBckU7O0FBRUEvRixNQUFFLHFCQUFGLEVBQXlCYSxRQUF6QixDQUFrQ2tGLFdBQWxDLEVBQStDTSxXQUEvQyxDQUEyRFAsVUFBM0QsRUFOaUMsQ0FNdUM7QUFDeEUsUUFBTVEsWUFBWXRHLEVBQUU0RixrQkFBRixDQUFsQjtBQUNBVSxjQUFVeEYsSUFBVixDQUFlLHdEQUFmLEVBQXlFb0YsR0FBekUsQ0FBNkUsT0FBN0UsRUFBc0YsV0FBdEY7QUFDQSxRQUFNSyxtQkFBbUJqSSxlQUFLaUksZ0JBQUwsRUFBekI7QUFDQSxRQUFJLENBQUNBLGdCQUFMLEVBQXVCO0FBQ25CUDtBQUNIO0FBQ0o7O0FBRUQsU0FBU1EsVUFBVCxHQUFzQjtBQUNsQjtBQUNBLFFBQU1DLFdBQVduSSxlQUFLb0ksVUFBTCxFQUFqQjtBQUNBLFFBQU1ILG1CQUFtQmpJLGVBQUtpSSxnQkFBTCxFQUF6QjtBQUNBLFFBQUksQ0FBQ0EsZ0JBQUwsRUFBdUI7QUFDbkJQO0FBQ0g7QUFDRCxRQUFJUyxRQUFKLEVBQWM7QUFDVnpHLFVBQUUscUJBQUYsRUFBeUIyRyxNQUF6QixHQUFrQ0MsSUFBbEM7QUFDQTVHLFVBQUUseUJBQUYsRUFBNkJjLElBQTdCLENBQWtDLHlCQUFsQztBQUNBLFlBQU0rRixTQUFTekYsU0FBUzBGLFFBQXhCO0FBQ0E7QUFDQSxZQUFJRCxPQUFPRSxRQUFQLENBQWdCLHNCQUFoQixDQUFKLEVBQTZDO0FBQ3pDL0csY0FBRSwwQkFBRixFQUE4QmMsSUFBOUIsQ0FBbUMsNEJBQW5DO0FBQ0g7QUFDRHFGO0FBQ0gsS0FURCxNQVNPO0FBQ0huRyxVQUFFNEYsa0JBQUYsRUFBc0I5RSxJQUF0QixDQUEyQiwrQkFBM0I7QUFDQWQsVUFBRTZGLHlCQUFGLEVBQTZCNUYsS0FBN0I7QUFDSDtBQUNKOztBQUVEOzs7QUFHTyxTQUFTaUQsVUFBVCxHQUFzQjtBQUMxQjtBQUNDLFFBQU04RCxZQUFZaEgsRUFBRXpELGNBQU1nQixXQUFOLENBQWtCQyxjQUFwQixDQUFsQjtBQUNBLFFBQU15SixlQUFlakgsRUFBRXpELGNBQU1nQixXQUFOLENBQWtCRyxZQUFwQixDQUFyQjs7QUFFQXdKLHVCQUFPQyxTQUFQLENBQWlCNUssY0FBTXdCLE1BQU4sQ0FBYUMsV0FBOUIsRUFBMkNtSSxnQkFBM0M7O0FBRUFLOztBQUVBeEcsTUFBRXpELGNBQU1nQixXQUFOLENBQWtCSSxZQUFwQixFQUFrQytILEVBQWxDLENBQXFDLE9BQXJDLEVBQThDLFlBQU07QUFDaERzQixrQkFBVUksSUFBVjtBQUNBSCxxQkFBYWYsR0FBYixDQUFpQixFQUFDLE9BQU8sQ0FBUixFQUFXLFNBQVMsQ0FBcEIsRUFBakIsRUFDS3JGLFFBREwsQ0FDYyw2REFEZCxFQUVLd0YsV0FGTCxDQUVpQixRQUZqQjtBQUdILEtBTEQ7O0FBT0FyRyxNQUFFekQsY0FBTWdCLFdBQU4sQ0FBa0JFLGlCQUFwQixFQUF1Q2lJLEVBQXZDLENBQTBDLE9BQTFDLEVBQW1ELFlBQU07QUFDckRzQixrQkFBVW5HLFFBQVYsQ0FBbUIsU0FBbkIsRUFBOEJ3RixXQUE5QixDQUEwQyxRQUExQztBQUNBWSxxQkFBYXBHLFFBQWIsQ0FBc0IsUUFBdEIsRUFBZ0N3RixXQUFoQyxDQUE0QyxTQUE1QztBQUNILEtBSEQ7QUFJSCxDOzs7Ozs7Ozs7Ozs7UUN1UmVyRCxJLEdBQUFBLEk7O0FBaldoQjs7OztBQUVBOzs7Ozs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0VFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JGO0FBbkdBO0FBb0dBLElBQU1xRSxzQkFBc0IsU0FBdEJBLG1CQUFzQixDQUFDQyxXQUFELEVBQWlCO0FBQ3pDLFFBQU1ySSxVQUFVLFNBQVZBLE9BQVUsQ0FBQ2lGLE1BQUQsRUFBWTtBQUN4Qk8sZ0JBQVFDLEdBQVIsQ0FBWSxPQUFaLEVBQXFCUixNQUFyQjtBQUNBdkUsdUJBQVVDLGVBQVYsQ0FBMEJJLEVBQUUsWUFBRixDQUExQixFQUNJa0UsT0FBT0MsTUFBUCxDQUFjQyxLQURsQixFQUVJRixPQUFPQyxNQUFQLENBQWNvRCxPQUFkLElBQXlCLGFBRjdCO0FBR0E7QUFDSCxLQU5EOztBQVFBakosbUJBQUsrSSxtQkFBTCxDQUF5QkMsV0FBekIsRUFBc0NySSxPQUF0QyxFQUErQ2dGLElBQS9DLENBQW9ELFVBQUNDLE1BQUQsRUFBWTtBQUM1RCxZQUFJQSxVQUFVQSxPQUFPQyxNQUFyQixFQUE2QjtBQUN6Qk0sb0JBQVFDLEdBQVIsQ0FBWVIsTUFBWixFQUFvQkEsT0FBT0MsTUFBM0I7QUFDQTtBQUNBLGdCQUFNcUQsV0FBV3hILEVBQUUsZ0JBQUYsQ0FBakI7QUFDQXdILHFCQUFTdkgsS0FBVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNIO0FBQ0osS0FmRCxFQWVHd0gsS0FmSCxDQWVTLFVBQUNDLEdBQUQsRUFBUztBQUNkO0FBQ0FqRCxnQkFBUUMsR0FBUixDQUFZZ0QsR0FBWjtBQUNILEtBbEJEOztBQW9CQWpELFlBQVFDLEdBQVIsQ0FBWSxRQUFaLEVBQXNCNEMsV0FBdEI7QUFDSCxDQTlCRDtBQWxHQTs7O0FBa0lBLFNBQVNLLGlCQUFULEdBQTZCO0FBQ3pCOztBQUVBOztBQUVBM0gsTUFBRSwyQkFBRixFQUErQjBGLEVBQS9CLENBQWtDLE9BQWxDLEVBQTJDLFVBQUNrQyxDQUFELEVBQU87QUFDOUMsWUFBTUMsTUFBTTdILEVBQUU0SCxFQUFFRSxNQUFKLENBQVo7QUFDQSxZQUFNQyxhQUFhRixJQUFJRyxPQUFKLENBQVksUUFBWixFQUFzQkMsSUFBdEIsQ0FBMkIsMkJBQTNCLENBQW5CO0FBQ0EsWUFBTTFJLFdBQVd3SSxXQUFXRSxJQUFYLENBQWdCLHdCQUFoQixFQUEwQ0MsR0FBMUMsR0FBZ0RDLElBQWhELEVBQWpCO0FBQ0EsWUFBTWhMLFdBQVc0SyxXQUFXRSxJQUFYLENBQWdCLG9CQUFoQixFQUFzQ0MsR0FBdEMsR0FBNENDLElBQTVDLEVBQWpCO0FBQ0EsWUFBTUMsUUFBUXBJLEVBQUUsTUFBRixFQUFVK0gsVUFBVixDQUFkO0FBQ0EsWUFBTU0sT0FBT0QsTUFBTXRKLEdBQU4sQ0FBVSxDQUFWLENBQWI7QUFDQSxZQUFNd0oscUJBQXFCLGlCQUEzQjs7QUFFQVYsVUFBRVcsY0FBRjs7QUFFQTtBQUNBO0FBQ0EsWUFBSUYsS0FBS0csYUFBTCxFQUFKLEVBQTBCO0FBQ3RCbkIsZ0NBQW9CLEVBQUM5SCxrQkFBRCxFQUFXcEMsa0JBQVgsRUFBcEI7QUFDSCxTQUZELE1BRU87QUFDSDtBQUNBLGdCQUFJa0wsS0FBS0ksY0FBVCxFQUF5QjtBQUNyQkoscUJBQUtJLGNBQUw7QUFDSDtBQUNETCxrQkFBTXZILFFBQU4sQ0FBZXlILGtCQUFmO0FBQ0g7O0FBRUQsWUFBSSxDQUFDL0ksUUFBRCxJQUFhLENBQUNwQyxRQUFsQixFQUE0QjtBQUN4QnNILG9CQUFRQyxHQUFSLENBQVksMEJBQVo7QUFDQTtBQUNIO0FBQ0osS0EzQkQ7QUE0Qkg7O0FBRUQsU0FBU2dFLGNBQVQsR0FBd0IsYUFBZTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQUlsSixpQkFBaUIsRUFBckI7O0FBRUFRLE1BQUUseUJBQUYsRUFBNkIwRixFQUE3QixDQUFnQyxPQUFoQyxFQUF5QyxVQUFDa0MsQ0FBRCxFQUFPO0FBQzVDLFlBQU1lLFVBQVUzSSxFQUFFNEgsRUFBRUUsTUFBSixDQUFoQjtBQUNBLFlBQU12SSxXQUFXb0osUUFBUXRFLElBQVIsQ0FBYSxVQUFiLENBQWpCO0FBQ0E3RSx5QkFBaUJtSixRQUFRdEUsSUFBUixDQUFhLGdCQUFiLEtBQWtDN0UsY0FBbkQ7QUFDQTtBQUNBO0FBQ0EsWUFBTW9KLFNBQVVwSixtQkFBbUIsT0FBcEIsR0FBK0IsU0FBL0IsR0FBMkMsT0FBMUQ7QUFDQTs7QUFFQSxZQUFJQSxtQkFBbUIsZ0JBQXZCLEVBQXlDO0FBQ3JDb0ksY0FBRWlCLGVBQUY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E3SSxjQUFFLDZCQUFGLEVBQWlDOEksS0FBakMsQ0FBdUMsRUFBQ2xDLE1BQU0sSUFBUCxFQUFhckgsa0JBQWIsRUFBdkM7O0FBRUE7QUFDQTtBQUNIOztBQUVEakIsdUJBQUt5SyxjQUFMLENBQW9CeEosUUFBcEIsRUFBOEJDLGNBQTlCLEVBQThDeUUsSUFBOUMsQ0FBbUQsVUFBQ0MsTUFBRCxFQUFZO0FBQzNETyxvQkFBUUMsR0FBUixDQUFZLHVCQUFaLEVBQXFDUixPQUFPQyxNQUFQLENBQWNDLEtBQW5EO0FBQ0EsZ0JBQUlGLE9BQU9DLE1BQVAsQ0FBY0MsS0FBZCxLQUF3QixJQUE1QixFQUFrQztBQUM5QixvQkFBTTRFLFNBQVNoSixFQUFFLGdCQUFGLENBQWY7O0FBRUE7QUFDQUEsa0JBQUUsc0JBQUYsRUFBMEJnSixNQUExQixFQUFrQy9JLEtBQWxDLEdBQTBDYSxJQUExQyx3TkFBMEY4SCxNQUExRjtBQUNIO0FBQ0osU0FSRDtBQVNILEtBOUJEOztBQWdDQTtBQUNBNUksTUFBRSwyQkFBRixFQUErQjBGLEVBQS9CLENBQWtDLE9BQWxDLEVBQTJDLFVBQUNrQyxDQUFELEVBQU87QUFDOUMsWUFBTUMsTUFBTTdILEVBQUU0SCxFQUFFRSxNQUFKLENBQVo7QUFDQSxZQUFNdkksV0FBV3NJLElBQUl4RCxJQUFKLENBQVMsVUFBVCxDQUFqQjtBQUNBLFlBQU00RSxZQUFZcEIsSUFBSUcsT0FBSixDQUFZLFFBQVosRUFBc0JDLElBQXRCLENBQTJCLHlDQUEzQixDQUFsQjtBQUNBLFlBQU14SSxNQUFNd0osVUFBVWYsR0FBVixHQUFnQkMsSUFBaEIsRUFBWjtBQUNBLFlBQU1hLFNBQVNuQixJQUFJRyxPQUFKLENBQVksUUFBWixDQUFmO0FBQ0FKLFVBQUVpQixlQUFGOztBQUVBLFlBQUlwSixJQUFJeUosTUFBSixLQUFlLENBQW5CLEVBQXNCO0FBQ2xCO0FBQ0g7QUFDRDVLLHVCQUFLNkssa0JBQUwsQ0FBd0IxSixHQUF4QixFQUE2QkYsUUFBN0IsRUFBdUMwRSxJQUF2QyxDQUE0QyxVQUFDQyxNQUFELEVBQVk7QUFDcEQsZ0JBQUlBLE9BQU9DLE1BQVAsQ0FBY0MsS0FBZCxLQUF3QixJQUE1QixFQUFrQztBQUM5QjtBQUNIO0FBQ0RLLG9CQUFRQyxHQUFSLENBQVksYUFBWixFQUEyQlIsT0FBT0MsTUFBUCxDQUFjQyxLQUF6QyxFQUFnRCxhQUFoRDtBQUNBNEUsbUJBQU9GLEtBQVAsQ0FBYSxNQUFiO0FBQ0gsU0FORCxFQU1HckIsS0FOSCxDQU1TLFVBQUNDLEdBQUQsRUFBUztBQUNkakQsb0JBQVFDLEdBQVIsQ0FBWSxLQUFaO0FBQ0ExRSxjQUFFLHNCQUFGLEVBQTBCZ0osTUFBMUIsRUFBa0NsSSxJQUFsQyxDQUF1QyxxQkFBdkMsRUFBOERvRixHQUE5RCxDQUFrRSxPQUFsRSxFQUEyRSxLQUEzRTtBQUNBekIsb0JBQVFDLEdBQVIsQ0FBWWdELEdBQVo7QUFDSCxTQVZEO0FBV0gsS0F0QkQ7O0FBd0JBMUgsTUFBRSx1QkFBRixFQUEyQjBGLEVBQTNCLENBQThCLE1BQTlCLEVBQXNDLFlBQVk7QUFDOUMsWUFBTTBELE1BQU1wSixFQUFFLElBQUYsRUFBUWtJLEdBQVIsR0FBY0MsSUFBZCxHQUFxQmUsTUFBakM7QUFDQSxZQUFNRyxTQUFTQyxPQUFPdEosRUFBRSxJQUFGLEVBQVF1SixJQUFSLENBQWEsV0FBYixDQUFQLENBQWY7QUFDQTtBQUNBLFlBQUlGLFdBQVdELEdBQWYsRUFBb0I7QUFDaEJwSixjQUFFLElBQUYsRUFBUWtHLEdBQVIsQ0FBWSxhQUFaLEVBQTJCLEtBQTNCO0FBQ0gsU0FGRCxNQUVPO0FBQ0hsRyxjQUFFLElBQUYsRUFBUWtHLEdBQVIsQ0FBWSxhQUFaLEVBQTJCLFNBQTNCO0FBQ0g7QUFDRDtBQUNILEtBVkQ7O0FBWUEsYUFBU3NELFdBQVQsQ0FBcUI1QixDQUFyQixFQUF3QjtBQUNwQixZQUFNb0IsU0FBU2hKLEVBQUU0SCxFQUFFRSxNQUFKLENBQWY7QUFDQWtCLGVBQU9mLElBQVAsQ0FBWSxhQUFaLEVBQTJCNUIsV0FBM0IsQ0FBdUMsUUFBdkM7QUFDQTJDLGVBQU9mLElBQVAsQ0FBWSxjQUFaLEVBQTRCcEgsUUFBNUIsQ0FBcUMsUUFBckM7QUFDQWIsVUFBRSxpQkFBRixFQUFxQmtJLEdBQXJCLENBQXlCLEVBQXpCO0FBQ0FsSSxVQUFFLHNCQUFGLEVBQTBCZ0osTUFBMUIsRUFBa0NTLFVBQWxDLENBQTZDLE9BQTdDLEVBQXNEeEosS0FBdEQ7QUFDSDtBQUNERCxNQUFFLDZCQUFGLEVBQWlDMEYsRUFBakMsQ0FBb0MsZUFBcEMsRUFBcUQ4RCxXQUFyRDtBQUNBeEosTUFBRSxnQkFBRixFQUFvQjBGLEVBQXBCLENBQXVCLGVBQXZCLEVBQXdDOEQsV0FBeEM7O0FBRUE7QUFDQXhKLE1BQUUsb0NBQUYsRUFBd0MwRixFQUF4QyxDQUEyQyxPQUEzQyxFQUFvRCxVQUFDa0MsQ0FBRCxFQUFPO0FBQ3ZELFlBQU1vQixTQUFTaEosRUFBRSw2QkFBRixDQUFmO0FBQ0EsWUFBTTBKLGVBQWUxSixFQUFFNEgsRUFBRUUsTUFBSixFQUFZRSxPQUFaLENBQW9CZ0IsTUFBcEIsRUFBNEJmLElBQTVCLENBQWlDLHFDQUFqQyxDQUFyQjtBQUNBLFlBQU0wQix1QkFBdUJELGFBQWF4QixHQUFiLEVBQTdCO0FBQ0EsWUFBTVUsU0FBVWUseUJBQXlCLE9BQTFCLEdBQXFDLFNBQXJDLEdBQWlELE9BQWhFO0FBQ0EsWUFBTUMsY0FBY1osT0FBTzNFLElBQVAsR0FBYyxVQUFkLEVBQTBCd0YsT0FBOUM7QUFDQSxZQUFNdEssV0FBV3FLLFlBQVlySyxRQUE3QjtBQUNBakIsdUJBQUt5SyxjQUFMLENBQW9CeEosUUFBcEIsRUFBOEJvSyxvQkFBOUIsRUFBb0QxRixJQUFwRCxDQUF5RCxVQUFDQyxNQUFELEVBQVk7QUFDakU7QUFDQTs7QUFFQTtBQUNBTyxvQkFBUUMsR0FBUixDQUFZLHVCQUFaLEVBQXFDUixPQUFPQyxNQUFQLENBQWNDLEtBQW5EO0FBQ0EsZ0JBQUlGLE9BQU9DLE1BQVAsQ0FBY0MsS0FBZCxLQUF3QixJQUE1QixFQUFrQztBQUM5QnBFLGtCQUFFLGFBQUYsRUFBaUJnSixNQUFqQixFQUF5Qm5JLFFBQXpCLENBQWtDLFFBQWxDO0FBQ0FiLGtCQUFFLGNBQUYsRUFBa0JnSixNQUFsQixFQUEwQjNDLFdBQTFCLENBQXNDLFFBQXRDO0FBQ0FyRyxrQkFBRSxzQkFBRixFQUEwQmdKLE1BQTFCLEVBQWtDL0ksS0FBbEMsR0FBMENhLElBQTFDLHdOQUEwRjhILE1BQTFGO0FBQ0g7QUFDSixTQVhEO0FBWUgsS0FuQkQ7QUFvQkg7O0FBRUQsU0FBU3pJLFFBQVQsQ0FBa0JDLEtBQWxCLEVBQXlCQyxTQUF6QixFQUFvQztBQUNoQyxRQUFNQyxRQUFRRCxTQUFkO0FBQ0EsUUFBTUUsUUFBUUgsS0FBZDtBQUNBLFFBQU0wSixtQkFBbUIsaUNBQXpCO0FBQ0EsUUFBTUMsYUFBYSxTQUFiQSxVQUFhLENBQUMxRixJQUFELEVBQU92RCxJQUFQLEVBQWFrSixNQUFiLEVBQXdCO0FBQ3ZDLFlBQU1DLGNBQVk1RixJQUFELG9DQUNvQjJGLE1BRHBCLCtCQUNvRDNGLElBRHBELHFCQUN3RXZELElBRHhFLHFEQUVvQmtKLE1BRnBCLDZDQUVrRWxKLElBRmxFLGlCQUFYLENBQU47QUFHQSxlQUFPbUosS0FBUDtBQUNILEtBTEQ7QUFNQSxRQUFNQyxRQUFRLFNBQVJBLEtBQVEsQ0FBQ0MsSUFBRCxFQUFVO0FBQ3BCLFlBQU1DLHlHQUVDRCxJQUFELEdBQ0tKLFdBQVdJLEtBQUssYUFBTCxDQUFYLEVBQWdDLFlBQWhDLEVBQThDLGFBQTlDLENBREwsMEJBRUlKLFdBQVdJLEtBQUssZ0JBQUwsQ0FBWCxFQUFtQyxZQUFuQyxFQUFpRCxnQkFBakQsQ0FGSiwwQkFHSUosV0FBV0ksS0FBSyxpQkFBTCxDQUFYLEVBQW9DLFVBQXBDLEVBQWdELGlCQUFoRCxDQUhKLEdBSUtKLFdBQVcsS0FBWCxFQUFrQixZQUFsQixFQUFnQyxhQUFoQyxDQUpMLDBCQUtJQSxXQUFXLEtBQVgsRUFBa0IsWUFBbEIsRUFBZ0MsZ0JBQWhDLENBTEosMEJBTUlBLFdBQVcsS0FBWCxFQUFrQixVQUFsQixFQUE4QixpQkFBOUIsQ0FSSix5Q0FBTjtBQVlBLGVBQU9LLEdBQVA7QUFDSCxLQWREO0FBZUE3SixVQUFNTixLQUFOLEdBQWNZLFFBQWQsQ0FBdUIsb0JBQXZCO0FBQ0FQLFVBQU1FLE9BQU4sQ0FBYyxVQUFDQyxJQUFELEVBQVU7QUFDcEIsWUFBTTBKLE9BQU8xSixLQUFLMEosSUFBbEI7QUFDQSxZQUFNRSxhQUFhNUosS0FBSzRKLFVBQUwsSUFBbUI1SixJQUF0Qzs7QUFFQSxZQUFJLENBQUMwSixJQUFMLEVBQVc7QUFDUG5LLGdIQUMwRDhKLGdCQUQxRCx1SUFJZXJKLEtBQUtsQixRQUFOLG1DQUFnRGtCLEtBQUtsQixRQUFyRCxhQUF1RSxFQUpyRiwrSEFPZThLLFdBQVdsRyxNQUFYLEtBQXNCLFdBQXZCLDZJQUUwQmtHLFdBQVdDLElBRnJDLHVEQUdtQjdKLEtBQUtsQixRQUFMLElBQWlCLEVBSHBDLDhRQU02QjhLLFdBQVdsRyxNQWJ0RCwyREFlVStGLE9BZlYsa0RBaUJRdEosUUFqQlIsQ0FpQmlCTCxLQWpCakI7QUFrQkgsU0FuQkQsTUFtQk87QUFDSFAseURBQ0dtSyxLQUFLLGlCQUFMLENBQUQsd0RBQ3VEQSxLQUFLLGlCQUFMLENBRHZELG1FQUUyREwsZ0JBRjNELE9BREYsMEhBTVdySixLQUFLbEIsUUFBTixrQ0FBK0NrQixLQUFLbEIsUUFBcEQsWUFBcUUsRUFOL0UsZ0NBT1c0SyxLQUFLOUwsSUFBTiw4QkFBdUM4TCxLQUFLOUwsSUFBNUMsYUFBMEQsRUFQcEUsZ0NBUVc4TCxLQUFLOUwsSUFBTixHQUFjLEVBQWQsR0FBbUIsV0FSN0IsQ0FRMEM7MnBCQVIxQyx5SUFhV2dNLFdBQVdsRyxNQUFYLEtBQXNCLFdBQXZCLCtHQUNzR2tHLFdBQVdDLElBRGpILHlNQUdKLEVBaEJOLG1EQWtCTUosTUFBTUMsSUFBTixDQWxCTiwwQ0FvQkl2SixRQXBCSixDQW9CYUwsS0FwQmI7QUFxQkg7QUFDSixLQTlDRDtBQStDSDs7QUFFRDs7O0FBR08sU0FBU3lDLElBQVQsR0FBZ0I7QUFDbkIsUUFBTXdFLFdBQVd4SCxFQUFFLGdCQUFGLENBQWpCO0FBQ0E7QUFDQSxRQUFJLENBQUN3SCxTQUFTMEIsTUFBZCxFQUFzQjtBQUNsQjtBQUNIO0FBQ0QsUUFBTTlMLFFBQVFrQixlQUFLTyxRQUFMLEVBQWQsQ0FObUIsQ0FNWTtBQUMvQixRQUFNMEwsV0FBV2pNLGVBQUtrTSxXQUFMLENBQWlCcE4sS0FBakIsQ0FBakI7QUFDQSxRQUFNcU4sZ0JBQWdCLFNBQWhCQSxhQUFnQjtBQUFBLGVBQU1uTSxlQUFLa00sV0FBTCxDQUFpQnBOLEtBQWpCLENBQU47QUFBQSxLQUF0QjtBQUNBLFFBQUlzTixnQkFBZ0IsS0FBcEI7QUFDQSxRQUFNQyxnQkFBZ0IsU0FBaEJBLGFBQWdCLENBQUN6RyxNQUFELEVBQVMwRyxlQUFULEVBQTZCO0FBQy9DLFlBQUksQ0FBQzFHLE9BQU9DLE1BQVAsQ0FBY0MsS0FBZixLQUF5QixJQUF6QixJQUFpQyxDQUFDRixPQUFPRyxJQUF6QyxJQUFpRCxDQUFDbUQsU0FBUzBCLE1BQTNELElBQXFFMEIsZUFBekUsRUFBMEY7QUFDdEY7QUFDQXBELHFCQUFTdkgsS0FBVDtBQUNBRCxnVkFJUVksUUFKUixDQUlpQjRHLFFBSmpCO0FBS0E3Qyx1QkFBVyxZQUFNO0FBQ2I4RixnQ0FBZ0J4RyxJQUFoQixDQUFxQixVQUFDQyxNQUFELEVBQVk7QUFDN0J5RyxrQ0FBY3pHLE1BQWQsRUFBc0IsS0FBdEI7QUFDSCxpQkFGRDtBQUdBTyx3QkFBUUMsR0FBUixDQUFZLGdCQUFaO0FBQ0gsYUFMRCxFQUtHLElBTEg7QUFNQTtBQUNIO0FBQ0Q7QUFDQTFFLFVBQUUsNEJBQUYsRUFBZ0NhLFFBQWhDLENBQXlDLFFBQXpDO0FBQ0FWLGlCQUFTcUgsUUFBVCxFQUFtQnRELE9BQU9HLElBQVAsQ0FBWXdHLFFBQS9CO0FBQ0FuQztBQUNILEtBckJEOztBQXVCQTtBQUNBLFFBQUksQ0FBQ2xCLFNBQVMwQixNQUFkLEVBQXNCO0FBQ2xCO0FBQ0g7O0FBRUR2Qjs7QUFFQTs7QUFFQTRDLGFBQVN0RyxJQUFULENBQWMsVUFBQ0MsTUFBRCxFQUFZO0FBQ3RCO0FBQ0EsWUFBSTBHLGtCQUFrQixLQUF0QjtBQUNBLFlBQUkxRyxPQUFPRyxJQUFQLElBQWVILE9BQU9HLElBQVAsQ0FBWXdHLFFBQTNCLElBQXVDLENBQUNILGFBQTVDLEVBQTJEO0FBQ3ZEeEcsbUJBQU9HLElBQVAsQ0FBWXdHLFFBQVosQ0FBcUJySyxPQUFyQixDQUE2QixVQUFDQyxJQUFELEVBQVU7QUFDbkMsb0JBQUksQ0FBQ0EsS0FBSzBKLElBQVYsRUFBZ0I7QUFDWlMsc0NBQWtCLElBQWxCO0FBQ0FGLG9DQUFnQixJQUFoQjtBQUNBO0FBQ0g7QUFDSixhQU5EO0FBT0g7QUFDREMsc0JBQWN6RyxNQUFkLEVBQXNCMEcsZUFBdEI7QUFDSCxLQWJELEVBYUduRCxLQWJILENBYVMsVUFBQ0MsR0FBRCxFQUFTO0FBQ2QvQyxtQkFBVyxZQUFNO0FBQ2JoRiwyQkFBVUMsZUFBVixDQUEwQkksRUFBRSxZQUFGLENBQTFCLEVBQ0kwSCxJQUFJdkQsTUFBSixJQUFjLEVBRGxCLEVBRUksc0RBRko7QUFHSCxTQUpELEVBSUcsSUFKSDtBQUtBbkUsVUFBRSxjQUFGLEVBQWtCYSxRQUFsQixDQUEyQixRQUEzQjtBQUNILEtBcEJEO0FBcUJILEM7Ozs7Ozs7Ozs7OztRQ3RaZWlLLFMsR0FBQUEsUzs7QUFUaEI7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUVBOztBQUpBO0FBTU8sU0FBU0EsU0FBVCxDQUFtQkMsV0FBbkIsRUFBZ0M7QUFBQTs7QUFBQSxRQUM1QnBJLE9BRDRCLEdBQytCb0ksV0FEL0IsQ0FDNUJwSSxPQUQ0QjtBQUFBLFFBQ25CQyxlQURtQixHQUMrQm1JLFdBRC9CLENBQ25CbkksZUFEbUI7QUFBQSxRQUNGQyxrQkFERSxHQUMrQmtJLFdBRC9CLENBQ0ZsSSxrQkFERTtBQUFBLFFBQ2tCSCxTQURsQixHQUMrQnFJLFdBRC9CLENBQ2tCckksU0FEbEI7O0FBRW5DLFFBQU16RixPQUFPcUIsY0FBYjtBQUFBLFFBQW1CO0FBQ2Y4SixZQUFRcEksRUFBRTJDLE9BQUYsQ0FEWjtBQUFBLFFBRUlxSSxTQUFTNUMsTUFBTUgsSUFBTixDQUFXLG9CQUFYLENBRmI7QUFBQSxRQUdJZ0QsdUJBQXVCakwsRUFBRSxjQUFGLENBSDNCO0FBSUE7QUFDQTs7QUFFQSxRQUFNa0wsa0JBQWtCLFNBQWxCQSxlQUFrQixDQUFDQyxTQUFELEVBQWU7QUFDbkMsWUFBTWxNLFVBQVUsU0FBVkEsT0FBVSxDQUFDaUYsTUFBRCxFQUFZO0FBQ3hCbEUsY0FBRTBDLFNBQUYsRUFBYXhDLE1BQWIsQ0FBb0IsOEJBQXBCO0FBQ0gsU0FGRDs7QUFJQSxlQUFPakQsS0FBS04sS0FBTCxDQUFXd08sU0FBWCxFQUFzQmxNLE9BQXRCLEVBQ0ZnRixJQURFLENBQ0csVUFBQ0MsTUFBRCxFQUFZO0FBQ2QsZ0JBQUlBLFVBQVVBLE9BQU9HLElBQWpCLElBQXlCSCxPQUFPRyxJQUFQLENBQVlqSCxLQUF6QyxFQUFnRDtBQUM1QztBQUNBQyxpQ0FBY21FLEdBQWQsQ0FBa0JqRixjQUFNYyxhQUFOLENBQW9CRCxLQUF0QyxFQUE2QzhHLE9BQU9HLElBQVAsQ0FBWWpILEtBQXpEO0FBQ0E0QyxrQkFBRSxxQkFBRixFQUF5QjJHLE1BQXpCLEdBQWtDQyxJQUFsQztBQUNBO0FBQ0FqSCwrQkFBVUMsZUFBVixDQUEwQnFMLG9CQUExQixFQUNJL0csT0FBT0MsTUFBUCxDQUFjQyxLQURsQixFQUVJRixPQUFPQyxNQUFQLENBQWNvRCxPQUFkLElBQXlCLGdCQUY3QjtBQUdILGFBUkQsTUFRTyxJQUFJckQsT0FBT0MsTUFBWCxFQUFtQjtBQUN0Qk0sd0JBQVFDLEdBQVIsQ0FBWVIsTUFBWjtBQUNBdkUsK0JBQVVDLGVBQVYsQ0FBMEIsTUFBS3FMLG9CQUEvQixrQkFDa0IvRyxPQUFPQyxNQUFQLENBQWNDLEtBRGhDLHlCQUN5REYsT0FBT0MsTUFBUCxDQUFjb0QsT0FEdkU7QUFFSCxhQUpNLE1BSUE7QUFDSDlDLHdCQUFRQyxHQUFSLENBQVlSLE1BQVo7QUFDSDtBQUNKLFNBakJFLEVBaUJBRCxJQWpCQSxDQWlCSyxVQUFDQyxNQUFELEVBQVk7QUFDaEIsZ0JBQUlBLFVBQVVBLE9BQU9DLE1BQXJCLEVBQTZCO0FBQ3pCTSx3QkFBUUMsR0FBUixDQUFZUixNQUFaO0FBQ0F2RSwrQkFBVUMsZUFBVixDQUEwQnFMLG9CQUExQixFQUNJL0csT0FBT0MsTUFBUCxDQUFjQyxLQURsQixFQUVJRixPQUFPQyxNQUFQLENBQWNvRCxPQUFkLElBQXlCLGFBRjdCO0FBR0g7QUFDSixTQXhCRSxDQUFQO0FBeUJILEtBOUJEOztBQWdDQSxRQUFNNkQsYUFBYSxTQUFiQSxVQUFhLENBQVNDLFdBQVQsRUFBc0I7QUFDckMsWUFBTW5PLFFBQVE4TixPQUFPOUMsR0FBUCxFQUFkO0FBQUEsWUFDSS9LLFdBQVdpTCxNQUFNSCxJQUFOLENBQVcsb0JBQVgsRUFBaUNDLEdBQWpDLEVBRGY7QUFBQSxZQUVJaUQsWUFBWUUsZUFBZSxFQUFDbk8sWUFBRCxFQUFRQyxrQkFBUixFQUYvQjs7QUFJQSxZQUFJNE4sWUFBWWhJLGdCQUFoQixFQUFrQztBQUM5QjtBQUNBO0FBQ0gsU0FIRCxNQUdPO0FBQ0hpSSxtQkFBTzlDLEdBQVAsQ0FBVzhDLE9BQU85QyxHQUFQLEdBQWFvRCxpQkFBYixFQUFYO0FBQ0FKLDRCQUFnQkMsU0FBaEIsRUFBMkJsSCxJQUEzQixDQUFnQyxZQUFNO0FBQ2xDaUQsbUNBQU9xRSxPQUFQLENBQWVoUCxjQUFNd0IsTUFBTixDQUFhQyxXQUE1QixFQUF5QyxPQUF6QztBQUNILGFBRkQ7QUFHSDtBQUNKLEtBZEQ7O0FBZ0JBLFFBQU13TixTQUFTLFNBQVRBLE1BQVMsR0FBVztBQUN0Qm5PLHlCQUFjK0UsTUFBZCxDQUFxQjdGLGNBQU1jLGFBQU4sQ0FBb0JELEtBQXpDO0FBQ0E4SiwyQkFBT3FFLE9BQVAsQ0FBZWhQLGNBQU13QixNQUFOLENBQWFFLFdBQTVCO0FBQ0gsS0FIRDs7QUFLQSxRQUFNd04sYUFBYSxTQUFiQSxVQUFhLEdBQVc7QUFDMUIsWUFBTUMscUJBQXFCMUwsRUFBRTZDLGtCQUFGLENBQTNCO0FBQ0EsWUFBTW1FLFlBQVloSCxFQUFFMEMsU0FBRixDQUFsQjtBQUNBLFlBQU1xRCxjQUFjLFNBQXBCO0FBQ0EsWUFBTUQsYUFBYSxRQUFuQjs7QUFFQTRGLDJCQUFtQmhHLEVBQW5CLENBQXNCLE9BQXRCLEVBQStCLFlBQU07QUFDakMsZ0JBQUksQ0FBQ3FGLFlBQVloSSxnQkFBakIsRUFBbUM7QUFDL0JpRSwwQkFBVWQsR0FBVixDQUFjLEVBQUMsT0FBTyxDQUFSLEVBQVcsU0FBUyxDQUFwQixFQUFkLEVBQ0tyRixRQURMLENBQ2MsZ0RBRGQ7QUFFSDtBQUNEbUcsc0JBQVVuRyxRQUFWLENBQW1Ca0YsV0FBbkIsRUFBZ0NNLFdBQWhDLENBQTRDUCxVQUE1QztBQUNILFNBTkQ7O0FBUUEsWUFBTTZGLGdCQUFnQjNMLEVBQUU0QyxlQUFGLENBQXRCO0FBQUEsWUFDSTBGLHFCQUFxQixpQkFEekI7O0FBR0FxRCxzQkFBY2pHLEVBQWQsQ0FBaUIsT0FBakIsRUFBMEIsVUFBQ2tDLENBQUQsRUFBTztBQUM3QkEsY0FBRVcsY0FBRjtBQUNBLGdCQUFNRixPQUFPRCxNQUFNdEosR0FBTixDQUFVLENBQVYsQ0FBYjtBQUNBO0FBQ0E7QUFDQSxnQkFBSXVKLEtBQUtHLGFBQUwsTUFBd0I3SSxlQUFVb0IsT0FBVixDQUFrQmlLLE9BQU85QyxHQUFQLEVBQWxCLENBQTVCLEVBQTZEO0FBQ3pEa0Q7QUFDSCxhQUZELE1BRU87QUFDSDtBQUNBLG9CQUFJL0MsS0FBS0ksY0FBVCxFQUF5QjtBQUNyQkoseUJBQUtJLGNBQUw7QUFDSDtBQUNETCxzQkFBTXZILFFBQU4sQ0FBZXlILGtCQUFmO0FBQ0g7QUFDSixTQWREOztBQWdCQXRJLFVBQUUscUJBQUYsRUFBeUIwRixFQUF6QixDQUE0QixPQUE1QixFQUFxQyxVQUFDa0MsQ0FBRCxFQUFPO0FBQ3hDQSxjQUFFVyxjQUFGO0FBQ0FpRDtBQUNBeEwsY0FBRTRILEVBQUVFLE1BQUosRUFBWW5CLE1BQVosR0FBcUJTLElBQXJCO0FBQ0F6SCwyQkFBVUMsZUFBVixDQUEwQnFMLG9CQUExQixFQUFnRCxZQUFoRDtBQUNILFNBTEQ7O0FBT0EvRCwyQkFBT0MsU0FBUCxDQUFpQjVLLGNBQU13QixNQUFOLENBQWFFLFdBQTlCLEVBQTJDLFVBQUNtSSxHQUFELEVBQVM7QUFDaERwRyxjQUFFekQsY0FBTWdCLFdBQU4sQ0FBa0JFLGlCQUFwQixFQUF1Q29ELFFBQXZDLENBQWdEa0YsV0FBaEQsRUFBNkRNLFdBQTdELENBQXlFUCxVQUF6RSxFQURnRCxDQUNzQztBQUN0RjlGLGNBQUV6RCxjQUFNZ0IsV0FBTixDQUFrQkksWUFBcEIsRUFBa0NrRCxRQUFsQyxDQUEyQ2tGLFdBQTNDLEVBQXdETSxXQUF4RCxDQUFvRVAsVUFBcEU7QUFDQTlGLGNBQUUscUJBQUYsRUFBeUJhLFFBQXpCLENBQWtDaUYsVUFBbEMsRUFBOENPLFdBQTlDLENBQTBETixXQUExRCxFQUhnRCxDQUd3QjtBQUN4RSxnQkFBTUgscUJBQXFCLDBCQUEzQjtBQUNBNUYsY0FBRTRGLGtCQUFGLEVBQXNCOUUsSUFBdEIsQ0FBMkIsc0JBQTNCO0FBQ0gsU0FORDs7QUFRQWQsVUFBRW9CLFFBQUYsRUFBWXNFLEVBQVosQ0FBZSxPQUFmLEVBQXdCLFVBQUNrRyxLQUFELEVBQVc7QUFDL0IsZ0JBQU1DLGtCQUFrQjdMLEVBQUU0TCxNQUFNOUQsTUFBUixFQUFnQkUsT0FBaEIsQ0FBd0IsWUFBeEIsRUFBc0NDLElBQXRDLENBQTJDakIsU0FBM0MsRUFBc0RrQyxNQUE5RTtBQUNBLGdCQUFNNEMsMkJBQTJCOUwsRUFBRTRMLE1BQU05RCxNQUFSLEVBQWdCeUIsSUFBaEIsQ0FBcUIsSUFBckIsTUFBK0JoTixjQUFNZ0IsV0FBTixDQUFrQkssU0FBbEIsQ0FBNEJFLGVBQTVGOztBQUVBLGdCQUFJLENBQUMrTixlQUFELElBQW9CN0UsVUFBVStFLFFBQVYsQ0FBbUJoRyxXQUFuQixDQUFwQixJQUF1RCxDQUFDK0Ysd0JBQTVELEVBQXNGO0FBQ2xGOUUsMEJBQVVuRyxRQUFWLENBQW1CaUYsVUFBbkIsRUFBK0JPLFdBQS9CLENBQTJDTixXQUEzQztBQUNIO0FBQ0osU0FQRDtBQVFILEtBeEREOztBQTBEQSxhQUFTL0MsSUFBVCxHQUFnQjtBQUNaeUk7QUFDSDs7QUFFRCxXQUFPO0FBQ0h6STtBQURHLEtBQVA7QUFHSCxDLENBdkkrQjtBQUhoQztBQUNBLDBCOzs7Ozs7Ozs7Ozs7QUNEQSxJQUFNZ0osZUFBZTtBQUNqQixZQUFRO0FBQ0osZ0JBQVE7QUFDSiwwQkFBYztBQUNWLCtCQUFlLEtBREw7QUFFViwrQkFBZTtBQUZMLGFBRFY7QUFLSix3QkFBWSxDQUNSO0FBQ0ksNEJBQVksTUFEaEI7QUFFSSxtQ0FBbUIscU1BRnZCO0FBR0ksd0JBQVEsTUFIWjtBQUlJLHdCQUFRLE9BSlosRUFJcUI7QUFDakIseUJBQVMsNENBTGI7QUFNSSw2QkFBYTs7QUFOakIsYUFEUSxFQVVSO0FBQ0ksd0JBQVEsT0FEWjtBQUVJLHdCQUFRLE1BRlo7QUFHSSx5QkFBUyxZQUhiO0FBSUksNkJBQWE7QUFKakIsYUFWUSxFQWdCUjtBQUNJLDRCQUFZLE1BRGhCO0FBRUksbUNBQW1CLHFNQUZ2QjtBQUdJLHdCQUFRLE1BSFo7QUFJSSx3QkFBUSxNQUpaLEVBSW9CO0FBQ2hCLHlCQUFTLHlCQUxiO0FBTUksNkJBQWE7QUFOakIsYUFoQlEsRUF3QlI7QUFDSSw0QkFBWSxNQURoQjtBQUVJLG1DQUFtQixxTUFGdkI7QUFHSSx3QkFBUSxNQUhaO0FBSUksd0JBQVEsTUFKWixFQUlvQjtBQUNoQix5QkFBUyw0Q0FMYjtBQU1JLDZCQUFhO0FBTmpCLGFBeEJRLEVBZ0NSO0FBQ0ksd0JBQVEsT0FEWjtBQUVJLHdCQUFRLE9BRlo7QUFHSSx5QkFBUywrREFIYjtBQUlJLDZCQUFhO0FBSmpCLGFBaENRLEVBc0NSO0FBQ0ksd0JBQVEsT0FEWjtBQUVJLHdCQUFRLE1BRlo7QUFHSSx5QkFBUywyQkFIYjtBQUlJLDZCQUFhO0FBSmpCLGFBdENRLEVBNENSO0FBQ0ksd0JBQVEsT0FEWjtBQUVJLHdCQUFRLE1BRlo7QUFHSSx5QkFBUyw2Q0FIYjtBQUlJLDZCQUFhO0FBSmpCLGFBNUNRO0FBTFI7QUFESjtBQURTLENBQXJCOztBQThEQSxJQUFNQyxXQUFXO0FBQ2IsWUFBUTtBQUNKLG9CQUFZO0FBQ1IsK0JBQW1CLElBRFg7QUFFUixnQ0FBb0I7QUFGWixTQURSO0FBS0osZ0JBQVEsQ0FDSjtBQUNJLHdCQUFZLGVBRGhCO0FBRUksb0NBQXdCLENBRjVCO0FBR0ksMEJBQWM7QUFDViwrQkFBZSxLQURMO0FBRVYsK0JBQWU7QUFGTCxhQUhsQjtBQU9JLDZCQUFpQixDQUNiO0FBQ0ksc0JBQU0sR0FEVjtBQUVJLHdCQUFRLE9BRlo7QUFHSSxzQkFBTSxDQUNGO0FBQ0ksZ0NBQVksYUFEaEI7QUFFSSx1Q0FBbUI7QUFGdkIsaUJBREUsRUFLRjtBQUNJLGdDQUFZLFlBRGhCO0FBRUksdUNBQW1CO0FBRnZCLGlCQUxFLENBSFY7QUFhSSxnQ0FBZ0IsS0FicEI7QUFjSSw2QkFBYTtBQWRqQixhQURhLEVBaUJiO0FBQ0ksc0JBQU0sR0FEVjtBQUVJLHdCQUFRLFNBRlo7QUFHSSxzQkFBTSxDQUNGO0FBQ0ksZ0NBQVksYUFEaEI7QUFFSSx1Q0FBbUI7QUFGdkIsaUJBREUsQ0FIVjtBQVNJLCtCQUFlLGFBVG5CO0FBVUksZ0NBQWdCLHlEQVZwQjtBQVdJLDZCQUFhO0FBWGpCLGFBakJhO0FBUHJCLFNBREk7QUFMSjs7QUFESyxDQUFqQjs7UUFtRFFBLFEsR0FBQUEsUTtRQUFVRCxZLEdBQUFBLFk7Ozs7Ozs7Ozs7OztRQ2tCRmhKLEksR0FBQUEsSTs7QUFuSWhCOztJQUFZcUIsSTs7QUFDWjs7OztBQUNBOzs7Ozs7OztBQUVBckUsRUFBRW9CLFFBQUYsRUFBWThLLEtBQVosQ0FBa0IsWUFBTTtBQUNwQjtBQUNBLFFBQU1DLElBQUksSUFBSUMscUJBQUosRUFBVjtBQUNBLFFBQU1DLFVBQVVyTSxFQUFFLDBDQUFGLENBQWhCO0FBQ0EsUUFBTXNNLFFBQVFELFFBQVE5QyxJQUFSLENBQWEsT0FBYixDQUFkO0FBQ0EsUUFBTWdELFdBQVdELE1BQU03SSxPQUFOLENBQWMsWUFBZCxFQUE0QixjQUE1QixDQUFqQjtBQUNBNEksWUFBUTlDLElBQVIsQ0FBYSxPQUFiLEVBQXNCZ0QsUUFBdEI7QUFDSCxDQVBEOztBQVNBdk0sRUFBRW9CLFFBQUYsRUFBWThLLEtBQVosQ0FBa0IsWUFBTTtBQUNwQjtBQUNBLFFBQU1NLHFCQUFxQixJQUFJQyx1QkFBR0MsWUFBUCxDQUFvQjtBQUMzQ0MsaUJBQVN2TCxTQUFTd0wsY0FBVCxDQUF3QiwwQkFBeEIsQ0FEa0M7QUFFM0NDLGtCQUFVLHdCQUZpQztBQUczQ0MsaUJBQVM7QUFDTEMsc0JBQVU7QUFETCxTQUhrQztBQU0zQ0Msb0JBQVk7QUFDUkMsMEJBQWM7QUFDVkMsNkJBQWEsa0VBREgsRUFDdUU7QUFDakZDLGtDQUFrQixxREFGUixDQUU4RDtBQUY5RDtBQUROLFNBTitCO0FBWTNDQyxvQkFBWTtBQUNSQywrQkFBbUIsQ0FBQyxNQUFELEVBQVMsS0FBVCxFQUFnQixLQUFoQixDQURYO0FBRVJDLHVCQUFXLENBRkg7QUFHUkMsdUJBQVcsTUFBTTtBQUhUO0FBWitCLEtBQXBCLENBQTNCO0FBa0JILENBcEJEOztBQXNCQSxTQUFTcE4sUUFBVCxDQUFrQkMsS0FBbEIsRUFBeUJDLFNBQXpCLEVBQW9DO0FBQ2hDLFFBQU1DLFFBQVFELFNBQWQ7QUFDQSxRQUFNRSxRQUFRSCxLQUFkO0FBQ0E7QUFDQSxRQUFNb04sWUFBWSxTQUFaQSxTQUFZLENBQUMvTCxLQUFELEVBQVE2SSxJQUFSLEVBQWNOLE1BQWQsRUFBeUI7QUFDdkMsWUFBSWhJLE1BQU0sRUFBVjtBQUNBLGdCQUFRc0ksSUFBUjtBQUNJLGlCQUFLLE9BQUw7QUFDSXRJLGlGQUNnQlAsS0FEaEI7QUFHQTtBQUNKLGlCQUFLLE1BQUw7QUFDSU8sNEZBQzJCUCxLQUQzQixVQUNxQ0EsS0FEckM7QUFFQTtBQUNKO0FBQVNPLG1EQUFpQ1AsS0FBakM7QUFWYjtBQVlBLGVBQU9PLEdBQVA7QUFDSCxLQWZEO0FBZ0JBekIsVUFBTU4sS0FBTixHQUFjWSxRQUFkLENBQXVCLG9CQUF2QjtBQUNBUCxVQUFNRSxPQUFOLENBQWMsVUFBQ0MsSUFBRCxFQUFVO0FBQ3BCLFlBQU04RyxVQUFVOUcsSUFBaEI7QUFDQTs7QUFFQSxZQUFJOEcsUUFBUWtHLElBQVIsS0FBaUIsTUFBckIsRUFBNkI7QUFDekJ6TiwrREFBaUR1SCxRQUFROUYsS0FBekQsbUVBRU84RixRQUFRLGlCQUFSLENBQUQsd0VBRW1CQSxRQUFRLGlCQUFSLENBRm5CLHFFQUlJLEVBTlYsMEZBUzhDQSxRQUFRaEksUUFUdEQsa0NBVVVpTyxVQUFVakcsUUFBUTlGLEtBQWxCLEVBQXlCOEYsUUFBUStDLElBQWpDLENBVlYsb0ZBWXdDL0MsUUFBUW1HLFNBWmhELDBEQWNROU0sUUFkUixDQWNpQkwsS0FkakI7QUFlSCxTQWhCRCxNQWdCTztBQUNIUCxvRkFBc0V1SCxRQUFROUYsS0FBOUUsc0VBRVUrTCxVQUFVakcsUUFBUTlGLEtBQWxCLEVBQXlCOEYsUUFBUStDLElBQWpDLENBRlYsdUVBR21EL0MsUUFBUW1HLFNBSDNELDhEQUtROU0sUUFMUixDQUtpQkwsS0FMakI7QUFNSDtBQUNKLEtBNUJEO0FBNkJIO0FBQ0QsU0FBU29OLFlBQVQsQ0FBc0J2TixLQUF0QixFQUE2QkMsU0FBN0IsRUFBd0M7QUFDcEMsUUFBTUMsUUFBUUQsU0FBZDtBQUNBLFFBQU1FLFFBQVFILEtBQWQ7QUFDQSxRQUFNd04sS0FBSyxTQUFMQSxFQUFLLENBQVN0TixLQUFULEVBQWdCO0FBQ3ZCLFlBQUk4SixNQUFNLEVBQVY7QUFDQTlKLGNBQU1FLE9BQU4sQ0FBYyxVQUFDQyxJQUFELEVBQVU7QUFDcEIySix5REFDZ0IzSixLQUFLLGlCQUFMLENBRGhCLHFFQUVNQSxLQUFLbEIsUUFGWDtBQUlILFNBTEQ7QUFNQSxlQUFPNkssR0FBUDtBQUNILEtBVEQ7QUFVQTdKLFVBQU1OLEtBQU4sR0FBY1ksUUFBZCxDQUF1QixvQkFBdkI7QUFDQVAsVUFBTUUsT0FBTixDQUFjLFVBQUNDLElBQUQsRUFBVTtBQUNwQlQsdWFBU2NTLEtBQUtwQyxJQVRuQix3SEFZVXVQLEdBQUduTixLQUFLbU4sRUFBUixDQVpWLDZDQWE2Qm5OLEtBQUssY0FBTCxDQWI3QixrREFlWUcsUUFmWixDQWVxQkwsS0FmckI7QUFnQkgsS0FqQkQ7QUFrQkg7O0FBRUQsU0FBU3NOLFdBQVQsR0FBdUI7QUFDbkI7O0FBRUE3TixNQUFFLG9CQUFGLEVBQXdCMEYsRUFBeEIsQ0FBMkIsT0FBM0IsRUFBb0MsVUFBQ2tDLENBQUQsRUFBTztBQUN2QztBQUNBLFlBQU1rRyxVQUFVOU4sRUFBRSxzQkFBRixFQUEwQmtJLEdBQTFCLEVBQWhCO0FBQ0F6RCxnQkFBUUMsR0FBUixDQUFZb0osT0FBWjtBQUNBO0FBQ0gsS0FMRDtBQU1IOztBQUVNLFNBQVM5SyxJQUFULEdBQWdCO0FBQUEsUUFDWmdKLFlBRFksR0FDYzNILElBRGQsQ0FDWjJILFlBRFk7QUFBQSxRQUNFQyxRQURGLEdBQ2M1SCxJQURkLENBQ0U0SCxRQURGOztBQUVuQixRQUFNekUsV0FBV3hILEVBQUUsZ0JBQUYsQ0FBakI7QUFDQSxRQUFNK04sWUFBWS9OLEVBQUUscUJBQUYsQ0FBbEI7QUFDQTtBQUNBLFFBQUksQ0FBQ3dILFNBQVMwQixNQUFkLEVBQXNCO0FBQ2xCO0FBQ0g7QUFDRC9JLGFBQVNxSCxRQUFULEVBQW1Cd0UsYUFBYTNILElBQWIsQ0FBa0IySixJQUFsQixDQUF1QnhMLFFBQTFDO0FBQ0FtTCxpQkFBYUksU0FBYixFQUF3QjlCLFNBQVM1SCxJQUFULENBQWMySixJQUFkLENBQW1CLENBQW5CLEVBQXNCQyxhQUE5QztBQUNBSjtBQUNILEM7Ozs7Ozs7Ozs7Ozs7cWpCQzlJRDtBQUNnQzs7O0FBQWhDOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLElBQU1LLGNBQWM7QUFDaEI3RixVQUFNLDZCQURVO0FBRWhCOEYsZUFBVztBQUZLLENBQXBCOztJQUlxQmxMLFk7QUFDakIsNEJBQWM7QUFBQTs7QUFDVixhQUFLaEcsSUFBTCxHQUFZcUIsY0FBWjtBQUNBLGFBQUs4SixLQUFMLEdBQWFwSSxFQUFFa08sWUFBWTdGLElBQWQsQ0FBYjtBQUNBLGFBQUsyQyxNQUFMLEdBQWMsS0FBSzVDLEtBQUwsQ0FBV0gsSUFBWCxDQUFnQixvQkFBaEIsQ0FBZDtBQUNBLGFBQUtnRCxvQkFBTCxHQUE0QmpMLEVBQUUsY0FBRixDQUE1QjtBQUNBLGFBQUtoQixRQUFMLEdBQWdCLEVBQUMsU0FBUyxrQkFBVixFQUE4QixZQUFZLFVBQTFDLEVBQWhCO0FBQ0g7Ozs7K0JBRU07QUFDSCxnQkFBSWdCLEVBQUUsZ0JBQUYsRUFBb0JrSixNQUF4QixFQUFnQztBQUM1QixxQkFBS3VDLFVBQUw7QUFDSDtBQUNKOzs7bUNBRVVKLFcsRUFBYTtBQUFBOztBQUNwQixnQkFBTW5PLFFBQVEsS0FBSzhOLE1BQUwsQ0FBWTlDLEdBQVosRUFBZDtBQUNBLGdCQUFNa0csWUFBWSxLQUFLaEcsS0FBTCxDQUFXSCxJQUFYLENBQWdCLG9CQUFoQixDQUFsQjtBQUFBLGdCQUNJb0csbUJBQW1CLEtBQUtqRyxLQUFMLENBQVdILElBQVgsQ0FBZ0IsNEJBQWhCLENBRHZCO0FBQUEsZ0JBRUk5SyxXQUFXLEtBQUtpTCxLQUFMLENBQVdILElBQVgsQ0FBZ0Isb0JBQWhCLEVBQXNDQyxHQUF0QyxFQUZmO0FBQUEsZ0JBR0lvRyxrQkFBa0IsS0FBS2xHLEtBQUwsQ0FBV0gsSUFBWCxDQUFnQiw0QkFBaEIsRUFBOENDLEdBQTlDLEVBSHRCOztBQUtBLGdCQUFJb0csb0JBQW9CblIsUUFBeEIsRUFBa0M7QUFDOUJpUiwwQkFBVXZOLFFBQVYsQ0FBbUIsYUFBbkI7QUFDQXdOLGlDQUFpQnhOLFFBQWpCLENBQTBCLGFBQTFCO0FBQ0E7QUFDSDtBQUNELGlCQUFLbUssTUFBTCxDQUFZOUMsR0FBWixDQUFnQixLQUFLOEMsTUFBTCxDQUFZOUMsR0FBWixHQUFrQm9ELGlCQUFsQixFQUFoQjtBQUNBLGlCQUFLdE0sUUFBTCxHQUFnQnFNLGVBQWUsRUFBQ25PLFlBQUQsRUFBUUMsa0JBQVIsRUFBL0I7O0FBRUEsaUJBQUtGLElBQUwsQ0FBVXNSLFFBQVYsQ0FBbUIsS0FBS3ZQLFFBQXhCLEVBQ0tpRixJQURMLENBQ1UsVUFBQ0MsTUFBRCxFQUFZO0FBQ2Qsb0JBQUlBLE9BQU9HLElBQVAsSUFBZUgsT0FBT0csSUFBUCxDQUFZakgsS0FBL0IsRUFBc0M7O0FBRWxDO0FBQ0FDLHFDQUFjbUUsR0FBZCxDQUFrQmpGLGNBQU1jLGFBQU4sQ0FBb0JDLGNBQXRDLEVBQXNELE9BQXREOztBQUVBRCxxQ0FBY21FLEdBQWQsQ0FBa0JqRixjQUFNYyxhQUFOLENBQW9CRCxLQUF0QyxFQUE2QzhHLE9BQU9HLElBQVAsQ0FBWWpILEtBQXpEO0FBQ0E7QUFDQThKLHVDQUFPcUUsT0FBUCxDQUFlaFAsY0FBTXdCLE1BQU4sQ0FBYUMsV0FBNUI7QUFDQTJCLG1DQUFVQyxlQUFWLENBQTBCLE1BQUtxTCxvQkFBL0IsRUFDSS9HLE9BQU9DLE1BQVAsQ0FBY0MsS0FEbEIsRUFFSUYsT0FBT0MsTUFBUCxDQUFjb0QsT0FBZCxJQUF5Qiw2QkFGN0I7QUFHSCxpQkFYRCxNQVdPO0FBQ0g1SCxtQ0FBVUMsZUFBVixDQUEwQixNQUFLcUwsb0JBQS9CLEVBQ0kvRyxPQUFPQyxNQUFQLENBQWNDLEtBRGxCLEVBRUlGLE9BQU9DLE1BQVAsQ0FBY29ELE9BQWQsSUFBeUIsc0JBRjdCO0FBR0g7QUFDSixhQWxCTCxFQWtCT3RELElBbEJQLENBa0JZLFVBQUNDLE1BQUQsRUFBWTtBQUNoQixvQkFBSUEsVUFBVUEsT0FBT0MsTUFBckIsRUFBNkI7QUFDekJNLDRCQUFRQyxHQUFSLENBQVlSLE1BQVo7QUFDQXZFLG1DQUFVQyxlQUFWLENBQTBCLE1BQUtxTCxvQkFBL0IsRUFDSS9HLE9BQU9DLE1BQVAsQ0FBY0MsS0FEbEI7QUFFQXBFLHNCQUFFLFlBQUYsRUFBZ0I0RyxJQUFoQjtBQUNIO0FBQ0osYUF6QkwsRUF5Qk9hLEtBekJQLENBeUJhLFVBQUMrRyxLQUFELEVBQVc7QUFDaEIvSix3QkFBUUMsR0FBUixDQUFZLGdCQUFaLEVBQThCOEosS0FBOUI7QUFDQTdPLCtCQUFVQyxlQUFWLENBQTBCLE1BQUtxTCxvQkFBL0IsRUFDSXVELE1BQU1qSCxPQURWO0FBRUE5Qyx3QkFBUUMsR0FBUixDQUFZLGNBQVo7QUFDSCxhQTlCTDtBQStCSDs7O3FDQUVZO0FBQUE7O0FBQ1QsZ0JBQU0rSixjQUFjbFMsY0FBTWdCLFdBQU4sQ0FBa0JHLFlBQXRDLENBRFMsQ0FDMkM7QUFDcEQsZ0JBQU1xSSxjQUFjLFNBQXBCO0FBQ0EsZ0JBQU1ELGFBQWEsUUFBbkI7QUFDQSxnQkFBTTRJLE9BQU8xTyxFQUFFa08sWUFBWUMsU0FBZCxDQUFiO0FBQUEsZ0JBQ0k3RixxQkFBcUIsaUJBRHpCOztBQUdBb0csaUJBQUtoSixFQUFMLENBQVEsT0FBUixFQUFpQixVQUFDa0MsQ0FBRCxFQUFPO0FBQ3BCLG9CQUFNUyxPQUFPLE9BQUtELEtBQUwsQ0FBV3RKLEdBQVgsQ0FBZSxDQUFmLENBQWI7QUFDQThJLGtCQUFFVyxjQUFGOztBQUVBLG9CQUFJLENBQUNtRyxLQUFLQyxFQUFMLENBQVEsV0FBUixDQUFMLEVBQTJCO0FBQ3ZCLHdCQUFJdEcsS0FBS0csYUFBTCxFQUFKLEVBQTBCO0FBQ3RCO0FBQ0EsK0JBQUs0QyxVQUFMO0FBQ0gscUJBSEQsTUFHTztBQUNIO0FBQ0EsNEJBQUkvQyxLQUFLSSxjQUFULEVBQXlCO0FBQ3JCSixpQ0FBS0ksY0FBTDtBQUNIO0FBQ0QsK0JBQUtMLEtBQUwsQ0FBV3ZILFFBQVgsQ0FBb0J5SCxrQkFBcEI7QUFDSDtBQUNKO0FBQ0osYUFoQkQ7O0FBa0JBdEksY0FBRW9CLFFBQUYsRUFBWXNFLEVBQVosQ0FBZSxPQUFmLEVBQXdCLFVBQUNrRyxLQUFELEVBQVc7QUFDL0Isb0JBQU1nRCxnQkFBZ0I1TyxFQUFFNEwsTUFBTTlELE1BQVIsRUFBZ0JFLE9BQWhCLENBQXdCLFlBQXhCLEVBQXNDQyxJQUF0QyxDQUEyQyxlQUEzQyxFQUE0RGlCLE1BQWxGOztBQUVBLG9CQUFJLENBQUMwRixhQUFELElBQWtCNU8sRUFBRXlPLFdBQUYsRUFBZTFDLFFBQWYsQ0FBd0JoRyxXQUF4QixDQUF0QixFQUE0RDtBQUN4RC9GLHNCQUFFeU8sV0FBRixFQUFlNU4sUUFBZixDQUF3QmlGLFVBQXhCLEVBQW9DTyxXQUFwQyxDQUFnRE4sV0FBaEQ7QUFDSDtBQUNKLGFBTkQ7QUFPSDs7Ozs7O2tCQS9GZ0I5QyxZOzs7Ozs7Ozs7Ozs7Ozs7cWpCQ1hyQjs7O0FBQ0E7Ozs7Ozs7O0lBRXFCekUsTzs7Ozs7Ozt1Q0FFRjBGLE0sRUFBUTtBQUNuQixnQkFBTTJLLE1BQU83TyxFQUFFLGNBQUYsRUFBa0JrSixNQUFuQixHQUE2QmxKLEVBQUUsY0FBRixDQUE3QixHQUFpREEsRUFBRSxZQUFGLENBQTdEO0FBQ0FMLDJCQUFVQyxlQUFWLENBQTBCaVAsR0FBMUIsRUFDSTNLLE9BQU9DLE1BQVAsQ0FBY0MsS0FEbEIsRUFFSUYsT0FBT0MsTUFBUCxDQUFjb0QsT0FBZCxJQUF5QixhQUY3QjtBQUdIOzs7b0NBRVd1SCxRLEVBQVU7QUFDbEIsZ0JBQUlBLFNBQVMzSyxNQUFULElBQW1CMkssU0FBUzNLLE1BQVQsSUFBbUIsR0FBdEMsSUFBNkMySyxTQUFTM0ssTUFBVCxHQUFrQixHQUFuRSxFQUF3RTtBQUNwRSx1QkFBTzJLLFFBQVA7QUFDSCxhQUZELE1BRU87QUFDSCxvQkFBTU4sUUFBUSxJQUFJTyxLQUFKLENBQVVELFNBQVNFLFVBQW5CLENBQWQ7QUFDQVIsc0JBQU1NLFFBQU4sR0FBaUJBLFFBQWpCO0FBQ0Esc0JBQU1OLEtBQU47QUFDSDtBQUNKOzs7b0NBRVdTLEcsRUFBS0MsSSxFQUFNalEsTyxFQUFTO0FBQUE7O0FBQzVCLG1CQUFPa1EsTUFBTUYsR0FBTixFQUFXQyxJQUFYLEVBQ0ZqTCxJQURFLENBQ0c7QUFBQSx1QkFBWW1MLFFBQVFDLEdBQVIsQ0FBWSxDQUFDUCxRQUFELEVBQVdBLFNBQVNRLElBQVQsRUFBWCxDQUFaLENBQVo7QUFBQSxhQURILEVBRUZyTCxJQUZFLENBRUcsZ0JBQXNCO0FBQUE7QUFBQSxvQkFBcEI2SyxRQUFvQjtBQUFBLG9CQUFWUSxJQUFVOztBQUN4QixvQkFBSSxDQUFDUixTQUFTUyxFQUFkLEVBQWtCO0FBQ2Qsd0JBQUksQ0FBQ3RRLE9BQUwsRUFBYztBQUNWLDhCQUFLdVEsY0FBTCxDQUFvQkYsSUFBcEI7QUFDSCxxQkFGRCxNQUVPO0FBQ0hyUSxnQ0FBUXFRLElBQVIsRUFERyxDQUNZO0FBQ2xCO0FBQ0QsMEJBQUtHLFdBQUwsQ0FBaUJYLFFBQWpCO0FBQ0E7QUFDSDtBQUNELHVCQUFPUSxJQUFQO0FBQ0gsYUFiRSxDQUFQO0FBY0g7Ozs7OztrQkFsQ2dCOVEsTzs7Ozs7Ozs7Ozs7O1FDUUxrUixTLEdBQUFBLFM7O0FBVGhCOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFKQTtBQU1PLFNBQVNBLFNBQVQsQ0FBbUIzRSxXQUFuQixFQUFnQztBQUFBOztBQUFBLFFBQzVCcEksT0FENEIsR0FDV29JLFdBRFgsQ0FDNUJwSSxPQUQ0QjtBQUFBLFFBQ25CQyxlQURtQixHQUNXbUksV0FEWCxDQUNuQm5JLGVBRG1CO0FBQUEsUUFDRkYsU0FERSxHQUNXcUksV0FEWCxDQUNGckksU0FERTs7QUFFbkMsUUFBTXpGLE9BQU9xQixjQUFiO0FBQUEsUUFBbUI7QUFDZjhKLFlBQVFwSSxFQUFFMkMsT0FBRixDQURaO0FBQUEsUUFFSXFJLFNBQVM1QyxNQUFNSCxJQUFOLENBQVcsb0JBQVgsQ0FGYjtBQUFBLFFBR0lnRCx1QkFBdUJqTCxFQUFFLGNBQUYsQ0FIM0I7QUFJQTtBQUNBOztBQUVBLFFBQU1rTCxrQkFBa0IsU0FBbEJBLGVBQWtCLENBQUNDLFNBQUQsRUFBZTtBQUNuQyxZQUFNbE0sVUFBVSxTQUFWQSxPQUFVLENBQUNpRixNQUFELEVBQVk7QUFDeEJsRSxjQUFFMEMsU0FBRixFQUFheEMsTUFBYixDQUFvQiw4QkFBcEI7QUFDSCxTQUZEOztBQUlBLGVBQU9qRCxLQUFLTixLQUFMLENBQVd3TyxTQUFYLEVBQXNCbE0sT0FBdEIsRUFDRmdGLElBREUsQ0FDRyxVQUFDQyxNQUFELEVBQVk7QUFDZCxnQkFBSUEsVUFBVUEsT0FBT0csSUFBakIsSUFBeUJILE9BQU9HLElBQVAsQ0FBWWpILEtBQXpDLEVBQWdEO0FBQzVDO0FBQ0FDLGlDQUFjbUUsR0FBZCxDQUFrQmpGLGNBQU1jLGFBQU4sQ0FBb0JELEtBQXRDLEVBQTZDOEcsT0FBT0csSUFBUCxDQUFZakgsS0FBekQ7QUFDQTRDLGtCQUFFLHFCQUFGLEVBQXlCMkcsTUFBekIsR0FBa0NDLElBQWxDO0FBQ0E7QUFDQWpILCtCQUFVQyxlQUFWLENBQTBCcUwsb0JBQTFCLEVBQ0kvRyxPQUFPQyxNQUFQLENBQWNDLEtBRGxCLEVBRUlGLE9BQU9DLE1BQVAsQ0FBY29ELE9BQWQsSUFBeUIsZ0JBRjdCO0FBR0gsYUFSRCxNQVFPLElBQUlyRCxPQUFPQyxNQUFYLEVBQW1CO0FBQ3RCTSx3QkFBUUMsR0FBUixDQUFZUixNQUFaO0FBQ0F2RSwrQkFBVUMsZUFBVixDQUEwQixNQUFLcUwsb0JBQS9CLGtCQUNrQi9HLE9BQU9DLE1BQVAsQ0FBY0MsS0FEaEMseUJBQ3lERixPQUFPQyxNQUFQLENBQWNvRCxPQUR2RTtBQUVILGFBSk0sTUFJQTtBQUNIOUMsd0JBQVFDLEdBQVIsQ0FBWVIsTUFBWjtBQUNIO0FBQ0osU0FqQkUsRUFpQkFELElBakJBLENBaUJLLFVBQUNDLE1BQUQsRUFBWTtBQUNoQixnQkFBSUEsVUFBVUEsT0FBT0MsTUFBckIsRUFBNkI7QUFDekJNLHdCQUFRQyxHQUFSLENBQVlSLE1BQVo7QUFDQXZFLCtCQUFVQyxlQUFWLENBQTBCcUwsb0JBQTFCLEVBQ0kvRyxPQUFPQyxNQUFQLENBQWNDLEtBRGxCLEVBRUlGLE9BQU9DLE1BQVAsQ0FBY29ELE9BQWQsSUFBeUIsYUFGN0I7QUFHSDtBQUNKLFNBeEJFLENBQVA7QUF5QkgsS0E5QkQ7O0FBZ0NBLFFBQU02RCxhQUFhLFNBQWJBLFVBQWEsQ0FBU0MsV0FBVCxFQUFzQjtBQUNyQyxZQUFNbk8sUUFBUThOLE9BQU85QyxHQUFQLEVBQWQ7QUFBQSxZQUNJL0ssV0FBV2lMLE1BQU1ILElBQU4sQ0FBVyxvQkFBWCxFQUFpQ0MsR0FBakMsRUFEZjtBQUFBLFlBRUlpRCxZQUFZRSxlQUFlLEVBQUNuTyxZQUFELEVBQVFDLGtCQUFSLEVBRi9COztBQUlBLFlBQUk0TixZQUFZaEksZ0JBQWhCLEVBQWtDO0FBQzlCO0FBQ0E7QUFDSCxTQUhELE1BR087QUFDSGlJLG1CQUFPOUMsR0FBUCxDQUFXOEMsT0FBTzlDLEdBQVAsR0FBYW9ELGlCQUFiLEVBQVg7QUFDQUosNEJBQWdCQyxTQUFoQixFQUEyQmxILElBQTNCLENBQWdDLFlBQU07QUFDbEM7QUFDQVosdUJBQU9DLFFBQVAsQ0FBZ0JxTSxJQUFoQixHQUF1QixnREFBdkI7QUFDSCxhQUhEO0FBSUg7QUFDSixLQWZEOztBQWlCQSxRQUFNbkUsU0FBUyxTQUFUQSxNQUFTLEdBQVc7QUFDdEJuTyx5QkFBYytFLE1BQWQsQ0FBcUI3RixjQUFNYyxhQUFOLENBQW9CRCxLQUF6QztBQUNBOEosMkJBQU9xRSxPQUFQLENBQWVoUCxjQUFNd0IsTUFBTixDQUFhRSxXQUE1QjtBQUNILEtBSEQ7O0FBS0EsUUFBTXdOLGFBQWEsU0FBYkEsVUFBYSxHQUFXO0FBQzFCO0FBQ0EsWUFBTXpFLFlBQVloSCxFQUFFMEMsU0FBRixDQUFsQjtBQUNBLFlBQU1xRCxjQUFjLFNBQXBCO0FBQ0EsWUFBTUQsYUFBYSxRQUFuQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxZQUFNNkYsZ0JBQWdCM0wsRUFBRTRDLGVBQUYsQ0FBdEI7QUFBQSxZQUNJMEYscUJBQXFCLGlCQUR6Qjs7QUFHQXFELHNCQUFjakcsRUFBZCxDQUFpQixPQUFqQixFQUEwQixVQUFDa0MsQ0FBRCxFQUFPO0FBQzdCQSxjQUFFVyxjQUFGO0FBQ0EsZ0JBQU1GLE9BQU9ELE1BQU10SixHQUFOLENBQVUsQ0FBVixDQUFiO0FBQ0E7QUFDQTJGLG9CQUFRQyxHQUFSLENBQVkvRSxjQUFaLEVBQXVCQSxlQUFVb0IsT0FBVixDQUFrQmlLLE9BQU85QyxHQUFQLEVBQWxCLENBQXZCOztBQUVBLGdCQUFJRyxLQUFLRyxhQUFMLE1BQXdCN0ksZUFBVW9CLE9BQVYsQ0FBa0JpSyxPQUFPOUMsR0FBUCxFQUFsQixDQUE1QixFQUE2RDtBQUN6RGtEO0FBQ0gsYUFGRCxNQUVPO0FBQ0g7QUFDQSxvQkFBSS9DLEtBQUtJLGNBQVQsRUFBeUI7QUFDckJKLHlCQUFLSSxjQUFMO0FBQ0g7QUFDREwsc0JBQU12SCxRQUFOLENBQWV5SCxrQkFBZjtBQUNIO0FBQ0osU0FmRDs7QUFpQkF0SSxVQUFFLHFCQUFGLEVBQXlCMEYsRUFBekIsQ0FBNEIsT0FBNUIsRUFBcUMsVUFBQ2tDLENBQUQsRUFBTztBQUN4Q0EsY0FBRVcsY0FBRjtBQUNBaUQ7QUFDQXhMLGNBQUU0SCxFQUFFRSxNQUFKLEVBQVluQixNQUFaLEdBQXFCUyxJQUFyQjtBQUNBekgsMkJBQVVDLGVBQVYsQ0FBMEJxTCxvQkFBMUIsRUFBZ0QsWUFBaEQ7QUFDSCxTQUxEOztBQU9BL0QsMkJBQU9DLFNBQVAsQ0FBaUI1SyxjQUFNd0IsTUFBTixDQUFhRSxXQUE5QixFQUEyQyxVQUFDbUksR0FBRCxFQUFTO0FBQ2hEcEcsY0FBRXpELGNBQU1nQixXQUFOLENBQWtCRSxpQkFBcEIsRUFBdUNvRCxRQUF2QyxDQUFnRGtGLFdBQWhELEVBQTZETSxXQUE3RCxDQUF5RVAsVUFBekUsRUFEZ0QsQ0FDc0M7QUFDdEY5RixjQUFFekQsY0FBTWdCLFdBQU4sQ0FBa0JJLFlBQXBCLEVBQWtDa0QsUUFBbEMsQ0FBMkNrRixXQUEzQyxFQUF3RE0sV0FBeEQsQ0FBb0VQLFVBQXBFO0FBQ0E5RixjQUFFLHFCQUFGLEVBQXlCYSxRQUF6QixDQUFrQ2lGLFVBQWxDLEVBQThDTyxXQUE5QyxDQUEwRE4sV0FBMUQsRUFIZ0QsQ0FHd0I7QUFDeEUsZ0JBQU1ILHFCQUFxQiwwQkFBM0I7QUFDQTVGLGNBQUU0RixrQkFBRixFQUFzQjlFLElBQXRCLENBQTJCLHNCQUEzQjtBQUNILFNBTkQ7O0FBUUFkLFVBQUVvQixRQUFGLEVBQVlzRSxFQUFaLENBQWUsT0FBZixFQUF3QixVQUFDa0csS0FBRCxFQUFXO0FBQy9CLGdCQUFNQyxrQkFBa0I3TCxFQUFFNEwsTUFBTTlELE1BQVIsRUFBZ0JFLE9BQWhCLENBQXdCLFlBQXhCLEVBQXNDQyxJQUF0QyxDQUEyQ2pCLFNBQTNDLEVBQXNEa0MsTUFBOUU7QUFDQSxnQkFBTTRDLDJCQUEyQjlMLEVBQUU0TCxNQUFNOUQsTUFBUixFQUFnQnlCLElBQWhCLENBQXFCLElBQXJCLE1BQStCaE4sY0FBTWdCLFdBQU4sQ0FBa0JLLFNBQWxCLENBQTRCRSxlQUE1Rjs7QUFFQSxnQkFBSSxDQUFDK04sZUFBRCxJQUFvQjdFLFVBQVUrRSxRQUFWLENBQW1CaEcsV0FBbkIsQ0FBcEIsSUFBdUQsQ0FBQytGLHdCQUE1RCxFQUFzRjtBQUNsRjlFLDBCQUFVbkcsUUFBVixDQUFtQmlGLFVBQW5CLEVBQStCTyxXQUEvQixDQUEyQ04sV0FBM0M7QUFDSDtBQUNKLFNBUEQ7QUFRSCxLQXpERDs7QUEyREEsYUFBUy9DLElBQVQsR0FBZ0I7QUFDWixZQUFJaEQsRUFBRSxhQUFGLEVBQWlCa0osTUFBckIsRUFBNkI7QUFDekJ1QztBQUNIO0FBQ0o7O0FBRUQsV0FBTztBQUNIekk7QUFERyxLQUFQO0FBR0gsQyxDQTNJK0I7QUFIaEM7QUFDQSwwQjs7Ozs7Ozs7Ozs7O1FDTWdCNE0sUyxHQUFBQSxTOztBQUxoQjs7OztBQUVBOzs7Ozs7QUFDQTs7QUFMQTtBQUNBO0FBTU8sU0FBU0EsU0FBVCxHQUFxQztBQUFBLFFBQWxCQyxXQUFrQix1RUFBSixFQUFJOztBQUN4QyxRQUFNbEUsZ0JBQWdCM0wsRUFBRSxpQ0FBRixDQUF0QjtBQUNBLFFBQU0vQyxPQUFPcUIsY0FBYjtBQUFBLFFBQW1CO0FBQ2Y4QixZQUFRSixFQUFFLDBCQUFGLENBRFo7O0FBR0EsUUFBTW9MLGFBQWEsU0FBYkEsVUFBYSxDQUFTQyxXQUFULEVBQXNCO0FBQ3JDLFlBQUlNLGNBQWN6QyxNQUFsQixFQUEwQjtBQUN0QmpNLGlCQUFLNlMsbUJBQUwsR0FBMkI3TCxJQUEzQixDQUFnQyxVQUFDQyxNQUFELEVBQVk7QUFDeEMsb0JBQUlBLFVBQVVBLE9BQU9DLE1BQXJCLEVBQTZCO0FBQ3pCTSw0QkFBUUMsR0FBUixDQUFZUixNQUFaO0FBQ0F2RSxtQ0FBVVEsUUFBVixDQUFtQkMsS0FBbkIsRUFDSThELE9BQU9HLElBQVAsQ0FBWXdHLFFBQVosSUFBd0IsYUFENUI7QUFFSDtBQUNKLGFBTkQ7O0FBUUFwRyxvQkFBUUMsR0FBUixDQUFZLHNCQUFaLEVBQW9DaUgsYUFBcEM7QUFDQTtBQUNIO0FBQ0osS0FiRDs7QUFlQSxRQUFNRixhQUFhLFNBQWJBLFVBQWEsR0FBVztBQUMxQkUsc0JBQWNqRyxFQUFkLENBQWlCLE9BQWpCLEVBQTBCLFVBQUNrQyxDQUFELEVBQU87QUFDN0JBLGNBQUVXLGNBQUY7QUFDQTZDO0FBQ0gsU0FIRDtBQUlILEtBTEQ7O0FBT0EsYUFBU3BJLElBQVQsR0FBZ0I7QUFDWnlJO0FBQ0g7O0FBRUQsV0FBTztBQUNIekk7QUFERyxLQUFQO0FBR0g7QUF0Q0QsK0Q7Ozs7OztBQ0hBLHlDOzs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHFFQUFxRTtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvSEFBb0g7QUFDcEg7QUFDQTtBQUNBO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixXQUFXO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGVBQWUscUJBQXFCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxzRUFBc0UsSUFBSTtBQUMxRSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELElBQUk7QUFDN0Q7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQix3RUFBd0UsSUFBSTtBQUM1RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBQ3pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLHNFQUFzRSxJQUFJO0FBQzFFO0FBQ0EsaUJBQWlCO0FBQ2pCLHFFQUFxRSxJQUFJO0FBQ3pFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVJQUF1STtBQUN2STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFD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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FB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QUFDbkMsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQSxhQUFhO0FBQ2I7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQSxhQUFhO0FBQ2I7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRjtBQUNwRjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxnQ0FBZ0MsMEJBQTBCLDBDQUEwQztBQUNwRztBQUNBO0FBQ0E7QUFDQSx5RkFBeUYsU0FBUztBQUNsRztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7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QUFtQyxrQ0FBa0MsZ0NBQWdDLGVBQWUsb0hBQW9ILGdDQUFnQyxHQUFHLEVBQUUsa0RBQWtELDhCQUE4Qix1Q0FBdUMsNE9BQTRPLCtCQUErQiwwQkFBMEIsa0NBQWtDLHdFQUF3RSxJQUFJLG9DQUFvQyxpRUFBaUUsa0NBQWtDLElBQUksZ0RBQWdELGdKQUFnSiw4QkFBOEIsaURBQWlELDhJQUE4SSw4Q0FBOEMsMm5CQUEybkIscUVBQXFFLDZDQUE2Qyw0NEJBQTQ0QixpS0FBaUssMElBQTBJLCtMQUErTCxFQUFFLCtDQUErQyx5TkFBeU4saURBQWlELDRRQUE0USw4Q0FBOEMsb1BBQW9QLCtDQUErQyw0UEFBNFAsbURBQW1ELDRSQUE0UixpREFBaUQsNFFBQTRRLCtDQUErQyw0UEFBNFAsOEJBQThCLHNCQUFzQiw0b0JBQTRvQix3QkFBd0IsKzRFQUErNEUsd0JBQXdCLHlqREFBeWpELHdCQUF3QixncENBQWdwQyx3QkFBd0IsczFDQUFzMUMsd0JBQXdCLHlzQkFBeXNCLEVBQUUsbUNBQW1DLDBDQUEwQyxtZEFBbWQsaVNBQWlTLDBDQUEwQyw4U0FBOFMsb1VBQW9VLDBDQUEwQyxnVEFBZ1Qsc1RBQXNULDBDQUEwQyw2U0FBNlMsa0tBQWtLLDBDQUEwQyw4U0FBOFMsNFFBQTRRLDBDQUEwQyxrVEFBa1QsbVJBQW1SLHlDQUF5QyxnRUFBZ0UsMENBQTBDLGdUQUFnVCxtVUFBbVUsZUFBZSxHQUFHLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxHQUFHLFNBQVMsRTs7Ozs7O0FDQS9vbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImluZGV4LWFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vbnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHRcbiBcdF9fd2VicGFja19yZXF1aXJlX18uaSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfTtcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMjIpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIGM1YzJmOGE3ZDUwZDI1YzExYWRkIiwiZXhwb3J0IGNvbnN0IENPTlNUID0ge1xyXG4gICAgdXJsOiB7XHJcbiAgICAgICAgYmFzZTogJ2h0dHA6Ly9hcGkubHV4Z3JhbS5ydS92MS8nLFxyXG4gICAgICAgIHJlZ2lzdHJhdGlvbjogJ3JlZ2lzdHJhdGlvbi9iYXNpYy8nLFxyXG4gICAgICAgIGxvZ2luOiAncmVnaXN0cmF0aW9uL2Jhc2ljL2xvZ2luJyxcclxuICAgICAgICBjb25maXJtYXRpb246ICdyZWdpc3RyYXRpb24vYmFzaWMvY29uZmlybWF0aW9uP3Rva2VuJyxcclxuICAgICAgICBpbnN0YWdyYW1fYWRkQWNjb3VudDogJ2luc3RhZ3JhbS1hY2NvdW50cy8nLFxyXG4gICAgICAgIGluc3RhZ3JhbUFjY291bnRfZ2V0TWV0YURhdGE6ICdpbnN0YWdyYW0tYWNjb3VudHMvbWV0YScsXHJcbiAgICAgICAgaW5zdGFncmFtQWNjb3VudF9jaGVja3BvaW50OiAnaW5zdGFncmFtLWFjY291bnRzL2NoZWNrcG9pbnQvJyxcclxuICAgICAgICBpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXk6ICdpbnN0YWdyYW0tYWNjb3VudHMvY2hlY2twb2ludC8nXHJcbiAgICB9LFxyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgdG9rZW46ICcnXHJcbiAgICB9LFxyXG4gICAgY29va2llU3RvcmFnZToge1xyXG4gICAgICAgIHRva2VuOiAndXNlcl9sb2dnZWQnLFxyXG4gICAgICAgIGVtYWlsQ29uZmlybWVkOiAnZW1haWxfY29uZmlybWVkJ1xyXG4gICAgfSxcclxuICAgIHVpU2VsZWN0b3JzOiB7XHJcbiAgICAgICAgaGVhZGVyTG9naW5Cb3g6ICduYXYgLmxvZ2luLWJveCcsXHJcbiAgICAgICAgaGVhZGVyTmF2TG9naW5CdG46ICduYXYgdWwgbGkgLmpzX2xvZ2luJyxcclxuICAgICAgICBoZWFkZXJSZWdCb3g6ICduYXYgLnJlZ2lzdGVyLWJveCcsXHJcbiAgICAgICAgaGVhZGVyUmVnQnRuOiAnbmF2IHVsIGxpIC5qc19yZWdpc3RlcicsXHJcbiAgICAgICAgaW5zdGFncmFtOiB7XHJcbiAgICAgICAgICAgIGFkZEFjY291bnRCdG5TZWxlY3RvcjogJyNqc19zaG93LWxvZ2luLWJveCcsXHJcbiAgICAgICAgICAgIGFkZEFjY291bnRCdG5JZDogJ2pzX3Nob3ctbG9naW4tYm94J1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBldmVudHM6IHtcclxuICAgICAgICBVU0VSX0xPR0dFRDogJ3VzZXJfbG9nZ2VkJyxcclxuICAgICAgICBVU0VSX0xPR09VVDogJ3VzZXJfbG9nb3V0JyxcclxuICAgICAgICBVU0VSX0VNQUlMX0NPTkZJUk1FRDogJ3VzZXJfZW1haWxfY29uZmlybWVkJyxcclxuICAgICAgICBTVE9QX0ZJWEVEX1NQSU5ORVI6ICdzdG9wX2ZpeGVkX3NwaW5uZXInXHJcbiAgICB9LFxyXG4gICAgZ2V0UGF0aChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXJsLmJhc2UgKyB0aGlzLnVybFtuYW1lXTtcclxuICAgIH1cclxufTtcclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuL2NvbnN0cyc7XHJcbmltcG9ydCBOZXR3b3JrIGZyb20gJy4vbmV0d29yayc7XHJcbmltcG9ydCBDb29raWVTdG9yYWdlIGZyb20gJy4vY29va2llJztcclxuXHJcbmNsYXNzIFVzZXIge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMubmV0d29yayA9IG5ldyBOZXR3b3JrKCk7XHJcbiAgICAgICAgdGhpcy5jb29raWVTdG9yYWdlID0gQ29va2llU3RvcmFnZTtcclxuICAgICAgICB0aGlzLnNldHRpbmdQb3N0ID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaXNMb2dnZWRJbigpIHtcclxuICAgICAgICByZXR1cm4gISF0aGlzLmdldFRva2VuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNFbWFpbENvbmZpcm1lZCgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuY29va2llU3RvcmFnZS5nZXQoQ09OU1QuY29va2llU3RvcmFnZS5lbWFpbENvbmZpcm1lZCkgPT09ICdjb25maXJtZWQnKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUb2tlbigpIHtcclxuICAgICAgICBjb25zdCBjb29raWVUb2tlbiA9IHRoaXMuY29va2llU3RvcmFnZS5nZXQoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbik7XHJcbiAgICAgICAgcmV0dXJuIGNvb2tpZVRva2VuO1xyXG4gICAgfVxyXG5cclxuICAgIGxvZ2luKGZvcm1EYXRhLCBjYkVycm9yKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHsuLi50aGlzLnNldHRpbmdQb3N0LCBib2R5OiBKU09OLnN0cmluZ2lmeShmb3JtRGF0YSl9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5ldHdvcmsuc2VuZFJlcXVlc3QoQ09OU1QuZ2V0UGF0aCgnbG9naW4nKSwgc2V0dGluZywgY2JFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSW5zdGFncmFtQWNjb3VudChmb3JtRGF0YSwgY2JFcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSB7XHJcbiAgICAgICAgICAgIC4uLnRoaXMuc2V0dGluZ1Bvc3QsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGZvcm1EYXRhKSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ2luc3RhZ3JhbV9hZGRBY2NvdW50JyksIHNldHRpbmcsIGNiRXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluc3RhZ3JhbUFjY291bnQoKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ2luc3RhZ3JhbV9hZGRBY2NvdW50JyksIHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbmZpcm0odG9rZW4pIHtcclxuICAgICAgICAvLyBjb25zdCBjb25maXJtVXJsID0gQ09OU1QuZ2V0UGF0aCgnY29uZmlybWF0aW9uJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV0d29yay5zZW5kUmVxdWVzdChgJHtDT05TVC5nZXRQYXRoKCdjb25maXJtYXRpb24nKSArIHRva2VufWApO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyKGZvcm1EYXRhKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZm9ybURhdGEpXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KENPTlNULmdldFBhdGgoJ3JlZ2lzdHJhdGlvbicpLCBzZXR0aW5nKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRNZXRhZGF0YSh0b2tlbiwgY2JFcnJvcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5ldHdvcmsuc2VuZFJlcXVlc3QoYCR7Q09OU1QuZ2V0UGF0aCgnaW5zdGFncmFtQWNjb3VudF9nZXRNZXRhRGF0YScpfWAsIHtoZWFkZXJzOiB7dG9rZW59fSwgY2JFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VjdXJpdHlLZXkodXNlcm5hbWUsIGNoZWNrcG9pbnRUeXBlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyd0eXBlJzogY2hlY2twb2ludFR5cGV9KSwgLy8gdG9kbzogdG1wIHNldCwgaXQgc2hvdWxkIGJlICd0eXBlJ1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAuLi50aGlzLnNldHRpbmdQb3N0LmhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICAndG9rZW4nOiAnM2UzMjFlNjAwMjk3MTFlOTkyNjRhMDQ4MWM4ZTE3ZDQnIC8vIHRvZG86IHRoaXMuZ2V0VG9rZW4oKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXR3b3JrLnNlbmRSZXF1ZXN0KGAke0NPTlNULmdldFBhdGgoJ2luc3RhZ3JhbUFjY291bnRfY2hlY2twb2ludCcpfSR7dXNlcm5hbWV9YCwgc2V0dGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uZmlybVNlY3VyaXR5S2V5KGtleSwgdXNlcm5hbWUpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0ge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7J3NlY3VyaXR5X2NvZGUnOiBrZXl9KSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgLi4udGhpcy5zZXR0aW5nUG9zdC5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgJ3Rva2VuJzogJzNlMzIxZTYwMDI5NzExZTk5MjY0YTA0ODFjOGUxN2Q0JyAvLyB0b2RvOiB0aGlzLmdldFRva2VuKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV0d29yay5zZW5kUmVxdWVzdChgJHtDT05TVC5nZXRQYXRoKCdpbnN0YWdyYW1BY2NvdW50X2NvbmZpcm1LZXknKX0ke3VzZXJuYW1lfWAsIHNldHRpbmcpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxubGV0IHVzZXJJbnN0YW5jZSA9IG51bGw7XHJcblxyXG5pZiAoIXVzZXJJbnN0YW5jZSkge1xyXG4gICAgdXNlckluc3RhbmNlID0gbmV3IFVzZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlckluc3RhbmNlO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL3VzZXIuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG4vLyBpbXBvcnQge0NPTlNUfSBmcm9tICcuL2NvbnN0cyc7XHJcblxyXG5mdW5jdGlvbiB2aWV3VXRpbHMoKSB7XHJcbiAgICBmdW5jdGlvbiBzaG93SW5mb01lc3NhZ2Uoc2VsZWN0b3IsIG1lc3NhZ2UxLCBtZXNzYWdlMikge1xyXG4gICAgICAgICQoc2VsZWN0b3IpLmVtcHR5KClcclxuICAgICAgICAgICAgLmFwcGVuZChgJHsobWVzc2FnZTEpID8gYDxwPnN0YXR1czogJHttZXNzYWdlMX08L3A+YCA6ICcnfWApXHJcbiAgICAgICAgICAgIC5hcHBlbmQoYDxwPiR7bWVzc2FnZTJ9IDwvcD5gKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBmaWxsTGlzdCgkbGlzdCwgZGF0YUFycmF5KSB7XHJcbiAgICAgICAgY29uc3QgaXRlbXMgPSBkYXRhQXJyYXk7XHJcbiAgICAgICAgY29uc3QgY0xpc3QgPSAkbGlzdDtcclxuICAgICAgICBjTGlzdC5lbXB0eSgpO1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGkgPSAkKCc8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW1cIj48L2xpPicpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY0xpc3QpO1xyXG4gICAgICAgICAgICAkKCc8YS8+JykuYWRkQ2xhc3MoJ3VpLWFsbCcpXHJcbiAgICAgICAgICAgICAgICAudGV4dChpdGVtLnVzZXJuYW1lKVxyXG4gICAgICAgICAgICAgICAgLmFwcGVuZFRvKGxpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpc0VtYWlsKGVtYWlsKSB7XHJcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgKi9cclxuICAgICAgICBjb25zdCByZWdleCA9IC9eKFthLXpBLVowLTlfListXSkrXFxAKChbYS16QS1aMC05LV0pK1xcLikrKFthLXpBLVowLTldezIsNH0pKyQvO1xyXG4gICAgICAgIHJldHVybiByZWdleC50ZXN0KGVtYWlsKTtcclxuICAgICAgICAvKiBlc2xpbnQtZW5hYmxlICovXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaG93SW5mb01lc3NhZ2UsXHJcbiAgICAgICAgZmlsbExpc3QsXHJcbiAgICAgICAgaXNFbWFpbFxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgdmlld1V0aWxzKCk7XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9jb21tb24vanMtc2VydmljZXMvdmlldy5qcyIsIlxyXG5jb25zdCBDb29raWVTcnYgPSB7XHJcbiAgICBnZXQ6IG5hbWUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jb29raWUubWF0Y2goYCg/Oig/Ol58Lio7ICopJHtuYW1lfSAqPSAqKFteO10qKS4qJCl8Xi4qJGApWzFdO1xyXG4gICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoYyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNldDogKG5hbWUsIHZhbHVlLCBvcHRzID0ge3BhdGg6ICcvJywgZGF5czogMzY1fSkgPT4ge1xyXG4gICAgICAgIGlmIChvcHRzLmRheXMpIHtcclxuICAgICAgICAgICAgb3B0c1snbWF4LWFnZSddID0gb3B0cy5kYXlzICogNjAgKiA2MCAqIDI0O1xyXG4gICAgICAgICAgICBkZWxldGUgb3B0cy5kYXlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cclxuICAgICAgICBvcHRzID0gT2JqZWN0LmVudHJpZXMob3B0cykucmVkdWNlKChzdHIsIFtrLCB2XSkgPT4gYCR7c3RyfTsgJHtrfT0ke3Z9YCwgJycpO1xyXG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke25hbWV9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSArIG9wdHN9YDtcclxuICAgIH0sXHJcbiAgICByZW1vdmU6IChuYW1lLCBvcHRzKSA9PiBDb29raWVTcnYuc2V0KG5hbWUsICcnLCB7J21heC1hZ2UnOiAtMSwgcGF0aDogJy8nLCBkYXlzOiAwLCAuLi5vcHRzfSlcclxuICAgIC8vIHBhdGggJiBkb21haW4gbXVzdCBtYXRjaCBjb29raWUgYmVpbmcgZGVsZXRlZFxyXG59O1xyXG5cclxuLypcclxuY2xhc3MgQ29va2llU3RvcmFnZSB7XHJcbiAgICByZWFkKGtleSkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gJC5jb29raWUoa2V5KTtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHtcclxuICAgICAgICBsZXQgZXhwaXJlcyA9ICcnO1xyXG4gICAgICAgIGlmIChkYXlzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDApKTtcclxuICAgICAgICAgICAgZXhwaXJlcyA9IGA7IGV4cGlyZXM9JHtkYXRlLnRvVVRDU3RyaW5nKCl9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZG9jdW1lbnQuY29va2llID0gYCR7bmFtZX0gPSR7KHZhbHVlIHx8ICcnKSArIGV4cGlyZXN9OyBwYXRoPS9gO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvb2tpZShuYW1lKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBgOyAke2RvY3VtZW50LmNvb2tpZX1gO1xyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gdmFsdWUuc3BsaXQoYDsgJHtuYW1lfT1gKTtcclxuICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcnRzLnBvcCgpLnNwbGl0KCc7Jykuc2hpZnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuKi9cclxuXHJcbmV4cG9ydCBkZWZhdWx0IENvb2tpZVNydjtcclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUuanMiLCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxMCwyMDExLDIwMTIsMjAxMywyMDE0IE1vcmdhbiBSb2RlcmljayBodHRwOi8vcm9kZXJpY2suZGtcbiAqIExpY2Vuc2U6IE1JVCAtIGh0dHA6Ly9tcmducmRyY2subWl0LWxpY2Vuc2Uub3JnXG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL21yb2Rlcmljay9QdWJTdWJKU1xuICovXG5cbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFB1YlN1YiA9IHt9O1xuICAgIHJvb3QuUHViU3ViID0gUHViU3ViO1xuXG4gICAgdmFyIGRlZmluZSA9IHJvb3QuZGVmaW5lO1xuXG4gICAgZmFjdG9yeShQdWJTdWIpO1xuXG4gICAgLy8gQU1EIHN1cHBvcnRcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKXtcbiAgICAgICAgZGVmaW5lKGZ1bmN0aW9uKCkgeyByZXR1cm4gUHViU3ViOyB9KTtcblxuICAgICAgICAvLyBDb21tb25KUyBhbmQgTm9kZS5qcyBtb2R1bGUgc3VwcG9ydFxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKXtcbiAgICAgICAgaWYgKG1vZHVsZSAhPT0gdW5kZWZpbmVkICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBQdWJTdWI7IC8vIE5vZGUuanMgc3BlY2lmaWMgYG1vZHVsZS5leHBvcnRzYFxuICAgICAgICB9XG4gICAgICAgIGV4cG9ydHMuUHViU3ViID0gUHViU3ViOyAvLyBDb21tb25KUyBtb2R1bGUgMS4xLjEgc3BlY1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMgPSBQdWJTdWI7IC8vIENvbW1vbkpTXG4gICAgfVxuXG59KCggdHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93ICkgfHwgdGhpcywgZnVuY3Rpb24gKFB1YlN1Yil7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIG1lc3NhZ2VzID0ge30sXG4gICAgICAgIGxhc3RVaWQgPSAtMTtcblxuICAgIGZ1bmN0aW9uIGhhc0tleXMob2JqKXtcbiAgICAgICAgdmFyIGtleTtcblxuICAgICAgICBmb3IgKGtleSBpbiBvYmope1xuICAgICAgICAgICAgaWYgKCBvYmouaGFzT3duUHJvcGVydHkoa2V5KSApe1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB0aHJvd3MgdGhlIHBhc3NlZCBleGNlcHRpb24sIGZvciB1c2UgYXMgYXJndW1lbnQgZm9yIHNldFRpbWVvdXRcbiAgICAgKiBAYWxpYXMgdGhyb3dFeGNlcHRpb25cbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcGFyYW0geyBPYmplY3QgfSBleCBBbiBFcnJvciBvYmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0aHJvd0V4Y2VwdGlvbiggZXggKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHJlVGhyb3dFeGNlcHRpb24oKXtcbiAgICAgICAgICAgIHRocm93IGV4O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhbGxTdWJzY3JpYmVyV2l0aERlbGF5ZWRFeGNlcHRpb25zKCBzdWJzY3JpYmVyLCBtZXNzYWdlLCBkYXRhICl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyKCBtZXNzYWdlLCBkYXRhICk7XG4gICAgICAgIH0gY2F0Y2goIGV4ICl7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCB0aHJvd0V4Y2VwdGlvbiggZXggKSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjYWxsU3Vic2NyaWJlcldpdGhJbW1lZGlhdGVFeGNlcHRpb25zKCBzdWJzY3JpYmVyLCBtZXNzYWdlLCBkYXRhICl7XG4gICAgICAgIHN1YnNjcmliZXIoIG1lc3NhZ2UsIGRhdGEgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWxpdmVyTWVzc2FnZSggb3JpZ2luYWxNZXNzYWdlLCBtYXRjaGVkTWVzc2FnZSwgZGF0YSwgaW1tZWRpYXRlRXhjZXB0aW9ucyApe1xuICAgICAgICB2YXIgc3Vic2NyaWJlcnMgPSBtZXNzYWdlc1ttYXRjaGVkTWVzc2FnZV0sXG4gICAgICAgICAgICBjYWxsU3Vic2NyaWJlciA9IGltbWVkaWF0ZUV4Y2VwdGlvbnMgPyBjYWxsU3Vic2NyaWJlcldpdGhJbW1lZGlhdGVFeGNlcHRpb25zIDogY2FsbFN1YnNjcmliZXJXaXRoRGVsYXllZEV4Y2VwdGlvbnMsXG4gICAgICAgICAgICBzO1xuXG4gICAgICAgIGlmICggIW1lc3NhZ2VzLmhhc093blByb3BlcnR5KCBtYXRjaGVkTWVzc2FnZSApICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChzIGluIHN1YnNjcmliZXJzKXtcbiAgICAgICAgICAgIGlmICggc3Vic2NyaWJlcnMuaGFzT3duUHJvcGVydHkocykpe1xuICAgICAgICAgICAgICAgIGNhbGxTdWJzY3JpYmVyKCBzdWJzY3JpYmVyc1tzXSwgb3JpZ2luYWxNZXNzYWdlLCBkYXRhICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVEZWxpdmVyeUZ1bmN0aW9uKCBtZXNzYWdlLCBkYXRhLCBpbW1lZGlhdGVFeGNlcHRpb25zICl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBkZWxpdmVyTmFtZXNwYWNlZCgpe1xuICAgICAgICAgICAgdmFyIHRvcGljID0gU3RyaW5nKCBtZXNzYWdlICksXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB0b3BpYy5sYXN0SW5kZXhPZiggJy4nICk7XG5cbiAgICAgICAgICAgIC8vIGRlbGl2ZXIgdGhlIG1lc3NhZ2UgYXMgaXQgaXMgbm93XG4gICAgICAgICAgICBkZWxpdmVyTWVzc2FnZShtZXNzYWdlLCBtZXNzYWdlLCBkYXRhLCBpbW1lZGlhdGVFeGNlcHRpb25zKTtcblxuICAgICAgICAgICAgLy8gdHJpbSB0aGUgaGllcmFyY2h5IGFuZCBkZWxpdmVyIG1lc3NhZ2UgdG8gZWFjaCBsZXZlbFxuICAgICAgICAgICAgd2hpbGUoIHBvc2l0aW9uICE9PSAtMSApe1xuICAgICAgICAgICAgICAgIHRvcGljID0gdG9waWMuc3Vic3RyKCAwLCBwb3NpdGlvbiApO1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdG9waWMubGFzdEluZGV4T2YoJy4nKTtcbiAgICAgICAgICAgICAgICBkZWxpdmVyTWVzc2FnZSggbWVzc2FnZSwgdG9waWMsIGRhdGEsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtZXNzYWdlSGFzU3Vic2NyaWJlcnMoIG1lc3NhZ2UgKXtcbiAgICAgICAgdmFyIHRvcGljID0gU3RyaW5nKCBtZXNzYWdlICksXG4gICAgICAgICAgICBmb3VuZCA9IEJvb2xlYW4obWVzc2FnZXMuaGFzT3duUHJvcGVydHkoIHRvcGljICkgJiYgaGFzS2V5cyhtZXNzYWdlc1t0b3BpY10pKSxcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdG9waWMubGFzdEluZGV4T2YoICcuJyApO1xuXG4gICAgICAgIHdoaWxlICggIWZvdW5kICYmIHBvc2l0aW9uICE9PSAtMSApe1xuICAgICAgICAgICAgdG9waWMgPSB0b3BpYy5zdWJzdHIoIDAsIHBvc2l0aW9uICk7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRvcGljLmxhc3RJbmRleE9mKCAnLicgKTtcbiAgICAgICAgICAgIGZvdW5kID0gQm9vbGVhbihtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eSggdG9waWMgKSAmJiBoYXNLZXlzKG1lc3NhZ2VzW3RvcGljXSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIHN5bmMsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKXtcbiAgICAgICAgbWVzc2FnZSA9ICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N5bWJvbCcpID8gbWVzc2FnZS50b1N0cmluZygpIDogbWVzc2FnZTtcblxuICAgICAgICB2YXIgZGVsaXZlciA9IGNyZWF0ZURlbGl2ZXJ5RnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEsIGltbWVkaWF0ZUV4Y2VwdGlvbnMgKSxcbiAgICAgICAgICAgIGhhc1N1YnNjcmliZXJzID0gbWVzc2FnZUhhc1N1YnNjcmliZXJzKCBtZXNzYWdlICk7XG5cbiAgICAgICAgaWYgKCAhaGFzU3Vic2NyaWJlcnMgKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggc3luYyA9PT0gdHJ1ZSApe1xuICAgICAgICAgICAgZGVsaXZlcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0VGltZW91dCggZGVsaXZlciwgMCApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFB1Ymxpc2hlcyB0aGUgbWVzc2FnZSwgcGFzc2luZyB0aGUgZGF0YSB0byBpdCdzIHN1YnNjcmliZXJzXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQGFsaWFzIHB1Ymxpc2hcbiAgICAgKiBAcGFyYW0geyBTdHJpbmcgfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHB1Ymxpc2hcbiAgICAgKiBAcGFyYW0ge30gZGF0YSBUaGUgZGF0YSB0byBwYXNzIHRvIHN1YnNjcmliZXJzXG4gICAgICogQHJldHVybiB7IEJvb2xlYW4gfVxuICAgICAqL1xuICAgIFB1YlN1Yi5wdWJsaXNoID0gZnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEgKXtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIGZhbHNlLCBQdWJTdWIuaW1tZWRpYXRlRXhjZXB0aW9ucyApO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQdWJsaXNoZXMgdGhlIHRoZSBtZXNzYWdlIHN5bmNocm9ub3VzbHksIHBhc3NpbmcgdGhlIGRhdGEgdG8gaXQncyBzdWJzY3JpYmVyc1xuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBhbGlhcyBwdWJsaXNoU3luY1xuICAgICAqIEBwYXJhbSB7IFN0cmluZyB9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gcHVibGlzaFxuICAgICAqIEBwYXJhbSB7fSBkYXRhIFRoZSBkYXRhIHRvIHBhc3MgdG8gc3Vic2NyaWJlcnNcbiAgICAgKiBAcmV0dXJuIHsgQm9vbGVhbiB9XG4gICAgICovXG4gICAgUHViU3ViLnB1Ymxpc2hTeW5jID0gZnVuY3Rpb24oIG1lc3NhZ2UsIGRhdGEgKXtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2goIG1lc3NhZ2UsIGRhdGEsIHRydWUsIFB1YlN1Yi5pbW1lZGlhdGVFeGNlcHRpb25zICk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgdGhlIHBhc3NlZCBmdW5jdGlvbiB0byB0aGUgcGFzc2VkIG1lc3NhZ2UuIEV2ZXJ5IHJldHVybmVkIHRva2VuIGlzIHVuaXF1ZSBhbmQgc2hvdWxkIGJlIHN0b3JlZCBpZiB5b3UgbmVlZCB0byB1bnN1YnNjcmliZVxuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBhbGlhcyBzdWJzY3JpYmVcbiAgICAgKiBAcGFyYW0geyBTdHJpbmcgfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHN1YnNjcmliZSB0b1xuICAgICAqIEBwYXJhbSB7IEZ1bmN0aW9uIH0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgbmV3IG1lc3NhZ2UgaXMgcHVibGlzaGVkXG4gICAgICogQHJldHVybiB7IFN0cmluZyB9XG4gICAgICovXG4gICAgUHViU3ViLnN1YnNjcmliZSA9IGZ1bmN0aW9uKCBtZXNzYWdlLCBmdW5jICl7XG4gICAgICAgIGlmICggdHlwZW9mIGZ1bmMgIT09ICdmdW5jdGlvbicpe1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbWVzc2FnZSA9ICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N5bWJvbCcpID8gbWVzc2FnZS50b1N0cmluZygpIDogbWVzc2FnZTtcblxuICAgICAgICAvLyBtZXNzYWdlIGlzIG5vdCByZWdpc3RlcmVkIHlldFxuICAgICAgICBpZiAoICFtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eSggbWVzc2FnZSApICl7XG4gICAgICAgICAgICBtZXNzYWdlc1ttZXNzYWdlXSA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZm9yY2luZyB0b2tlbiBhcyBTdHJpbmcsIHRvIGFsbG93IGZvciBmdXR1cmUgZXhwYW5zaW9ucyB3aXRob3V0IGJyZWFraW5nIHVzYWdlXG4gICAgICAgIC8vIGFuZCBhbGxvdyBmb3IgZWFzeSB1c2UgYXMga2V5IG5hbWVzIGZvciB0aGUgJ21lc3NhZ2VzJyBvYmplY3RcbiAgICAgICAgdmFyIHRva2VuID0gJ3VpZF8nICsgU3RyaW5nKCsrbGFzdFVpZCk7XG4gICAgICAgIG1lc3NhZ2VzW21lc3NhZ2VdW3Rva2VuXSA9IGZ1bmM7XG4gICAgICAgIFxuICAgICAgICAvLyByZXR1cm4gdG9rZW4gZm9yIHVuc3Vic2NyaWJpbmdcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIHRoZSBwYXNzZWQgZnVuY3Rpb24gdG8gdGhlIHBhc3NlZCBtZXNzYWdlIG9uY2VcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAYWxpYXMgc3Vic2NyaWJlT25jZVxuICAgICAqIEBwYXJhbSB7IFN0cmluZyB9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gc3Vic2NyaWJlIHRvXG4gICAgICogQHBhcmFtIHsgRnVuY3Rpb24gfSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gYSBuZXcgbWVzc2FnZSBpcyBwdWJsaXNoZWRcbiAgICAgKiBAcmV0dXJuIHsgUHViU3ViIH1cbiAgICAgKi9cbiAgICBQdWJTdWIuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uKCBtZXNzYWdlLCBmdW5jICl7XG4gICAgICAgIHZhciB0b2tlbiA9IFB1YlN1Yi5zdWJzY3JpYmUoIG1lc3NhZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvLyBiZWZvcmUgZnVuYyBhcHBseSwgdW5zdWJzY3JpYmUgbWVzc2FnZVxuICAgICAgICAgICAgUHViU3ViLnVuc3Vic2NyaWJlKCB0b2tlbiApO1xuICAgICAgICAgICAgZnVuYy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gUHViU3ViO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgYWxsIHN1YnNjcmlwdGlvbnNcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcHVibGljXG4gICAgICogQGFsaWFzIGNsZWFyQWxsU3Vic2NyaXB0aW9uc1xuICAgICAqL1xuICAgIFB1YlN1Yi5jbGVhckFsbFN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiBjbGVhckFsbFN1YnNjcmlwdGlvbnMoKXtcbiAgICAgICAgbWVzc2FnZXMgPSB7fTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgc3Vic2NyaXB0aW9ucyBieSB0aGUgdG9waWNcbiAgICAgKiBAZnVuY3Rpb25cbiAgICAgKiBAcHVibGljXG4gICAgICogQGFsaWFzIGNsZWFyQWxsU3Vic2NyaXB0aW9uc1xuICAgICAqL1xuICAgIFB1YlN1Yi5jbGVhclN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiBjbGVhclN1YnNjcmlwdGlvbnModG9waWMpe1xuICAgICAgICB2YXIgbTtcbiAgICAgICAgZm9yIChtIGluIG1lc3NhZ2VzKXtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eShtKSAmJiBtLmluZGV4T2YodG9waWMpID09PSAwKXtcbiAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZXNbbV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBzdWJzY3JpcHRpb25zXG4gICAgICpcbiAgICAgKiAtIFdoZW4gcGFzc2VkIGEgdG9rZW4sIHJlbW92ZXMgYSBzcGVjaWZpYyBzdWJzY3JpcHRpb24uXG4gICAgICpcblx0ICogLSBXaGVuIHBhc3NlZCBhIGZ1bmN0aW9uLCByZW1vdmVzIGFsbCBzdWJzY3JpcHRpb25zIGZvciB0aGF0IGZ1bmN0aW9uXG4gICAgICpcblx0ICogLSBXaGVuIHBhc3NlZCBhIHRvcGljLCByZW1vdmVzIGFsbCBzdWJzY3JpcHRpb25zIGZvciB0aGF0IHRvcGljIChoaWVyYXJjaHkpXG4gICAgICogQGZ1bmN0aW9uXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBhbGlhcyBzdWJzY3JpYmVPbmNlXG4gICAgICogQHBhcmFtIHsgU3RyaW5nIHwgRnVuY3Rpb24gfSB2YWx1ZSBBIHRva2VuLCBmdW5jdGlvbiBvciB0b3BpYyB0byB1bnN1YnNjcmliZSBmcm9tXG4gICAgICogQGV4YW1wbGUgLy8gVW5zdWJzY3JpYmluZyB3aXRoIGEgdG9rZW5cbiAgICAgKiB2YXIgdG9rZW4gPSBQdWJTdWIuc3Vic2NyaWJlKCdteXRvcGljJywgbXlGdW5jKTtcbiAgICAgKiBQdWJTdWIudW5zdWJzY3JpYmUodG9rZW4pO1xuICAgICAqIEBleGFtcGxlIC8vIFVuc3Vic2NyaWJpbmcgd2l0aCBhIGZ1bmN0aW9uXG4gICAgICogUHViU3ViLnVuc3Vic2NyaWJlKG15RnVuYyk7XG4gICAgICogQGV4YW1wbGUgLy8gVW5zdWJzY3JpYmluZyBmcm9tIGEgdG9waWNcbiAgICAgKiBQdWJTdWIudW5zdWJzY3JpYmUoJ215dG9waWMnKTtcbiAgICAgKi9cbiAgICBQdWJTdWIudW5zdWJzY3JpYmUgPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgIHZhciBkZXNjZW5kYW50VG9waWNFeGlzdHMgPSBmdW5jdGlvbih0b3BpYykge1xuICAgICAgICAgICAgICAgIHZhciBtO1xuICAgICAgICAgICAgICAgIGZvciAoIG0gaW4gbWVzc2FnZXMgKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBtZXNzYWdlcy5oYXNPd25Qcm9wZXJ0eShtKSAmJiBtLmluZGV4T2YodG9waWMpID09PSAwICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhIGRlc2NlbmRhbnQgb2YgdGhlIHRvcGljIGV4aXN0czpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVG9waWMgICAgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmICggbWVzc2FnZXMuaGFzT3duUHJvcGVydHkodmFsdWUpIHx8IGRlc2NlbmRhbnRUb3BpY0V4aXN0cyh2YWx1ZSkgKSxcbiAgICAgICAgICAgIGlzVG9rZW4gICAgPSAhaXNUb3BpYyAmJiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnLFxuICAgICAgICAgICAgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlLFxuICAgICAgICAgICAgbSwgbWVzc2FnZSwgdDtcblxuICAgICAgICBpZiAoaXNUb3BpYyl7XG4gICAgICAgICAgICBQdWJTdWIuY2xlYXJTdWJzY3JpcHRpb25zKHZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoIG0gaW4gbWVzc2FnZXMgKXtcbiAgICAgICAgICAgIGlmICggbWVzc2FnZXMuaGFzT3duUHJvcGVydHkoIG0gKSApe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlc1ttXTtcblxuICAgICAgICAgICAgICAgIGlmICggaXNUb2tlbiAmJiBtZXNzYWdlW3ZhbHVlXSApe1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZVt2YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAvLyB0b2tlbnMgYXJlIHVuaXF1ZSwgc28gd2UgY2FuIGp1c3Qgc3RvcCBoZXJlXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoIHQgaW4gbWVzc2FnZSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaGFzT3duUHJvcGVydHkodCkgJiYgbWVzc2FnZVt0XSA9PT0gdmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlW3RdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG59KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcHVic3ViLWpzL3NyYy9wdWJzdWIuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaW1wb3J0ICcuL2Jhc2Uuc2Nzcyc7XHJcbi8vIGltcG9ydCAnYm9vdHN0cmFwJztcclxuXHJcbmltcG9ydCBSZWdpc3RlckZvcm0gZnJvbSAnLi9ibG9ja3MvcmVnaXN0ZXItZm9ybS9yZWdpc3Rlci1mb3JtJztcclxuaW1wb3J0IHtMb2dpbkZvcm19IGZyb20gJy4vYmxvY2tzL2xvZ2luLWZvcm0vbG9naW4tZm9ybSc7XHJcbmltcG9ydCB7TG9naW5QYWdlfSBmcm9tICcuL3BhZ2VzL19hdXRoL2xvZ2luLXBhZ2UnO1xyXG5pbXBvcnQge2NvbmZpcm1hdGlvbldpdGhSZWRpcmVjdH0gZnJvbSAnLi9ibG9ja3MvY29uZmlybS1yZWcvY29uZmlybS1yZWcnO1xyXG5pbXBvcnQge0luc3RhZ3JhbX0gZnJvbSAnLi9wYWdlcy9faW5zdGFncmFtL2luc3RhZ3JhbSc7XHJcbmltcG9ydCAqIGFzIGhlYWRlciBmcm9tICcuL2Jsb2Nrcy9oZWFkZXIvaGVhZGVyJztcclxuaW1wb3J0ICogYXMgYnVyZ2VyTWVudSBmcm9tICcuL2Jsb2Nrcy9oZWFkZXIvYnVyZ2VyLW1lbnUvYnVyZ2VyLW1lbnUnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMnO1xyXG5pbXBvcnQgKiBhcyBpbnN0YWdyYW1BY2NvdW50cyBmcm9tICcuL2Jsb2Nrcy9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdCc7XHJcbmltcG9ydCAqIGFzIG1lc3NhZ2VzIGZyb20gJy4vYmxvY2tzL21lc3NhZ2VzL21lc3NhZ2VzJztcclxuXHJcbmNvbnN0IHNlbGVjdG9yQ3NzTG9naW5Gb3JtID0ge1xyXG4gICAgX2xvZ2luQm94OiBDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJMb2dpbkJveCxcclxuICAgIF9mb3JtSWQ6ICcjanNfbG9naW4tZm9ybScsXHJcbiAgICBfYnV0dG9uU3VibWl0SWQ6ICcjanNfbG9naW5fYnRuJyxcclxuICAgIF9zaG93TG9naW5Cb3hCdG5JZDogQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyTmF2TG9naW5CdG5cclxufTtcclxuXHJcbmNvbnN0IHNlbGVjdG9yQ3NzTG9naW5Gb3JtSW5zdGFncmFtID0ge1xyXG4gICAgX2xvZ2luQm94OiAnbWFpbiAubG9naW4tYm94JyxcclxuICAgIF9mb3JtSWQ6ICcjanNfaW5zdGFncmFtLWFkZC1hY2NvdW50JyxcclxuICAgIF9idXR0b25TdWJtaXRJZDogJyNqc19pbnN0YWdyYW0tYWRkLWFjY291bnQtLWJ0bicsXHJcbiAgICBfc2hvd0xvZ2luQm94QnRuSWQ6ICcjanNfc2hvdy1sb2dpbi1ib3gnLFxyXG4gICAgaXNMb2dpbkluc3RhZ3JhbTogdHJ1ZVxyXG59O1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIC8vIGNvbnNvbGUubG9nKCdpbml0IGpzIGhlcmUnLCBDT05TVC51c2VyKTtcclxuICAgIChuZXcgUmVnaXN0ZXJGb3JtKCkpLmluaXQoKTtcclxuICAgIExvZ2luRm9ybShzZWxlY3RvckNzc0xvZ2luRm9ybSkuaW5pdCgpO1xyXG4gICAgTG9naW5Gb3JtKHNlbGVjdG9yQ3NzTG9naW5Gb3JtSW5zdGFncmFtKS5pbml0KCk7IC8vIGluaXQgaW5zdGFncmFtIGxvZ2luIGZvcm0qIS9cclxuICAgIExvZ2luUGFnZSh7XHJcbiAgICAgICAgX2xvZ2luQm94OiAnLmF1dGgubG9naW4gLmNhcmQtc2lnbmluJyxcclxuICAgICAgICBfZm9ybUlkOiAnLmZvcm0tc2lnbmluJyxcclxuICAgICAgICBfYnV0dG9uU3VibWl0SWQ6ICcuZm9ybS1zaWduaW4gW3R5cGU9XCJzdWJtaXRcIl0nXHJcbiAgICB9KS5pbml0KCk7XHJcbiAgICBJbnN0YWdyYW0oKS5pbml0KCk7XHJcbiAgICBjb25maXJtYXRpb25XaXRoUmVkaXJlY3QoKS5pbml0KCk7XHJcbiAgICBoZWFkZXIuaW5pdEhlYWRlcigpO1xyXG4gICAgYnVyZ2VyTWVudS5pbml0KCk7XHJcbiAgICBpbnN0YWdyYW1BY2NvdW50cy5pbml0KCk7XHJcbiAgICBtZXNzYWdlcy5pbml0KCk7XHJcbn07XHJcblxyXG4oKCkgPT4gaW5pdCgpKSgpO1xyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYm9vdHN0cmFwLmpzIiwiLyogZXNsaW50LWRpc2FibGUgc29ydC12YXJzICovXHJcbi8vIGltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyJztcclxuaW1wb3J0IHtDT05TVH0gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2NvbnN0cyc7XHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG5cclxuY29uc3QgcGFyc2VRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIGNvbnN0IHN0ciA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XHJcbiAgICBjb25zdCBvYmpVUkwgPSB7fTtcclxuXHJcbiAgICBzdHIucmVwbGFjZShcclxuICAgICAgbmV3IFJlZ0V4cCgnKFtePz0mXSspKD0oW14mXSopKT8nLCAnZycpLFxyXG4gICAgICAgIGZ1bmN0aW9uKCQwLCAkMSwgJDIpIHtcclxuICAgICAgICAgICAgb2JqVVJMWyQxXSA9ICQyO1xyXG4gICAgICAgIH1cclxuICApO1xyXG4gICAgcmV0dXJuIG9ialVSTDtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb25maXJtYXRpb25XaXRoUmVkaXJlY3QoKSB7XHJcbiAgICBjb25zdCB1c2VyID0gVXNlcjtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcoKTtcclxuICAgIC8vIEV4YW1wbGUgaG93IHRvIHVzZSBpdDpcclxuXHJcbiAgICBjb25zdCBzZW5kQ29uZmlybSA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgIHVzZXIuY29uZmlybSh0b2tlbikudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzICYmIHJlc3VsdC5zdGF0dXMuc3RhdGUgPT09ICdvaycpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSBpdGVtXHJcbiAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLmVtYWlsQ29uZmlybWVkLCAnY29uZmlybWVkJyk7XHJcbiAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLnRva2VuLCByZXN1bHQuZGF0YS50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uID0gY29uZmlybS1yZWdpc3RyYXRpb24uaHRtbD90b2tlbj0nZnJvbSBzZXJ2ZXInO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIHRoZSBvYmplY3QgaW4gYSBzdHJpbmcgZm9ybVxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tZXJzRGF0YVN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2N1c3RvbWVyc0RhdGEnKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1c3RvbWVyc0RhdGFTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlcXVlc3Qgc3VjY2VlZGVkIHdpdGggSlNPTiByZXNwb25zZScsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAkKCcuY29uZmlybS1yZWdpc3RyYXRpb24nKS5hcHBlbmQoYDxwPmNvbmZpcm1hdGlvbiBzdGF0dXM6ICR7cmVzdWx0LnN0YXR1cy5zdGF0ZX08L3A+YCk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnLi9wcm9maWxlLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVkaXJlY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZG90LW5vdGF0aW9uXHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBwYXJhbXNbJ3Rva2VuJ107XHJcblxyXG4gICAgICAgIGlmICghbG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignY29uZmlybS1yZWdpc3RyYXRpb24nKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZCByZXEgdG8gJywgdG9rZW4pO1xyXG4gICAgICAgICAgICBzZW5kQ29uZmlybSh0b2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgIHJlZGlyZWN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0XHJcbiAgICB9O1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvY29uZmlybS1yZWcvY29uZmlybS1yZWcuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5cclxuLy8gY29uc3QgaGFtYnVyZ2VyQnV0dG9uQ2xzID0gJyNhc2lkZV9tb2JpbGVfX2J1dHRvbic7XHJcbi8vIGNvbnN0IGhhbWJ1cmdlck1lbnVDbHMgPSAnLmFzaWRlLWJ1cmdlci1tZW51JztcclxuLy8gY29uc3QgaGFtYnVyZ2VyTWVudU9wZW5lZENsYXNzID0gJ2J1cmdlci1tZW51LS1jbG9zZWQnO1xyXG4vLyBjb25zdCBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzID0gJ2J1cmdlci1tZW51X19idXR0b24tLWNsb3NlJztcclxuY29uc3Qgc2VsZWN0b3JzRWwgPSB7XHJcbiAgICBsZWZ0TWVudToge1xyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsczogJyNhc2lkZV9tb2JpbGVfX2J1dHRvbicsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudUNsczogJy5hc2lkZS1idXJnZXItbWVudScsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudU9wZW5lZENsYXNzOiAnYnVyZ2VyLW1lbnUtLWNsb3NlZCcsXHJcbiAgICAgICAgaGFtYnVyZ2VyQnV0dG9uQ2xvc2VDbGFzczogJ2J1cmdlci1tZW51X19idXR0b24tLWNsb3NlJ1xyXG4gICAgfSxcclxuICAgIHJpZ2h0TWVudToge1xyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsczogJyNoZWFkZXJfbW9iaWxlX3RvZ2dsZXInLFxyXG4gICAgICAgIGhhbWJ1cmdlck1lbnVDbHM6ICcuci1zaWRlLWJ1cmdlci1tZW51JyxcclxuICAgICAgICBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3M6ICdyLXNpZGUtYnVyZ2VyLW1lbnUtLW9wZW4nLFxyXG4gICAgICAgIGhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3M6ICdidXJnZXItbWVudS1yaWdodF9fYnV0dG9uLS1jbG9zZSdcclxuICAgIH0sXHJcbiAgICBzdWJIZWFkZXI6IHtcclxuICAgICAgICBoYW1idXJnZXJCdXR0b25DbHM6ICcjaGVhZGVyX21vYmlsZV90b3BiYXJfdG9nZ2xlcicsXHJcbiAgICAgICAgaGFtYnVyZ2VyTWVudUNsczogJy5zdWItaGVhZGVyJyxcclxuICAgICAgICBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3M6ICdzdWItaGVhZGVyLS1vcGVuJyxcclxuICAgICAgICBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzOiAnc3ViLWhlYWRlci1idXR0b24tLWNsb3NlJ1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFRvZ2dsZSBoYW1idXJnZXIgbWVudSBwb3BvdmVyXHJcbiAqL1xyXG5mdW5jdGlvbiB0b2dnbGVIYW1idXJnZXJNZW51KG1lbnVOYW1lKSB7XHJcbiAgICBjb25zdCB7aGFtYnVyZ2VyTWVudUNscywgaGFtYnVyZ2VyQnV0dG9uQ2xzLCBoYW1idXJnZXJCdXR0b25DbG9zZUNsYXNzLCBoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3N9ID0gc2VsZWN0b3JzRWxbbWVudU5hbWVdO1xyXG4gICAgJChoYW1idXJnZXJCdXR0b25DbHMpLnRvZ2dsZUNsYXNzKGhhbWJ1cmdlckJ1dHRvbkNsb3NlQ2xhc3MpO1xyXG4gICAgJChoYW1idXJnZXJNZW51Q2xzKS50b2dnbGVDbGFzcyhoYW1idXJnZXJNZW51T3BlbmVkQ2xhc3MpO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoYW1idXJnZXIgbWVudVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICBjb25zdCBsZWZ0TWVudSA9ICdsZWZ0TWVudSc7XHJcbiAgICBjb25zdCByaWdodE1lbnUgPSAncmlnaHRNZW51JztcclxuICAgIGNvbnN0IHN1YkhlYWRlciA9ICdzdWJIZWFkZXInO1xyXG5cclxuICAgICQoc2VsZWN0b3JzRWxbbGVmdE1lbnVdLmhhbWJ1cmdlckJ1dHRvbkNscykub24oJ2NsaWNrJywgdG9nZ2xlSGFtYnVyZ2VyTWVudS5iaW5kKHRoaXMsIGxlZnRNZW51KSk7XHJcbiAgICAkKHNlbGVjdG9yc0VsW3JpZ2h0TWVudV0uaGFtYnVyZ2VyQnV0dG9uQ2xzKS5vbignY2xpY2snLCB0b2dnbGVIYW1idXJnZXJNZW51LmJpbmQodGhpcywgcmlnaHRNZW51KSk7XHJcbiAgICAkKHNlbGVjdG9yc0VsW3N1YkhlYWRlcl0uaGFtYnVyZ2VyQnV0dG9uQ2xzKS5vbignY2xpY2snLCB0b2dnbGVIYW1idXJnZXJNZW51LmJpbmQodGhpcywgc3ViSGVhZGVyKSk7XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9oZWFkZXIvYnVyZ2VyLW1lbnUvYnVyZ2VyLW1lbnUuanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBQdWJTdWIgZnJvbSAncHVic3ViLWpzJzsgLy8gaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVic3ViLWpzXHJcbmltcG9ydCB7Q09OU1R9IGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMnO1xyXG5cclxuY29uc3Qgc2VsZWN0b3JMb2dpblN0YXRlID0gJy5qc19tZXNzYWdlX2xvZ2dlZC0tdGV4dCc7XHJcbmNvbnN0IHNlbGVjdG9yRW1haWxDb25maXJtU3RhdGUgPSAnLmpzX2VtYWlsLWNvbmZpcm0tLXRleHQnO1xyXG5jb25zdCBjbG9zZUNsYXNzID0gJ2Qtbm9uZSc7XHJcbmNvbnN0IG9wZW5lZENsYXNzID0gJ2QtYmxvY2snO1xyXG5cclxuZnVuY3Rpb24gZW1haWxOb3RDb25maXJtZWQoKSB7XHJcbiAgICBjb25zdCAkZW1haWxuTXNnID0gJChzZWxlY3RvckVtYWlsQ29uZmlybVN0YXRlKTtcclxuICAgICRlbWFpbG5Nc2cudGV4dCgnKiplbWFpbE5vdENvbmZpcm1lZCoqIEVtYWlsINC90LUg0L/QvtC00YLQstC10YDQttC00LXQvS4nKS5jc3MoJ2NvbG9yJywgJ2xpZ2h0Y29yYWwnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25Mb2dpblN1YnNjcmliZShtc2csIGRhdGEpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKG1zZywgZGF0YSk7XHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlck5hdkxvZ2luQnRuKS5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlclJlZ0J0bikuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJMb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG5cclxuICAgICQoJy5uYXYtbGluay5qc19sb2dPdXQnKS5hZGRDbGFzcyhvcGVuZWRDbGFzcykucmVtb3ZlQ2xhc3MoY2xvc2VDbGFzcyk7IC8vIHNob3dcclxuICAgIGNvbnN0ICRsb2dpbk1zZyA9ICQoc2VsZWN0b3JMb2dpblN0YXRlKTtcclxuICAgICRsb2dpbk1zZy50ZXh0KCcqKm9uTG9naW5TdWJzY3JpYmUqKiDQstGLINC30LDQu9C+0LPQuNC90LjQu9C40YHRjCDQsiBMdXhncmFtINGD0YHQv9C10YjQvdC+JykuY3NzKCdjb2xvcicsICdsaWdodGJsdWUnKTtcclxuICAgIGNvbnN0IGlzRW1haWxDb25maXJtZWQgPSBVc2VyLmlzRW1haWxDb25maXJtZWQoKTtcclxuICAgIGlmICghaXNFbWFpbENvbmZpcm1lZCkge1xyXG4gICAgICAgIGVtYWlsTm90Q29uZmlybWVkKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dMb2dvdXQoKSB7XHJcbiAgICAvLyBjaGVjayBpcyBsb2dnZWRcclxuICAgIGNvbnN0IGlzTG9nZ2VkID0gVXNlci5pc0xvZ2dlZEluKCk7XHJcbiAgICBjb25zdCBpc0VtYWlsQ29uZmlybWVkID0gVXNlci5pc0VtYWlsQ29uZmlybWVkKCk7XHJcbiAgICBpZiAoIWlzRW1haWxDb25maXJtZWQpIHtcclxuICAgICAgICBlbWFpbE5vdENvbmZpcm1lZCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzTG9nZ2VkKSB7XHJcbiAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLnBhcmVudCgpLnNob3coKTtcclxuICAgICAgICAkKCcuanNfZW1haWwtY29uZmlybS0tdGV4dCcpLnRleHQoJ9Cy0Ysg0LfQsNC70L7Qs9C40L3QuNC70LjRgdGMINGD0YHQv9C10YjQvdC+Jyk7XHJcbiAgICAgICAgY29uc3Qgb2xkVVJMID0gZG9jdW1lbnQucmVmZXJyZXI7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2cob2xkVVJMKTtcclxuICAgICAgICBpZiAob2xkVVJMLmluY2x1ZGVzKCdjb25maXJtLXJlZ2lzdHJhdGlvbicpKSB7XHJcbiAgICAgICAgICAgICQoJy5qc19tZXNzYWdlX2xvZ2dlZC0tdGV4dCcpLnRleHQoJ9Cy0Ysg0L/QvtC00YLQstC10YDQtNC40LvQuCDRgNC10LPQuNGB0YLRgNCw0YbQuNGOJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9uTG9naW5TdWJzY3JpYmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJChzZWxlY3RvckxvZ2luU3RhdGUpLnRleHQoJ9Cf0YDQuNCy0LXRgiDQsNC90L7QvdC40LzQvdGL0Lkg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMJyk7XHJcbiAgICAgICAgJChzZWxlY3RvckVtYWlsQ29uZmlybVN0YXRlKS5lbXB0eSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoZWFkZXJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0SGVhZGVyKCkge1xyXG4gICAvLyBjaGVjayBvdGhlciBoYW5kbGVyIGluIGxvZ2luLWZvcm0uanNcclxuICAgIGNvbnN0ICRsb2dpbkJveCA9ICQoQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyTG9naW5Cb3gpO1xyXG4gICAgY29uc3QgJHJlZ2lzdGVyQm94ID0gJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJSZWdCb3gpO1xyXG5cclxuICAgIFB1YlN1Yi5zdWJzY3JpYmUoQ09OU1QuZXZlbnRzLlVTRVJfTE9HR0VELCBvbkxvZ2luU3Vic2NyaWJlKTtcclxuXHJcbiAgICBzaG93TG9nb3V0KCk7XHJcblxyXG4gICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJSZWdCdG4pLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAkbG9naW5Cb3guaGlkZSgpO1xyXG4gICAgICAgICRyZWdpc3RlckJveC5jc3Moeyd0b3AnOiAwLCAncmlnaHQnOiAwfSlcclxuICAgICAgICAgICAgLmFkZENsYXNzKCdiZy1saWdodCBib3JkZXIgbXQtNSBteC1hdXRvIHBvc2l0aW9uLWFic29sdXRlIHB4LTMgZC1ibG9jaycpXHJcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnZC1ub25lJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlck5hdkxvZ2luQnRuKS5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgJGxvZ2luQm94LmFkZENsYXNzKCdkLWJsb2NrJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICRyZWdpc3RlckJveC5hZGRDbGFzcygnZC1ub25lJykucmVtb3ZlQ2xhc3MoJ2QtYmxvY2snKTtcclxuICAgIH0pO1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvaGVhZGVyL2hlYWRlci5qcyIsIi8vIGltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XHJcbmltcG9ydCBVc2VyIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy91c2VyJztcclxuLy8gaW1wb3J0IFNwaW5uZXIgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3NwaW5uZXInO1xyXG5pbXBvcnQgdmlld1V0aWxzIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy92aWV3JztcclxuXHJcbi8qXHJcbmNvbnN0IHN0YXRpY1Jlc3AgPSB7XHJcbiAgICAnc3RhdHVzJzoge1xyXG4gICAgICAgICdzdGF0ZSc6ICdvaydcclxuICAgIH0sXHJcbiAgICAnZGF0YSc6IHtcclxuICAgICAgICAnYWNjb3VudHMnOiBbe1xyXG4gICAgICAgICAgICAnc3RhdHVzJzogJ09LJyxcclxuICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ2FuZHJleS5qYWtpdmNoeWsnLFxyXG4gICAgICAgICAgICAnY2hlY2twb2ludCc6IHtcclxuICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnQUJTRU5UJyxcclxuICAgICAgICAgICAgICAgICd0eXBlJzogJ1BIT05FJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAndGFyaWZmJzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdpbmZvJzoge1xyXG4gICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdodHRwczovL3JhbmRvbXVzZXIubWUvYXBpL3BvcnRyYWl0cy9tZW4vNTAuanBnJyxcclxuICAgICAgICAgICAgICAgICduYW1lJzogJ9CQ0L3QtNGA0LXQuSDQr9C60LjQstGH0YPQuicsXHJcbiAgICAgICAgICAgICAgICAnYmlvZ3JhcGh5JzogJycsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogJycsXHJcbiAgICAgICAgICAgICAgICAnZW1haWwnOiAnbmlkenVrdUBpbmJveC5ydScsXHJcbiAgICAgICAgICAgICAgICAncGhvbmUnOiAnJyxcclxuICAgICAgICAgICAgICAgICdtZWRpYV9jb3VudCc6IDIsXHJcbiAgICAgICAgICAgICAgICAnZm9sbG93ZXJfY291bnQnOiA0LFxyXG4gICAgICAgICAgICAgICAgJ2ZvbGxvd2luZ19jb3VudCc6IDE1XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnT0snLFxyXG4gICAgICAgICAgICAndXNlcm5hbWUnOiAnYW5kcmV5Lmpha2l2Y2h5aycsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnRU1BSUwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2luZm8nOiB7XHJcbiAgICAgICAgICAgICAgICAncHJvZmlsZV9waWNfdXJsJzogJ2h0dHBzOi8vcmFuZG9tdXNlci5tZS9hcGkvcG9ydHJhaXRzL21lbi81Mi5qcGcnLFxyXG4gICAgICAgICAgICAgICAgJ25hbWUnOiAn0JTQuNC80L7QvSDQn9Cw0YDQsNC70L7QvScsXHJcbiAgICAgICAgICAgICAgICAnYmlvZ3JhcGh5JzogJ2Jpb2dyYXBoeSB0ZXh0JyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiAnd3d3LmxlbmVuZ3JhZC5ydScsXHJcbiAgICAgICAgICAgICAgICAnZW1haWwnOiAnbmlkenVrdUBpbmJveC5ydScsXHJcbiAgICAgICAgICAgICAgICAncGhvbmUnOiAnMDExLTExMS0xMTEtMTEnLFxyXG4gICAgICAgICAgICAgICAgJ21lZGlhX2NvdW50JzogNTE1LFxyXG4gICAgICAgICAgICAgICAgJ2ZvbGxvd2luZ19jb3VudCc6IDM0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnT0snLFxyXG4gICAgICAgICAgICAndXNlcm5hbWUnOiAnYWxleC5zbWl0aCcsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdUUklHR0VSRUQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnRU1BSUxfT1JfUEhPTkUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgICAgJ3N0YXR1cyc6ICdPSycsXHJcbiAgICAgICAgICAgICd1c2VybmFtZSc6ICcyMmFuZHJleS5qYWtpdmNoeWsyJyxcclxuICAgICAgICAgICAgJ2NoZWNrcG9pbnQnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ1RSSUdHRVJFRCcsXHJcbiAgICAgICAgICAgICAgICAndHlwZSc6ICdQSE9ORSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3RhcmlmZic6IHtcclxuICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnQUJTRU5UJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgJ2F2YWlsYWJsZV9wcm94eV9wdXJjaGFzZSc6IHRydWVcclxuICAgIH1cclxufTtcclxuKi8vKlxyXG5jb25zdCBzdGF0aWNSZXNwV2l0aERlbGF5ID0ge1xyXG4gICAgJ3N0YXR1cyc6IHtcclxuICAgICAgICAnc3RhdGUnOiAnb2snXHJcbiAgICB9LFxyXG4gICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgJ2FjY291bnRzJzogW3tcclxuICAgICAgICAgICAgJ3N0YXR1cyc6ICdPSycsXHJcbiAgICAgICAgICAgICd1c2VybmFtZSc6ICdzdGF0aWNSZXNwLldpdGhEZWxheScsXHJcbiAgICAgICAgICAgICdjaGVja3BvaW50Jzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICdBQlNFTlQnLFxyXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAnUEhPTkUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0YXJpZmYnOiB7XHJcbiAgICAgICAgICAgICAgICAnc3RhdHVzJzogJ0FCU0VOVCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dLFxyXG4gICAgICAgICdhdmFpbGFibGVfcHJveHlfcHVyY2hhc2UnOiB0cnVlXHJcbiAgICB9XHJcbn07XHJcbiovXHJcblxyXG4vLyDQn9C+0YHQu9C1INC00L7QsdCw0LLQu9C10L3QuNGPINCw0LrQutCw0YPQvdGC0LAg0YHQvdC+0LLQsCDQtNC10YDQvdGD0YLRjCDQnNCV0KLQkCDQuCDQv9C10YDQtdGA0LjRgdC+0LLQsNGC0Ywg0YHQv9C40YHQvtC6INCw0LrQutCw0YPQvdGC0L7QslxyXG5jb25zdCBhZGRJbnN0YWdyYW1BY2NvdW50ID0gKG5ld0Zvcm1EYXRhKSA9PiB7XHJcbiAgICBjb25zdCBjYkVycm9yID0gKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUicsIHJlc3VsdCk7XHJcbiAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkKCcuZXJyb3ItbXNnJyksXHJcbiAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnTG9naW4gZXJyb3InKTtcclxuICAgICAgICAvLyAkKF9sb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgfTtcclxuXHJcbiAgICBVc2VyLmFkZEluc3RhZ3JhbUFjY291bnQobmV3Rm9ybURhdGEsIGNiRXJyb3IpLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQsIHJlc3VsdC5zdGF0dXMpO1xyXG4gICAgICAgICAgICAvLyBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgY29uc3QgJG1zZ0xpc3QgPSAkKCcuYWNjb3VudHMtbGlzdCcpO1xyXG4gICAgICAgICAgICAkbXNnTGlzdC5lbXB0eSgpO1xyXG4gICAgICAgICAgICAvLyB0b2RvIDogcmVsb2FkIGxpc3RcclxuICAgICAgICAgICAgLy8gZmlsbExpc3QoJG1zZ0xpc3QsIHJlc3VsdC5kYXRhLmFjY291bnRzKTtcclxuICAgICAgICAgICAgLy8gYWRkTGlzdEhhbmRsZXIoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIC8vICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAvLyAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBlcnJvcicpO1xyXG4gICAgICAgICAgICAvLyAkKF9sb2dpbkJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgICAgIH1cclxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAvLyB0b2RvOiByZW5kZXIgZm9yIHVzZXJcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ3N1Ym1pdCcsIG5ld0Zvcm1EYXRhKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGFkZE9uTG9hZEhhbmRsZXJzKCkge1xyXG4gICAgLy8gJCgnLmpzX3JlcGVhdC1zZWN1cml0eS1jb2RlJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICAkKCcuanNfYWRkLWluc3RhZ3JhbS1hY2NvdW50Jykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBjb25zdCBidG4gPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICBjb25zdCAkbW9kYWxCb2R5ID0gYnRuLmNsb3Nlc3QoJy5tb2RhbCcpLmZpbmQoJy5tb2RhbC1kaWFsb2cgLm1vZGFsLWJvZHknKTtcclxuICAgICAgICBjb25zdCB1c2VybmFtZSA9ICRtb2RhbEJvZHkuZmluZCgnaW5wdXRbbmFtZT1cInVzZXJuYW1lXCJdJykudmFsKCkudHJpbSgpO1xyXG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gJG1vZGFsQm9keS5maW5kKCdpbnB1dFtuYW1lPVwicGFzc1wiXScpLnZhbCgpLnRyaW0oKTtcclxuICAgICAgICBjb25zdCAkZm9ybSA9ICQoJ2Zvcm0nLCAkbW9kYWxCb2R5KTtcclxuICAgICAgICBjb25zdCBmb3JtID0gJGZvcm0uZ2V0KDApO1xyXG4gICAgICAgIGNvbnN0IGNzc1ZhbGlkYXRpb25DbGFzcyA9ICdmb3JtLXZhbGlkYXRpb24nO1xyXG5cclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoJGZvcm0pO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbGlkYXRvci52YWxpZGF0ZSgpKTtcclxuICAgICAgICBpZiAoZm9ybS5jaGVja1ZhbGlkaXR5KCkpIHtcclxuICAgICAgICAgICAgYWRkSW5zdGFncmFtQWNjb3VudCh7dXNlcm5hbWUsIHBhc3N3b3JkfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gSGlnaGxpZ2h0IGVycm9yc1xyXG4gICAgICAgICAgICBpZiAoZm9ybS5yZXBvcnRWYWxpZGl0eSkge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5yZXBvcnRWYWxpZGl0eSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbm90IHZhbGlkIC0gRW1wdHkgZmllbGRzJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkTGlzdEhhbmRsZXIoLyogdXNlcm5hbWUqLykge1xyXG4gICAgLy8gJCgnI3lvdXJNb2RhbElEJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAvLyAgICAgdmFyIHlvdXJwYXJhbWV0ZXIgPSBlLnJlbGF0ZWRUYXJnZXQuZGF0YXNldC55b3VycGFyYW1ldGVyO1xyXG4gICAgLy8gICAgIC8vIERvIHNvbWUgc3R1ZmYgdy8gaXQuXHJcbiAgICAvLyB9KTtcclxuICAgIGxldCBjaGVja3BvaW50VHlwZSA9ICcnO1xyXG5cclxuICAgICQoJy5qc19wYXNzLWNoZWNrcG9pbnQtYnRuJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBjb25zdCAkYnV0dG9uID0gJChlLnRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSAkYnV0dG9uLmRhdGEoJ3VzZXJuYW1lJyk7XHJcbiAgICAgICAgY2hlY2twb2ludFR5cGUgPSAkYnV0dG9uLmRhdGEoJ2NoZWNrcG9pbnRUeXBlJykgfHwgY2hlY2twb2ludFR5cGU7XHJcbiAgICAgICAgLy8gJCgnI3NlY3VyaXR5LWNvZGUnKS5kYXRhKCdjaGVja3BvaW50VHlwZScsIGNoZWNrcG9pbnRUeXBlKTtcclxuICAgICAgICAvLyB0b2RvIGFkZCAnY2hlY2twb2ludFR5cGUnIHRvIG1vZGFsXHJcbiAgICAgICAgY29uc3Qgc2VuZFRvID0gKGNoZWNrcG9pbnRUeXBlID09PSAnUEhPTkUnKSA/ICfRgtC10LvQtdGE0L7QvScgOiAnZW1haWwnO1xyXG4gICAgICAgIC8vIFNwaW5uZXIuc3RhcnQoJGJ1dHRvbiwgJ2ZhLWtleScpO1xyXG5cclxuICAgICAgICBpZiAoY2hlY2twb2ludFR5cGUgPT09ICdFTUFJTF9PUl9QSE9ORScpIHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vINC40L3Qv9GD0YLRiyDRgdC/0YDRj9GC0LDQvdGLLFxyXG4gICAgICAgICAgICAvLyDQv9C+0LrQsNC30LDRgtGMINGB0LXRgNGL0LUg0L/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70LggKNCy0YvQsdGA0LDQuyDRgtC40L8pXHJcbiAgICAgICAgICAgIC8vINC10YHRgtGMINC60L3QvtC/0LrQsCDQl9Cw0L/RgNC+0YHQuNGC0Ywg0LrQvtC0INC/0L7QtNGC0LLQtdGA0LbQtNC10L3QuNC1XHJcbiAgICAgICAgICAgICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpLm1vZGFsKHtzaG93OiB0cnVlLCB1c2VybmFtZX0pO1xyXG5cclxuICAgICAgICAgICAgLy8g0L3QtSDQvtGC0L/RgNCw0LLQu9GP0LXQvCDRgNC10LrQstC10YHRglxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBVc2VyLmdldFNlY3VyaXR5S2V5KHVzZXJuYW1lLCBjaGVja3BvaW50VHlwZSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZWN1cml0eUtleSByZWNlaXZlZDonLCByZXN1bHQuc3RhdHVzLnN0YXRlKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMuc3RhdGUgPT09ICdvaycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoJyNzZWN1cml0eS1jb2RlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU3Bpbm5lci5zdG9wKCRidXR0b24sICdmYS1rZXknKTtcclxuICAgICAgICAgICAgICAgICQoJy5qc19zdWNjZXNzLWZlZWRiYWNrJywgJG1vZGFsKS5lbXB0eSgpLnRleHQoYNCa0LvRjtGHINC/0L7QtNGC0LLQtdGA0LbQtNC10L3QuNGPINCx0YvQuyDQvtGC0L/RgNCw0LLQu9C10L0g0JLQsNC8INC90LAgJHtzZW5kVG99YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGluc2lkZSBtb2RhbFxyXG4gICAgJCgnLmpzX2NvbmZpcm0tc2VjdXJpdHktY29kZScpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYnRuID0gJChlLnRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBidG4uZGF0YSgndXNlcm5hbWUnKTtcclxuICAgICAgICBjb25zdCAka2V5SW5wdXQgPSBidG4uY2xvc2VzdCgnLm1vZGFsJykuZmluZCgnLm1vZGFsLWRpYWxvZyBmb3JtIGlucHV0LmpzX2NvbmZpcm0ta2V5Jyk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gJGtleUlucHV0LnZhbCgpLnRyaW0oKTtcclxuICAgICAgICBjb25zdCAkbW9kYWwgPSBidG4uY2xvc2VzdCgnLm1vZGFsJyk7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgaWYgKGtleS5sZW5ndGggIT09IDYpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBVc2VyLmNvbmZpcm1TZWN1cml0eUtleShrZXksIHVzZXJuYW1lKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMuc3RhdGUgIT09ICdvaycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnanNfY29uZmlybTonLCByZXN1bHQuc3RhdHVzLnN0YXRlLCAnY2xvc2UgbW9kYWwnKTtcclxuICAgICAgICAgICAgJG1vZGFsLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyJyk7XHJcbiAgICAgICAgICAgICQoJy5qc19zdWNjZXNzLWZlZWRiYWNrJywgJG1vZGFsKS50ZXh0KCfQl9Cw0L/RgNC+0YEg0L3QtSDQvtGC0L/RgNCw0LLQu9C10L0nKS5jc3MoJ2NvbG9yJywgJ3JlZCcpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnZm9ybSBpbnB1dFttaW5sZW5ndGhdJykub24oJ2JsdXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgbGVuID0gJCh0aGlzKS52YWwoKS50cmltKCkubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IG1pbkxlbiA9IE51bWJlcigkKHRoaXMpLmF0dHIoJ21pbmxlbmd0aCcpKTtcclxuICAgICAgICAvLyBjb25zdCBtZXNzYWdlID0gbWluTGVuIDw9IGxlbiA/ICcnIDogbWluTGVuICsgJyBjaGFyYWN0ZXJzIG1pbmltdW0nO1xyXG4gICAgICAgIGlmIChtaW5MZW4gIT09IGxlbikge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmNzcygnYm9yZGVyQ29sb3InLCAncmVkJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2JvcmRlckNvbG9yJywgJyNjZWQ0ZGEnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5zZXRDdXN0b21WYWxpZGl0eShtZXNzYWdlKVxyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gb25IaWRlTW9kYWwoZSkge1xyXG4gICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoZS50YXJnZXQpO1xyXG4gICAgICAgICRtb2RhbC5maW5kKCcuZmlyc3Qtc3RlcCcpLnJlbW92ZUNsYXNzKCdkLW5vbmUnKTtcclxuICAgICAgICAkbW9kYWwuZmluZCgnLnNlY29uZC1zdGVwJykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICQoJy5qc19jb25maXJtLWtleScpLnZhbCgnJyk7XHJcbiAgICAgICAgJCgnLmpzX3N1Y2Nlc3MtZmVlZGJhY2snLCAkbW9kYWwpLnJlbW92ZUF0dHIoJ3N0eWxlJykuZW1wdHkoKTtcclxuICAgIH1cclxuICAgICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpLm9uKCdoaWRlLmJzLm1vZGFsJywgb25IaWRlTW9kYWwpO1xyXG4gICAgJCgnI3NlY3VyaXR5LWNvZGUnKS5vbignaGlkZS5icy5tb2RhbCcsIG9uSGlkZU1vZGFsKTtcclxuXHJcbiAgICAvLyBcIlBIT05FX09SX0VNQUlMXCIgbW9kYWxcclxuICAgICQoJy5qc19nZXQtc2VjdXJpdHktY29kZS1waG9uZU9yZW1haWwnKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0ICRtb2RhbCA9ICQoJyNzZWN1cml0eS1jb2RlLXBob25lT3JlbWFpbCcpO1xyXG4gICAgICAgIGNvbnN0IHR5cGVTZWxlY3RlZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJG1vZGFsKS5maW5kKCcuanNfYnRuLXR5cGUtc3dpdGNoZXIgaW5wdXQ6Y2hlY2tlZCcpO1xyXG4gICAgICAgIGNvbnN0IGNoZWNrcG9pbnRUeXBlQWN0aXZlID0gdHlwZVNlbGVjdGVkLnZhbCgpO1xyXG4gICAgICAgIGNvbnN0IHNlbmRUbyA9IChjaGVja3BvaW50VHlwZUFjdGl2ZSA9PT0gJ1BIT05FJykgPyAn0YLQtdC70LXRhNC+0L0nIDogJ2VtYWlsJztcclxuICAgICAgICBjb25zdCBtb2RhbENvbmZpZyA9ICRtb2RhbC5kYXRhKClbJ2JzLm1vZGFsJ10uX2NvbmZpZztcclxuICAgICAgICBjb25zdCB1c2VybmFtZSA9IG1vZGFsQ29uZmlnLnVzZXJuYW1lO1xyXG4gICAgICAgIFVzZXIuZ2V0U2VjdXJpdHlLZXkodXNlcm5hbWUsIGNoZWNrcG9pbnRUeXBlQWN0aXZlKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgLy8g0L/RgNC4INC90LDQttCw0YLQuNC4IFwi0JfQsNC/0YDQvtGB0LjRgtGMINC60L7QtCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjQtVwiIC0g0L7RgtC/0LDRgNC70Y/QtdGC0YHRjyDRgNC10LrQstC10YHRgiBcItGB0YLQsNGA0YIg0YfQtdC60L/QvtC40L3RglwiINC/0L7Rj9Cy0LvRj9C10YLRjNGB0Y8g0LjQvdC/0YPRgiDQuCDQutC90L7Qv9C60LAg0LTRgNGD0LPQuNGFINGC0LjQv9Cw0YVcclxuICAgICAgICAgICAgLy8gZ2V0IHNlbGVjdGVkIGJ1dHRvblxyXG5cclxuICAgICAgICAgICAgLy8g0L/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70Ywo0YHQtdGA0YvQuSkg0Lgg0LrQvdC+0L/QutCwIFwi0JfQsNC/0YDQvtGB0LjRgtGMINC60L7QtCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjQtVwiINC40YHRh9C10LfQsNGO0YJcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlY3VyaXR5S2V5IHJlY2VpdmVkOicsIHJlc3VsdC5zdGF0dXMuc3RhdGUpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cy5zdGF0ZSA9PT0gJ29rJykge1xyXG4gICAgICAgICAgICAgICAgJCgnLmZpcnN0LXN0ZXAnLCAkbW9kYWwpLmFkZENsYXNzKCdkLW5vbmUnKTtcclxuICAgICAgICAgICAgICAgICQoJy5zZWNvbmQtc3RlcCcsICRtb2RhbCkucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmpzX3N1Y2Nlc3MtZmVlZGJhY2snLCAkbW9kYWwpLmVtcHR5KCkudGV4dChg0JrQu9GO0Ycg0L/QvtC00YLQstC10YDQttC00LXQvdC40Y8g0LHRi9C7INC+0YLQv9GA0LDQstC70LXQvSDQktCw0Lwg0L3QsCAke3NlbmRUb31gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbGxMaXN0KCRsaXN0LCBkYXRhQXJyYXkpIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gZGF0YUFycmF5O1xyXG4gICAgY29uc3QgY0xpc3QgPSAkbGlzdDtcclxuICAgIGNvbnN0IGRlZmF1bHRBdmF0YXJTcmMgPSAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9qTk5UNExFLnBuZyc7XHJcbiAgICBjb25zdCBpbnNlcnRJdGVtID0gKGRhdGEsIHRleHQsIGNzc0NscykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpVHBsID0gYCR7KGRhdGEpXHJcbiAgICAgICAgICAgID8gYDxsaSBjbGFzcz1cImxpc3QtaW5saW5lLWl0ZW0gJHtjc3NDbHN9XCI+PHNwYW4gY2xhc3M9XCJmaWd1cmVcIj4ke2RhdGF9PC9zcGFuPjxzcGFuPiR7dGV4dH08L3NwYW4+PC9saT5gXHJcbiAgICAgICAgICAgIDogYDxsaSBjbGFzcz1cImxpc3QtaW5saW5lLWl0ZW0gJHtjc3NDbHN9XCI+PHNwYW4gY2xhc3M9XCJmaWd1cmVcIj4tPC9zcGFuPjxzcGFuPiR7dGV4dH08L3NwYW4+PC9saT5gfWA7XHJcbiAgICAgICAgcmV0dXJuIGxpVHBsO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHN0YXRzID0gKGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB0cGwgPSBgPGRpdiBjbGFzcz1cImNvbFwiPlxyXG4gICAgICAgICAgICA8dWwgY2xhc3M9XCJsaXN0LWlubGluZSB0ZXh0LWNlbnRlciBjb3VudHMtbGlzdFwiPlxyXG4gICAgICAgICAgICAkeyhpbmZvKVxyXG4gICAgICAgICAgICAgID8gYCR7aW5zZXJ0SXRlbShpbmZvWydtZWRpYV9jb3VudCddLCAn0J/Rg9Cx0LvQuNC60LDRhtC40LgnLCAnbWVkaWEtY291bnQnKX1cclxuICAgICAgICAgICAgICAgICR7aW5zZXJ0SXRlbShpbmZvWydmb2xsb3dlcl9jb3VudCddLCAn0J/QvtC00L/QuNGB0YfQuNC60LgnLCAnZm9sbG93ZXItY291bnQnKX1cclxuICAgICAgICAgICAgICAgICR7aW5zZXJ0SXRlbShpbmZvWydmb2xsb3dpbmdfY291bnQnXSwgJ9Cf0L7QtNC/0LjRgdC60LgnLCAnZm9sbG93aW5nLWNvdW50Jyl9YFxyXG4gICAgICAgICAgICAgIDogYCR7aW5zZXJ0SXRlbShmYWxzZSwgJ9Cf0YPQsdC70LjQutCw0YbQuNC4JywgJ21lZGlhLWNvdW50Jyl9XHJcbiAgICAgICAgICAgICAgICAke2luc2VydEl0ZW0oZmFsc2UsICfQn9C+0LTQv9C40YHRh9C40LrQuCcsICdmb2xsb3dlci1jb3VudCcpfVxyXG4gICAgICAgICAgICAgICAgJHtpbnNlcnRJdGVtKGZhbHNlLCAn0J/QvtC00L/QuNGB0LrQuCcsICdmb2xsb3dpbmctY291bnQnKX1gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgPC91bD5cclxuICAgICAgICA8L2Rpdj5gO1xyXG4gICAgICAgIHJldHVybiB0cGw7XHJcbiAgICB9O1xyXG4gICAgY0xpc3QuZW1wdHkoKS5hZGRDbGFzcygnYm9yZGVyLWxpZ2h0LWNvbG9yJyk7XHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5mbyA9IGl0ZW0uaW5mbztcclxuICAgICAgICBjb25zdCBjaGVja3BvaW50ID0gaXRlbS5jaGVja3BvaW50IHx8IGl0ZW07XHJcblxyXG4gICAgICAgIGlmICghaW5mbykge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYSBweS0zXCI+XHJcbiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPVwibWwtMyByb3VuZGVkXCIgYWx0PVwiZGVmYXVsdCBhdmF0YXJcIiBzcmM9XCIke2RlZmF1bHRBdmF0YXJTcmN9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVkaWEtYm9keSBkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHVzZXItaW5mb1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkeyhpdGVtLnVzZXJuYW1lKSA/IGA8aDQgY2xhc3M9XCJtdC0wIG1iLTEgbmFtZVwiPiR7aXRlbS51c2VybmFtZX08L2g0PmAgOiAnJ31cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sXCI+ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7KGNoZWNrcG9pbnQuc3RhdHVzID09PSAnVFJJR0dFUkVEJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkganNfcGFzcy1jaGVja3BvaW50LWJ0biBkLWJsb2NrIG14LWF1dG9cIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtY2hlY2twb2ludC10eXBlPVwiJHtjaGVja3BvaW50LnR5cGV9XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdXNlcm5hbWU9XCIke2l0ZW0udXNlcm5hbWUgfHwgJyd9XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdG9nZ2xlPVwibW9kYWxcIiBkYXRhLXRhcmdldD1cIiNzZWN1cml0eS1jb2RlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1rZXlcIj48L2k+0J/RgNC+0LnRgtC4INGH0LXQutC/0L7QuNC90YI8L2J1dHRvbj5gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYCh0b2RvKWNoZWNrcG9pbnQgc3RhdHVzIC0gJHtjaGVja3BvaW50LnN0YXR1c31gfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICR7c3RhdHMoKX1cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2xpPmApLmFwcGVuZFRvKGNMaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYSBweS0zXCI+XHJcbiAgICAgICAgICAgICR7KGluZm9bJ3Byb2ZpbGVfcGljX3VybCddKVxyXG4gICAgICAgICAgICAgICAgPyBgPGltZyBjbGFzcz1cIm1sLTMgcm91bmRlZFwiIGFsdD1cIlVzZXIgcGhvdG9cIiBzcmM9XCIke2luZm9bJ3Byb2ZpbGVfcGljX3VybCddfVwiPmBcclxuICAgICAgICAgICAgICAgIDogYDxpbWcgY2xhc3M9XCJtbC0zIHJvdW5kZWRcIiBhbHQ9XCJkZWZhdWx0IGF2YXRhclwiIHNyYz1cIiR7ZGVmYXVsdEF2YXRhclNyY31cIj5gfVxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVkaWEtYm9keSBkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgdXNlci1pbmZvXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgJHsoaXRlbS51c2VybmFtZSkgPyBgPHAgY2xhc3M9XCJtdC0wIG1iLTEgbmFtZVwiPiR7aXRlbS51c2VybmFtZX08L3A+YCA6ICcnfVxyXG4gICAgICAgICAgICAgICAgICAgICR7KGluZm8ubmFtZSkgPyBgPGg0IGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLm5hbWV9PC9oND5gIDogJyd9XHJcbiAgICAgICAgICAgICAgICAgICAgJHsoaW5mby5uYW1lKSA/ICcnIDogJ2NvbW1lbnRlZCcgIC8qICR7KGluZm8uZW1haWwpID8gYDxwIGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLmVtYWlsfTwvcD5gIDogJyd9XHJcbiAgICAgICAgICAgICAgICAgICAgICR7KGluZm8ucGhvbmUpID8gYDxwIGNsYXNzPVwibXQtMCBtYi0xXCI+JHtpbmZvLnBob25lfTwvcD5gIDogJyd9ICovIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbFwiPiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICR7KGNoZWNrcG9pbnQuc3RhdHVzID09PSAnVFJJR0dFUkVEJylcclxuICAgICAgICAgICAgICAgID8gYDxidXR0b24gY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGpzX3Bhc3MtY2hlY2twb2ludC1idG4gZC1ibG9jayBteC1hdXRvXCIgZGF0YS1jaGVja3BvaW50LXR5cGU9XCIke2NoZWNrcG9pbnQudHlwZX1cIiBkYXRhLXRvZ2dsZT1cIm1vZGFsXCIgZGF0YS10YXJnZXQ9XCIjc2VjdXJpdHktY29kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWtleVwiPjwvaT7Qn9GA0L7QudGC0Lgg0YfQtdC60L/QvtC40L3RgjwvYnV0dG9uPmBcclxuICAgICAgICAgICAgICAgIDogJyd9XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICR7c3RhdHMoaW5mbyl9XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvbGk+YCkuYXBwZW5kVG8oY0xpc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdCBoZWFkZXJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgY29uc3QgJG1zZ0xpc3QgPSAkKCcuYWNjb3VudHMtbGlzdCcpO1xyXG4gICAgLy8gY2hlY2sgd2UgYXJlIGluIHByb2ZpbGUgcGFnZVxyXG4gICAgaWYgKCEkbXNnTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlbiA9IFVzZXIuZ2V0VG9rZW4oKTsgLy8gdXBkIHRvOiBVc2VyLmdldFRva2VuKClcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gVXNlci5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICBjb25zdCByZXNlbmRSZXF1ZXN0ID0gKCkgPT4gVXNlci5nZXRNZXRhZGF0YSh0b2tlbik7XHJcbiAgICBsZXQgaXNTZW5kUmVxT25jZSA9IGZhbHNlO1xyXG4gICAgY29uc3QgY2hlY2tSZXNwb25zZSA9IChyZXN1bHQsIGlzUmVzZW5kUmVxdWVzdCkgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdWx0LnN0YXR1cy5zdGF0ZSA9PT0gJ29rJyB8fCAhcmVzdWx0LmRhdGEgfHwgISRtc2dMaXN0Lmxlbmd0aCB8fCBpc1Jlc2VuZFJlcXVlc3QpIHtcclxuICAgICAgICAgICAgLy8g0L/RgNC+0LLQtdGA0Y/QvCDQvtC00LjQvSDRgNCw0Lcg0L3QsNC70LjRh9C40LUgcmVzdWx0LmRhdGEuYWNjb3VudHMuaW5mb1xyXG4gICAgICAgICAgICAkbXNnTGlzdC5lbXB0eSgpO1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJtZWRpYVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lZGlhLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3M9XCJtdC0wIG1iLTNcIj7QndC4INC+0LTQvdC+0LPQviDQkNC60LrQsNGD0L3RgtCwINC90LUg0LTQvtCx0LDQstC70LXQvdC+PC9oMz5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2xpPmApLmFwcGVuZFRvKCRtc2dMaXN0KTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNlbmRSZXF1ZXN0KCkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tSZXNwb25zZShyZXN1bHQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcXVlc3QgcmVzZW5kJyk7XHJcbiAgICAgICAgICAgIH0sIDM1MDApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vINCy0YvQstC+0LQg0YDQtdC30YPQu9GM0YLQsNGC0L7QsiAoZGF0YS5hY2NvdW50cy5pbmZvKVxyXG4gICAgICAgICQoJy5wcm9maWxlLXVzZXIgLnNwaW5uZXItYm94JykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgICAgIGZpbGxMaXN0KCRtc2dMaXN0LCByZXN1bHQuZGF0YS5hY2NvdW50cyk7XHJcbiAgICAgICAgYWRkTGlzdEhhbmRsZXIoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gY2hlY2sgd2UgYXJlIGluIHByb2ZpbGUgcGFnZVxyXG4gICAgaWYgKCEkbXNnTGlzdC5sZW5ndGgpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYWRkT25Mb2FkSGFuZGxlcnMoKTtcclxuXHJcbiAgICAvLyDQvNC+0LbQtdGCINC40L3RhNC+INC+0YLRgdGD0YLRgdCy0L7QstCw0YLRjCAtINGB0LTQtdC70LDRgtGMINC10YnQtSDRgNCw0Lcg0LfQsNC/0YDQvtGBINGH0LXRgNC10LcgMyDRgdC10LouXHJcblxyXG4gICAgbWV0YWRhdGEudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgLy8g0L/RgNC+0LLQtdGA0Y/QvCDQvtC00LjQvSDRgNCw0Lcg0L3QsNC70LjRh9C40LUgcmVzdWx0LmRhdGEuYWNjb3VudHMuaW5mb1xyXG4gICAgICAgIGxldCBpc1Jlc2VuZFJlcXVlc3QgPSBmYWxzZTtcclxuICAgICAgICBpZiAocmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEuYWNjb3VudHMgJiYgIWlzU2VuZFJlcU9uY2UpIHtcclxuICAgICAgICAgICAgcmVzdWx0LmRhdGEuYWNjb3VudHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICBpc1Jlc2VuZFJlcXVlc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlzU2VuZFJlcU9uY2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoZWNrUmVzcG9uc2UocmVzdWx0LCBpc1Jlc2VuZFJlcXVlc3QpO1xyXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCQoJy5lcnJvci1tc2cnKSxcclxuICAgICAgICAgICAgICAgIGVyci5zdGF0dXMgfHwgJycsXHJcbiAgICAgICAgICAgICAgICAn0J3QtSDQv9C+0LvRg9GH0LjQu9C+0YHRjCDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LTQvtGB0YLRg9C/0L3Ri9C1IEluc3RhZ3JhbSDQsNC60LrQsNGD0L3RgtGLJyk7XHJcbiAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgJCgnLnNwaW5uZXItYm94JykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xyXG4gICAgfSk7XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC9pbnN0YWdyYW0tYWNjb3VudHMtbGlzdC5qcyIsIi8qIGVzbGludC1kaXNhYmxlIHNvcnQtdmFycyAqL1xyXG4vLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdXNlcic7XHJcbmltcG9ydCBQdWJTdWIgZnJvbSAncHVic3ViLWpzJzsgLy8gaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVic3ViLWpzXHJcbmltcG9ydCBjb29raWVTdG9yYWdlIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb29raWUnO1xyXG4vLyBpbXBvcnQgVmFsaWRhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9mb3JtLXZhbGlkYXRvcic7XHJcbmltcG9ydCB2aWV3VXRpbHMgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3ZpZXcnO1xyXG5pbXBvcnQge0NPTlNUfSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29uc3RzJztcclxuXHJcbi8vIHdpbmRvdy4kID0gJDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBMb2dpbkZvcm0oc2VsZWN0b3JDc3MpIHtcclxuICAgIGNvbnN0IHtfZm9ybUlkLCBfYnV0dG9uU3VibWl0SWQsIF9zaG93TG9naW5Cb3hCdG5JZCwgX2xvZ2luQm94fSA9IHNlbGVjdG9yQ3NzO1xyXG4gICAgY29uc3QgdXNlciA9IFVzZXIsIC8vIHNlcnZpY2VcclxuICAgICAgICAkZm9ybSA9ICQoX2Zvcm1JZCksXHJcbiAgICAgICAgJGVtYWlsID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIm1haWxcIl0nKSxcclxuICAgICAgICAkdGV4dEFyZWFEZXNjcmlwdGlvbiA9ICQoJyNkZXNjcmlwdGlvbicpO1xyXG4gICAgLy8gY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAvLyBjb25zdCBjbG9zZUNsYXNzID0gJ2Qtbm9uZSc7XHJcblxyXG4gICAgY29uc3QgdXNlckxvZ2luSGVhZGVyID0gKF9mb3JtRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNiRXJyb3IgPSAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICQoX2xvZ2luQm94KS5hcHBlbmQoJzxwPnJlc3VsdC5zdGF0dXMubWVzc2FnZTwvcD4nKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gdXNlci5sb2dpbihfZm9ybURhdGEsIGNiRXJyb3IpXHJcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEudG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgY29va2llU3RvcmFnZS5zZXQoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbiwgcmVzdWx0LmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5uYXYtbGluay5qc19sb2dPdXQnKS5wYXJlbnQoKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3JlcXVlc3Qgc3VjY2VlZGVkIHdpdGggSlNPTiByZXNwb25zZScsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBzdWNjc2VzcycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGA8cD5zdGF0dXM6ICR7cmVzdWx0LnN0YXR1cy5zdGF0ZX08L3A+PHA+IG1lc3NhZ2U6ICR7cmVzdWx0LnN0YXR1cy5tZXNzYWdlfTwvcD5gKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMubWVzc2FnZSB8fCAnTG9naW4gZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHN1Ym1pdEZvcm0gPSBmdW5jdGlvbihmb3JtRGF0YU9iaikge1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gJGVtYWlsLnZhbCgpLFxyXG4gICAgICAgICAgICBwYXNzd29yZCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzXCJdJykudmFsKCksXHJcbiAgICAgICAgICAgIF9mb3JtRGF0YSA9IGZvcm1EYXRhT2JqIHx8IHtlbWFpbCwgcGFzc3dvcmR9O1xyXG5cclxuICAgICAgICBpZiAoc2VsZWN0b3JDc3MuaXNMb2dpbkluc3RhZ3JhbSkge1xyXG4gICAgICAgICAgICAvLyB0b2RvOiBkZWxldGUgbWVcclxuICAgICAgICAgICAgLy8gYWRkSW5zdGFncmFtQWNjb3VudCh7dXNlcm5hbWU6ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJ1c2VybmFtZVwiXScpLnZhbCgpLCBwYXNzd29yZH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICRlbWFpbC52YWwoJGVtYWlsLnZhbCgpLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICB1c2VyTG9naW5IZWFkZXIoX2Zvcm1EYXRhKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIFB1YlN1Yi5wdWJsaXNoKENPTlNULmV2ZW50cy5VU0VSX0xPR0dFRCwgJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbG9nT3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29va2llU3RvcmFnZS5yZW1vdmUoQ09OU1QuY29va2llU3RvcmFnZS50b2tlbik7XHJcbiAgICAgICAgUHViU3ViLnB1Ymxpc2goQ09OU1QuZXZlbnRzLlVTRVJfTE9HT1VUKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0ICRzaG93TG9naW5Cb3hCdG5JZCA9ICQoX3Nob3dMb2dpbkJveEJ0bklkKTtcclxuICAgICAgICBjb25zdCAkbG9naW5Cb3ggPSAkKF9sb2dpbkJveCk7XHJcbiAgICAgICAgY29uc3Qgb3BlbmVkQ2xhc3MgPSAnZC1ibG9jayc7XHJcbiAgICAgICAgY29uc3QgY2xvc2VDbGFzcyA9ICdkLW5vbmUnO1xyXG5cclxuICAgICAgICAkc2hvd0xvZ2luQm94QnRuSWQub24oJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXNlbGVjdG9yQ3NzLmlzTG9naW5JbnN0YWdyYW0pIHtcclxuICAgICAgICAgICAgICAgICRsb2dpbkJveC5jc3Moeyd0b3AnOiAwLCAncmlnaHQnOiAwfSlcclxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2JnLWxpZ2h0IGJvcmRlciBtdC01IG14LWF1dG8gcG9zaXRpb24tYWJzb2x1dGUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkbG9naW5Cb3guYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCAkYnV0dG9uU3VibWl0ID0gJChfYnV0dG9uU3VibWl0SWQpLFxyXG4gICAgICAgICAgICBjc3NWYWxpZGF0aW9uQ2xhc3MgPSAnZm9ybS12YWxpZGF0aW9uJztcclxuXHJcbiAgICAgICAgJGJ1dHRvblN1Ym1pdC5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm0gPSAkZm9ybS5nZXQoMCk7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoJGZvcm0pO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWxpZGF0b3IudmFsaWRhdGUoKSk7XHJcbiAgICAgICAgICAgIGlmIChmb3JtLmNoZWNrVmFsaWRpdHkoKSAmJiB2aWV3VXRpbHMuaXNFbWFpbCgkZW1haWwudmFsKCkpKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaWdobGlnaHQgZXJyb3JzXHJcbiAgICAgICAgICAgICAgICBpZiAoZm9ybS5yZXBvcnRWYWxpZGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0ucmVwb3J0VmFsaWRpdHkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICQoZS50YXJnZXQpLnBhcmVudCgpLmhpZGUoKTtcclxuICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbiwgJ0xvZ2dlZCBvdXQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHViU3ViLnN1YnNjcmliZShDT05TVC5ldmVudHMuVVNFUl9MT0dPVVQsIChtc2cpID0+IHtcclxuICAgICAgICAgICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJOYXZMb2dpbkJ0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpOyAvLyAuc2hvdygpO1xyXG4gICAgICAgICAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlclJlZ0J0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgICAgICAkKCcubmF2LWxpbmsuanNfbG9nT3V0JykuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpOyAvLyAuaGlkZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvckxvZ2luU3RhdGUgPSAnLmpzX21lc3NhZ2VfbG9nZ2VkLS10ZXh0JztcclxuICAgICAgICAgICAgJChzZWxlY3RvckxvZ2luU3RhdGUpLnRleHQoJ9CS0Ysg0LLRi9GI0LvQuCDQuNC3INCw0LrQutCw0YPQvdGC0LAnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzTG9naW5CdG5DbGljayA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCduYXYubmF2YmFyJykuZmluZCgkbG9naW5Cb3gpLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgaXNBZGRJbnN0YWdyYW1CdG5DbGlja2VkID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09IENPTlNULnVpU2VsZWN0b3JzLmluc3RhZ3JhbS5hZGRBY2NvdW50QnRuSWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzTG9naW5CdG5DbGljayAmJiAkbG9naW5Cb3guaGFzQ2xhc3Mob3BlbmVkQ2xhc3MpICYmICFpc0FkZEluc3RhZ3JhbUJ0bkNsaWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICRsb2dpbkJveC5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICBiaW5kRXZlbnRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0XHJcbiAgICB9O1xyXG59XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9ibG9ja3MvbG9naW4tZm9ybS9sb2dpbi1mb3JtLmpzIiwiY29uc3QgY29udmVyc2F0aW9uID0ge1xyXG4gICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgJ21ldGEnOiB7XHJcbiAgICAgICAgICAgICdwYWdpbmF0aW9uJzoge1xyXG4gICAgICAgICAgICAgICAgJ3ByZXZfY3Vyc29yJzogJy4uLicsXHJcbiAgICAgICAgICAgICAgICAnbmV4dF9jdXJzb3InOiAnLi4uJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnbWVzc2FnZXMnOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ05pa2EnLFxyXG4gICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnaHR0cHM6Ly9pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0L3ZwL2M5ZDNhZGQ0YjM0NzQ4ZTEyYTQyMjkzNTBmYjYxMWU0LzVDQzY2N0I4L3Q1MS4yODg1LTE5L3MxNTB4MTUwLzQxNzEwNTI3XzMxOTAwNDc4ODY1NTA4Ml8xNjUxNTE1NzA2NzE5NjAwNjQwX24uanBnP19uY19odD1pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0JyxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZSc6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdwaG90bycsIC8vIHBob3RvLCB2aWRlbywgZ2lmLCBsaWtlLCBsaW5rXHJcbiAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogJ2h0dHA6Ly93d3cuenIucnUvZC9zdG9yeS9hZC85MTM1ODEvMC0wLmpwZycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxNDozMydcclxuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAn0JnQvtGDKHJpZ2h0KScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxNDozMidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ05pa2EnLFxyXG4gICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnaHR0cHM6Ly9pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0L3ZwL2M5ZDNhZGQ0YjM0NzQ4ZTEyYTQyMjkzNTBmYjYxMWU0LzVDQzY2N0I4L3Q1MS4yODg1LTE5L3MxNTB4MTUwLzQxNzEwNTI3XzMxOTAwNDc4ODY1NTA4Ml8xNjUxNTE1NzA2NzE5NjAwNjQwX24uanBnP19uY19odD1pbnN0YWdyYW0uZmhlbDItMS5mbmEuZmJjZG4ubmV0JyxcclxuICAgICAgICAgICAgICAgICAgICAnc2lkZSc6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JywgLy8gcGhvdG8sIHZpZGVvLCBnaWYsIGxpa2UsIGxpbmtcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAn0JfQsNGF0L7QtNC4INGB0Y7QtNCwOiBnb29nbGUuY29tJyxcclxuICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogJzE0OjM0J1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAnTmlrYScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdodHRwczovL2luc3RhZ3JhbS5maGVsMi0xLmZuYS5mYmNkbi5uZXQvdnAvYzlkM2FkZDRiMzQ3NDhlMTJhNDIyOTM1MGZiNjExZTQvNUNDNjY3QjgvdDUxLjI4ODUtMTkvczE1MHgxNTAvNDE3MTA1MjdfMzE5MDA0Nzg4NjU1MDgyXzE2NTE1MTU3MDY3MTk2MDA2NDBfbi5qcGc/X25jX2h0PWluc3RhZ3JhbS5maGVsMi0xLmZuYS5mYmNkbi5uZXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2xpbmsnLCAvLyBwaG90bywgdmlkZW8sIGdpZiwgbGlrZSwgbGlua1xyXG4gICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6ICdodHRwOi8vd3d3LnpyLnJ1L2Qvc3RvcnkvYWQvOTEzNTgxLzAtMC5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0aW1lc3RhbXAnOiAnMTQ6MzMnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdwaG90bycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogJ2h0dHBzOi8vcy5hdXRvLmRyb20ucnUvaTI0MjI0L3B1YnMvNC82MzA2MC9nZW4zNDBfMjg4MDYzNi5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0aW1lc3RhbXAnOiAnMTk6MzgnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdzaWRlJzogJ3JpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAnZGVtb3MgLT4gZmluZXVwbG9hZGVyLmNvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6ICcxOTozOCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3NpZGUnOiAncmlnaHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2xpbmsnLFxyXG4gICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6ICdodHRwczovL2ZpbmV1cGxvYWRlci5jb20vZGVtb3MjZ2FsbGVyeS12aWV3JyxcclxuICAgICAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogJzE5OjM4J1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgdXNlckxpc3QgPSB7XHJcbiAgICAnZGF0YSc6IHtcclxuICAgICAgICAnc2V0dGluZ3MnOiB7XHJcbiAgICAgICAgICAgICdkb19ub3RpZmljYXRpb24nOiB0cnVlLFxyXG4gICAgICAgICAgICAnaW52b2tlX2luX21pbGxpcyc6IDMwMDBcclxuICAgICAgICB9LFxyXG4gICAgICAgICdtZXRhJzogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiAndGhlX3Jvc3R5c2xhdicsXHJcbiAgICAgICAgICAgICAgICAndW5yZWFkX2NvbnZlcnNhdGlvbnMnOiAwLFxyXG4gICAgICAgICAgICAgICAgJ3BhZ2luYXRpb24nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3ByZXZfY3Vyc29yJzogJy4uLicsXHJcbiAgICAgICAgICAgICAgICAgICAgJ25leHRfY3Vyc29yJzogJy4uLidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnY29udmVyc2F0aW9ucyc6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6ICcxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAn0KLQtdGB0YIxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RvJzogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1c2VybmFtZSc6ICdkaWFuYWNvYmVyNycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQU9FQUFBRGhDQU1BQUFBSmJTSklBQUFBeVZCTVZFWC8vLytyZTFDU1hrVjRRRHFBcXI5a2w3R2liVDFlTWkxem9iaGtlNUJ4TXl6RHNLK21kVTZLVURKdUxDT1FXaitmYlV2bjROK25kVVhYeExXc2lYdWtianJickppRVR6OVRqcXBrTlRCMVBEbXBlRXVWWVVPSVcwQnFKQnBaTEN2djUrRy9uSUhrNi9CeFJUYWxhak9JbnFsemo1MmFYaCtObkt0MU9qUE51cks4eE15YWVIWE5uWW1lZTJDNWlIT05zTU9ndnM1ZkFBQ0RRUm5BcDV5Z2RXTDM4L0RiemNaOVFqRFF3OEdVYm1xVlpVYTdsbml2akhITXRLS2JaMExCa1h3L2hLU25aU0FxSTlQS0FBQURSMGxFUVZSNG5PM2QyMVlhTVJoQVliV0N0QjBRRUtxQUZiUzBhdFhhZ2tjODF2ZC9xRjQxK2FtWmhneEpKcTYxOStXc3llRnpidUlvaTVVVklpSWlJaUlpSWlJaUtyWGJqM0c3alM2Y05UN0VyREdMTGp3OWZoZXo0MU9FQ0JFaVJJZ1FZU3hoU3pjTEp0d1dhZUZNckIxUU9HbW9nZ0g3MmFwcXQ2K0pldWxKUU9GZUtKWVVOclZ3clcrNll3OGhRb1FJRVNKRStFYUZmWjM1VEJOUTJKcnNxY0lCdFdwMVcyak5kK3NOVFh5Y1VWdU5ZSzRjb2NPNEJrS0VDTDJGTUMrRUNCRXVEakQzWm9UOW5xV051Nno1dXV4dVE5L3lSU2NHNXB6YW9ndDdHNWFHNHRjRlVYTm9HOWhEaUJBaFFvUUlFWllzMUlldjN0Q1lrOUE4UmMvMlRpcWtjRTMzMmR6UVFUak1tVU9zRWxzbzMycm01Q1MwenBZWm4ySklvWG5UNFlSTmhBZ1JJa1NJRUtGMzRkVklkWDJ6YmNwK3BoR3Z6OHczWitJTzYyeVpjUmMzMTNxalYwN0NyWEgxYjIzcjRtWFdWdnNjYjdrSjAzYVphaU5FbUh3SUVhWWZRb1N2cW5aVmJaRysyblhhWDljMlhUVzJzQ3BPZ1NmdlZVZGlEaGRpVjR3NzB0T2Q2S3RYTnFKMzRTaXljSVFRSVVLRUNCRWlST2hmT0xqZlZ6MzgwT21yK3dNSDRVQ01FN005Nkt2M3R1bThuN3dISXZObEIyRGV1SnhGNGdpVEN5SEM5RU9JTVAwUS9pc1ViN3pLM3ZwL0U2L2wzSVNqTGRYamsrR3pFdk1mbkFpMmY5UEhOT1o2ZXRRYkhUa0pKYmErWnNuK0ovMmlOVzFMMXd1elJLMmtoVjcrRndNaFFvUUlFU0pFdUlnd0MxVXF3aEpEaUJCaCtTRkVpTEQ4RUNKRVdINElFU0lzUDRRSUVaYWZIK0cwcmlxNmtVMmRGNWRxNnVXN0x2UTNaOWovV0pvRGZENVRuWHNBanNKOW1VZFI0ZGtuMWZueVQ3SHVtNFVRSVVLRUNCRWluR3RhN1BUbFJhaVhuZ1lVZnRkZHV1enVYT2MwVG5RcDFnNG9GSFhjbnVLeUorL05UaHhXWWVIU0lVU0lFQ0ZDaElrS2Jia0piTVVYWG5SczdicGtuZTBpdXREZVlYWHhEc3ZlYktFUUlrdy9oQWpURHlIQzlIdVR3dDg3cGlvMVkyTTdURFUyVHB3emN5V2djS2RpcXJadXpFbG9uRGhuNWhwQ2hBZ1JJa1NJTUIzaHkzanhYc29VSHZ6U3VleGovWnV4cithY1p2NnBXai93SVJUTE9PMGp4czA3Q0JFaVJJZ1FJVUtFQ3dwelhxVWxVY1dMVUJ5M3pUL1NtdmtCeExpNWhoQWhRb1FJRVNKRWlCQWhRb1FJRVNKRWlCQmhLc0kvWGlrZ1FySmY5RzBBQUFBQVNVVk9SSzVDWUlJPSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ3lvdXJfZGlldGEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9maWxlX3BpY191cmwnOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFPRUFBQURoQ0FNQUFBQUpiU0pJQUFBQXcxQk1WRVgvLy8rcmUxQ1JkMTVFbThYUHFZWWJoYmlpYlQzYnJKaVBkMTlrZTVETW8zMnRlMCtlZVZmMTd1bXBlRXpJb0h5c21vbUpiVkNuZFVYcTV1UFh4TFhvMThqZzdQTXhsTUcvbklHbWVsUGF2YVRTcklxWGVGdnY1K0VtaXJ1amJEc0FoNytwYXk2aWcyeXpobDIrazIwQWZMUkZnS04rZW5YTm9vMTZzOUtOY2wvTndycUhhVXllZTJCVGJvYTRrMzI4eE14MWU0U2ZpWFd3YVJ2SW5IRy9zcWVzbEgvTXRxVGp6YnZoNWVoSlo0QnFjWHpjd2FuVXM1V3ZqSEc3bG5oWWU1ZWFpMnhvQUFBRC9rbEVRVlI0bk8zY2JWZlRTQmlBWVF5bGk3U3BwVUNoVUF3VldOOVFkMVdRZlVINS83OUtQOGc4VC9jODJlbUVtVWw2dk8rUE9jbk1YQzA5REdsMFk0T0lpSWlJZnJuS1k5ZWRPbndyaHcvc0MrL2tqRExMU3B0Vzd2UWUybEdIajkzaG5ScWh1bTQ5aFQyRUNEc1RRb1FJMncvaE9na1B6RzU3eWlMZHllRi83UXRGMkx1MXo4Z3VQTjZ4NnFuOGgwUE9PTTR2N09VTklVS0VDQkVpUkpoTldFcEsrQ3hkU2xpYXhSWitOcmRaRjZOVVhhaFp6TDNjNTlqRXBlMmpFajVKMDVMUUxQb2ZJZ2dSSWtTSUVDSENGb1FuVWpwaGFXL1ZjZ2lmcUEzY3VVbU1JNnh4NVJDcUVDSkVpQkFoUW9UWmhDZG1GNk9CSzRKbFlJNTJibTdnWWd0UHpzMkdjOWZ3OGNTQkhrNFRwWk4wUXZQSGNURGNMbjYyUFk4Z25NdHc5Z3MyYWxGWVJCRVdDQkVpUklnUTRkb0laVzgxM0hiTjdTM1hDaTVwTHNNTnpkRXlDWWZlUW9nRC8zQzVoVFd2OUV5T2JnY0oxWFd6bXArTzdFTHowektUajJTZ1VLNmJxWGZXL0lRalJJZ1FJVUtFSFJRV1EvbVdiMVk4V2xqTVpMaGhrVXhZbnJvTzFJTjBJaHpkakYwM1I1SWNIWWZjUlIycDY5Um9laEkxdDFyUmdTdzBETHRmOVIrYXFDOWlaVWw5LzNoVmdMRHl2K1o5OVhwSUU3Zk9hajlNT1BFc3FYK2FXWGphOXd3eFFZZ1FJVUtFQ0JHdXY3RHNpUEN2djkrN2ZFT3NJUHhEaHZ2SHQ1SFBKWHovOUtIN0dFSTMydE0vRVNKRWlCQWhRb1F0Q08wN1VkUElRamZjZlhiaDZOdVIxYmQzVXNqOTBwRTUydEhYZ09GaUMvVWRQVjNUNy9FZlAxeDBZZWRDaUxEN0lVVFkvUkQrVjFoTlhFMS9pYWRMclVpV0dmajk0ZW0rNjB2RGgvSFNwUi96K3lJTDlkL2ZyR2x2dDluRGVPbFNqL250N2pWbExRbWJQWHlRTHZWWUEwS0VDRnNLSVVLRTdaZFNPSk95dTlUYzZZU0YvbGNSdVlGcTdpS2RVRm56QzYxbElFU0lFQ0ZDaEFnVEN3Y0IrZi9IWU84UTJZVjZBK2Z2MVcrKy9HT1lxMGdwRE1vdmJEZ3dRb1FJRVNKRWlEQ1c4R3JYMVhBZEsreHB3bHl1cXhqQ2pUMVhHVVI4SlgxOTRTc0lXTXFTWWdCMVZ5RUxVZTlRRU1EYlZXd1dRb1FJRVNKRWlIQlpHTEtCaXl4VVc3V0V3cmZTUisrU1BrZ1JoQi9WM0FtRnF2SGpGeDNVT0E4TElVS0VDQkVpUkxnc2pIQ1RNYURkL01McnNkbExhUjZTdXM0ZStEcTcwRzU2ZWVaYVZLdTNrTXN1cDIwai9yZnA1ZFpEWjR2KzZpM08zSFVJV3c0aFFvVHRoeERoZWdrL0xWeVZ5YXJraEU5ZEVUNC90TnE2bExZazJZaWR2YkdJMVJ0MWhycE9qMmJPOXp5aDhIRFQ2bkRMVTYzUWQySE5mQWdSSWtTSUVDSENUZ3FMaFZYUkVlSDB0V1JPK0dOS3EwMjEwdC90MUJrMVk5aXBGY1hZeEU3cjV2SGxlNE9XYWpqSElVS0VDQkVpUklnUVlXS2h1akZYdzFLM3o5WlNxTEVtc0NrTElVS0VDQkVpUklnUUlVS0VDQkVpUklnUUljSXVDcjhEUzh3YzBQZ1I0UjRBQUFBQVNVVk9SSzVDWUlJPSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xhc3RfbWVzc2FnZSc6ICfQudC+0YMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaXNfdW5yZWFkJzogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogJzInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdTZXJnYW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RvJzogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1c2VybmFtZSc6ICdkaWFuYWNvYmVyNycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2ZpbGVfcGljX3VybCc6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQU9FQUFBRGhDQU1BQUFBSmJTSklBQUFBeGxCTVZFWC8vLys5a21hS1NVTC8xWGxlRnkyMmhsWC96Rng3UVZQZUR3M0FsV2lGUFRYS3M3R25mWG1IUXp4d1BEYVdXMHRYQUNtbGNWWGdBQUM2alY2Q055N2Z6YnpwNGVCWkN5cXNmMXlTWWsyR1FqOTNPMUt6aFYvLzBtL0VmbGovOXVkOFFsUjJQanl3ZWtEL3ptTzZtV3YveUVtZWJsMy8wM09EVTBLeGdWWC8wVjNjcTFueHZsdVpiRkR5NitSL01TZlhPeXIvM3B0bkxETEhsbGRsSWpaOEtSNzA4UEJ5TkZHUlVqL091Yk9yZTFUa3Nsbll3YXpYUGl5aGRWV2djV3pYeDhWNlF6N0JMbHRZQUFBRTJVbEVRVlI0bk8zZFcxZlRRQlFGWUM5QURhaTBja2xMaTFLdFd0U2lvcVdLRi9ULy95bDk2WnlkdGZZNG1aQkpBdTc5eUpyTW1hK0J0UTdUU1h2bmpxSW9pcUlvaW5MYmN2V3dDN2xLS0Z3KzZrS1dDWVh2NzNVaDd5V1VVTUxXSTZHRUVwSWNwVW96d29zZHl6YXR1RHRJbFYxYWJ4dFdkRkdEOEhDNTdjTHY0Q0JMbFFHL2k3YWc1V0Vkd24zK3U0TEN1Mm5pRTFyMkpaUlFRZ2tsbEZEQ2F3Z3ZEbDErZVZvMXl6Q1pjQWhWNkNxMmY5bEM0eHE0bmVYK09wNVdiUUxOVlNMZ1g2Smw0bW5nM0RxWE8zRkM3a0poTWhhUFJ3aFdDU1dVVUVJSkpaU3dKaUZzOURVdkRHd3kxaUk4YXFKVDh3VnFVMkpOd3NaZExCSktLR0g3a1ZCQ0NkdFA3VUpvbDBDWU5kSGY4Q0laYmVDcUMzY25GcWd5bXJ2OFRMYWIrTk9LaktBSXJHaTNEaUZkZnpaLzdMSklKbHhZa1RsZmhvUVNTaWloaEJKS1dMOFFtaWlQa0ovZThna0NnNHRDT3FKbVlmYktNajEzZ1lacU1yTEFZTDcxT0lFUmNKME56a1pXWkFxRFlVVjFDMWZqZFhxZk45YkpUWmdOKy9rNmZUZDJ2QnBTNGRDbUc4TjE5cVo1TnNwZGxjODlteTZoY054YjU4UW5kRC9lT0hHRHh4NGhUR2VYK1lRd25ZUVNTaWloaEJJMkxUd3FDRTljQ2tLWGd0QmxURSsrWlVPWXJpQjBLUWh0T2hRZVZSUisvZUpPekkyR0xwT1ZleDJ4cDVuYmlJVXRhY1BHamdkRGxvSGR3NTVkbGk5c3hCeDdHcGZWeEVhTTNEcS9mSTBTSHV6WmJZSGVhb01tNzd2a2ZNU1k1L3JUcmV5Rzd4MUVDZ04vTFhIcDJSK1I1YVFYdnBDSC9vVkxLS0dFRWtvb29ZVFhFZ1o3bW5DaWVwcVk2VloxQ0hGWHN4K3V6dExIaHpNc2s2clQwYTNUYXdqQlduVkpudjh0S2d2WjRpU1VVRUlKSlpSUXdncEMrbzZyN1JHVldCd005Z2tyVGtmZmM0NFV3bTRpUE1lY3djYmlOTGdpMlBOanIvbmZ3SFJCNGhTbWd4VU5xdTRtOGgxaGJGSERRdG85RnU5aVJNYzc5YnlQWDNWSE9Id1dvNFRRNDZMVGxSRFM2eEtlTnBGUVFna2xsRkRDRWtJN3A0VUx5ZTMwVnB3dy8vZDAvZWFGQ3p0cTk5dFdkQTRuOEtLRWNOMjVUZmZiZnNxUGVDWVVZc2NGNzdiejNxb01rZldEZUVMQXM0cUVRbno5VVJqbG90TVZoS0hCRWtvb29ZUVNTdGdab1dzcWN4VFM5d3g5UWFGN3dmb05DZWxUc2xobE1YV0JKMXV5cHpHQjYrWTJuZWRwbkpxZmt2VTg2WXhFZWk5bVQySXlDMDJIOVdwKzBoa1M5YlQ2N01tRDhrRmhNRjE1SGw5Q0NTV1VVRUlKYjYwd1lwOEpleHFmaS9ZMFBwY2xuVER1VXdWbmxoOFUrQU5HQkdkcjVsTUYwUnJ6dVltekQxVDRJZVpYczl1ZmZTbWhoQkpLS0tHRU4xUm8zLzdneWVXZUpTeWt1MDloSWRTNERDMG84dHNmNEJzOFBEbXpmQThTUFZ1SVFlQjNxQkpjVVIxZndlWUpQNHhhU0dBWDJDZU1PMUNaTGlXRTFTSmhZNUZRUWduYmo0UzNRTGk1eHhLSFlkbnNpdkRzZ0lhN2VUYjVGR2R0MC82ZDU1dmw4N3p0eFZhS2hCSjJQeEpLMlAxSUtHSDNJNkdFM1krRUVuWS9Fa3JZL1Vnb1lTdlpPbWJaZWtsekdpRTg1Vk40NmlVVUh0OW5PZDVpZVJNbGZFUG44TlNUVUVJSkpaUlFRZ203STd3OGRmRzVYQzdiRkQ3N2FIbE5LNzYySVBhZDVSTUZmb0lSeUlMNWVEMVkwYk02aE1lQmdvWGkvSFo2aFB6R2xhaGlyMmc5d21ERnBvVVdDU1dVVUVJSkpieEp3bE9XbXluRUxUSEx0N2NzMzJBRVhOZHRJWWJlSUY4cTFwQlFRZ2tsbEZCQ0NTVk1MWHdSa3hzcGJDSVNTaWhoKzVGUVFnbmJqNFQvaGZBUElhRytha2NwVkM0QUFBQUFTVVZPUks1Q1lJST0nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYXJhbV92YWx1ZSc6ICdkaWFuYWNvYmVyNycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdsYXN0X21lc3NhZ2UnOiAn0JbRltC90L7Rh9C60L4gXFx1RDgzRFxcdURFMEEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaXNfdW5yZWFkJzogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdXHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuZXhwb3J0IHt1c2VyTGlzdCwgY29udmVyc2F0aW9ufTtcclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9tZXNzYWdlcy9kYXRhU2VydmVyLmpzIiwiaW1wb3J0ICogYXMgZGF0YSBmcm9tICcuL2RhdGFTZXJ2ZXInO1xyXG5pbXBvcnQgTWV0ZW9yRW1vamkgZnJvbSAnbWV0ZW9yLWVtb2ppJztcclxuaW1wb3J0IHFxIGZyb20gJ2ZpbmUtdXBsb2FkZXInO1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXHJcbiAgICBjb25zdCBtID0gbmV3IE1ldGVvckVtb2ppKCk7XHJcbiAgICBjb25zdCAkcGlja2VyID0gJCgndGV4dGFyZWFbZGF0YS1tZXRlb3ItZW1vamk9XCJ0cnVlXCJdIH4gZGl2Jyk7XHJcbiAgICBjb25zdCBzdHlsZSA9ICRwaWNrZXIuYXR0cignc3R5bGUnKTtcclxuICAgIGNvbnN0IHN0eWxlTmV3ID0gc3R5bGUucmVwbGFjZSgndG9wOiAzMHB4OycsICd0b3A6IC0yMTBweDsnKTtcclxuICAgICRwaWNrZXIuYXR0cignc3R5bGUnLCBzdHlsZU5ldyk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXHJcbiAgICBjb25zdCByZXN0cmljdGVkVXBsb2FkZXIgPSBuZXcgcXEuRmluZVVwbG9hZGVyKHtcclxuICAgICAgICBlbGVtZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmluZS11cGxvYWRlci12YWxpZGF0aW9uJyksXHJcbiAgICAgICAgdGVtcGxhdGU6ICdxcS10ZW1wbGF0ZS12YWxpZGF0aW9uJyxcclxuICAgICAgICByZXF1ZXN0OiB7XHJcbiAgICAgICAgICAgIGVuZHBvaW50OiAnL3NlcnZlci91cGxvYWRzJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGh1bWJuYWlsczoge1xyXG4gICAgICAgICAgICBwbGFjZWhvbGRlcnM6IHtcclxuICAgICAgICAgICAgICAgIHdhaXRpbmdQYXRoOiAnaHR0cHM6Ly9maW5ldXBsb2FkZXIuY29tL3NvdXJjZS9wbGFjZWhvbGRlcnMvd2FpdGluZy1nZW5lcmljLnBuZycsIC8vICcvc291cmNlL3BsYWNlaG9sZGVycy93YWl0aW5nLWdlbmVyaWMucG5nJyxcclxuICAgICAgICAgICAgICAgIG5vdEF2YWlsYWJsZVBhdGg6ICdodHRwczovL2ZpbmV1cGxvYWRlci5jb20vc2VydmVyL3dhaXRpbmctZ2VuZXJpYy5wbmcnIC8vICcvc291cmNlL3BsYWNlaG9sZGVycy9ub3RfYXZhaWxhYmxlLWdlbmVyaWMucG5nJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2YWxpZGF0aW9uOiB7XHJcbiAgICAgICAgICAgIGFsbG93ZWRFeHRlbnNpb25zOiBbJ2pwZWcnLCAnanBnJywgJ3R4dCddLFxyXG4gICAgICAgICAgICBpdGVtTGltaXQ6IDMsXHJcbiAgICAgICAgICAgIHNpemVMaW1pdDogNTAwICogMTAyNFxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGZpbGxMaXN0KCRsaXN0LCBkYXRhQXJyYXkpIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gZGF0YUFycmF5O1xyXG4gICAgY29uc3QgY0xpc3QgPSAkbGlzdDtcclxuICAgIC8vIGNvbnN0IGRlZmF1bHRBdmF0YXJTcmMgPSAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9qTk5UNExFLnBuZyc7XHJcbiAgICBjb25zdCBpbnNlcnRNc2cgPSAodmFsdWUsIHR5cGUsIGNzc0NscykgPT4ge1xyXG4gICAgICAgIGxldCBzdHIgPSAnJztcclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAncGhvdG8nOlxyXG4gICAgICAgICAgICAgICAgc3RyID0gYDxkaXYgY2xhc3M9XCJjaGF0LWltZ1wiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiJHt2YWx1ZX1cIiBhbHQ9XCJDb250ZW50IEltYWdlXCIgY2xhc3M9XCJjb250ZW50LWltYWdlXCI+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5gO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xpbmsnOlxyXG4gICAgICAgICAgICAgICAgc3RyID0gYDxkaXYgY2xhc3M9XCJjaGF0LWltZ1wiPlxyXG4gICAgICAgICAgICAgICAgPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIiR7dmFsdWV9XCI+JHt2YWx1ZX08L2E+YDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBzdHIgPSBgPGRpdiBjbGFzcz1cImNoYXQtdGV4dFwiID4ke3ZhbHVlfTwvZGl2PmA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9O1xyXG4gICAgY0xpc3QuZW1wdHkoKS5hZGRDbGFzcygnYm9yZGVyLWxpZ2h0LWNvbG9yJyk7XHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGl0ZW07XHJcbiAgICAgICAgLy8gY29uc3QgY2hlY2twb2ludCA9IGl0ZW0uY2hlY2twb2ludCB8fCBpdGVtO1xyXG5cclxuICAgICAgICBpZiAobWVzc2FnZS5zaWRlID09PSAnbGVmdCcpIHtcclxuICAgICAgICAgICAgJChgPGxpIGNsYXNzPVwiY2hhdC1pdGVtIGNoYXQtaXRlbS1sZWZ0XCIgdmFsdWU9XCIke21lc3NhZ2UudmFsdWV9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4XCI+XHJcbiAgICAgICAgICAgICAgICAkeyhtZXNzYWdlWydwcm9maWxlX3BpY191cmwnXSlcclxuICAgICAgICAgICAgICAgICAgICA/IGA8ZGl2IGNsYXNzPVwiY2hhdC1pbWctYm94XCI+IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9XCIke21lc3NhZ2VbJ3Byb2ZpbGVfcGljX3VybCddfVwiIGFsdD1cIlVzZXIgQXZhdGFyXCIgY2xhc3M9XCJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YFxyXG4gICAgICAgICAgICAgICAgICAgIDogJydcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJjaGF0LXVzZXJuYW1lIHRleHQtbXV0ZWRcIj4ke21lc3NhZ2UudXNlcm5hbWV9PC9wPlxyXG4gICAgICAgICAgICAgICAgICAgICR7aW5zZXJ0TXNnKG1lc3NhZ2UudmFsdWUsIG1lc3NhZ2UudHlwZSl9XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9XCJjaGF0LXRpbWUtdGV4dFwiPiR7bWVzc2FnZS50aW1lc3RhbXB9PC9zbWFsbD5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2xpPmApLmFwcGVuZFRvKGNMaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKGA8bGkgY2xhc3M9XCJjaGF0LWl0ZW0ganVzdGlmeS1jb250ZW50LWVuZCBjaGF0LWl0ZW0tcmlnaHRcIiB2YWx1ZT1cIiR7bWVzc2FnZS52YWx1ZX1cIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXhcIj5cclxuICAgICAgICAgICAgICAgICAgICAke2luc2VydE1zZyhtZXNzYWdlLnZhbHVlLCBtZXNzYWdlLnR5cGUpfVxyXG4gICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz1cInB1bGwtcmlnaHQgY2hhdC10aW1lLXRleHRcIj4ke21lc3NhZ2UudGltZXN0YW1wfTwvc21hbGw+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDwvbGk+YCkuYXBwZW5kVG8oY0xpc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGZpbGxVc2VyTGlzdCgkbGlzdCwgZGF0YUFycmF5KSB7XHJcbiAgICBjb25zdCBpdGVtcyA9IGRhdGFBcnJheTtcclxuICAgIGNvbnN0IGNMaXN0ID0gJGxpc3Q7XHJcbiAgICBjb25zdCB0byA9IGZ1bmN0aW9uKGl0ZW1zKSB7XHJcbiAgICAgICAgbGV0IHRwbCA9ICcnO1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgdHBsICs9IGA8ZGl2PlxyXG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCIke2l0ZW1bJ3Byb2ZpbGVfcGljX3VybCddfVwiIGNsYXNzPVwibWVkaWEtcGhvdG9cIiBzdHlsZT1cIndpZHRoOiAyNHB4O1wiPlxyXG4gICAgICAgICAgICAgICAgJHtpdGVtLnVzZXJuYW1lfVxyXG4gICAgICAgICAgICA8L2Rpdj5gO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0cGw7XHJcbiAgICB9O1xyXG4gICAgY0xpc3QuZW1wdHkoKS5hZGRDbGFzcygnYm9yZGVyLWxpZ2h0LWNvbG9yJyk7XHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgJChgPGxpIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZWRpYVwiPlxyXG4gICAgICAgICAgICAgICAgPGEgaHJlZj1cIiNcIiBjbGFzcz1cIm1yLTNcIj5cclxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImh0dHBzOi8vaS5pbWd1ci5jb20vak5OVDRMRS5wbmdcIlxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPVwibWVkaWEtcGhvdG9cIj5cclxuICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJiYWRnZSBiYWRnZS1zZWNvbmRhcnkgcG9zaXRpb24tYWJzb2x1dGUgcC0yXCI+Mzwvc3Bhbj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lZGlhLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgIDxoNCBjbGFzcz1cInRpdGxlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgJHtpdGVtLm5hbWV9XHJcbiAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPVwidGV4dC1tdXRlZCB0aW1lXCI+MTEuMDIuMjAxODwvc21hbGw+XHJcbiAgICAgICAgICAgICAgICA8L2g0PlxyXG4gICAgICAgICAgICAgICAgJHt0byhpdGVtLnRvKX1cclxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwic3VtbWFyeVwiPiR7aXRlbVsnbGFzdF9tZXNzYWdlJ119PC9wPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9saT5gKS5hcHBlbmRUbyhjTGlzdCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkSGFuZGxlcnMoKSB7XHJcbiAgICAvLyBsZXQgY2hlY2twb2ludFR5cGUgPSAnJztcclxuXHJcbiAgICAkKCcjc2VuZE1lc3NhZ2VCdXR0b24nKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgIC8vIGNvbnN0ICRidXR0b24gPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICBjb25zdCB1c2VyTXNnID0gJCgnI3NlbmRNZXNzYWdlVGV4dEFyZWEnKS52YWwoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh1c2VyTXNnKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkYnV0dG9uKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIGNvbnN0IHtjb252ZXJzYXRpb24sIHVzZXJMaXN0fSA9IGRhdGE7XHJcbiAgICBjb25zdCAkbXNnTGlzdCA9ICQoJy5tZXNzYWdlcy1saXN0Jyk7XHJcbiAgICBjb25zdCAkdXNlckxpc3QgPSAkKCcubWVzc2FnZXMtdXNlci1saXN0Jyk7XHJcbiAgICAvLyBjaGVjayB3ZSBhcmUgaW4gY29ycmVjdCBwYWdlIChtZXNzYWdlcylcclxuICAgIGlmICghJG1zZ0xpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZmlsbExpc3QoJG1zZ0xpc3QsIGNvbnZlcnNhdGlvbi5kYXRhLm1ldGEubWVzc2FnZXMpO1xyXG4gICAgZmlsbFVzZXJMaXN0KCR1c2VyTGlzdCwgdXNlckxpc3QuZGF0YS5tZXRhWzBdLmNvbnZlcnNhdGlvbnMpO1xyXG4gICAgYWRkSGFuZGxlcnMoKTtcclxufVxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYmxvY2tzL21lc3NhZ2VzL21lc3NhZ2VzLmpzIiwiLy8gaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuaW1wb3J0IFB1YlN1YiBmcm9tICdwdWJzdWItanMnOyAvLyBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9wdWJzdWItanNcclxuaW1wb3J0IFVzZXIgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3VzZXInO1xyXG5pbXBvcnQgY29va2llU3RvcmFnZSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29va2llJztcclxuaW1wb3J0IHtDT05TVH0gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2NvbnN0cyc7XHJcbmltcG9ydCB2aWV3VXRpbHMgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3ZpZXcnO1xyXG5cclxuY29uc3Qgc2VsZWN0b3JDbHMgPSB7XHJcbiAgICBmb3JtOiAnLmF1dGgucmVnaXN0ZXIgLmZvcm0tc2lnbmluJyxcclxuICAgIHN1Ym1pdEJ0bjogJ1t0eXBlPVwic3VibWl0XCJdJ1xyXG59O1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWdpc3RlckZvcm0ge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy51c2VyID0gVXNlcjtcclxuICAgICAgICB0aGlzLiRmb3JtID0gJChzZWxlY3RvckNscy5mb3JtKTtcclxuICAgICAgICB0aGlzLiRlbWFpbCA9IHRoaXMuJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIm1haWxcIl0nKTtcclxuICAgICAgICB0aGlzLiR0ZXh0QXJlYURlc2NyaXB0aW9uID0gJCgnI2Rlc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgdGhpcy5mb3JtRGF0YSA9IHsnZW1haWwnOiAndGVzdDFfZW1haWxAbS5ydScsICdwYXNzd29yZCc6ICdwYXNzd29yZCd9O1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKCQoJy5hdXRoLnJlZ2lzdGVyJykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdWJtaXRGb3JtKGZvcm1EYXRhT2JqKSB7XHJcbiAgICAgICAgY29uc3QgZW1haWwgPSB0aGlzLiRlbWFpbC52YWwoKTtcclxuICAgICAgICBjb25zdCAkcGFzc3dvcmQgPSB0aGlzLiRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzXCJdJyksXHJcbiAgICAgICAgICAgICRwYXNzd29yZENvbmZpcm0gPSB0aGlzLiRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzLWNvbmZpcm1cIl0nKSxcclxuICAgICAgICAgICAgcGFzc3dvcmQgPSB0aGlzLiRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzXCJdJykudmFsKCksXHJcbiAgICAgICAgICAgIHBhc3N3b3JkQ29uZmlybSA9IHRoaXMuJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInBhc3MtY29uZmlybVwiXScpLnZhbCgpO1xyXG5cclxuICAgICAgICBpZiAocGFzc3dvcmRDb25maXJtICE9PSBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICAkcGFzc3dvcmQuYWRkQ2xhc3MoJ2lucHV0LWVycm9yJyk7XHJcbiAgICAgICAgICAgICRwYXNzd29yZENvbmZpcm0uYWRkQ2xhc3MoJ2lucHV0LWVycm9yJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy4kZW1haWwudmFsKHRoaXMuJGVtYWlsLnZhbCgpLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgIHRoaXMuZm9ybURhdGEgPSBmb3JtRGF0YU9iaiB8fCB7ZW1haWwsIHBhc3N3b3JkfTtcclxuXHJcbiAgICAgICAgdGhpcy51c2VyLnJlZ2lzdGVyKHRoaXMuZm9ybURhdGEpXHJcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZGF0YSAmJiByZXN1bHQuZGF0YS50b2tlbikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgY29va2llU3RvcmFnZS5zZXQoQ09OU1QuY29va2llU3RvcmFnZS5lbWFpbENvbmZpcm1lZCwgJ2ZhbHNlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvb2tpZVN0b3JhZ2Uuc2V0KENPTlNULmNvb2tpZVN0b3JhZ2UudG9rZW4sIHJlc3VsdC5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygncmVxdWVzdCBzdWNjZWVkZWQgd2l0aCBKU09OIHJlc3BvbnNlJywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBQdWJTdWIucHVibGlzaChDT05TVC5ldmVudHMuVVNFUl9MT0dHRUQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UodGhpcy4kdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdSZWdpc3RlciBhbmQgTG9naW4gc3VjY3Nlc3MnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSh0aGlzLiR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLm1lc3NhZ2UgfHwgJ25vIHJlc3VsdC5kYXRhIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKHRoaXMuJHRleHRBcmVhRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXMuc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5sb2dpbi1ib3gnKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlcXVlc3QgZmFpbGVkJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSh0aGlzLiR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RvIHNvbWV0aGluZycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBiaW5kRXZlbnRzKCkge1xyXG4gICAgICAgIGNvbnN0IHJlZ2lzdGVyQm94ID0gQ09OU1QudWlTZWxlY3RvcnMuaGVhZGVyUmVnQm94OyAvLyAnbmF2IC5yZWdpc3Rlci1ib3gnO1xyXG4gICAgICAgIGNvbnN0IG9wZW5lZENsYXNzID0gJ2QtYmxvY2snO1xyXG4gICAgICAgIGNvbnN0IGNsb3NlQ2xhc3MgPSAnZC1ub25lJztcclxuICAgICAgICBjb25zdCAkYnRuID0gJChzZWxlY3RvckNscy5zdWJtaXRCdG4pLFxyXG4gICAgICAgICAgICBjc3NWYWxpZGF0aW9uQ2xhc3MgPSAnZm9ybS12YWxpZGF0aW9uJztcclxuXHJcbiAgICAgICAgJGJ0bi5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmb3JtID0gdGhpcy4kZm9ybS5nZXQoMCk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghJGJ0bi5pcygnOmRpc2FibGVkJykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmb3JtLmNoZWNrVmFsaWRpdHkoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICRidG4uYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdEZvcm0oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSGlnaGxpZ2h0IGVycm9yc1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtLnJlcG9ydFZhbGlkaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0ucmVwb3J0VmFsaWRpdHkoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZm9ybS5hZGRDbGFzcyhjc3NWYWxpZGF0aW9uQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpc1JlZ0J0bkNsaWNrID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ25hdi5uYXZiYXInKS5maW5kKCcucmVnaXN0ZXItYm94JykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFpc1JlZ0J0bkNsaWNrICYmICQocmVnaXN0ZXJCb3gpLmhhc0NsYXNzKG9wZW5lZENsYXNzKSkge1xyXG4gICAgICAgICAgICAgICAgJChyZWdpc3RlckJveCkuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2Jsb2Nrcy9yZWdpc3Rlci1mb3JtL3JlZ2lzdGVyLWZvcm0uanMiLCIvLyBpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgdmlld1V0aWxzIGZyb20gJy4vdmlldyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOZXR3b3JrIHtcclxuXHJcbiAgICBjYkVycm9yRGVmYXVsdChyZXN1bHQpIHtcclxuICAgICAgICBjb25zdCAkZWwgPSAoJCgnI2Rlc2NyaXB0aW9uJykubGVuZ3RoKSA/ICQoJyNkZXNjcmlwdGlvbicpIDogJCgnLmVycm9yLW1zZycpO1xyXG4gICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UoJGVsLFxyXG4gICAgICAgICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICByZXN1bHQuc3RhdHVzLm1lc3NhZ2UgfHwgJ0xvZ2luIGVycm9yJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tTdGF0dXMocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICYmIHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgICAgZXJyb3IucmVzcG9uc2UgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbmRSZXF1ZXN0KFVSTCwgT1BUUywgY2JFcnJvcikge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChVUkwsIE9QVFMpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IFByb21pc2UuYWxsKFtyZXNwb25zZSwgcmVzcG9uc2UuanNvbigpXSkpXHJcbiAgICAgICAgICAgIC50aGVuKChbcmVzcG9uc2UsIGpzb25dKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2JFcnJvckRlZmF1bHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2JFcnJvcihqc29uKTsgLy8gdXBkYXRlIHZpZXdcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja1N0YXR1cyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKGpzb24uc3RhdHVzLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpzb247XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY29tbW9uL2pzLXNlcnZpY2VzL25ldHdvcmsuanMiLCIvKiBlc2xpbnQtZGlzYWJsZSBzb3J0LXZhcnMgKi9cclxuLy8gaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuaW1wb3J0IFVzZXIgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3VzZXInO1xyXG5pbXBvcnQgUHViU3ViIGZyb20gJ3B1YnN1Yi1qcyc7IC8vIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3B1YnN1Yi1qc1xyXG5pbXBvcnQgY29va2llU3RvcmFnZSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29va2llJztcclxuLy8gaW1wb3J0IFZhbGlkYXRvciBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvZm9ybS12YWxpZGF0b3InO1xyXG5pbXBvcnQgdmlld1V0aWxzIGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy92aWV3JztcclxuaW1wb3J0IHtDT05TVH0gZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL2NvbnN0cyc7XHJcblxyXG4vLyB3aW5kb3cuJCA9ICQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gTG9naW5QYWdlKHNlbGVjdG9yQ3NzKSB7XHJcbiAgICBjb25zdCB7X2Zvcm1JZCwgX2J1dHRvblN1Ym1pdElkLCBfbG9naW5Cb3h9ID0gc2VsZWN0b3JDc3M7XHJcbiAgICBjb25zdCB1c2VyID0gVXNlciwgLy8gc2VydmljZVxyXG4gICAgICAgICRmb3JtID0gJChfZm9ybUlkKSxcclxuICAgICAgICAkZW1haWwgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwibWFpbFwiXScpLFxyXG4gICAgICAgICR0ZXh0QXJlYURlc2NyaXB0aW9uID0gJCgnI2Rlc2NyaXB0aW9uJyk7XHJcbiAgICAvLyBjb25zdCBvcGVuZWRDbGFzcyA9ICdkLWJsb2NrJztcclxuICAgIC8vIGNvbnN0IGNsb3NlQ2xhc3MgPSAnZC1ub25lJztcclxuXHJcbiAgICBjb25zdCB1c2VyTG9naW5IZWFkZXIgPSAoX2Zvcm1EYXRhKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2JFcnJvciA9IChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgJChfbG9naW5Cb3gpLmFwcGVuZCgnPHA+cmVzdWx0LnN0YXR1cy5tZXNzYWdlPC9wPicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB1c2VyLmxvZ2luKF9mb3JtRGF0YSwgY2JFcnJvcilcclxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuZGF0YSAmJiByZXN1bHQuZGF0YS50b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgdGhlIGl0ZW1cclxuICAgICAgICAgICAgICAgICAgICBjb29raWVTdG9yYWdlLnNldChDT05TVC5jb29raWVTdG9yYWdlLnRva2VuLCByZXN1bHQuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLnBhcmVudCgpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygncmVxdWVzdCBzdWNjZWVkZWQgd2l0aCBKU09OIHJlc3BvbnNlJywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3VXRpbHMuc2hvd0luZm9NZXNzYWdlKCR0ZXh0QXJlYURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhdHVzLm1lc3NhZ2UgfHwgJ0xvZ2luIHN1Y2NzZXNzJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdVdGlscy5zaG93SW5mb01lc3NhZ2UodGhpcy4kdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgYDxwPnN0YXR1czogJHtyZXN1bHQuc3RhdHVzLnN0YXRlfTwvcD48cD4gbWVzc2FnZTogJHtyZXN1bHQuc3RhdHVzLm1lc3NhZ2V9PC9wPmApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5zdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1cy5tZXNzYWdlIHx8ICdMb2dpbiBlcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qgc3VibWl0Rm9ybSA9IGZ1bmN0aW9uKGZvcm1EYXRhT2JqKSB7XHJcbiAgICAgICAgY29uc3QgZW1haWwgPSAkZW1haWwudmFsKCksXHJcbiAgICAgICAgICAgIHBhc3N3b3JkID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInBhc3NcIl0nKS52YWwoKSxcclxuICAgICAgICAgICAgX2Zvcm1EYXRhID0gZm9ybURhdGFPYmogfHwge2VtYWlsLCBwYXNzd29yZH07XHJcblxyXG4gICAgICAgIGlmIChzZWxlY3RvckNzcy5pc0xvZ2luSW5zdGFncmFtKSB7XHJcbiAgICAgICAgICAgIC8vIHRvZG86IGRlbGV0ZSBtZVxyXG4gICAgICAgICAgICAvLyBhZGRJbnN0YWdyYW1BY2NvdW50KHt1c2VybmFtZTogJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cInVzZXJuYW1lXCJdJykudmFsKCksIHBhc3N3b3JkfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJGVtYWlsLnZhbCgkZW1haWwudmFsKCkudG9Mb2NhbGVMb3dlckNhc2UoKSk7XHJcbiAgICAgICAgICAgIHVzZXJMb2dpbkhlYWRlcihfZm9ybURhdGEpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gUHViU3ViLnB1Ymxpc2goQ09OU1QuZXZlbnRzLlVTRVJfTE9HR0VELCAnbG9naW4nKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9pbnN0YWdyYW0taW50ZWdyYXRpb24vaW5zdGFncmFtLWFjY291bnRzLmh0bWwnO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGxvZ091dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvb2tpZVN0b3JhZ2UucmVtb3ZlKENPTlNULmNvb2tpZVN0b3JhZ2UudG9rZW4pO1xyXG4gICAgICAgIFB1YlN1Yi5wdWJsaXNoKENPTlNULmV2ZW50cy5VU0VSX0xPR09VVCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGJpbmRFdmVudHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBjb25zdCAkc2hvd0xvZ2luQm94QnRuSWQgPSAkKF9zaG93TG9naW5Cb3hCdG5JZCk7XHJcbiAgICAgICAgY29uc3QgJGxvZ2luQm94ID0gJChfbG9naW5Cb3gpO1xyXG4gICAgICAgIGNvbnN0IG9wZW5lZENsYXNzID0gJ2QtYmxvY2snO1xyXG4gICAgICAgIGNvbnN0IGNsb3NlQ2xhc3MgPSAnZC1ub25lJztcclxuXHJcbiAgICAgICAgLy8gJHNob3dMb2dpbkJveEJ0bklkLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAvLyAgICAgaWYgKCFzZWxlY3RvckNzcy5pc0xvZ2luSW5zdGFncmFtKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAkbG9naW5Cb3guY3NzKHsndG9wJzogMCwgJ3JpZ2h0JzogMH0pXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgLmFkZENsYXNzKCdiZy1saWdodCBib3JkZXIgbXQtNSBteC1hdXRvIHBvc2l0aW9uLWFic29sdXRlJyk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyAgICAgJGxvZ2luQm94LmFkZENsYXNzKG9wZW5lZENsYXNzKS5yZW1vdmVDbGFzcyhjbG9zZUNsYXNzKTtcclxuICAgICAgICAvLyB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgJGJ1dHRvblN1Ym1pdCA9ICQoX2J1dHRvblN1Ym1pdElkKSxcclxuICAgICAgICAgICAgY3NzVmFsaWRhdGlvbkNsYXNzID0gJ2Zvcm0tdmFsaWRhdGlvbic7XHJcblxyXG4gICAgICAgICRidXR0b25TdWJtaXQub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBjb25zdCBmb3JtID0gJGZvcm0uZ2V0KDApO1xyXG4gICAgICAgICAgICAvLyBjb25zdCB2YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKCRmb3JtKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codmlld1V0aWxzLCB2aWV3VXRpbHMuaXNFbWFpbCgkZW1haWwudmFsKCkpKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChmb3JtLmNoZWNrVmFsaWRpdHkoKSAmJiB2aWV3VXRpbHMuaXNFbWFpbCgkZW1haWwudmFsKCkpKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaWdobGlnaHQgZXJyb3JzXHJcbiAgICAgICAgICAgICAgICBpZiAoZm9ybS5yZXBvcnRWYWxpZGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0ucmVwb3J0VmFsaWRpdHkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRmb3JtLmFkZENsYXNzKGNzc1ZhbGlkYXRpb25DbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLm5hdi1saW5rLmpzX2xvZ091dCcpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICQoZS50YXJnZXQpLnBhcmVudCgpLmhpZGUoKTtcclxuICAgICAgICAgICAgdmlld1V0aWxzLnNob3dJbmZvTWVzc2FnZSgkdGV4dEFyZWFEZXNjcmlwdGlvbiwgJ0xvZ2dlZCBvdXQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHViU3ViLnN1YnNjcmliZShDT05TVC5ldmVudHMuVVNFUl9MT0dPVVQsIChtc2cpID0+IHtcclxuICAgICAgICAgICAgJChDT05TVC51aVNlbGVjdG9ycy5oZWFkZXJOYXZMb2dpbkJ0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpOyAvLyAuc2hvdygpO1xyXG4gICAgICAgICAgICAkKENPTlNULnVpU2VsZWN0b3JzLmhlYWRlclJlZ0J0bikuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpLnJlbW92ZUNsYXNzKGNsb3NlQ2xhc3MpO1xyXG4gICAgICAgICAgICAkKCcubmF2LWxpbmsuanNfbG9nT3V0JykuYWRkQ2xhc3MoY2xvc2VDbGFzcykucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpOyAvLyAuaGlkZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvckxvZ2luU3RhdGUgPSAnLmpzX21lc3NhZ2VfbG9nZ2VkLS10ZXh0JztcclxuICAgICAgICAgICAgJChzZWxlY3RvckxvZ2luU3RhdGUpLnRleHQoJ9CS0Ysg0LLRi9GI0LvQuCDQuNC3INCw0LrQutCw0YPQvdGC0LAnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzTG9naW5CdG5DbGljayA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCduYXYubmF2YmFyJykuZmluZCgkbG9naW5Cb3gpLmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgaXNBZGRJbnN0YWdyYW1CdG5DbGlja2VkID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09IENPTlNULnVpU2VsZWN0b3JzLmluc3RhZ3JhbS5hZGRBY2NvdW50QnRuSWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWlzTG9naW5CdG5DbGljayAmJiAkbG9naW5Cb3guaGFzQ2xhc3Mob3BlbmVkQ2xhc3MpICYmICFpc0FkZEluc3RhZ3JhbUJ0bkNsaWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICRsb2dpbkJveC5hZGRDbGFzcyhjbG9zZUNsYXNzKS5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICBpZiAoJCgnLmF1dGgubG9naW4nKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgYmluZEV2ZW50cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXRcclxuICAgIH07XHJcbn1cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3BhZ2VzL19hdXRoL2xvZ2luLXBhZ2UuanMiLCIvKiBlc2xpbnQtZGlzYWJsZSBzb3J0LXZhcnMgKi9cclxuLy8gaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JztcclxuaW1wb3J0IFVzZXIgZnJvbSAnLi4vLi4vY29tbW9uL2pzLXNlcnZpY2VzL3VzZXInO1xyXG4vLyBpbXBvcnQgY29va2llU3RvcmFnZSBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvY29va2llJztcclxuaW1wb3J0IHZpZXdVdGlscyBmcm9tICcuLi8uLi9jb21tb24vanMtc2VydmljZXMvdmlldyc7XHJcbi8vIGltcG9ydCB7Q09OU1R9IGZyb20gJy4uLy4uL2NvbW1vbi9qcy1zZXJ2aWNlcy9jb25zdHMnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEluc3RhZ3JhbShzZWxlY3RvckNTUyA9IHt9KSB7XHJcbiAgICBjb25zdCAkYnV0dG9uU3VibWl0ID0gJCgnI2pzX2luc3RhZ3JhbS1nZXQtYWNjb3VudHMtLWJ0bicpO1xyXG4gICAgY29uc3QgdXNlciA9IFVzZXIsIC8vIHNlcnZpY2VcclxuICAgICAgICAkbGlzdCA9ICQoJy5pbnN0YWdyYW0tYWNjb3VudHMtbGlzdCcpO1xyXG5cclxuICAgIGNvbnN0IHN1Ym1pdEZvcm0gPSBmdW5jdGlvbihmb3JtRGF0YU9iaikge1xyXG4gICAgICAgIGlmICgkYnV0dG9uU3VibWl0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB1c2VyLmdldEluc3RhZ3JhbUFjY291bnQoKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1V0aWxzLmZpbGxMaXN0KCRsaXN0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0YS5hY2NvdW50cyB8fCAnTG9naW4gZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0SW5zdGFncmFtQWNjb3VudCAnLCAkYnV0dG9uU3VibWl0KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICRidXR0b25TdWJtaXQub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBzdWJtaXRGb3JtKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgYmluZEV2ZW50cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdFxyXG4gICAgfTtcclxufVxyXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvcGFnZXMvX2luc3RhZ3JhbS9pbnN0YWdyYW0uanMiLCIvLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL2Jhc2Uuc2Nzc1xuLy8gbW9kdWxlIGlkID0gMTdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLy8gRmluZSBVcGxvYWRlciA1LjE2LjIgLSBNSVQgbGljZW5zZWQuIGh0dHA6Ly9maW5ldXBsb2FkZXIuY29tXG4oZnVuY3Rpb24oZ2xvYmFsKSB7XG4gICAgdmFyIHFxID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGF0dGFjaDogZnVuY3Rpb24odHlwZSwgZm4pIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5hdHRhY2hFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGZuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBxcShlbGVtZW50KS5kZXRhY2godHlwZSwgZm4pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGV0YWNoOiBmdW5jdGlvbih0eXBlLCBmbikge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGZuLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGV0YWNoRXZlbnQoXCJvblwiICsgdHlwZSwgZm4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250YWluczogZnVuY3Rpb24oZGVzY2VuZGFudCkge1xuICAgICAgICAgICAgICAgIGlmICghZGVzY2VuZGFudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSBkZXNjZW5kYW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jb250YWlucykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5jb250YWlucyhkZXNjZW5kYW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gISEoZGVzY2VuZGFudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlbGVtZW50KSAmIDgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKGVsZW1lbnRCKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudEIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbWVudCwgZWxlbWVudEIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzczogZnVuY3Rpb24oc3R5bGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuc3R5bGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoXCJDYW4ndCBhcHBseSBzdHlsZSB0byBub2RlIGFzIGl0IGlzIG5vdCBvbiB0aGUgSFRNTEVsZW1lbnQgcHJvdG90eXBlIGNoYWluIVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0eWxlcy5vcGFjaXR5ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50LnN0eWxlLm9wYWNpdHkgIT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIGVsZW1lbnQuZmlsdGVycyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzLmZpbHRlciA9IFwiYWxwaGEob3BhY2l0eT1cIiArIE1hdGgucm91bmQoMTAwICogc3R5bGVzLm9wYWNpdHkpICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGVsZW1lbnQuc3R5bGUsIHN0eWxlcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzQ2xhc3M6IGZ1bmN0aW9uKG5hbWUsIGNvbnNpZGVyUGFyZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChcIihefCApXCIgKyBuYW1lICsgXCIoIHwkKVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmUudGVzdChlbGVtZW50LmNsYXNzTmFtZSkgfHwgISEoY29uc2lkZXJQYXJlbnQgJiYgcmUudGVzdChlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NOYW1lKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkQ2xhc3M6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXFxKGVsZW1lbnQpLmhhc0NsYXNzKG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9IFwiIFwiICsgbmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKF58IClcIiArIG5hbWUgKyBcIiggfCQpXCIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZShyZSwgXCIgXCIpLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEJ5Q2xhc3M6IGZ1bmN0aW9uKGNsYXNzTmFtZSwgZmlyc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FuZGlkYXRlcywgcmVzdWx0ID0gW107XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0ICYmIGVsZW1lbnQucXVlcnlTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLlwiICsgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FuZGlkYXRlcyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goY2FuZGlkYXRlcywgZnVuY3Rpb24oaWR4LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxKHZhbCkuaGFzQ2xhc3MoY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdCA/IHJlc3VsdFswXSA6IHJlc3VsdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaXJzdEJ5Q2xhc3M6IGZ1bmN0aW9uKGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbGVtZW50KS5nZXRCeUNsYXNzKGNsYXNzTmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdLCBjaGlsZCA9IGVsZW1lbnQuZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICB3aGlsZSAoY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGRyZW47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0VGV4dDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJUZXh0ID0gdGV4dDtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhclRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbGVtZW50KS5zZXRUZXh0KFwiXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc0F0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ck5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0clZhbDtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50Lmhhc0F0dHJpYnV0ZShhdHRyTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gL15mYWxzZSQvaS5leGVjKGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSkgPT0gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhdHRyVmFsID0gZWxlbWVudFthdHRyTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyVmFsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gL15mYWxzZSQvaS5leGVjKGF0dHJWYWwpID09IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEuY2FudmFzVG9CbG9iID0gZnVuY3Rpb24oY2FudmFzLCBtaW1lLCBxdWFsaXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuZGF0YVVyaVRvQmxvYihjYW52YXMudG9EYXRhVVJMKG1pbWUsIHF1YWxpdHkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZGF0YVVyaVRvQmxvYiA9IGZ1bmN0aW9uKGRhdGFVcmkpIHtcbiAgICAgICAgICAgIHZhciBhcnJheUJ1ZmZlciwgYnl0ZVN0cmluZywgY3JlYXRlQmxvYiA9IGZ1bmN0aW9uKGRhdGEsIG1pbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgQmxvYkJ1aWxkZXIgPSB3aW5kb3cuQmxvYkJ1aWxkZXIgfHwgd2luZG93LldlYktpdEJsb2JCdWlsZGVyIHx8IHdpbmRvdy5Nb3pCbG9iQnVpbGRlciB8fCB3aW5kb3cuTVNCbG9iQnVpbGRlciwgYmxvYkJ1aWxkZXIgPSBCbG9iQnVpbGRlciAmJiBuZXcgQmxvYkJ1aWxkZXIoKTtcbiAgICAgICAgICAgICAgICBpZiAoYmxvYkJ1aWxkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgYmxvYkJ1aWxkZXIuYXBwZW5kKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmxvYkJ1aWxkZXIuZ2V0QmxvYihtaW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsb2IoWyBkYXRhIF0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG1pbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgaW50QXJyYXksIG1pbWVTdHJpbmc7XG4gICAgICAgICAgICBpZiAoZGF0YVVyaS5zcGxpdChcIixcIilbMF0uaW5kZXhPZihcImJhc2U2NFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVyaS5zcGxpdChcIixcIilbMV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBieXRlU3RyaW5nID0gZGVjb2RlVVJJKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1pbWVTdHJpbmcgPSBkYXRhVXJpLnNwbGl0KFwiLFwiKVswXS5zcGxpdChcIjpcIilbMV0uc3BsaXQoXCI7XCIpWzBdO1xuICAgICAgICAgICAgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpO1xuICAgICAgICAgICAgaW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7XG4gICAgICAgICAgICBxcS5lYWNoKGJ5dGVTdHJpbmcsIGZ1bmN0aW9uKGlkeCwgY2hhcmFjdGVyKSB7XG4gICAgICAgICAgICAgICAgaW50QXJyYXlbaWR4XSA9IGNoYXJhY3Rlci5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlQmxvYihhcnJheUJ1ZmZlciwgbWltZVN0cmluZyk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmxvZyA9IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmNvbnNvbGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWxldmVsIHx8IGxldmVsID09PSBcImluZm9cIikge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5jb25zb2xlW2xldmVsXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGVbbGV2ZWxdKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKFwiPFwiICsgbGV2ZWwgKyBcIj4gXCIgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNPYmplY3QgPSBmdW5jdGlvbih2YXJpYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhcmlhYmxlICYmICF2YXJpYWJsZS5ub2RlVHlwZSAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFyaWFibGUpID09PSBcIltvYmplY3QgT2JqZWN0XVwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0Z1bmN0aW9uID0gZnVuY3Rpb24odmFyaWFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFyaWFibGUgPT09IFwiZnVuY3Rpb25cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNBcnJheSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiIHx8IHZhbHVlICYmIHdpbmRvdy5BcnJheUJ1ZmZlciAmJiB2YWx1ZS5idWZmZXIgJiYgdmFsdWUuYnVmZmVyLmNvbnN0cnVjdG9yID09PSBBcnJheUJ1ZmZlcjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNJdGVtTGlzdCA9IGZ1bmN0aW9uKG1heWJlSXRlbUxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVJdGVtTGlzdCkgPT09IFwiW29iamVjdCBEYXRhVHJhbnNmZXJJdGVtTGlzdF1cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNOb2RlTGlzdCA9IGZ1bmN0aW9uKG1heWJlTm9kZUxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVOb2RlTGlzdCkgPT09IFwiW29iamVjdCBOb2RlTGlzdF1cIiB8fCBtYXliZU5vZGVMaXN0Lml0ZW0gJiYgbWF5YmVOb2RlTGlzdC5uYW1lZEl0ZW07XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzU3RyaW5nID0gZnVuY3Rpb24obWF5YmVTdHJpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVTdHJpbmcpID09PSBcIltvYmplY3QgU3RyaW5nXVwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS50cmltU3RyID0gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICAgICAgICBpZiAoU3RyaW5nLnByb3RvdHlwZS50cmltKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy50cmltKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5mb3JtYXQgPSBmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgbmV3U3RyID0gc3RyLCBuZXh0SWR4VG9SZXBsYWNlID0gbmV3U3RyLmluZGV4T2YoXCJ7fVwiKTtcbiAgICAgICAgICAgIHFxLmVhY2goYXJncywgZnVuY3Rpb24oaWR4LCB2YWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyQmVmb3JlID0gbmV3U3RyLnN1YnN0cmluZygwLCBuZXh0SWR4VG9SZXBsYWNlKSwgc3RyQWZ0ZXIgPSBuZXdTdHIuc3Vic3RyaW5nKG5leHRJZHhUb1JlcGxhY2UgKyAyKTtcbiAgICAgICAgICAgICAgICBuZXdTdHIgPSBzdHJCZWZvcmUgKyB2YWwgKyBzdHJBZnRlcjtcbiAgICAgICAgICAgICAgICBuZXh0SWR4VG9SZXBsYWNlID0gbmV3U3RyLmluZGV4T2YoXCJ7fVwiLCBuZXh0SWR4VG9SZXBsYWNlICsgdmFsLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRJZHhUb1JlcGxhY2UgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBuZXdTdHI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRmlsZSA9IGZ1bmN0aW9uKG1heWJlRmlsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5GaWxlICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtYXliZUZpbGUpID09PSBcIltvYmplY3QgRmlsZV1cIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGaWxlTGlzdCA9IGZ1bmN0aW9uKG1heWJlRmlsZUxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuRmlsZUxpc3QgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1heWJlRmlsZUxpc3QpID09PSBcIltvYmplY3QgRmlsZUxpc3RdXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzRmlsZU9ySW5wdXQgPSBmdW5jdGlvbihtYXliZUZpbGVPcklucHV0KSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaXNGaWxlKG1heWJlRmlsZU9ySW5wdXQpIHx8IHFxLmlzSW5wdXQobWF5YmVGaWxlT3JJbnB1dCk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlzSW5wdXQgPSBmdW5jdGlvbihtYXliZUlucHV0LCBub3RGaWxlKSB7XG4gICAgICAgICAgICB2YXIgZXZhbHVhdGVUeXBlID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBub3JtYWxpemVkVHlwZSA9IHR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBpZiAobm90RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplZFR5cGUgIT09IFwiZmlsZVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplZFR5cGUgPT09IFwiZmlsZVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuSFRNTElucHV0RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVJbnB1dCkgPT09IFwiW29iamVjdCBIVE1MSW5wdXRFbGVtZW50XVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXliZUlucHV0LnR5cGUgJiYgZXZhbHVhdGVUeXBlKG1heWJlSW5wdXQudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1heWJlSW5wdXQudGFnTmFtZSkge1xuICAgICAgICAgICAgICAgIGlmIChtYXliZUlucHV0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXliZUlucHV0LnR5cGUgJiYgZXZhbHVhdGVUeXBlKG1heWJlSW5wdXQudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0Jsb2IgPSBmdW5jdGlvbihtYXliZUJsb2IpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuQmxvYiAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWF5YmVCbG9iKSA9PT0gXCJbb2JqZWN0IEJsb2JdXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNYaHJVcGxvYWRTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgIGlucHV0LnR5cGUgPSBcImZpbGVcIjtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5tdWx0aXBsZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBGaWxlICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBGb3JtRGF0YSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgcXEuY3JlYXRlWGhySW5zdGFuY2UoKS51cGxvYWQgIT09IFwidW5kZWZpbmVkXCI7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmNyZWF0ZVhockluc3RhbmNlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoXCJNU1hNTDIuWE1MSFRUUC4zLjBcIik7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHFxLmxvZyhcIk5laXRoZXIgWEhSIG9yIEFjdGl2ZVggYXJlIHN1cHBvcnRlZCFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuaXNGb2xkZXJEcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24oZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YVRyYW5zZmVyLml0ZW1zICYmIGRhdGFUcmFuc2Zlci5pdGVtcy5sZW5ndGggPiAwICYmIGRhdGFUcmFuc2Zlci5pdGVtc1swXS53ZWJraXRHZXRBc0VudHJ5O1xuICAgICAgICB9O1xuICAgICAgICBxcS5pc0ZpbGVDaHVua2luZ1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFxcS5hbmRyb2lkU3RvY2soKSAmJiBxcS5pc1hoclVwbG9hZFN1cHBvcnRlZCgpICYmIChGaWxlLnByb3RvdHlwZS5zbGljZSAhPT0gdW5kZWZpbmVkIHx8IEZpbGUucHJvdG90eXBlLndlYmtpdFNsaWNlICE9PSB1bmRlZmluZWQgfHwgRmlsZS5wcm90b3R5cGUubW96U2xpY2UgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLnNsaWNlQmxvYiA9IGZ1bmN0aW9uKGZpbGVPckJsb2IsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgICAgIHZhciBzbGljZXIgPSBmaWxlT3JCbG9iLnNsaWNlIHx8IGZpbGVPckJsb2IubW96U2xpY2UgfHwgZmlsZU9yQmxvYi53ZWJraXRTbGljZTtcbiAgICAgICAgICAgIHJldHVybiBzbGljZXIuY2FsbChmaWxlT3JCbG9iLCBzdGFydCwgZW5kKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuYXJyYXlCdWZmZXJUb0hleCA9IGZ1bmN0aW9uKGJ1ZmZlcikge1xuICAgICAgICAgICAgdmFyIGJ5dGVzQXNIZXggPSBcIlwiLCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XG4gICAgICAgICAgICBxcS5lYWNoKGJ5dGVzLCBmdW5jdGlvbihpZHgsIGJ5dCkge1xuICAgICAgICAgICAgICAgIHZhciBieXRlQXNIZXhTdHIgPSBieXQudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIGlmIChieXRlQXNIZXhTdHIubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICBieXRlQXNIZXhTdHIgPSBcIjBcIiArIGJ5dGVBc0hleFN0cjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnl0ZXNBc0hleCArPSBieXRlQXNIZXhTdHI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBieXRlc0FzSGV4O1xuICAgICAgICB9O1xuICAgICAgICBxcS5yZWFkQmxvYlRvSGV4ID0gZnVuY3Rpb24oYmxvYiwgc3RhcnRPZmZzZXQsIGxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGluaXRpYWxCbG9iID0gcXEuc2xpY2VCbG9iKGJsb2IsIHN0YXJ0T2Zmc2V0LCBzdGFydE9mZnNldCArIGxlbmd0aCksIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHFxLmFycmF5QnVmZmVyVG9IZXgoZmlsZVJlYWRlci5yZXN1bHQpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSBwcm9taXNlLmZhaWx1cmU7XG4gICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGluaXRpYWxCbG9iKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQgPSBmdW5jdGlvbihmaXJzdCwgc2Vjb25kLCBleHRlbmROZXN0ZWQpIHtcbiAgICAgICAgICAgIHFxLmVhY2goc2Vjb25kLCBmdW5jdGlvbihwcm9wLCB2YWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXh0ZW5kTmVzdGVkICYmIHFxLmlzT2JqZWN0KHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0W3Byb3BdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0W3Byb3BdID0ge307XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGZpcnN0W3Byb3BdLCB2YWwsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpcnN0W3Byb3BdID0gdmFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZpcnN0O1xuICAgICAgICB9O1xuICAgICAgICBxcS5vdmVycmlkZSA9IGZ1bmN0aW9uKHRhcmdldCwgc291cmNlRm4pIHtcbiAgICAgICAgICAgIHZhciBzdXBlcl8gPSB7fSwgc291cmNlID0gc291cmNlRm4oc3VwZXJfKTtcbiAgICAgICAgICAgIHFxLmVhY2goc291cmNlLCBmdW5jdGlvbihzcmNQcm9wTmFtZSwgc3JjUHJvcFZhbCkge1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRbc3JjUHJvcE5hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwZXJfW3NyY1Byb3BOYW1lXSA9IHRhcmdldFtzcmNQcm9wTmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRhcmdldFtzcmNQcm9wTmFtZV0gPSBzcmNQcm9wVmFsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9O1xuICAgICAgICBxcS5pbmRleE9mID0gZnVuY3Rpb24oYXJyLCBlbHQsIGZyb20pIHtcbiAgICAgICAgICAgIGlmIChhcnIuaW5kZXhPZikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnIuaW5kZXhPZihlbHQsIGZyb20pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJvbSA9IGZyb20gfHwgMDtcbiAgICAgICAgICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGZyb20gPCAwKSB7XG4gICAgICAgICAgICAgICAgZnJvbSArPSBsZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKDtmcm9tIDwgbGVuOyBmcm9tICs9IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJyLmhhc093blByb3BlcnR5KGZyb20pICYmIGFycltmcm9tXSA9PT0gZWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmcm9tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZ2V0VW5pcXVlSWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwgdiA9IGMgPT0gXCJ4XCIgPyByIDogciAmIDMgfCA4O1xuICAgICAgICAgICAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUVcIikgIT09IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pZTcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFIDdcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pZTggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFIDhcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pZTEwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRSAxMFwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmllMTEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pZSgpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcInJ2OjExXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZWRnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkVkZ2VcIikgPj0gMDtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuc2FmYXJpID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnZlbmRvciAhPT0gdW5kZWZpbmVkICYmIG5hdmlnYXRvci52ZW5kb3IuaW5kZXhPZihcIkFwcGxlXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuY2hyb21lID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnZlbmRvciAhPT0gdW5kZWZpbmVkICYmIG5hdmlnYXRvci52ZW5kb3IuaW5kZXhPZihcIkdvb2dsZVwiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLm9wZXJhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnZlbmRvciAhPT0gdW5kZWZpbmVkICYmIG5hdmlnYXRvci52ZW5kb3IuaW5kZXhPZihcIk9wZXJhXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZmlyZWZveCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFxcS5lZGdlKCkgJiYgIXFxLmllMTEoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNb3ppbGxhXCIpICE9PSAtMSAmJiBuYXZpZ2F0b3IudmVuZG9yICE9PSB1bmRlZmluZWQgJiYgbmF2aWdhdG9yLnZlbmRvciA9PT0gXCJcIjtcbiAgICAgICAgfTtcbiAgICAgICAgcXEud2luZG93cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5wbGF0Zm9ybSA9PT0gXCJXaW4zMlwiO1xuICAgICAgICB9O1xuICAgICAgICBxcS5hbmRyb2lkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJhbmRyb2lkXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuYW5kcm9pZFN0b2NrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuYW5kcm9pZCgpICYmIG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiY2hyb21lXCIpIDwgMDtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zNiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIiBPUyA2X1wiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvczcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCIgT1MgN19cIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3M4ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiIE9TIDhfXCIpICE9PSAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuaW9zODAwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiIE9TIDhfMCBcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJpUGFkXCIpICE9PSAtMSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJpUG9kXCIpICE9PSAtMSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJpUGhvbmVcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3NDaHJvbWUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pb3MoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJDcmlPU1wiKSAhPT0gLTE7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmlvc1NhZmFyaSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmlvcygpICYmICFxcS5pb3NDaHJvbWUoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJTYWZhcmlcIikgIT09IC0xO1xuICAgICAgICB9O1xuICAgICAgICBxcS5pb3NTYWZhcmlXZWJWaWV3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuaW9zKCkgJiYgIXFxLmlvc0Nocm9tZSgpICYmICFxcS5pb3NTYWZhcmkoKTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBxcS50b0VsZW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGh0bWwpIHtcbiAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRpdi5maXJzdENoaWxkO1xuICAgICAgICAgICAgICAgIGRpdi5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oKTtcbiAgICAgICAgcXEuZWFjaCA9IGZ1bmN0aW9uKGl0ZXJhYmxlSXRlbSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBrZXlPckluZGV4LCByZXRWYWw7XG4gICAgICAgICAgICBpZiAoaXRlcmFibGVJdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5TdG9yYWdlICYmIGl0ZXJhYmxlSXRlbS5jb25zdHJ1Y3RvciA9PT0gd2luZG93LlN0b3JhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXlPckluZGV4ID0gMDsga2V5T3JJbmRleCA8IGl0ZXJhYmxlSXRlbS5sZW5ndGg7IGtleU9ySW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gY2FsbGJhY2soaXRlcmFibGVJdGVtLmtleShrZXlPckluZGV4KSwgaXRlcmFibGVJdGVtLmdldEl0ZW0oaXRlcmFibGVJdGVtLmtleShrZXlPckluZGV4KSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNBcnJheShpdGVyYWJsZUl0ZW0pIHx8IHFxLmlzSXRlbUxpc3QoaXRlcmFibGVJdGVtKSB8fCBxcS5pc05vZGVMaXN0KGl0ZXJhYmxlSXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXlPckluZGV4ID0gMDsga2V5T3JJbmRleCA8IGl0ZXJhYmxlSXRlbS5sZW5ndGg7IGtleU9ySW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gY2FsbGJhY2soa2V5T3JJbmRleCwgaXRlcmFibGVJdGVtW2tleU9ySW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzU3RyaW5nKGl0ZXJhYmxlSXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXlPckluZGV4ID0gMDsga2V5T3JJbmRleCA8IGl0ZXJhYmxlSXRlbS5sZW5ndGg7IGtleU9ySW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gY2FsbGJhY2soa2V5T3JJbmRleCwgaXRlcmFibGVJdGVtLmNoYXJBdChrZXlPckluZGV4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXlPckluZGV4IGluIGl0ZXJhYmxlSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChpdGVyYWJsZUl0ZW0sIGtleU9ySW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gY2FsbGJhY2soa2V5T3JJbmRleCwgaXRlcmFibGVJdGVtW2tleU9ySW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmJpbmQgPSBmdW5jdGlvbihvbGRGdW5jLCBjb250ZXh0KSB7XG4gICAgICAgICAgICBpZiAocXEuaXNGdW5jdGlvbihvbGRGdW5jKSkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdBcmdzID0gcXEuZXh0ZW5kKFtdLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FyZ3MgPSBuZXdBcmdzLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2xkRnVuYy5hcHBseShjb250ZXh0LCBuZXdBcmdzKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZmlyc3QgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbiFcIik7XG4gICAgICAgIH07XG4gICAgICAgIHFxLm9iajJ1cmwgPSBmdW5jdGlvbihvYmosIHRlbXAsIHByZWZpeERvbmUpIHtcbiAgICAgICAgICAgIHZhciB1cmlzdHJpbmdzID0gW10sIHByZWZpeCA9IFwiJlwiLCBhZGQgPSBmdW5jdGlvbihuZXh0T2JqLCBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRUZW1wID0gdGVtcCA/IC9cXFtcXF0kLy50ZXN0KHRlbXApID8gdGVtcCA6IHRlbXAgKyBcIltcIiArIGkgKyBcIl1cIiA6IGk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRUZW1wICE9PSBcInVuZGVmaW5lZFwiICYmIGkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJpc3RyaW5ncy5wdXNoKHR5cGVvZiBuZXh0T2JqID09PSBcIm9iamVjdFwiID8gcXEub2JqMnVybChuZXh0T2JqLCBuZXh0VGVtcCwgdHJ1ZSkgOiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobmV4dE9iaikgPT09IFwiW29iamVjdCBGdW5jdGlvbl1cIiA/IGVuY29kZVVSSUNvbXBvbmVudChuZXh0VGVtcCkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChuZXh0T2JqKCkpIDogZW5jb2RlVVJJQ29tcG9uZW50KG5leHRUZW1wKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG5leHRPYmopKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKCFwcmVmaXhEb25lICYmIHRlbXApIHtcbiAgICAgICAgICAgICAgICBwcmVmaXggPSAvXFw/Ly50ZXN0KHRlbXApID8gL1xcPyQvLnRlc3QodGVtcCkgPyBcIlwiIDogXCImXCIgOiBcIj9cIjtcbiAgICAgICAgICAgICAgICB1cmlzdHJpbmdzLnB1c2godGVtcCk7XG4gICAgICAgICAgICAgICAgdXJpc3RyaW5ncy5wdXNoKHFxLm9iajJ1cmwob2JqKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSBcIltvYmplY3QgQXJyYXldXCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgIHFxLmVhY2gob2JqLCBmdW5jdGlvbihpZHgsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBhZGQodmFsLCBpZHgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqICE9PSBcInVuZGVmaW5lZFwiICYmIG9iaiAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChvYmosIGZ1bmN0aW9uKHByb3AsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBhZGQodmFsLCBwcm9wKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXJpc3RyaW5ncy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudCh0ZW1wKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9iaikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRlbXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJpc3RyaW5ncy5qb2luKHByZWZpeCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmlzdHJpbmdzLmpvaW4ocHJlZml4KS5yZXBsYWNlKC9eJi8sIFwiXCIpLnJlcGxhY2UoLyUyMC9nLCBcIitcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLm9iajJGb3JtRGF0YSA9IGZ1bmN0aW9uKG9iaiwgZm9ybURhdGEsIGFycmF5S2V5TmFtZSkge1xuICAgICAgICAgICAgaWYgKCFmb3JtRGF0YSkge1xuICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxcS5lYWNoKG9iaiwgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICBrZXkgPSBhcnJheUtleU5hbWUgPyBhcnJheUtleU5hbWUgKyBcIltcIiArIGtleSArIFwiXVwiIDoga2V5O1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc09iamVjdCh2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLm9iajJGb3JtRGF0YSh2YWwsIGZvcm1EYXRhLCBrZXkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNGdW5jdGlvbih2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChrZXksIHZhbCgpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCB2YWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZvcm1EYXRhO1xuICAgICAgICB9O1xuICAgICAgICBxcS5vYmoySW5wdXRzID0gZnVuY3Rpb24ob2JqLCBmb3JtKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQ7XG4gICAgICAgICAgICBpZiAoIWZvcm0pIHtcbiAgICAgICAgICAgICAgICBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvcm1cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxcS5vYmoyRm9ybURhdGEob2JqLCB7XG4gICAgICAgICAgICAgICAgYXBwZW5kOiBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBrZXkpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiLCB2YWwpO1xuICAgICAgICAgICAgICAgICAgICBmb3JtLmFwcGVuZENoaWxkKGlucHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmb3JtO1xuICAgICAgICB9O1xuICAgICAgICBxcS5wYXJzZUpzb24gPSBmdW5jdGlvbihqc29uKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LkpTT04gJiYgcXEuaXNGdW5jdGlvbihKU09OLnBhcnNlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChcIihcIiArIGpzb24gKyBcIilcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmdldEV4dGVuc2lvbiA9IGZ1bmN0aW9uKGZpbGVuYW1lKSB7XG4gICAgICAgICAgICB2YXIgZXh0SWR4ID0gZmlsZW5hbWUubGFzdEluZGV4T2YoXCIuXCIpICsgMTtcbiAgICAgICAgICAgIGlmIChleHRJZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVuYW1lLnN1YnN0cihleHRJZHgsIGZpbGVuYW1lLmxlbmd0aCAtIGV4dElkeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmdldEZpbGVuYW1lID0gZnVuY3Rpb24oYmxvYk9yRmlsZUlucHV0KSB7XG4gICAgICAgICAgICBpZiAocXEuaXNJbnB1dChibG9iT3JGaWxlSW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JPckZpbGVJbnB1dC52YWx1ZS5yZXBsYWNlKC8uKihcXC98XFxcXCkvLCBcIlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocXEuaXNGaWxlKGJsb2JPckZpbGVJbnB1dCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYmxvYk9yRmlsZUlucHV0LmZpbGVOYW1lICE9PSBudWxsICYmIGJsb2JPckZpbGVJbnB1dC5maWxlTmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBibG9iT3JGaWxlSW5wdXQuZmlsZU5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJsb2JPckZpbGVJbnB1dC5uYW1lO1xuICAgICAgICB9O1xuICAgICAgICBxcS5EaXNwb3NlU3VwcG9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRpc3Bvc2VycyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3Bvc2VyO1xuICAgICAgICAgICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwb3NlciA9IGRpc3Bvc2Vycy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3Bvc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoZGlzcG9zZXIpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYXR0YWNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRGlzcG9zZXIocXEoYXJnc1swXSkuYXR0YWNoLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFkZERpc3Bvc2VyOiBmdW5jdGlvbihkaXNwb3NlRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcG9zZXJzLnB1c2goZGlzcG9zZUZ1bmN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH0pKCk7XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgICAgICBkZWZpbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBxcTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdsb2JhbC5xcSA9IHFxO1xuICAgICAgICB9XG4gICAgfSkoKTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS5FcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IFwiW0ZpbmUgVXBsb2FkZXIgXCIgKyBxcS52ZXJzaW9uICsgXCJdIFwiICsgbWVzc2FnZTtcbiAgICAgICAgfTtcbiAgICAgICAgcXEuRXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XG4gICAgfSkoKTtcbiAgICBxcS52ZXJzaW9uID0gXCI1LjE2LjJcIjtcbiAgICBxcS5zdXBwb3J0ZWRGZWF0dXJlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHN1cHBvcnRzVXBsb2FkaW5nLCBzdXBwb3J0c1VwbG9hZGluZ0Jsb2JzLCBzdXBwb3J0c0ZpbGVEcm9wLCBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLCBzdXBwb3J0c0ZvbGRlckRyb3AsIHN1cHBvcnRzQ2h1bmtpbmcsIHN1cHBvcnRzUmVzdW1lLCBzdXBwb3J0c1VwbG9hZFZpYVBhc3RlLCBzdXBwb3J0c1VwbG9hZENvcnMsIHN1cHBvcnRzRGVsZXRlRmlsZVhkciwgc3VwcG9ydHNEZWxldGVGaWxlQ29yc1hociwgc3VwcG9ydHNEZWxldGVGaWxlQ29ycywgc3VwcG9ydHNGb2xkZXJTZWxlY3Rpb24sIHN1cHBvcnRzSW1hZ2VQcmV2aWV3cywgc3VwcG9ydHNVcGxvYWRQcm9ncmVzcztcbiAgICAgICAgZnVuY3Rpb24gdGVzdFN1cHBvcnRzRmlsZUlucHV0RWxlbWVudCgpIHtcbiAgICAgICAgICAgIHZhciBzdXBwb3J0ZWQgPSB0cnVlLCB0ZW1wSW5wdXQ7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRlbXBJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICB0ZW1wSW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgICAgICAgICAgICAgIHFxKHRlbXBJbnB1dCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGlmICh0ZW1wSW5wdXQuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICBzdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdXBwb3J0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDaHJvbWUxNE9ySGlnaGVyKCkge1xuICAgICAgICAgICAgcmV0dXJuIChxcS5jaHJvbWUoKSB8fCBxcS5vcGVyYSgpKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9DaHJvbWVcXC9bMV1bNC05XXxDaHJvbWVcXC9bMi05XVswLTldLykgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0Nyb3NzT3JpZ2luWGhyU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIHZhciB4aHIgPSBxcS5jcmVhdGVYaHJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB4aHIud2l0aENyZWRlbnRpYWxzICE9PSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNYZHJTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LlhEb21haW5SZXF1ZXN0ICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDcm9zc09yaWdpbkFqYXhTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICBpZiAoaXNDcm9zc09yaWdpblhoclN1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaXNYZHJTdXBwb3J0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0ZvbGRlclNlbGVjdGlvblN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIikud2Via2l0ZGlyZWN0b3J5ICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNMb2NhbFN0b3JhZ2VTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIXdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgcXEuaXNGdW5jdGlvbih3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNEcmFnQW5kRHJvcFN1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgICAgICByZXR1cm4gKFwiZHJhZ2dhYmxlXCIgaW4gc3BhbiB8fCBcIm9uZHJhZ3N0YXJ0XCIgaW4gc3BhbiAmJiBcIm9uZHJvcFwiIGluIHNwYW4pICYmICFxcS5hbmRyb2lkKCkgJiYgIXFxLmlvcygpO1xuICAgICAgICB9XG4gICAgICAgIHN1cHBvcnRzVXBsb2FkaW5nID0gdGVzdFN1cHBvcnRzRmlsZUlucHV0RWxlbWVudCgpO1xuICAgICAgICBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nID0gc3VwcG9ydHNVcGxvYWRpbmcgJiYgcXEuaXNYaHJVcGxvYWRTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNVcGxvYWRpbmdCbG9icyA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgIXFxLmFuZHJvaWRTdG9jaygpO1xuICAgICAgICBzdXBwb3J0c0ZpbGVEcm9wID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiBpc0RyYWdBbmREcm9wU3VwcG9ydGVkKCk7XG4gICAgICAgIHN1cHBvcnRzRm9sZGVyRHJvcCA9IHN1cHBvcnRzRmlsZURyb3AgJiYgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICBpbnB1dC50eXBlID0gXCJmaWxlXCI7XG4gICAgICAgICAgICByZXR1cm4gISEoXCJ3ZWJraXRkaXJlY3RvcnlcIiBpbiAoaW5wdXQgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImlucHV0W3R5cGU9ZmlsZV1cIilbMF0pKTtcbiAgICAgICAgfSgpO1xuICAgICAgICBzdXBwb3J0c0NodW5raW5nID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiBxcS5pc0ZpbGVDaHVua2luZ1N1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c1Jlc3VtZSA9IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcgJiYgc3VwcG9ydHNDaHVua2luZyAmJiBpc0xvY2FsU3RvcmFnZVN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c1VwbG9hZFZpYVBhc3RlID0gc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyAmJiBpc0Nocm9tZTE0T3JIaWdoZXIoKTtcbiAgICAgICAgc3VwcG9ydHNVcGxvYWRDb3JzID0gc3VwcG9ydHNVcGxvYWRpbmcgJiYgKHdpbmRvdy5wb3N0TWVzc2FnZSAhPT0gdW5kZWZpbmVkIHx8IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcpO1xuICAgICAgICBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzWGhyID0gaXNDcm9zc09yaWdpblhoclN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c0RlbGV0ZUZpbGVYZHIgPSBpc1hkclN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c0RlbGV0ZUZpbGVDb3JzID0gaXNDcm9zc09yaWdpbkFqYXhTdXBwb3J0ZWQoKTtcbiAgICAgICAgc3VwcG9ydHNGb2xkZXJTZWxlY3Rpb24gPSBpc0ZvbGRlclNlbGVjdGlvblN1cHBvcnRlZCgpO1xuICAgICAgICBzdXBwb3J0c0ltYWdlUHJldmlld3MgPSBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nICYmIHdpbmRvdy5GaWxlUmVhZGVyICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIHN1cHBvcnRzVXBsb2FkUHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFxcS5hbmRyb2lkU3RvY2soKSAmJiAhcXEuaW9zQ2hyb21lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0oKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFqYXhVcGxvYWRpbmc6IHN1cHBvcnRzQWpheEZpbGVVcGxvYWRpbmcsXG4gICAgICAgICAgICBibG9iVXBsb2FkaW5nOiBzdXBwb3J0c1VwbG9hZGluZ0Jsb2JzLFxuICAgICAgICAgICAgY2FuRGV0ZXJtaW5lU2l6ZTogc3VwcG9ydHNBamF4RmlsZVVwbG9hZGluZyxcbiAgICAgICAgICAgIGNodW5raW5nOiBzdXBwb3J0c0NodW5raW5nLFxuICAgICAgICAgICAgZGVsZXRlRmlsZUNvcnM6IHN1cHBvcnRzRGVsZXRlRmlsZUNvcnMsXG4gICAgICAgICAgICBkZWxldGVGaWxlQ29yc1hkcjogc3VwcG9ydHNEZWxldGVGaWxlWGRyLFxuICAgICAgICAgICAgZGVsZXRlRmlsZUNvcnNYaHI6IHN1cHBvcnRzRGVsZXRlRmlsZUNvcnNYaHIsXG4gICAgICAgICAgICBkaWFsb2dFbGVtZW50OiAhIXdpbmRvdy5IVE1MRGlhbG9nRWxlbWVudCxcbiAgICAgICAgICAgIGZpbGVEcm9wOiBzdXBwb3J0c0ZpbGVEcm9wLFxuICAgICAgICAgICAgZm9sZGVyRHJvcDogc3VwcG9ydHNGb2xkZXJEcm9wLFxuICAgICAgICAgICAgZm9sZGVyU2VsZWN0aW9uOiBzdXBwb3J0c0ZvbGRlclNlbGVjdGlvbixcbiAgICAgICAgICAgIGltYWdlUHJldmlld3M6IHN1cHBvcnRzSW1hZ2VQcmV2aWV3cyxcbiAgICAgICAgICAgIGltYWdlVmFsaWRhdGlvbjogc3VwcG9ydHNJbWFnZVByZXZpZXdzLFxuICAgICAgICAgICAgaXRlbVNpemVWYWxpZGF0aW9uOiBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLFxuICAgICAgICAgICAgcGF1c2U6IHN1cHBvcnRzQ2h1bmtpbmcsXG4gICAgICAgICAgICBwcm9ncmVzc0Jhcjogc3VwcG9ydHNVcGxvYWRQcm9ncmVzcyxcbiAgICAgICAgICAgIHJlc3VtZTogc3VwcG9ydHNSZXN1bWUsXG4gICAgICAgICAgICBzY2FsaW5nOiBzdXBwb3J0c0ltYWdlUHJldmlld3MgJiYgc3VwcG9ydHNVcGxvYWRpbmdCbG9icyxcbiAgICAgICAgICAgIHRpZmZQcmV2aWV3czogcXEuc2FmYXJpKCksXG4gICAgICAgICAgICB1bmxpbWl0ZWRTY2FsZWRJbWFnZVNpemU6ICFxcS5pb3MoKSxcbiAgICAgICAgICAgIHVwbG9hZGluZzogc3VwcG9ydHNVcGxvYWRpbmcsXG4gICAgICAgICAgICB1cGxvYWRDb3JzOiBzdXBwb3J0c1VwbG9hZENvcnMsXG4gICAgICAgICAgICB1cGxvYWRDdXN0b21IZWFkZXJzOiBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLFxuICAgICAgICAgICAgdXBsb2FkTm9uTXVsdGlwYXJ0OiBzdXBwb3J0c0FqYXhGaWxlVXBsb2FkaW5nLFxuICAgICAgICAgICAgdXBsb2FkVmlhUGFzdGU6IHN1cHBvcnRzVXBsb2FkVmlhUGFzdGVcbiAgICAgICAgfTtcbiAgICB9KCk7XG4gICAgcXEuaXNHZW5lcmljUHJvbWlzZSA9IGZ1bmN0aW9uKG1heWJlUHJvbWlzZSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcmV0dXJuICEhKG1heWJlUHJvbWlzZSAmJiBtYXliZVByb21pc2UudGhlbiAmJiBxcS5pc0Z1bmN0aW9uKG1heWJlUHJvbWlzZS50aGVuKSk7XG4gICAgfTtcbiAgICBxcS5Qcm9taXNlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc3VjY2Vzc0FyZ3MsIGZhaWx1cmVBcmdzLCBzdWNjZXNzQ2FsbGJhY2tzID0gW10sIGZhaWx1cmVDYWxsYmFja3MgPSBbXSwgZG9uZUNhbGxiYWNrcyA9IFtdLCBzdGF0ZSA9IDA7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICB0aGVuOiBmdW5jdGlvbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob25TdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2tzLnB1c2gob25TdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob25GYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlQ2FsbGJhY2tzLnB1c2gob25GYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZSAmJiBvbkZhaWx1cmUuYXBwbHkobnVsbCwgZmFpbHVyZUFyZ3MpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob25TdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uU3VjY2Vzcy5hcHBseShudWxsLCBzdWNjZXNzQXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmVDYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgZmFpbHVyZUFyZ3MgPT09IHVuZGVmaW5lZCA/IHN1Y2Nlc3NBcmdzIDogZmFpbHVyZUFyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IDE7XG4gICAgICAgICAgICAgICAgc3VjY2Vzc0FyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3NDYWxsYmFja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goc3VjY2Vzc0NhbGxiYWNrcywgZnVuY3Rpb24oaWR4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgc3VjY2Vzc0FyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRvbmVDYWxsYmFja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZG9uZUNhbGxiYWNrcywgZnVuY3Rpb24oaWR4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgc3VjY2Vzc0FyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmFpbHVyZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUgPSAtMTtcbiAgICAgICAgICAgICAgICBmYWlsdXJlQXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZUNhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChmYWlsdXJlQ2FsbGJhY2tzLCBmdW5jdGlvbihpZHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBmYWlsdXJlQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZG9uZUNhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkb25lQ2FsbGJhY2tzLCBmdW5jdGlvbihpZHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBmYWlsdXJlQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5CbG9iUHJveHkgPSBmdW5jdGlvbihyZWZlcmVuY2VCbG9iLCBvbkNyZWF0ZSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHJlZmVyZW5jZUJsb2I6IHJlZmVyZW5jZUJsb2IsXG4gICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvbkNyZWF0ZShyZWZlcmVuY2VCbG9iKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5VcGxvYWRCdXR0b24gPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGRpc3Bvc2VTdXBwb3J0ID0gbmV3IHFxLkRpc3Bvc2VTdXBwb3J0KCksIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBhY2NlcHRGaWxlczogbnVsbCxcbiAgICAgICAgICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICBmb2N1c0NsYXNzOiBcInFxLXVwbG9hZC1idXR0b24tZm9jdXNcIixcbiAgICAgICAgICAgIGZvbGRlcnM6IGZhbHNlLFxuICAgICAgICAgICAgaG92ZXJDbGFzczogXCJxcS11cGxvYWQtYnV0dG9uLWhvdmVyXCIsXG4gICAgICAgICAgICBpb3M4QnJvd3NlckNyYXNoV29ya2Fyb3VuZDogZmFsc2UsXG4gICAgICAgICAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgICAgICAgICBuYW1lOiBcInFxZmlsZVwiLFxuICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uKGlucHV0KSB7fSxcbiAgICAgICAgICAgIHRpdGxlOiBudWxsXG4gICAgICAgIH0sIGlucHV0LCBidXR0b25JZDtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBidXR0b25JZCA9IHFxLmdldFVuaXF1ZUlkKCk7XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUlucHV0KCkge1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKHFxLlVwbG9hZEJ1dHRvbi5CVVRUT05fSURfQVRUUl9OQU1FLCBidXR0b25JZCk7XG4gICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBvcHRpb25zLnRpdGxlKTtcbiAgICAgICAgICAgIHNlbGYuc2V0TXVsdGlwbGUob3B0aW9ucy5tdWx0aXBsZSwgaW5wdXQpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZm9sZGVycyAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5mb2xkZXJTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ3ZWJraXRkaXJlY3RvcnlcIiwgXCJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5hY2NlcHRGaWxlcykge1xuICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcImFjY2VwdFwiLCBvcHRpb25zLmFjY2VwdEZpbGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJmaWxlXCIpO1xuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBvcHRpb25zLm5hbWUpO1xuICAgICAgICAgICAgcXEoaW5wdXQpLmNzcyh7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgZm9udEZhbWlseTogXCJBcmlhbFwiLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiBxcS5pZSgpICYmICFxcS5pZTgoKSA/IFwiMzUwMHB4XCIgOiBcIjExOHB4XCIsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgICAgY3Vyc29yOiBcInBvaW50ZXJcIixcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICFxcS5pZTcoKSAmJiBxcShpbnB1dCkuY3NzKHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFwiMTAwJVwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9wdGlvbnMuZWxlbWVudC5hcHBlbmRDaGlsZChpbnB1dCk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goaW5wdXQsIFwiY2hhbmdlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMub25DaGFuZ2UoaW5wdXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goaW5wdXQsIFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkuYWRkQ2xhc3Mob3B0aW9ucy5ob3ZlckNsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGlucHV0LCBcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5ob3ZlckNsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGlucHV0LCBcImZvY3VzXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkuYWRkQ2xhc3Mob3B0aW9ucy5mb2N1c0NsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGlucHV0LCBcImJsdXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5yZW1vdmVDbGFzcyhvcHRpb25zLmZvY3VzQ2xhc3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICAgIH1cbiAgICAgICAgcXEob3B0aW9ucy5lbGVtZW50KS5jc3Moe1xuICAgICAgICAgICAgcG9zaXRpb246IFwicmVsYXRpdmVcIixcbiAgICAgICAgICAgIG92ZXJmbG93OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiBcImx0clwiXG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgZ2V0SW5wdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRCdXR0b25JZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbklkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE11bHRpcGxlOiBmdW5jdGlvbihpc011bHRpcGxlLCBvcHRJbnB1dCkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IG9wdElucHV0IHx8IHRoaXMuZ2V0SW5wdXQoKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5pb3M4QnJvd3NlckNyYXNoV29ya2Fyb3VuZCAmJiBxcS5pb3M4KCkgJiYgKHFxLmlvc0Nocm9tZSgpIHx8IHFxLmlvc1NhZmFyaVdlYlZpZXcoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwibXVsdGlwbGVcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQucmVtb3ZlQXR0cmlidXRlKFwibXVsdGlwbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0QWNjZXB0RmlsZXM6IGZ1bmN0aW9uKGFjY2VwdEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFjY2VwdEZpbGVzICE9PSBvcHRpb25zLmFjY2VwdEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcImFjY2VwdFwiLCBhY2NlcHRGaWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBxcShpbnB1dCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxKG9wdGlvbnMuZWxlbWVudCkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5mb2N1c0NsYXNzKTtcbiAgICAgICAgICAgICAgICBpbnB1dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSBjcmVhdGVJbnB1dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaW5wdXQgPSBjcmVhdGVJbnB1dCgpO1xuICAgIH07XG4gICAgcXEuVXBsb2FkQnV0dG9uLkJVVFRPTl9JRF9BVFRSX05BTUUgPSBcInFxLWJ1dHRvbi1pZFwiO1xuICAgIHFxLlVwbG9hZERhdGEgPSBmdW5jdGlvbih1cGxvYWRlclByb3h5KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZGF0YSA9IFtdLCBieVV1aWQgPSB7fSwgYnlTdGF0dXMgPSB7fSwgYnlQcm94eUdyb3VwSWQgPSB7fSwgYnlCYXRjaElkID0ge307XG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGFCeUlkcyhpZE9ySWRzKSB7XG4gICAgICAgICAgICBpZiAocXEuaXNBcnJheShpZE9ySWRzKSkge1xuICAgICAgICAgICAgICAgIHZhciBlbnRyaWVzID0gW107XG4gICAgICAgICAgICAgICAgcXEuZWFjaChpZE9ySWRzLCBmdW5jdGlvbihpZHgsIGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChkYXRhW2lkXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVudHJpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGF0YVtpZE9ySWRzXTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhQnlVdWlkcyh1dWlkcykge1xuICAgICAgICAgICAgaWYgKHFxLmlzQXJyYXkodXVpZHMpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVudHJpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHV1aWRzLCBmdW5jdGlvbihpZHgsIHV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGRhdGFbYnlVdWlkW3V1aWRdXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVudHJpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGF0YVtieVV1aWRbdXVpZHNdXTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhQnlTdGF0dXMoc3RhdHVzKSB7XG4gICAgICAgICAgICB2YXIgc3RhdHVzUmVzdWx0cyA9IFtdLCBzdGF0dXNlcyA9IFtdLmNvbmNhdChzdGF0dXMpO1xuICAgICAgICAgICAgcXEuZWFjaChzdGF0dXNlcywgZnVuY3Rpb24oaW5kZXgsIHN0YXR1c0VudW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzUmVzdWx0SW5kZXhlcyA9IGJ5U3RhdHVzW3N0YXR1c0VudW1dO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXNSZXN1bHRJbmRleGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChzdGF0dXNSZXN1bHRJbmRleGVzLCBmdW5jdGlvbihpLCBkYXRhSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1Jlc3VsdHMucHVzaChkYXRhW2RhdGFJbmRleF0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBzdGF0dXNSZXN1bHRzO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBhZGRGaWxlOiBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHNwZWMuc3RhdHVzIHx8IHFxLnN0YXR1cy5TVUJNSVRUSU5HLCBpZCA9IGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNwZWMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxOYW1lOiBzcGVjLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IHNwZWMudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc3BlYy5zaXplID09IG51bGwgPyAtMSA6IHNwZWMuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IHNwZWMuZmlsZVxuICAgICAgICAgICAgICAgIH0pIC0gMTtcbiAgICAgICAgICAgICAgICBpZiAoc3BlYy5iYXRjaElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaWRdLmJhdGNoSWQgPSBzcGVjLmJhdGNoSWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChieUJhdGNoSWRbc3BlYy5iYXRjaElkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBieUJhdGNoSWRbc3BlYy5iYXRjaElkXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJ5QmF0Y2hJZFtzcGVjLmJhdGNoSWRdLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc3BlYy5wcm94eUdyb3VwSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpZF0ucHJveHlHcm91cElkID0gc3BlYy5wcm94eUdyb3VwSWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChieVByb3h5R3JvdXBJZFtzcGVjLnByb3h5R3JvdXBJZF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnlQcm94eUdyb3VwSWRbc3BlYy5wcm94eUdyb3VwSWRdID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnlQcm94eUdyb3VwSWRbc3BlYy5wcm94eUdyb3VwSWRdLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYXRhW2lkXS5pZCA9IGlkO1xuICAgICAgICAgICAgICAgIGJ5VXVpZFtzcGVjLnV1aWRdID0gaWQ7XG4gICAgICAgICAgICAgICAgaWYgKGJ5U3RhdHVzW3N0YXR1c10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBieVN0YXR1c1tzdGF0dXNdID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ5U3RhdHVzW3N0YXR1c10ucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkJlZm9yZVN0YXR1c0NoYW5nZSAmJiBzcGVjLm9uQmVmb3JlU3RhdHVzQ2hhbmdlKGlkKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlclByb3h5Lm9uU3RhdHVzQ2hhbmdlKGlkLCBudWxsLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyaWV2ZTogZnVuY3Rpb24ob3B0aW9uYWxGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNPYmplY3Qob3B0aW9uYWxGaWx0ZXIpICYmIGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbEZpbHRlci5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RGF0YUJ5SWRzKG9wdGlvbmFsRmlsdGVyLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbEZpbHRlci51dWlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXREYXRhQnlVdWlkcyhvcHRpb25hbEZpbHRlci51dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbEZpbHRlci5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXREYXRhQnlTdGF0dXMob3B0aW9uYWxGaWx0ZXIuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxcS5leHRlbmQoW10sIGRhdGEsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVGaWxlUmVmOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSBnZXREYXRhQnlJZHMoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChyZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlY29yZC5maWxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGJ5VXVpZCA9IHt9O1xuICAgICAgICAgICAgICAgIGJ5U3RhdHVzID0ge307XG4gICAgICAgICAgICAgICAgYnlCYXRjaElkID0ge307XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbihpZCwgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9sZFN0YXR1cyA9IGRhdGFbaWRdLnN0YXR1cywgYnlTdGF0dXNPbGRTdGF0dXNJbmRleCA9IHFxLmluZGV4T2YoYnlTdGF0dXNbb2xkU3RhdHVzXSwgaWQpO1xuICAgICAgICAgICAgICAgIGJ5U3RhdHVzW29sZFN0YXR1c10uc3BsaWNlKGJ5U3RhdHVzT2xkU3RhdHVzSW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIGRhdGFbaWRdLnN0YXR1cyA9IG5ld1N0YXR1cztcbiAgICAgICAgICAgICAgICBpZiAoYnlTdGF0dXNbbmV3U3RhdHVzXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ5U3RhdHVzW25ld1N0YXR1c10gPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnlTdGF0dXNbbmV3U3RhdHVzXS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlclByb3h5Lm9uU3RhdHVzQ2hhbmdlKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXVpZENoYW5nZWQ6IGZ1bmN0aW9uKGlkLCBuZXdVdWlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9sZFV1aWQgPSBkYXRhW2lkXS51dWlkO1xuICAgICAgICAgICAgICAgIGRhdGFbaWRdLnV1aWQgPSBuZXdVdWlkO1xuICAgICAgICAgICAgICAgIGJ5VXVpZFtuZXdVdWlkXSA9IGlkO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBieVV1aWRbb2xkVXVpZF07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlTmFtZTogZnVuY3Rpb24oaWQsIG5ld05hbWUpIHtcbiAgICAgICAgICAgICAgICBkYXRhW2lkXS5uYW1lID0gbmV3TmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVTaXplOiBmdW5jdGlvbihpZCwgbmV3U2l6ZSkge1xuICAgICAgICAgICAgICAgIGRhdGFbaWRdLnNpemUgPSBuZXdTaXplO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBhcmVudElkOiBmdW5jdGlvbih0YXJnZXRJZCwgcGFyZW50SWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhW3RhcmdldElkXS5wYXJlbnRJZCA9IHBhcmVudElkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldElkc0luUHJveHlHcm91cDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJveHlHcm91cElkID0gZGF0YVtpZF0ucHJveHlHcm91cElkO1xuICAgICAgICAgICAgICAgIGlmIChwcm94eUdyb3VwSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ5UHJveHlHcm91cElkW3Byb3h5R3JvdXBJZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJZHNJbkJhdGNoOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBiYXRjaElkID0gZGF0YVtpZF0uYmF0Y2hJZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnlCYXRjaElkW2JhdGNoSWRdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLnN0YXR1cyA9IHtcbiAgICAgICAgU1VCTUlUVElORzogXCJzdWJtaXR0aW5nXCIsXG4gICAgICAgIFNVQk1JVFRFRDogXCJzdWJtaXR0ZWRcIixcbiAgICAgICAgUkVKRUNURUQ6IFwicmVqZWN0ZWRcIixcbiAgICAgICAgUVVFVUVEOiBcInF1ZXVlZFwiLFxuICAgICAgICBDQU5DRUxFRDogXCJjYW5jZWxlZFwiLFxuICAgICAgICBQQVVTRUQ6IFwicGF1c2VkXCIsXG4gICAgICAgIFVQTE9BRElORzogXCJ1cGxvYWRpbmdcIixcbiAgICAgICAgVVBMT0FEX0ZJTkFMSVpJTkc6IFwidXBsb2FkIGZpbmFsaXppbmdcIixcbiAgICAgICAgVVBMT0FEX1JFVFJZSU5HOiBcInJldHJ5aW5nIHVwbG9hZFwiLFxuICAgICAgICBVUExPQURfU1VDQ0VTU0ZVTDogXCJ1cGxvYWQgc3VjY2Vzc2Z1bFwiLFxuICAgICAgICBVUExPQURfRkFJTEVEOiBcInVwbG9hZCBmYWlsZWRcIixcbiAgICAgICAgREVMRVRFX0ZBSUxFRDogXCJkZWxldGUgZmFpbGVkXCIsXG4gICAgICAgIERFTEVUSU5HOiBcImRlbGV0aW5nXCIsXG4gICAgICAgIERFTEVURUQ6IFwiZGVsZXRlZFwiXG4gICAgfTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS5iYXNlUHVibGljQXBpID0ge1xuICAgICAgICAgICAgYWRkQmxvYnM6IGZ1bmN0aW9uKGJsb2JEYXRhT3JBcnJheSwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZXMoYmxvYkRhdGFPckFycmF5LCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRJbml0aWFsRmlsZXM6IGZ1bmN0aW9uKGNhbm5lZEZpbGVMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goY2FubmVkRmlsZUxpc3QsIGZ1bmN0aW9uKGluZGV4LCBjYW5uZWRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2FkZENhbm5lZEZpbGUoY2FubmVkRmlsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWRkRmlsZXM6IGZ1bmN0aW9uKGRhdGEsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXliZUhhbmRsZUlvczhTYWZhcmlXb3JrYXJvdW5kKCk7XG4gICAgICAgICAgICAgICAgdmFyIGJhdGNoSWQgPSB0aGlzLl9zdG9yZWRJZHMubGVuZ3RoID09PSAwID8gcXEuZ2V0VW5pcXVlSWQoKSA6IHRoaXMuX2N1cnJlbnRCYXRjaElkLCBwcm9jZXNzQmxvYiA9IHFxLmJpbmQoZnVuY3Rpb24oYmxvYikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVOZXdGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLl9vcHRpb25zLmJsb2JzLmRlZmF1bHROYW1lXG4gICAgICAgICAgICAgICAgICAgIH0sIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBwcm9jZXNzQmxvYkRhdGEgPSBxcS5iaW5kKGZ1bmN0aW9uKGJsb2JEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU5ld0ZpbGUoYmxvYkRhdGEsIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBwcm9jZXNzQ2FudmFzID0gcXEuYmluZChmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBxcS5jYW52YXNUb0Jsb2IoY2FudmFzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTmV3RmlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fb3B0aW9ucy5ibG9icy5kZWZhdWx0TmFtZSArIFwiLnBuZ1wiXG4gICAgICAgICAgICAgICAgICAgIH0sIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBwcm9jZXNzQ2FudmFzRGF0YSA9IHFxLmJpbmQoZnVuY3Rpb24oY2FudmFzRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9ybWFsaXplZFF1YWxpdHkgPSBjYW52YXNEYXRhLnF1YWxpdHkgJiYgY2FudmFzRGF0YS5xdWFsaXR5IC8gMTAwLCBibG9iID0gcXEuY2FudmFzVG9CbG9iKGNhbnZhc0RhdGEuY2FudmFzLCBjYW52YXNEYXRhLnR5cGUsIG5vcm1hbGl6ZWRRdWFsaXR5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTmV3RmlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogY2FudmFzRGF0YS5uYW1lXG4gICAgICAgICAgICAgICAgICAgIH0sIGJhdGNoSWQsIHZlcmlmaWVkRmlsZXMpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBwcm9jZXNzRmlsZU9ySW5wdXQgPSBxcS5iaW5kKGZ1bmN0aW9uKGZpbGVPcklucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0lucHV0KGZpbGVPcklucHV0KSAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmaWxlT3JJbnB1dC5maWxlcyksIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChmaWxlcywgZnVuY3Rpb24oaWR4LCBmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlTmV3RmlsZShmaWxlLCBiYXRjaElkLCB2ZXJpZmllZEZpbGVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTmV3RmlsZShmaWxlT3JJbnB1dCwgYmF0Y2hJZCwgdmVyaWZpZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB0aGlzKSwgbm9ybWFsaXplRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlTGlzdChkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbXS5jb25jYXQoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSwgc2VsZiA9IHRoaXMsIHZlcmlmaWVkRmlsZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QmF0Y2hJZCA9IGJhdGNoSWQ7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGRhdGEsIGZ1bmN0aW9uKGlkeCwgZmlsZUNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZU9ySW5wdXQoZmlsZUNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRmlsZU9ySW5wdXQoZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHFxLmlzQmxvYihmaWxlQ29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NCbG9iKGZpbGVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxcS5pc09iamVjdChmaWxlQ29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlQ29udGFpbmVyLmJsb2IgJiYgZmlsZUNvbnRhaW5lci5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NCbG9iRGF0YShmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVDb250YWluZXIuY2FudmFzICYmIGZpbGVDb250YWluZXIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzQ2FudmFzRGF0YShmaWxlQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVDb250YWluZXIudGFnTmFtZSAmJiBmaWxlQ29udGFpbmVyLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJjYW52YXNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NDYW52YXMoZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGZpbGVDb250YWluZXIgKyBcIiBpcyBub3QgYSB2YWxpZCBmaWxlIGNvbnRhaW5lciEgIElnbm9yaW5nIVwiLCBcIndhcm5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlJlY2VpdmVkIFwiICsgdmVyaWZpZWRGaWxlcy5sZW5ndGggKyBcIiBmaWxlcy5cIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVJdGVtc0ZvclVwbG9hZCh2ZXJpZmllZEZpbGVzLCBwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhICYmIHVwbG9hZERhdGEuc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX0ZJTkFMSVpJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cocXEuZm9ybWF0KFwiSWdub3JpbmcgY2FuY2VsIGZvciBmaWxlIElEIHt9ICh7fSkuICBGaW5hbGl6aW5nIHVwbG9hZC5cIiwgaWQsIHRoaXMuZ2V0TmFtZShpZCkpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIuY2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmVkSWRzQ29weSA9IFtdLCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBxcS5leHRlbmQoc3RvcmVkSWRzQ29weSwgdGhpcy5fc3RvcmVkSWRzKTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHN0b3JlZElkc0NvcHksIGZ1bmN0aW9uKGlkeCwgc3RvcmVkRmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2FuY2VsKHN0b3JlZEZpbGVJZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5jYW5jZWxBbGwoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhclN0b3JlZEZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZWRJZHMgPSBbXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250aW51ZVVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YSA9IHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnBhdXNlIHx8ICF0aGlzLl9vcHRpb25zLmNodW5raW5nLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YS5zdGF0dXMgPT09IHFxLnN0YXR1cy5QQVVTRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cocXEuZm9ybWF0KFwiUGF1c2VkIGZpbGUgSUQge30gKHt9KSB3aWxsIGJlIGNvbnRpbnVlZC4gIE5vdCBwYXVzZWQuXCIsIGlkLCB0aGlzLmdldE5hbWUoaWQpKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZEZpbGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhxcS5mb3JtYXQoXCJJZ25vcmluZyBjb250aW51ZSBmb3IgZmlsZSBJRCB7fSAoe30pLiAgTm90IHBhdXNlZC5cIiwgaWQsIHRoaXMuZ2V0TmFtZShpZCkpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsZXRlRmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb25TdWJtaXREZWxldGUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRvZXNFeGlzdDogZnVuY3Rpb24oZmlsZU9yQmxvYklkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZXIuaXNWYWxpZChmaWxlT3JCbG9iSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRyYXdUaHVtYm5haWw6IGZ1bmN0aW9uKGZpbGVJZCwgaW1nT3JDYW52YXMsIG1heFNpemUsIGZyb21TZXJ2ZXIsIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2VUb1JldHVybiA9IG5ldyBxcS5Qcm9taXNlKCksIGZpbGVPclVybCwgb3B0aW9ucztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VHZW5lcmF0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU9yVXJsID0gdGhpcy5fdGh1bWJuYWlsVXJsc1tmaWxlSWRdO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4U2l6ZTogbWF4U2l6ZSA+IDAgPyBtYXhTaXplIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiBtYXhTaXplID4gMFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZyb21TZXJ2ZXIgJiYgcXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU9yVXJsID0gdGhpcy5nZXRGaWxlKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVPclVybCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlVG9SZXR1cm4uZmFpbHVyZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBpbWdPckNhbnZhcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogXCJGaWxlIG9yIFVSTCBub3QgZm91bmQuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUoZmlsZU9yVXJsLCBpbWdPckNhbnZhcywgb3B0aW9ucykudGhlbihmdW5jdGlvbiBzdWNjZXNzKG1vZGlmaWVkQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVRvUmV0dXJuLnN1Y2Nlc3MobW9kaWZpZWRDb250YWluZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZmFpbHVyZShjb250YWluZXIsIHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VUb1JldHVybi5mYWlsdXJlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBjb250YWluZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiByZWFzb24gfHwgXCJQcm9ibGVtIGdlbmVyYXRpbmcgdGh1bWJuYWlsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZVRvUmV0dXJuLmZhaWx1cmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBpbWdPckNhbnZhcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBcIk1pc3NpbmcgaW1hZ2UgZ2VuZXJhdG9yIG1vZHVsZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVRvUmV0dXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEJ1dHRvbjogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEJ1dHRvbih0aGlzLl9idXR0b25JZHNGb3JGaWxlSWRzW2ZpbGVJZF0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEVuZHBvaW50OiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kcG9pbnRTdG9yZS5nZXQoZmlsZUlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlOiBmdW5jdGlvbihmaWxlT3JCbG9iSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IHRoaXMuX2hhbmRsZXIuZ2V0RmlsZShmaWxlT3JCbG9iSWQpO1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhUmVjb3JkO1xuICAgICAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhUmVjb3JkID0gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsZU9yQmxvYklkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YVJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSA9IHVwbG9hZERhdGFSZWNvcmQuZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZSB8fCBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEluUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBbIHFxLnN0YXR1cy5VUExPQURJTkcsIHFxLnN0YXR1cy5VUExPQURfUkVUUllJTkcsIHFxLnN0YXR1cy5RVUVVRUQgXVxuICAgICAgICAgICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROYW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSkubmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQYXJlbnRJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YUVudHJ5ID0gdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSksIHBhcmVudElkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YUVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhRW50cnkucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQgPSB1cGxvYWREYXRhRW50cnkucGFyZW50SWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudElkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlc3VtYWJsZUZpbGVzRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZXIuZ2V0UmVzdW1hYmxlRmlsZXNEYXRhKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U2l6ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pLnNpemU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TmV0VXBsb2FkczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25ldFVwbG9hZGVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlbWFpbmluZ0FsbG93ZWRJdGVtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFsbG93ZWRJdGVtcyA9IHRoaXMuX2N1cnJlbnRJdGVtTGltaXQ7XG4gICAgICAgICAgICAgICAgaWYgKGFsbG93ZWRJdGVtcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93ZWRJdGVtcyAtIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFVwbG9hZHM6IGZ1bmN0aW9uKG9wdGlvbmFsRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUob3B0aW9uYWxGaWx0ZXIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFV1aWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KS51dWlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUmVzdW1hYmxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVyLmhhc1Jlc3VtZVJlY29yZChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZGVidWcgJiYgKCFsZXZlbCB8fCBsZXZlbCA9PT0gXCJpbmZvXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmxvZyhcIltGaW5lIFVwbG9hZGVyIFwiICsgcXEudmVyc2lvbiArIFwiXSBcIiArIHN0cik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsZXZlbCAmJiBsZXZlbCAhPT0gXCJpbmZvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEubG9nKFwiW0ZpbmUgVXBsb2FkZXIgXCIgKyBxcS52ZXJzaW9uICsgXCJdIFwiICsgc3RyLCBsZXZlbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlVXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMucGF1c2UgfHwgIXRoaXMuX29wdGlvbnMuY2h1bmtpbmcuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChxcS5pbmRleE9mKFsgcXEuc3RhdHVzLlVQTE9BRElORywgcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORyBdLCB1cGxvYWREYXRhLnN0YXR1cykgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFuZGxlci5wYXVzZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuUEFVU0VEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cocXEuZm9ybWF0KFwiVW5hYmxlIHRvIHBhdXNlIGZpbGUgSUQge30gKHt9KS5cIiwgaWQsIHRoaXMuZ2V0TmFtZShpZCkpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cocXEuZm9ybWF0KFwiSWdub3JpbmcgcGF1c2UgZm9yIGZpbGUgSUQge30gKHt9KS4gIE5vdCBpbiBwcm9ncmVzcy5cIiwgaWQsIHRoaXMuZ2V0TmFtZShpZCkpLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlRmlsZVJlZjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEucmVtb3ZlRmlsZVJlZihpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUmVzZXR0aW5nIHVwbG9hZGVyLi4uXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZWRJZHMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdXRvUmV0cmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3JldHJ5VGltZW91dHMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmV2ZW50UmV0cmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RodW1ibmFpbFVybHMgPSBbXTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRoaXMuX2J1dHRvbnMsIGZ1bmN0aW9uKGlkeCwgYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5yZXNldCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZW5kcG9pbnRTdG9yZS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uSWRzRm9yRmlsZUlkcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Bhc3RlSGFuZGxlciAmJiB0aGlzLl9wYXN0ZUhhbmRsZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLnNlc3Npb24ucmVmcmVzaE9uUmVzZXQgJiYgdGhpcy5fcmVmcmVzaFNlc3Npb25EYXRhKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3VjY2VlZGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsUHJvZ3Jlc3MgJiYgdGhpcy5fdG90YWxQcm9ncmVzcy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1c3RvbVJlc3VtZURhdGFTdG9yZS5yZXNldCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYW51YWxSZXRyeShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2NhbGVJbWFnZTogZnVuY3Rpb24oaWQsIHNwZWNzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiBxcS5TY2FsZXIucHJvdG90eXBlLnNjYWxlSW1hZ2UoaWQsIHNwZWNzLCB7XG4gICAgICAgICAgICAgICAgICAgIGxvZzogcXEuYmluZChzZWxmLmxvZywgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIGdldEZpbGU6IHFxLmJpbmQoc2VsZi5nZXRGaWxlLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YTogc2VsZi5fdXBsb2FkRGF0YVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEN1c3RvbUhlYWRlcnM6IGZ1bmN0aW9uKGhlYWRlcnMsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VzdG9tSGVhZGVyc1N0b3JlLnNldChoZWFkZXJzLCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Q3VzdG9tUmVzdW1lRGF0YTogZnVuY3Rpb24oaWQsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXN0b21SZXN1bWVEYXRhU3RvcmUuc2V0KGRhdGEsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXREZWxldGVGaWxlQ3VzdG9tSGVhZGVyczogZnVuY3Rpb24oaGVhZGVycywgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlQ3VzdG9tSGVhZGVyc1N0b3JlLnNldChoZWFkZXJzLCBpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0RGVsZXRlRmlsZUVuZHBvaW50OiBmdW5jdGlvbihlbmRwb2ludCwgaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlRW5kcG9pbnRTdG9yZS5zZXQoZW5kcG9pbnQsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXREZWxldGVGaWxlUGFyYW1zOiBmdW5jdGlvbihwYXJhbXMsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZVBhcmFtc1N0b3JlLnNldChwYXJhbXMsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRFbmRwb2ludDogZnVuY3Rpb24oZW5kcG9pbnQsIGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZW5kcG9pbnRTdG9yZS5zZXQoZW5kcG9pbnQsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRGb3JtOiBmdW5jdGlvbihlbGVtZW50T3JJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUZvcm1TdXBwb3J0QW5kUGFyYW1zKGVsZW1lbnRPcklkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRJdGVtTGltaXQ6IGZ1bmN0aW9uKG5ld0l0ZW1MaW1pdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJdGVtTGltaXQgPSBuZXdJdGVtTGltaXQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0TmFtZTogZnVuY3Rpb24oaWQsIG5ld05hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnVwZGF0ZU5hbWUoaWQsIG5ld05hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBhcmFtczogZnVuY3Rpb24ocGFyYW1zLCBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlLnNldChwYXJhbXMsIGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRVdWlkOiBmdW5jdGlvbihpZCwgbmV3VXVpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLnV1aWRDaGFuZ2VkKGlkLCBuZXdVdWlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uKGlkLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVJlY29yZCA9IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghZmlsZVJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoaWQgKyBcIiBpcyBub3QgYSB2YWxpZCBmaWxlIElELlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3dpdGNoIChuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgcXEuc3RhdHVzLkRFTEVURUQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRGVsZXRlQ29tcGxldGUoaWQsIG51bGwsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgcXEuc3RhdHVzLkRFTEVURV9GQUlMRUQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uRGVsZXRlQ29tcGxldGUoaWQsIG51bGwsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IFwiTWV0aG9kIHNldFN0YXR1cyBjYWxsZWQgb24gJ1wiICsgbmFtZSArIFwiJyBub3QgaW1wbGVtZW50ZWQgeWV0IGZvciBcIiArIG5ld1N0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZFN0b3JlZEZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RvcmVkSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJub0ZpbGVzRXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkU3RvcmVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmJhc2VQcml2YXRlQXBpID0ge1xuICAgICAgICAgICAgX2FkZENhbm5lZEZpbGU6IGZ1bmN0aW9uKHNlc3Npb25EYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91cGxvYWREYXRhLmFkZEZpbGUoe1xuICAgICAgICAgICAgICAgICAgICB1dWlkOiBzZXNzaW9uRGF0YS51dWlkLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uRGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBzZXNzaW9uRGF0YS5zaXplLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHFxLnN0YXR1cy5VUExPQURfU1VDQ0VTU0ZVTCxcbiAgICAgICAgICAgICAgICAgICAgb25CZWZvcmVTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uRGF0YS5kZWxldGVGaWxlRW5kcG9pbnQgJiYgc2VsZi5zZXREZWxldGVGaWxlRW5kcG9pbnQoc2Vzc2lvbkRhdGEuZGVsZXRlRmlsZUVuZHBvaW50LCBpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uRGF0YS5kZWxldGVGaWxlUGFyYW1zICYmIHNlbGYuc2V0RGVsZXRlRmlsZVBhcmFtcyhzZXNzaW9uRGF0YS5kZWxldGVGaWxlUGFyYW1zLCBpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbkRhdGEudGh1bWJuYWlsVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdGh1bWJuYWlsVXJsc1tpZF0gPSBzZXNzaW9uRGF0YS50aHVtYm5haWxVcmw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9uZXRVcGxvYWRlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmV0VXBsb2FkZWRPclF1ZXVlZCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2Fubm90YXRlV2l0aEJ1dHRvbklkOiBmdW5jdGlvbihmaWxlLCBhc3NvY2lhdGVkSW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGUucXFCdXR0b25JZCA9IHRoaXMuX2dldEJ1dHRvbklkKGFzc29jaWF0ZWRJbnB1dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iYXRjaEVycm9yOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihudWxsLCBudWxsLCBtZXNzYWdlLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVEZWxldGVIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5EZWxldGVGaWxlQWpheFJlcXVlc3Rlcih7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogdGhpcy5fb3B0aW9ucy5kZWxldGVGaWxlLm1ldGhvZC50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICBtYXhDb25uZWN0aW9uczogdGhpcy5fb3B0aW9ucy5tYXhDb25uZWN0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgdXVpZFBhcmFtTmFtZTogdGhpcy5fb3B0aW9ucy5yZXF1ZXN0LnV1aWROYW1lLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB0aGlzLl9kZWxldGVGaWxlQ3VzdG9tSGVhZGVyc1N0b3JlLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNTdG9yZTogdGhpcy5fZGVsZXRlRmlsZVBhcmFtc1N0b3JlLFxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludFN0b3JlOiB0aGlzLl9kZWxldGVGaWxlRW5kcG9pbnRTdG9yZSxcbiAgICAgICAgICAgICAgICAgICAgY29yczogdGhpcy5fb3B0aW9ucy5jb3JzLFxuICAgICAgICAgICAgICAgICAgICBsb2c6IHFxLmJpbmQoc2VsZi5sb2csIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRGVsZXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uRGVsZXRlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25EZWxldGVDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbkRlbGV0ZUNvbXBsZXRlKGlkLCB4aHJPclhkciwgaXNFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkRlbGV0ZUNvbXBsZXRlKGlkLCB4aHJPclhkciwgaXNFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlUGFzdGVIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5QYXN0ZVN1cHBvcnQoe1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50OiB0aGlzLl9vcHRpb25zLnBhc3RlLnRhcmdldEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nOiBxcS5iaW5kKHNlbGYubG9nLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3RlUmVjZWl2ZWQ6IGZ1bmN0aW9uKGJsb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uUGFzdGVSZWNlaXZlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZChzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblBhc3RlUmVjZWl2ZWQsIHNlbGYsIGJsb2IpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IHFxLmJpbmQoc2VsZi5faGFuZGxlUGFzdGVTdWNjZXNzLCBzZWxmLCBibG9iKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogXCJwYXN0ZWQgaW1hZ2VcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NyZWF0ZVN0b3JlOiBmdW5jdGlvbihpbml0aWFsVmFsdWUsIF9yZWFkT25seVZhbHVlc18pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB7fSwgY2F0Y2hhbGwgPSBpbml0aWFsVmFsdWUsIHBlcklkUmVhZE9ubHlWYWx1ZXMgPSB7fSwgcmVhZE9ubHlWYWx1ZXMgPSBfcmVhZE9ubHlWYWx1ZXNfLCBjb3B5ID0gZnVuY3Rpb24ob3JpZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNPYmplY3Qob3JpZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBxcS5leHRlbmQoe30sIG9yaWcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnO1xuICAgICAgICAgICAgICAgIH0sIGdldFJlYWRPbmx5VmFsdWVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc0Z1bmN0aW9uKHJlYWRPbmx5VmFsdWVzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRPbmx5VmFsdWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRPbmx5VmFsdWVzO1xuICAgICAgICAgICAgICAgIH0sIGluY2x1ZGVSZWFkT25seVZhbHVlcyA9IGZ1bmN0aW9uKGlkLCBleGlzdGluZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVhZE9ubHlWYWx1ZXMgJiYgcXEuaXNPYmplY3QoZXhpc3RpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5leHRlbmQoZXhpc3RpbmcsIGdldFJlYWRPbmx5VmFsdWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJJZFJlYWRPbmx5VmFsdWVzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGV4aXN0aW5nLCBwZXJJZFJlYWRPbmx5VmFsdWVzW2lkXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24odmFsLCBpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoYWxsID0gY29weSh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZVtpZF0gPSBjb3B5KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCAmJiBzdG9yZVtpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBzdG9yZVtpZF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IGNvcHkoY2F0Y2hhbGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVJlYWRPbmx5VmFsdWVzKGlkLCB2YWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvcHkodmFsdWVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWRkUmVhZE9ubHk6IGZ1bmN0aW9uKGlkLCB2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc09iamVjdChzdG9yZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRnVuY3Rpb24odmFsdWVzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE9ubHlWYWx1ZXMgPSB2YWx1ZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkT25seVZhbHVlcyA9IHJlYWRPbmx5VmFsdWVzIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHJlYWRPbmx5VmFsdWVzLCB2YWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVySWRSZWFkT25seVZhbHVlc1tpZF0gPSBwZXJJZFJlYWRPbmx5VmFsdWVzW2lkXSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHBlcklkUmVhZE9ubHlWYWx1ZXNbaWRdLCB2YWx1ZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGUgc3RvcmVbZmlsZUlkXTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcklkUmVhZE9ubHlWYWx1ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoYWxsID0gaW5pdGlhbFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlVXBsb2FkRGF0YVRyYWNrZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlVwbG9hZERhdGEoe1xuICAgICAgICAgICAgICAgICAgICBnZXROYW1lOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldFV1aWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRVdWlkKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2l6ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldFNpemUoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblN0YXR1c0NoYW5nZTogZnVuY3Rpb24oaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblVwbG9hZFN0YXR1c0NoYW5nZShpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25TdGF0dXNDaGFuZ2UoaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX21heWJlQWxsQ29tcGxldGUoaWQsIG5ld1N0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5fdG90YWxQcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3RvdGFsUHJvZ3Jlc3Mub25TdGF0dXNDaGFuZ2UoaWQsIG9sZFN0YXR1cywgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVVcGxvYWRCdXR0b246IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGFjY2VwdEZpbGVzID0gc3BlYy5hY2NlcHQgfHwgdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uLmFjY2VwdEZpbGVzLCBhbGxvd2VkRXh0ZW5zaW9ucyA9IHNwZWMuYWxsb3dlZEV4dGVuc2lvbnMgfHwgdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uLmFsbG93ZWRFeHRlbnNpb25zLCBidXR0b247XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gYWxsb3dNdWx0aXBsZSgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLl9vcHRpb25zLndvcmthcm91bmRzLmlvc0VtcHR5VmlkZW9zICYmIHFxLmlvcygpICYmICFxcS5pb3M2KCkgJiYgc2VsZi5faXNBbGxvd2VkRXh0ZW5zaW9uKGFsbG93ZWRFeHRlbnNpb25zLCBcIi5tb3ZcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3BlYy5tdWx0aXBsZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29wdGlvbnMubXVsdGlwbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3BlYy5tdWx0aXBsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ1dHRvbiA9IG5ldyBxcS5VcGxvYWRCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICBhY2NlcHRGaWxlczogYWNjZXB0RmlsZXMsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHNwZWMuZWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgZm9jdXNDbGFzczogdGhpcy5fb3B0aW9ucy5jbGFzc2VzLmJ1dHRvbkZvY3VzLFxuICAgICAgICAgICAgICAgICAgICBmb2xkZXJzOiBzcGVjLmZvbGRlcnMsXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyQ2xhc3M6IHRoaXMuX29wdGlvbnMuY2xhc3Nlcy5idXR0b25Ib3ZlcixcbiAgICAgICAgICAgICAgICAgICAgaW9zOEJyb3dzZXJDcmFzaFdvcmthcm91bmQ6IHRoaXMuX29wdGlvbnMud29ya2Fyb3VuZHMuaW9zOEJyb3dzZXJDcmFzaCxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IGFsbG93TXVsdGlwbGUoKSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fb3B0aW9ucy5yZXF1ZXN0LmlucHV0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vbklucHV0Q2hhbmdlKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHNwZWMudGl0bGUgPT0gbnVsbCA/IHRoaXMuX29wdGlvbnMudGV4dC5maWxlSW5wdXRUaXRsZSA6IHNwZWMudGl0bGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NlU3VwcG9ydC5hZGREaXNwb3NlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZWxmLl9idXR0b25zLnB1c2goYnV0dG9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVVcGxvYWRIYW5kbGVyOiBmdW5jdGlvbihhZGRpdGlvbmFsT3B0aW9ucywgbmFtZXNwYWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBsYXN0T25Qcm9ncmVzcyA9IHt9LCBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1ZzogdGhpcy5fb3B0aW9ucy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IHRoaXMuX29wdGlvbnMubWF4Q29ubmVjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIGNvcnM6IHRoaXMuX29wdGlvbnMuY29ycyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHRoaXMuX3BhcmFtc1N0b3JlLFxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludFN0b3JlOiB0aGlzLl9lbmRwb2ludFN0b3JlLFxuICAgICAgICAgICAgICAgICAgICBjaHVua2luZzogdGhpcy5fb3B0aW9ucy5jaHVua2luZyxcbiAgICAgICAgICAgICAgICAgICAgcmVzdW1lOiB0aGlzLl9vcHRpb25zLnJlc3VtZSxcbiAgICAgICAgICAgICAgICAgICAgYmxvYnM6IHRoaXMuX29wdGlvbnMuYmxvYnMsXG4gICAgICAgICAgICAgICAgICAgIGxvZzogcXEuYmluZChzZWxmLmxvZywgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIHByZXZlbnRSZXRyeVBhcmFtOiB0aGlzLl9vcHRpb25zLnJldHJ5LnByZXZlbnRSZXRyeVJlc3BvbnNlUHJvcGVydHksXG4gICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVkIDwgMCB8fCB0b3RhbCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdE9uUHJvZ3Jlc3NbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RPblByb2dyZXNzW2lkXS5sb2FkZWQgIT09IGxvYWRlZCB8fCBsYXN0T25Qcm9ncmVzc1tpZF0udG90YWwgIT09IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uUHJvZ3Jlc3MoaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblByb2dyZXNzKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uUHJvZ3Jlc3MoaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uUHJvZ3Jlc3MoaWQsIG5hbWUsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE9uUHJvZ3Jlc3NbaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogbG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIG5hbWUsIHJlc3VsdCwgeGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbGFzdE9uUHJvZ3Jlc3NbaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5zdGF0dXMsIHJldFZhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfU1VDQ0VTU0ZVTCB8fCBzdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURfRkFJTEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gc2VsZi5fb25Db21wbGV0ZShpZCwgbmFtZSwgcmVzdWx0LCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCBpbnN0YW5jZW9mIHFxLlByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25Db21wbGV0ZShpZCwgbmFtZSwgcmVzdWx0LCB4aHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkNvbXBsZXRlKGlkLCBuYW1lLCByZXN1bHQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbihpZCwgbmFtZSwgY2FuY2VsRmluYWxpemF0aW9uRWZmb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwib25DYW5jZWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZChzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkNhbmNlbCwgc2VsZiwgaWQsIG5hbWUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogcHJvbWlzZS5mYWlsdXJlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEZpbmFsaXphdGlvbkVmZm9ydC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25DYW5jZWwoaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRQcmVwOiBxcS5iaW5kKHRoaXMuX29uVXBsb2FkUHJlcCwgdGhpcyksXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25VcGxvYWQoaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9uVXBsb2FkUmVzdWx0ID0gc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25VcGxvYWQoaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzR2VuZXJpY1Byb21pc2Uob25VcGxvYWRSZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cocXEuZm9ybWF0KFwib25VcGxvYWQgZm9yIHt9IHJldHVybmVkIGEgUHJvbWlzZSAtIHdhaXRpbmcgZm9yIHJlc29sdXRpb24uXCIsIGlkKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uVXBsb2FkUmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5Qcm9taXNlKCkuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZENodW5rOiBmdW5jdGlvbihpZCwgbmFtZSwgY2h1bmtEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vblVwbG9hZENodW5rKGlkLCBjaHVua0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9uVXBsb2FkQ2h1bmtSZXN1bHQgPSBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblVwbG9hZENodW5rKGlkLCBuYW1lLCBjaHVua0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzR2VuZXJpY1Byb21pc2Uob25VcGxvYWRDaHVua1Jlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhxcS5mb3JtYXQoXCJvblVwbG9hZENodW5rIGZvciB7fS57fSByZXR1cm5lZCBhIFByb21pc2UgLSB3YWl0aW5nIGZvciByZXNvbHV0aW9uLlwiLCBpZCwgY2h1bmtEYXRhLnBhcnRJbmRleCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvblVwbG9hZENodW5rUmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5Qcm9taXNlKCkuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZENodW5rU3VjY2VzczogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSwgcmVzdWx0LCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uVXBsb2FkQ2h1bmtTdWNjZXNzKGlkLCBjaHVua0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25VcGxvYWRDaHVua1N1Y2Nlc3MuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25SZXN1bWU6IGZ1bmN0aW9uKGlkLCBuYW1lLCBjaHVua0RhdGEsIGN1c3RvbVJlc3VtZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblJlc3VtZShpZCwgbmFtZSwgY2h1bmtEYXRhLCBjdXN0b21SZXN1bWVEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25BdXRvUmV0cnk6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXNwb25zZUpTT04sIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29uQXV0b1JldHJ5LmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uVXVpZENoYW5nZWQ6IGZ1bmN0aW9uKGlkLCBuZXdVdWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhcIlNlcnZlciByZXF1ZXN0ZWQgVVVJRCBjaGFuZ2UgZnJvbSAnXCIgKyBzZWxmLmdldFV1aWQoaWQpICsgXCInIHRvICdcIiArIG5ld1V1aWQgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldFV1aWQoaWQsIG5ld1V1aWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXROYW1lOiBxcS5iaW5kKHNlbGYuZ2V0TmFtZSwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIGdldFV1aWQ6IHFxLmJpbmQoc2VsZi5nZXRVdWlkLCBzZWxmKSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2l6ZTogcXEuYmluZChzZWxmLmdldFNpemUsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBzZXRTaXplOiBxcS5iaW5kKHNlbGYuX3NldFNpemUsIHNlbGYpLFxuICAgICAgICAgICAgICAgICAgICBnZXREYXRhQnlVdWlkOiBmdW5jdGlvbih1dWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiB1dWlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaXNRdWV1ZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09IHFxLnN0YXR1cy5RVUVVRUQgfHwgc3RhdHVzID09PSBxcS5zdGF0dXMuU1VCTUlUVEVEIHx8IHN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORyB8fCBzdGF0dXMgPT09IHFxLnN0YXR1cy5QQVVTRUQ7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldElkc0luUHJveHlHcm91cDogc2VsZi5fdXBsb2FkRGF0YS5nZXRJZHNJblByb3h5R3JvdXAsXG4gICAgICAgICAgICAgICAgICAgIGdldElkc0luQmF0Y2g6IHNlbGYuX3VwbG9hZERhdGEuZ2V0SWRzSW5CYXRjaCxcbiAgICAgICAgICAgICAgICAgICAgaXNJblByb2dyZXNzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5zdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURJTkc7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldEN1c3RvbVJlc3VtZURhdGE6IHFxLmJpbmQoc2VsZi5fZ2V0Q3VzdG9tUmVzdW1lRGF0YSwgc2VsZiksXG4gICAgICAgICAgICAgICAgICAgIHNldFN0YXR1czogZnVuY3Rpb24oaWQsIHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHFxLmVhY2godGhpcy5fb3B0aW9ucy5yZXF1ZXN0LCBmdW5jdGlvbihwcm9wLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1twcm9wXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmN1c3RvbUhlYWRlcnMgPSB0aGlzLl9jdXN0b21IZWFkZXJzU3RvcmU7XG4gICAgICAgICAgICAgICAgaWYgKGFkZGl0aW9uYWxPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goYWRkaXRpb25hbE9wdGlvbnMsIGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW2tleV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlVwbG9hZEhhbmRsZXJDb250cm9sbGVyKG9wdGlvbnMsIG5hbWVzcGFjZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2ZpbGVPckJsb2JSZWplY3RlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkLS07XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5SRUpFQ1RFRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2Zvcm1hdFNpemU6IGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGJ5dGVzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBieXRlcyArIHRoaXMuX29wdGlvbnMudGV4dC5zaXplU3ltYm9sc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAtMTtcbiAgICAgICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgICAgIGJ5dGVzID0gYnl0ZXMgLyAxZTM7XG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB9IHdoaWxlIChieXRlcyA+IDk5OSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGJ5dGVzLCAuMSkudG9GaXhlZCgxKSArIHRoaXMuX29wdGlvbnMudGV4dC5zaXplU3ltYm9sc1tpXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2VuZXJhdGVFeHRyYUJ1dHRvblNwZWNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5fZXh0cmFCdXR0b25TcGVjcyA9IHt9O1xuICAgICAgICAgICAgICAgIHFxLmVhY2godGhpcy5fb3B0aW9ucy5leHRyYUJ1dHRvbnMsIGZ1bmN0aW9uKGlkeCwgZXh0cmFCdXR0b25PcHRpb25FbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXVsdGlwbGUgPSBleHRyYUJ1dHRvbk9wdGlvbkVudHJ5Lm11bHRpcGxlLCB2YWxpZGF0aW9uID0gcXEuZXh0ZW5kKHt9LCBzZWxmLl9vcHRpb25zLnZhbGlkYXRpb24sIHRydWUpLCBleHRyYUJ1dHRvblNwZWMgPSBxcS5leHRlbmQoe30sIGV4dHJhQnV0dG9uT3B0aW9uRW50cnkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobXVsdGlwbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGUgPSBzZWxmLl9vcHRpb25zLm11bHRpcGxlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHRyYUJ1dHRvblNwZWMudmFsaWRhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHZhbGlkYXRpb24sIGV4dHJhQnV0dG9uT3B0aW9uRW50cnkudmFsaWRhdGlvbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcXEuZXh0ZW5kKGV4dHJhQnV0dG9uU3BlYywge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IG11bHRpcGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbjogdmFsaWRhdGlvblxuICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5faW5pdEV4dHJhQnV0dG9uKGV4dHJhQnV0dG9uU3BlYyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldEJ1dHRvbjogZnVuY3Rpb24oYnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXh0cmFCdXR0b25zU3BlYyA9IHRoaXMuX2V4dHJhQnV0dG9uU3BlY3NbYnV0dG9uSWRdO1xuICAgICAgICAgICAgICAgIGlmIChleHRyYUJ1dHRvbnNTcGVjKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHRyYUJ1dHRvbnNTcGVjLmVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChidXR0b25JZCA9PT0gdGhpcy5fZGVmYXVsdEJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zLmJ1dHRvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldEJ1dHRvbklkOiBmdW5jdGlvbihidXR0b25PckZpbGVJbnB1dE9yRmlsZSkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dHMsIGZpbGVJbnB1dCwgZmlsZUJsb2JPcklucHV0ID0gYnV0dG9uT3JGaWxlSW5wdXRPckZpbGU7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVCbG9iT3JJbnB1dCBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQmxvYk9ySW5wdXQgPSBmaWxlQmxvYk9ySW5wdXQucmVmZXJlbmNlQmxvYjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVCbG9iT3JJbnB1dCAmJiAhcXEuaXNCbG9iKGZpbGVCbG9iT3JJbnB1dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZShmaWxlQmxvYk9ySW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZUJsb2JPcklucHV0LnFxQnV0dG9uSWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZUJsb2JPcklucHV0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiICYmIGZpbGVCbG9iT3JJbnB1dC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZUJsb2JPcklucHV0LmdldEF0dHJpYnV0ZShxcS5VcGxvYWRCdXR0b24uQlVUVE9OX0lEX0FUVFJfTkFNRSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW5wdXRzID0gZmlsZUJsb2JPcklucHV0LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goaW5wdXRzLCBmdW5jdGlvbihpZHgsIGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuZ2V0QXR0cmlidXRlKFwidHlwZVwiKSA9PT0gXCJmaWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXQgPSBpbnB1dDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZUlucHV0LmdldEF0dHJpYnV0ZShxcS5VcGxvYWRCdXR0b24uQlVUVE9OX0lEX0FUVFJfTkFNRSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldEN1c3RvbVJlc3VtZURhdGE6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXN0b21SZXN1bWVEYXRhU3RvcmUuZ2V0KGZpbGVJZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldE5vdEZpbmlzaGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogWyBxcS5zdGF0dXMuVVBMT0FESU5HLCBxcS5zdGF0dXMuVVBMT0FEX1JFVFJZSU5HLCBxcS5zdGF0dXMuUVVFVUVELCBxcS5zdGF0dXMuU1VCTUlUVElORywgcXEuc3RhdHVzLlNVQk1JVFRFRCwgcXEuc3RhdHVzLlBBVVNFRCBdXG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRWYWxpZGF0aW9uQmFzZTogZnVuY3Rpb24oYnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXh0cmFCdXR0b25TcGVjID0gdGhpcy5fZXh0cmFCdXR0b25TcGVjc1tidXR0b25JZF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4dHJhQnV0dG9uU3BlYyA/IGV4dHJhQnV0dG9uU3BlYy52YWxpZGF0aW9uIDogdGhpcy5fb3B0aW9ucy52YWxpZGF0aW9uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcjogZnVuY3Rpb24oZmlsZVdyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVdyYXBwZXIuZmlsZSBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcXEuZ2V0RmlsZW5hbWUoZmlsZVdyYXBwZXIuZmlsZS5yZWZlcmVuY2VCbG9iKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGVXcmFwcGVyLmZpbGUucmVmZXJlbmNlQmxvYi5zaXplXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZmlsZVdyYXBwZXIuaWRcbiAgICAgICAgICAgICAgICAgICAgfSkubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWxlV3JhcHBlci5pZFxuICAgICAgICAgICAgICAgICAgICB9KS5zaXplXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0VmFsaWRhdGlvbkRlc2NyaXB0b3JzOiBmdW5jdGlvbihmaWxlV3JhcHBlcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGZpbGVEZXNjcmlwdG9ycyA9IFtdO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goZmlsZVdyYXBwZXJzLCBmdW5jdGlvbihpZHgsIGZpbGVXcmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVEZXNjcmlwdG9ycy5wdXNoKHNlbGYuX2dldFZhbGlkYXRpb25EZXNjcmlwdG9yKGZpbGVXcmFwcGVyKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVEZXNjcmlwdG9ycztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlQ2FtZXJhQWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5jYW1lcmEuaW9zICYmIHFxLmlvcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY2NlcHRJb3NDYW1lcmEgPSBcImltYWdlLyo7Y2FwdHVyZT1jYW1lcmFcIiwgYnV0dG9uID0gdGhpcy5fb3B0aW9ucy5jYW1lcmEuYnV0dG9uLCBidXR0b25JZCA9IGJ1dHRvbiA/IHRoaXMuX2dldEJ1dHRvbklkKGJ1dHRvbikgOiB0aGlzLl9kZWZhdWx0QnV0dG9uSWQsIG9wdGlvblJvb3QgPSB0aGlzLl9vcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uSWQgJiYgYnV0dG9uSWQgIT09IHRoaXMuX2RlZmF1bHRCdXR0b25JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uUm9vdCA9IHRoaXMuX2V4dHJhQnV0dG9uU3BlY3NbYnV0dG9uSWRdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvblJvb3QubXVsdGlwbGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvblJvb3QudmFsaWRhdGlvbi5hY2NlcHRGaWxlcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uUm9vdC52YWxpZGF0aW9uLmFjY2VwdEZpbGVzID0gYWNjZXB0SW9zQ2FtZXJhO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uUm9vdC52YWxpZGF0aW9uLmFjY2VwdEZpbGVzICs9IFwiLFwiICsgYWNjZXB0SW9zQ2FtZXJhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2godGhpcy5fYnV0dG9ucywgZnVuY3Rpb24oaWR4LCBidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXR0b24uZ2V0QnV0dG9uSWQoKSA9PT0gYnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0TXVsdGlwbGUob3B0aW9uUm9vdC5tdWx0aXBsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldEFjY2VwdEZpbGVzKG9wdGlvblJvb3QuYWNjZXB0RmlsZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVDaGVja2VkQ2FsbGJhY2s6IGZ1bmN0aW9uKGRldGFpbHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIGNhbGxiYWNrUmV0VmFsID0gZGV0YWlscy5jYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0dlbmVyaWNQcm9taXNlKGNhbGxiYWNrUmV0VmFsKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiAtIHdhaXRpbmcgZm9yIFwiICsgZGV0YWlscy5uYW1lICsgXCIgcHJvbWlzZSB0byBiZSBmdWxmaWxsZWQgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrUmV0VmFsLnRoZW4oZnVuY3Rpb24oc3VjY2Vzc1BhcmFtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhkZXRhaWxzLm5hbWUgKyBcIiBwcm9taXNlIHN1Y2Nlc3MgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHMub25TdWNjZXNzKHN1Y2Nlc3NQYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldGFpbHMub25GYWlsdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coZGV0YWlscy5uYW1lICsgXCIgcHJvbWlzZSBmYWlsdXJlIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5vbkZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coZGV0YWlscy5uYW1lICsgXCIgcHJvbWlzZSBmYWlsdXJlIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tSZXRWYWwgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFpbHMub25TdWNjZXNzKGNhbGxiYWNrUmV0VmFsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlscy5vbkZhaWx1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKGRldGFpbHMubmFtZSArIFwiIC0gcmV0dXJuIHZhbHVlIHdhcyAnZmFsc2UnIGZvciBcIiArIGRldGFpbHMuaWRlbnRpZmllciArIFwiLiAgSW52b2tpbmcgZmFpbHVyZSBjYWxsYmFjay5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzLm9uRmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coZGV0YWlscy5uYW1lICsgXCIgLSByZXR1cm4gdmFsdWUgd2FzICdmYWxzZScgZm9yIFwiICsgZGV0YWlscy5pZGVudGlmaWVyICsgXCIuICBXaWxsIG5vdCBwcm9jZWVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2tSZXRWYWw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZU5ld0ZpbGU6IGZ1bmN0aW9uKGZpbGUsIGJhdGNoSWQsIG5ld0ZpbGVXcmFwcGVyTGlzdCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgdXVpZCA9IHFxLmdldFVuaXF1ZUlkKCksIHNpemUgPSAtMSwgbmFtZSA9IHFxLmdldEZpbGVuYW1lKGZpbGUpLCBhY3R1YWxGaWxlID0gZmlsZS5ibG9iIHx8IGZpbGUsIGhhbmRsZXIgPSB0aGlzLl9jdXN0b21OZXdGaWxlSGFuZGxlciA/IHRoaXMuX2N1c3RvbU5ld0ZpbGVIYW5kbGVyIDogcXEuYmluZChzZWxmLl9oYW5kbGVOZXdGaWxlR2VuZXJpYywgc2VsZik7XG4gICAgICAgICAgICAgICAgaWYgKCFxcS5pc0lucHV0KGFjdHVhbEZpbGUpICYmIGFjdHVhbEZpbGUuc2l6ZSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSBhY3R1YWxGaWxlLnNpemU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGhhbmRsZXIoYWN0dWFsRmlsZSwgbmFtZSwgdXVpZCwgc2l6ZSwgbmV3RmlsZVdyYXBwZXJMaXN0LCBiYXRjaElkLCB0aGlzLl9vcHRpb25zLnJlcXVlc3QudXVpZE5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkRGF0YTogc2VsZi5fdXBsb2FkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zU3RvcmU6IHNlbGYuX3BhcmFtc1N0b3JlLFxuICAgICAgICAgICAgICAgICAgICBhZGRGaWxlVG9IYW5kbGVyOiBmdW5jdGlvbihpZCwgZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faGFuZGxlci5hZGQoaWQsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmV0VXBsb2FkZWRPclF1ZXVlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdHJhY2tCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZU5ld0ZpbGVHZW5lcmljOiBmdW5jdGlvbihmaWxlLCBuYW1lLCB1dWlkLCBzaXplLCBmaWxlTGlzdCwgYmF0Y2hJZCkge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuX3VwbG9hZERhdGEuYWRkRmlsZSh7XG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IHV1aWQsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemUsXG4gICAgICAgICAgICAgICAgICAgIGJhdGNoSWQ6IGJhdGNoSWQsXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmFkZChpZCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhY2tCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQrKztcbiAgICAgICAgICAgICAgICBmaWxlTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBmaWxlOiBmaWxlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hhbmRsZVBhc3RlU3VjY2VzczogZnVuY3Rpb24oYmxvYiwgZXh0U3VwcGxpZWROYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4dGVuc2lvbiA9IGJsb2IudHlwZS5zcGxpdChcIi9cIilbMV0sIG5hbWUgPSBleHRTdXBwbGllZE5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBuYW1lID0gdGhpcy5fb3B0aW9ucy5wYXN0ZS5kZWZhdWx0TmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmFtZSArPSBcIi5cIiArIGV4dGVuc2lvbjtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGVzKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYmxvYjogYmxvYlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oYW5kbGVEZWxldGVTdWNjZXNzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgICAgICB9KS5zdGF0dXMgIT09IHFxLnN0YXR1cy5ERUxFVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZC0tO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZC0tO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLkRFTEVURUQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIkRlbGV0ZSByZXF1ZXN0IGZvciAnXCIgKyBuYW1lICsgXCInIGhhcyBzdWNjZWVkZWQuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGFuZGxlRGVsZXRlRmFpbGVkOiBmdW5jdGlvbihpZCwgeGhyT3JYZHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5ERUxFVEVfRkFJTEVEKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIkRlbGV0ZSByZXF1ZXN0IGZvciAnXCIgKyBuYW1lICsgXCInIGhhcyBmYWlsZWQuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgaWYgKCF4aHJPclhkciB8fCB4aHJPclhkci53aXRoQ3JlZGVudGlhbHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKGlkLCBuYW1lLCBcIkRlbGV0ZSByZXF1ZXN0IGZhaWxlZFwiLCB4aHJPclhkcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihpZCwgbmFtZSwgXCJEZWxldGUgcmVxdWVzdCBmYWlsZWQgd2l0aCByZXNwb25zZSBjb2RlIFwiICsgeGhyT3JYZHIuc3RhdHVzLCB4aHJPclhkcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0RXh0cmFCdXR0b246IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gdGhpcy5fY3JlYXRlVXBsb2FkQnV0dG9uKHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXB0OiBzcGVjLnZhbGlkYXRpb24uYWNjZXB0RmlsZXMsXG4gICAgICAgICAgICAgICAgICAgIGFsbG93ZWRFeHRlbnNpb25zOiBzcGVjLnZhbGlkYXRpb24uYWxsb3dlZEV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHNwZWMuZWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgZm9sZGVyczogc3BlYy5mb2xkZXJzLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogc3BlYy5tdWx0aXBsZSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHNwZWMuZmlsZUlucHV0VGl0bGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9leHRyYUJ1dHRvblNwZWNzW2J1dHRvbi5nZXRCdXR0b25JZCgpXSA9IHNwZWM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRGb3JtU3VwcG9ydEFuZFBhcmFtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9ybVN1cHBvcnQgPSBxcS5Gb3JtU3VwcG9ydCAmJiBuZXcgcXEuRm9ybVN1cHBvcnQodGhpcy5fb3B0aW9ucy5mb3JtLCBxcS5iaW5kKHRoaXMudXBsb2FkU3RvcmVkRmlsZXMsIHRoaXMpLCBxcS5iaW5kKHRoaXMubG9nLCB0aGlzKSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Zvcm1TdXBwb3J0ICYmIHRoaXMuX2Zvcm1TdXBwb3J0LmF0dGFjaGVkVG9Gb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5yZXF1ZXN0LnBhcmFtcywgdGhpcy5fZm9ybVN1cHBvcnQuZ2V0Rm9ybUlucHV0c0FzT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5hdXRvVXBsb2FkID0gdGhpcy5fZm9ybVN1cHBvcnQubmV3QXV0b1VwbG9hZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0VuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLnJlcXVlc3QuZW5kcG9pbnQgPSB0aGlzLl9mb3JtU3VwcG9ydC5uZXdFbmRwb2ludDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtc1N0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5yZXF1ZXN0LnBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pc0RlbGV0ZVBvc3NpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXFxLkRlbGV0ZUZpbGVBamF4UmVxdWVzdGVyIHx8ICF0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmNvcnMuZXhwZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLnN1cHBvcnRlZEZlYXR1cmVzLmRlbGV0ZUZpbGVDb3JzWGhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuZGVsZXRlRmlsZUNvcnNYZHIgJiYgdGhpcy5fb3B0aW9ucy5jb3JzLmFsbG93WGRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pc0FsbG93ZWRFeHRlbnNpb246IGZ1bmN0aW9uKGFsbG93ZWQsIGZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKCFhbGxvd2VkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZWFjaChhbGxvd2VkLCBmdW5jdGlvbihpZHgsIGFsbG93ZWRFeHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKGFsbG93ZWRFeHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXh0UmVnZXggPSBuZXcgUmVnRXhwKFwiXFxcXC5cIiArIGFsbG93ZWRFeHQgKyBcIiRcIiwgXCJpXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lLm1hdGNoKGV4dFJlZ2V4KSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXRlbUVycm9yOiBmdW5jdGlvbihjb2RlLCBtYXliZU5hbWVPck5hbWVzLCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLl9vcHRpb25zLm1lc3NhZ2VzW2NvZGVdLCBhbGxvd2VkRXh0ZW5zaW9ucyA9IFtdLCBuYW1lcyA9IFtdLmNvbmNhdChtYXliZU5hbWVPck5hbWVzKSwgbmFtZSA9IG5hbWVzWzBdLCBidXR0b25JZCA9IHRoaXMuX2dldEJ1dHRvbklkKGl0ZW0pLCB2YWxpZGF0aW9uQmFzZSA9IHRoaXMuX2dldFZhbGlkYXRpb25CYXNlKGJ1dHRvbklkKSwgZXh0ZW5zaW9uc0Zvck1lc3NhZ2UsIHBsYWNlaG9sZGVyTWF0Y2g7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcihuYW1lLCByZXBsYWNlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKG5hbWUsIHJlcGxhY2VtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh2YWxpZGF0aW9uQmFzZS5hbGxvd2VkRXh0ZW5zaW9ucywgZnVuY3Rpb24oaWR4LCBhbGxvd2VkRXh0ZW5zaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxcS5pc1N0cmluZyhhbGxvd2VkRXh0ZW5zaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnMucHVzaChhbGxvd2VkRXh0ZW5zaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGV4dGVuc2lvbnNGb3JNZXNzYWdlID0gYWxsb3dlZEV4dGVuc2lvbnMuam9pbihcIiwgXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgcihcIntmaWxlfVwiLCB0aGlzLl9vcHRpb25zLmZvcm1hdEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgICAgICAgICAgICByKFwie2V4dGVuc2lvbnN9XCIsIGV4dGVuc2lvbnNGb3JNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICByKFwie3NpemVMaW1pdH1cIiwgdGhpcy5fZm9ybWF0U2l6ZSh2YWxpZGF0aW9uQmFzZS5zaXplTGltaXQpKTtcbiAgICAgICAgICAgICAgICByKFwie21pblNpemVMaW1pdH1cIiwgdGhpcy5fZm9ybWF0U2l6ZSh2YWxpZGF0aW9uQmFzZS5taW5TaXplTGltaXQpKTtcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlck1hdGNoID0gbWVzc2FnZS5tYXRjaCgvKFxce1xcdytcXH0pL2cpO1xuICAgICAgICAgICAgICAgIGlmIChwbGFjZWhvbGRlck1hdGNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2gocGxhY2Vob2xkZXJNYXRjaCwgZnVuY3Rpb24oaWR4LCBwbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcihwbGFjZWhvbGRlciwgbmFtZXNbaWR4XSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vbkVycm9yKG51bGwsIG5hbWUsIG1lc3NhZ2UsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21hbnVhbFJldHJ5OiBmdW5jdGlvbihpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb25CZWZvcmVNYW51YWxSZXRyeShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZCsrO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soaWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlci5yZXRyeShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXliZUFsbENvbXBsZXRlOiBmdW5jdGlvbihpZCwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBub3RGaW5pc2hlZCA9IHRoaXMuX2dldE5vdEZpbmlzaGVkKCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9TVUNDRVNTRlVMKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBxcS5zdGF0dXMuVVBMT0FEX0ZBSUxFRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5vdEZpbmlzaGVkID09PSAwICYmICh0aGlzLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZS5sZW5ndGggfHwgdGhpcy5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUubGVuZ3RoKSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25BbGxDb21wbGV0ZShzZWxmLl9zdWNjZWVkZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSwgc2VsZi5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlSGFuZGxlSW9zOFNhZmFyaVdvcmthcm91bmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy53b3JrYXJvdW5kcy5pb3M4U2FmYXJpVXBsb2FkcyAmJiBxcS5pb3M4MDAoKSAmJiBxcS5pb3NTYWZhcmkoKSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KHNlbGYuX29wdGlvbnMubWVzc2FnZXMudW5zdXBwb3J0ZWRCcm93c2VySW9zOFNhZmFyaSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IodGhpcy5fb3B0aW9ucy5tZXNzYWdlcy51bnN1cHBvcnRlZEJyb3dzZXJJb3M4U2FmYXJpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlUGFyc2VBbmRTZW5kVXBsb2FkRXJyb3I6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4aHIgJiYgeGhyLnN0YXR1cyAhPT0gMjAwICYmICFyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihpZCwgbmFtZSwgXCJYSFIgcmV0dXJuZWQgcmVzcG9uc2UgY29kZSBcIiArIHhoci5zdGF0dXMsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZWFzb24gPSByZXNwb25zZS5lcnJvciA/IHJlc3BvbnNlLmVycm9yIDogdGhpcy5fb3B0aW9ucy50ZXh0LmRlZmF1bHRSZXNwb25zZUVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25FcnJvcihpZCwgbmFtZSwgZXJyb3JSZWFzb24sIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlUHJvY2Vzc05leHRJdGVtQWZ0ZXJPblZhbGlkYXRlQ2FsbGJhY2s6IGZ1bmN0aW9uKHZhbGlkSXRlbSwgaXRlbXMsIGluZGV4LCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRJdGVtIHx8ICF0aGlzLl9vcHRpb25zLnZhbGlkYXRpb24uc3RvcE9uRmlyc3RJbnZhbGlkRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdGlvbkRlc2NyaXB0b3IgPSBzZWxmLl9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcihpdGVtc1tpbmRleF0pLCBidXR0b25JZCA9IHNlbGYuX2dldEJ1dHRvbklkKGl0ZW1zW2luZGV4XS5maWxlKSwgYnV0dG9uID0gc2VsZi5fZ2V0QnV0dG9uKGJ1dHRvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uVmFsaWRhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQoc2VsZi5fb3B0aW9ucy5jYWxsYmFja3Mub25WYWxpZGF0ZSwgc2VsZiwgdmFsaWRhdGlvbkRlc2NyaXB0b3IsIGJ1dHRvbiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogcXEuYmluZChzZWxmLl9vblZhbGlkYXRlQ2FsbGJhY2tTdWNjZXNzLCBzZWxmLCBpdGVtcywgaW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IHFxLmJpbmQoc2VsZi5fb25WYWxpZGF0ZUNhbGxiYWNrRmFpbHVyZSwgc2VsZiwgaXRlbXMsIGluZGV4LCBwYXJhbXMsIGVuZHBvaW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogXCJJdGVtICdcIiArIHZhbGlkYXRpb25EZXNjcmlwdG9yLm5hbWUgKyBcIicsIHNpemU6IFwiICsgdmFsaWRhdGlvbkRlc2NyaXB0b3Iuc2l6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXZhbGlkSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7aW5kZXggPCBpdGVtcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9maWxlT3JCbG9iUmVqZWN0ZWQoaXRlbXNbaW5kZXhdLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25BbGxDb21wbGV0ZTogZnVuY3Rpb24oc3VjY2Vzc2Z1bCwgZmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxQcm9ncmVzcyAmJiB0aGlzLl90b3RhbFByb2dyZXNzLm9uQWxsQ29tcGxldGUoc3VjY2Vzc2Z1bCwgZmFpbGVkLCB0aGlzLl9wcmV2ZW50UmV0cmllcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25BbGxDb21wbGV0ZShxcS5leHRlbmQoW10sIHN1Y2Nlc3NmdWwpLCBxcS5leHRlbmQoW10sIGZhaWxlZCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5fZmFpbGVkU2luY2VMYXN0QWxsQ29tcGxldGUgPSBbXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25BdXRvUmV0cnk6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXNwb25zZUpTT04sIHhociwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgc2VsZi5fcHJldmVudFJldHJpZXNbaWRdID0gcmVzcG9uc2VKU09OW3NlbGYuX29wdGlvbnMucmV0cnkucHJldmVudFJldHJ5UmVzcG9uc2VQcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuX3Nob3VsZEF1dG9SZXRyeShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHJ5V2FpdFBlcmlvZCA9IHNlbGYuX29wdGlvbnMucmV0cnkuYXV0b0F0dGVtcHREZWxheSAqIDFlMztcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWF5YmVQYXJzZUFuZFNlbmRVcGxvYWRFcnJvci5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vbkF1dG9SZXRyeShpZCwgbmFtZSwgc2VsZi5fYXV0b1JldHJpZXNbaWRdKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25CZWZvcmVBdXRvUmV0cnkoaWQsIG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3JldHJ5VGltZW91dHNbaWRdID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKFwiU3RhcnRpbmcgcmV0cnkgZm9yIFwiICsgbmFtZSArIFwiLi4uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVyLnJldHJ5KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgcmV0cnlXYWl0UGVyaW9kKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkJlZm9yZUF1dG9SZXRyeTogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIldhaXRpbmcgXCIgKyB0aGlzLl9vcHRpb25zLnJldHJ5LmF1dG9BdHRlbXB0RGVsYXkgKyBcIiBzZWNvbmRzIGJlZm9yZSByZXRyeWluZyBcIiArIG5hbWUgKyBcIi4uLlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25CZWZvcmVNYW51YWxSZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbUxpbWl0ID0gdGhpcy5fY3VycmVudEl0ZW1MaW1pdCwgZmlsZU5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3ByZXZlbnRSZXRyaWVzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlJldHJpZXMgYXJlIGZvcmJpZGRlbiBmb3IgaWQgXCIgKyBpZCwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYW5kbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lID0gdGhpcy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uTWFudWFsUmV0cnkoaWQsIGZpbGVOYW1lKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUxpbWl0ID4gMCAmJiB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkICsgMSA+IGl0ZW1MaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwicmV0cnlGYWlsVG9vTWFueUl0ZW1zXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiUmV0cnlpbmcgdXBsb2FkIGZvciAnXCIgKyBmaWxlTmFtZSArIFwiJyAoaWQ6IFwiICsgaWQgKyBcIikuLi5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiJ1wiICsgaWQgKyBcIicgaXMgbm90IGEgdmFsaWQgZmlsZSBJRFwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkNhbmNlbDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZE9yUXVldWVkLS07XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3JldHJ5VGltZW91dHNbaWRdKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmVkSXRlbUluZGV4ID0gcXEuaW5kZXhPZih0aGlzLl9zdG9yZWRJZHMsIGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMuYXV0b1VwbG9hZCAmJiBzdG9yZWRJdGVtSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdG9yZWRJZHMuc3BsaWNlKHN0b3JlZEl0ZW1JbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuQ0FOQ0VMRUQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzdWx0LCB4aHIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25ldFVwbG9hZGVkT3JRdWV1ZWQtLTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5VUExPQURfRkFJTEVEKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFt0aGlzLl9vcHRpb25zLnJldHJ5LnByZXZlbnRSZXRyeVJlc3BvbnNlUHJvcGVydHldID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmV2ZW50UmV0cmllc1tpZF0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC50aHVtYm5haWxVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RodW1ibmFpbFVybHNbaWRdID0gcmVzdWx0LnRodW1ibmFpbFVybDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZCsrO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRF9TVUNDRVNTRlVMKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbWF5YmVQYXJzZUFuZFNlbmRVcGxvYWRFcnJvcihpZCwgbmFtZSwgcmVzdWx0LCB4aHIpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuc3VjY2VzcyA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25EZWxldGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5ERUxFVElORyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRGVsZXRlQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHJPclhkciwgaXNFcnJvcikge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGVGYWlsZWQoaWQsIHhock9yWGRyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGVTdWNjZXNzKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uSW5wdXRDaGFuZ2U6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVJbmRleDtcbiAgICAgICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGZpbGVJbmRleCA9IDA7IGZpbGVJbmRleCA8IGlucHV0LmZpbGVzLmxlbmd0aDsgZmlsZUluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Fubm90YXRlV2l0aEJ1dHRvbklkKGlucHV0LmZpbGVzW2ZpbGVJbmRleF0sIGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGVzKGlucHV0LmZpbGVzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LnZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlcyhpbnB1dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmVhY2godGhpcy5fYnV0dG9ucywgZnVuY3Rpb24oaWR4LCBidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxQcm9ncmVzcyAmJiB0aGlzLl90b3RhbFByb2dyZXNzLm9uSW5kaXZpZHVhbFByb2dyZXNzKGlkLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgIF9vblN1Ym1pdENhbGxiYWNrU3VjY2VzczogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vblN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuU1VCTUlUVEVEKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vblN1Ym1pdHRlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmF1dG9VcGxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25TdWJtaXR0ZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZShpZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RvcmVGb3JMYXRlcihpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uU3VibWl0dGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdERlbGV0ZTogZnVuY3Rpb24oaWQsIG9uU3VjY2Vzc0NhbGxiYWNrLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IHRoaXMuZ2V0VXVpZChpZCksIGFkanVzdGVkT25TdWNjZXNzQ2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgaWYgKG9uU3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkanVzdGVkT25TdWNjZXNzQ2FsbGJhY2sgPSBxcS5iaW5kKG9uU3VjY2Vzc0NhbGxiYWNrLCB0aGlzLCBpZCwgdXVpZCwgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRGVsZXRlUG9zc2libGUoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblN1Ym1pdERlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQodGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25TdWJtaXREZWxldGUsIHRoaXMsIGlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogYWRqdXN0ZWRPblN1Y2Nlc3NDYWxsYmFjayB8fCBxcS5iaW5kKHRoaXMuX2RlbGV0ZUhhbmRsZXIuc2VuZERlbGV0ZSwgdGhpcywgaWQsIHV1aWQsIGFkZGl0aW9uYWxNYW5kYXRlZFBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyOiBpZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coXCJEZWxldGUgcmVxdWVzdCBpZ25vcmVkIGZvciBJRCBcIiArIGlkICsgXCIsIGRlbGV0ZSBmZWF0dXJlIGlzIGRpc2FibGVkIG9yIHJlcXVlc3Qgbm90IHBvc3NpYmxlIFwiICsgXCJkdWUgdG8gQ09SUyBvbiBhIHVzZXIgYWdlbnQgdGhhdCBkb2VzIG5vdCBzdXBwb3J0IHByZS1mbGlnaHRpbmcuXCIsIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIF9vblRvdGFsUHJvZ3Jlc3M6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblRvdGFsUHJvZ3Jlc3MobG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkUHJlcDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgX29uVXBsb2FkOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwbG9hZERhdGEuc2V0U3RhdHVzKGlkLCBxcS5zdGF0dXMuVVBMT0FESU5HKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRDaHVuazogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSkge30sXG4gICAgICAgICAgICBfb25VcGxvYWRDaHVua1N1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3ByZXZlbnRSZXRyaWVzW2lkXSAmJiB0aGlzLl9vcHRpb25zLnJldHJ5LmVuYWJsZUF1dG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0b1JldHJpZXNbaWRdID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3U3RhdHVzID09PSBxcS5zdGF0dXMuUEFVU0VEKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yZXRyeVRpbWVvdXRzW2lkXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblZhbGlkYXRlQmF0Y2hDYWxsYmFja0ZhaWx1cmU6IGZ1bmN0aW9uKGZpbGVXcmFwcGVycykge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGZpbGVXcmFwcGVycywgZnVuY3Rpb24oaWR4LCBmaWxlV3JhcHBlcikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9maWxlT3JCbG9iUmVqZWN0ZWQoZmlsZVdyYXBwZXIuaWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblZhbGlkYXRlQmF0Y2hDYWxsYmFja1N1Y2Nlc3M6IGZ1bmN0aW9uKHZhbGlkYXRpb25EZXNjcmlwdG9ycywgaXRlbXMsIHBhcmFtcywgZW5kcG9pbnQsIGJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UsIGl0ZW1MaW1pdCA9IHRoaXMuX2N1cnJlbnRJdGVtTGltaXQsIHByb3Bvc2VkTmV0RmlsZXNVcGxvYWRlZE9yUXVldWVkID0gdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZDtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUxpbWl0ID09PSAwIHx8IHByb3Bvc2VkTmV0RmlsZXNVcGxvYWRlZE9yUXVldWVkIDw9IGl0ZW1MaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uVmFsaWRhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogcXEuYmluZCh0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblZhbGlkYXRlLCB0aGlzLCB2YWxpZGF0aW9uRGVzY3JpcHRvcnNbMF0sIGJ1dHRvbiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBxcS5iaW5kKHRoaXMuX29uVmFsaWRhdGVDYWxsYmFja1N1Y2Nlc3MsIHRoaXMsIGl0ZW1zLCAwLCBwYXJhbXMsIGVuZHBvaW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IHFxLmJpbmQodGhpcy5fb25WYWxpZGF0ZUNhbGxiYWNrRmFpbHVyZSwgdGhpcywgaXRlbXMsIDAsIHBhcmFtcywgZW5kcG9pbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IFwiSXRlbSAnXCIgKyBpdGVtc1swXS5maWxlLm5hbWUgKyBcIicsIHNpemU6IFwiICsgaXRlbXNbMF0uZmlsZS5zaXplXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1FcnJvcihcIm5vRmlsZXNFcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uVmFsaWRhdGVCYXRjaENhbGxiYWNrRmFpbHVyZShpdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IHRoaXMuX29wdGlvbnMubWVzc2FnZXMudG9vTWFueUl0ZW1zRXJyb3IucmVwbGFjZSgvXFx7bmV0SXRlbXNcXH0vZywgcHJvcG9zZWROZXRGaWxlc1VwbG9hZGVkT3JRdWV1ZWQpLnJlcGxhY2UoL1xce2l0ZW1MaW1pdFxcfS9nLCBpdGVtTGltaXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9iYXRjaEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblZhbGlkYXRlQ2FsbGJhY2tGYWlsdXJlOiBmdW5jdGlvbihpdGVtcywgaW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVPckJsb2JSZWplY3RlZChpdGVtc1tpbmRleF0uaWQsIGl0ZW1zW2luZGV4XS5maWxlLm5hbWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21heWJlUHJvY2Vzc05leHRJdGVtQWZ0ZXJPblZhbGlkYXRlQ2FsbGJhY2soZmFsc2UsIGl0ZW1zLCBuZXh0SW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblZhbGlkYXRlQ2FsbGJhY2tTdWNjZXNzOiBmdW5jdGlvbihpdGVtcywgaW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsIG5leHRJbmRleCA9IGluZGV4ICsgMSwgdmFsaWRhdGlvbkRlc2NyaXB0b3IgPSB0aGlzLl9nZXRWYWxpZGF0aW9uRGVzY3JpcHRvcihpdGVtc1tpbmRleF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRlRmlsZU9yQmxvYkRhdGEoaXRlbXNbaW5kZXhdLCB2YWxpZGF0aW9uRGVzY3JpcHRvcikudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBsb2FkKGl0ZW1zW2luZGV4XS5pZCwgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX21heWJlUHJvY2Vzc05leHRJdGVtQWZ0ZXJPblZhbGlkYXRlQ2FsbGJhY2sodHJ1ZSwgaXRlbXMsIG5leHRJbmRleCwgcGFyYW1zLCBlbmRwb2ludCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX21heWJlUHJvY2Vzc05leHRJdGVtQWZ0ZXJPblZhbGlkYXRlQ2FsbGJhY2soZmFsc2UsIGl0ZW1zLCBuZXh0SW5kZXgsIHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9wcmVwYXJlSXRlbXNGb3JVcGxvYWQ6IGZ1bmN0aW9uKGl0ZW1zLCBwYXJhbXMsIGVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJub0ZpbGVzRXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRpb25EZXNjcmlwdG9ycyA9IHRoaXMuX2dldFZhbGlkYXRpb25EZXNjcmlwdG9ycyhpdGVtcyksIGJ1dHRvbklkID0gdGhpcy5fZ2V0QnV0dG9uSWQoaXRlbXNbMF0uZmlsZSksIGJ1dHRvbiA9IHRoaXMuX2dldEJ1dHRvbihidXR0b25JZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hlY2tlZENhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJvblZhbGlkYXRlQmF0Y2hcIixcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHFxLmJpbmQodGhpcy5fb3B0aW9ucy5jYWxsYmFja3Mub25WYWxpZGF0ZUJhdGNoLCB0aGlzLCB2YWxpZGF0aW9uRGVzY3JpcHRvcnMsIGJ1dHRvbiksXG4gICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogcXEuYmluZCh0aGlzLl9vblZhbGlkYXRlQmF0Y2hDYWxsYmFja1N1Y2Nlc3MsIHRoaXMsIHZhbGlkYXRpb25EZXNjcmlwdG9ycywgaXRlbXMsIHBhcmFtcywgZW5kcG9pbnQsIGJ1dHRvbiksXG4gICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogcXEuYmluZCh0aGlzLl9vblZhbGlkYXRlQmF0Y2hDYWxsYmFja0ZhaWx1cmUsIHRoaXMsIGl0ZW1zKSxcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogXCJiYXRjaCB2YWxpZGF0aW9uXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcHJldmVudExlYXZlSW5Qcm9ncmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2VTdXBwb3J0LmF0dGFjaCh3aW5kb3csIFwiYmVmb3JldW5sb2FkXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0SW5Qcm9ncmVzcygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnJldHVyblZhbHVlID0gc2VsZi5fb3B0aW9ucy5tZXNzYWdlcy5vbkxlYXZlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29wdGlvbnMubWVzc2FnZXMub25MZWF2ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9yZWZyZXNoU2Vzc2lvbkRhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgb3B0aW9ucyA9IHRoaXMuX29wdGlvbnMuc2Vzc2lvbjtcbiAgICAgICAgICAgICAgICBpZiAocXEuU2Vzc2lvbiAmJiB0aGlzLl9vcHRpb25zLnNlc3Npb24uZW5kcG9pbnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3Nlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yczogdGhpcy5fb3B0aW9ucy5jb3JzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nID0gcXEuYmluZCh0aGlzLmxvZywgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFkZEZpbGVSZWNvcmQgPSBxcS5iaW5kKHRoaXMuX2FkZENhbm5lZEZpbGUsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2Vzc2lvbiA9IG5ldyBxcS5TZXNzaW9uKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZXNzaW9uLnJlZnJlc2goKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHJPclhkcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Nlc3Npb25SZXF1ZXN0Q29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrcy5vblNlc3Npb25SZXF1ZXN0Q29tcGxldGUocmVzcG9uc2UsIHRydWUsIHhock9yWGRyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHJPclhkcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzLm9uU2Vzc2lvblJlcXVlc3RDb21wbGV0ZShyZXNwb25zZSwgZmFsc2UsIHhock9yWGRyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nlc3Npb25SZXF1ZXN0Q29tcGxldGU6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICAgICBfc2V0U2l6ZTogZnVuY3Rpb24oaWQsIG5ld1NpemUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhLnVwZGF0ZVNpemUoaWQsIG5ld1NpemUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsUHJvZ3Jlc3MgJiYgdGhpcy5fdG90YWxQcm9ncmVzcy5vbk5ld1NpemUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG91bGRBdXRvUmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZERhdGEgPSB0aGlzLl91cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wcmV2ZW50UmV0cmllc1tpZF0gJiYgdGhpcy5fb3B0aW9ucy5yZXRyeS5lbmFibGVBdXRvICYmIHVwbG9hZERhdGEuc3RhdHVzICE9PSBxcS5zdGF0dXMuUEFVU0VEKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hdXRvUmV0cmllc1tpZF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0b1JldHJpZXNbaWRdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXV0b1JldHJpZXNbaWRdIDwgdGhpcy5fb3B0aW9ucy5yZXRyeS5tYXhBdXRvQXR0ZW1wdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9SZXRyaWVzW2lkXSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zdG9yZUZvckxhdGVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JlZElkcy5wdXNoKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdHJhY2tCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbklkO1xuICAgICAgICAgICAgICAgIGlmIChxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbklkID0gdGhpcy5faGFuZGxlci5nZXRGaWxlKGlkKS5xcUJ1dHRvbklkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbklkID0gdGhpcy5fZ2V0QnV0dG9uSWQodGhpcy5faGFuZGxlci5nZXRJbnB1dChpZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnV0dG9uSWRzRm9yRmlsZUlkc1tpZF0gPSBidXR0b25JZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3VwZGF0ZUZvcm1TdXBwb3J0QW5kUGFyYW1zOiBmdW5jdGlvbihmb3JtRWxlbWVudE9ySWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmZvcm0uZWxlbWVudCA9IGZvcm1FbGVtZW50T3JJZDtcbiAgICAgICAgICAgICAgICB0aGlzLl9mb3JtU3VwcG9ydCA9IHFxLkZvcm1TdXBwb3J0ICYmIG5ldyBxcS5Gb3JtU3VwcG9ydCh0aGlzLl9vcHRpb25zLmZvcm0sIHFxLmJpbmQodGhpcy51cGxvYWRTdG9yZWRGaWxlcywgdGhpcyksIHFxLmJpbmQodGhpcy5sb2csIHRoaXMpKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZm9ybVN1cHBvcnQgJiYgdGhpcy5fZm9ybVN1cHBvcnQuYXR0YWNoZWRUb0Zvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zU3RvcmUuYWRkUmVhZE9ubHkobnVsbCwgdGhpcy5fZm9ybVN1cHBvcnQuZ2V0Rm9ybUlucHV0c0FzT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5hdXRvVXBsb2FkID0gdGhpcy5fZm9ybVN1cHBvcnQubmV3QXV0b1VwbG9hZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0VuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVuZHBvaW50KHRoaXMuX2Zvcm1TdXBwb3J0Lm5ld0VuZHBvaW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdXBsb2FkOiBmdW5jdGlvbihpZCwgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFyYW1zKHBhcmFtcywgaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFbmRwb2ludChlbmRwb2ludCwgaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDaGVja2VkQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIm9uU3VibWl0XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBxcS5iaW5kKHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLm9uU3VibWl0LCB0aGlzLCBpZCwgbmFtZSksXG4gICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogcXEuYmluZCh0aGlzLl9vblN1Ym1pdENhbGxiYWNrU3VjY2VzcywgdGhpcywgaWQsIG5hbWUpLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IHFxLmJpbmQodGhpcy5fZmlsZU9yQmxvYlJlamVjdGVkLCB0aGlzLCBpZCwgbmFtZSksXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3VwbG9hZEZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9oYW5kbGVyLnVwbG9hZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRGF0YS5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5RVUVVRUQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdXBsb2FkU3RvcmVkRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBpZFRvVXBsb2FkLCBzdGlsbFN1Ym1pdHRpbmcsIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLl9zdG9yZWRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkVG9VcGxvYWQgPSB0aGlzLl9zdG9yZWRJZHMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZShpZFRvVXBsb2FkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RpbGxTdWJtaXR0aW5nID0gdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBxcS5zdGF0dXMuU1VCTUlUVElOR1xuICAgICAgICAgICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoc3RpbGxTdWJtaXR0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmxvZyhcIlN0aWxsIHdhaXRpbmcgZm9yIFwiICsgc3RpbGxTdWJtaXR0aW5nICsgXCIgZmlsZXMgdG8gY2xlYXIgc3VibWl0IHF1ZXVlLiBXaWxsIHJlLXBhcnNlIHN0b3JlZCBJRHMgYXJyYXkgc2hvcnRseS5cIik7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl91cGxvYWRTdG9yZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxZTMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfdmFsaWRhdGVGaWxlT3JCbG9iRGF0YTogZnVuY3Rpb24oZmlsZVdyYXBwZXIsIHZhbGlkYXRpb25EZXNjcmlwdG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBmaWxlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlV3JhcHBlci5maWxlIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsZVdyYXBwZXIuZmlsZS5yZWZlcmVuY2VCbG9iO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlV3JhcHBlci5maWxlO1xuICAgICAgICAgICAgICAgIH0oKSwgbmFtZSA9IHZhbGlkYXRpb25EZXNjcmlwdG9yLm5hbWUsIHNpemUgPSB2YWxpZGF0aW9uRGVzY3JpcHRvci5zaXplLCBidXR0b25JZCA9IHRoaXMuX2dldEJ1dHRvbklkKGZpbGVXcmFwcGVyLmZpbGUpLCB2YWxpZGF0aW9uQmFzZSA9IHRoaXMuX2dldFZhbGlkYXRpb25CYXNlKGJ1dHRvbklkKSwgdmFsaWRpdHlDaGVja2VyID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgICAgICB2YWxpZGl0eUNoZWNrZXIudGhlbihmdW5jdGlvbigpIHt9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmlsZU9yQmxvYlJlamVjdGVkKGZpbGVXcmFwcGVyLmlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNGaWxlT3JJbnB1dChmaWxlKSAmJiAhdGhpcy5faXNBbGxvd2VkRXh0ZW5zaW9uKHZhbGlkYXRpb25CYXNlLmFsbG93ZWRFeHRlbnNpb25zLCBuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJ0eXBlRXJyb3JcIiwgbmFtZSwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eUNoZWNrZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMudmFsaWRhdGlvbi5hbGxvd0VtcHR5ICYmIHNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbUVycm9yKFwiZW1wdHlFcnJvclwiLCBuYW1lLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5Q2hlY2tlci5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzaXplID4gMCAmJiB2YWxpZGF0aW9uQmFzZS5zaXplTGltaXQgJiYgc2l6ZSA+IHZhbGlkYXRpb25CYXNlLnNpemVMaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJzaXplRXJyb3JcIiwgbmFtZSwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eUNoZWNrZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+IDAgJiYgc2l6ZSA8IHZhbGlkYXRpb25CYXNlLm1pblNpemVMaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtRXJyb3IoXCJtaW5TaXplRXJyb3JcIiwgbmFtZSwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eUNoZWNrZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocXEuSW1hZ2VWYWxpZGF0aW9uICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MgJiYgcXEuaXNGaWxlKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBxcS5JbWFnZVZhbGlkYXRpb24oZmlsZSwgcXEuYmluZChzZWxmLmxvZywgc2VsZikpLnZhbGlkYXRlKHZhbGlkYXRpb25CYXNlLmltYWdlKS50aGVuKHZhbGlkaXR5Q2hlY2tlci5zdWNjZXNzLCBmdW5jdGlvbihlcnJvckNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2l0ZW1FcnJvcihlcnJvckNvZGUgKyBcIkltYWdlRXJyb3JcIiwgbmFtZSwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eUNoZWNrZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eUNoZWNrZXIuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRpdHlDaGVja2VyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF93cmFwQ2FsbGJhY2tzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiwgc2FmZUNhbGxiYWNrLCBwcm9wO1xuICAgICAgICAgICAgICAgIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHNhZmVDYWxsYmFjayA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZztcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseShzZWxmLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyA9IGV4Y2VwdGlvbi5tZXNzYWdlIHx8IGV4Y2VwdGlvbi50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coXCJDYXVnaHQgZXhjZXB0aW9uIGluICdcIiArIG5hbWUgKyBcIicgY2FsbGJhY2sgLSBcIiArIGVycm9yTXNnLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBmb3IgKHByb3AgaW4gdGhpcy5fb3B0aW9ucy5jYWxsYmFja3MpIHtcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrTmFtZSwgY2FsbGJhY2tGdW5jO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gcHJvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrRnVuYyA9IHNlbGYuX29wdGlvbnMuY2FsbGJhY2tzW2NhbGxiYWNrTmFtZV07XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9vcHRpb25zLmNhbGxiYWNrc1tjYWxsYmFja05hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNhZmVDYWxsYmFjayhjYWxsYmFja05hbWUsIGNhbGxiYWNrRnVuYywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pKCk7XG4gICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcXEuRmluZVVwbG9hZGVyQmFzaWMgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGRlYnVnOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBidXR0b246IG51bGwsXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IDMsXG4gICAgICAgICAgICAgICAgZGlzYWJsZUNhbmNlbEZvckZvcm1VcGxvYWRzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhdXRvVXBsb2FkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdhcm5CZWZvcmVVbmxvYWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFwiL3NlcnZlci91cGxvYWRcIixcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWVQYXJhbTogXCJxcWZpbGVuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgIGZvcmNlTXVsdGlwYXJ0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpbnB1dE5hbWU6IFwicXFmaWxlXCIsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIG9taXREZWZhdWx0UGFyYW1zOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zSW5Cb2R5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlU3VjY2Vzc0pzb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsRmlsZVNpemVOYW1lOiBcInFxdG90YWxmaWxlc2l6ZVwiLFxuICAgICAgICAgICAgICAgICAgICB1dWlkTmFtZTogXCJxcXV1aWRcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9uczogW10sXG4gICAgICAgICAgICAgICAgICAgIHNpemVMaW1pdDogMCxcbiAgICAgICAgICAgICAgICAgICAgbWluU2l6ZUxpbWl0OiAwLFxuICAgICAgICAgICAgICAgICAgICBpdGVtTGltaXQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHN0b3BPbkZpcnN0SW52YWxpZEZpbGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGFjY2VwdEZpbGVzOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5IZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5XaWR0aDogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhbGxvd0VtcHR5OiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uU3VibWl0dGVkOiBmdW5jdGlvbihpZCwgbmFtZSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCBuYW1lLCByZXNwb25zZUpTT04sIG1heWJlWGhyKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25BbGxDb21wbGV0ZTogZnVuY3Rpb24oc3VjY2Vzc2Z1bCwgZmFpbGVkKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRDaHVuazogZnVuY3Rpb24oaWQsIG5hbWUsIGNodW5rRGF0YSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkQ2h1bmtTdWNjZXNzOiBmdW5jdGlvbihpZCwgY2h1bmtEYXRhLCByZXNwb25zZUpTT04sIHhocikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uUmVzdW1lOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIGNodW5rRGF0YSwgY3VzdG9tUmVzdW1lRGF0YSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBuYW1lLCBsb2FkZWQsIHRvdGFsKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25Ub3RhbFByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24oaWQsIG5hbWUsIHJlYXNvbiwgbWF5YmVYaHJPclhkcikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uQXV0b1JldHJ5OiBmdW5jdGlvbihpZCwgbmFtZSwgYXR0ZW1wdE51bWJlcikge30sXG4gICAgICAgICAgICAgICAgICAgIG9uTWFudWFsUmV0cnk6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZUJhdGNoOiBmdW5jdGlvbihmaWxlT3JCbG9iRGF0YSkge30sXG4gICAgICAgICAgICAgICAgICAgIG9uVmFsaWRhdGU6IGZ1bmN0aW9uKGZpbGVPckJsb2JEYXRhKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25TdWJtaXREZWxldGU6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25EZWxldGU6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25EZWxldGVDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25QYXN0ZVJlY2VpdmVkOiBmdW5jdGlvbihibG9iKSB7fSxcbiAgICAgICAgICAgICAgICAgICAgb25TdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cykge30sXG4gICAgICAgICAgICAgICAgICAgIG9uU2Vzc2lvblJlcXVlc3RDb21wbGV0ZTogZnVuY3Rpb24ocmVzcG9uc2UsIHN1Y2Nlc3MsIHhock9yWGRyKSB7fVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZUVycm9yOiBcIntmaWxlfSBoYXMgYW4gaW52YWxpZCBleHRlbnNpb24uIFZhbGlkIGV4dGVuc2lvbihzKToge2V4dGVuc2lvbnN9LlwiLFxuICAgICAgICAgICAgICAgICAgICBzaXplRXJyb3I6IFwie2ZpbGV9IGlzIHRvbyBsYXJnZSwgbWF4aW11bSBmaWxlIHNpemUgaXMge3NpemVMaW1pdH0uXCIsXG4gICAgICAgICAgICAgICAgICAgIG1pblNpemVFcnJvcjogXCJ7ZmlsZX0gaXMgdG9vIHNtYWxsLCBtaW5pbXVtIGZpbGUgc2l6ZSBpcyB7bWluU2l6ZUxpbWl0fS5cIixcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlFcnJvcjogXCJ7ZmlsZX0gaXMgZW1wdHksIHBsZWFzZSBzZWxlY3QgZmlsZXMgYWdhaW4gd2l0aG91dCBpdC5cIixcbiAgICAgICAgICAgICAgICAgICAgbm9GaWxlc0Vycm9yOiBcIk5vIGZpbGVzIHRvIHVwbG9hZC5cIixcbiAgICAgICAgICAgICAgICAgICAgdG9vTWFueUl0ZW1zRXJyb3I6IFwiVG9vIG1hbnkgaXRlbXMgKHtuZXRJdGVtc30pIHdvdWxkIGJlIHVwbG9hZGVkLiAgSXRlbSBsaW1pdCBpcyB7aXRlbUxpbWl0fS5cIixcbiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0SW1hZ2VFcnJvcjogXCJJbWFnZSBpcyB0b28gdGFsbC5cIixcbiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGhJbWFnZUVycm9yOiBcIkltYWdlIGlzIHRvbyB3aWRlLlwiLFxuICAgICAgICAgICAgICAgICAgICBtaW5IZWlnaHRJbWFnZUVycm9yOiBcIkltYWdlIGlzIG5vdCB0YWxsIGVub3VnaC5cIixcbiAgICAgICAgICAgICAgICAgICAgbWluV2lkdGhJbWFnZUVycm9yOiBcIkltYWdlIGlzIG5vdCB3aWRlIGVub3VnaC5cIixcbiAgICAgICAgICAgICAgICAgICAgcmV0cnlGYWlsVG9vTWFueUl0ZW1zOiBcIlJldHJ5IGZhaWxlZCAtIHlvdSBoYXZlIHJlYWNoZWQgeW91ciBmaWxlIGxpbWl0LlwiLFxuICAgICAgICAgICAgICAgICAgICBvbkxlYXZlOiBcIlRoZSBmaWxlcyBhcmUgYmVpbmcgdXBsb2FkZWQsIGlmIHlvdSBsZWF2ZSBub3cgdGhlIHVwbG9hZCB3aWxsIGJlIGNhbmNlbGVkLlwiLFxuICAgICAgICAgICAgICAgICAgICB1bnN1cHBvcnRlZEJyb3dzZXJJb3M4U2FmYXJpOiBcIlVucmVjb3ZlcmFibGUgZXJyb3IgLSB0aGlzIGJyb3dzZXIgZG9lcyBub3QgcGVybWl0IGZpbGUgdXBsb2FkaW5nIG9mIGFueSBraW5kIGR1ZSB0byBzZXJpb3VzIGJ1Z3MgaW4gaU9TOCBTYWZhcmkuICBQbGVhc2UgdXNlIGlPUzggQ2hyb21lIHVudGlsIEFwcGxlIGZpeGVzIHRoZXNlIGlzc3Vlcy5cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmV0cnk6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQXV0bzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIG1heEF1dG9BdHRlbXB0czogMyxcbiAgICAgICAgICAgICAgICAgICAgYXV0b0F0dGVtcHREZWxheTogNSxcbiAgICAgICAgICAgICAgICAgICAgcHJldmVudFJldHJ5UmVzcG9uc2VQcm9wZXJ0eTogXCJwcmV2ZW50UmV0cnlcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgICAgICBidXR0b25Ib3ZlcjogXCJxcS11cGxvYWQtYnV0dG9uLWhvdmVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkZvY3VzOiBcInFxLXVwbG9hZC1idXR0b24tZm9jdXNcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2h1bmtpbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmN1cnJlbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG1hbmRhdG9yeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtTmFtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleDogXCJxcXBhcnRpbmRleFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydEJ5dGVPZmZzZXQ6IFwicXFwYXJ0Ynl0ZW9mZnNldFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtTaXplOiBcInFxY2h1bmtzaXplXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEZpbGVTaXplOiBcInFxdG90YWxmaWxlc2l6ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQYXJ0czogXCJxcXRvdGFscGFydHNcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwYXJ0U2l6ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyZTY7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBqc29uUGF5bG9hZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0T25TdGF0dXM6IFtdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc3VtZToge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcmVjb3Jkc0V4cGlyZUluOiA3LFxuICAgICAgICAgICAgICAgICAgICBwYXJhbU5hbWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bWluZzogXCJxcXJlc3VtZVwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUtleXM6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmb3JtYXRGaWxlTmFtZTogZnVuY3Rpb24oZmlsZU9yQmxvYk5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVPckJsb2JOYW1lO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0UmVzcG9uc2VFcnJvcjogXCJVcGxvYWQgZmFpbHVyZSByZWFzb24gdW5rbm93blwiLFxuICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXRUaXRsZTogXCJmaWxlIGlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgIHNpemVTeW1ib2xzOiBbIFwia0JcIiwgXCJNQlwiLCBcIkdCXCIsIFwiVEJcIiwgXCJQQlwiLCBcIkVCXCIgXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGVsZXRlRmlsZToge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogXCIvc2VydmVyL3VwbG9hZFwiLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7fVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29yczoge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNlbmRDcmVkZW50aWFsczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGFsbG93WGRyOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmxvYnM6IHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE5hbWU6IFwibWlzY19kYXRhXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhc3RlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHROYW1lOiBcInBhc3RlZF9pbWFnZVwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYW1lcmE6IHtcbiAgICAgICAgICAgICAgICAgICAgaW9zOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBleHRyYUJ1dHRvbnM6IFtdLFxuICAgICAgICAgICAgICAgIHNlc3Npb246IHtcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IHt9LFxuICAgICAgICAgICAgICAgICAgICByZWZyZXNoT25SZXNldDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZm9ybToge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBcInFxLWZvcm1cIixcbiAgICAgICAgICAgICAgICAgICAgYXV0b1VwbG9hZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGludGVyY2VwdFN1Ym1pdDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2NhbGluZzoge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21SZXNpemVyOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBzZW5kT3JpZ2luYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9yaWVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFR5cGU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRRdWFsaXR5OiA4MCxcbiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZVRleHQ6IFwiRmFpbGVkIHRvIHNjYWxlXCIsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVFeGlmOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZXM6IFtdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB3b3JrYXJvdW5kczoge1xuICAgICAgICAgICAgICAgICAgICBpb3NFbXB0eVZpZGVvczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW9zOFNhZmFyaVVwbG9hZHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlvczhCcm93c2VyQ3Jhc2g6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHFxLmV4dGVuZCh0aGlzLl9vcHRpb25zLCBvLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbnMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX2V4dHJhQnV0dG9uU3BlY3MgPSB7fTtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbklkc0ZvckZpbGVJZHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3dyYXBDYWxsYmFja3MoKTtcbiAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2VTdXBwb3J0ID0gbmV3IHFxLkRpc3Bvc2VTdXBwb3J0KCk7XG4gICAgICAgICAgICB0aGlzLl9zdG9yZWRJZHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX2F1dG9SZXRyaWVzID0gW107XG4gICAgICAgICAgICB0aGlzLl9yZXRyeVRpbWVvdXRzID0gW107XG4gICAgICAgICAgICB0aGlzLl9wcmV2ZW50UmV0cmllcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fdGh1bWJuYWlsVXJscyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fbmV0VXBsb2FkZWRPclF1ZXVlZCA9IDA7XG4gICAgICAgICAgICB0aGlzLl9uZXRVcGxvYWRlZCA9IDA7XG4gICAgICAgICAgICB0aGlzLl91cGxvYWREYXRhID0gdGhpcy5fY3JlYXRlVXBsb2FkRGF0YVRyYWNrZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2luaXRGb3JtU3VwcG9ydEFuZFBhcmFtcygpO1xuICAgICAgICAgICAgdGhpcy5fY3VzdG9tSGVhZGVyc1N0b3JlID0gdGhpcy5fY3JlYXRlU3RvcmUodGhpcy5fb3B0aW9ucy5yZXF1ZXN0LmN1c3RvbUhlYWRlcnMpO1xuICAgICAgICAgICAgdGhpcy5fZGVsZXRlRmlsZUN1c3RvbUhlYWRlcnNTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5jdXN0b21IZWFkZXJzKTtcbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUZpbGVQYXJhbXNTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5wYXJhbXMpO1xuICAgICAgICAgICAgdGhpcy5fZW5kcG9pbnRTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMucmVxdWVzdC5lbmRwb2ludCk7XG4gICAgICAgICAgICB0aGlzLl9kZWxldGVGaWxlRW5kcG9pbnRTdG9yZSA9IHRoaXMuX2NyZWF0ZVN0b3JlKHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5lbmRwb2ludCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVyID0gdGhpcy5fY3JlYXRlVXBsb2FkSGFuZGxlcigpO1xuICAgICAgICAgICAgdGhpcy5fZGVsZXRlSGFuZGxlciA9IHFxLkRlbGV0ZUZpbGVBamF4UmVxdWVzdGVyICYmIHRoaXMuX2NyZWF0ZURlbGV0ZUhhbmRsZXIoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRCdXR0b25JZCA9IHRoaXMuX2NyZWF0ZVVwbG9hZEJ1dHRvbih7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuX29wdGlvbnMuYnV0dG9uLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5fb3B0aW9ucy50ZXh0LmZpbGVJbnB1dFRpdGxlXG4gICAgICAgICAgICAgICAgfSkuZ2V0QnV0dG9uSWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2dlbmVyYXRlRXh0cmFCdXR0b25TcGVjcygpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2FtZXJhQWNjZXNzKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5wYXN0ZS50YXJnZXRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLlBhc3RlU3VwcG9ydCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXN0ZUhhbmRsZXIgPSB0aGlzLl9jcmVhdGVQYXN0ZUhhbmRsZXIoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlBhc3RlIHN1cHBvcnQgbW9kdWxlIG5vdCBmb3VuZFwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnMud2FybkJlZm9yZVVubG9hZCAmJiB0aGlzLl9wcmV2ZW50TGVhdmVJblByb2dyZXNzKCk7XG4gICAgICAgICAgICB0aGlzLl9pbWFnZUdlbmVyYXRvciA9IHFxLkltYWdlR2VuZXJhdG9yICYmIG5ldyBxcS5JbWFnZUdlbmVyYXRvcihxcS5iaW5kKHRoaXMubG9nLCB0aGlzKSk7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoU2Vzc2lvbkRhdGEoKTtcbiAgICAgICAgICAgIHRoaXMuX3N1Y2NlZWRlZFNpbmNlTGFzdEFsbENvbXBsZXRlID0gW107XG4gICAgICAgICAgICB0aGlzLl9mYWlsZWRTaW5jZUxhc3RBbGxDb21wbGV0ZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fc2NhbGVyID0gcXEuU2NhbGVyICYmIG5ldyBxcS5TY2FsZXIodGhpcy5fb3B0aW9ucy5zY2FsaW5nLCBxcS5iaW5kKHRoaXMubG9nLCB0aGlzKSkgfHwge307XG4gICAgICAgICAgICBpZiAodGhpcy5fc2NhbGVyLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXN0b21OZXdGaWxlSGFuZGxlciA9IHFxLmJpbmQodGhpcy5fc2NhbGVyLmhhbmRsZU5ld0ZpbGUsIHRoaXMuX3NjYWxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocXEuVG90YWxQcm9ncmVzcyAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5wcm9ncmVzc0Jhcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsUHJvZ3Jlc3MgPSBuZXcgcXEuVG90YWxQcm9ncmVzcyhxcS5iaW5kKHRoaXMuX29uVG90YWxQcm9ncmVzcywgdGhpcyksIGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRyeSA9IHNlbGYuX3VwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW50cnkgJiYgZW50cnkuc2l6ZSB8fCAwO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY3VycmVudEl0ZW1MaW1pdCA9IHRoaXMuX29wdGlvbnMudmFsaWRhdGlvbi5pdGVtTGltaXQ7XG4gICAgICAgICAgICB0aGlzLl9jdXN0b21SZXN1bWVEYXRhU3RvcmUgPSB0aGlzLl9jcmVhdGVTdG9yZSgpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5GaW5lVXBsb2FkZXJCYXNpYy5wcm90b3R5cGUgPSBxcS5iYXNlUHVibGljQXBpO1xuICAgICAgICBxcS5leHRlbmQocXEuRmluZVVwbG9hZGVyQmFzaWMucHJvdG90eXBlLCBxcS5iYXNlUHJpdmF0ZUFwaSk7XG4gICAgfSkoKTtcbiAgICBxcS5BamF4UmVxdWVzdGVyID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGxvZywgc2hvdWxkUGFyYW1zQmVJblF1ZXJ5U3RyaW5nLCBxdWV1ZSA9IFtdLCByZXF1ZXN0RGF0YSA9IHt9LCBvcHRpb25zID0ge1xuICAgICAgICAgICAgYWNjZXB0SGVhZGVyOiBudWxsLFxuICAgICAgICAgICAgdmFsaWRNZXRob2RzOiBbIFwiUEFUQ0hcIiwgXCJQT1NUXCIsIFwiUFVUXCIgXSxcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICAgICAgICAgIG1heENvbm5lY3Rpb25zOiAzLFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge30sXG4gICAgICAgICAgICBlbmRwb2ludFN0b3JlOiB7fSxcbiAgICAgICAgICAgIHBhcmFtc1N0b3JlOiB7fSxcbiAgICAgICAgICAgIG1hbmRhdGVkUGFyYW1zOiB7fSxcbiAgICAgICAgICAgIGFsbG93WFJlcXVlc3RlZFdpdGhBbmRDYWNoZUNvbnRyb2w6IHRydWUsXG4gICAgICAgICAgICBzdWNjZXNzZnVsUmVzcG9uc2VDb2Rlczoge1xuICAgICAgICAgICAgICAgIERFTEVURTogWyAyMDAsIDIwMiwgMjA0IF0sXG4gICAgICAgICAgICAgICAgUEFUQ0g6IFsgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQgXSxcbiAgICAgICAgICAgICAgICBQT1NUOiBbIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0IF0sXG4gICAgICAgICAgICAgICAgUFVUOiBbIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0IF0sXG4gICAgICAgICAgICAgICAgR0VUOiBbIDIwMCBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29yczoge1xuICAgICAgICAgICAgICAgIGV4cGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZW5kQ3JlZGVudGlhbHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7fSxcbiAgICAgICAgICAgIG9uU2VuZDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7fSxcbiAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBsb2cgPSBvcHRpb25zLmxvZztcbiAgICAgICAgaWYgKHFxLmluZGV4T2Yob3B0aW9ucy52YWxpZE1ldGhvZHMsIG9wdGlvbnMubWV0aG9kKSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIidcIiArIG9wdGlvbnMubWV0aG9kICsgXCInIGlzIG5vdCBhIHN1cHBvcnRlZCBtZXRob2QgZm9yIHRoaXMgdHlwZSBvZiByZXF1ZXN0IVwiKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc1NpbXBsZU1ldGhvZCgpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKFsgXCJHRVRcIiwgXCJQT1NUXCIsIFwiSEVBRFwiIF0sIG9wdGlvbnMubWV0aG9kKSA+PSAwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGNvbnRhaW5zTm9uU2ltcGxlSGVhZGVycyhoZWFkZXJzKSB7XG4gICAgICAgICAgICB2YXIgY29udGFpbnNOb25TaW1wbGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHFxLmVhY2goY29udGFpbnNOb25TaW1wbGUsIGZ1bmN0aW9uKGlkeCwgaGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmluZGV4T2YoWyBcIkFjY2VwdFwiLCBcIkFjY2VwdC1MYW5ndWFnZVwiLCBcIkNvbnRlbnQtTGFuZ3VhZ2VcIiwgXCJDb250ZW50LVR5cGVcIiBdLCBoZWFkZXIpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluc05vblNpbXBsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBjb250YWluc05vblNpbXBsZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc1hkcih4aHIpIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmNvcnMuZXhwZWN0ZWQgJiYgeGhyLndpdGhDcmVkZW50aWFscyA9PT0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldENvcnNBamF4VHJhbnNwb3J0KCkge1xuICAgICAgICAgICAgdmFyIHhock9yWGRyO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCB8fCB3aW5kb3cuQWN0aXZlWE9iamVjdCkge1xuICAgICAgICAgICAgICAgIHhock9yWGRyID0gcXEuY3JlYXRlWGhySW5zdGFuY2UoKTtcbiAgICAgICAgICAgICAgICBpZiAoeGhyT3JYZHIud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIgPSBuZXcgWERvbWFpblJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIub25sb2FkID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgICAgICAgICAgeGhyT3JYZHIub25lcnJvciA9IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyLm9udGltZW91dCA9IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgICAgICAgICAgIHhock9yWGRyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB4aHJPclhkcjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRYaHJPclhkcihpZCwgc3VwcGxpZWRYaHIpIHtcbiAgICAgICAgICAgIHZhciB4aHJPclhkciA9IHJlcXVlc3REYXRhW2lkXSAmJiByZXF1ZXN0RGF0YVtpZF0ueGhyO1xuICAgICAgICAgICAgaWYgKCF4aHJPclhkcikge1xuICAgICAgICAgICAgICAgIGlmIChzdXBwbGllZFhocikge1xuICAgICAgICAgICAgICAgICAgICB4aHJPclhkciA9IHN1cHBsaWVkWGhyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvcnMuZXhwZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHhock9yWGRyID0gZ2V0Q29yc0FqYXhUcmFuc3BvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHhock9yWGRyID0gcXEuY3JlYXRlWGhySW5zdGFuY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVtpZF0ueGhyID0geGhyT3JYZHI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geGhyT3JYZHI7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZGVxdWV1ZShpZCkge1xuICAgICAgICAgICAgdmFyIGkgPSBxcS5pbmRleE9mKHF1ZXVlLCBpZCksIG1heCA9IG9wdGlvbnMubWF4Q29ubmVjdGlvbnMsIG5leHRJZDtcbiAgICAgICAgICAgIGRlbGV0ZSByZXF1ZXN0RGF0YVtpZF07XG4gICAgICAgICAgICBxdWV1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoID49IG1heCAmJiBpIDwgbWF4KSB7XG4gICAgICAgICAgICAgICAgbmV4dElkID0gcXVldWVbbWF4IC0gMV07XG4gICAgICAgICAgICAgICAgc2VuZFJlcXVlc3QobmV4dElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBvbkNvbXBsZXRlKGlkLCB4ZHJFcnJvcikge1xuICAgICAgICAgICAgdmFyIHhociA9IGdldFhock9yWGRyKGlkKSwgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QsIGlzRXJyb3IgPSB4ZHJFcnJvciA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIGRlcXVldWUoaWQpO1xuICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBsb2cobWV0aG9kICsgXCIgcmVxdWVzdCBmb3IgXCIgKyBpZCArIFwiIGhhcyBmYWlsZWRcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzWGRyKHhocikgJiYgIWlzUmVzcG9uc2VTdWNjZXNzZnVsKHhoci5zdGF0dXMpKSB7XG4gICAgICAgICAgICAgICAgaXNFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgbG9nKG1ldGhvZCArIFwiIHJlcXVlc3QgZm9yIFwiICsgaWQgKyBcIiBoYXMgZmFpbGVkIC0gcmVzcG9uc2UgY29kZSBcIiArIHhoci5zdGF0dXMsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLm9uQ29tcGxldGUoaWQsIHhociwgaXNFcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFyYW1zKGlkKSB7XG4gICAgICAgICAgICB2YXIgb25EZW1hbmRQYXJhbXMgPSByZXF1ZXN0RGF0YVtpZF0uYWRkaXRpb25hbFBhcmFtcywgbWFuZGF0ZWRQYXJhbXMgPSBvcHRpb25zLm1hbmRhdGVkUGFyYW1zLCBwYXJhbXM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXNTdG9yZS5nZXQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBvcHRpb25zLnBhcmFtc1N0b3JlLmdldChpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob25EZW1hbmRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKG9uRGVtYW5kUGFyYW1zLCBmdW5jdGlvbihuYW1lLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbbmFtZV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKG1hbmRhdGVkUGFyYW1zLCBmdW5jdGlvbihuYW1lLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbbmFtZV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbmRSZXF1ZXN0KGlkLCBvcHRYaHIpIHtcbiAgICAgICAgICAgIHZhciB4aHIgPSBnZXRYaHJPclhkcihpZCwgb3B0WGhyKSwgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QsIHBhcmFtcyA9IGdldFBhcmFtcyhpZCksIHBheWxvYWQgPSByZXF1ZXN0RGF0YVtpZF0ucGF5bG9hZCwgdXJsO1xuICAgICAgICAgICAgb3B0aW9ucy5vblNlbmQoaWQpO1xuICAgICAgICAgICAgdXJsID0gY3JlYXRlVXJsKGlkLCBwYXJhbXMsIHJlcXVlc3REYXRhW2lkXS5hZGRpdGlvbmFsUXVlcnlQYXJhbXMpO1xuICAgICAgICAgICAgaWYgKGlzWGRyKHhocikpIHtcbiAgICAgICAgICAgICAgICB4aHIub25sb2FkID0gZ2V0WGRyTG9hZEhhbmRsZXIoaWQpO1xuICAgICAgICAgICAgICAgIHhoci5vbmVycm9yID0gZ2V0WGRyRXJyb3JIYW5kbGVyKGlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGdldFhoclJlYWR5U3RhdGVDaGFuZ2VIYW5kbGVyKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ2lzdGVyRm9yVXBsb2FkUHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIHRydWUpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29ycy5leHBlY3RlZCAmJiBvcHRpb25zLmNvcnMuc2VuZENyZWRlbnRpYWxzICYmICFpc1hkcih4aHIpKSB7XG4gICAgICAgICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRIZWFkZXJzKGlkKTtcbiAgICAgICAgICAgIGxvZyhcIlNlbmRpbmcgXCIgKyBtZXRob2QgKyBcIiByZXF1ZXN0IGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQocGF5bG9hZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNob3VsZFBhcmFtc0JlSW5RdWVyeVN0cmluZyB8fCAhcGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyYW1zICYmIG9wdGlvbnMuY29udGVudFR5cGUgJiYgb3B0aW9ucy5jb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKHFxLm9iajJ1cmwocGFyYW1zLCBcIlwiKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtcyAmJiBvcHRpb25zLmNvbnRlbnRUeXBlICYmIG9wdGlvbnMuY29udGVudFR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiYXBwbGljYXRpb24vanNvblwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKHBhcmFtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geGhyO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVybChpZCwgcGFyYW1zLCBhZGRpdGlvbmFsUXVlcnlQYXJhbXMpIHtcbiAgICAgICAgICAgIHZhciBlbmRwb2ludCA9IG9wdGlvbnMuZW5kcG9pbnRTdG9yZS5nZXQoaWQpLCBhZGRUb1BhdGggPSByZXF1ZXN0RGF0YVtpZF0uYWRkVG9QYXRoO1xuICAgICAgICAgICAgaWYgKGFkZFRvUGF0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBlbmRwb2ludCArPSBcIi9cIiArIGFkZFRvUGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzaG91bGRQYXJhbXNCZUluUXVlcnlTdHJpbmcgJiYgcGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBxcS5vYmoydXJsKHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFkZGl0aW9uYWxRdWVyeVBhcmFtcykge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gcXEub2JqMnVybChhZGRpdGlvbmFsUXVlcnlQYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbmRwb2ludDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRYaHJSZWFkeVN0YXRlQ2hhbmdlSGFuZGxlcihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChnZXRYaHJPclhkcihpZCkucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyRm9yVXBsb2FkUHJvZ3Jlc3MoaWQpIHtcbiAgICAgICAgICAgIHZhciBvblByb2dyZXNzID0gb3B0aW9ucy5vblByb2dyZXNzO1xuICAgICAgICAgICAgaWYgKG9uUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICBnZXRYaHJPclhkcihpZCkudXBsb2FkLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MoaWQsIGUubG9hZGVkLCBlLnRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0WGRyTG9hZEhhbmRsZXIoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKGlkKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0WGRyRXJyb3JIYW5kbGVyKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZShpZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldEhlYWRlcnMoaWQpIHtcbiAgICAgICAgICAgIHZhciB4aHIgPSBnZXRYaHJPclhkcihpZCksIGN1c3RvbUhlYWRlcnMgPSBvcHRpb25zLmN1c3RvbUhlYWRlcnMsIG9uRGVtYW5kSGVhZGVycyA9IHJlcXVlc3REYXRhW2lkXS5hZGRpdGlvbmFsSGVhZGVycyB8fCB7fSwgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QsIGFsbEhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgIGlmICghaXNYZHIoeGhyKSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuYWNjZXB0SGVhZGVyICYmIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsIG9wdGlvbnMuYWNjZXB0SGVhZGVyKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hbGxvd1hSZXF1ZXN0ZWRXaXRoQW5kQ2FjaGVDb250cm9sKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb3JzLmV4cGVjdGVkIHx8ICghaXNTaW1wbGVNZXRob2QoKSB8fCBjb250YWluc05vblNpbXBsZUhlYWRlcnMoY3VzdG9tSGVhZGVycykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ2FjaGUtQ29udHJvbFwiLCBcIm5vLWNhY2hlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbnRlbnRUeXBlICYmIChtZXRob2QgPT09IFwiUE9TVFwiIHx8IG1ldGhvZCA9PT0gXCJQVVRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgb3B0aW9ucy5jb250ZW50VHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChhbGxIZWFkZXJzLCBxcS5pc0Z1bmN0aW9uKGN1c3RvbUhlYWRlcnMpID8gY3VzdG9tSGVhZGVycyhpZCkgOiBjdXN0b21IZWFkZXJzKTtcbiAgICAgICAgICAgICAgICBxcS5leHRlbmQoYWxsSGVhZGVycywgb25EZW1hbmRIZWFkZXJzKTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGFsbEhlYWRlcnMsIGZ1bmN0aW9uKG5hbWUsIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzUmVzcG9uc2VTdWNjZXNzZnVsKHJlc3BvbnNlQ29kZSkge1xuICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2Yob3B0aW9ucy5zdWNjZXNzZnVsUmVzcG9uc2VDb2Rlc1tvcHRpb25zLm1ldGhvZF0sIHJlc3BvbnNlQ29kZSkgPj0gMDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBwcmVwYXJlVG9TZW5kKGlkLCBvcHRYaHIsIGFkZFRvUGF0aCwgYWRkaXRpb25hbFBhcmFtcywgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zLCBhZGRpdGlvbmFsSGVhZGVycywgcGF5bG9hZCkge1xuICAgICAgICAgICAgcmVxdWVzdERhdGFbaWRdID0ge1xuICAgICAgICAgICAgICAgIGFkZFRvUGF0aDogYWRkVG9QYXRoLFxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQYXJhbXM6IGFkZGl0aW9uYWxQYXJhbXMsXG4gICAgICAgICAgICAgICAgYWRkaXRpb25hbFF1ZXJ5UGFyYW1zOiBhZGRpdGlvbmFsUXVlcnlQYXJhbXMsXG4gICAgICAgICAgICAgICAgYWRkaXRpb25hbEhlYWRlcnM6IGFkZGl0aW9uYWxIZWFkZXJzLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgbGVuID0gcXVldWUucHVzaChpZCk7XG4gICAgICAgICAgICBpZiAobGVuIDw9IG9wdGlvbnMubWF4Q29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VuZFJlcXVlc3QoaWQsIG9wdFhocik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2hvdWxkUGFyYW1zQmVJblF1ZXJ5U3RyaW5nID0gb3B0aW9ucy5tZXRob2QgPT09IFwiR0VUXCIgfHwgb3B0aW9ucy5tZXRob2QgPT09IFwiREVMRVRFXCI7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBpbml0VHJhbnNwb3J0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXRoLCBwYXJhbXMsIGhlYWRlcnMsIHBheWxvYWQsIGNhY2hlQnVzdGVyLCBhZGRpdGlvbmFsUXVlcnlQYXJhbXM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgd2l0aFBhdGg6IGZ1bmN0aW9uKGFwcGVuZFRvUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGFwcGVuZFRvUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aXRoUGFyYW1zOiBmdW5jdGlvbihhZGRpdGlvbmFsUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBhZGRpdGlvbmFsUGFyYW1zO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHdpdGhRdWVyeVBhcmFtczogZnVuY3Rpb24oX2FkZGl0aW9uYWxRdWVyeVBhcmFtc18pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxRdWVyeVBhcmFtcyA9IF9hZGRpdGlvbmFsUXVlcnlQYXJhbXNfO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHdpdGhIZWFkZXJzOiBmdW5jdGlvbihhZGRpdGlvbmFsSGVhZGVycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IGFkZGl0aW9uYWxIZWFkZXJzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHdpdGhQYXlsb2FkOiBmdW5jdGlvbih0aGVQYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0gdGhlUGF5bG9hZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aXRoQ2FjaGVCdXN0ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVCdXN0ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNlbmQ6IGZ1bmN0aW9uKG9wdFhocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlQnVzdGVyICYmIHFxLmluZGV4T2YoWyBcIkdFVFwiLCBcIkRFTEVURVwiIF0sIG9wdGlvbnMubWV0aG9kKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnFxdGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJlcGFyZVRvU2VuZChpZCwgb3B0WGhyLCBwYXRoLCBwYXJhbXMsIGFkZGl0aW9uYWxRdWVyeVBhcmFtcywgaGVhZGVycywgcGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbmNlbGVkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGRlcXVldWUoaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlVwbG9hZEhhbmRsZXIgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgcHJveHkgPSBzcGVjLnByb3h5LCBmaWxlU3RhdGUgPSB7fSwgb25DYW5jZWwgPSBwcm94eS5vbkNhbmNlbCwgZ2V0TmFtZSA9IHByb3h5LmdldE5hbWU7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGlkLCBmaWxlSXRlbSkge1xuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZVtpZF0gPSBmaWxlSXRlbTtcbiAgICAgICAgICAgICAgICBmaWxlU3RhdGVbaWRdLnRlbXAgPSB7fTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBjYW5jZWxGaW5hbGl6YXRpb25FZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpLCBvbkNhbmNlbFJldFZhbCA9IG9uQ2FuY2VsKGlkLCBnZXROYW1lKGlkKSwgY2FuY2VsRmluYWxpemF0aW9uRWZmb3J0KTtcbiAgICAgICAgICAgICAgICBvbkNhbmNlbFJldFZhbC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN0YXRlW2lkXS5jYW5jZWxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEZpbmFsaXphdGlvbkVmZm9ydC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhwdW5nZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgZmlsZVN0YXRlW2lkXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRUaGlyZFBhcnR5RmlsZUlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlU3RhdGVbaWRdLmtleTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1ZhbGlkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlU3RhdGVbaWRdICE9PSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZpbGVTdGF0ZSA9IHt9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRGaWxlU3RhdGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVTdGF0ZVtpZF07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NldFRoaXJkUGFydHlGaWxlSWQ6IGZ1bmN0aW9uKGlkLCB0aGlyZFBhcnR5RmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgZmlsZVN0YXRlW2lkXS5rZXkgPSB0aGlyZFBhcnR5RmlsZUlkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF93YXNDYW5jZWxlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISFmaWxlU3RhdGVbaWRdLmNhbmNlbGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlVwbG9hZEhhbmRsZXJDb250cm9sbGVyID0gZnVuY3Rpb24obywgbmFtZXNwYWNlKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgY29udHJvbGxlciA9IHRoaXMsIGNodW5raW5nUG9zc2libGUgPSBmYWxzZSwgY29uY3VycmVudENodW5raW5nUG9zc2libGUgPSBmYWxzZSwgY2h1bmtpbmcsIHByZXZlbnRSZXRyeVJlc3BvbnNlLCBsb2csIGhhbmRsZXIsIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBwYXJhbXNTdG9yZToge30sXG4gICAgICAgICAgICBtYXhDb25uZWN0aW9uczogMyxcbiAgICAgICAgICAgIGNodW5raW5nOiB7XG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7fSxcbiAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgbG9hZGVkLCB0b3RhbCkge30sXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUsIHJlc3BvbnNlLCB4aHIpIHt9LFxuICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSkge30sXG4gICAgICAgICAgICBvblVwbG9hZFByZXA6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIG9uVXBsb2FkOiBmdW5jdGlvbihpZCwgZmlsZU5hbWUpIHt9LFxuICAgICAgICAgICAgb25VcGxvYWRDaHVuazogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCBjaHVua0RhdGEpIHt9LFxuICAgICAgICAgICAgb25VcGxvYWRDaHVua1N1Y2Nlc3M6IGZ1bmN0aW9uKGlkLCBjaHVua0RhdGEsIHJlc3BvbnNlLCB4aHIpIHt9LFxuICAgICAgICAgICAgb25BdXRvUmV0cnk6IGZ1bmN0aW9uKGlkLCBmaWxlTmFtZSwgcmVzcG9uc2UsIHhocikge30sXG4gICAgICAgICAgICBvblJlc3VtZTogZnVuY3Rpb24oaWQsIGZpbGVOYW1lLCBjaHVua0RhdGEsIGN1c3RvbVJlc3VtZURhdGEpIHt9LFxuICAgICAgICAgICAgb25VdWlkQ2hhbmdlZDogZnVuY3Rpb24oaWQsIG5ld1V1aWQpIHt9LFxuICAgICAgICAgICAgZ2V0TmFtZTogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgc2V0U2l6ZTogZnVuY3Rpb24oaWQsIG5ld1NpemUpIHt9LFxuICAgICAgICAgICAgaXNRdWV1ZWQ6IGZ1bmN0aW9uKGlkKSB7fSxcbiAgICAgICAgICAgIGdldElkc0luUHJveHlHcm91cDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgZ2V0SWRzSW5CYXRjaDogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgaXNJblByb2dyZXNzOiBmdW5jdGlvbihpZCkge31cbiAgICAgICAgfSwgY2h1bmtlZCA9IHtcbiAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uKGlkLCBjaHVua0lkeCwgcmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBjaHVua0RhdGEgPSBoYW5kbGVyLl9nZXRDaHVua0RhdGEoaWQsIGNodW5rSWR4KTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmF0dGVtcHRpbmdSZXN1bWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBkZWxldGUgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmNodW5rUHJvZ3Jlc3NbY2h1bmtJZHhdO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkubG9hZGVkICs9IGNodW5rRGF0YS5zaXplO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMub25VcGxvYWRDaHVua1N1Y2Nlc3MoaWQsIGhhbmRsZXIuX2dldENodW5rRGF0YUZvckNhbGxiYWNrKGNodW5rRGF0YSksIHJlc3BvbnNlLCB4aHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5nZXRTaXplKGlkKSwgbmFtZSA9IG9wdGlvbnMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgbG9nKFwiQWxsIGNodW5rcyBoYXZlIGJlZW4gdXBsb2FkZWQgZm9yIFwiICsgaWQgKyBcIiAtIGZpbmFsaXppbmcuLi4uXCIpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuZmluYWxpemVDaHVua3MoaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJGaW5hbGl6ZSBzdWNjZXNzZnVsIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vcm1haXplZFJlc3BvbnNlID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vblByb2dyZXNzKGlkLCBuYW1lLCBzaXplLCBzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fbWF5YmVEZWxldGVQZXJzaXN0ZWRDaHVua0RhdGEoaWQpO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgbm9ybWFpemVkUmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9ybWFsaXplZFJlc3BvbnNlID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gZmluYWxpemluZyBjaHVua3MgZm9yIGZpbGUgSUQgXCIgKyBpZCArIFwiIC0gXCIgKyBub3JtYWxpemVkUmVzcG9uc2UuZXJyb3IsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkUmVzcG9uc2UucmVzZXQgfHwgeGhyICYmIG9wdGlvbnMuY2h1bmtpbmcuc3VjY2Vzcy5yZXNldE9uU3RhdHVzLmluZGV4T2YoeGhyLnN0YXR1cykgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5yZXNldChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLm9uQXV0b1JldHJ5KGlkLCBuYW1lLCBub3JtYWxpemVkUmVzcG9uc2UsIHhocikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCBub3JtYWxpemVkUmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYW5kbGVGYWlsdXJlOiBmdW5jdGlvbihjaHVua0lkeCwgaWQsIHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IG9wdGlvbnMuZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICAgICAgbG9nKFwiQ2h1bmtlZCB1cGxvYWQgcmVxdWVzdCBmYWlsZWQgZm9yIFwiICsgaWQgKyBcIiwgY2h1bmsgXCIgKyBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5jbGVhckNhY2hlZENodW5rKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlVG9SZXBvcnQgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UocmVzcG9uc2UsIGZhbHNlKSwgaW5Qcm9ncmVzc0lkeDtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VUb1JlcG9ydC5yZXNldCkge1xuICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnJlc2V0KGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5Qcm9ncmVzc0NodW5rc0FycmF5ID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5pblByb2dyZXNzO1xuICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzSWR4ID0gaW5Qcm9ncmVzc0NodW5rc0FycmF5ID8gcXEuaW5kZXhPZihpblByb2dyZXNzQ2h1bmtzQXJyYXksIGNodW5rSWR4KSA6IC0xO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5Qcm9ncmVzc0lkeCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLmluUHJvZ3Jlc3Muc3BsaWNlKGluUHJvZ3Jlc3NJZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5yZW1haW5pbmcudW5zaGlmdChjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuaWdub3JlRmFpbHVyZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uY3VycmVudENodW5raW5nUG9zc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5pZ25vcmVGYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJHb2luZyB0byBhdHRlbXB0IHRvIGFib3J0IHRoZXNlIGNodW5rczoge30uIFRoZXNlIGFyZSBjdXJyZW50bHkgaW4tcHJvZ3Jlc3M6IHt9LlwiLCBKU09OLnN0cmluZ2lmeShPYmplY3Qua2V5cyhoYW5kbGVyLl9nZXRYaHJzKGlkKSkpLCBKU09OLnN0cmluZ2lmeShoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLmluUHJvZ3Jlc3MpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGhhbmRsZXIuX2dldFhocnMoaWQpLCBmdW5jdGlvbihja2lkLCBja1hocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJBdHRlbXB0aW5nIHRvIGFib3J0IGZpbGUge30ue30uIFhIUiByZWFkeVN0YXRlIHt9LiBcIiwgaWQsIGNraWQsIGNrWGhyLnJlYWR5U3RhdGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBja1hoci5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNrWGhyLl9jYW5jZWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLm1vdmVJblByb2dyZXNzVG9SZW1haW5pbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuZnJlZShpZCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLm9uQXV0b1JldHJ5KGlkLCBuYW1lLCByZXNwb25zZVRvUmVwb3J0LCB4aHIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgcmVzcG9uc2VUb1JlcG9ydCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNNb3JlUGFydHM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5yZW1haW5pbmcubGVuZ3RoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5leHRQYXJ0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0SWR4ID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5jaHVua2luZy5yZW1haW5pbmcuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dElkeCA+PSBoYW5kbGVyLl9nZXRUb3RhbENodW5rcyhpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dElkeCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0SWR4O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIlNlcnZlciBvciBjYWxsYmFjayBoYXMgb3JkZXJlZCBjaHVua2luZyBlZmZvcnQgdG8gYmUgcmVzdGFydGVkIG9uIG5leHQgYXR0ZW1wdCBmb3IgaXRlbSBJRCBcIiArIGlkLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX21heWJlRGVsZXRlUGVyc2lzdGVkQ2h1bmtEYXRhKGlkKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLnJlZXZhbHVhdGVDaHVua2luZyhpZCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5sb2FkZWQgPSAwO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuYXR0ZW1wdGluZ1Jlc3VtZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmROZXh0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5nZXRTaXplKGlkKSwgbmFtZSA9IG9wdGlvbnMuZ2V0TmFtZShpZCksIGNodW5rSWR4ID0gY2h1bmtlZC5uZXh0UGFydChpZCksIGNodW5rRGF0YSA9IGhhbmRsZXIuX2dldENodW5rRGF0YShpZCwgY2h1bmtJZHgpLCBmaWxlU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLCByZXN1bWluZyA9IGZpbGVTdGF0ZS5hdHRlbXB0aW5nUmVzdW1lLCBpblByb2dyZXNzQ2h1bmtzID0gZmlsZVN0YXRlLmNodW5raW5nLmluUHJvZ3Jlc3MgfHwgW107XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVTdGF0ZS5sb2FkZWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlU3RhdGUubG9hZGVkID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtaW5nICYmIG9wdGlvbnMub25SZXN1bWUoaWQsIG5hbWUsIGNodW5rRGF0YSwgZmlsZVN0YXRlLmN1c3RvbVJlc3VtZURhdGEpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBjaHVua2VkLnJlc2V0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtJZHggPSBjaHVua2VkLm5leHRQYXJ0KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtEYXRhID0gaGFuZGxlci5fZ2V0Q2h1bmtEYXRhKGlkLCBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VtaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjaHVua0lkeCA9PSBudWxsICYmIGluUHJvZ3Jlc3NDaHVua3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rZWQuZmluYWxpemUoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3NDaHVua3MucHVzaChjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcuaW5Qcm9ncmVzcyA9IGluUHJvZ3Jlc3NDaHVua3M7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIub3BlbihpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSAmJiBjb25uZWN0aW9uTWFuYWdlci5hdmFpbGFibGUoKSAmJiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nLnJlbWFpbmluZy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuc2VuZE5leHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHVua0RhdGEuYmxvYi5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiQ2h1bmsge30gZm9yIGZpbGUge30gd2lsbCBub3QgYmUgdXBsb2FkZWQsIHplcm8gc2l6ZWQgY2h1bmsuXCIsIGNodW5rSWR4LCBpZCksIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmhhbmRsZUZhaWx1cmUoY2h1bmtJZHgsIGlkLCBcIkZpbGUgaXMgbm8gbG9uZ2VyIGF2YWlsYWJsZVwiLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgb25VcGxvYWRDaHVua1Byb21pc2UgPSBvcHRpb25zLm9uVXBsb2FkQ2h1bmsoaWQsIG5hbWUsIGhhbmRsZXIuX2dldENodW5rRGF0YUZvckNhbGxiYWNrKGNodW5rRGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZENodW5rUHJvbWlzZS50aGVuKGZ1bmN0aW9uKHJlcXVlc3RPdmVycmlkZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5pc0luUHJvZ3Jlc3MoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIk5vdCBzZW5kaW5nIGNodW5rZWQgdXBsb2FkIHJlcXVlc3QgZm9yIGl0ZW0ge30ue30gLSBubyBsb25nZXIgaW4gcHJvZ3Jlc3MuXCIsIGlkLCBjaHVua0lkeCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiU2VuZGluZyBjaHVua2VkIHVwbG9hZCByZXF1ZXN0IGZvciBpdGVtIHt9Lnt9LCBieXRlcyB7fS17fSBvZiB7fS5cIiwgaWQsIGNodW5rSWR4LCBjaHVua0RhdGEuc3RhcnQgKyAxLCBjaHVua0RhdGEuZW5kLCBzaXplKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVwbG9hZENodW5rRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtJZHg6IGNodW5rSWR4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlczogcmVxdWVzdE92ZXJyaWRlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdW1pbmc6IHJlc3VtaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnVwbG9hZENodW5rKHVwbG9hZENodW5rRGF0YSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiQ2h1bmtlZCB1cGxvYWQgcmVxdWVzdCBzdWNjZWVkZWQgZm9yIFwiICsgaWQgKyBcIiwgY2h1bmsgXCIgKyBjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuY2xlYXJDYWNoZWRDaHVuayhpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5Qcm9ncmVzc0NodW5rcyA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkuY2h1bmtpbmcuaW5Qcm9ncmVzcyB8fCBbXSwgcmVzcG9uc2VUb1JlcG9ydCA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgdHJ1ZSksIGluUHJvZ3Jlc3NDaHVua0lkeCA9IHFxLmluZGV4T2YoaW5Qcm9ncmVzc0NodW5rcywgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiQ2h1bmsge30gZm9yIGZpbGUge30gdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5LlwiLCBjaHVua0lkeCwgaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5kb25lKGlkLCBjaHVua0lkeCwgcmVzcG9uc2VUb1JlcG9ydCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluUHJvZ3Jlc3NDaHVua0lkeCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzQ2h1bmtzLnNwbGljZShpblByb2dyZXNzQ2h1bmtJZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX21heWJlUGVyc2lzdENodW5rZWRTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2h1bmtlZC5oYXNNb3JlUGFydHMoaWQpICYmIGluUHJvZ3Jlc3NDaHVua3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkLmZpbmFsaXplKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaHVua2VkLmhhc01vcmVQYXJ0cyhpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWQuc2VuZE5leHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkZpbGUgSUQge30gaGFzIG5vIG1vcmUgY2h1bmtzIHRvIHNlbmQgYW5kIHRoZXNlIGNodW5rIGluZGV4ZXMgYXJlIHN0aWxsIG1hcmtlZCBhcyBpbi1wcm9ncmVzczoge31cIiwgaWQsIEpTT04uc3RyaW5naWZ5KGluUHJvZ3Jlc3NDaHVua3MpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBmYWlsdXJlKHJlc3BvbnNlLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5oYW5kbGVGYWlsdXJlKGNodW5rSWR4LCBpZCwgcmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5jbGVhclhocihpZCwgY2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5oYW5kbGVGYWlsdXJlKGNodW5rSWR4LCBpZCwgZXJyb3IsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGNvbm5lY3Rpb25NYW5hZ2VyID0ge1xuICAgICAgICAgICAgX29wZW46IFtdLFxuICAgICAgICAgICAgX29wZW5DaHVua3M6IHt9LFxuICAgICAgICAgICAgX3dhaXRpbmc6IFtdLFxuICAgICAgICAgICAgYXZhaWxhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4ID0gb3B0aW9ucy5tYXhDb25uZWN0aW9ucywgb3BlbkNodW5rRW50cmllc0NvdW50ID0gMCwgb3BlbkNodW5rc0NvdW50ID0gMDtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzLCBmdW5jdGlvbihmaWxlSWQsIG9wZW5DaHVua0luZGV4ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbkNodW5rRW50cmllc0NvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIG9wZW5DaHVua3NDb3VudCArPSBvcGVuQ2h1bmtJbmRleGVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF4IC0gKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLmxlbmd0aCAtIG9wZW5DaHVua0VudHJpZXNDb3VudCArIG9wZW5DaHVua3NDb3VudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnJlZTogZnVuY3Rpb24oaWQsIGRvbnRBbGxvd05leHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWxsb3dOZXh0ID0gIWRvbnRBbGxvd05leHQsIHdhaXRpbmdJbmRleCA9IHFxLmluZGV4T2YoY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcsIGlkKSwgY29ubmVjdGlvbnNJbmRleCA9IHFxLmluZGV4T2YoY29ubmVjdGlvbk1hbmFnZXIuX29wZW4sIGlkKSwgbmV4dElkO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rc1tpZF07XG4gICAgICAgICAgICAgICAgaWYgKHVwbG9hZC5nZXRQcm94eU9yQmxvYihpZCkgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiR2VuZXJhdGVkIGJsb2IgdXBsb2FkIGhhcyBlbmRlZCBmb3IgXCIgKyBpZCArIFwiLCBkaXNwb3NpbmcgZ2VuZXJhdGVkIGJsb2IuXCIpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5maWxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod2FpdGluZ0luZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcuc3BsaWNlKHdhaXRpbmdJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbGxvd05leHQgJiYgY29ubmVjdGlvbnNJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuLnNwbGljZShjb25uZWN0aW9uc0luZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dElkID0gY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRJZCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fb3Blbi5wdXNoKG5leHRJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuc3RhcnQobmV4dElkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRXYWl0aW5nT3JDb25uZWN0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciB3YWl0aW5nT3JDb25uZWN0ZWQgPSBbXTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzLCBmdW5jdGlvbihmaWxlSWQsIGNodW5rcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmtzICYmIGNodW5rcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRpbmdPckNvbm5lY3RlZC5wdXNoKHBhcnNlSW50KGZpbGVJZCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcXEuZWFjaChjb25uZWN0aW9uTWFuYWdlci5fb3BlbiwgZnVuY3Rpb24oaWR4LCBmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25uZWN0aW9uTWFuYWdlci5fb3BlbkNodW5rc1tmaWxlSWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YWl0aW5nT3JDb25uZWN0ZWQucHVzaChwYXJzZUludChmaWxlSWQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHdhaXRpbmdPckNvbm5lY3RlZCA9IHdhaXRpbmdPckNvbm5lY3RlZC5jb25jYXQoY29ubmVjdGlvbk1hbmFnZXIuX3dhaXRpbmcpO1xuICAgICAgICAgICAgICAgIHJldHVybiB3YWl0aW5nT3JDb25uZWN0ZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNVc2luZ0Nvbm5lY3Rpb246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2YoY29ubmVjdGlvbk1hbmFnZXIuX29wZW4sIGlkKSA+PSAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKGlkLCBjaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIGlmIChjaHVua0lkeCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbk1hbmFnZXIuYXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rSWR4ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl93YWl0aW5nLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX29wZW4ucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wZW5DaHVua3NFbnRyeSA9IGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuQ2h1bmtzW2lkXSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuQ2h1bmtzRW50cnkucHVzaChjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIuX29wZW5DaHVua3NbaWRdID0gb3BlbkNodW5rc0VudHJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5fd2FpdGluZyA9IFtdO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLl9vcGVuID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHNpbXBsZSA9IHtcbiAgICAgICAgICAgIHNlbmQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWxlU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiSWdub3Jpbmcgc2VuZCByZXF1ZXN0IGFzIHRoaXMgdXBsb2FkIG1heSBoYXZlIGJlZW4gY2FuY2VsbGVkLCBGaWxlIElEIFwiICsgaWQsIFwid2FyblwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWxlU3RhdGUubG9hZGVkID0gMDtcbiAgICAgICAgICAgICAgICBsb2coXCJTZW5kaW5nIHNpbXBsZSB1cGxvYWQgcmVxdWVzdCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci51cGxvYWRGaWxlKGlkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlLCBvcHRYaHIpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiU2ltcGxlIHVwbG9hZCByZXF1ZXN0IHN1Y2NlZWRlZCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZVRvUmVwb3J0ID0gdXBsb2FkLm5vcm1hbGl6ZVJlc3BvbnNlKHJlc3BvbnNlLCB0cnVlKSwgc2l6ZSA9IG9wdGlvbnMuZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25Qcm9ncmVzcyhpZCwgbmFtZSwgc2l6ZSwgc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5tYXliZU5ld1V1aWQoaWQsIHJlc3BvbnNlVG9SZXBvcnQpO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgcmVzcG9uc2VUb1JlcG9ydCwgb3B0WGhyKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSwgb3B0WGhyKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlNpbXBsZSB1cGxvYWQgcmVxdWVzdCBmYWlsZWQgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VUb1JlcG9ydCA9IHVwbG9hZC5ub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMub25BdXRvUmV0cnkoaWQsIG5hbWUsIHJlc3BvbnNlVG9SZXBvcnQsIG9wdFhocikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZC5jbGVhbnVwKGlkLCByZXNwb25zZVRvUmVwb3J0LCBvcHRYaHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHVwbG9hZCA9IHtcbiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJDYW5jZWxsaW5nIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucGFyYW1zU3RvcmUucmVtb3ZlKGlkKTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGVhbnVwOiBmdW5jdGlvbihpZCwgcmVzcG9uc2UsIG9wdFhocikge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gb3B0aW9ucy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uQ29tcGxldGUoaWQsIG5hbWUsIHJlc3BvbnNlLCBvcHRYaHIpO1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2NsZWFyWGhycyAmJiBoYW5kbGVyLl9jbGVhclhocnMoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQcm94eU9yQmxvYjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRQcm94eSAmJiBoYW5kbGVyLmdldFByb3h5KGlkKSB8fCBoYW5kbGVyLmdldEZpbGUgJiYgaGFuZGxlci5nZXRGaWxlKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbml0SGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhhbmRsZXJUeXBlID0gbmFtZXNwYWNlID8gcXFbbmFtZXNwYWNlXSA6IHFxLnRyYWRpdGlvbmFsLCBoYW5kbGVyTW9kdWxlU3VidHlwZSA9IHFxLnN1cHBvcnRlZEZlYXR1cmVzLmFqYXhVcGxvYWRpbmcgPyBcIlhoclwiIDogXCJGb3JtXCI7XG4gICAgICAgICAgICAgICAgaGFuZGxlciA9IG5ldyBoYW5kbGVyVHlwZVtoYW5kbGVyTW9kdWxlU3VidHlwZSArIFwiVXBsb2FkSGFuZGxlclwiXShvcHRpb25zLCB7XG4gICAgICAgICAgICAgICAgICAgIGdldEN1c3RvbVJlc3VtZURhdGE6IG9wdGlvbnMuZ2V0Q3VzdG9tUmVzdW1lRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YUJ5VXVpZDogb3B0aW9ucy5nZXREYXRhQnlVdWlkLFxuICAgICAgICAgICAgICAgICAgICBnZXROYW1lOiBvcHRpb25zLmdldE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGdldFNpemU6IG9wdGlvbnMuZ2V0U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXVpZDogb3B0aW9ucy5nZXRVdWlkLFxuICAgICAgICAgICAgICAgICAgICBsb2c6IGxvZyxcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IG9wdGlvbnMub25DYW5jZWwsXG4gICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3M6IG9wdGlvbnMub25Qcm9ncmVzcyxcbiAgICAgICAgICAgICAgICAgICAgb25VdWlkQ2hhbmdlZDogb3B0aW9ucy5vblV1aWRDaGFuZ2VkLFxuICAgICAgICAgICAgICAgICAgICBvbkZpbmFsaXppbmc6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlVQTE9BRF9GSU5BTElaSU5HKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLl9yZW1vdmVFeHBpcmVkQ2h1bmtpbmdSZWNvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX3JlbW92ZUV4cGlyZWRDaHVua2luZ1JlY29yZHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNEZWZlcnJlZEVsaWdpYmxlRm9yVXBsb2FkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmlzUXVldWVkKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXliZURlZmVyOiBmdW5jdGlvbihpZCwgYmxvYikge1xuICAgICAgICAgICAgICAgIGlmIChibG9iICYmICFoYW5kbGVyLmdldEZpbGUoaWQpICYmIGJsb2IgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vblVwbG9hZFByZXAoaWQpO1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJBdHRlbXB0aW5nIHRvIGdlbmVyYXRlIGEgYmxvYiBvbi1kZW1hbmQgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgICAgICBibG9iLmNyZWF0ZSgpLnRoZW4oZnVuY3Rpb24oZ2VuZXJhdGVkQmxvYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiR2VuZXJhdGVkIGFuIG9uLWRlbWFuZCBibG9iIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIudXBkYXRlQmxvYihpZCwgZ2VuZXJhdGVkQmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNldFNpemUoaWQsIGdlbmVyYXRlZEJsb2Iuc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLnJlZXZhbHVhdGVDaHVua2luZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQubWF5YmVTZW5kRGVmZXJyZWRGaWxlcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlLmVycm9yID0gZXJyb3JNZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkZhaWxlZCB0byBnZW5lcmF0ZSBibG9iIGZvciBJRCB7fS4gIEVycm9yIG1lc3NhZ2U6IHt9LlwiLCBpZCwgZXJyb3JNZXNzYWdlKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25Db21wbGV0ZShpZCwgb3B0aW9ucy5nZXROYW1lKGlkKSwgcXEuZXh0ZW5kKGVycm9yUmVzcG9uc2UsIHByZXZlbnRSZXRyeVJlc3BvbnNlKSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQubWF5YmVTZW5kRGVmZXJyZWRGaWxlcyhpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZC5tYXliZVNlbmREZWZlcnJlZEZpbGVzKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1heWJlU2VuZERlZmVycmVkRmlsZXM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkc0luR3JvdXAgPSBvcHRpb25zLmdldElkc0luUHJveHlHcm91cChpZCksIHVwbG9hZGVkVGhpc0lkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKGlkc0luR3JvdXAgJiYgaWRzSW5Hcm91cC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiTWF5YmUgcmVhZHkgdG8gdXBsb2FkIHByb3h5IGdyb3VwIGZpbGUgXCIgKyBpZCk7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goaWRzSW5Hcm91cCwgZnVuY3Rpb24oaWR4LCBpZEluR3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWQuaXNEZWZlcnJlZEVsaWdpYmxlRm9yVXBsb2FkKGlkSW5Hcm91cCkgJiYgISFoYW5kbGVyLmdldEZpbGUoaWRJbkdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZGVkVGhpc0lkID0gaWRJbkdyb3VwID09PSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQubm93KGlkSW5Hcm91cCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVwbG9hZC5pc0RlZmVycmVkRWxpZ2libGVGb3JVcGxvYWQoaWRJbkdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkZWRUaGlzSWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQubm93KGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZGVkVGhpc0lkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1heWJlTmV3VXVpZDogZnVuY3Rpb24oaWQsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm5ld1V1aWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm9uVXVpZENoYW5nZWQoaWQsIHJlc3BvbnNlLm5ld1V1aWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBub3JtYWxpemVSZXNwb25zZTogZnVuY3Rpb24ob3JpZ2luYWxSZXNwb25zZSwgc3VjY2Vzc2Z1bCkge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG9yaWdpbmFsUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgaWYgKCFxcS5pc09iamVjdChvcmlnaW5hbFJlc3BvbnNlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcob3JpZ2luYWxSZXNwb25zZSkgJiYgIXN1Y2Nlc3NmdWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yID0gb3JpZ2luYWxSZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gc3VjY2Vzc2Z1bDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbm93OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gb3B0aW9ucy5nZXROYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xsZXIuaXNWYWxpZChpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKGlkICsgXCIgaXMgbm90IGEgdmFsaWQgZmlsZSBJRCB0byB1cGxvYWQhXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvcHRpb25zLm9uVXBsb2FkKGlkLCBuYW1lKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5wYXVzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zZXRTdGF0dXMoaWQsIHFxLnN0YXR1cy5QQVVTRUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5wYXVzZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaHVua2luZ1Bvc3NpYmxlICYmIGhhbmRsZXIuX3Nob3VsZENodW5rVGhpc0ZpbGUoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZC5zZW5kTmV4dChpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZS5zZW5kKGlkLCBuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gZXJyb3IgfHwge307XG4gICAgICAgICAgICAgICAgICAgIGxvZyhpZCArIFwiIHVwbG9hZCBzdGFydCBhYm9ydGVkIGR1ZSB0byByZWplY3RlZCBvblVwbG9hZCBQcm9taXNlIC0gZGV0YWlsczogXCIgKyBlcnJvciwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLm9uQXV0b1JldHJ5KGlkLCBuYW1lLCBlcnJvci5yZXNwb25zZUpTT04gfHwge30pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB1cGxvYWQubm9ybWFsaXplUmVzcG9uc2UoZXJyb3IucmVzcG9uc2VKU09OLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2xlYW51cChpZCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJsb2JUb1VwbG9hZCA9IHVwbG9hZC5nZXRQcm94eU9yQmxvYihpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGJsb2JUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLm1heWJlRGVmZXIoaWQsIGJsb2JUb1VwbG9hZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkLm5vdyhpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oaWQsIGZpbGUpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLmFkZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbk1hbmFnZXIub3BlbihpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZC5zdGFydChpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uY3VycmVudENodW5raW5nUG9zc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLmlnbm9yZUZhaWx1cmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25NYW5hZ2VyLmlzVXNpbmdDb25uZWN0aW9uKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLnN0YXJ0KGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbGxlci51cGxvYWQoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbmNlbFJldFZhbCA9IGhhbmRsZXIuY2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNHZW5lcmljUHJvbWlzZShjYW5jZWxSZXRWYWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbFJldFZhbC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkLmNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FuY2VsUmV0VmFsICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQuY2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FuY2VsQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgd2FpdGluZ09yQ29ubmVjdGVkID0gY29ubmVjdGlvbk1hbmFnZXIuZ2V0V2FpdGluZ09yQ29ubmVjdGVkKCksIGk7XG4gICAgICAgICAgICAgICAgaWYgKHdhaXRpbmdPckNvbm5lY3RlZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gd2FpdGluZ09yQ29ubmVjdGVkLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLmNhbmNlbCh3YWl0aW5nT3JDb25uZWN0ZWRbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25NYW5hZ2VyLnJlc2V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5nZXRQcm94eSAmJiBoYW5kbGVyLmdldFByb3h5KGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRQcm94eShpZCkucmVmZXJlbmNlQmxvYjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0RmlsZSAmJiBoYW5kbGVyLmdldEZpbGUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUHJveGllZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISEoaGFuZGxlci5nZXRQcm94eSAmJiBoYW5kbGVyLmdldFByb3h5KGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5wdXQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuZ2V0SW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0SW5wdXQoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiUmVzZXR0aW5nIHVwbG9hZCBoYW5kbGVyXCIpO1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2FuY2VsQWxsKCk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbk1hbmFnZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLnJlc2V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhwdW5nZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5leHB1bmdlKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNWYWxpZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5pc1ZhbGlkKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNSZXN1bWVSZWNvcmQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IGhhbmRsZXIuaXNWYWxpZChpZCkgJiYgaGFuZGxlci5fZ2V0TG9jYWxTdG9yYWdlSWQgJiYgaGFuZGxlci5fZ2V0TG9jYWxTdG9yYWdlSWQoaWQpO1xuICAgICAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlc3VtYWJsZUZpbGVzRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuZ2V0UmVzdW1hYmxlRmlsZXNEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLmdldFJlc3VtYWJsZUZpbGVzRGF0YSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VGhpcmRQYXJ0eUZpbGVJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5nZXRUaGlyZFBhcnR5RmlsZUlkKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIuaXNSZXN1bWFibGUoaWQpICYmIGhhbmRsZXIucGF1c2UgJiYgY29udHJvbGxlci5pc1ZhbGlkKGlkKSAmJiBoYW5kbGVyLnBhdXNlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uTWFuYWdlci5mcmVlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5tb3ZlSW5Qcm9ncmVzc1RvUmVtYWluaW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0F0dGVtcHRpbmdSZXN1bWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhaGFuZGxlci5pc0F0dGVtcHRpbmdSZXN1bWUgJiYgaGFuZGxlci5pc0F0dGVtcHRpbmdSZXN1bWUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUmVzdW1hYmxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIWhhbmRsZXIuaXNSZXN1bWFibGUgJiYgaGFuZGxlci5pc1Jlc3VtYWJsZShpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIGxvZyA9IG9wdGlvbnMubG9nO1xuICAgICAgICBjaHVua2luZ1Bvc3NpYmxlID0gb3B0aW9ucy5jaHVua2luZy5lbmFibGVkICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmNodW5raW5nO1xuICAgICAgICBjb25jdXJyZW50Q2h1bmtpbmdQb3NzaWJsZSA9IGNodW5raW5nUG9zc2libGUgJiYgb3B0aW9ucy5jaHVua2luZy5jb25jdXJyZW50LmVuYWJsZWQ7XG4gICAgICAgIHByZXZlbnRSZXRyeVJlc3BvbnNlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7fTtcbiAgICAgICAgICAgIHJlc3BvbnNlW29wdGlvbnMucHJldmVudFJldHJ5UGFyYW1dID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSgpO1xuICAgICAgICB1cGxvYWQuaW5pdEhhbmRsZXIoKTtcbiAgICB9O1xuICAgIHFxLldpbmRvd1JlY2VpdmVNZXNzYWdlID0gZnVuY3Rpb24obykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7fVxuICAgICAgICB9LCBjYWxsYmFja1dyYXBwZXJEZXRhY2hlcnMgPSB7fTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcmVjZWl2ZU1lc3NhZ2U6IGZ1bmN0aW9uKGlkLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHZhciBvbk1lc3NhZ2VDYWxsYmFja1dyYXBwZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhldmVudC5kYXRhKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cucG9zdE1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tXcmFwcGVyRGV0YWNoZXJzW2lkXSA9IHFxKHdpbmRvdykuYXR0YWNoKFwibWVzc2FnZVwiLCBvbk1lc3NhZ2VDYWxsYmFja1dyYXBwZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcImlmcmFtZSBtZXNzYWdlIHBhc3Npbmcgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXIhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0b3BSZWNlaXZpbmdNZXNzYWdlczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LnBvc3RNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZXRhY2hlciA9IGNhbGxiYWNrV3JhcHBlckRldGFjaGVyc1tpZF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXRhY2hlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWNoZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5Gb3JtVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBvcHRpb25zID0gc3BlYy5vcHRpb25zLCBoYW5kbGVyID0gdGhpcywgcHJveHkgPSBzcGVjLnByb3h5LCBmb3JtSGFuZGxlckluc3RhbmNlSWQgPSBxcS5nZXRVbmlxdWVJZCgpLCBvbmxvYWRDYWxsYmFja3MgPSB7fSwgZGV0YWNoTG9hZEV2ZW50cyA9IHt9LCBwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzID0ge30sIGlzQ29ycyA9IG9wdGlvbnMuaXNDb3JzLCBpbnB1dE5hbWUgPSBvcHRpb25zLmlucHV0TmFtZSwgZ2V0VXVpZCA9IHByb3h5LmdldFV1aWQsIGxvZyA9IHByb3h5LmxvZywgY29yc01lc3NhZ2VSZWNlaXZlciA9IG5ldyBxcS5XaW5kb3dSZWNlaXZlTWVzc2FnZSh7XG4gICAgICAgICAgICBsb2c6IGxvZ1xuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gZXhwdW5nZUZpbGUoaWQpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkZXRhY2hMb2FkRXZlbnRzW2lkXTtcbiAgICAgICAgICAgIGlmIChpc0NvcnMpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVyc1tpZF0pO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzW2lkXTtcbiAgICAgICAgICAgICAgICBjb3JzTWVzc2FnZVJlY2VpdmVyLnN0b3BSZWNlaXZpbmdNZXNzYWdlcyhpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaGFuZGxlci5fZ2V0SWZyYW1lTmFtZShpZCkpO1xuICAgICAgICAgICAgaWYgKGlmcmFtZSkge1xuICAgICAgICAgICAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJqYXZhc2NyaXB0OmZhbHNlO1wiKTtcbiAgICAgICAgICAgICAgICBxcShpZnJhbWUpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEZpbGVJZEZvcklmcmFtZU5hbWUoaWZyYW1lTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGlmcmFtZU5hbWUuc3BsaXQoXCJfXCIpWzBdO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGluaXRJZnJhbWVGb3JVcGxvYWQobmFtZSkge1xuICAgICAgICAgICAgdmFyIGlmcmFtZSA9IHFxLnRvRWxlbWVudChcIjxpZnJhbWUgc3JjPSdqYXZhc2NyaXB0OmZhbHNlOycgbmFtZT0nXCIgKyBuYW1lICsgXCInIC8+XCIpO1xuICAgICAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImlkXCIsIG5hbWUpO1xuICAgICAgICAgICAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgICAgICAgICAgIHJldHVybiBpZnJhbWU7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJQb3N0TWVzc2FnZUNhbGxiYWNrKGlmcmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWVOYW1lID0gaWZyYW1lLmlkLCBmaWxlSWQgPSBnZXRGaWxlSWRGb3JJZnJhbWVOYW1lKGlmcmFtZU5hbWUpLCB1dWlkID0gZ2V0VXVpZChmaWxlSWQpO1xuICAgICAgICAgICAgb25sb2FkQ2FsbGJhY2tzW3V1aWRdID0gY2FsbGJhY2s7XG4gICAgICAgICAgICBkZXRhY2hMb2FkRXZlbnRzW2ZpbGVJZF0gPSBxcShpZnJhbWUpLmF0dGFjaChcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIuZ2V0SW5wdXQoZmlsZUlkKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJSZWNlaXZlZCBpZnJhbWUgbG9hZCBldmVudCBmb3IgQ09SUyB1cGxvYWQgcmVxdWVzdCAoaWZyYW1lIG5hbWUgXCIgKyBpZnJhbWVOYW1lICsgXCIpXCIpO1xuICAgICAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZUNhbGxiYWNrVGltZXJzW2lmcmFtZU5hbWVdID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBcIk5vIHZhbGlkIG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBsb2FkZWQgaWZyYW1lIGZvciBpZnJhbWUgbmFtZSBcIiArIGlmcmFtZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coZXJyb3JNZXNzYWdlLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LCAxZTMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29yc01lc3NhZ2VSZWNlaXZlci5yZWNlaXZlTWVzc2FnZShpZnJhbWVOYW1lLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyB3aW5kb3cgbWVzc2FnZTogJ1wiICsgbWVzc2FnZSArIFwiJ1wiKTtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZUlkID0gZ2V0RmlsZUlkRm9ySWZyYW1lTmFtZShpZnJhbWVOYW1lKSwgcmVzcG9uc2UgPSBoYW5kbGVyLl9wYXJzZUpzb25SZXNwb25zZShtZXNzYWdlKSwgdXVpZCA9IHJlc3BvbnNlLnV1aWQsIG9ubG9hZENhbGxiYWNrO1xuICAgICAgICAgICAgICAgIGlmICh1dWlkICYmIG9ubG9hZENhbGxiYWNrc1t1dWlkXSkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJIYW5kbGluZyByZXNwb25zZSBmb3IgaWZyYW1lIG5hbWUgXCIgKyBpZnJhbWVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHBvc3RNZXNzYWdlQ2FsbGJhY2tUaW1lcnNbaWZyYW1lTmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcG9zdE1lc3NhZ2VDYWxsYmFja1RpbWVyc1tpZnJhbWVOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fZGV0YWNoTG9hZEV2ZW50KGlmcmFtZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBvbmxvYWRDYWxsYmFjayA9IG9ubG9hZENhbGxiYWNrc1t1dWlkXTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9ubG9hZENhbGxiYWNrc1t1dWlkXTtcbiAgICAgICAgICAgICAgICAgICAgY29yc01lc3NhZ2VSZWNlaXZlci5zdG9wUmVjZWl2aW5nTWVzc2FnZXMoaWZyYW1lTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIG9ubG9hZENhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1dWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIidcIiArIG1lc3NhZ2UgKyBcIicgZG9lcyBub3QgY29udGFpbiBhIFVVSUQgLSBpZ25vcmluZy5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5VcGxvYWRIYW5kbGVyKHNwZWMpKTtcbiAgICAgICAgcXEub3ZlcnJpZGUodGhpcywgZnVuY3Rpb24oc3VwZXJfKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oaWQsIGZpbGVJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICBzdXBlcl8uYWRkKGlkLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogZmlsZUlucHV0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBpbnB1dE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZUlucHV0LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKGZpbGVJbnB1dCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGV4cHVuZ2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cHVuZ2VGaWxlKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgc3VwZXJfLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXNWYWxpZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyXy5pc1ZhbGlkKGlkKSAmJiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmlucHV0ICE9PSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBnZXRJbnB1dDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5pbnB1dDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYXR0YWNoTG9hZEV2ZW50OiBmdW5jdGlvbihpZnJhbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlRGVzY3JpcHRvcjtcbiAgICAgICAgICAgICAgICBpZiAoaXNDb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyUG9zdE1lc3NhZ2VDYWxsYmFjayhpZnJhbWUsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkZXRhY2hMb2FkRXZlbnRzW2lmcmFtZS5pZF0gPSBxcShpZnJhbWUpLmF0dGFjaChcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJSZWNlaXZlZCByZXNwb25zZSBmb3IgXCIgKyBpZnJhbWUuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpZnJhbWUucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQgJiYgaWZyYW1lLmNvbnRlbnREb2N1bWVudC5ib2R5ICYmIGlmcmFtZS5jb250ZW50RG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIkVycm9yIHdoZW4gYXR0ZW1wdGluZyB0byBhY2Nlc3MgaWZyYW1lIGR1cmluZyBoYW5kbGluZyBvZiB1cGxvYWQgcmVzcG9uc2UgKFwiICsgZXJyb3IubWVzc2FnZSArIFwiKVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlRGVzY3JpcHRvciA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2VEZXNjcmlwdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jcmVhdGVJZnJhbWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlmcmFtZU5hbWUgPSBoYW5kbGVyLl9nZXRJZnJhbWVOYW1lKGlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdElmcmFtZUZvclVwbG9hZChpZnJhbWVOYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZGV0YWNoTG9hZEV2ZW50OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChkZXRhY2hMb2FkRXZlbnRzW2lkXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRldGFjaExvYWRFdmVudHNbaWRdKCk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkZXRhY2hMb2FkRXZlbnRzW2lkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldElmcmFtZU5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlSWQgKyBcIl9cIiArIGZvcm1IYW5kbGVySW5zdGFuY2VJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdEZvcm1Gb3JVcGxvYWQ6IGZ1bmN0aW9uKHNwZWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gc3BlYy5tZXRob2QsIGVuZHBvaW50ID0gc3BlYy5lbmRwb2ludCwgcGFyYW1zID0gc3BlYy5wYXJhbXMsIHBhcmFtc0luQm9keSA9IHNwZWMucGFyYW1zSW5Cb2R5LCB0YXJnZXROYW1lID0gc3BlYy50YXJnZXROYW1lLCBmb3JtID0gcXEudG9FbGVtZW50KFwiPGZvcm0gbWV0aG9kPSdcIiArIG1ldGhvZCArIFwiJyBlbmN0eXBlPSdtdWx0aXBhcnQvZm9ybS1kYXRhJz48L2Zvcm0+XCIpLCB1cmwgPSBlbmRwb2ludDtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zSW5Cb2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLm9iajJJbnB1dHMocGFyYW1zLCBmb3JtKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSBxcS5vYmoydXJsKHBhcmFtcywgZW5kcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcImFjdGlvblwiLCB1cmwpO1xuICAgICAgICAgICAgICAgIGZvcm0uc2V0QXR0cmlidXRlKFwidGFyZ2V0XCIsIHRhcmdldE5hbWUpO1xuICAgICAgICAgICAgICAgIGZvcm0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZm9ybSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvcm07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3BhcnNlSnNvblJlc3BvbnNlOiBmdW5jdGlvbihpbm5lckh0bWxPck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7fTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHFxLnBhcnNlSnNvbihpbm5lckh0bWxPck1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkVycm9yIHdoZW4gYXR0ZW1wdGluZyB0byBwYXJzZSBpZnJhbWUgdXBsb2FkIHJlc3BvbnNlIChcIiArIGVycm9yLm1lc3NhZ2UgKyBcIilcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlhoclVwbG9hZEhhbmRsZXIgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgaGFuZGxlciA9IHRoaXMsIG5hbWVzcGFjZSA9IHNwZWMub3B0aW9ucy5uYW1lc3BhY2UsIHByb3h5ID0gc3BlYy5wcm94eSwgY2h1bmtpbmcgPSBzcGVjLm9wdGlvbnMuY2h1bmtpbmcsIGdldENodW5rU2l6ZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2YXIgZmlsZVN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKTtcbiAgICAgICAgICAgIGlmIChmaWxlU3RhdGUuY2h1bmtTaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVTdGF0ZS5jaHVua1NpemU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjaHVua1NpemUgPSBjaHVua2luZy5wYXJ0U2l6ZTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNGdW5jdGlvbihjaHVua1NpemUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rU2l6ZSA9IGNodW5rU2l6ZShpZCwgZ2V0U2l6ZShpZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWxlU3RhdGUuY2h1bmtTaXplID0gY2h1bmtTaXplO1xuICAgICAgICAgICAgICAgIHJldHVybiBjaHVua1NpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHJlc3VtZSA9IHNwZWMub3B0aW9ucy5yZXN1bWUsIGNodW5rRmlsZXMgPSBjaHVua2luZyAmJiBzcGVjLm9wdGlvbnMuY2h1bmtpbmcuZW5hYmxlZCAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5jaHVua2luZywgcmVzdW1lRW5hYmxlZCA9IHJlc3VtZSAmJiBzcGVjLm9wdGlvbnMucmVzdW1lLmVuYWJsZWQgJiYgY2h1bmtGaWxlcyAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5yZXN1bWUsIGdldE5hbWUgPSBwcm94eS5nZXROYW1lLCBnZXRTaXplID0gcHJveHkuZ2V0U2l6ZSwgZ2V0VXVpZCA9IHByb3h5LmdldFV1aWQsIGdldEVuZHBvaW50ID0gcHJveHkuZ2V0RW5kcG9pbnQsIGdldERhdGFCeVV1aWQgPSBwcm94eS5nZXREYXRhQnlVdWlkLCBvblV1aWRDaGFuZ2VkID0gcHJveHkub25VdWlkQ2hhbmdlZCwgb25Qcm9ncmVzcyA9IHByb3h5Lm9uUHJvZ3Jlc3MsIGxvZyA9IHByb3h5LmxvZywgZ2V0Q3VzdG9tUmVzdW1lRGF0YSA9IHByb3h5LmdldEN1c3RvbVJlc3VtZURhdGE7XG4gICAgICAgIGZ1bmN0aW9uIGFib3J0KGlkKSB7XG4gICAgICAgICAgICBxcS5lYWNoKGhhbmRsZXIuX2dldFhocnMoaWQpLCBmdW5jdGlvbih4aHJJZCwgeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFqYXhSZXF1ZXN0ZXIgPSBoYW5kbGVyLl9nZXRBamF4UmVxdWVzdGVyKGlkLCB4aHJJZCk7XG4gICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gbnVsbDtcbiAgICAgICAgICAgICAgICB4aHIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICBhamF4UmVxdWVzdGVyICYmIGFqYXhSZXF1ZXN0ZXIuY2FuY2VsZWQgJiYgYWpheFJlcXVlc3Rlci5jYW5jZWxlZChpZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLlVwbG9hZEhhbmRsZXIoc3BlYykpO1xuICAgICAgICBxcS5vdmVycmlkZSh0aGlzLCBmdW5jdGlvbihzdXBlcl8pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihpZCwgYmxvYk9yUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFxLmlzRmlsZShibG9iT3JQcm94eSkgfHwgcXEuaXNCbG9iKGJsb2JPclByb3h5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXJfLmFkZChpZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IGJsb2JPclByb3h5XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChibG9iT3JQcm94eSBpbnN0YW5jZW9mIHFxLkJsb2JQcm94eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXJfLmFkZChpZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5OiBibG9iT3JQcm94eVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXNzZWQgb2JqIGlzIG5vdCBhIEZpbGUsIEJsb2IsIG9yIHByb3h5XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2luaXRUZW1wU3RhdGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bWVFbmFibGVkICYmIGhhbmRsZXIuX21heWJlUHJlcGFyZUZvclJlc3VtZShpZCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBleHB1bmdlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICBhYm9ydChpZCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX21heWJlRGVsZXRlUGVyc2lzdGVkQ2h1bmtEYXRhKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5fY2xlYXJYaHJzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgc3VwZXJfLmV4cHVuZ2UoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgY2xlYXJDYWNoZWRDaHVuazogZnVuY3Rpb24oaWQsIGNodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmlsZVN0YXRlLnRlbXAuY2FjaGVkQ2h1bmtzW2NodW5rSWR4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXJYaHI6IGZ1bmN0aW9uKGlkLCBjaHVua0lkeCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXA7XG4gICAgICAgICAgICAgICAgaWYgKHRlbXBTdGF0ZS54aHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0ZW1wU3RhdGUueGhyc1tjaHVua0lkeF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVyc1tjaHVua0lkeF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbmFsaXplQ2h1bmtzOiBmdW5jdGlvbihpZCwgcmVzcG9uc2VQYXJzZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFzdENodW5rSWR4ID0gaGFuZGxlci5fZ2V0VG90YWxDaHVua3MoaWQpIC0gMSwgeGhyID0gaGFuZGxlci5fZ2V0WGhyKGlkLCBsYXN0Q2h1bmtJZHgpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZVBhcnNlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlByb21pc2UoKS5zdWNjZXNzKHJlc3BvbnNlUGFyc2VyKHhociksIHhocik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuUHJvbWlzZSgpLnN1Y2Nlc3Moe30sIHhocik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5pc1ZhbGlkKGlkKSAmJiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmZpbGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UHJveHk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuaXNWYWxpZChpZCkgJiYgaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5wcm94eTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZXN1bWFibGVGaWxlc0RhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bWFibGVGaWxlc0RhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9pdGVyYXRlUmVzdW1lUmVjb3JkcyhmdW5jdGlvbihrZXksIHVwbG9hZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5tb3ZlSW5Qcm9ncmVzc1RvUmVtYWluaW5nKG51bGwsIHVwbG9hZERhdGEuY2h1bmtpbmcuaW5Qcm9ncmVzcywgdXBsb2FkRGF0YS5jaHVua2luZy5yZW1haW5pbmcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHVwbG9hZERhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZzogdXBsb2FkRGF0YS5jaHVua2luZy5yZW1haW5pbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiB1cGxvYWREYXRhLnNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiB1cGxvYWREYXRhLnV1aWRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZERhdGEua2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmtleSA9IHVwbG9hZERhdGEua2V5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhLmN1c3RvbVJlc3VtZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuY3VzdG9tUmVzdW1lRGF0YSA9IHVwbG9hZERhdGEuY3VzdG9tUmVzdW1lRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bWFibGVGaWxlc0RhdGEucHVzaChkYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdW1hYmxlRmlsZXNEYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzQXR0ZW1wdGluZ1Jlc3VtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5hdHRlbXB0aW5nUmVzdW1lO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUmVzdW1hYmxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhIWNodW5raW5nICYmIGhhbmRsZXIuaXNWYWxpZChpZCkgJiYgIWhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkubm90UmVzdW1hYmxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1vdmVJblByb2dyZXNzVG9SZW1haW5pbmc6IGZ1bmN0aW9uKGlkLCBvcHRJblByb2dyZXNzLCBvcHRSZW1haW5pbmcpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKSB8fCB7fSwgY2h1bmtpbmdTdGF0ZSA9IGZpbGVTdGF0ZS5jaHVua2luZyB8fCB7fSwgaW5Qcm9ncmVzcyA9IG9wdEluUHJvZ3Jlc3MgfHwgY2h1bmtpbmdTdGF0ZS5pblByb2dyZXNzLCByZW1haW5pbmcgPSBvcHRSZW1haW5pbmcgfHwgY2h1bmtpbmdTdGF0ZS5yZW1haW5pbmc7XG4gICAgICAgICAgICAgICAgaWYgKGluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIk1vdmluZyB0aGVzZSBjaHVua3MgZnJvbSBpbi1wcm9ncmVzcyB7fSwgdG8gcmVtYWluaW5nLlwiLCBKU09OLnN0cmluZ2lmeShpblByb2dyZXNzKSkpO1xuICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzLnJldmVyc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChpblByb2dyZXNzLCBmdW5jdGlvbihpZHgsIGNodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcudW5zaGlmdChjaHVua0lkeCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJBYm9ydGluZyBYSFIgdXBsb2FkIGZvciB7fSAne30nIGR1ZSB0byBwYXVzZSBpbnN0cnVjdGlvbi5cIiwgaWQsIGdldE5hbWUoaWQpKSk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYWJvcnQoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVldmFsdWF0ZUNodW5raW5nOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChjaHVua2luZyAmJiBoYW5kbGVyLmlzVmFsaWQoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCksIHRvdGFsQ2h1bmtzLCBpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgc3RhdGUuY2h1bmtpbmc7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nID0ge307XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQ2h1bmtzID0gaGFuZGxlci5fZ2V0VG90YWxDaHVua3MoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxDaHVua3MgPiAxIHx8IGNodW5raW5nLm1hbmRhdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZy5wYXJ0cyA9IHRvdGFsQ2h1bmtzO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2h1bmtpbmcucmVtYWluaW5nID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWxDaHVua3M7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nLnJlbWFpbmluZy5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5faW5pdFRlbXBTdGF0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jaHVua2luZy5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlQmxvYjogZnVuY3Rpb24oaWQsIG5ld0Jsb2IpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5pc1ZhbGlkKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmZpbGUgPSBuZXdCbG9iO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY2xlYXJYaHJzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wU3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXA7XG4gICAgICAgICAgICAgICAgcXEuZWFjaCh0ZW1wU3RhdGUuYWpheFJlcXVlc3RlcnMsIGZ1bmN0aW9uKGNodW5rSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVyc1tjaHVua0lkXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBxcS5lYWNoKHRlbXBTdGF0ZS54aHJzLCBmdW5jdGlvbihjaHVua0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0ZW1wU3RhdGUueGhyc1tjaHVua0lkXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY3JlYXRlWGhyOiBmdW5jdGlvbihpZCwgb3B0Q2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fcmVnaXN0ZXJYaHIoaWQsIG9wdENodW5rSWR4LCBxcS5jcmVhdGVYaHJJbnN0YW5jZSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0QWpheFJlcXVlc3RlcjogZnVuY3Rpb24oaWQsIG9wdENodW5rSWR4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rSWR4ID0gb3B0Q2h1bmtJZHggPT0gbnVsbCA/IC0xIDogb3B0Q2h1bmtJZHg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcC5hamF4UmVxdWVzdGVyc1tjaHVua0lkeF07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldENodW5rRGF0YTogZnVuY3Rpb24oaWQsIGNodW5rSW5kZXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtTaXplID0gZ2V0Q2h1bmtTaXplKGlkKSwgZmlsZVNpemUgPSBnZXRTaXplKGlkKSwgZmlsZU9yQmxvYiA9IGhhbmRsZXIuZ2V0RmlsZShpZCksIHN0YXJ0Qnl0ZXMgPSBjaHVua1NpemUgKiBjaHVua0luZGV4LCBlbmRCeXRlcyA9IHN0YXJ0Qnl0ZXMgKyBjaHVua1NpemUgPj0gZmlsZVNpemUgPyBmaWxlU2l6ZSA6IHN0YXJ0Qnl0ZXMgKyBjaHVua1NpemUsIHRvdGFsQ2h1bmtzID0gaGFuZGxlci5fZ2V0VG90YWxDaHVua3MoaWQpLCBjYWNoZWRDaHVua3MgPSB0aGlzLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuY2FjaGVkQ2h1bmtzLCBibG9iID0gY2FjaGVkQ2h1bmtzW2NodW5rSW5kZXhdIHx8IHFxLnNsaWNlQmxvYihmaWxlT3JCbG9iLCBzdGFydEJ5dGVzLCBlbmRCeXRlcyk7XG4gICAgICAgICAgICAgICAgY2FjaGVkQ2h1bmtzW2NodW5rSW5kZXhdID0gYmxvYjtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0OiBjaHVua0luZGV4LFxuICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRCeXRlcyxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBlbmRCeXRlcyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHRvdGFsQ2h1bmtzLFxuICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBlbmRCeXRlcyAtIHN0YXJ0Qnl0ZXNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRDaHVua0RhdGFGb3JDYWxsYmFjazogZnVuY3Rpb24oY2h1bmtEYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydEluZGV4OiBjaHVua0RhdGEucGFydCxcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRCeXRlOiBjaHVua0RhdGEuc3RhcnQgKyAxLFxuICAgICAgICAgICAgICAgICAgICBlbmRCeXRlOiBjaHVua0RhdGEuZW5kLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFBhcnRzOiBjaHVua0RhdGEuY291bnRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRMb2NhbFN0b3JhZ2VJZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0VmVyc2lvbiA9IFwiNS4wXCIsIG5hbWUgPSBnZXROYW1lKGlkKSwgc2l6ZSA9IGdldFNpemUoaWQpLCBjaHVua1NpemUgPSBnZXRDaHVua1NpemUoaWQpLCBlbmRwb2ludCA9IGdldEVuZHBvaW50KGlkKSwgY3VzdG9tS2V5cyA9IHJlc3VtZS5jdXN0b21LZXlzKGlkKSwgbG9jYWxTdG9yYWdlSWQgPSBxcS5mb3JtYXQoXCJxcXt9cmVzdW1le30te30te30te30te31cIiwgbmFtZXNwYWNlLCBmb3JtYXRWZXJzaW9uLCBuYW1lLCBzaXplLCBjaHVua1NpemUsIGVuZHBvaW50KTtcbiAgICAgICAgICAgICAgICBjdXN0b21LZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZUlkICs9IFwiLVwiICsga2V5O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VJZDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0TWltZVR5cGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuZ2V0RmlsZShpZCkudHlwZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0UGVyc2lzdGFibGVEYXRhOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLmNodW5raW5nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRUb3RhbENodW5rczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmtpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVTaXplID0gZ2V0U2l6ZShpZCksIGNodW5rU2l6ZSA9IGdldENodW5rU2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwoZmlsZVNpemUgLyBjaHVua1NpemUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0WGhyOiBmdW5jdGlvbihpZCwgb3B0Q2h1bmtJZHgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2h1bmtJZHggPSBvcHRDaHVua0lkeCA9PSBudWxsID8gLTEgOiBvcHRDaHVua0lkeDtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS50ZW1wLnhocnNbY2h1bmtJZHhdO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9nZXRYaHJzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAueGhycztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXRlcmF0ZVJlc3VtZVJlY29yZHM6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VtZUVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChsb2NhbFN0b3JhZ2UsIGZ1bmN0aW9uKGtleSwgaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKHFxLmZvcm1hdChcInFxe31yZXN1bWVcIiwgbmFtZXNwYWNlKSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRGF0YSA9IEpTT04ucGFyc2UoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soa2V5LCB1cGxvYWREYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0VGVtcFN0YXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgYWpheFJlcXVlc3RlcnM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBjaHVua1Byb2dyZXNzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgeGhyczoge30sXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZENodW5rczoge31cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9tYXJrTm90UmVzdW1hYmxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkubm90UmVzdW1hYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWF5YmVEZWxldGVQZXJzaXN0ZWRDaHVua0RhdGE6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsU3RvcmFnZUlkO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bWVFbmFibGVkICYmIGhhbmRsZXIuaXNSZXN1bWFibGUoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZUlkID0gaGFuZGxlci5fZ2V0TG9jYWxTdG9yYWdlSWQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobG9jYWxTdG9yYWdlSWQgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxTdG9yYWdlSWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShsb2NhbFN0b3JhZ2VJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlUHJlcGFyZUZvclJlc3VtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLCBsb2NhbFN0b3JhZ2VJZCwgcGVyc2lzdGVkRGF0YTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdW1lRW5hYmxlZCAmJiBzdGF0ZS5rZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VJZCA9IGhhbmRsZXIuX2dldExvY2FsU3RvcmFnZUlkKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcGVyc2lzdGVkRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFnZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlcnNpc3RlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlZERhdGEgPSBKU09OLnBhcnNlKHBlcnNpc3RlZERhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldERhdGFCeVV1aWQocGVyc2lzdGVkRGF0YS51dWlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuX21hcmtOb3RSZXN1bWFibGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiSWRlbnRpZmllZCBmaWxlIHdpdGggSUQge30gYW5kIG5hbWUgb2Yge30gYXMgcmVzdW1hYmxlLlwiLCBpZCwgZ2V0TmFtZShpZCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblV1aWRDaGFuZ2VkKGlkLCBwZXJzaXN0ZWREYXRhLnV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmtleSA9IHBlcnNpc3RlZERhdGEua2V5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmNodW5raW5nID0gcGVyc2lzdGVkRGF0YS5jaHVua2luZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5sb2FkZWQgPSBwZXJzaXN0ZWREYXRhLmxvYWRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5jdXN0b21SZXN1bWVEYXRhID0gcGVyc2lzdGVkRGF0YS5jdXN0b21SZXN1bWVEYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmF0dGVtcHRpbmdSZXN1bWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIubW92ZUluUHJvZ3Jlc3NUb1JlbWFpbmluZyhpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlUGVyc2lzdENodW5rZWRTdGF0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLCBsb2NhbFN0b3JhZ2VJZCwgcGVyc2lzdGVkRGF0YTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdW1lRW5hYmxlZCAmJiBoYW5kbGVyLmlzUmVzdW1hYmxlKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tUmVzdW1lRGF0YSA9IGdldEN1c3RvbVJlc3VtZURhdGEoaWQpO1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VJZCA9IGhhbmRsZXIuX2dldExvY2FsU3RvcmFnZUlkKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcGVyc2lzdGVkRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGdldE5hbWUoaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZ2V0U2l6ZShpZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBnZXRVdWlkKGlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogc3RhdGUua2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtpbmc6IHN0YXRlLmNodW5raW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBzdGF0ZS5sb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tUmVzdW1lRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdGVkRGF0YS5jdXN0b21SZXN1bWVEYXRhID0gY3VzdG9tUmVzdW1lRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0obG9jYWxTdG9yYWdlSWQsIEpTT04uc3RyaW5naWZ5KHBlcnNpc3RlZERhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJVbmFibGUgdG8gc2F2ZSByZXN1bWUgZGF0YSBmb3IgJ3t9JyBkdWUgdG8gZXJyb3I6ICd7fScuXCIsIGlkLCBlcnJvci50b1N0cmluZygpKSwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9yZWdpc3RlclByb2dyZXNzSGFuZGxlcjogZnVuY3Rpb24oaWQsIGNodW5rSWR4LCBjaHVua1NpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgeGhyID0gaGFuZGxlci5fZ2V0WGhyKGlkLCBjaHVua0lkeCksIG5hbWUgPSBnZXROYW1lKGlkKSwgcHJvZ3Jlc3NDYWxjdWxhdG9yID0ge1xuICAgICAgICAgICAgICAgICAgICBzaW1wbGU6IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlU2l6ZSA9IGdldFNpemUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlZCA9PT0gdG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzKGlkLCBuYW1lLCBmaWxlU2l6ZSwgZmlsZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblByb2dyZXNzKGlkLCBuYW1lLCBsb2FkZWQgPj0gZmlsZVNpemUgPyBmaWxlU2l6ZSAtIDEgOiBsb2FkZWQsIGZpbGVTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtlZDogZnVuY3Rpb24obG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNodW5rUHJvZ3Jlc3MgPSBoYW5kbGVyLl9nZXRGaWxlU3RhdGUoaWQpLnRlbXAuY2h1bmtQcm9ncmVzcywgdG90YWxTdWNjZXNzZnVsbHlMb2FkZWRGb3JGaWxlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKS5sb2FkZWQsIGxvYWRlZEZvclJlcXVlc3QgPSBsb2FkZWQsIHRvdGFsRm9yUmVxdWVzdCA9IHRvdGFsLCB0b3RhbEZpbGVTaXplID0gZ2V0U2l6ZShpZCksIGVzdEFjdHVhbENodW5rTG9hZGVkID0gbG9hZGVkRm9yUmVxdWVzdCAtICh0b3RhbEZvclJlcXVlc3QgLSBjaHVua1NpemUpLCB0b3RhbExvYWRlZEZvckZpbGUgPSB0b3RhbFN1Y2Nlc3NmdWxseUxvYWRlZEZvckZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHVua1Byb2dyZXNzW2NodW5rSWR4XSA9IGVzdEFjdHVhbENodW5rTG9hZGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChjaHVua1Byb2dyZXNzLCBmdW5jdGlvbihjaHVua0lkeCwgY2h1bmtMb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZEZvckZpbGUgKz0gY2h1bmtMb2FkZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MoaWQsIG5hbWUsIHRvdGFsTG9hZGVkRm9yRmlsZSwgdG90YWxGaWxlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUubGVuZ3RoQ29tcHV0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBjaHVua1NpemUgPT0gbnVsbCA/IFwic2ltcGxlXCIgOiBcImNodW5rZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQ2FsY3VsYXRvclt0eXBlXShlLmxvYWRlZCwgZS50b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9yZWdpc3RlclhocjogZnVuY3Rpb24oaWQsIG9wdENodW5rSWR4LCB4aHIsIG9wdEFqYXhSZXF1ZXN0ZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgeGhyc0lkID0gb3B0Q2h1bmtJZHggPT0gbnVsbCA/IC0xIDogb3B0Q2h1bmtJZHgsIHRlbXBTdGF0ZSA9IGhhbmRsZXIuX2dldEZpbGVTdGF0ZShpZCkudGVtcDtcbiAgICAgICAgICAgICAgICB0ZW1wU3RhdGUueGhycyA9IHRlbXBTdGF0ZS54aHJzIHx8IHt9O1xuICAgICAgICAgICAgICAgIHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVycyA9IHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVycyB8fCB7fTtcbiAgICAgICAgICAgICAgICB0ZW1wU3RhdGUueGhyc1t4aHJzSWRdID0geGhyO1xuICAgICAgICAgICAgICAgIGlmIChvcHRBamF4UmVxdWVzdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBTdGF0ZS5hamF4UmVxdWVzdGVyc1t4aHJzSWRdID0gb3B0QWpheFJlcXVlc3RlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHhocjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcmVtb3ZlRXhwaXJlZENodW5raW5nUmVjb3JkczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4cGlyYXRpb25EYXlzID0gcmVzdW1lLnJlY29yZHNFeHBpcmVJbjtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9pdGVyYXRlUmVzdW1lUmVjb3JkcyhmdW5jdGlvbihrZXksIHVwbG9hZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUodXBsb2FkRGF0YS5sYXN0VXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlLnNldERhdGUoZXhwaXJhdGlvbkRhdGUuZ2V0RGF0ZSgpICsgZXhwaXJhdGlvbkRheXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXhwaXJhdGlvbkRhdGUuZ2V0VGltZSgpIDw9IERhdGUubm93KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlJlbW92aW5nIGV4cGlyZWQgcmVzdW1lIHJlY29yZCB3aXRoIGtleSBcIiArIGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3VsZENodW5rVGhpc0ZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gaGFuZGxlci5fZ2V0RmlsZVN0YXRlKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5jaHVua2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5yZWV2YWx1YXRlQ2h1bmtpbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5jaHVua2luZy5lbmFibGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5EZWxldGVGaWxlQWpheFJlcXVlc3RlciA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciByZXF1ZXN0ZXIsIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICB1dWlkUGFyYW1OYW1lOiBcInFxdXVpZFwiLFxuICAgICAgICAgICAgZW5kcG9pbnRTdG9yZToge30sXG4gICAgICAgICAgICBtYXhDb25uZWN0aW9uczogMyxcbiAgICAgICAgICAgIGN1c3RvbUhlYWRlcnM6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhcmFtc1N0b3JlOiB7fSxcbiAgICAgICAgICAgIGNvcnM6IHtcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VuZENyZWRlbnRpYWxzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24oc3RyLCBsZXZlbCkge30sXG4gICAgICAgICAgICBvbkRlbGV0ZTogZnVuY3Rpb24oaWQpIHt9LFxuICAgICAgICAgICAgb25EZWxldGVDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIGZ1bmN0aW9uIGdldE1hbmRhdGVkUGFyYW1zKCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09IFwiUE9TVFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgX21ldGhvZDogXCJERUxFVEVcIlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgcmVxdWVzdGVyID0gcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5BamF4UmVxdWVzdGVyKHtcbiAgICAgICAgICAgIGFjY2VwdEhlYWRlcjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICB2YWxpZE1ldGhvZHM6IFsgXCJQT1NUXCIsIFwiREVMRVRFXCIgXSxcbiAgICAgICAgICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QsXG4gICAgICAgICAgICBlbmRwb2ludFN0b3JlOiBvcHRpb25zLmVuZHBvaW50U3RvcmUsXG4gICAgICAgICAgICBwYXJhbXNTdG9yZTogb3B0aW9ucy5wYXJhbXNTdG9yZSxcbiAgICAgICAgICAgIG1hbmRhdGVkUGFyYW1zOiBnZXRNYW5kYXRlZFBhcmFtcygpLFxuICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IG9wdGlvbnMubWF4Q29ubmVjdGlvbnMsXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmN1c3RvbUhlYWRlcnMuZ2V0KGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IG9wdGlvbnMubG9nLFxuICAgICAgICAgICAgb25TZW5kOiBvcHRpb25zLm9uRGVsZXRlLFxuICAgICAgICAgICAgb25Db21wbGV0ZTogb3B0aW9ucy5vbkRlbGV0ZUNvbXBsZXRlLFxuICAgICAgICAgICAgY29yczogb3B0aW9ucy5jb3JzXG4gICAgICAgIH0pKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHNlbmREZWxldGU6IGZ1bmN0aW9uKGlkLCB1dWlkLCBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRkaXRpb25hbE9wdGlvbnMgPSBhZGRpdGlvbmFsTWFuZGF0ZWRQYXJhbXMgfHwge307XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5sb2coXCJTdWJtaXR0aW5nIGRlbGV0ZSBmaWxlIHJlcXVlc3QgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1ldGhvZCA9PT0gXCJERUxFVEVcIikge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ZXIuaW5pdFRyYW5zcG9ydChpZCkud2l0aFBhdGgodXVpZCkud2l0aFBhcmFtcyhhZGRpdGlvbmFsT3B0aW9ucykuc2VuZCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxPcHRpb25zW29wdGlvbnMudXVpZFBhcmFtTmFtZV0gPSB1dWlkO1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ZXIuaW5pdFRyYW5zcG9ydChpZCkud2l0aFBhcmFtcyhhZGRpdGlvbmFsT3B0aW9ucykuc2VuZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIGZ1bmN0aW9uIGRldGVjdFN1YnNhbXBsaW5nKGltZykge1xuICAgICAgICAgICAgdmFyIGl3ID0gaW1nLm5hdHVyYWxXaWR0aCwgaWggPSBpbWcubmF0dXJhbEhlaWdodCwgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSwgY3R4O1xuICAgICAgICAgICAgaWYgKGl3ICogaWggPiAxMDI0ICogMTAyNCkge1xuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAxO1xuICAgICAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIC1pdyArIDEsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIDEpLmRhdGFbM10gPT09IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkZXRlY3RWZXJ0aWNhbFNxdWFzaChpbWcsIGl3LCBpaCkge1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksIHN5ID0gMCwgZXkgPSBpaCwgcHkgPSBpaCwgY3R4LCBkYXRhLCBhbHBoYSwgcmF0aW87XG4gICAgICAgICAgICBjYW52YXMud2lkdGggPSAxO1xuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGloO1xuICAgICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICAgICAgICAgIGRhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIGloKS5kYXRhO1xuICAgICAgICAgICAgd2hpbGUgKHB5ID4gc3kpIHtcbiAgICAgICAgICAgICAgICBhbHBoYSA9IGRhdGFbKHB5IC0gMSkgKiA0ICsgM107XG4gICAgICAgICAgICAgICAgaWYgKGFscGhhID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGV5ID0gcHk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3kgPSBweTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHkgPSBleSArIHN5ID4+IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByYXRpbyA9IHB5IC8gaWg7XG4gICAgICAgICAgICByZXR1cm4gcmF0aW8gPT09IDAgPyAxIDogcmF0aW87XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVuZGVySW1hZ2VUb0RhdGFVUkwoaW1nLCBibG9iLCBvcHRpb25zLCBkb1NxdWFzaCkge1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksIG1pbWUgPSBvcHRpb25zLm1pbWUgfHwgXCJpbWFnZS9qcGVnXCIsIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgcmVuZGVySW1hZ2VUb0NhbnZhcyhpbWcsIGJsb2IsIGNhbnZhcywgb3B0aW9ucywgZG9TcXVhc2gpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKGNhbnZhcy50b0RhdGFVUkwobWltZSwgb3B0aW9ucy5xdWFsaXR5IHx8IC44KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG1heWJlQ2FsY3VsYXRlRG93bnNhbXBsZWREaW1lbnNpb25zKHNwZWMpIHtcbiAgICAgICAgICAgIHZhciBtYXhQaXhlbHMgPSA1MjQxZTM7XG4gICAgICAgICAgICBpZiAoIXFxLmlvcygpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IHFxLkVycm9yKFwiRG93bnNhbXBsZWQgZGltZW5zaW9ucyBjYW4gb25seSBiZSByZWxpYWJseSBjYWxjdWxhdGVkIGZvciBpT1MhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNwZWMub3JpZ0hlaWdodCAqIHNwZWMub3JpZ1dpZHRoID4gbWF4UGl4ZWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3SGVpZ2h0OiBNYXRoLnJvdW5kKE1hdGguc3FydChtYXhQaXhlbHMgKiAoc3BlYy5vcmlnSGVpZ2h0IC8gc3BlYy5vcmlnV2lkdGgpKSksXG4gICAgICAgICAgICAgICAgICAgIG5ld1dpZHRoOiBNYXRoLnJvdW5kKE1hdGguc3FydChtYXhQaXhlbHMgKiAoc3BlYy5vcmlnV2lkdGggLyBzcGVjLm9yaWdIZWlnaHQpKSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlckltYWdlVG9DYW52YXMoaW1nLCBibG9iLCBjYW52YXMsIG9wdGlvbnMsIGRvU3F1YXNoKSB7XG4gICAgICAgICAgICB2YXIgaXcgPSBpbWcubmF0dXJhbFdpZHRoLCBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0LCB3aWR0aCA9IG9wdGlvbnMud2lkdGgsIGhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0LCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKSwgbW9kaWZpZWREaW1lbnNpb25zO1xuICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJlc2l6ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJJbWFnZVRvQ2FudmFzV2l0aEN1c3RvbVJlc2l6ZXIoe1xuICAgICAgICAgICAgICAgICAgICBibG9iOiBibG9iLFxuICAgICAgICAgICAgICAgICAgICBjYW52YXM6IGNhbnZhcyxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IGltZyxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VIZWlnaHQ6IGloLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZVdpZHRoOiBpdyxcbiAgICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb246IG9wdGlvbnMub3JpZW50YXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogb3B0aW9ucy5yZXNpemUsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRXaWR0aDogd2lkdGhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMudW5saW1pdGVkU2NhbGVkSW1hZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZWREaW1lbnNpb25zID0gbWF5YmVDYWxjdWxhdGVEb3duc2FtcGxlZERpbWVuc2lvbnMoe1xuICAgICAgICAgICAgICAgICAgICBvcmlnV2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgICAgICBvcmlnSGVpZ2h0OiBoZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWREaW1lbnNpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmxvZyhxcS5mb3JtYXQoXCJIYWQgdG8gcmVkdWNlIGRpbWVuc2lvbnMgZHVlIHRvIGRldmljZSBsaW1pdGF0aW9ucyBmcm9tIHt9dyAvIHt9aCB0byB7fXcgLyB7fWhcIiwgd2lkdGgsIGhlaWdodCwgbW9kaWZpZWREaW1lbnNpb25zLm5ld1dpZHRoLCBtb2RpZmllZERpbWVuc2lvbnMubmV3SGVpZ2h0KSwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IG1vZGlmaWVkRGltZW5zaW9ucy5uZXdXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gbW9kaWZpZWREaW1lbnNpb25zLm5ld0hlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cmFuc2Zvcm1Db29yZGluYXRlKGNhbnZhcywgd2lkdGgsIGhlaWdodCwgb3B0aW9ucy5vcmllbnRhdGlvbik7XG4gICAgICAgICAgICBpZiAocXEuaW9zKCkpIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXRlY3RTdWJzYW1wbGluZyhpbWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdyAvPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWggLz0gMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IDEwMjQsIHRtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksIHZlcnRTcXVhc2hSYXRpbyA9IGRvU3F1YXNoID8gZGV0ZWN0VmVydGljYWxTcXVhc2goaW1nLCBpdywgaWgpIDogMSwgZHcgPSBNYXRoLmNlaWwoZCAqIHdpZHRoIC8gaXcpLCBkaCA9IE1hdGguY2VpbChkICogaGVpZ2h0IC8gaWggLyB2ZXJ0U3F1YXNoUmF0aW8pLCBzeSA9IDAsIGR5ID0gMCwgdG1wQ3R4LCBzeCwgZHg7XG4gICAgICAgICAgICAgICAgICAgIHRtcENhbnZhcy53aWR0aCA9IHRtcENhbnZhcy5oZWlnaHQgPSBkO1xuICAgICAgICAgICAgICAgICAgICB0bXBDdHggPSB0bXBDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3kgPCBpaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3ggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN4IDwgaXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBDdHguY2xlYXJSZWN0KDAsIDAsIGQsIGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcEN0eC5kcmF3SW1hZ2UoaW1nLCAtc3gsIC1zeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0bXBDYW52YXMsIDAsIDAsIGQsIGQsIGR4LCBkeSwgZHcsIGRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeCArPSBkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4ICs9IGR3O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3kgKz0gZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR5ICs9IGRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRtcENhbnZhcyA9IHRtcEN0eCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FudmFzLnFxSW1hZ2VSZW5kZXJlZCAmJiBjYW52YXMucXFJbWFnZVJlbmRlcmVkKCk7XG4gICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlckltYWdlVG9DYW52YXNXaXRoQ3VzdG9tUmVzaXplcihyZXNpemVJbmZvKSB7XG4gICAgICAgICAgICB2YXIgYmxvYiA9IHJlc2l6ZUluZm8uYmxvYiwgaW1hZ2UgPSByZXNpemVJbmZvLmltYWdlLCBpbWFnZUhlaWdodCA9IHJlc2l6ZUluZm8uaW1hZ2VIZWlnaHQsIGltYWdlV2lkdGggPSByZXNpemVJbmZvLmltYWdlV2lkdGgsIG9yaWVudGF0aW9uID0gcmVzaXplSW5mby5vcmllbnRhdGlvbiwgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCksIHJlc2l6ZSA9IHJlc2l6ZUluZm8ucmVzaXplLCBzb3VyY2VDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLCBzb3VyY2VDYW52YXNDb250ZXh0ID0gc291cmNlQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKSwgdGFyZ2V0Q2FudmFzID0gcmVzaXplSW5mby5jYW52YXMsIHRhcmdldEhlaWdodCA9IHJlc2l6ZUluZm8udGFyZ2V0SGVpZ2h0LCB0YXJnZXRXaWR0aCA9IHJlc2l6ZUluZm8udGFyZ2V0V2lkdGg7XG4gICAgICAgICAgICB0cmFuc2Zvcm1Db29yZGluYXRlKHNvdXJjZUNhbnZhcywgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQsIG9yaWVudGF0aW9uKTtcbiAgICAgICAgICAgIHRhcmdldENhbnZhcy5oZWlnaHQgPSB0YXJnZXRIZWlnaHQ7XG4gICAgICAgICAgICB0YXJnZXRDYW52YXMud2lkdGggPSB0YXJnZXRXaWR0aDtcbiAgICAgICAgICAgIHNvdXJjZUNhbnZhc0NvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTtcbiAgICAgICAgICAgIHJlc2l6ZSh7XG4gICAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRhcmdldEhlaWdodCxcbiAgICAgICAgICAgICAgICBpbWFnZTogaW1hZ2UsXG4gICAgICAgICAgICAgICAgc291cmNlQ2FudmFzOiBzb3VyY2VDYW52YXMsXG4gICAgICAgICAgICAgICAgdGFyZ2V0Q2FudmFzOiB0YXJnZXRDYW52YXMsXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRhcmdldFdpZHRoXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0Q2FudmFzLnFxSW1hZ2VSZW5kZXJlZCAmJiB0YXJnZXRDYW52YXMucXFJbWFnZVJlbmRlcmVkKCk7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICB9LCBwcm9taXNlLmZhaWx1cmUpO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtQ29vcmRpbmF0ZShjYW52YXMsIHdpZHRoLCBoZWlnaHQsIG9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IHdpZHRoO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgc3dpdGNoIChvcmllbnRhdGlvbikge1xuICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCwgMCk7XG4gICAgICAgICAgICAgICAgY3R4LnNjYWxlKC0xLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBjdHgucm90YXRlKE1hdGguUEkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKDAsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgY3R4LnNjYWxlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSguNSAqIE1hdGguUEkpO1xuICAgICAgICAgICAgICAgIGN0eC5zY2FsZSgxLCAtMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoLjUgKiBNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKDAsIC1oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICBjdHgucm90YXRlKC41ICogTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCwgLWhlaWdodCk7XG4gICAgICAgICAgICAgICAgY3R4LnNjYWxlKC0xLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSgtLjUgKiBNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKC13aWR0aCwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBNZWdhUGl4SW1hZ2Uoc3JjSW1hZ2UsIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGlmICh3aW5kb3cuQmxvYiAmJiBzcmNJbWFnZSBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKSwgVVJMID0gd2luZG93LlVSTCAmJiB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTCA/IHdpbmRvdy5VUkwgOiB3aW5kb3cud2Via2l0VVJMICYmIHdpbmRvdy53ZWJraXRVUkwuY3JlYXRlT2JqZWN0VVJMID8gd2luZG93LndlYmtpdFVSTCA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghVVJMKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIGNyZWF0ZU9iamVjdFVSTCBmdW5jdGlvbiBmb3VuZCB0byBjcmVhdGUgYmxvYiB1cmxcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc3JjSW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmJsb2IgPSBzcmNJbWFnZTtcbiAgICAgICAgICAgICAgICAgICAgc3JjSW1hZ2UgPSBpbWc7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc3JjSW1hZ2UubmF0dXJhbFdpZHRoICYmICFzcmNJbWFnZS5uYXR1cmFsSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgc3JjSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ZW5lcnMgPSBzZWxmLmltYWdlTG9hZExpc3RlbmVycztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbWFnZUxvYWRMaXN0ZW5lcnMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyc1tpXSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzcmNJbWFnZS5vbmVycm9yID0gZXJyb3JDYWxsYmFjaztcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlTG9hZExpc3RlbmVycyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zcmNJbWFnZSA9IHNyY0ltYWdlO1xuICAgICAgICB9XG4gICAgICAgIE1lZ2FQaXhJbWFnZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24odGFyZ2V0LCBvcHRpb25zKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgaW1nV2lkdGggPSB0aGlzLnNyY0ltYWdlLm5hdHVyYWxXaWR0aCwgaW1nSGVpZ2h0ID0gdGhpcy5zcmNJbWFnZS5uYXR1cmFsSGVpZ2h0LCB3aWR0aCA9IG9wdGlvbnMud2lkdGgsIGhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0LCBtYXhXaWR0aCA9IG9wdGlvbnMubWF4V2lkdGgsIG1heEhlaWdodCA9IG9wdGlvbnMubWF4SGVpZ2h0LCBkb1NxdWFzaCA9ICF0aGlzLmJsb2IgfHwgdGhpcy5ibG9iLnR5cGUgPT09IFwiaW1hZ2UvanBlZ1wiLCB0YWdOYW1lID0gdGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSwgb3B0O1xuICAgICAgICAgICAgaWYgKHRoaXMuaW1hZ2VMb2FkTGlzdGVuZXJzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWFnZUxvYWRMaXN0ZW5lcnMucHVzaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIodGFyZ2V0LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod2lkdGggJiYgIWhlaWdodCkge1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGltZ0hlaWdodCAqIHdpZHRoIC8gaW1nV2lkdGggPDwgMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVpZ2h0ICYmICF3aWR0aCkge1xuICAgICAgICAgICAgICAgIHdpZHRoID0gaW1nV2lkdGggKiBoZWlnaHQgLyBpbWdIZWlnaHQgPDwgMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBpbWdXaWR0aDtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBpbWdIZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF4V2lkdGggJiYgd2lkdGggPiBtYXhXaWR0aCkge1xuICAgICAgICAgICAgICAgIHdpZHRoID0gbWF4V2lkdGg7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaW1nSGVpZ2h0ICogd2lkdGggLyBpbWdXaWR0aCA8PCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1heEhlaWdodCAmJiBoZWlnaHQgPiBtYXhIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBtYXhIZWlnaHQ7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBpbWdXaWR0aCAqIGhlaWdodCAvIGltZ0hlaWdodCA8PCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0ID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFxuICAgICAgICAgICAgfSwgcXEuZWFjaChvcHRpb25zLCBmdW5jdGlvbihvcHRpb25zS2V5LCBvcHRpb25zVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBvcHRbb3B0aW9uc0tleV0gPSBvcHRpb25zVmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0YWdOYW1lID09PSBcImltZ1wiKSB7XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2xkVGFyZ2V0U3JjID0gdGFyZ2V0LnNyYztcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVySW1hZ2VUb0RhdGFVUkwoc2VsZi5zcmNJbWFnZSwgc2VsZi5ibG9iLCBvcHQsIGRvU3F1YXNoKS50aGVuKGZ1bmN0aW9uKGRhdGFVcmkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zcmMgPSBkYXRhVXJpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkVGFyZ2V0U3JjID09PSB0YXJnZXQuc3JjICYmIHRhcmdldC5vbmxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnTmFtZSA9PT0gXCJjYW52YXNcIikge1xuICAgICAgICAgICAgICAgIHJlbmRlckltYWdlVG9DYW52YXModGhpcy5zcmNJbWFnZSwgdGhpcy5ibG9iLCB0YXJnZXQsIG9wdCwgZG9TcXVhc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9ucmVuZGVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9ucmVuZGVyKHRhcmdldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLk1lZ2FQaXhJbWFnZSA9IE1lZ2FQaXhJbWFnZTtcbiAgICB9KSgpO1xuICAgIHFxLkltYWdlR2VuZXJhdG9yID0gZnVuY3Rpb24obG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBmdW5jdGlvbiBpc0ltZyhlbCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbWdcIjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0NhbnZhcyhlbCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJjYW52YXNcIjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0ltZ0NvcnNTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEltYWdlKCkuY3Jvc3NPcmlnaW4gIT09IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBpc0NhbnZhc1N1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lTWltZU9mRmlsZU5hbWUobmFtZVdpdGhQYXRoKSB7XG4gICAgICAgICAgICB2YXIgcGF0aFNlZ21lbnRzID0gbmFtZVdpdGhQYXRoLnNwbGl0KFwiL1wiKSwgbmFtZSA9IHBhdGhTZWdtZW50c1twYXRoU2VnbWVudHMubGVuZ3RoIC0gMV0uc3BsaXQoXCI/XCIpWzBdLCBleHRlbnNpb24gPSBxcS5nZXRFeHRlbnNpb24obmFtZSk7XG4gICAgICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb24gJiYgZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGV4dGVuc2lvbikge1xuICAgICAgICAgICAgICBjYXNlIFwianBlZ1wiOlxuICAgICAgICAgICAgICBjYXNlIFwianBnXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvanBlZ1wiO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJwbmdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS9wbmdcIjtcblxuICAgICAgICAgICAgICBjYXNlIFwiYm1wXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW1hZ2UvYm1wXCI7XG5cbiAgICAgICAgICAgICAgY2FzZSBcImdpZlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL2dpZlwiO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJ0aWZmXCI6XG4gICAgICAgICAgICAgIGNhc2UgXCJ0aWZcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpbWFnZS90aWZmXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNDcm9zc09yaWdpbih1cmwpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXRBbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKSwgdGFyZ2V0UHJvdG9jb2wsIHRhcmdldEhvc3RuYW1lLCB0YXJnZXRQb3J0O1xuICAgICAgICAgICAgdGFyZ2V0QW5jaG9yLmhyZWYgPSB1cmw7XG4gICAgICAgICAgICB0YXJnZXRQcm90b2NvbCA9IHRhcmdldEFuY2hvci5wcm90b2NvbDtcbiAgICAgICAgICAgIHRhcmdldFBvcnQgPSB0YXJnZXRBbmNob3IucG9ydDtcbiAgICAgICAgICAgIHRhcmdldEhvc3RuYW1lID0gdGFyZ2V0QW5jaG9yLmhvc3RuYW1lO1xuICAgICAgICAgICAgaWYgKHRhcmdldFByb3RvY29sLnRvTG93ZXJDYXNlKCkgIT09IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFyZ2V0SG9zdG5hbWUudG9Mb3dlckNhc2UoKSAhPT0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXJnZXRQb3J0ICE9PSB3aW5kb3cubG9jYXRpb24ucG9ydCAmJiAhcXEuaWUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVySW1nTG9hZExpc3RlbmVycyhpbWcsIHByb21pc2UpIHtcbiAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKGltZyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSBkcmF3aW5nIHRodW1ibmFpbCFcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoaW1nLCBcIlByb2JsZW0gZHJhd2luZyB0aHVtYm5haWwhXCIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlckNhbnZhc0RyYXdJbWFnZUxpc3RlbmVyKGNhbnZhcywgcHJvbWlzZSkge1xuICAgICAgICAgICAgY2FudmFzLnFxSW1hZ2VSZW5kZXJlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhjYW52YXMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIoaW1nT3JDYW52YXMsIHByb21pc2UpIHtcbiAgICAgICAgICAgIHZhciByZWdpc3RlcmVkID0gaXNJbWcoaW1nT3JDYW52YXMpIHx8IGlzQ2FudmFzKGltZ09yQ2FudmFzKTtcbiAgICAgICAgICAgIGlmIChpc0ltZyhpbWdPckNhbnZhcykpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlckltZ0xvYWRMaXN0ZW5lcnMoaW1nT3JDYW52YXMsIHByb21pc2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NhbnZhcyhpbWdPckNhbnZhcykpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlckNhbnZhc0RyYXdJbWFnZUxpc3RlbmVyKGltZ09yQ2FudmFzLCBwcm9taXNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKGltZ09yQ2FudmFzKTtcbiAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRWxlbWVudCBjb250YWluZXIgb2YgdHlwZSB7fSBpcyBub3Qgc3VwcG9ydGVkIVwiLCBpbWdPckNhbnZhcy50YWdOYW1lKSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZWdpc3RlcmVkO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoZmlsZU9yQmxvYiwgY29udGFpbmVyLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgZHJhd1ByZXZpZXcgPSBuZXcgcXEuUHJvbWlzZSgpLCBpZGVudGlmaWVyID0gbmV3IHFxLklkZW50aWZ5KGZpbGVPckJsb2IsIGxvZyksIG1heFNpemUgPSBvcHRpb25zLm1heFNpemUsIG9yaWVudCA9IG9wdGlvbnMub3JpZW50ID09IG51bGwgPyB0cnVlIDogb3B0aW9ucy5vcmllbnQsIG1lZ2FwaXhFcnJvckhhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIub25lcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgbG9nKFwiQ291bGQgbm90IHJlbmRlciBwcmV2aWV3LCBmaWxlIG1heSBiZSB0b28gbGFyZ2UhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgZHJhd1ByZXZpZXcuZmFpbHVyZShjb250YWluZXIsIFwiQnJvd3NlciBjYW5ub3QgcmVuZGVyIGltYWdlIVwiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZGVudGlmaWVyLmlzUHJldmlld2FibGUoKS50aGVuKGZ1bmN0aW9uKG1pbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZHVtbXlFeGlmID0ge1xuICAgICAgICAgICAgICAgICAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLlByb21pc2UoKS5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBleGlmID0gb3JpZW50ID8gbmV3IHFxLkV4aWYoZmlsZU9yQmxvYiwgbG9nKSA6IGR1bW15RXhpZiwgbXBJbWcgPSBuZXcgcXEuTWVnYVBpeEltYWdlKGZpbGVPckJsb2IsIG1lZ2FwaXhFcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIGlmIChyZWdpc3RlclRodW1ibmFpbFJlbmRlcmVkTGlzdGVuZXIoY29udGFpbmVyLCBkcmF3UHJldmlldykpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhpZi5wYXJzZSgpLnRoZW4oZnVuY3Rpb24oZXhpZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWVudGF0aW9uID0gZXhpZiAmJiBleGlmLk9yaWVudGF0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgbXBJbWcucmVuZGVyKGNvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogb3JpZW50YXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWltZTogbWltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemU6IG9wdGlvbnMuY3VzdG9tUmVzaXplRnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihmYWlsdXJlTXNnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRVhJRiBkYXRhIGNvdWxkIG5vdCBiZSBwYXJzZWQgKHt9KS4gIEFzc3VtaW5nIG9yaWVudGF0aW9uID0gMS5cIiwgZmFpbHVyZU1zZykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbXBJbWcucmVuZGVyKGNvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW1lOiBtaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogb3B0aW9ucy5jdXN0b21SZXNpemVGdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIk5vdCBwcmV2aWV3YWJsZVwiKTtcbiAgICAgICAgICAgICAgICBkcmF3UHJldmlldy5mYWlsdXJlKGNvbnRhaW5lciwgXCJOb3QgcHJldmlld2FibGVcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBkcmF3UHJldmlldztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkcmF3T25DYW52YXNPckltZ0Zyb21VcmwodXJsLCBjYW52YXNPckltZywgZHJhdywgbWF4U2l6ZSwgY3VzdG9tUmVzaXplRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHZhciB0ZW1wSW1nID0gbmV3IEltYWdlKCksIHRlbXBJbWdSZW5kZXIgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgcmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKHRlbXBJbWcsIHRlbXBJbWdSZW5kZXIpO1xuICAgICAgICAgICAgaWYgKGlzQ3Jvc3NPcmlnaW4odXJsKSkge1xuICAgICAgICAgICAgICAgIHRlbXBJbWcuY3Jvc3NPcmlnaW4gPSBcImFub255bW91c1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGVtcEltZy5zcmMgPSB1cmw7XG4gICAgICAgICAgICB0ZW1wSW1nUmVuZGVyLnRoZW4oZnVuY3Rpb24gcmVuZGVyZWQoKSB7XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKGNhbnZhc09ySW1nLCBkcmF3KTtcbiAgICAgICAgICAgICAgICB2YXIgbXBJbWcgPSBuZXcgcXEuTWVnYVBpeEltYWdlKHRlbXBJbWcpO1xuICAgICAgICAgICAgICAgIG1wSW1nLnJlbmRlcihjYW52YXNPckltZywge1xuICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogbWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBtYXhTaXplLFxuICAgICAgICAgICAgICAgICAgICBtaW1lOiBkZXRlcm1pbmVNaW1lT2ZGaWxlTmFtZSh1cmwpLFxuICAgICAgICAgICAgICAgICAgICByZXNpemU6IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCBkcmF3LmZhaWx1cmUpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGRyYXdPbkltZ0Zyb21VcmxXaXRoQ3NzU2NhbGluZyh1cmwsIGltZywgZHJhdywgbWF4U2l6ZSkge1xuICAgICAgICAgICAgcmVnaXN0ZXJUaHVtYm5haWxSZW5kZXJlZExpc3RlbmVyKGltZywgZHJhdyk7XG4gICAgICAgICAgICBxcShpbWcpLmNzcyh7XG4gICAgICAgICAgICAgICAgbWF4V2lkdGg6IG1heFNpemUgKyBcInB4XCIsXG4gICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBtYXhTaXplICsgXCJweFwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGltZy5zcmMgPSB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZHJhd0Zyb21VcmwodXJsLCBjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBkcmF3ID0gbmV3IHFxLlByb21pc2UoKSwgc2NhbGUgPSBvcHRpb25zLnNjYWxlLCBtYXhTaXplID0gc2NhbGUgPyBvcHRpb25zLm1heFNpemUgOiBudWxsO1xuICAgICAgICAgICAgaWYgKHNjYWxlICYmIGlzSW1nKGNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNDYW52YXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDcm9zc09yaWdpbih1cmwpICYmICFpc0ltZ0NvcnNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd09uSW1nRnJvbVVybFdpdGhDc3NTY2FsaW5nKHVybCwgY29udGFpbmVyLCBkcmF3LCBtYXhTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdPbkNhbnZhc09ySW1nRnJvbVVybCh1cmwsIGNvbnRhaW5lciwgZHJhdywgbWF4U2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkcmF3T25JbWdGcm9tVXJsV2l0aENzc1NjYWxpbmcodXJsLCBjb250YWluZXIsIGRyYXcsIG1heFNpemUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDYW52YXMoY29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgIGRyYXdPbkNhbnZhc09ySW1nRnJvbVVybCh1cmwsIGNvbnRhaW5lciwgZHJhdywgbWF4U2l6ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlZ2lzdGVyVGh1bWJuYWlsUmVuZGVyZWRMaXN0ZW5lcihjb250YWluZXIsIGRyYXcpKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnNyYyA9IHVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkcmF3O1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBnZW5lcmF0ZTogZnVuY3Rpb24oZmlsZUJsb2JPclVybCwgY29udGFpbmVyLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKGZpbGVCbG9iT3JVcmwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkF0dGVtcHRpbmcgdG8gdXBkYXRlIHRodW1ibmFpbCBiYXNlZCBvbiBzZXJ2ZXIgcmVzcG9uc2UuXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHJhd0Zyb21VcmwoZmlsZUJsb2JPclVybCwgY29udGFpbmVyLCBvcHRpb25zIHx8IHt9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJBdHRlbXB0aW5nIHRvIGRyYXcgY2xpZW50LXNpZGUgaW1hZ2UgcHJldmlldy5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkcmF3KGZpbGVCbG9iT3JVcmwsIGNvbnRhaW5lciwgb3B0aW9ucyB8fCB7fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGVzdGluZyA9IHt9O1xuICAgICAgICB0aGlzLl90ZXN0aW5nLmlzSW1nID0gaXNJbWc7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcuaXNDYW52YXMgPSBpc0NhbnZhcztcbiAgICAgICAgdGhpcy5fdGVzdGluZy5pc0Nyb3NzT3JpZ2luID0gaXNDcm9zc09yaWdpbjtcbiAgICAgICAgdGhpcy5fdGVzdGluZy5kZXRlcm1pbmVNaW1lT2ZGaWxlTmFtZSA9IGRldGVybWluZU1pbWVPZkZpbGVOYW1lO1xuICAgIH07XG4gICAgcXEuRXhpZiA9IGZ1bmN0aW9uKGZpbGVPckJsb2IsIGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIFRBR19JRFMgPSBbIDI3NCBdLCBUQUdfSU5GTyA9IHtcbiAgICAgICAgICAgIDI3NDoge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiT3JpZW50YXRpb25cIixcbiAgICAgICAgICAgICAgICBieXRlczogMlxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBmdW5jdGlvbiBwYXJzZUxpdHRsZUVuZGlhbihoZXgpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwLCBwb3cgPSAwO1xuICAgICAgICAgICAgd2hpbGUgKGhleC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhcnNlSW50KGhleC5zdWJzdHJpbmcoMCwgMiksIDE2KSAqIE1hdGgucG93KDIsIHBvdyk7XG4gICAgICAgICAgICAgICAgaGV4ID0gaGV4LnN1YnN0cmluZygyLCBoZXgubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBwb3cgKz0gODtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2Vla1RvQXBwMShvZmZzZXQsIHByb21pc2UpIHtcbiAgICAgICAgICAgIHZhciB0aGVPZmZzZXQgPSBvZmZzZXQsIHRoZVByb21pc2UgPSBwcm9taXNlO1xuICAgICAgICAgICAgaWYgKHRoZU9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhlT2Zmc2V0ID0gMjtcbiAgICAgICAgICAgICAgICB0aGVQcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgdGhlT2Zmc2V0LCA0KS50aGVuKGZ1bmN0aW9uKGhleCkge1xuICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IC9eZmZlKFswLTldKS8uZXhlYyhoZXgpLCBzZWdtZW50TGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hbMV0gIT09IFwiMVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50TGVuZ3RoID0gcGFyc2VJbnQoaGV4LnNsaWNlKDQsIDgpLCAxNik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWVrVG9BcHAxKHRoZU9mZnNldCArIHNlZ21lbnRMZW5ndGggKyAyLCB0aGVQcm9taXNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoZVByb21pc2Uuc3VjY2Vzcyh0aGVPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhlUHJvbWlzZS5mYWlsdXJlKFwiTm8gRVhJRiBoZWFkZXIgdG8gYmUgZm91bmQhXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoZVByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0QXBwMU9mZnNldCgpIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgMCwgNikudGhlbihmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGV4LmluZGV4T2YoXCJmZmQ4XCIpICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShcIk5vdCBhIHZhbGlkIEpQRUchXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlZWtUb0FwcDEoKS50aGVuKGZ1bmN0aW9uKG9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKG9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmZhaWx1cmUoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzTGl0dGxlRW5kaWFuKGFwcDFTdGFydCkge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgcXEucmVhZEJsb2JUb0hleChmaWxlT3JCbG9iLCBhcHAxU3RhcnQgKyAxMCwgMikudGhlbihmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MoaGV4ID09PSBcIjQ5NDlcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldERpckVudHJ5Q291bnQoYXBwMVN0YXJ0LCBsaXR0bGVFbmRpYW4pIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgYXBwMVN0YXJ0ICsgMTgsIDIpLnRoZW4oZnVuY3Rpb24oaGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpdHRsZUVuZGlhbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZS5zdWNjZXNzKHBhcnNlTGl0dGxlRW5kaWFuKGhleCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhwYXJzZUludChoZXgsIDE2KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRJZmQoYXBwMVN0YXJ0LCBkaXJFbnRyaWVzKSB7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gYXBwMVN0YXJ0ICsgMjAsIGJ5dGVzID0gZGlyRW50cmllcyAqIDEyO1xuICAgICAgICAgICAgcmV0dXJuIHFxLnJlYWRCbG9iVG9IZXgoZmlsZU9yQmxvYiwgb2Zmc2V0LCBieXRlcyk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGlyRW50cmllcyhpZmRIZXgpIHtcbiAgICAgICAgICAgIHZhciBlbnRyaWVzID0gW10sIG9mZnNldCA9IDA7XG4gICAgICAgICAgICB3aGlsZSAob2Zmc2V0ICsgMjQgPD0gaWZkSGV4Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChpZmRIZXguc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyAyNCkpO1xuICAgICAgICAgICAgICAgIG9mZnNldCArPSAyNDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbnRyaWVzO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldFRhZ1ZhbHVlcyhsaXR0bGVFbmRpYW4sIGRpckVudHJpZXMpIHtcbiAgICAgICAgICAgIHZhciBUQUdfVkFMX09GRlNFVCA9IDE2LCB0YWdzVG9GaW5kID0gcXEuZXh0ZW5kKFtdLCBUQUdfSURTKSwgdmFscyA9IHt9O1xuICAgICAgICAgICAgcXEuZWFjaChkaXJFbnRyaWVzLCBmdW5jdGlvbihpZHgsIGVudHJ5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkSGV4ID0gZW50cnkuc2xpY2UoMCwgNCksIGlkID0gbGl0dGxlRW5kaWFuID8gcGFyc2VMaXR0bGVFbmRpYW4oaWRIZXgpIDogcGFyc2VJbnQoaWRIZXgsIDE2KSwgdGFnc1RvRmluZElkeCA9IHRhZ3NUb0ZpbmQuaW5kZXhPZihpZCksIHRhZ1ZhbEhleCwgdGFnTmFtZSwgdGFnVmFsTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0YWdzVG9GaW5kSWR4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGFnTmFtZSA9IFRBR19JTkZPW2lkXS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0YWdWYWxMZW5ndGggPSBUQUdfSU5GT1tpZF0uYnl0ZXM7XG4gICAgICAgICAgICAgICAgICAgIHRhZ1ZhbEhleCA9IGVudHJ5LnNsaWNlKFRBR19WQUxfT0ZGU0VULCBUQUdfVkFMX09GRlNFVCArIHRhZ1ZhbExlbmd0aCAqIDIpO1xuICAgICAgICAgICAgICAgICAgICB2YWxzW3RhZ05hbWVdID0gbGl0dGxlRW5kaWFuID8gcGFyc2VMaXR0bGVFbmRpYW4odGFnVmFsSGV4KSA6IHBhcnNlSW50KHRhZ1ZhbEhleCwgMTYpO1xuICAgICAgICAgICAgICAgICAgICB0YWdzVG9GaW5kLnNwbGljZSh0YWdzVG9GaW5kSWR4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRhZ3NUb0ZpbmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB2YWxzO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBwYXJzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBxcS5Qcm9taXNlKCksIG9uUGFyc2VGYWlsdXJlID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiRVhJRiBoZWFkZXIgcGFyc2UgZmFpbGVkOiAne30nIFwiLCBtZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlci5mYWlsdXJlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZ2V0QXBwMU9mZnNldCgpLnRoZW4oZnVuY3Rpb24oYXBwMU9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiTW92aW5nIGZvcndhcmQgd2l0aCBFWElGIGhlYWRlciBwYXJzaW5nIGZvciAne30nXCIsIGZpbGVPckJsb2IubmFtZSA9PT0gdW5kZWZpbmVkID8gXCJibG9iXCIgOiBmaWxlT3JCbG9iLm5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgaXNMaXR0bGVFbmRpYW4oYXBwMU9mZnNldCkudGhlbihmdW5jdGlvbihsaXR0bGVFbmRpYW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCJFWElGIEJ5dGUgb3JkZXIgaXMge30gZW5kaWFuXCIsIGxpdHRsZUVuZGlhbiA/IFwibGl0dGxlXCIgOiBcImJpZ1wiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXREaXJFbnRyeUNvdW50KGFwcDFPZmZzZXQsIGxpdHRsZUVuZGlhbikudGhlbihmdW5jdGlvbihkaXJFbnRyeUNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkZvdW5kIHt9IEFQUDEgZGlyZWN0b3J5IGVudHJpZXNcIiwgZGlyRW50cnlDb3VudCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldElmZChhcHAxT2Zmc2V0LCBkaXJFbnRyeUNvdW50KS50aGVuKGZ1bmN0aW9uKGlmZEhleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlyRW50cmllcyA9IGdldERpckVudHJpZXMoaWZkSGV4KSwgdGFnVmFsdWVzID0gZ2V0VGFnVmFsdWVzKGxpdHRsZUVuZGlhbiwgZGlyRW50cmllcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlN1Y2Nlc3NmdWxseSBwYXJzZWQgc29tZSBFWElGIHRhZ3NcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5zdWNjZXNzKHRhZ1ZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgb25QYXJzZUZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgb25QYXJzZUZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICB9LCBvblBhcnNlRmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgfSwgb25QYXJzZUZhaWx1cmUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90ZXN0aW5nID0ge307XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcucGFyc2VMaXR0bGVFbmRpYW4gPSBwYXJzZUxpdHRsZUVuZGlhbjtcbiAgICB9O1xuICAgIHFxLklkZW50aWZ5ID0gZnVuY3Rpb24oZmlsZU9yQmxvYiwgbG9nKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBmdW5jdGlvbiBpc0lkZW50aWZpYWJsZShtYWdpY0J5dGVzLCBxdWVzdGlvbmFibGVCeXRlcykge1xuICAgICAgICAgICAgdmFyIGlkZW50aWZpYWJsZSA9IGZhbHNlLCBtYWdpY0J5dGVzRW50cmllcyA9IFtdLmNvbmNhdChtYWdpY0J5dGVzKTtcbiAgICAgICAgICAgIHFxLmVhY2gobWFnaWNCeXRlc0VudHJpZXMsIGZ1bmN0aW9uKGlkeCwgbWFnaWNCeXRlc0FycmF5RW50cnkpIHtcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25hYmxlQnl0ZXMuaW5kZXhPZihtYWdpY0J5dGVzQXJyYXlFbnRyeSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmlhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpYWJsZTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgaXNQcmV2aWV3YWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBpZGVudGlmaWVyID0gbmV3IHFxLlByb21pc2UoKSwgcHJldmlld2FibGUgPSBmYWxzZSwgbmFtZSA9IGZpbGVPckJsb2IubmFtZSA9PT0gdW5kZWZpbmVkID8gXCJibG9iXCIgOiBmaWxlT3JCbG9iLm5hbWU7XG4gICAgICAgICAgICAgICAgbG9nKHFxLmZvcm1hdChcIkF0dGVtcHRpbmcgdG8gZGV0ZXJtaW5lIGlmIHt9IGNhbiBiZSByZW5kZXJlZCBpbiB0aGlzIGJyb3dzZXJcIiwgbmFtZSkpO1xuICAgICAgICAgICAgICAgIGxvZyhcIkZpcnN0IHBhc3M6IGNoZWNrIHR5cGUgYXR0cmlidXRlIG9mIGJsb2Igb2JqZWN0LlwiKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZpZXdhYmxlU3luYygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlNlY29uZCBwYXNzOiBjaGVjayBmb3IgbWFnaWMgYnl0ZXMgaW4gZmlsZSBoZWFkZXIuXCIpO1xuICAgICAgICAgICAgICAgICAgICBxcS5yZWFkQmxvYlRvSGV4KGZpbGVPckJsb2IsIDAsIDQpLnRoZW4oZnVuY3Rpb24oaGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKHNlbGYuUFJFVklFV0FCTEVfTUlNRV9UWVBFUywgZnVuY3Rpb24obWltZSwgYnl0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJZGVudGlmaWFibGUoYnl0ZXMsIGhleCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1pbWUgIT09IFwiaW1hZ2UvdGlmZlwiIHx8IHFxLnN1cHBvcnRlZEZlYXR1cmVzLnRpZmZQcmV2aWV3cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld2FibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllci5zdWNjZXNzKG1pbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhxcS5mb3JtYXQoXCIne30nIGlzIHt9IGFibGUgdG8gYmUgcmVuZGVyZWQgaW4gdGhpcyBicm93c2VyXCIsIG5hbWUsIHByZXZpZXdhYmxlID8gXCJcIiA6IFwiTk9UXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJldmlld2FibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJFcnJvciByZWFkaW5nIGZpbGUgdy8gbmFtZSAnXCIgKyBuYW1lICsgXCInLiAgTm90IGFibGUgdG8gYmUgcmVuZGVyZWQgaW4gdGhpcyBicm93c2VyLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXIuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNQcmV2aWV3YWJsZVN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlTWltZSA9IGZpbGVPckJsb2IudHlwZSwgaXNSZWNvZ25pemVkSW1hZ2UgPSBxcS5pbmRleE9mKE9iamVjdC5rZXlzKHRoaXMuUFJFVklFV0FCTEVfTUlNRV9UWVBFUyksIGZpbGVNaW1lKSA+PSAwLCBwcmV2aWV3YWJsZSA9IGZhbHNlLCBuYW1lID0gZmlsZU9yQmxvYi5uYW1lID09PSB1bmRlZmluZWQgPyBcImJsb2JcIiA6IGZpbGVPckJsb2IubmFtZTtcbiAgICAgICAgICAgICAgICBpZiAoaXNSZWNvZ25pemVkSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVNaW1lID09PSBcImltYWdlL3RpZmZcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld2FibGUgPSBxcS5zdXBwb3J0ZWRGZWF0dXJlcy50aWZmUHJldmlld3M7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3YWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIXByZXZpZXdhYmxlICYmIGxvZyhuYW1lICsgXCIgaXMgbm90IHByZXZpZXdhYmxlIGluIHRoaXMgYnJvd3NlciBwZXIgdGhlIGJsb2IncyB0eXBlIGF0dHJcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXZpZXdhYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLklkZW50aWZ5LnByb3RvdHlwZS5QUkVWSUVXQUJMRV9NSU1FX1RZUEVTID0ge1xuICAgICAgICBcImltYWdlL2pwZWdcIjogXCJmZmQ4ZmZcIixcbiAgICAgICAgXCJpbWFnZS9naWZcIjogXCI0NzQ5NDZcIixcbiAgICAgICAgXCJpbWFnZS9wbmdcIjogXCI4OTUwNGVcIixcbiAgICAgICAgXCJpbWFnZS9ibXBcIjogXCI0MjRkXCIsXG4gICAgICAgIFwiaW1hZ2UvdGlmZlwiOiBbIFwiNDk0OTJhMDBcIiwgXCI0ZDRkMDAyYVwiIF1cbiAgICB9O1xuICAgIHFxLkltYWdlVmFsaWRhdGlvbiA9IGZ1bmN0aW9uKGJsb2IsIGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgZnVuY3Rpb24gaGFzTm9uWmVyb0xpbWl0cyhsaW1pdHMpIHtcbiAgICAgICAgICAgIHZhciBhdExlYXN0T25lID0gZmFsc2U7XG4gICAgICAgICAgICBxcS5lYWNoKGxpbWl0cywgZnVuY3Rpb24obGltaXQsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBhdExlYXN0T25lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGF0TGVhc3RPbmU7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0V2lkdGhIZWlnaHQoKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZURldGVybWluYXRpb24gPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgbmV3IHFxLklkZW50aWZ5KGJsb2IsIGxvZykuaXNQcmV2aWV3YWJsZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCksIHVybCA9IHdpbmRvdy5VUkwgJiYgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwgPyB3aW5kb3cuVVJMIDogd2luZG93LndlYmtpdFVSTCAmJiB3aW5kb3cud2Via2l0VVJMLmNyZWF0ZU9iamVjdFVSTCA/IHdpbmRvdy53ZWJraXRVUkwgOiBudWxsO1xuICAgICAgICAgICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2Uub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiQ2Fubm90IGRldGVybWluZSBkaW1lbnNpb25zIGZvciBpbWFnZS4gIE1heSBiZSB0b28gbGFyZ2UuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplRGV0ZXJtaW5hdGlvbi5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZURldGVybWluYXRpb24uc3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLnNyYyA9IHVybC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiTm8gY3JlYXRlT2JqZWN0VVJMIGZ1bmN0aW9uIGF2YWlsYWJsZSB0byBnZW5lcmF0ZSBpbWFnZSBVUkwhXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHNpemVEZXRlcm1pbmF0aW9uLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBzaXplRGV0ZXJtaW5hdGlvbi5mYWlsdXJlKTtcbiAgICAgICAgICAgIHJldHVybiBzaXplRGV0ZXJtaW5hdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZXRGYWlsaW5nTGltaXQobGltaXRzLCBkaW1lbnNpb25zKSB7XG4gICAgICAgICAgICB2YXIgZmFpbGluZ0xpbWl0O1xuICAgICAgICAgICAgcXEuZWFjaChsaW1pdHMsIGZ1bmN0aW9uKGxpbWl0TmFtZSwgbGltaXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChsaW1pdFZhbHVlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGltaXRNYXRjaGVyID0gLyhtYXh8bWluKShXaWR0aHxIZWlnaHQpLy5leGVjKGxpbWl0TmFtZSksIGRpbWVuc2lvblByb3BOYW1lID0gbGltaXRNYXRjaGVyWzJdLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgbGltaXRNYXRjaGVyWzJdLnNsaWNlKDEpLCBhY3R1YWxWYWx1ZSA9IGRpbWVuc2lvbnNbZGltZW5zaW9uUHJvcE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGxpbWl0TWF0Y2hlclsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJtaW5cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3R1YWxWYWx1ZSA8IGxpbWl0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsaW5nTGltaXQgPSBsaW1pdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibWF4XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0dWFsVmFsdWUgPiBsaW1pdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGluZ0xpbWl0ID0gbGltaXROYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZmFpbGluZ0xpbWl0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudmFsaWRhdGUgPSBmdW5jdGlvbihsaW1pdHMpIHtcbiAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgIGxvZyhcIkF0dGVtcHRpbmcgdG8gdmFsaWRhdGUgaW1hZ2UuXCIpO1xuICAgICAgICAgICAgaWYgKGhhc05vblplcm9MaW1pdHMobGltaXRzKSkge1xuICAgICAgICAgICAgICAgIGdldFdpZHRoSGVpZ2h0KCkudGhlbihmdW5jdGlvbihkaW1lbnNpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsaW5nTGltaXQgPSBnZXRGYWlsaW5nTGltaXQobGltaXRzLCBkaW1lbnNpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWxpbmdMaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbkVmZm9ydC5mYWlsdXJlKGZhaWxpbmdMaW1pdCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uRWZmb3J0LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHZhbGlkYXRpb25FZmZvcnQuc3VjY2Vzcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRpb25FZmZvcnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25FZmZvcnQ7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBxcS5TZXNzaW9uID0gZnVuY3Rpb24oc3BlYykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogbnVsbCxcbiAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgIGNvcnM6IHt9LFxuICAgICAgICAgICAgYWRkRmlsZVJlY29yZDogZnVuY3Rpb24oc2Vzc2lvbkRhdGEpIHt9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIHNwZWMsIHRydWUpO1xuICAgICAgICBmdW5jdGlvbiBpc0pzb25SZXNwb25zZVZhbGlkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocXEuaXNBcnJheShyZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wdGlvbnMubG9nKFwiU2Vzc2lvbiByZXNwb25zZSBpcyBub3QgYW4gYXJyYXkuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRmlsZUl0ZW1zKGZpbGVJdGVtcywgc3VjY2VzcywgeGhyT3JYZHIsIHByb21pc2UpIHtcbiAgICAgICAgICAgIHZhciBzb21lSXRlbXNJZ25vcmVkID0gZmFsc2U7XG4gICAgICAgICAgICBzdWNjZXNzID0gc3VjY2VzcyAmJiBpc0pzb25SZXNwb25zZVZhbGlkKGZpbGVJdGVtcyk7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHFxLmVhY2goZmlsZUl0ZW1zLCBmdW5jdGlvbihpZHgsIGZpbGVJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlSXRlbS51dWlkID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvbWVJdGVtc0lnbm9yZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sb2cocXEuZm9ybWF0KFwiU2Vzc2lvbiByZXNwb25zZSBpdGVtIHt9IGRpZCBub3QgaW5jbHVkZSBhIHZhbGlkIFVVSUQgLSBpZ25vcmluZy5cIiwgaWR4KSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlSXRlbS5uYW1lID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvbWVJdGVtc0lnbm9yZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sb2cocXEuZm9ybWF0KFwiU2Vzc2lvbiByZXNwb25zZSBpdGVtIHt9IGRpZCBub3QgaW5jbHVkZSBhIHZhbGlkIG5hbWUgLSBpZ25vcmluZy5cIiwgaWR4KSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hZGRGaWxlUmVjb3JkKGZpbGVJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbWVJdGVtc0lnbm9yZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubG9nKGVyci5tZXNzYWdlLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb21pc2Vbc3VjY2VzcyAmJiAhc29tZUl0ZW1zSWdub3JlZCA/IFwic3VjY2Vzc1wiIDogXCJmYWlsdXJlXCJdKGZpbGVJdGVtcywgeGhyT3JYZHIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHJlZnJlc2hFZmZvcnQgPSBuZXcgcXEuUHJvbWlzZSgpLCByZWZyZXNoQ29tcGxldGVDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBzdWNjZXNzLCB4aHJPclhkcikge1xuICAgICAgICAgICAgICAgIGhhbmRsZUZpbGVJdGVtcyhyZXNwb25zZSwgc3VjY2VzcywgeGhyT3JYZHIsIHJlZnJlc2hFZmZvcnQpO1xuICAgICAgICAgICAgfSwgcmVxdWVzdGVyT3B0aW9ucyA9IHFxLmV4dGVuZCh7fSwgb3B0aW9ucyksIHJlcXVlc3RlciA9IG5ldyBxcS5TZXNzaW9uQWpheFJlcXVlc3RlcihxcS5leHRlbmQocmVxdWVzdGVyT3B0aW9ucywge1xuICAgICAgICAgICAgICAgIG9uQ29tcGxldGU6IHJlZnJlc2hDb21wbGV0ZUNhbGxiYWNrXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByZXF1ZXN0ZXIucXVlcnlTZXJ2ZXIoKTtcbiAgICAgICAgICAgIHJldHVybiByZWZyZXNoRWZmb3J0O1xuICAgICAgICB9O1xuICAgIH07XG4gICAgcXEuU2Vzc2lvbkFqYXhSZXF1ZXN0ZXIgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgcmVxdWVzdGVyLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgZW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICBjdXN0b21IZWFkZXJzOiB7fSxcbiAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgICBjb3JzOiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNlbmRDcmVkZW50aWFsczogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbihyZXNwb25zZSwgc3VjY2VzcywgeGhyT3JYZHIpIHt9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7fVxuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgc3BlYyk7XG4gICAgICAgIGZ1bmN0aW9uIG9uQ29tcGxldGUoaWQsIHhock9yWGRyLCBpc0Vycm9yKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHhock9yWGRyLnJlc3BvbnNlVGV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBxcS5wYXJzZUpzb24oeGhyT3JYZHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5sb2coXCJQcm9ibGVtIHBhcnNpbmcgc2Vzc2lvbiByZXNwb25zZTogXCIgKyBlcnIubWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgaXNFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9ucy5vbkNvbXBsZXRlKHJlc3BvbnNlLCAhaXNFcnJvciwgeGhyT3JYZHIpO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3RlciA9IHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuQWpheFJlcXVlc3Rlcih7XG4gICAgICAgICAgICBhY2NlcHRIZWFkZXI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgdmFsaWRNZXRob2RzOiBbIFwiR0VUXCIgXSxcbiAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5lbmRwb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3VzdG9tSGVhZGVyczogb3B0aW9ucy5jdXN0b21IZWFkZXJzLFxuICAgICAgICAgICAgbG9nOiBvcHRpb25zLmxvZyxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IG9uQ29tcGxldGUsXG4gICAgICAgICAgICBjb3JzOiBvcHRpb25zLmNvcnNcbiAgICAgICAgfSkpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgcXVlcnlTZXJ2ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBxcS5leHRlbmQoe30sIG9wdGlvbnMucGFyYW1zKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhcIlNlc3Npb24gcXVlcnkgcmVxdWVzdC5cIik7XG4gICAgICAgICAgICAgICAgcmVxdWVzdGVyLmluaXRUcmFuc3BvcnQoXCJzZXNzaW9uUmVmcmVzaFwiKS53aXRoUGFyYW1zKHBhcmFtcykud2l0aENhY2hlQnVzdGVyKCkuc2VuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlNjYWxlciA9IGZ1bmN0aW9uKHNwZWMsIGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBjdXN0b21SZXNpemVGdW5jdGlvbiA9IHNwZWMuY3VzdG9tUmVzaXplciwgaW5jbHVkZU9yaWdpbmFsID0gc3BlYy5zZW5kT3JpZ2luYWwsIG9yaWVudCA9IHNwZWMub3JpZW50LCBkZWZhdWx0VHlwZSA9IHNwZWMuZGVmYXVsdFR5cGUsIGRlZmF1bHRRdWFsaXR5ID0gc3BlYy5kZWZhdWx0UXVhbGl0eSAvIDEwMCwgZmFpbGVkVG9TY2FsZVRleHQgPSBzcGVjLmZhaWx1cmVUZXh0LCBpbmNsdWRlRXhpZiA9IHNwZWMuaW5jbHVkZUV4aWYsIHNpemVzID0gdGhpcy5fZ2V0U29ydGVkU2l6ZXMoc3BlYy5zaXplcyk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICBlbmFibGVkOiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5zY2FsaW5nICYmIHNpemVzLmxlbmd0aCA+IDAsXG4gICAgICAgICAgICBnZXRGaWxlUmVjb3JkczogZnVuY3Rpb24ob3JpZ2luYWxGaWxlVXVpZCwgb3JpZ2luYWxGaWxlTmFtZSwgb3JpZ2luYWxCbG9iT3JCbG9iRGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgcmVjb3JkcyA9IFtdLCBvcmlnaW5hbEJsb2IgPSBvcmlnaW5hbEJsb2JPckJsb2JEYXRhLmJsb2IgPyBvcmlnaW5hbEJsb2JPckJsb2JEYXRhLmJsb2IgOiBvcmlnaW5hbEJsb2JPckJsb2JEYXRhLCBpZGVudGlmaWVyID0gbmV3IHFxLklkZW50aWZ5KG9yaWdpbmFsQmxvYiwgbG9nKTtcbiAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllci5pc1ByZXZpZXdhYmxlU3luYygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goc2l6ZXMsIGZ1bmN0aW9uKGlkeCwgc2l6ZVJlY29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG91dHB1dFR5cGUgPSBzZWxmLl9kZXRlcm1pbmVPdXRwdXRUeXBlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VHlwZTogZGVmYXVsdFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkVHlwZTogc2l6ZVJlY29yZC50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlR5cGU6IG9yaWdpbmFsQmxvYi50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogcXEuZ2V0VW5pcXVlSWQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzZWxmLl9nZXROYW1lKG9yaWdpbmFsRmlsZU5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogc2l6ZVJlY29yZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBvdXRwdXRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZUeXBlOiBvcmlnaW5hbEJsb2IudHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2I6IG5ldyBxcS5CbG9iUHJveHkob3JpZ2luYWxCbG9iLCBxcS5iaW5kKHNlbGYuX2dlbmVyYXRlU2NhbGVkSW1hZ2UsIHNlbGYsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhTaXplOiBzaXplUmVjb3JkLm1heFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWVudDogb3JpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBvdXRwdXRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFsaXR5OiBkZWZhdWx0UXVhbGl0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkVGV4dDogZmFpbGVkVG9TY2FsZVRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVFeGlmOiBpbmNsdWRlRXhpZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nOiBsb2dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IG9yaWdpbmFsRmlsZVV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbEZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogb3JpZ2luYWxCbG9iLnNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9iOiBpbmNsdWRlT3JpZ2luYWwgPyBvcmlnaW5hbEJsb2IgOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBvcmlnaW5hbEZpbGVVdWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogb3JpZ2luYWxGaWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG9yaWdpbmFsQmxvYi5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYjogb3JpZ2luYWxCbG9iXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYW5kbGVOZXdGaWxlOiBmdW5jdGlvbihmaWxlLCBuYW1lLCB1dWlkLCBzaXplLCBmaWxlTGlzdCwgYmF0Y2hJZCwgdXVpZFBhcmFtTmFtZSwgYXBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBidXR0b25JZCA9IGZpbGUucXFCdXR0b25JZCB8fCBmaWxlLmJsb2IgJiYgZmlsZS5ibG9iLnFxQnV0dG9uSWQsIHNjYWxlZElkcyA9IFtdLCBvcmlnaW5hbElkID0gbnVsbCwgYWRkRmlsZVRvSGFuZGxlciA9IGFwaS5hZGRGaWxlVG9IYW5kbGVyLCB1cGxvYWREYXRhID0gYXBpLnVwbG9hZERhdGEsIHBhcmFtc1N0b3JlID0gYXBpLnBhcmFtc1N0b3JlLCBwcm94eUdyb3VwSWQgPSBxcS5nZXRVbmlxdWVJZCgpO1xuICAgICAgICAgICAgICAgIHFxLmVhY2goc2VsZi5nZXRGaWxlUmVjb3Jkcyh1dWlkLCBuYW1lLCBmaWxlKSwgZnVuY3Rpb24oaWR4LCByZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2JTaXplID0gcmVjb3JkLnNpemUsIGlkO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmJsb2IgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2JTaXplID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWQgPSB1cGxvYWREYXRhLmFkZEZpbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogcmVjb3JkLnV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiByZWNvcmQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGJsb2JTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2hJZDogYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5R3JvdXBJZDogcHJveHlHcm91cElkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmJsb2IgaW5zdGFuY2VvZiBxcS5CbG9iUHJveHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZElkcy5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsSWQgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmJsb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEZpbGVUb0hhbmRsZXIoaWQsIHJlY29yZC5ibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiByZWNvcmQuYmxvYlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhLnNldFN0YXR1cyhpZCwgcXEuc3RhdHVzLlJFSkVDVEVEKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goc2NhbGVkSWRzLCBmdW5jdGlvbihpZHgsIHNjYWxlZElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxcGFyZW50dXVpZDogdXBsb2FkRGF0YS5yZXRyaWV2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvcmlnaW5hbElkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcXBhcmVudHNpemU6IHVwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogb3JpZ2luYWxJZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbdXVpZFBhcmFtTmFtZV0gPSB1cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogc2NhbGVkSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhLnNldFBhcmVudElkKHNjYWxlZElkLCBvcmlnaW5hbElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0b3JlLmFkZFJlYWRPbmx5KHNjYWxlZElkLCBwYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjYWxlZElkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW0gPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbVt1dWlkUGFyYW1OYW1lXSA9IHVwbG9hZERhdGEucmV0cmlldmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogb3JpZ2luYWxJZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zU3RvcmUuYWRkUmVhZE9ubHkob3JpZ2luYWxJZCwgcGFyYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBxcS5leHRlbmQocXEuU2NhbGVyLnByb3RvdHlwZSwge1xuICAgICAgICBzY2FsZUltYWdlOiBmdW5jdGlvbihpZCwgc3BlY3MsIGFwaSkge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLnNjYWxpbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcXEuRXJyb3IoXCJTY2FsaW5nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyIVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzY2FsaW5nRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKSwgbG9nID0gYXBpLmxvZywgZmlsZSA9IGFwaS5nZXRGaWxlKGlkKSwgdXBsb2FkRGF0YSA9IGFwaS51cGxvYWREYXRhLnJldHJpZXZlKHtcbiAgICAgICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICAgIH0pLCBuYW1lID0gdXBsb2FkRGF0YSAmJiB1cGxvYWREYXRhLm5hbWUsIHV1aWQgPSB1cGxvYWREYXRhICYmIHVwbG9hZERhdGEudXVpZCwgc2NhbGluZ09wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplcjogc3BlY3MuY3VzdG9tUmVzaXplcixcbiAgICAgICAgICAgICAgICBzZW5kT3JpZ2luYWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9yaWVudDogc3BlY3Mub3JpZW50LFxuICAgICAgICAgICAgICAgIGRlZmF1bHRUeXBlOiBzcGVjcy50eXBlIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgZGVmYXVsdFF1YWxpdHk6IHNwZWNzLnF1YWxpdHksXG4gICAgICAgICAgICAgICAgZmFpbGVkVG9TY2FsZVRleHQ6IFwiVW5hYmxlIHRvIHNjYWxlXCIsXG4gICAgICAgICAgICAgICAgc2l6ZXM6IFsge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBtYXhTaXplOiBzcGVjcy5tYXhTaXplXG4gICAgICAgICAgICAgICAgfSBdXG4gICAgICAgICAgICB9LCBzY2FsZXIgPSBuZXcgcXEuU2NhbGVyKHNjYWxpbmdPcHRpb25zLCBsb2cpO1xuICAgICAgICAgICAgaWYgKCFxcS5TY2FsZXIgfHwgIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmltYWdlUHJldmlld3MgfHwgIWZpbGUpIHtcbiAgICAgICAgICAgICAgICBzY2FsaW5nRWZmb3J0LmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICBsb2coXCJDb3VsZCBub3QgZ2VuZXJhdGUgcmVxdWVzdGVkIHNjYWxlZCBpbWFnZSBmb3IgXCIgKyBpZCArIFwiLiAgXCIgKyBcIlNjYWxpbmcgaXMgZWl0aGVyIG5vdCBwb3NzaWJsZSBpbiB0aGlzIGJyb3dzZXIsIG9yIHRoZSBmaWxlIGNvdWxkIG5vdCBiZSBsb2NhdGVkLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBxcS5iaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gc2NhbGVyLmdldEZpbGVSZWNvcmRzKHV1aWQsIG5hbWUsIGZpbGUpWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkICYmIHJlY29yZC5ibG9iIGluc3RhbmNlb2YgcXEuQmxvYlByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmQuYmxvYi5jcmVhdGUoKS50aGVuKHNjYWxpbmdFZmZvcnQuc3VjY2Vzcywgc2NhbGluZ0VmZm9ydC5mYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhpZCArIFwiIGlzIG5vdCBhIHNjYWxhYmxlIGltYWdlIVwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGluZ0VmZm9ydC5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB0aGlzKSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNjYWxpbmdFZmZvcnQ7XG4gICAgICAgIH0sXG4gICAgICAgIF9kZXRlcm1pbmVPdXRwdXRUeXBlOiBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ZWRUeXBlID0gc3BlYy5yZXF1ZXN0ZWRUeXBlLCBkZWZhdWx0VHlwZSA9IHNwZWMuZGVmYXVsdFR5cGUsIHJlZmVyZW5jZVR5cGUgPSBzcGVjLnJlZlR5cGU7XG4gICAgICAgICAgICBpZiAoIWRlZmF1bHRUeXBlICYmICFyZXF1ZXN0ZWRUeXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZVR5cGUgIT09IFwiaW1hZ2UvanBlZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImltYWdlL3BuZ1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVmZXJlbmNlVHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcmVxdWVzdGVkVHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0VHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxcS5pbmRleE9mKE9iamVjdC5rZXlzKHFxLklkZW50aWZ5LnByb3RvdHlwZS5QUkVWSUVXQUJMRV9NSU1FX1RZUEVTKSwgcmVxdWVzdGVkVHlwZSkgPj0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0ZWRUeXBlID09PSBcImltYWdlL3RpZmZcIikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXEuc3VwcG9ydGVkRmVhdHVyZXMudGlmZlByZXZpZXdzID8gcmVxdWVzdGVkVHlwZSA6IGRlZmF1bHRUeXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdGVkVHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0VHlwZTtcbiAgICAgICAgfSxcbiAgICAgICAgX2dldE5hbWU6IGZ1bmN0aW9uKG9yaWdpbmFsTmFtZSwgc2NhbGVkVmVyc2lvblByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIHN0YXJ0T2ZFeHQgPSBvcmlnaW5hbE5hbWUubGFzdEluZGV4T2YoXCIuXCIpLCB2ZXJzaW9uVHlwZSA9IHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzLnR5cGUgfHwgXCJpbWFnZS9wbmdcIiwgcmVmZXJlbmNlVHlwZSA9IHNjYWxlZFZlcnNpb25Qcm9wZXJ0aWVzLnJlZlR5cGUsIHNjYWxlZE5hbWUgPSBcIlwiLCBzY2FsZWRFeHQgPSBxcS5nZXRFeHRlbnNpb24ob3JpZ2luYWxOYW1lKSwgbmFtZUFwcGVuZGFnZSA9IFwiXCI7XG4gICAgICAgICAgICBpZiAoc2NhbGVkVmVyc2lvblByb3BlcnRpZXMubmFtZSAmJiBzY2FsZWRWZXJzaW9uUHJvcGVydGllcy5uYW1lLnRyaW0oKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBuYW1lQXBwZW5kYWdlID0gXCIgKFwiICsgc2NhbGVkVmVyc2lvblByb3BlcnRpZXMubmFtZSArIFwiKVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0YXJ0T2ZFeHQgPj0gMCkge1xuICAgICAgICAgICAgICAgIHNjYWxlZE5hbWUgPSBvcmlnaW5hbE5hbWUuc3Vic3RyKDAsIHN0YXJ0T2ZFeHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZWZlcmVuY2VUeXBlICE9PSB2ZXJzaW9uVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBzY2FsZWRFeHQgPSB2ZXJzaW9uVHlwZS5zcGxpdChcIi9cIilbMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjYWxlZE5hbWUgKz0gbmFtZUFwcGVuZGFnZSArIFwiLlwiICsgc2NhbGVkRXh0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzY2FsZWROYW1lID0gb3JpZ2luYWxOYW1lICsgbmFtZUFwcGVuZGFnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzY2FsZWROYW1lO1xuICAgICAgICB9LFxuICAgICAgICBfZ2V0U29ydGVkU2l6ZXM6IGZ1bmN0aW9uKHNpemVzKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHNpemVzID0gcXEuZXh0ZW5kKFtdLCBzaXplcyk7XG4gICAgICAgICAgICByZXR1cm4gc2l6ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGEubWF4U2l6ZSA+IGIubWF4U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGEubWF4U2l6ZSA8IGIubWF4U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIF9nZW5lcmF0ZVNjYWxlZEltYWdlOiBmdW5jdGlvbihzcGVjLCBzb3VyY2VGaWxlKSB7XG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywgY3VzdG9tUmVzaXplRnVuY3Rpb24gPSBzcGVjLmN1c3RvbVJlc2l6ZUZ1bmN0aW9uLCBsb2cgPSBzcGVjLmxvZywgbWF4U2l6ZSA9IHNwZWMubWF4U2l6ZSwgb3JpZW50ID0gc3BlYy5vcmllbnQsIHR5cGUgPSBzcGVjLnR5cGUsIHF1YWxpdHkgPSBzcGVjLnF1YWxpdHksIGZhaWxlZFRleHQgPSBzcGVjLmZhaWxlZFRleHQsIGluY2x1ZGVFeGlmID0gc3BlYy5pbmNsdWRlRXhpZiAmJiBzb3VyY2VGaWxlLnR5cGUgPT09IFwiaW1hZ2UvanBlZ1wiICYmIHR5cGUgPT09IFwiaW1hZ2UvanBlZ1wiLCBzY2FsaW5nRWZmb3J0ID0gbmV3IHFxLlByb21pc2UoKSwgaW1hZ2VHZW5lcmF0b3IgPSBuZXcgcXEuSW1hZ2VHZW5lcmF0b3IobG9nKSwgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgICAgIGxvZyhcIkF0dGVtcHRpbmcgdG8gZ2VuZXJhdGUgc2NhbGVkIHZlcnNpb24gZm9yIFwiICsgc291cmNlRmlsZS5uYW1lKTtcbiAgICAgICAgICAgIGltYWdlR2VuZXJhdG9yLmdlbmVyYXRlKHNvdXJjZUZpbGUsIGNhbnZhcywge1xuICAgICAgICAgICAgICAgIG1heFNpemU6IG1heFNpemUsXG4gICAgICAgICAgICAgICAgb3JpZW50OiBvcmllbnQsXG4gICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplRnVuY3Rpb246IGN1c3RvbVJlc2l6ZUZ1bmN0aW9uXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzY2FsZWRJbWFnZURhdGFVcmkgPSBjYW52YXMudG9EYXRhVVJMKHR5cGUsIHF1YWxpdHkpLCBzaWduYWxTdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIlN1Y2Nlc3MgZ2VuZXJhdGluZyBzY2FsZWQgdmVyc2lvbiBmb3IgXCIgKyBzb3VyY2VGaWxlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IHFxLmRhdGFVcmlUb0Jsb2Ioc2NhbGVkSW1hZ2VEYXRhVXJpKTtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGluZ0VmZm9ydC5zdWNjZXNzKGJsb2IpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVFeGlmKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2luc2VydEV4aWZIZWFkZXIoc291cmNlRmlsZSwgc2NhbGVkSW1hZ2VEYXRhVXJpLCBsb2cpLnRoZW4oZnVuY3Rpb24oc2NhbGVkSW1hZ2VEYXRhVXJpV2l0aEV4aWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZEltYWdlRGF0YVVyaSA9IHNjYWxlZEltYWdlRGF0YVVyaVdpdGhFeGlmO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsU3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlByb2JsZW0gaW5zZXJ0aW5nIEVYSUYgaGVhZGVyIGludG8gc2NhbGVkIGltYWdlLiAgVXNpbmcgc2NhbGVkIGltYWdlIHcvb3V0IEVYSUYgZGF0YS5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbFN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbmFsU3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIkZhaWxlZCBhdHRlbXB0IHRvIGdlbmVyYXRlIHNjYWxlZCB2ZXJzaW9uIGZvciBcIiArIHNvdXJjZUZpbGUubmFtZSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICBzY2FsaW5nRWZmb3J0LmZhaWx1cmUoZmFpbGVkVGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBzY2FsaW5nRWZmb3J0O1xuICAgICAgICB9LFxuICAgICAgICBfaW5zZXJ0RXhpZkhlYWRlcjogZnVuY3Rpb24ob3JpZ2luYWxJbWFnZSwgc2NhbGVkSW1hZ2VEYXRhVXJpLCBsb2cpIHtcbiAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCksIGluc2VydGlvbkVmZm9ydCA9IG5ldyBxcS5Qcm9taXNlKCksIG9yaWdpbmFsSW1hZ2VEYXRhVXJpID0gXCJcIjtcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEltYWdlRGF0YVVyaSA9IHJlYWRlci5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaW5zZXJ0aW9uRWZmb3J0LnN1Y2Nlc3MocXEuRXhpZlJlc3RvcmVyLnJlc3RvcmUob3JpZ2luYWxJbWFnZURhdGFVcmksIHNjYWxlZEltYWdlRGF0YVVyaSkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSByZWFkaW5nIFwiICsgb3JpZ2luYWxJbWFnZS5uYW1lICsgXCIgZHVyaW5nIGF0dGVtcHQgdG8gdHJhbnNmZXIgRVhJRiBkYXRhIHRvIHNjYWxlZCB2ZXJzaW9uLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIGluc2VydGlvbkVmZm9ydC5mYWlsdXJlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwob3JpZ2luYWxJbWFnZSk7XG4gICAgICAgICAgICByZXR1cm4gaW5zZXJ0aW9uRWZmb3J0O1xuICAgICAgICB9LFxuICAgICAgICBfZGF0YVVyaVRvQmxvYjogZnVuY3Rpb24oZGF0YVVyaSkge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgYnl0ZVN0cmluZywgbWltZVN0cmluZywgYXJyYXlCdWZmZXIsIGludEFycmF5O1xuICAgICAgICAgICAgaWYgKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzBdLmluZGV4T2YoXCJiYXNlNjRcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIGJ5dGVTdHJpbmcgPSBhdG9iKGRhdGFVcmkuc3BsaXQoXCIsXCIpWzFdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnl0ZVN0cmluZyA9IGRlY29kZVVSSShkYXRhVXJpLnNwbGl0KFwiLFwiKVsxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtaW1lU3RyaW5nID0gZGF0YVVyaS5zcGxpdChcIixcIilbMF0uc3BsaXQoXCI6XCIpWzFdLnNwbGl0KFwiO1wiKVswXTtcbiAgICAgICAgICAgIGFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVTdHJpbmcubGVuZ3RoKTtcbiAgICAgICAgICAgIGludEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpO1xuICAgICAgICAgICAgcXEuZWFjaChieXRlU3RyaW5nLCBmdW5jdGlvbihpZHgsIGNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIGludEFycmF5W2lkeF0gPSBjaGFyYWN0ZXIuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUJsb2IoYXJyYXlCdWZmZXIsIG1pbWVTdHJpbmcpO1xuICAgICAgICB9LFxuICAgICAgICBfY3JlYXRlQmxvYjogZnVuY3Rpb24oZGF0YSwgbWltZSkge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgQmxvYkJ1aWxkZXIgPSB3aW5kb3cuQmxvYkJ1aWxkZXIgfHwgd2luZG93LldlYktpdEJsb2JCdWlsZGVyIHx8IHdpbmRvdy5Nb3pCbG9iQnVpbGRlciB8fCB3aW5kb3cuTVNCbG9iQnVpbGRlciwgYmxvYkJ1aWxkZXIgPSBCbG9iQnVpbGRlciAmJiBuZXcgQmxvYkJ1aWxkZXIoKTtcbiAgICAgICAgICAgIGlmIChibG9iQnVpbGRlcikge1xuICAgICAgICAgICAgICAgIGJsb2JCdWlsZGVyLmFwcGVuZChkYXRhKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYkJ1aWxkZXIuZ2V0QmxvYihtaW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFsgZGF0YSBdLCB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IG1pbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHFxLkV4aWZSZXN0b3JlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgRXhpZlJlc3RvcmVyID0ge307XG4gICAgICAgIEV4aWZSZXN0b3Jlci5LRVlfU1RSID0gXCJBQkNERUZHSElKS0xNTk9QXCIgKyBcIlFSU1RVVldYWVphYmNkZWZcIiArIFwiZ2hpamtsbW5vcHFyc3R1dlwiICsgXCJ3eHl6MDEyMzQ1Njc4OSsvXCIgKyBcIj1cIjtcbiAgICAgICAgRXhpZlJlc3RvcmVyLmVuY29kZTY0ID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBcIlwiLCBjaHIxLCBjaHIyLCBjaHIzID0gXCJcIiwgZW5jMSwgZW5jMiwgZW5jMywgZW5jNCA9IFwiXCIsIGkgPSAwO1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGNocjEgPSBpbnB1dFtpKytdO1xuICAgICAgICAgICAgICAgIGNocjIgPSBpbnB1dFtpKytdO1xuICAgICAgICAgICAgICAgIGNocjMgPSBpbnB1dFtpKytdO1xuICAgICAgICAgICAgICAgIGVuYzEgPSBjaHIxID4+IDI7XG4gICAgICAgICAgICAgICAgZW5jMiA9IChjaHIxICYgMykgPDwgNCB8IGNocjIgPj4gNDtcbiAgICAgICAgICAgICAgICBlbmMzID0gKGNocjIgJiAxNSkgPDwgMiB8IGNocjMgPj4gNjtcbiAgICAgICAgICAgICAgICBlbmM0ID0gY2hyMyAmIDYzO1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihjaHIyKSkge1xuICAgICAgICAgICAgICAgICAgICBlbmMzID0gZW5jNCA9IDY0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOYU4oY2hyMykpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5jNCA9IDY0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzEpICsgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmMyKSArIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jMykgKyB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzQpO1xuICAgICAgICAgICAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9IFwiXCI7XG4gICAgICAgICAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5yZXN0b3JlID0gZnVuY3Rpb24ob3JpZ0ZpbGVCYXNlNjQsIHJlc2l6ZWRGaWxlQmFzZTY0KSB7XG4gICAgICAgICAgICB2YXIgZXhwZWN0ZWRCYXNlNjRIZWFkZXIgPSBcImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsXCI7XG4gICAgICAgICAgICBpZiAoIW9yaWdGaWxlQmFzZTY0Lm1hdGNoKGV4cGVjdGVkQmFzZTY0SGVhZGVyKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNpemVkRmlsZUJhc2U2NDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByYXdJbWFnZSA9IHRoaXMuZGVjb2RlNjQob3JpZ0ZpbGVCYXNlNjQucmVwbGFjZShleHBlY3RlZEJhc2U2NEhlYWRlciwgXCJcIikpO1xuICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gdGhpcy5zbGljZTJTZWdtZW50cyhyYXdJbWFnZSk7XG4gICAgICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmV4aWZNYW5pcHVsYXRpb24ocmVzaXplZEZpbGVCYXNlNjQsIHNlZ21lbnRzKTtcbiAgICAgICAgICAgIHJldHVybiBleHBlY3RlZEJhc2U2NEhlYWRlciArIHRoaXMuZW5jb2RlNjQoaW1hZ2UpO1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuZXhpZk1hbmlwdWxhdGlvbiA9IGZ1bmN0aW9uKHJlc2l6ZWRGaWxlQmFzZTY0LCBzZWdtZW50cykge1xuICAgICAgICAgICAgdmFyIGV4aWZBcnJheSA9IHRoaXMuZ2V0RXhpZkFycmF5KHNlZ21lbnRzKSwgbmV3SW1hZ2VBcnJheSA9IHRoaXMuaW5zZXJ0RXhpZihyZXNpemVkRmlsZUJhc2U2NCwgZXhpZkFycmF5KSwgYUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KG5ld0ltYWdlQXJyYXkpO1xuICAgICAgICAgICAgcmV0dXJuIGFCdWZmZXI7XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5nZXRFeGlmQXJyYXkgPSBmdW5jdGlvbihzZWdtZW50cykge1xuICAgICAgICAgICAgdmFyIHNlZztcbiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2VnbWVudHMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgICAgICBzZWcgPSBzZWdtZW50c1t4XTtcbiAgICAgICAgICAgICAgICBpZiAoc2VnWzBdID09IDI1NSAmIHNlZ1sxXSA9PSAyMjUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5pbnNlcnRFeGlmID0gZnVuY3Rpb24ocmVzaXplZEZpbGVCYXNlNjQsIGV4aWZBcnJheSkge1xuICAgICAgICAgICAgdmFyIGltYWdlRGF0YSA9IHJlc2l6ZWRGaWxlQmFzZTY0LnJlcGxhY2UoXCJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LFwiLCBcIlwiKSwgYnVmID0gdGhpcy5kZWNvZGU2NChpbWFnZURhdGEpLCBzZXBhcmF0ZVBvaW50ID0gYnVmLmluZGV4T2YoMjU1LCAzKSwgbWFlID0gYnVmLnNsaWNlKDAsIHNlcGFyYXRlUG9pbnQpLCBhdG8gPSBidWYuc2xpY2Uoc2VwYXJhdGVQb2ludCksIGFycmF5ID0gbWFlO1xuICAgICAgICAgICAgYXJyYXkgPSBhcnJheS5jb25jYXQoZXhpZkFycmF5KTtcbiAgICAgICAgICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KGF0byk7XG4gICAgICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgICAgIH07XG4gICAgICAgIEV4aWZSZXN0b3Jlci5zbGljZTJTZWdtZW50cyA9IGZ1bmN0aW9uKHJhd0ltYWdlQXJyYXkpIHtcbiAgICAgICAgICAgIHZhciBoZWFkID0gMCwgc2VnbWVudHMgPSBbXTtcbiAgICAgICAgICAgIHdoaWxlICgxKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJhd0ltYWdlQXJyYXlbaGVhZF0gPT0gMjU1ICYgcmF3SW1hZ2VBcnJheVtoZWFkICsgMV0gPT0gMjE4KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PSAyNTUgJiByYXdJbWFnZUFycmF5W2hlYWQgKyAxXSA9PSAyMTYpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZCArPSAyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSByYXdJbWFnZUFycmF5W2hlYWQgKyAyXSAqIDI1NiArIHJhd0ltYWdlQXJyYXlbaGVhZCArIDNdLCBlbmRQb2ludCA9IGhlYWQgKyBsZW5ndGggKyAyLCBzZWcgPSByYXdJbWFnZUFycmF5LnNsaWNlKGhlYWQsIGVuZFBvaW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudHMucHVzaChzZWcpO1xuICAgICAgICAgICAgICAgICAgICBoZWFkID0gZW5kUG9pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoZWFkID4gcmF3SW1hZ2VBcnJheS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNlZ21lbnRzO1xuICAgICAgICB9O1xuICAgICAgICBFeGlmUmVzdG9yZXIuZGVjb2RlNjQgPSBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgdmFyIG91dHB1dCA9IFwiXCIsIGNocjEsIGNocjIsIGNocjMgPSBcIlwiLCBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0ID0gXCJcIiwgaSA9IDAsIGJ1ZiA9IFtdO1xuICAgICAgICAgICAgdmFyIGJhc2U2NHRlc3QgPSAvW15BLVphLXowLTlcXCtcXC9cXD1dL2c7XG4gICAgICAgICAgICBpZiAoYmFzZTY0dGVzdC5leGVjKGlucHV0KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZXJlIHdlcmUgaW52YWxpZCBiYXNlNjQgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQgdGV4dC4gIFwiICsgXCJWYWxpZCBiYXNlNjQgY2hhcmFjdGVycyBhcmUgQS1aLCBhLXosIDAtOSwgJysnLCAnLycsYW5kICc9J1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcXCtcXC9cXD1dL2csIFwiXCIpO1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGVuYzEgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgZW5jMiA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBlbmMzID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGVuYzQgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgY2hyMSA9IGVuYzEgPDwgMiB8IGVuYzIgPj4gNDtcbiAgICAgICAgICAgICAgICBjaHIyID0gKGVuYzIgJiAxNSkgPDwgNCB8IGVuYzMgPj4gMjtcbiAgICAgICAgICAgICAgICBjaHIzID0gKGVuYzMgJiAzKSA8PCA2IHwgZW5jNDtcbiAgICAgICAgICAgICAgICBidWYucHVzaChjaHIxKTtcbiAgICAgICAgICAgICAgICBpZiAoZW5jMyAhPSA2NCkge1xuICAgICAgICAgICAgICAgICAgICBidWYucHVzaChjaHIyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVuYzQgIT0gNjQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmLnB1c2goY2hyMyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9IFwiXCI7XG4gICAgICAgICAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTtcbiAgICAgICAgICAgIHJldHVybiBidWY7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBFeGlmUmVzdG9yZXI7XG4gICAgfSgpO1xuICAgIHFxLlRvdGFsUHJvZ3Jlc3MgPSBmdW5jdGlvbihjYWxsYmFjaywgZ2V0U2l6ZSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHBlckZpbGVQcm9ncmVzcyA9IHt9LCB0b3RhbExvYWRlZCA9IDAsIHRvdGFsU2l6ZSA9IDAsIGxhc3RMb2FkZWRTZW50ID0gLTEsIGxhc3RUb3RhbFNlbnQgPSAtMSwgY2FsbGJhY2tQcm94eSA9IGZ1bmN0aW9uKGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgIGlmIChsb2FkZWQgIT09IGxhc3RMb2FkZWRTZW50IHx8IHRvdGFsICE9PSBsYXN0VG90YWxTZW50KSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobG9hZGVkLCB0b3RhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0TG9hZGVkU2VudCA9IGxvYWRlZDtcbiAgICAgICAgICAgIGxhc3RUb3RhbFNlbnQgPSB0b3RhbDtcbiAgICAgICAgfSwgbm9SZXRyeWFibGVGaWxlcyA9IGZ1bmN0aW9uKGZhaWxlZCwgcmV0cnlhYmxlKSB7XG4gICAgICAgICAgICB2YXIgbm9uZSA9IHRydWU7XG4gICAgICAgICAgICBxcS5lYWNoKGZhaWxlZCwgZnVuY3Rpb24oaWR4LCBmYWlsZWRJZCkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pbmRleE9mKHJldHJ5YWJsZSwgZmFpbGVkSWQpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbm9uZTtcbiAgICAgICAgfSwgb25DYW5jZWwgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzcyhpZCwgLTEsIC0xKTtcbiAgICAgICAgICAgIGRlbGV0ZSBwZXJGaWxlUHJvZ3Jlc3NbaWRdO1xuICAgICAgICB9LCBvbkFsbENvbXBsZXRlID0gZnVuY3Rpb24oc3VjY2Vzc2Z1bCwgZmFpbGVkLCByZXRyeWFibGUpIHtcbiAgICAgICAgICAgIGlmIChmYWlsZWQubGVuZ3RoID09PSAwIHx8IG5vUmV0cnlhYmxlRmlsZXMoZmFpbGVkLCByZXRyeWFibGUpKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2tQcm94eSh0b3RhbFNpemUsIHRvdGFsU2l6ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBvbk5ldyA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IGdldFNpemUoaWQpO1xuICAgICAgICAgICAgaWYgKHNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzcyhpZCwgMCwgc2l6ZSk7XG4gICAgICAgICAgICAgICAgcGVyRmlsZVByb2dyZXNzW2lkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiAwLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogc2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MgPSBmdW5jdGlvbihpZCwgbmV3TG9hZGVkLCBuZXdUb3RhbCkge1xuICAgICAgICAgICAgdmFyIG9sZExvYWRlZCA9IHBlckZpbGVQcm9ncmVzc1tpZF0gPyBwZXJGaWxlUHJvZ3Jlc3NbaWRdLmxvYWRlZCA6IDAsIG9sZFRvdGFsID0gcGVyRmlsZVByb2dyZXNzW2lkXSA/IHBlckZpbGVQcm9ncmVzc1tpZF0udG90YWwgOiAwO1xuICAgICAgICAgICAgaWYgKG5ld0xvYWRlZCA9PT0gLTEgJiYgbmV3VG90YWwgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgLT0gb2xkTG9hZGVkO1xuICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSAtPSBvbGRUb3RhbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld0xvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCArPSBuZXdMb2FkZWQgLSBvbGRMb2FkZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuZXdUb3RhbCkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFNpemUgKz0gbmV3VG90YWwgLSBvbGRUb3RhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFja1Byb3h5KHRvdGFsTG9hZGVkLCB0b3RhbFNpemUpO1xuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgb25BbGxDb21wbGV0ZTogb25BbGxDb21wbGV0ZSxcbiAgICAgICAgICAgIG9uU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihpZCwgb2xkU3RhdHVzLCBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3U3RhdHVzID09PSBxcS5zdGF0dXMuQ0FOQ0VMRUQgfHwgbmV3U3RhdHVzID09PSBxcS5zdGF0dXMuUkVKRUNURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3U3RhdHVzID09PSBxcS5zdGF0dXMuU1VCTUlUVElORykge1xuICAgICAgICAgICAgICAgICAgICBvbk5ldyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uSW5kaXZpZHVhbFByb2dyZXNzOiBmdW5jdGlvbihpZCwgbG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoaWQsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgIHBlckZpbGVQcm9ncmVzc1tpZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlZDogbG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uTmV3U2l6ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBvbk5ldyhpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBlckZpbGVQcm9ncmVzcyA9IHt9O1xuICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkID0gMDtcbiAgICAgICAgICAgICAgICB0b3RhbFNpemUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLlBhc3RlU3VwcG9ydCA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBvcHRpb25zLCBkZXRhY2hQYXN0ZUhhbmRsZXI7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0YXJnZXRFbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge30sXG4gICAgICAgICAgICAgICAgcGFzdGVSZWNlaXZlZDogZnVuY3Rpb24oYmxvYikge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZnVuY3Rpb24gaXNJbWFnZShpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbS50eXBlICYmIGl0ZW0udHlwZS5pbmRleE9mKFwiaW1hZ2UvXCIpID09PSAwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyUGFzdGVIYW5kbGVyKCkge1xuICAgICAgICAgICAgZGV0YWNoUGFzdGVIYW5kbGVyID0gcXEob3B0aW9ucy50YXJnZXRFbGVtZW50KS5hdHRhY2goXCJwYXN0ZVwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjbGlwYm9hcmREYXRhID0gZXZlbnQuY2xpcGJvYXJkRGF0YTtcbiAgICAgICAgICAgICAgICBpZiAoY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGNsaXBib2FyZERhdGEuaXRlbXMsIGZ1bmN0aW9uKGlkeCwgaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW1hZ2UoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IGl0ZW0uZ2V0QXNGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MucGFzdGVSZWNlaXZlZChibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdW5yZWdpc3RlclBhc3RlSGFuZGxlcigpIHtcbiAgICAgICAgICAgIGlmIChkZXRhY2hQYXN0ZUhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICBkZXRhY2hQYXN0ZUhhbmRsZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQob3B0aW9ucywgbyk7XG4gICAgICAgIHJlZ2lzdGVyUGFzdGVIYW5kbGVyKCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdW5yZWdpc3RlclBhc3RlSGFuZGxlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHFxLkZvcm1TdXBwb3J0ID0gZnVuY3Rpb24ob3B0aW9ucywgc3RhcnRVcGxvYWQsIGxvZykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBpbnRlcmNlcHRTdWJtaXQgPSBvcHRpb25zLmludGVyY2VwdFN1Ym1pdCwgZm9ybUVsID0gb3B0aW9ucy5lbGVtZW50LCBhdXRvVXBsb2FkID0gb3B0aW9ucy5hdXRvVXBsb2FkO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgbmV3RW5kcG9pbnQ6IG51bGwsXG4gICAgICAgICAgICBuZXdBdXRvVXBsb2FkOiBhdXRvVXBsb2FkLFxuICAgICAgICAgICAgYXR0YWNoZWRUb0Zvcm06IGZhbHNlLFxuICAgICAgICAgICAgZ2V0Rm9ybUlucHV0c0FzT2JqZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoZm9ybUVsID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9mb3JtMk9iaihmb3JtRWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lTmV3RW5kcG9pbnQoZm9ybUVsKSB7XG4gICAgICAgICAgICBpZiAoZm9ybUVsLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKSkge1xuICAgICAgICAgICAgICAgIHNlbGYubmV3RW5kcG9pbnQgPSBmb3JtRWwuZ2V0QXR0cmlidXRlKFwiYWN0aW9uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlRm9ybShmb3JtRWwsIG5hdGl2ZVN1Ym1pdCkge1xuICAgICAgICAgICAgaWYgKGZvcm1FbC5jaGVja1ZhbGlkaXR5ICYmICFmb3JtRWwuY2hlY2tWYWxpZGl0eSgpKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiRm9ybSBkaWQgbm90IHBhc3MgdmFsaWRhdGlvbiBjaGVja3MgLSB3aWxsIG5vdCB1cGxvYWQuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgbmF0aXZlU3VibWl0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG1heWJlVXBsb2FkT25TdWJtaXQoZm9ybUVsKSB7XG4gICAgICAgICAgICB2YXIgbmF0aXZlU3VibWl0ID0gZm9ybUVsLnN1Ym1pdDtcbiAgICAgICAgICAgIHFxKGZvcm1FbCkuYXR0YWNoKFwic3VibWl0XCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQgPSBldmVudCB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFsaWRhdGVGb3JtKGZvcm1FbCwgbmF0aXZlU3VibWl0KSAmJiBzdGFydFVwbG9hZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3JtRWwuc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGVGb3JtKGZvcm1FbCwgbmF0aXZlU3VibWl0KSAmJiBzdGFydFVwbG9hZCgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkZXRlcm1pbmVGb3JtRWwoZm9ybUVsKSB7XG4gICAgICAgICAgICBpZiAoZm9ybUVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzU3RyaW5nKGZvcm1FbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZm9ybUVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGZvcm1FbCkge1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJBdHRhY2hpbmcgdG8gZm9ybSBlbGVtZW50LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lTmV3RW5kcG9pbnQoZm9ybUVsKTtcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJjZXB0U3VibWl0ICYmIG1heWJlVXBsb2FkT25TdWJtaXQoZm9ybUVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZm9ybUVsO1xuICAgICAgICB9XG4gICAgICAgIGZvcm1FbCA9IGRldGVybWluZUZvcm1FbChmb3JtRWwpO1xuICAgICAgICB0aGlzLmF0dGFjaGVkVG9Gb3JtID0gISFmb3JtRWw7XG4gICAgfTtcbiAgICBxcS5leHRlbmQocXEuRm9ybVN1cHBvcnQucHJvdG90eXBlLCB7XG4gICAgICAgIF9mb3JtMk9iajogZnVuY3Rpb24oZm9ybSkge1xuICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICB2YXIgb2JqID0ge30sIG5vdElycmVsZXZhbnRUeXBlID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBpcnJlbGV2YW50VHlwZXMgPSBbIFwiYnV0dG9uXCIsIFwiaW1hZ2VcIiwgXCJyZXNldFwiLCBcInN1Ym1pdFwiIF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxLmluZGV4T2YoaXJyZWxldmFudFR5cGVzLCB0eXBlLnRvTG93ZXJDYXNlKCkpIDwgMDtcbiAgICAgICAgICAgIH0sIHJhZGlvT3JDaGVja2JveCA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEuaW5kZXhPZihbIFwiY2hlY2tib3hcIiwgXCJyYWRpb1wiIF0sIHR5cGUudG9Mb3dlckNhc2UoKSkgPj0gMDtcbiAgICAgICAgICAgIH0sIGlnbm9yZVZhbHVlID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICBpZiAocmFkaW9PckNoZWNrYm94KGVsLnR5cGUpICYmICFlbC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZWwuZGlzYWJsZWQgJiYgZWwudHlwZS50b0xvd2VyQ2FzZSgpICE9PSBcImhpZGRlblwiO1xuICAgICAgICAgICAgfSwgc2VsZWN0VmFsdWUgPSBmdW5jdGlvbihzZWxlY3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHFxLmVhY2gocXEoc2VsZWN0KS5jaGlsZHJlbigpLCBmdW5jdGlvbihpZHgsIGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwib3B0aW9uXCIgJiYgY2hpbGQuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hpbGQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcXEuZWFjaChmb3JtLmVsZW1lbnRzLCBmdW5jdGlvbihpZHgsIGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKChxcS5pc0lucHV0KGVsLCB0cnVlKSB8fCBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwidGV4dGFyZWFcIikgJiYgbm90SXJyZWxldmFudFR5cGUoZWwudHlwZSkgJiYgIWlnbm9yZVZhbHVlKGVsKSkge1xuICAgICAgICAgICAgICAgICAgICBvYmpbZWwubmFtZV0gPSBlbC52YWx1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJzZWxlY3RcIiAmJiAhaWdub3JlVmFsdWUoZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGVjdFZhbHVlKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbZWwubmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHFxLnRyYWRpdGlvbmFsID0gcXEudHJhZGl0aW9uYWwgfHwge307XG4gICAgcXEudHJhZGl0aW9uYWwuRm9ybVVwbG9hZEhhbmRsZXIgPSBmdW5jdGlvbihvcHRpb25zLCBwcm94eSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLCBnZXROYW1lID0gcHJveHkuZ2V0TmFtZSwgZ2V0VXVpZCA9IHByb3h5LmdldFV1aWQsIGxvZyA9IHByb3h5LmxvZztcbiAgICAgICAgZnVuY3Rpb24gZ2V0SWZyYW1lQ29udGVudEpzb24oaWQsIGlmcmFtZSkge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlLCBkb2MsIGlubmVySHRtbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZG9jID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudCB8fCBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDtcbiAgICAgICAgICAgICAgICBpbm5lckh0bWwgPSBkb2MuYm9keS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgbG9nKFwiY29udmVydGluZyBpZnJhbWUncyBpbm5lckhUTUwgdG8gSlNPTlwiKTtcbiAgICAgICAgICAgICAgICBsb2coXCJpbm5lckhUTUwgPSBcIiArIGlubmVySHRtbCk7XG4gICAgICAgICAgICAgICAgaWYgKGlubmVySHRtbCAmJiBpbm5lckh0bWwubWF0Y2goL148cHJlL2kpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlubmVySHRtbCA9IGRvYy5ib2R5LmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5ub2RlVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gaGFuZGxlci5fcGFyc2VKc29uUmVzcG9uc2UoaW5uZXJIdG1sKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbG9nKFwiRXJyb3Igd2hlbiBhdHRlbXB0aW5nIHRvIHBhcnNlIGZvcm0gdXBsb2FkIHJlc3BvbnNlIChcIiArIGVycm9yLm1lc3NhZ2UgKyBcIilcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUZvcm0oaWQsIGlmcmFtZSkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IG9wdGlvbnMucGFyYW1zU3RvcmUuZ2V0KGlkKSwgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QudG9Mb3dlckNhc2UoKSA9PT0gXCJnZXRcIiA/IFwiR0VUXCIgOiBcIlBPU1RcIiwgZW5kcG9pbnQgPSBvcHRpb25zLmVuZHBvaW50U3RvcmUuZ2V0KGlkKSwgbmFtZSA9IGdldE5hbWUoaWQpO1xuICAgICAgICAgICAgcGFyYW1zW29wdGlvbnMudXVpZE5hbWVdID0gZ2V0VXVpZChpZCk7XG4gICAgICAgICAgICBwYXJhbXNbb3B0aW9ucy5maWxlbmFtZVBhcmFtXSA9IG5hbWU7XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlci5faW5pdEZvcm1Gb3JVcGxvYWQoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgICAgICAgIGVuZHBvaW50OiBlbmRwb2ludCxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICBwYXJhbXNJbkJvZHk6IG9wdGlvbnMucGFyYW1zSW5Cb2R5LFxuICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IGlmcmFtZS5uYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwbG9hZEZpbGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gaGFuZGxlci5nZXRJbnB1dChpZCksIGlmcmFtZSA9IGhhbmRsZXIuX2NyZWF0ZUlmcmFtZShpZCksIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpLCBmb3JtO1xuICAgICAgICAgICAgZm9ybSA9IGNyZWF0ZUZvcm0oaWQsIGlmcmFtZSk7XG4gICAgICAgICAgICBmb3JtLmFwcGVuZENoaWxkKGlucHV0KTtcbiAgICAgICAgICAgIGhhbmRsZXIuX2F0dGFjaExvYWRFdmVudChpZnJhbWUsIGZ1bmN0aW9uKHJlc3BvbnNlRnJvbU1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJpZnJhbWUgbG9hZGVkXCIpO1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHJlc3BvbnNlRnJvbU1lc3NhZ2UgPyByZXNwb25zZUZyb21NZXNzYWdlIDogZ2V0SWZyYW1lQ29udGVudEpzb24oaWQsIGlmcmFtZSk7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fZGV0YWNoTG9hZEV2ZW50KGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuY29ycy5leHBlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICBxcShpZnJhbWUpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsb2coXCJTZW5kaW5nIHVwbG9hZCByZXF1ZXN0IGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgIGZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICBxcShmb3JtKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9O1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLkZvcm1VcGxvYWRIYW5kbGVyKHtcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBpc0NvcnM6IG9wdGlvbnMuY29ycy5leHBlY3RlZCxcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6IG9wdGlvbnMuaW5wdXROYW1lXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJveHk6IHtcbiAgICAgICAgICAgICAgICBvbkNhbmNlbDogb3B0aW9ucy5vbkNhbmNlbCxcbiAgICAgICAgICAgICAgICBnZXROYW1lOiBnZXROYW1lLFxuICAgICAgICAgICAgICAgIGdldFV1aWQ6IGdldFV1aWQsXG4gICAgICAgICAgICAgICAgbG9nOiBsb2dcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgcXEudHJhZGl0aW9uYWwgPSBxcS50cmFkaXRpb25hbCB8fCB7fTtcbiAgICBxcS50cmFkaXRpb25hbC5YaHJVcGxvYWRIYW5kbGVyID0gZnVuY3Rpb24oc3BlYywgcHJveHkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBoYW5kbGVyID0gdGhpcywgZ2V0TmFtZSA9IHByb3h5LmdldE5hbWUsIGdldFNpemUgPSBwcm94eS5nZXRTaXplLCBnZXRVdWlkID0gcHJveHkuZ2V0VXVpZCwgbG9nID0gcHJveHkubG9nLCBtdWx0aXBhcnQgPSBzcGVjLmZvcmNlTXVsdGlwYXJ0IHx8IHNwZWMucGFyYW1zSW5Cb2R5LCBhZGRDaHVua2luZ1NwZWNpZmljUGFyYW1zID0gZnVuY3Rpb24oaWQsIHBhcmFtcywgY2h1bmtEYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IGdldFNpemUoaWQpLCBuYW1lID0gZ2V0TmFtZShpZCk7XG4gICAgICAgICAgICBpZiAoIXNwZWMub21pdERlZmF1bHRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5jaHVua2luZy5wYXJhbU5hbWVzLnBhcnRJbmRleF0gPSBjaHVua0RhdGEucGFydDtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5jaHVua2luZy5wYXJhbU5hbWVzLnBhcnRCeXRlT2Zmc2V0XSA9IGNodW5rRGF0YS5zdGFydDtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5jaHVua2luZy5wYXJhbU5hbWVzLmNodW5rU2l6ZV0gPSBjaHVua0RhdGEuc2l6ZTtcbiAgICAgICAgICAgICAgICBwYXJhbXNbc3BlYy5jaHVua2luZy5wYXJhbU5hbWVzLnRvdGFsUGFydHNdID0gY2h1bmtEYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLnRvdGFsRmlsZVNpemVOYW1lXSA9IHNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobXVsdGlwYXJ0ICYmICFzcGVjLm9taXREZWZhdWx0UGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuZmlsZW5hbWVQYXJhbV0gPSBuYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhbGxDaHVua3NEb25lUmVxdWVzdGVyID0gbmV3IHFxLnRyYWRpdGlvbmFsLkFsbENodW5rc0RvbmVBamF4UmVxdWVzdGVyKHtcbiAgICAgICAgICAgIGNvcnM6IHNwZWMuY29ycyxcbiAgICAgICAgICAgIGVuZHBvaW50OiBzcGVjLmNodW5raW5nLnN1Y2Nlc3MuZW5kcG9pbnQsXG4gICAgICAgICAgICBoZWFkZXJzOiBzcGVjLmNodW5raW5nLnN1Y2Nlc3MuaGVhZGVycyxcbiAgICAgICAgICAgIGpzb25QYXlsb2FkOiBzcGVjLmNodW5raW5nLnN1Y2Nlc3MuanNvblBheWxvYWQsXG4gICAgICAgICAgICBsb2c6IGxvZyxcbiAgICAgICAgICAgIG1ldGhvZDogc3BlYy5jaHVua2luZy5zdWNjZXNzLm1ldGhvZCxcbiAgICAgICAgICAgIHBhcmFtczogc3BlYy5jaHVua2luZy5zdWNjZXNzLnBhcmFtc1xuICAgICAgICB9KSwgY3JlYXRlUmVhZHlTdGF0ZUNoYW5nZWRIYW5kbGVyID0gZnVuY3Rpb24oaWQsIHhocikge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gb25VcGxvYWRPckNodW5rQ29tcGxldGUoaWQsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKHJlc3VsdC5yZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZShyZXN1bHQucmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH0sIGdldENodW5rc0NvbXBsZXRlUGFyYW1zID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBzcGVjLnBhcmFtc1N0b3JlLmdldChpZCksIG5hbWUgPSBnZXROYW1lKGlkKSwgc2l6ZSA9IGdldFNpemUoaWQpO1xuICAgICAgICAgICAgcGFyYW1zW3NwZWMudXVpZE5hbWVdID0gZ2V0VXVpZChpZCk7XG4gICAgICAgICAgICBwYXJhbXNbc3BlYy5maWxlbmFtZVBhcmFtXSA9IG5hbWU7XG4gICAgICAgICAgICBwYXJhbXNbc3BlYy50b3RhbEZpbGVTaXplTmFtZV0gPSBzaXplO1xuICAgICAgICAgICAgcGFyYW1zW3NwZWMuY2h1bmtpbmcucGFyYW1OYW1lcy50b3RhbFBhcnRzXSA9IGhhbmRsZXIuX2dldFRvdGFsQ2h1bmtzKGlkKTtcbiAgICAgICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICAgIH0sIGlzRXJyb3JVcGxvYWRSZXNwb25zZSA9IGZ1bmN0aW9uKHhociwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBxcS5pbmRleE9mKFsgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQgXSwgeGhyLnN0YXR1cykgPCAwIHx8IHNwZWMucmVxdWlyZVN1Y2Nlc3NKc29uICYmICFyZXNwb25zZS5zdWNjZXNzIHx8IHJlc3BvbnNlLnJlc2V0O1xuICAgICAgICB9LCBvblVwbG9hZE9yQ2h1bmtDb21wbGV0ZSA9IGZ1bmN0aW9uKGlkLCB4aHIpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZTtcbiAgICAgICAgICAgIGxvZyhcInhociAtIHNlcnZlciByZXNwb25zZSByZWNlaXZlZCBmb3IgXCIgKyBpZCk7XG4gICAgICAgICAgICBsb2coXCJyZXNwb25zZVRleHQgPSBcIiArIHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBwYXJzZVJlc3BvbnNlKHRydWUsIHhocik7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICFpc0Vycm9yVXBsb2FkUmVzcG9uc2UoeGhyLCByZXNwb25zZSksXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LCBwYXJzZVJlc3BvbnNlID0gZnVuY3Rpb24odXBsb2FkLCB4aHIpIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHt9O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiUmVjZWl2ZWQgcmVzcG9uc2Ugc3RhdHVzIHt9IHdpdGggYm9keToge31cIiwgeGhyLnN0YXR1cywgeGhyLnJlc3BvbnNlVGV4dCkpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcXEucGFyc2VKc29uKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB1cGxvYWQgJiYgc3BlYy5yZXF1aXJlU3VjY2Vzc0pzb24gJiYgbG9nKFwiRXJyb3Igd2hlbiBhdHRlbXB0aW5nIHRvIHBhcnNlIHhociByZXNwb25zZSB0ZXh0IChcIiArIGVycm9yLm1lc3NhZ2UgKyBcIilcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSwgc2VuZENodW5rc0NvbXBsZXRlUmVxdWVzdCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBhbGxDaHVua3NEb25lUmVxdWVzdGVyLmNvbXBsZXRlKGlkLCBoYW5kbGVyLl9jcmVhdGVYaHIoaWQpLCBnZXRDaHVua3NDb21wbGV0ZVBhcmFtcyhpZCksIHNwZWMuY3VzdG9tSGVhZGVycy5nZXQoaWQpKS50aGVuKGZ1bmN0aW9uKHhocikge1xuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhwYXJzZVJlc3BvbnNlKGZhbHNlLCB4aHIpLCB4aHIpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKHBhcnNlUmVzcG9uc2UoZmFsc2UsIHhociksIHhocik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9LCBzZXRQYXJhbXNBbmRHZXRFbnRpdHlUb1NlbmQgPSBmdW5jdGlvbihlbnRpdHlUb1NlbmRQYXJhbXMpIHtcbiAgICAgICAgICAgIHZhciBmaWxlT3JCbG9iID0gZW50aXR5VG9TZW5kUGFyYW1zLmZpbGVPckJsb2I7XG4gICAgICAgICAgICB2YXIgaWQgPSBlbnRpdHlUb1NlbmRQYXJhbXMuaWQ7XG4gICAgICAgICAgICB2YXIgeGhyID0gZW50aXR5VG9TZW5kUGFyYW1zLnhocjtcbiAgICAgICAgICAgIHZhciB4aHJPdmVycmlkZXMgPSBlbnRpdHlUb1NlbmRQYXJhbXMueGhyT3ZlcnJpZGVzIHx8IHt9O1xuICAgICAgICAgICAgdmFyIGN1c3RvbVBhcmFtcyA9IGVudGl0eVRvU2VuZFBhcmFtcy5jdXN0b21QYXJhbXMgfHwge307XG4gICAgICAgICAgICB2YXIgZGVmYXVsdFBhcmFtcyA9IGVudGl0eVRvU2VuZFBhcmFtcy5wYXJhbXMgfHwge307XG4gICAgICAgICAgICB2YXIgeGhyT3ZlcnJpZGVQYXJhbXMgPSB4aHJPdmVycmlkZXMucGFyYW1zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIHBhcmFtcztcbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG11bHRpcGFydCA/IG5ldyBGb3JtRGF0YSgpIDogbnVsbCwgbWV0aG9kID0geGhyT3ZlcnJpZGVzLm1ldGhvZCB8fCBzcGVjLm1ldGhvZCwgZW5kcG9pbnQgPSB4aHJPdmVycmlkZXMuZW5kcG9pbnQgfHwgc3BlYy5lbmRwb2ludFN0b3JlLmdldChpZCksIG5hbWUgPSBnZXROYW1lKGlkKSwgc2l6ZSA9IGdldFNpemUoaWQpO1xuICAgICAgICAgICAgaWYgKHNwZWMub21pdERlZmF1bHRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBxcS5leHRlbmQoe30sIGN1c3RvbVBhcmFtcyk7XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHBhcmFtcywgeGhyT3ZlcnJpZGVQYXJhbXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBxcS5leHRlbmQoe30sIGN1c3RvbVBhcmFtcyk7XG4gICAgICAgICAgICAgICAgcXEuZXh0ZW5kKHBhcmFtcywgeGhyT3ZlcnJpZGVQYXJhbXMpO1xuICAgICAgICAgICAgICAgIHFxLmV4dGVuZChwYXJhbXMsIGRlZmF1bHRQYXJhbXMpO1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLnV1aWROYW1lXSA9IGdldFV1aWQoaWQpO1xuICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLmZpbGVuYW1lUGFyYW1dID0gbmFtZTtcbiAgICAgICAgICAgICAgICBpZiAobXVsdGlwYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1tzcGVjLnRvdGFsRmlsZVNpemVOYW1lXSA9IHNpemU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc3BlYy5wYXJhbXNJbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMuaW5wdXROYW1lXSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzcGVjLnBhcmFtc0luQm9keSkge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gcXEub2JqMnVybChwYXJhbXMsIGVuZHBvaW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhoci5vcGVuKG1ldGhvZCwgZW5kcG9pbnQsIHRydWUpO1xuICAgICAgICAgICAgaWYgKHNwZWMuY29ycy5leHBlY3RlZCAmJiBzcGVjLmNvcnMuc2VuZENyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobXVsdGlwYXJ0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHNwZWMucGFyYW1zSW5Cb2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLm9iajJGb3JtRGF0YShwYXJhbXMsIGZvcm1EYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHNwZWMuaW5wdXROYW1lLCBmaWxlT3JCbG9iKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybURhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmlsZU9yQmxvYjtcbiAgICAgICAgfSwgc2V0VXBsb2FkSGVhZGVycyA9IGZ1bmN0aW9uKGhlYWRlcnNPcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVyT3ZlcnJpZGVzID0gaGVhZGVyc09wdGlvbnMuaGVhZGVyT3ZlcnJpZGVzO1xuICAgICAgICAgICAgdmFyIGlkID0gaGVhZGVyc09wdGlvbnMuaWQ7XG4gICAgICAgICAgICB2YXIgeGhyID0gaGVhZGVyc09wdGlvbnMueGhyO1xuICAgICAgICAgICAgaWYgKGhlYWRlck92ZXJyaWRlcykge1xuICAgICAgICAgICAgICAgIHFxLmVhY2goaGVhZGVyT3ZlcnJpZGVzLCBmdW5jdGlvbihoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBleHRyYUhlYWRlcnMgPSBzcGVjLmN1c3RvbUhlYWRlcnMuZ2V0KGlkKSwgZmlsZU9yQmxvYiA9IGhhbmRsZXIuZ2V0RmlsZShpZCk7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1SZXF1ZXN0ZWQtV2l0aFwiLCBcIlhNTEh0dHBSZXF1ZXN0XCIpO1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ2FjaGUtQ29udHJvbFwiLCBcIm5vLWNhY2hlXCIpO1xuICAgICAgICAgICAgICAgIGlmICghbXVsdGlwYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIpO1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtTWltZS1UeXBlXCIsIGZpbGVPckJsb2IudHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxLmVhY2goZXh0cmFIZWFkZXJzLCBmdW5jdGlvbihuYW1lLCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHVwbG9hZENodW5rOiBmdW5jdGlvbih1cGxvYWRDaHVua1BhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHVwbG9hZENodW5rUGFyYW1zLmlkO1xuICAgICAgICAgICAgICAgIHZhciBjaHVua0lkeCA9IHVwbG9hZENodW5rUGFyYW1zLmNodW5rSWR4O1xuICAgICAgICAgICAgICAgIHZhciBvdmVycmlkZXMgPSB1cGxvYWRDaHVua1BhcmFtcy5vdmVycmlkZXMgfHwge307XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VtaW5nID0gdXBsb2FkQ2h1bmtQYXJhbXMucmVzdW1pbmc7XG4gICAgICAgICAgICAgICAgdmFyIGNodW5rRGF0YSA9IGhhbmRsZXIuX2dldENodW5rRGF0YShpZCwgY2h1bmtJZHgpLCB4aHIgPSBoYW5kbGVyLl9jcmVhdGVYaHIoaWQsIGNodW5rSWR4KSwgcHJvbWlzZSwgdG9TZW5kLCBjdXN0b21QYXJhbXMsIHBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgICAgIHByb21pc2UgPSBjcmVhdGVSZWFkeVN0YXRlQ2hhbmdlZEhhbmRsZXIoaWQsIHhocik7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5fcmVnaXN0ZXJQcm9ncmVzc0hhbmRsZXIoaWQsIGNodW5rSWR4LCBjaHVua0RhdGEuc2l6ZSk7XG4gICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1zID0gc3BlYy5wYXJhbXNTdG9yZS5nZXQoaWQpO1xuICAgICAgICAgICAgICAgIGFkZENodW5raW5nU3BlY2lmaWNQYXJhbXMoaWQsIHBhcmFtcywgY2h1bmtEYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdW1pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW3NwZWMucmVzdW1lLnBhcmFtTmFtZXMucmVzdW1pbmddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdG9TZW5kID0gc2V0UGFyYW1zQW5kR2V0RW50aXR5VG9TZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU9yQmxvYjogY2h1bmtEYXRhLmJsb2IsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tUGFyYW1zOiBjdXN0b21QYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICB4aHI6IHhocixcbiAgICAgICAgICAgICAgICAgICAgeGhyT3ZlcnJpZGVzOiBvdmVycmlkZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZXRVcGxvYWRIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyT3ZlcnJpZGVzOiBvdmVycmlkZXMuaGVhZGVycyxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICB4aHI6IHhoclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKHRvU2VuZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkRmlsZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZU9yQmxvYiA9IGhhbmRsZXIuZ2V0RmlsZShpZCksIHByb21pc2UsIHhociwgY3VzdG9tUGFyYW1zLCB0b1NlbmQ7XG4gICAgICAgICAgICAgICAgeGhyID0gaGFuZGxlci5fY3JlYXRlWGhyKGlkKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVyLl9yZWdpc3RlclByb2dyZXNzSGFuZGxlcihpZCk7XG4gICAgICAgICAgICAgICAgcHJvbWlzZSA9IGNyZWF0ZVJlYWR5U3RhdGVDaGFuZ2VkSGFuZGxlcihpZCwgeGhyKTtcbiAgICAgICAgICAgICAgICBjdXN0b21QYXJhbXMgPSBzcGVjLnBhcmFtc1N0b3JlLmdldChpZCk7XG4gICAgICAgICAgICAgICAgdG9TZW5kID0gc2V0UGFyYW1zQW5kR2V0RW50aXR5VG9TZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU9yQmxvYjogZmlsZU9yQmxvYixcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21QYXJhbXM6IGN1c3RvbVBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgeGhyOiB4aHJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZXRVcGxvYWRIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICB4aHI6IHhoclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHhoci5zZW5kKHRvU2VuZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLlhoclVwbG9hZEhhbmRsZXIoe1xuICAgICAgICAgICAgb3B0aW9uczogcXEuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IFwidHJhZGl0aW9uYWxcIlxuICAgICAgICAgICAgfSwgc3BlYyksXG4gICAgICAgICAgICBwcm94eTogcXEuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICBnZXRFbmRwb2ludDogc3BlYy5lbmRwb2ludFN0b3JlLmdldFxuICAgICAgICAgICAgfSwgcHJveHkpXG4gICAgICAgIH0pKTtcbiAgICAgICAgcXEub3ZlcnJpZGUodGhpcywgZnVuY3Rpb24oc3VwZXJfKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpbmFsaXplQ2h1bmtzOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICBwcm94eS5vbkZpbmFsaXppbmcoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3BlYy5jaHVua2luZy5zdWNjZXNzLmVuZHBvaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VuZENodW5rc0NvbXBsZXRlUmVxdWVzdChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXJfLmZpbmFsaXplQ2h1bmtzKGlkLCBxcS5iaW5kKHBhcnNlUmVzcG9uc2UsIHRoaXMsIHRydWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEudHJhZGl0aW9uYWwuQWxsQ2h1bmtzRG9uZUFqYXhSZXF1ZXN0ZXIgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgcmVxdWVzdGVyLCBvcHRpb25zID0ge1xuICAgICAgICAgICAgY29yczoge1xuICAgICAgICAgICAgICAgIGFsbG93WGRyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VuZENyZWRlbnRpYWxzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuZHBvaW50OiBudWxsLFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihzdHIsIGxldmVsKSB7fSxcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCJcbiAgICAgICAgfSwgcHJvbWlzZXMgPSB7fSwgZW5kcG9pbnRIYW5kbGVyID0ge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmIChxcS5pc0Z1bmN0aW9uKG9wdGlvbnMuZW5kcG9pbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmVuZHBvaW50KGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZW5kcG9pbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBvKTtcbiAgICAgICAgcmVxdWVzdGVyID0gcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5BamF4UmVxdWVzdGVyKHtcbiAgICAgICAgICAgIGFjY2VwdEhlYWRlcjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogb3B0aW9ucy5qc29uUGF5bG9hZCA/IFwiYXBwbGljYXRpb24vanNvblwiIDogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICAgICAgICAgIHZhbGlkTWV0aG9kczogWyBvcHRpb25zLm1ldGhvZCBdLFxuICAgICAgICAgICAgbWV0aG9kOiBvcHRpb25zLm1ldGhvZCxcbiAgICAgICAgICAgIGVuZHBvaW50U3RvcmU6IGVuZHBvaW50SGFuZGxlcixcbiAgICAgICAgICAgIGFsbG93WFJlcXVlc3RlZFdpdGhBbmRDYWNoZUNvbnRyb2w6IGZhbHNlLFxuICAgICAgICAgICAgY29yczogb3B0aW9ucy5jb3JzLFxuICAgICAgICAgICAgbG9nOiBvcHRpb25zLmxvZyxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHIsIGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IHByb21pc2VzW2lkXTtcbiAgICAgICAgICAgICAgICBkZWxldGUgcHJvbWlzZXNbaWRdO1xuICAgICAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbHVyZSh4aHIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2Vzcyh4aHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywge1xuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGlkLCB4aHIsIHBhcmFtcywgaGVhZGVycykge1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmxvZyhcIlN1Ym1pdHRpbmcgQWxsIENodW5rcyBEb25lIHJlcXVlc3QgZm9yIFwiICsgaWQpO1xuICAgICAgICAgICAgICAgIHByb21pc2VzW2lkXSA9IHByb21pc2U7XG4gICAgICAgICAgICAgICAgcmVxdWVzdGVyLmluaXRUcmFuc3BvcnQoaWQpLndpdGhQYXJhbXMob3B0aW9ucy5wYXJhbXMoaWQpIHx8IHBhcmFtcykud2l0aEhlYWRlcnMob3B0aW9ucy5oZWFkZXJzKGlkKSB8fCBoZWFkZXJzKS5zZW5kKHhocik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuRHJhZ0FuZERyb3AgPSBmdW5jdGlvbihvKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgb3B0aW9ucywgSElERV9aT05FU19FVkVOVF9OQU1FID0gXCJxcS1oaWRlem9uZXNcIiwgSElERV9CRUZPUkVfRU5URVJfQVRUUiA9IFwicXEtaGlkZS1kcm9wem9uZVwiLCB1cGxvYWREcm9wWm9uZXMgPSBbXSwgZHJvcHBlZEZpbGVzID0gW10sIGRpc3Bvc2VTdXBwb3J0ID0gbmV3IHFxLkRpc3Bvc2VTdXBwb3J0KCk7XG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBkcm9wWm9uZUVsZW1lbnRzOiBbXSxcbiAgICAgICAgICAgIGFsbG93TXVsdGlwbGVJdGVtczogdHJ1ZSxcbiAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICBkcm9wQWN0aXZlOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FsbGJhY2tzOiBuZXcgcXEuRHJhZ0FuZERyb3AuY2FsbGJhY2tzKClcbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8sIHRydWUpO1xuICAgICAgICBmdW5jdGlvbiB1cGxvYWREcm9wcGVkRmlsZXMoZmlsZXMsIHVwbG9hZERyb3Bab25lKSB7XG4gICAgICAgICAgICB2YXIgZmlsZXNBc0FycmF5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZmlsZXMpO1xuICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MuZHJvcExvZyhcIkdyYWJiZWQgXCIgKyBmaWxlcy5sZW5ndGggKyBcIiBkcm9wcGVkIGZpbGVzLlwiKTtcbiAgICAgICAgICAgIHVwbG9hZERyb3Bab25lLmRyb3BEaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5wcm9jZXNzaW5nRHJvcHBlZEZpbGVzQ29tcGxldGUoZmlsZXNBc0FycmF5LCB1cGxvYWREcm9wWm9uZS5nZXRFbGVtZW50KCkpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlRmlsZVRyZWUoZW50cnkpIHtcbiAgICAgICAgICAgIHZhciBwYXJzZUVudHJ5UHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBpZiAoZW50cnkuaXNGaWxlKSB7XG4gICAgICAgICAgICAgICAgZW50cnkuZmlsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGUucXFQYXRoID0gZXh0cmFjdERpcmVjdG9yeVBhdGgoZW50cnkpO1xuICAgICAgICAgICAgICAgICAgICBkcm9wcGVkRmlsZXMucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnRyeVByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGZpbGVFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5kcm9wTG9nKFwiUHJvYmxlbSBwYXJzaW5nICdcIiArIGVudHJ5LmZ1bGxQYXRoICsgXCInLiAgRmlsZUVycm9yIGNvZGUgXCIgKyBmaWxlRXJyb3IuY29kZSArIFwiLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICBwYXJzZUVudHJ5UHJvbWlzZS5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgZ2V0RmlsZXNJbkRpcmVjdG9yeShlbnRyeSkudGhlbihmdW5jdGlvbiBhbGxFbnRyaWVzUmVhZChlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRyaWVzTGVmdCA9IGVudHJpZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGVudHJpZXMsIGZ1bmN0aW9uKGlkeCwgZW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYXZlcnNlRmlsZVRyZWUoZW50cnkpLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllc0xlZnQgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cmllc0xlZnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnRyeVByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VFbnRyeVByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gcmVhZEZhaWx1cmUoZmlsZUVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY2FsbGJhY2tzLmRyb3BMb2coXCJQcm9ibGVtIHBhcnNpbmcgJ1wiICsgZW50cnkuZnVsbFBhdGggKyBcIicuICBGaWxlRXJyb3IgY29kZSBcIiArIGZpbGVFcnJvci5jb2RlICsgXCIuXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRW50cnlQcm9taXNlLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwYXJzZUVudHJ5UHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBleHRyYWN0RGlyZWN0b3J5UGF0aChlbnRyeSkge1xuICAgICAgICAgICAgdmFyIG5hbWUgPSBlbnRyeS5uYW1lLCBmdWxsUGF0aCA9IGVudHJ5LmZ1bGxQYXRoLCBpbmRleE9mTmFtZUluRnVsbFBhdGggPSBmdWxsUGF0aC5sYXN0SW5kZXhPZihuYW1lKTtcbiAgICAgICAgICAgIGZ1bGxQYXRoID0gZnVsbFBhdGguc3Vic3RyKDAsIGluZGV4T2ZOYW1lSW5GdWxsUGF0aCk7XG4gICAgICAgICAgICBpZiAoZnVsbFBhdGguY2hhckF0KDApID09PSBcIi9cIikge1xuICAgICAgICAgICAgICAgIGZ1bGxQYXRoID0gZnVsbFBhdGguc3Vic3RyKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZ1bGxQYXRoO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEZpbGVzSW5EaXJlY3RvcnkoZW50cnksIHJlYWRlciwgYWNjdW1FbnRyaWVzLCBleGlzdGluZ1Byb21pc2UpIHtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gZXhpc3RpbmdQcm9taXNlIHx8IG5ldyBxcS5Qcm9taXNlKCksIGRpclJlYWRlciA9IHJlYWRlciB8fCBlbnRyeS5jcmVhdGVSZWFkZXIoKTtcbiAgICAgICAgICAgIGRpclJlYWRlci5yZWFkRW50cmllcyhmdW5jdGlvbiByZWFkU3VjY2VzcyhlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0VudHJpZXMgPSBhY2N1bUVudHJpZXMgPyBhY2N1bUVudHJpZXMuY29uY2F0KGVudHJpZXMpIDogZW50cmllcztcbiAgICAgICAgICAgICAgICBpZiAoZW50cmllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpbGVzSW5EaXJlY3RvcnkoZW50cnksIGRpclJlYWRlciwgbmV3RW50cmllcywgcHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyhuZXdFbnRyaWVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBwcm9taXNlLmZhaWx1cmUpO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRGF0YVRyYW5zZmVyKGRhdGFUcmFuc2ZlciwgdXBsb2FkRHJvcFpvbmUpIHtcbiAgICAgICAgICAgIHZhciBwZW5kaW5nRm9sZGVyUHJvbWlzZXMgPSBbXSwgaGFuZGxlRGF0YVRyYW5zZmVyUHJvbWlzZSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5wcm9jZXNzaW5nRHJvcHBlZEZpbGVzKCk7XG4gICAgICAgICAgICB1cGxvYWREcm9wWm9uZS5kcm9wRGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgICAgICBpZiAoZGF0YVRyYW5zZmVyLmZpbGVzLmxlbmd0aCA+IDEgJiYgIW9wdGlvbnMuYWxsb3dNdWx0aXBsZUl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jYWxsYmFja3MucHJvY2Vzc2luZ0Ryb3BwZWRGaWxlc0NvbXBsZXRlKFtdKTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5kcm9wRXJyb3IoXCJ0b29NYW55RmlsZXNFcnJvclwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB1cGxvYWREcm9wWm9uZS5kcm9wRGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIGhhbmRsZURhdGFUcmFuc2ZlclByb21pc2UuZmFpbHVyZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkcm9wcGVkRmlsZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAocXEuaXNGb2xkZXJEcm9wU3VwcG9ydGVkKGRhdGFUcmFuc2ZlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEuZWFjaChkYXRhVHJhbnNmZXIuaXRlbXMsIGZ1bmN0aW9uKGlkeCwgaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gaXRlbS53ZWJraXRHZXRBc0VudHJ5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuaXNGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BwZWRGaWxlcy5wdXNoKGl0ZW0uZ2V0QXNGaWxlKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdGb2xkZXJQcm9taXNlcy5wdXNoKHRyYXZlcnNlRmlsZVRyZWUoZW50cnkpLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRm9sZGVyUHJvbWlzZXMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ0ZvbGRlclByb21pc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZURhdGFUcmFuc2ZlclByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkcm9wcGVkRmlsZXMgPSBkYXRhVHJhbnNmZXIuZmlsZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nRm9sZGVyUHJvbWlzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZURhdGFUcmFuc2ZlclByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVEYXRhVHJhbnNmZXJQcm9taXNlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldHVwRHJvcHpvbmUoZHJvcEFyZWEpIHtcbiAgICAgICAgICAgIHZhciBkcm9wWm9uZSA9IG5ldyBxcS5VcGxvYWREcm9wWm9uZSh7XG4gICAgICAgICAgICAgICAgSElERV9aT05FU19FVkVOVF9OQU1FOiBISURFX1pPTkVTX0VWRU5UX05BTUUsXG4gICAgICAgICAgICAgICAgZWxlbWVudDogZHJvcEFyZWEsXG4gICAgICAgICAgICAgICAgb25FbnRlcjogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBxcShkcm9wQXJlYSkuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmRyb3BBY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25MZWF2ZU5vdERlc2NlbmRhbnRzOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGRyb3BBcmVhKS5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMuZHJvcEFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkRyb3A6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRGF0YVRyYW5zZmVyKGUuZGF0YVRyYW5zZmVyLCBkcm9wWm9uZSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZERyb3BwZWRGaWxlcyhkcm9wcGVkRmlsZXMsIGRyb3Bab25lKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrcy5kcm9wTG9nKFwiRHJvcCBldmVudCBEYXRhVHJhbnNmZXIgcGFyc2luZyBmYWlsZWQuICBObyBmaWxlcyB3aWxsIGJlIHVwbG9hZGVkLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmFkZERpc3Bvc2VyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRyb3Bab25lLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcXEoZHJvcEFyZWEpLmhhc0F0dHJpYnV0ZShISURFX0JFRk9SRV9FTlRFUl9BVFRSKSAmJiBxcShkcm9wQXJlYSkuaGlkZSgpO1xuICAgICAgICAgICAgdXBsb2FkRHJvcFpvbmVzLnB1c2goZHJvcFpvbmUpO1xuICAgICAgICAgICAgcmV0dXJuIGRyb3Bab25lO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzRmlsZURyYWcoZHJhZ0V2ZW50KSB7XG4gICAgICAgICAgICB2YXIgZmlsZURyYWc7XG4gICAgICAgICAgICBxcS5lYWNoKGRyYWdFdmVudC5kYXRhVHJhbnNmZXIudHlwZXMsIGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gXCJGaWxlc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVEcmFnID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZpbGVEcmFnO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGxlYXZpbmdEb2N1bWVudE91dChlKSB7XG4gICAgICAgICAgICBpZiAocXEuc2FmYXJpKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS54IDwgMCB8fCBlLnkgPCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGUueCA9PT0gMCAmJiBlLnkgPT09IDA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2V0dXBEcmFnRHJvcCgpIHtcbiAgICAgICAgICAgIHZhciBkcm9wWm9uZXMgPSBvcHRpb25zLmRyb3Bab25lRWxlbWVudHMsIG1heWJlSGlkZURyb3Bab25lcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZHJvcFpvbmVzLCBmdW5jdGlvbihpZHgsIGRyb3Bab25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcShkcm9wWm9uZSkuaGFzQXR0cmlidXRlKEhJREVfQkVGT1JFX0VOVEVSX0FUVFIpICYmIHFxKGRyb3Bab25lKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBxcShkcm9wWm9uZSkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmRyb3BBY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcXEuZWFjaChkcm9wWm9uZXMsIGZ1bmN0aW9uKGlkeCwgZHJvcFpvbmUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkRHJvcFpvbmUgPSBzZXR1cERyb3B6b25lKGRyb3Bab25lKTtcbiAgICAgICAgICAgICAgICBpZiAoZHJvcFpvbmVzLmxlbmd0aCAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIFwiZHJhZ2VudGVyXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXBsb2FkRHJvcFpvbmUuZHJvcERpc2FibGVkKCkgJiYgaXNGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxLmVhY2goZHJvcFpvbmVzLCBmdW5jdGlvbihpZHgsIGRyb3Bab25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wWm9uZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIHFxKGRyb3Bab25lKS5oYXNBdHRyaWJ1dGUoSElERV9CRUZPUkVfRU5URVJfQVRUUikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxKGRyb3Bab25lKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIFwiZHJhZ2xlYXZlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobGVhdmluZ0RvY3VtZW50T3V0KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heWJlSGlkZURyb3Bab25lcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKHFxKGRvY3VtZW50KS5jaGlsZHJlbigpWzBdLCBcIm1vdXNlZW50ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIG1heWJlSGlkZURyb3Bab25lcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIFwiZHJvcFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBtYXliZUhpZGVEcm9wWm9uZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmF0dGFjaChkb2N1bWVudCwgSElERV9aT05FU19FVkVOVF9OQU1FLCBtYXliZUhpZGVEcm9wWm9uZXMpO1xuICAgICAgICB9XG4gICAgICAgIHNldHVwRHJhZ0Ryb3AoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIHNldHVwRXh0cmFEcm9wem9uZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuZHJvcFpvbmVFbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHNldHVwRHJvcHpvbmUoZWxlbWVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlRHJvcHpvbmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSwgZHpzID0gb3B0aW9ucy5kcm9wWm9uZUVsZW1lbnRzO1xuICAgICAgICAgICAgICAgIGZvciAoaSBpbiBkenMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGR6c1tpXSA9PT0gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGR6cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgIHFxLmVhY2godXBsb2FkRHJvcFpvbmVzLCBmdW5jdGlvbihpZHgsIGRyb3Bab25lKSB7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bab25lLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcgPSB7fTtcbiAgICAgICAgdGhpcy5fdGVzdGluZy5leHRyYWN0RGlyZWN0b3J5UGF0aCA9IGV4dHJhY3REaXJlY3RvcnlQYXRoO1xuICAgIH07XG4gICAgcXEuRHJhZ0FuZERyb3AuY2FsbGJhY2tzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcHJvY2Vzc2luZ0Ryb3BwZWRGaWxlczogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgICAgIHByb2Nlc3NpbmdEcm9wcGVkRmlsZXNDb21wbGV0ZTogZnVuY3Rpb24oZmlsZXMsIHRhcmdldEVsKSB7fSxcbiAgICAgICAgICAgIGRyb3BFcnJvcjogZnVuY3Rpb24oY29kZSwgZXJyb3JTcGVjaWZpY3MpIHtcbiAgICAgICAgICAgICAgICBxcS5sb2coXCJEcmFnICYgZHJvcCBlcnJvciBjb2RlICdcIiArIGNvZGUgKyBcIiB3aXRoIHRoZXNlIHNwZWNpZmljczogJ1wiICsgZXJyb3JTcGVjaWZpY3MgKyBcIidcIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkcm9wTG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsZXZlbCkge1xuICAgICAgICAgICAgICAgIHFxLmxvZyhtZXNzYWdlLCBsZXZlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBxcS5VcGxvYWREcm9wWm9uZSA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkaXNwb3NlU3VwcG9ydCA9IG5ldyBxcS5EaXNwb3NlU3VwcG9ydCgpLCBvcHRpb25zLCBlbGVtZW50LCBwcmV2ZW50RHJvcCwgZHJvcE91dHNpZGVEaXNhYmxlZDtcbiAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICBvbkVudGVyOiBmdW5jdGlvbihlKSB7fSxcbiAgICAgICAgICAgIG9uTGVhdmU6IGZ1bmN0aW9uKGUpIHt9LFxuICAgICAgICAgICAgb25MZWF2ZU5vdERlc2NlbmRhbnRzOiBmdW5jdGlvbihlKSB7fSxcbiAgICAgICAgICAgIG9uRHJvcDogZnVuY3Rpb24oZSkge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKG9wdGlvbnMsIG8pO1xuICAgICAgICBlbGVtZW50ID0gb3B0aW9ucy5lbGVtZW50O1xuICAgICAgICBmdW5jdGlvbiBkcmFnb3ZlclNob3VsZEJlQ2FuY2VsZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gcXEuc2FmYXJpKCkgfHwgcXEuZmlyZWZveCgpICYmIHFxLndpbmRvd3MoKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBkaXNhYmxlRHJvcE91dHNpZGUoZSkge1xuICAgICAgICAgICAgaWYgKCFkcm9wT3V0c2lkZURpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRyYWdvdmVyU2hvdWxkQmVDYW5jZWxlZCkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIFwiZHJhZ292ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZG9jdW1lbnQsIFwiZHJhZ292ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRyb3BPdXRzaWRlRGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGlzVmFsaWRGaWxlRHJhZyhlKSB7XG4gICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGVmZmVjdFRlc3QsIGR0ID0gZS5kYXRhVHJhbnNmZXIsIGlzU2FmYXJpID0gcXEuc2FmYXJpKCk7XG4gICAgICAgICAgICBlZmZlY3RUZXN0ID0gcXEuaWUoKSAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCA/IHRydWUgOiBkdC5lZmZlY3RBbGxvd2VkICE9PSBcIm5vbmVcIjtcbiAgICAgICAgICAgIHJldHVybiBkdCAmJiBlZmZlY3RUZXN0ICYmIChkdC5maWxlcyAmJiBkdC5maWxlcy5sZW5ndGggfHwgIWlzU2FmYXJpICYmIGR0LnR5cGVzLmNvbnRhaW5zICYmIGR0LnR5cGVzLmNvbnRhaW5zKFwiRmlsZXNcIikgfHwgZHQudHlwZXMuaW5jbHVkZXMgJiYgZHQudHlwZXMuaW5jbHVkZXMoXCJGaWxlc1wiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaXNPclNldERyb3BEaXNhYmxlZChpc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICBpZiAoaXNEaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcHJldmVudERyb3AgPSBpc0Rpc2FibGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByZXZlbnREcm9wO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJIaWRlem9uZXNFdmVudCgpIHtcbiAgICAgICAgICAgIHZhciBoaWRlWm9uZXNFdmVudDtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJVc2luZ09sZEFwaSgpIHtcbiAgICAgICAgICAgICAgICBoaWRlWm9uZXNFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiRXZlbnRcIik7XG4gICAgICAgICAgICAgICAgaGlkZVpvbmVzRXZlbnQuaW5pdEV2ZW50KG9wdGlvbnMuSElERV9aT05FU19FVkVOVF9OQU1FLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3aW5kb3cuQ3VzdG9tRXZlbnQpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBoaWRlWm9uZXNFdmVudCA9IG5ldyBDdXN0b21FdmVudChvcHRpb25zLkhJREVfWk9ORVNfRVZFTlRfTkFNRSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJVc2luZ09sZEFwaSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdHJpZ2dlclVzaW5nT2xkQXBpKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGhpZGVab25lc0V2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZWxlbWVudCwgXCJkcmFnb3ZlclwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkRmlsZURyYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZWZmZWN0ID0gcXEuaWUoKSAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5maWxlRHJvcCA/IG51bGwgOiBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkO1xuICAgICAgICAgICAgICAgIGlmIChlZmZlY3QgPT09IFwibW92ZVwiIHx8IGVmZmVjdCA9PT0gXCJsaW5rTW92ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBcIm1vdmVcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gXCJjb3B5XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZWxlbWVudCwgXCJkcmFnZW50ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNPclNldERyb3BEaXNhYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZEZpbGVEcmFnKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vbkVudGVyKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcG9zZVN1cHBvcnQuYXR0YWNoKGVsZW1lbnQsIFwiZHJhZ2xlYXZlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzVmFsaWRGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wdGlvbnMub25MZWF2ZShlKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRlZFRhcmdldCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgICAgICAgICAgIGlmIChxcSh0aGlzKS5jb250YWlucyhyZWxhdGVkVGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wdGlvbnMub25MZWF2ZU5vdERlc2NlbmRhbnRzKGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwb3NlU3VwcG9ydC5hdHRhY2goZWxlbWVudCwgXCJkcm9wXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzT3JTZXREcm9wRGlzYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVmFsaWRGaWxlRHJhZyhlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vbkRyb3AoZSk7XG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJIaWRlem9uZXNFdmVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGRpc2FibGVEcm9wT3V0c2lkZSgpO1xuICAgICAgICBhdHRhY2hFdmVudHMoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGRyb3BEaXNhYmxlZDogZnVuY3Rpb24oaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpc09yU2V0RHJvcERpc2FibGVkKGlzRGlzYWJsZWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRpc3Bvc2VTdXBwb3J0LmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRFbGVtZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Rlc3RpbmcgPSB7fTtcbiAgICAgICAgdGhpcy5fdGVzdGluZy5pc1ZhbGlkRmlsZURyYWcgPSBpc1ZhbGlkRmlsZURyYWc7XG4gICAgfTtcbiAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBxcS51aVB1YmxpY0FwaSA9IHtcbiAgICAgICAgICAgIGFkZEluaXRpYWxGaWxlczogZnVuY3Rpb24oY2FubmVkRmlsZUxpc3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLmFkZEluaXRpYWxGaWxlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuYWRkQ2FjaGVUb0RvbSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsZWFyU3RvcmVkRmlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuY2xlYXJTdG9yZWRGaWxlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuY2xlYXJGaWxlcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZEV4dHJhRHJvcHpvbmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kbmQgJiYgdGhpcy5fZG5kLnNldHVwRXh0cmFEcm9wem9uZShlbGVtZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmVFeHRyYURyb3B6b25lOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2RuZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZG5kLnJlbW92ZURyb3B6b25lKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJdGVtQnlGaWxlSWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl90ZW1wbGF0aW5nLmlzSGlkZGVuRm9yZXZlcihpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLnJlc2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy5idXR0b24gJiYgdGhpcy5fdGVtcGxhdGluZy5nZXRCdXR0b24oKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0QnV0dG9uSWQgPSB0aGlzLl9jcmVhdGVVcGxvYWRCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy5fdGVtcGxhdGluZy5nZXRCdXR0b24oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLl9vcHRpb25zLnRleHQuZmlsZUlucHV0VGl0bGVcbiAgICAgICAgICAgICAgICAgICAgfSkuZ2V0QnV0dG9uSWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2RuZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kbmQuZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kbmQgPSB0aGlzLl9zZXR1cERyYWdBbmREcm9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsRmlsZXNJbkJhdGNoID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwQ2xpY2tBbmRFZGl0RXZlbnRIYW5kbGVycygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE5hbWU6IGZ1bmN0aW9uKGlkLCBuZXdOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdHRlZEZpbGVuYW1lID0gdGhpcy5fb3B0aW9ucy5mb3JtYXRGaWxlTmFtZShuZXdOYW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLnNldE5hbWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZUZpbGVuYW1lKGlkLCBmb3JtYXR0ZWRGaWxlbmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2VVcGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhdXNlZCA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUucGF1c2VVcGxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBwYXVzZWQgJiYgdGhpcy5fdGVtcGxhdGluZy51cGxvYWRQYXVzZWQoaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXVzZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGludWVVcGxvYWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRpbnVlZCA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuY29udGludWVVcGxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZWQgJiYgdGhpcy5fdGVtcGxhdGluZy51cGxvYWRDb250aW51ZWQoaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250aW51ZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWQ6IGZ1bmN0aW9uKGZpbGVDb250YWluZXJPckNoaWxkRWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlSWQoZmlsZUNvbnRhaW5lck9yQ2hpbGRFbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RHJvcFRhcmdldDogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGUgPSB0aGlzLmdldEZpbGUoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZS5xcURyb3BUYXJnZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHFxLnVpUHJpdmF0ZUFwaSA9IHtcbiAgICAgICAgICAgIF9nZXRCdXR0b246IGZ1bmN0aW9uKGJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX2dldEJ1dHRvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIGlmICghYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChidXR0b25JZCA9PT0gdGhpcy5fZGVmYXVsdEJ1dHRvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24gPSB0aGlzLl90ZW1wbGF0aW5nLmdldEJ1dHRvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBidXR0b247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3JlbW92ZUZpbGVJdGVtOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlbW92ZUZpbGUoZmlsZUlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0dXBDbGlja0FuZEVkaXRFdmVudEhhbmRsZXJzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9maWxlQnV0dG9uc0NsaWNrSGFuZGxlciA9IHFxLkZpbGVCdXR0b25zQ2xpY2tIYW5kbGVyICYmIHRoaXMuX2JpbmRGaWxlQnV0dG9uc0NsaWNrRXZlbnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9mb2N1c2luRXZlbnRTdXBwb3J0ZWQgPSAhcXEuZmlyZWZveCgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VkaXRGaWxlbmFtZUVuYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maWxlbmFtZUNsaWNrSGFuZGxlciA9IHRoaXMuX2JpbmRGaWxlbmFtZUNsaWNrRXZlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsZW5hbWVJbnB1dEZvY3VzSW5IYW5kbGVyID0gdGhpcy5fYmluZEZpbGVuYW1lSW5wdXRGb2N1c0luRXZlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlciA9IHRoaXMuX2JpbmRGaWxlbmFtZUlucHV0Rm9jdXNFdmVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0dXBEcmFnQW5kRHJvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBkcm9wWm9uZUVsZW1lbnRzID0gdGhpcy5fb3B0aW9ucy5kcmFnQW5kRHJvcC5leHRyYURyb3B6b25lcywgdGVtcGxhdGluZyA9IHRoaXMuX3RlbXBsYXRpbmcsIGRlZmF1bHREcm9wWm9uZSA9IHRlbXBsYXRpbmcuZ2V0RHJvcFpvbmUoKTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0RHJvcFpvbmUgJiYgZHJvcFpvbmVFbGVtZW50cy5wdXNoKGRlZmF1bHREcm9wWm9uZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5EcmFnQW5kRHJvcCh7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bab25lRWxlbWVudHM6IGRyb3Bab25lRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGFsbG93TXVsdGlwbGVJdGVtczogdGhpcy5fb3B0aW9ucy5tdWx0aXBsZSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcEFjdGl2ZTogdGhpcy5fb3B0aW9ucy5jbGFzc2VzLmRyb3BBY3RpdmVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nRHJvcHBlZEZpbGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dEcm9wUHJvY2Vzc2luZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NpbmdEcm9wcGVkRmlsZXNDb21wbGV0ZTogZnVuY3Rpb24oZmlsZXMsIHRhcmdldEVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlRHJvcFByb2Nlc3NpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcS5lYWNoKGZpbGVzLCBmdW5jdGlvbihpZHgsIGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5xcURyb3BUYXJnZXQgPSB0YXJnZXRFbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWRkRmlsZXMoZmlsZXMsIG51bGwsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wRXJyb3I6IGZ1bmN0aW9uKGNvZGUsIGVycm9yRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2l0ZW1FcnJvcihjb2RlLCBlcnJvckRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BMb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGxldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cobWVzc2FnZSwgbGV2ZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2JpbmRGaWxlQnV0dG9uc0NsaWNrRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHFxLkZpbGVCdXR0b25zQ2xpY2tIYW5kbGVyKHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZzogdGhpcy5fdGVtcGxhdGluZyxcbiAgICAgICAgICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKG1lc3NhZ2UsIGx2bCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlRmlsZTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRlbGV0ZUZpbGUoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYW5jZWwoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25SZXRyeTogZnVuY3Rpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJldHJ5KGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uUGF1c2U6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXVzZVVwbG9hZChmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkNvbnRpbnVlOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29udGludWVVcGxvYWQoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25HZXROYW1lOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdldE5hbWUoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pc0VkaXRGaWxlbmFtZUVuYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0aW5nLmlzRWRpdEZpbGVuYW1lUG9zc2libGUoKSAmJiAhdGhpcy5fb3B0aW9ucy5hdXRvVXBsb2FkICYmIHFxLkZpbGVuYW1lQ2xpY2tIYW5kbGVyICYmIHFxLkZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXIgJiYgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZmlsZW5hbWVFZGl0SGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCB0ZW1wbGF0aW5nID0gdGhpcy5fdGVtcGxhdGluZztcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nOiB0ZW1wbGF0aW5nLFxuICAgICAgICAgICAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGx2bCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cobWVzc2FnZSwgbHZsKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25HZXRVcGxvYWRTdGF0dXM6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0VXBsb2Fkcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbGVJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkdldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0TmFtZShmaWxlSWQpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblNldE5hbWU6IGZ1bmN0aW9uKGlkLCBuZXdOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldE5hbWUoaWQsIG5ld05hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkVkaXRpbmdTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBpc0VkaXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxcUlucHV0ID0gcXEodGVtcGxhdGluZy5nZXRFZGl0SW5wdXQoaWQpKSwgcXFGaWxlQ29udGFpbmVyID0gcXEodGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNFZGl0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXFJbnB1dC5hZGRDbGFzcyhcInFxLWVkaXRpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlRmlsZW5hbWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZUVkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXFJbnB1dC5yZW1vdmVDbGFzcyhcInFxLWVkaXRpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93RmlsZW5hbWUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuc2hvd0VkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHFxRmlsZUNvbnRhaW5lci5hZGRDbGFzcyhcInFxLXRlbXBcIikucmVtb3ZlQ2xhc3MoXCJxcS10ZW1wXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKGlkLCBvbGRTdGF0dXMsIG5ld1N0YXR1cykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uVXBsb2FkU3RhdHVzQ2hhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRWRpdEZpbGVuYW1lRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpICYmIG5ld1N0YXR1cyAhPT0gcXEuc3RhdHVzLlNVQk1JVFRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5tYXJrRmlsZW5hbWVFZGl0YWJsZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVFZGl0SWNvbihpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9sZFN0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9SRVRSWUlORyAmJiBuZXdTdGF0dXMgPT09IHFxLnN0YXR1cy5VUExPQURJTkcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlUmV0cnkoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBxcSh0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKS5yZW1vdmVDbGFzcyh0aGlzLl9jbGFzc2VzLnJldHJ5aW5nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1N0YXR1cyA9PT0gcXEuc3RhdHVzLlVQTE9BRF9GQUlMRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlUGF1c2UoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmluZEZpbGVuYW1lSW5wdXRGb2N1c0luRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzcGVjID0gcXEuZXh0ZW5kKHt9LCB0aGlzLl9maWxlbmFtZUVkaXRIYW5kbGVyKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSW5IYW5kbGVyKHNwZWMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iaW5kRmlsZW5hbWVJbnB1dEZvY3VzRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzcGVjID0gcXEuZXh0ZW5kKHt9LCB0aGlzLl9maWxlbmFtZUVkaXRIYW5kbGVyKCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSGFuZGxlcihzcGVjKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYmluZEZpbGVuYW1lQ2xpY2tFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNwZWMgPSBxcS5leHRlbmQoe30sIHRoaXMuX2ZpbGVuYW1lRWRpdEhhbmRsZXIoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBxcS5GaWxlbmFtZUNsaWNrSGFuZGxlcihzcGVjKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc3RvcmVGb3JMYXRlcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9zdG9yZUZvckxhdGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlU3Bpbm5lcihpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQWxsQ29tcGxldGU6IGZ1bmN0aW9uKHN1Y2Nlc3NmdWwsIGZhaWxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uQWxsQ29tcGxldGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlc2V0VG90YWxQcm9ncmVzcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdDogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZ2V0RmlsZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5xcVBhdGggJiYgdGhpcy5fb3B0aW9ucy5kcmFnQW5kRHJvcC5yZXBvcnREaXJlY3RvcnlQYXRocykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXNTdG9yZS5hZGRSZWFkT25seShpZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXFwYXRoOiBmaWxlLnFxUGF0aFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25TdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRUb0xpc3QoaWQsIG5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblN1Ym1pdHRlZDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFZGl0RmlsZW5hbWVFbmFibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5tYXJrRmlsZW5hbWVFZGl0YWJsZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd0VkaXRJY29uKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9mb2N1c2luRXZlbnRTdXBwb3J0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXIuYWRkSGFuZGxlcih0aGlzLl90ZW1wbGF0aW5nLmdldEVkaXRJbnB1dChpZCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vblByb2dyZXNzOiBmdW5jdGlvbihpZCwgbmFtZSwgbG9hZGVkLCB0b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uUHJvZ3Jlc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVByb2dyZXNzKGlkLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgICAgICBpZiAodG90YWwgPT09IDAgfHwgTWF0aC5yb3VuZChsb2FkZWQgLyB0b3RhbCAqIDEwMCkgPT09IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVQYXVzZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuaGlkZVByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCB0aGlzLl9vcHRpb25zLnRleHQud2FpdGluZ0ZvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzcGxheUZpbGVTaXplKGlkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXNwbGF5RmlsZVNpemUoaWQsIGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25Ub3RhbFByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25Ub3RhbFByb2dyZXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy51cGRhdGVUb3RhbFByb2dyZXNzKGxvYWRlZCwgdG90YWwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkNvbXBsZXRlOiBmdW5jdGlvbihpZCwgbmFtZSwgcmVzdWx0LCB4aHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50UmV0VmFsID0gdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25Db21wbGV0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0ZW1wbGF0aW5nID0gdGhpcy5fdGVtcGxhdGluZywgZmlsZUNvbnRhaW5lciA9IHRlbXBsYXRpbmcuZ2V0RmlsZUNvbnRhaW5lcihpZCksIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlVXBsb2FkKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICBxcShmaWxlQ29udGFpbmVyKS5yZW1vdmVDbGFzcyhzZWxmLl9jbGFzc2VzLnJldHJ5aW5nKTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5oaWRlUHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICB9KS5zdGF0dXMgIT09IHFxLnN0YXR1cy5VUExPQURfRkFJTEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLmhpZGVDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRpbmcuaGlkZVNwaW5uZXIoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX21hcmtGaWxlQXNTdWNjZXNzZnVsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKGZpbGVDb250YWluZXIpLmFkZENsYXNzKHNlbGYuX2NsYXNzZXMuZmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBsYXRpbmcuaXNSZXRyeVBvc3NpYmxlKCkgJiYgIXNlbGYuX3ByZXZlbnRSZXRyaWVzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFxKGZpbGVDb250YWluZXIpLmFkZENsYXNzKHNlbGYuX2NsYXNzZXMucmV0cnlhYmxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0aW5nLnNob3dSZXRyeShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jb250cm9sRmFpbHVyZVRleHREaXNwbGF5KGlkLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChwYXJlbnRSZXRWYWwgaW5zdGFuY2VvZiBxcS5Qcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFJldFZhbC5kb25lKGZ1bmN0aW9uKG5ld1Jlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVVcGxvYWQobmV3UmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVVcGxvYWQocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFJldFZhbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfbWFya0ZpbGVBc1N1Y2Nlc3NmdWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRpbmcgPSB0aGlzLl90ZW1wbGF0aW5nO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0RlbGV0ZVBvc3NpYmxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGluZy5zaG93RGVsZXRlQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXEodGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKSkuYWRkQ2xhc3ModGhpcy5fY2xhc3Nlcy5zdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXliZVVwZGF0ZVRodW1ibmFpbChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uVXBsb2FkUHJlcDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9vblVwbG9hZFByZXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dTcGlubmVyKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudFJldFZhbCA9IHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uVXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zaG93U3Bpbm5lcihpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFJldFZhbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25VcGxvYWRDaHVuazogZnVuY3Rpb24oaWQsIGNodW5rRGF0YSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uVXBsb2FkQ2h1bmsuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmtEYXRhLnBhcnRJbmRleCA+IDAgJiYgdGhpcy5faGFuZGxlci5pc1Jlc3VtYWJsZShpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5hbGxvd1BhdXNlKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQ2FuY2VsOiBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uQ2FuY2VsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRmlsZUl0ZW0oaWQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9nZXROb3RGaW5pc2hlZCgpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVzZXRUb3RhbFByb2dyZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkJlZm9yZUF1dG9SZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV0cnlOdW1Gb3JEaXNwbGF5LCBtYXhBdXRvLCByZXRyeU5vdGU7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fb25CZWZvcmVBdXRvUmV0cnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93Q2FuY2VsTGluayhpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucmV0cnkuc2hvd0F1dG9SZXRyeU5vdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0cnlOdW1Gb3JEaXNwbGF5ID0gdGhpcy5fYXV0b1JldHJpZXNbaWRdO1xuICAgICAgICAgICAgICAgICAgICBtYXhBdXRvID0gdGhpcy5fb3B0aW9ucy5yZXRyeS5tYXhBdXRvQXR0ZW1wdHM7XG4gICAgICAgICAgICAgICAgICAgIHJldHJ5Tm90ZSA9IHRoaXMuX29wdGlvbnMucmV0cnkuYXV0b1JldHJ5Tm90ZS5yZXBsYWNlKC9cXHtyZXRyeU51bVxcfS9nLCByZXRyeU51bUZvckRpc3BsYXkpO1xuICAgICAgICAgICAgICAgICAgICByZXRyeU5vdGUgPSByZXRyeU5vdGUucmVwbGFjZSgvXFx7bWF4QXV0b1xcfS9nLCBtYXhBdXRvKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCByZXRyeU5vdGUpO1xuICAgICAgICAgICAgICAgICAgICBxcSh0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKS5hZGRDbGFzcyh0aGlzLl9jbGFzc2VzLnJldHJ5aW5nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uQmVmb3JlTWFudWFsUmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uQmVmb3JlTWFudWFsUmV0cnkuYXBwbHkodGhpcywgYXJndW1lbnRzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlc2V0UHJvZ3Jlc3MoaWQpO1xuICAgICAgICAgICAgICAgICAgICBxcSh0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKS5yZW1vdmVDbGFzcyh0aGlzLl9jbGFzc2VzLmZhaWwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd0NhbmNlbExpbmsoaWQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBxcSh0aGlzLl90ZW1wbGF0aW5nLmdldEZpbGVDb250YWluZXIoaWQpKS5hZGRDbGFzcyh0aGlzLl9jbGFzc2VzLnJldHJ5YWJsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2hvd1JldHJ5KGlkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXREZWxldGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2Vzc0NhbGxiYWNrID0gcXEuYmluZCh0aGlzLl9vblN1Ym1pdERlbGV0ZVN1Y2Nlc3MsIHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uU3VibWl0RGVsZXRlLmNhbGwodGhpcywgaWQsIG9uU3VjY2Vzc0NhbGxiYWNrKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25TdWJtaXREZWxldGVTdWNjZXNzOiBmdW5jdGlvbihpZCwgdXVpZCwgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5mb3JjZUNvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd0RlbGV0ZUNvbmZpcm0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZW5kRGVsZXRlUmVxdWVzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfb25EZWxldGVDb21wbGV0ZTogZnVuY3Rpb24oaWQsIHhociwgaXNFcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX29uRGVsZXRlQ29tcGxldGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5kZWxldGluZ0ZhaWxlZFRleHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dEZWxldGVCdXR0b24oaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUZpbGVJdGVtKGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NlbmREZWxldGVSZXF1ZXN0OiBmdW5jdGlvbihpZCwgdXVpZCwgYWRkaXRpb25hbE1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5oaWRlRGVsZXRlQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNldFN0YXR1c1RleHQoaWQsIHRoaXMuX29wdGlvbnMuZGVsZXRlRmlsZS5kZWxldGluZ1N0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUhhbmRsZXIuc2VuZERlbGV0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93RGVsZXRlQ29uZmlybTogZnVuY3Rpb24oaWQsIHV1aWQsIG1hbmRhdGVkUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gdGhpcy5nZXROYW1lKGlkKSwgY29uZmlybU1lc3NhZ2UgPSB0aGlzLl9vcHRpb25zLmRlbGV0ZUZpbGUuY29uZmlybU1lc3NhZ2UucmVwbGFjZSgvXFx7ZmlsZW5hbWVcXH0vZywgZmlsZU5hbWUpLCB1dWlkID0gdGhpcy5nZXRVdWlkKGlkKSwgZGVsZXRlUmVxdWVzdEFyZ3MgPSBhcmd1bWVudHMsIHNlbGYgPSB0aGlzLCByZXRWYWw7XG4gICAgICAgICAgICAgICAgcmV0VmFsID0gdGhpcy5fb3B0aW9ucy5zaG93Q29uZmlybShjb25maXJtTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgaWYgKHFxLmlzR2VuZXJpY1Byb21pc2UocmV0VmFsKSkge1xuICAgICAgICAgICAgICAgICAgICByZXRWYWwudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmREZWxldGVSZXF1ZXN0LmFwcGx5KHNlbGYsIGRlbGV0ZVJlcXVlc3RBcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXRWYWwgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmREZWxldGVSZXF1ZXN0LmFwcGx5KHNlbGYsIGRlbGV0ZVJlcXVlc3RBcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FkZFRvTGlzdDogZnVuY3Rpb24oaWQsIG5hbWUsIGNhbm5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBwcmVwZW5kRGF0YSwgcHJlcGVuZEluZGV4ID0gMCwgZG9udERpc3BsYXkgPSB0aGlzLl9oYW5kbGVyLmlzUHJveGllZChpZCkgJiYgdGhpcy5fb3B0aW9ucy5zY2FsaW5nLmhpZGVTY2FsZWQsIHJlY29yZDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5kaXNwbGF5LnByZXBlbmRGaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdG90YWxGaWxlc0luQmF0Y2ggPiAxICYmIHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXBlbmRJbmRleCA9IHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSAtIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHJlcGVuZERhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogcHJlcGVuZEluZGV4XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghY2FubmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmRpc2FibGVDYW5jZWxGb3JGb3JtVXBsb2FkcyAmJiAhcXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5kaXNhYmxlQ2FuY2VsKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9vcHRpb25zLm11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmQgPSB0aGlzLmdldFVwbG9hZHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVkUHJveHlHcm91cCA9IHRoaXMuX2hhbmRsZWRQcm94eUdyb3VwIHx8IHJlY29yZC5wcm94eUdyb3VwSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLnByb3h5R3JvdXBJZCAhPT0gdGhpcy5faGFuZGxlZFByb3h5R3JvdXAgfHwgIXJlY29yZC5wcm94eUdyb3VwSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVyLmNhbmNlbEFsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyTGlzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZWRQcm94eUdyb3VwID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2FubmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuYWRkRmlsZVRvQ2FjaGUoaWQsIHRoaXMuX29wdGlvbnMuZm9ybWF0RmlsZU5hbWUobmFtZSksIHByZXBlbmREYXRhLCBkb250RGlzcGxheSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlVGh1bWJuYWlsKGlkLCB0aGlzLl90aHVtYm5haWxVcmxzW2lkXSwgdHJ1ZSwgdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLmN1c3RvbVJlc2l6ZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuYWRkRmlsZShpZCwgdGhpcy5fb3B0aW9ucy5mb3JtYXRGaWxlTmFtZShuYW1lKSwgcHJlcGVuZERhdGEsIGRvbnREaXNwbGF5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5nZW5lcmF0ZVByZXZpZXcoaWQsIHRoaXMuZ2V0RmlsZShpZCksIHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5jdXN0b21SZXNpemVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZXNJbkJhdGNoQWRkZWRUb1VpICs9IDE7XG4gICAgICAgICAgICAgICAgaWYgKGNhbm5lZCB8fCB0aGlzLl9vcHRpb25zLmRpc3BsYXkuZmlsZVNpemVPblN1Ym1pdCAmJiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5hamF4VXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlGaWxlU2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jbGVhckxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuY2xlYXJGaWxlcygpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTdG9yZWRGaWxlcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9kaXNwbGF5RmlsZVNpemU6IGZ1bmN0aW9uKGlkLCBsb2FkZWRTaXplLCB0b3RhbFNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuZ2V0U2l6ZShpZCksIHNpemVGb3JEaXNwbGF5ID0gdGhpcy5fZm9ybWF0U2l6ZShzaXplKTtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2FkZWRTaXplICE9PSB1bmRlZmluZWQgJiYgdG90YWxTaXplICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVGb3JEaXNwbGF5ID0gdGhpcy5fZm9ybWF0UHJvZ3Jlc3MobG9hZGVkU2l6ZSwgdG90YWxTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVNpemUoaWQsIHNpemVGb3JEaXNwbGF5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2Zvcm1hdFByb2dyZXNzOiBmdW5jdGlvbih1cGxvYWRlZFNpemUsIHRvdGFsU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5fb3B0aW9ucy50ZXh0LmZvcm1hdFByb2dyZXNzO1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHIobmFtZSwgcmVwbGFjZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShuYW1lLCByZXBsYWNlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHIoXCJ7cGVyY2VudH1cIiwgTWF0aC5yb3VuZCh1cGxvYWRlZFNpemUgLyB0b3RhbFNpemUgKiAxMDApKTtcbiAgICAgICAgICAgICAgICByKFwie3RvdGFsX3NpemV9XCIsIHRoaXMuX2Zvcm1hdFNpemUodG90YWxTaXplKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NvbnRyb2xGYWlsdXJlVGV4dERpc3BsYXk6IGZ1bmN0aW9uKGlkLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBtb2RlLCByZXNwb25zZVByb3BlcnR5LCBmYWlsdXJlUmVhc29uO1xuICAgICAgICAgICAgICAgIG1vZGUgPSB0aGlzLl9vcHRpb25zLmZhaWxlZFVwbG9hZFRleHREaXNwbGF5Lm1vZGU7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VQcm9wZXJ0eSA9IHRoaXMuX29wdGlvbnMuZmFpbGVkVXBsb2FkVGV4dERpc3BsYXkucmVzcG9uc2VQcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgICAgICBmYWlsdXJlUmVhc29uID0gcmVzcG9uc2VbcmVzcG9uc2VQcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmFpbHVyZVJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbHVyZVJlYXNvbiA9IHRoaXMuX29wdGlvbnMudGV4dC5mYWlsVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuc2V0U3RhdHVzVGV4dChpZCwgZmFpbHVyZVJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmZhaWxlZFVwbG9hZFRleHREaXNwbGF5LmVuYWJsZVRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dUb29sdGlwKGlkLCBmYWlsdXJlUmVhc29uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5zZXRTdGF0dXNUZXh0KGlkLCB0aGlzLl9vcHRpb25zLnRleHQuZmFpbFVwbG9hZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcImZhaWxlZFVwbG9hZFRleHREaXNwbGF5Lm1vZGUgdmFsdWUgb2YgJ1wiICsgbW9kZSArIFwiJyBpcyBub3QgdmFsaWRcIiwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd1Rvb2x0aXA6IGZ1bmN0aW9uKGlkLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5nZXRGaWxlQ29udGFpbmVyKGlkKS50aXRsZSA9IHRleHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dDYW5jZWxMaW5rOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fb3B0aW9ucy5kaXNhYmxlQ2FuY2VsRm9yRm9ybVVwbG9hZHMgfHwgcXEuc3VwcG9ydGVkRmVhdHVyZXMuYWpheFVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnNob3dDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaXRlbUVycm9yOiBmdW5jdGlvbihjb2RlLCBuYW1lLCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9pdGVtRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLnNob3dNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iYXRjaEVycm9yOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fYmF0Y2hFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX29wdGlvbnMuc2hvd01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NldHVwUGFzdGVQcm9tcHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNhbGxiYWNrcy5vblBhc3RlUmVjZWl2ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZWxmLl9vcHRpb25zLnBhc3RlLm5hbWVQcm9tcHRNZXNzYWdlLCBkZWZhdWx0VmFsID0gc2VsZi5fb3B0aW9ucy5wYXN0ZS5kZWZhdWx0TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29wdGlvbnMuc2hvd1Byb21wdChtZXNzYWdlLCBkZWZhdWx0VmFsKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9maWxlT3JCbG9iUmVqZWN0ZWQ6IGZ1bmN0aW9uKGlkLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG90YWxGaWxlc0luQmF0Y2ggLT0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9maWxlT3JCbG9iUmVqZWN0ZWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfcHJlcGFyZUl0ZW1zRm9yVXBsb2FkOiBmdW5jdGlvbihpdGVtcywgcGFyYW1zLCBlbmRwb2ludCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsRmlsZXNJbkJhdGNoID0gaXRlbXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVzSW5CYXRjaEFkZGVkVG9VaSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fcHJlcGFyZUl0ZW1zRm9yVXBsb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX21heWJlVXBkYXRlVGh1bWJuYWlsOiBmdW5jdGlvbihmaWxlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGh1bWJuYWlsVXJsID0gdGhpcy5fdGh1bWJuYWlsVXJsc1tmaWxlSWRdLCBmaWxlU3RhdHVzID0gdGhpcy5nZXRVcGxvYWRzKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbGVJZFxuICAgICAgICAgICAgICAgIH0pLnN0YXR1cztcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVN0YXR1cyAhPT0gcXEuc3RhdHVzLkRFTEVURUQgJiYgKHRodW1ibmFpbFVybCB8fCB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMucGxhY2Vob2xkZXJzLndhaXRVbnRpbFJlc3BvbnNlIHx8ICFxcS5zdXBwb3J0ZWRGZWF0dXJlcy5pbWFnZVByZXZpZXdzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnVwZGF0ZVRodW1ibmFpbChmaWxlSWQsIHRodW1ibmFpbFVybCwgdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLmN1c3RvbVJlc2l6ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYWRkQ2FubmVkRmlsZTogZnVuY3Rpb24oc2Vzc2lvbkRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0aGlzLl9wYXJlbnQucHJvdG90eXBlLl9hZGRDYW5uZWRGaWxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkVG9MaXN0KGlkLCB0aGlzLmdldE5hbWUoaWQpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVTcGlubmVyKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLmhpZGVDYW5jZWwoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX21hcmtGaWxlQXNTdWNjZXNzZnVsKGlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3NldFNpemU6IGZ1bmN0aW9uKGlkLCBuZXdTaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50LnByb3RvdHlwZS5fc2V0U2l6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcudXBkYXRlU2l6ZShpZCwgdGhpcy5fZm9ybWF0U2l6ZShuZXdTaXplKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nlc3Npb25SZXF1ZXN0Q29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcuYWRkQ2FjaGVUb0RvbSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcm90b3R5cGUuX3Nlc3Npb25SZXF1ZXN0Q29tcGxldGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KSgpO1xuICAgIHFxLkZpbmVVcGxvYWRlciA9IGZ1bmN0aW9uKG8sIG5hbWVzcGFjZSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBuYW1lc3BhY2UgPyBxcVtuYW1lc3BhY2VdLkZpbmVVcGxvYWRlckJhc2ljIDogcXEuRmluZVVwbG9hZGVyQmFzaWM7XG4gICAgICAgIHRoaXMuX3BhcmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICBxcS5leHRlbmQodGhpcy5fb3B0aW9ucywge1xuICAgICAgICAgICAgZWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgIGJ1dHRvbjogbnVsbCxcbiAgICAgICAgICAgIGxpc3RFbGVtZW50OiBudWxsLFxuICAgICAgICAgICAgZHJhZ0FuZERyb3A6IHtcbiAgICAgICAgICAgICAgICBleHRyYURyb3B6b25lczogW10sXG4gICAgICAgICAgICAgICAgcmVwb3J0RGlyZWN0b3J5UGF0aHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgIGZvcm1hdFByb2dyZXNzOiBcIntwZXJjZW50fSUgb2Yge3RvdGFsX3NpemV9XCIsXG4gICAgICAgICAgICAgICAgZmFpbFVwbG9hZDogXCJVcGxvYWQgZmFpbGVkXCIsXG4gICAgICAgICAgICAgICAgd2FpdGluZ0ZvclJlc3BvbnNlOiBcIlByb2Nlc3NpbmcuLi5cIixcbiAgICAgICAgICAgICAgICBwYXVzZWQ6IFwiUGF1c2VkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJxcS10ZW1wbGF0ZVwiLFxuICAgICAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgICAgIHJldHJ5aW5nOiBcInFxLXVwbG9hZC1yZXRyeWluZ1wiLFxuICAgICAgICAgICAgICAgIHJldHJ5YWJsZTogXCJxcS11cGxvYWQtcmV0cnlhYmxlXCIsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogXCJxcS11cGxvYWQtc3VjY2Vzc1wiLFxuICAgICAgICAgICAgICAgIGZhaWw6IFwicXEtdXBsb2FkLWZhaWxcIixcbiAgICAgICAgICAgICAgICBlZGl0YWJsZTogXCJxcS1lZGl0YWJsZVwiLFxuICAgICAgICAgICAgICAgIGhpZGU6IFwicXEtaGlkZVwiLFxuICAgICAgICAgICAgICAgIGRyb3BBY3RpdmU6IFwicXEtdXBsb2FkLWRyb3AtYXJlYS1hY3RpdmVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWxlZFVwbG9hZFRleHREaXNwbGF5OiB7XG4gICAgICAgICAgICAgICAgbW9kZTogXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VQcm9wZXJ0eTogXCJlcnJvclwiLFxuICAgICAgICAgICAgICAgIGVuYWJsZVRvb2x0aXA6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgIHRvb01hbnlGaWxlc0Vycm9yOiBcIllvdSBtYXkgb25seSBkcm9wIG9uZSBmaWxlXCIsXG4gICAgICAgICAgICAgICAgdW5zdXBwb3J0ZWRCcm93c2VyOiBcIlVucmVjb3ZlcmFibGUgZXJyb3IgLSB0aGlzIGJyb3dzZXIgZG9lcyBub3QgcGVybWl0IGZpbGUgdXBsb2FkaW5nIG9mIGFueSBraW5kLlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cnk6IHtcbiAgICAgICAgICAgICAgICBzaG93QXV0b1JldHJ5Tm90ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdXRvUmV0cnlOb3RlOiBcIlJldHJ5aW5nIHtyZXRyeU51bX0ve21heEF1dG99Li4uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxldGVGaWxlOiB7XG4gICAgICAgICAgICAgICAgZm9yY2VDb25maXJtOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb25maXJtTWVzc2FnZTogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHtmaWxlbmFtZX0/XCIsXG4gICAgICAgICAgICAgICAgZGVsZXRpbmdTdGF0dXNUZXh0OiBcIkRlbGV0aW5nLi4uXCIsXG4gICAgICAgICAgICAgICAgZGVsZXRpbmdGYWlsZWRUZXh0OiBcIkRlbGV0ZSBmYWlsZWRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgICAgICAgICBmaWxlU2l6ZU9uU3VibWl0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmVwZW5kRmlsZXM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGFzdGU6IHtcbiAgICAgICAgICAgICAgICBwcm9tcHRGb3JOYW1lOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBuYW1lUHJvbXB0TWVzc2FnZTogXCJQbGVhc2UgbmFtZSB0aGlzIGltYWdlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0aHVtYm5haWxzOiB7XG4gICAgICAgICAgICAgICAgY3VzdG9tUmVzaXplcjogbnVsbCxcbiAgICAgICAgICAgICAgICBtYXhDb3VudDogMCxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgd2FpdFVudGlsUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBub3RBdmFpbGFibGVQYXRoOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB3YWl0aW5nUGF0aDogbnVsbFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGltZUJldHdlZW5UaHVtYnM6IDc1MFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNjYWxpbmc6IHtcbiAgICAgICAgICAgICAgICBoaWRlU2NhbGVkOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dNZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuX3RlbXBsYXRpbmcuaGFzRGlhbG9nKFwiYWxlcnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3RlbXBsYXRpbmcuc2hvd0RpYWxvZyhcImFsZXJ0XCIsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93Q29uZmlybTogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLl90ZW1wbGF0aW5nLmhhc0RpYWxvZyhcImNvbmZpcm1cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3RlbXBsYXRpbmcuc2hvd0RpYWxvZyhcImNvbmZpcm1cIiwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5jb25maXJtKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93UHJvbXB0OiBmdW5jdGlvbihtZXNzYWdlLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fdGVtcGxhdGluZy5oYXNEaWFsb2coXCJwcm9tcHRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3RlbXBsYXRpbmcuc2hvd0RpYWxvZyhcInByb21wdFwiLCBtZXNzYWdlLCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cucHJvbXB0KG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMuX29wdGlvbnMsIG8sIHRydWUpO1xuICAgICAgICB0aGlzLl90ZW1wbGF0aW5nID0gbmV3IHFxLlRlbXBsYXRpbmcoe1xuICAgICAgICAgICAgbG9nOiBxcS5iaW5kKHRoaXMubG9nLCB0aGlzKSxcbiAgICAgICAgICAgIHRlbXBsYXRlSWRPckVsOiB0aGlzLl9vcHRpb25zLnRlbXBsYXRlLFxuICAgICAgICAgICAgY29udGFpbmVyRWw6IHRoaXMuX29wdGlvbnMuZWxlbWVudCxcbiAgICAgICAgICAgIGZpbGVDb250YWluZXJFbDogdGhpcy5fb3B0aW9ucy5saXN0RWxlbWVudCxcbiAgICAgICAgICAgIGJ1dHRvbjogdGhpcy5fb3B0aW9ucy5idXR0b24sXG4gICAgICAgICAgICBpbWFnZUdlbmVyYXRvcjogdGhpcy5faW1hZ2VHZW5lcmF0b3IsXG4gICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgaGlkZTogdGhpcy5fb3B0aW9ucy5jbGFzc2VzLmhpZGUsXG4gICAgICAgICAgICAgICAgZWRpdGFibGU6IHRoaXMuX29wdGlvbnMuY2xhc3Nlcy5lZGl0YWJsZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbWl0czoge1xuICAgICAgICAgICAgICAgIG1heFRodW1iczogdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLm1heENvdW50LFxuICAgICAgICAgICAgICAgIHRpbWVCZXR3ZWVuVGh1bWJzOiB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMudGltZUJldHdlZW5UaHVtYnNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwbGFjZWhvbGRlcnM6IHtcbiAgICAgICAgICAgICAgICB3YWl0VW50aWxVcGRhdGU6IHRoaXMuX29wdGlvbnMudGh1bWJuYWlscy5wbGFjZWhvbGRlcnMud2FpdFVudGlsUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsTm90QXZhaWxhYmxlOiB0aGlzLl9vcHRpb25zLnRodW1ibmFpbHMucGxhY2Vob2xkZXJzLm5vdEF2YWlsYWJsZVBhdGgsXG4gICAgICAgICAgICAgICAgd2FpdGluZ0ZvclRodW1ibmFpbDogdGhpcy5fb3B0aW9ucy50aHVtYm5haWxzLnBsYWNlaG9sZGVycy53YWl0aW5nUGF0aFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMuX29wdGlvbnMudGV4dFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMud29ya2Fyb3VuZHMuaW9zOFNhZmFyaVVwbG9hZHMgJiYgcXEuaW9zODAwKCkgJiYgcXEuaW9zU2FmYXJpKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRpbmcucmVuZGVyRmFpbHVyZSh0aGlzLl9vcHRpb25zLm1lc3NhZ2VzLnVuc3VwcG9ydGVkQnJvd3NlcklvczhTYWZhcmkpO1xuICAgICAgICB9IGVsc2UgaWYgKCFxcS5zdXBwb3J0ZWRGZWF0dXJlcy51cGxvYWRpbmcgfHwgdGhpcy5fb3B0aW9ucy5jb3JzLmV4cGVjdGVkICYmICFxcS5zdXBwb3J0ZWRGZWF0dXJlcy51cGxvYWRDb3JzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZW1wbGF0aW5nLnJlbmRlckZhaWx1cmUodGhpcy5fb3B0aW9ucy5tZXNzYWdlcy51bnN1cHBvcnRlZEJyb3dzZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fd3JhcENhbGxiYWNrcygpO1xuICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGluZy5yZW5kZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2NsYXNzZXMgPSB0aGlzLl9vcHRpb25zLmNsYXNzZXM7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX29wdGlvbnMuYnV0dG9uICYmIHRoaXMuX3RlbXBsYXRpbmcuZ2V0QnV0dG9uKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0QnV0dG9uSWQgPSB0aGlzLl9jcmVhdGVVcGxvYWRCdXR0b24oe1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLl90ZW1wbGF0aW5nLmdldEJ1dHRvbigpLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy5fb3B0aW9ucy50ZXh0LmZpbGVJbnB1dFRpdGxlXG4gICAgICAgICAgICAgICAgfSkuZ2V0QnV0dG9uSWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3NldHVwQ2xpY2tBbmRFZGl0RXZlbnRIYW5kbGVycygpO1xuICAgICAgICAgICAgaWYgKHFxLkRyYWdBbmREcm9wICYmIHFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZG5kID0gdGhpcy5fc2V0dXBEcmFnQW5kRHJvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucGFzdGUudGFyZ2V0RWxlbWVudCAmJiB0aGlzLl9vcHRpb25zLnBhc3RlLnByb21wdEZvck5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAocXEuUGFzdGVTdXBwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwUGFzdGVQcm9tcHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlBhc3RlIHN1cHBvcnQgbW9kdWxlIG5vdCBmb3VuZC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90b3RhbEZpbGVzSW5CYXRjaCA9IDA7XG4gICAgICAgICAgICB0aGlzLl9maWxlc0luQmF0Y2hBZGRlZFRvVWkgPSAwO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBxcS5leHRlbmQocXEuRmluZVVwbG9hZGVyLnByb3RvdHlwZSwgcXEuYmFzZVB1YmxpY0FwaSk7XG4gICAgcXEuZXh0ZW5kKHFxLkZpbmVVcGxvYWRlci5wcm90b3R5cGUsIHFxLmJhc2VQcml2YXRlQXBpKTtcbiAgICBxcS5leHRlbmQocXEuRmluZVVwbG9hZGVyLnByb3RvdHlwZSwgcXEudWlQdWJsaWNBcGkpO1xuICAgIHFxLmV4dGVuZChxcS5GaW5lVXBsb2FkZXIucHJvdG90eXBlLCBxcS51aVByaXZhdGVBcGkpO1xuICAgIHFxLlRlbXBsYXRpbmcgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgRklMRV9JRF9BVFRSID0gXCJxcS1maWxlLWlkXCIsIEZJTEVfQ0xBU1NfUFJFRklYID0gXCJxcS1maWxlLWlkLVwiLCBUSFVNQk5BSUxfTUFYX1NJWkVfQVRUUiA9IFwicXEtbWF4LXNpemVcIiwgVEhVTUJOQUlMX1NFUlZFUl9TQ0FMRV9BVFRSID0gXCJxcS1zZXJ2ZXItc2NhbGVcIiwgSElERV9EUk9QWk9ORV9BVFRSID0gXCJxcS1oaWRlLWRyb3B6b25lXCIsIERST1BaUE9ORV9URVhUX0FUVFIgPSBcInFxLWRyb3AtYXJlYS10ZXh0XCIsIElOX1BST0dSRVNTX0NMQVNTID0gXCJxcS1pbi1wcm9ncmVzc1wiLCBISURERU5fRk9SRVZFUl9DTEFTUyA9IFwicXEtaGlkZGVuLWZvcmV2ZXJcIiwgZmlsZUJhdGNoID0ge1xuICAgICAgICAgICAgY29udGVudDogZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxuICAgICAgICAgICAgbWFwOiB7fVxuICAgICAgICB9LCBpc0NhbmNlbERpc2FibGVkID0gZmFsc2UsIGdlbmVyYXRlZFRodW1ibmFpbHMgPSAwLCB0aHVtYm5haWxRdWV1ZU1vbml0b3JSdW5uaW5nID0gZmFsc2UsIHRodW1iR2VuZXJhdGlvblF1ZXVlID0gW10sIHRodW1ibmFpbE1heFNpemUgPSAtMSwgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGxvZzogbnVsbCxcbiAgICAgICAgICAgIGxpbWl0czoge1xuICAgICAgICAgICAgICAgIG1heFRodW1iczogMCxcbiAgICAgICAgICAgICAgICB0aW1lQmV0d2VlblRodW1iczogNzUwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGVtcGxhdGVJZE9yRWw6IFwicXEtdGVtcGxhdGVcIixcbiAgICAgICAgICAgIGNvbnRhaW5lckVsOiBudWxsLFxuICAgICAgICAgICAgZmlsZUNvbnRhaW5lckVsOiBudWxsLFxuICAgICAgICAgICAgYnV0dG9uOiBudWxsLFxuICAgICAgICAgICAgaW1hZ2VHZW5lcmF0b3I6IG51bGwsXG4gICAgICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgICAgICAgaGlkZTogXCJxcS1oaWRlXCIsXG4gICAgICAgICAgICAgICAgZWRpdGFibGU6IFwicXEtZWRpdGFibGVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyczoge1xuICAgICAgICAgICAgICAgIHdhaXRVbnRpbFVwZGF0ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsTm90QXZhaWxhYmxlOiBudWxsLFxuICAgICAgICAgICAgICAgIHdhaXRpbmdGb3JUaHVtYm5haWw6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICAgICAgcGF1c2VkOiBcIlBhdXNlZFwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHNlbGVjdG9yQ2xhc3NlcyA9IHtcbiAgICAgICAgICAgIGJ1dHRvbjogXCJxcS11cGxvYWQtYnV0dG9uLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBhbGVydERpYWxvZzogXCJxcS1hbGVydC1kaWFsb2ctc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRpYWxvZ0NhbmNlbEJ1dHRvbjogXCJxcS1jYW5jZWwtYnV0dG9uLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBjb25maXJtRGlhbG9nOiBcInFxLWNvbmZpcm0tZGlhbG9nLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkaWFsb2dNZXNzYWdlOiBcInFxLWRpYWxvZy1tZXNzYWdlLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkaWFsb2dPa0J1dHRvbjogXCJxcS1vay1idXR0b24tc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHByb21wdERpYWxvZzogXCJxcS1wcm9tcHQtZGlhbG9nLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICB1cGxvYWRlcjogXCJxcS11cGxvYWRlci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZHJvcDogXCJxcS11cGxvYWQtZHJvcC1hcmVhLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBsaXN0OiBcInFxLXVwbG9hZC1saXN0LXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBwcm9ncmVzc0JhckNvbnRhaW5lcjogXCJxcS1wcm9ncmVzcy1iYXItY29udGFpbmVyLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBwcm9ncmVzc0JhcjogXCJxcS1wcm9ncmVzcy1iYXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3NCYXJDb250YWluZXI6IFwicXEtdG90YWwtcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lci1zZWxlY3RvclwiLFxuICAgICAgICAgICAgdG90YWxQcm9ncmVzc0JhcjogXCJxcS10b3RhbC1wcm9ncmVzcy1iYXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGZpbGU6IFwicXEtdXBsb2FkLWZpbGUtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHNwaW5uZXI6IFwicXEtdXBsb2FkLXNwaW5uZXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHNpemU6IFwicXEtdXBsb2FkLXNpemUtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGNhbmNlbDogXCJxcS11cGxvYWQtY2FuY2VsLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBwYXVzZTogXCJxcS11cGxvYWQtcGF1c2Utc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGNvbnRpbnVlQnV0dG9uOiBcInFxLXVwbG9hZC1jb250aW51ZS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZGVsZXRlQnV0dG9uOiBcInFxLXVwbG9hZC1kZWxldGUtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHJldHJ5OiBcInFxLXVwbG9hZC1yZXRyeS1zZWxlY3RvclwiLFxuICAgICAgICAgICAgc3RhdHVzVGV4dDogXCJxcS11cGxvYWQtc3RhdHVzLXRleHQtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGVkaXRGaWxlbmFtZUlucHV0OiBcInFxLWVkaXQtZmlsZW5hbWUtc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGVkaXROYW1lSWNvbjogXCJxcS1lZGl0LWZpbGVuYW1lLWljb24tc2VsZWN0b3JcIixcbiAgICAgICAgICAgIGRyb3BUZXh0OiBcInFxLXVwbG9hZC1kcm9wLWFyZWEtdGV4dC1zZWxlY3RvclwiLFxuICAgICAgICAgICAgZHJvcFByb2Nlc3Npbmc6IFwicXEtZHJvcC1wcm9jZXNzaW5nLXNlbGVjdG9yXCIsXG4gICAgICAgICAgICBkcm9wUHJvY2Vzc2luZ1NwaW5uZXI6IFwicXEtZHJvcC1wcm9jZXNzaW5nLXNwaW5uZXItc2VsZWN0b3JcIixcbiAgICAgICAgICAgIHRodW1ibmFpbDogXCJxcS10aHVtYm5haWwtc2VsZWN0b3JcIlxuICAgICAgICB9LCBwcmV2aWV3R2VuZXJhdGlvbiA9IHt9LCBjYWNoZWRUaHVtYm5haWxOb3RBdmFpbGFibGVJbWcgPSBuZXcgcXEuUHJvbWlzZSgpLCBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nID0gbmV3IHFxLlByb21pc2UoKSwgbG9nLCBpc0VkaXRFbGVtZW50c0V4aXN0LCBpc1JldHJ5RWxlbWVudEV4aXN0LCB0ZW1wbGF0ZURvbSwgY29udGFpbmVyLCBmaWxlTGlzdCwgc2hvd1RodW1ibmFpbHMsIHNlcnZlclNjYWxlLCBjYWNoZVRodW1ibmFpbFBsYWNlaG9sZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5vdEF2YWlsYWJsZVVybCA9IG9wdGlvbnMucGxhY2Vob2xkZXJzLnRodW1ibmFpbE5vdEF2YWlsYWJsZSwgd2FpdGluZ1VybCA9IG9wdGlvbnMucGxhY2Vob2xkZXJzLndhaXRpbmdGb3JUaHVtYm5haWwsIHNwZWMgPSB7XG4gICAgICAgICAgICAgICAgbWF4U2l6ZTogdGh1bWJuYWlsTWF4U2l6ZSxcbiAgICAgICAgICAgICAgICBzY2FsZTogc2VydmVyU2NhbGVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoc2hvd1RodW1ibmFpbHMpIHtcbiAgICAgICAgICAgICAgICBpZiAobm90QXZhaWxhYmxlVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUobm90QXZhaWxhYmxlVXJsLCBuZXcgSW1hZ2UoKSwgc3BlYykudGhlbihmdW5jdGlvbih1cGRhdGVkSW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRUaHVtYm5haWxOb3RBdmFpbGFibGVJbWcuc3VjY2Vzcyh1cGRhdGVkSW1nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRUaHVtYm5haWxOb3RBdmFpbGFibGVJbWcuZmFpbHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUHJvYmxlbSBsb2FkaW5nICdub3QgYXZhaWxhYmxlJyBwbGFjZWhvbGRlciBpbWFnZSBhdCBcIiArIG5vdEF2YWlsYWJsZVVybCwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkVGh1bWJuYWlsTm90QXZhaWxhYmxlSW1nLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdhaXRpbmdVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pbWFnZUdlbmVyYXRvci5nZW5lcmF0ZSh3YWl0aW5nVXJsLCBuZXcgSW1hZ2UoKSwgc3BlYykudGhlbihmdW5jdGlvbih1cGRhdGVkSW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nLnN1Y2Nlc3ModXBkYXRlZEltZyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZy5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJQcm9ibGVtIGxvYWRpbmcgJ3dhaXRpbmcgZm9yIHRodW1ibmFpbCcgcGxhY2Vob2xkZXIgaW1hZ2UgYXQgXCIgKyB3YWl0aW5nVXJsLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGRpc3BsYXlXYWl0aW5nSW1nID0gZnVuY3Rpb24odGh1bWJuYWlsKSB7XG4gICAgICAgICAgICB2YXIgd2FpdGluZ0ltZ1BsYWNlbWVudCA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICBjYWNoZWRXYWl0aW5nRm9yVGh1bWJuYWlsSW1nLnRoZW4oZnVuY3Rpb24oaW1nKSB7XG4gICAgICAgICAgICAgICAgbWF5YmVTY2FsZVBsYWNlaG9sZGVyVmlhQ3NzKGltZywgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRodW1ibmFpbC5zcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsLnNyYyA9IGltZy5zcmM7XG4gICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5vbmxvYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ0ltZ1BsYWNlbWVudC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd2FpdGluZ0ltZ1BsYWNlbWVudC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaGlkZSh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIHdhaXRpbmdJbWdQbGFjZW1lbnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gd2FpdGluZ0ltZ1BsYWNlbWVudDtcbiAgICAgICAgfSwgZ2VuZXJhdGVOZXdQcmV2aWV3ID0gZnVuY3Rpb24oaWQsIGJsb2IsIHNwZWMpIHtcbiAgICAgICAgICAgIHZhciB0aHVtYm5haWwgPSBnZXRUaHVtYm5haWwoaWQpO1xuICAgICAgICAgICAgbG9nKFwiR2VuZXJhdGluZyBuZXcgdGh1bWJuYWlsIGZvciBcIiArIGlkKTtcbiAgICAgICAgICAgIGJsb2IucXFUaHVtYm5haWxJZCA9IGlkO1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuaW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUoYmxvYiwgdGh1bWJuYWlsLCBzcGVjKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlZFRodW1ibmFpbHMrKztcbiAgICAgICAgICAgICAgICBzaG93KHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25baWRdLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW2lkXS5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnBsYWNlaG9sZGVycy53YWl0VW50aWxVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKGlkLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGh1bWJHZW5lcmF0aW9uUXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsUXVldWVNb25pdG9yUnVubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdmFyIHF1ZXVlZFRodW1iUmVxdWVzdCA9IHRodW1iR2VuZXJhdGlvblF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlZFRodW1iUmVxdWVzdC51cGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1VwZGF0ZVF1ZXVlZFByZXZpZXdSZXF1ZXN0KHF1ZXVlZFRodW1iUmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc05ld1F1ZXVlZFByZXZpZXdSZXF1ZXN0KHF1ZXVlZFRodW1iUmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxRdWV1ZU1vbml0b3JSdW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGdldENhbmNlbCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmNhbmNlbCk7XG4gICAgICAgIH0sIGdldENvbnRpbnVlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuY29udGludWVCdXR0b24pO1xuICAgICAgICB9LCBnZXREaWFsb2cgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlc1t0eXBlICsgXCJEaWFsb2dcIl0pO1xuICAgICAgICB9LCBnZXREZWxldGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoZ2V0RmlsZShpZCksIHNlbGVjdG9yQ2xhc3Nlcy5kZWxldGVCdXR0b24pO1xuICAgICAgICB9LCBnZXREcm9wUHJvY2Vzc2luZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMuZHJvcFByb2Nlc3NpbmcpO1xuICAgICAgICB9LCBnZXRFZGl0SWNvbiA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLmVkaXROYW1lSWNvbik7XG4gICAgICAgIH0sIGdldEZpbGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZpbGVCYXRjaC5tYXBbaWRdIHx8IHFxKGZpbGVMaXN0KS5nZXRGaXJzdEJ5Q2xhc3MoRklMRV9DTEFTU19QUkVGSVggKyBpZCk7XG4gICAgICAgIH0sIGdldEZpbGVuYW1lID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuZmlsZSk7XG4gICAgICAgIH0sIGdldFBhdXNlID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMucGF1c2UpO1xuICAgICAgICB9LCBnZXRQcm9ncmVzcyA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLnRvdGFsUHJvZ3Jlc3NCYXJDb250YWluZXIpIHx8IGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMudG90YWxQcm9ncmVzc0Jhcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnByb2dyZXNzQmFyQ29udGFpbmVyKSB8fCBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMucHJvZ3Jlc3NCYXIpO1xuICAgICAgICB9LCBnZXRSZXRyeSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnJldHJ5KTtcbiAgICAgICAgfSwgZ2V0U2l6ZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnNpemUpO1xuICAgICAgICB9LCBnZXRTcGlubmVyID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuc3Bpbm5lcik7XG4gICAgICAgIH0sIGdldFRlbXBsYXRlRWwgPSBmdW5jdGlvbihjb250ZXh0LCBjc3NDbGFzcykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQgJiYgcXEoY29udGV4dCkuZ2V0Rmlyc3RCeUNsYXNzKGNzc0NsYXNzKTtcbiAgICAgICAgfSwgZ2V0VGh1bWJuYWlsID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBzaG93VGh1bWJuYWlscyAmJiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMudGh1bWJuYWlsKTtcbiAgICAgICAgfSwgaGlkZSA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICBlbCAmJiBxcShlbCkuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmhpZGUpO1xuICAgICAgICB9LCBtYXliZVNjYWxlUGxhY2Vob2xkZXJWaWFDc3MgPSBmdW5jdGlvbihwbGFjZWhvbGRlciwgdGh1bWJuYWlsKSB7XG4gICAgICAgICAgICB2YXIgbWF4V2lkdGggPSBwbGFjZWhvbGRlci5zdHlsZS5tYXhXaWR0aCwgbWF4SGVpZ2h0ID0gcGxhY2Vob2xkZXIuc3R5bGUubWF4SGVpZ2h0O1xuICAgICAgICAgICAgaWYgKG1heEhlaWdodCAmJiBtYXhXaWR0aCAmJiAhdGh1bWJuYWlsLnN0eWxlLm1heFdpZHRoICYmICF0aHVtYm5haWwuc3R5bGUubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcXEodGh1bWJuYWlsKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogbWF4V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogbWF4SGVpZ2h0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyA9IGZ1bmN0aW9uKGlkLCB0aHVtYm5haWwpIHtcbiAgICAgICAgICAgIHZhciBwcmV2aWV3aW5nID0gcHJldmlld0dlbmVyYXRpb25baWRdIHx8IG5ldyBxcS5Qcm9taXNlKCkuZmFpbHVyZSgpLCBub3RBdmFpbGFibGVJbWdQbGFjZW1lbnQgPSBuZXcgcXEuUHJvbWlzZSgpO1xuICAgICAgICAgICAgY2FjaGVkVGh1bWJuYWlsTm90QXZhaWxhYmxlSW1nLnRoZW4oZnVuY3Rpb24oaW1nKSB7XG4gICAgICAgICAgICAgICAgcHJldmlld2luZy50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBub3RBdmFpbGFibGVJbWdQbGFjZW1lbnQuc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBtYXliZVNjYWxlUGxhY2Vob2xkZXJWaWFDc3MoaW1nLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwub25sb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdEF2YWlsYWJsZUltZ1BsYWNlbWVudC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbC5zcmMgPSBpbWcuc3JjO1xuICAgICAgICAgICAgICAgICAgICBzaG93KHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBub3RBdmFpbGFibGVJbWdQbGFjZW1lbnQ7XG4gICAgICAgIH0sIHBhcnNlQW5kR2V0VGVtcGxhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzY3JpcHRFbCwgc2NyaXB0SHRtbCwgZmlsZUxpc3ROb2RlLCB0ZW1wVGVtcGxhdGVFbCwgZmlsZUxpc3RFbCwgZGVmYXVsdEJ1dHRvbiwgZHJvcEFyZWEsIHRodW1ibmFpbCwgZHJvcFByb2Nlc3NpbmcsIGRyb3BUZXh0RWwsIHVwbG9hZGVyRWw7XG4gICAgICAgICAgICBsb2coXCJQYXJzaW5nIHRlbXBsYXRlXCIpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMudGVtcGxhdGVJZE9yRWwgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBNVVNUIHNwZWNpZnkgZWl0aGVyIGEgdGVtcGxhdGUgZWxlbWVudCBvciBJRCFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocXEuaXNTdHJpbmcob3B0aW9ucy50ZW1wbGF0ZUlkT3JFbCkpIHtcbiAgICAgICAgICAgICAgICBzY3JpcHRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnMudGVtcGxhdGVJZE9yRWwpO1xuICAgICAgICAgICAgICAgIGlmIChzY3JpcHRFbCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocXEuZm9ybWF0KFwiQ2Fubm90IGZpbmQgdGVtcGxhdGUgc2NyaXB0IGF0IElEICd7fSchXCIsIG9wdGlvbnMudGVtcGxhdGVJZE9yRWwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2NyaXB0SHRtbCA9IHNjcmlwdEVsLmlubmVySFRNTDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMudGVtcGxhdGVJZE9yRWwuaW5uZXJIVE1MID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IGhhdmUgc3BlY2lmaWVkIGFuIGludmFsaWQgdmFsdWUgZm9yIHRoZSB0ZW1wbGF0ZSBvcHRpb24hICBcIiArIFwiSXQgbXVzdCBiZSBhbiBJRCBvciBhbiBFbGVtZW50LlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2NyaXB0SHRtbCA9IG9wdGlvbnMudGVtcGxhdGVJZE9yRWwuaW5uZXJIVE1MO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2NyaXB0SHRtbCA9IHFxLnRyaW1TdHIoc2NyaXB0SHRtbCk7XG4gICAgICAgICAgICB0ZW1wVGVtcGxhdGVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICB0ZW1wVGVtcGxhdGVFbC5hcHBlbmRDaGlsZChxcS50b0VsZW1lbnQoc2NyaXB0SHRtbCkpO1xuICAgICAgICAgICAgdXBsb2FkZXJFbCA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLnVwbG9hZGVyKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmJ1dHRvbikge1xuICAgICAgICAgICAgICAgIGRlZmF1bHRCdXR0b24gPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5idXR0b24pO1xuICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0QnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGRlZmF1bHRCdXR0b24pLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcXEuRHJhZ0FuZERyb3AgfHwgIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wKSB7XG4gICAgICAgICAgICAgICAgZHJvcFByb2Nlc3NpbmcgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0Rmlyc3RCeUNsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5kcm9wUHJvY2Vzc2luZyk7XG4gICAgICAgICAgICAgICAgaWYgKGRyb3BQcm9jZXNzaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHFxKGRyb3BQcm9jZXNzaW5nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkcm9wQXJlYSA9IHFxKHRlbXBUZW1wbGF0ZUVsKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmRyb3ApO1xuICAgICAgICAgICAgaWYgKGRyb3BBcmVhICYmICFxcS5EcmFnQW5kRHJvcCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIkRuRCBtb2R1bGUgdW5hdmFpbGFibGUuXCIsIFwiaW5mb1wiKTtcbiAgICAgICAgICAgICAgICBxcShkcm9wQXJlYSkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXFxLnN1cHBvcnRlZEZlYXR1cmVzLmZpbGVEcm9wKSB7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXJFbC5yZW1vdmVBdHRyaWJ1dGUoRFJPUFpQT05FX1RFWFRfQVRUUik7XG4gICAgICAgICAgICAgICAgaWYgKGRyb3BBcmVhICYmIHFxKGRyb3BBcmVhKS5oYXNBdHRyaWJ1dGUoSElERV9EUk9QWk9ORV9BVFRSKSkge1xuICAgICAgICAgICAgICAgICAgICBxcShkcm9wQXJlYSkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocXEodXBsb2FkZXJFbCkuaGFzQXR0cmlidXRlKERST1BaUE9ORV9URVhUX0FUVFIpICYmIGRyb3BBcmVhKSB7XG4gICAgICAgICAgICAgICAgZHJvcFRleHRFbCA9IHFxKGRyb3BBcmVhKS5nZXRGaXJzdEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLmRyb3BUZXh0KTtcbiAgICAgICAgICAgICAgICBkcm9wVGV4dEVsICYmIHFxKGRyb3BUZXh0RWwpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGh1bWJuYWlsID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMudGh1bWJuYWlsKTtcbiAgICAgICAgICAgIGlmICghc2hvd1RodW1ibmFpbHMpIHtcbiAgICAgICAgICAgICAgICB0aHVtYm5haWwgJiYgcXEodGh1bWJuYWlsKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGh1bWJuYWlsKSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsTWF4U2l6ZSA9IHBhcnNlSW50KHRodW1ibmFpbC5nZXRBdHRyaWJ1dGUoVEhVTUJOQUlMX01BWF9TSVpFX0FUVFIpKTtcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxNYXhTaXplID0gdGh1bWJuYWlsTWF4U2l6ZSA+IDAgPyB0aHVtYm5haWxNYXhTaXplIDogbnVsbDtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJTY2FsZSA9IHFxKHRodW1ibmFpbCkuaGFzQXR0cmlidXRlKFRIVU1CTkFJTF9TRVJWRVJfU0NBTEVfQVRUUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzaG93VGh1bWJuYWlscyA9IHNob3dUaHVtYm5haWxzICYmIHRodW1ibmFpbDtcbiAgICAgICAgICAgIGlzRWRpdEVsZW1lbnRzRXhpc3QgPSBxcSh0ZW1wVGVtcGxhdGVFbCkuZ2V0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMuZWRpdEZpbGVuYW1lSW5wdXQpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBpc1JldHJ5RWxlbWVudEV4aXN0ID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEJ5Q2xhc3Moc2VsZWN0b3JDbGFzc2VzLnJldHJ5KS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgZmlsZUxpc3ROb2RlID0gcXEodGVtcFRlbXBsYXRlRWwpLmdldEZpcnN0QnlDbGFzcyhzZWxlY3RvckNsYXNzZXMubGlzdCk7XG4gICAgICAgICAgICBpZiAoZmlsZUxpc3ROb2RlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCB0aGUgZmlsZSBsaXN0IGNvbnRhaW5lciBpbiB0aGUgdGVtcGxhdGUhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlsZUxpc3RFbCA9IGZpbGVMaXN0Tm9kZS5jaGlsZHJlblswXS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICBmaWxlTGlzdE5vZGUuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgIGlmICh0ZW1wVGVtcGxhdGVFbC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIkRJQUxPR1wiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGlhbG9nXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nKFwiVGVtcGxhdGUgcGFyc2luZyBjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IHRlbXBUZW1wbGF0ZUVsLFxuICAgICAgICAgICAgICAgIGZpbGVUZW1wbGF0ZTogZmlsZUxpc3RFbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSwgcHJlcGVuZEZpbGUgPSBmdW5jdGlvbihlbCwgaW5kZXgsIGZpbGVMaXN0KSB7XG4gICAgICAgICAgICB2YXIgcGFyZW50RWwgPSBmaWxlTGlzdCwgYmVmb3JlRWwgPSBwYXJlbnRFbC5maXJzdENoaWxkO1xuICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgIGJlZm9yZUVsID0gcXEocGFyZW50RWwpLmNoaWxkcmVuKClbaW5kZXhdLm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyZW50RWwuaW5zZXJ0QmVmb3JlKGVsLCBiZWZvcmVFbCk7XG4gICAgICAgIH0sIHByb2Nlc3NOZXdRdWV1ZWRQcmV2aWV3UmVxdWVzdCA9IGZ1bmN0aW9uKHF1ZXVlZFRodW1iUmVxdWVzdCkge1xuICAgICAgICAgICAgdmFyIGlkID0gcXVldWVkVGh1bWJSZXF1ZXN0LmlkLCBvcHRGaWxlT3JCbG9iID0gcXVldWVkVGh1bWJSZXF1ZXN0Lm9wdEZpbGVPckJsb2IsIHJlbGF0ZWRUaHVtYm5haWxJZCA9IG9wdEZpbGVPckJsb2IgJiYgb3B0RmlsZU9yQmxvYi5xcVRodW1ibmFpbElkLCB0aHVtYm5haWwgPSBnZXRUaHVtYm5haWwoaWQpLCBzcGVjID0ge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBxdWV1ZWRUaHVtYlJlcXVlc3QuY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgbWF4U2l6ZTogdGh1bWJuYWlsTWF4U2l6ZSxcbiAgICAgICAgICAgICAgICBvcmllbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2NhbGU6IHRydWVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAocXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cykge1xuICAgICAgICAgICAgICAgIGlmICh0aHVtYm5haWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubGltaXRzLm1heFRodW1icyAmJiBvcHRpb25zLmxpbWl0cy5tYXhUaHVtYnMgPD0gZ2VuZXJhdGVkVGh1bWJuYWlscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKGlkLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVdhaXRpbmdJbWcodGh1bWJuYWlsKS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpZXdHZW5lcmF0aW9uW2lkXSA9IG5ldyBxcS5Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25baWRdLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZ2VuZXJhdGVOZXh0UXVldWVkUHJldmlldywgb3B0aW9ucy5saW1pdHMudGltZUJldHdlZW5UaHVtYnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxhdGVkVGh1bWJuYWlsSWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VDYWNoZWRQcmV2aWV3KGlkLCByZWxhdGVkVGh1bWJuYWlsSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV3UHJldmlldyhpZCwgb3B0RmlsZU9yQmxvYiwgc3BlYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aHVtYm5haWwpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5V2FpdGluZ0ltZyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgcHJvY2Vzc1VwZGF0ZVF1ZXVlZFByZXZpZXdSZXF1ZXN0ID0gZnVuY3Rpb24ocXVldWVkVGh1bWJSZXF1ZXN0KSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBxdWV1ZWRUaHVtYlJlcXVlc3QuaWQsIHRodW1ibmFpbFVybCA9IHF1ZXVlZFRodW1iUmVxdWVzdC50aHVtYm5haWxVcmwsIHNob3dXYWl0aW5nSW1nID0gcXVldWVkVGh1bWJSZXF1ZXN0LnNob3dXYWl0aW5nSW1nLCB0aHVtYm5haWwgPSBnZXRUaHVtYm5haWwoaWQpLCBzcGVjID0ge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBxdWV1ZWRUaHVtYlJlcXVlc3QuY3VzdG9tUmVzaXplRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAgc2NhbGU6IHNlcnZlclNjYWxlLFxuICAgICAgICAgICAgICAgIG1heFNpemU6IHRodW1ibmFpbE1heFNpemVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodGh1bWJuYWlsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRodW1ibmFpbFVybCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5saW1pdHMubWF4VGh1bWJzICYmIG9wdGlvbnMubGltaXRzLm1heFRodW1icyA8PSBnZW5lcmF0ZWRUaHVtYm5haWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcoaWQsIHRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd1dhaXRpbmdJbWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5V2FpdGluZ0ltZyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuaW1hZ2VHZW5lcmF0b3IuZ2VuZXJhdGUodGh1bWJuYWlsVXJsLCB0aHVtYm5haWwsIHNwZWMpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdyh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlZFRodW1ibmFpbHMrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcsIG9wdGlvbnMubGltaXRzLnRpbWVCZXR3ZWVuVGh1bWJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heWJlU2V0RGlzcGxheU5vdEF2YWlsYWJsZUltZyhpZCwgdGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcsIG9wdGlvbnMubGltaXRzLnRpbWVCZXR3ZWVuVGh1bWJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbWF5YmVTZXREaXNwbGF5Tm90QXZhaWxhYmxlSW1nKGlkLCB0aHVtYm5haWwpO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBzZXRQcm9ncmVzc0JhcldpZHRoID0gZnVuY3Rpb24oaWQsIHBlcmNlbnQpIHtcbiAgICAgICAgICAgIHZhciBiYXIgPSBnZXRQcm9ncmVzcyhpZCksIHByb2dyZXNzQmFyU2VsZWN0b3IgPSBpZCA9PSBudWxsID8gc2VsZWN0b3JDbGFzc2VzLnRvdGFsUHJvZ3Jlc3NCYXIgOiBzZWxlY3RvckNsYXNzZXMucHJvZ3Jlc3NCYXI7XG4gICAgICAgICAgICBpZiAoYmFyICYmICFxcShiYXIpLmhhc0NsYXNzKHByb2dyZXNzQmFyU2VsZWN0b3IpKSB7XG4gICAgICAgICAgICAgICAgYmFyID0gcXEoYmFyKS5nZXRGaXJzdEJ5Q2xhc3MocHJvZ3Jlc3NCYXJTZWxlY3Rvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYmFyKSB7XG4gICAgICAgICAgICAgICAgcXEoYmFyKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogcGVyY2VudCArIFwiJVwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYmFyLnNldEF0dHJpYnV0ZShcImFyaWEtdmFsdWVub3dcIiwgcGVyY2VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHNob3cgPSBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgZWwgJiYgcXEoZWwpLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5oaWRlKTtcbiAgICAgICAgfSwgdXNlQ2FjaGVkUHJldmlldyA9IGZ1bmN0aW9uKHRhcmdldFRodW1ibmFpbElkLCBjYWNoZWRUaHVtYm5haWxJZCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldFRodW1ibmFpbCA9IGdldFRodW1ibmFpbCh0YXJnZXRUaHVtYm5haWxJZCksIGNhY2hlZFRodW1ibmFpbCA9IGdldFRodW1ibmFpbChjYWNoZWRUaHVtYm5haWxJZCk7XG4gICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiSUQge30gaXMgdGhlIHNhbWUgZmlsZSBhcyBJRCB7fS4gIFdpbGwgdXNlIGdlbmVyYXRlZCB0aHVtYm5haWwgZnJvbSBJRCB7fSBpbnN0ZWFkLlwiLCB0YXJnZXRUaHVtYm5haWxJZCwgY2FjaGVkVGh1bWJuYWlsSWQsIGNhY2hlZFRodW1ibmFpbElkKSk7XG4gICAgICAgICAgICBwcmV2aWV3R2VuZXJhdGlvbltjYWNoZWRUaHVtYm5haWxJZF0udGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRUaHVtYm5haWxzKys7XG4gICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25bdGFyZ2V0VGh1bWJuYWlsSWRdLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICBsb2cocXEuZm9ybWF0KFwiTm93IHVzaW5nIHByZXZpb3VzbHkgZ2VuZXJhdGVkIHRodW1ibmFpbCBjcmVhdGVkIGZvciBJRCB7fSBvbiBJRCB7fS5cIiwgY2FjaGVkVGh1bWJuYWlsSWQsIHRhcmdldFRodW1ibmFpbElkKSk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0VGh1bWJuYWlsLnNyYyA9IGNhY2hlZFRodW1ibmFpbC5zcmM7XG4gICAgICAgICAgICAgICAgc2hvdyh0YXJnZXRUaHVtYm5haWwpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcHJldmlld0dlbmVyYXRpb25bdGFyZ2V0VGh1bWJuYWlsSWRdLmZhaWx1cmUoKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMucGxhY2Vob2xkZXJzLndhaXRVbnRpbFVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBtYXliZVNldERpc3BsYXlOb3RBdmFpbGFibGVJbWcodGFyZ2V0VGh1bWJuYWlsSWQsIHRhcmdldFRodW1ibmFpbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHFxLmV4dGVuZChvcHRpb25zLCBzcGVjKTtcbiAgICAgICAgbG9nID0gb3B0aW9ucy5sb2c7XG4gICAgICAgIGlmICghcXEuc3VwcG9ydGVkRmVhdHVyZXMuaW1hZ2VQcmV2aWV3cykge1xuICAgICAgICAgICAgb3B0aW9ucy5saW1pdHMudGltZUJldHdlZW5UaHVtYnMgPSAwO1xuICAgICAgICAgICAgb3B0aW9ucy5saW1pdHMubWF4VGh1bWJzID0gMDtcbiAgICAgICAgfVxuICAgICAgICBjb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lckVsO1xuICAgICAgICBzaG93VGh1bWJuYWlscyA9IG9wdGlvbnMuaW1hZ2VHZW5lcmF0b3IgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgdGVtcGxhdGVEb20gPSBwYXJzZUFuZEdldFRlbXBsYXRlKCk7XG4gICAgICAgIGNhY2hlVGh1bWJuYWlsUGxhY2Vob2xkZXJzKCk7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCB7XG4gICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIlJlbmRlcmluZyB0ZW1wbGF0ZSBpbiBET00uXCIpO1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlZFRodW1ibmFpbHMgPSAwO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZW1wbGF0ZURvbS50ZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0RHJvcFByb2Nlc3NpbmcoKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlVG90YWxQcm9ncmVzcygpO1xuICAgICAgICAgICAgICAgIGZpbGVMaXN0ID0gb3B0aW9ucy5maWxlQ29udGFpbmVyRWwgfHwgZ2V0VGVtcGxhdGVFbChjb250YWluZXIsIHNlbGVjdG9yQ2xhc3Nlcy5saXN0KTtcbiAgICAgICAgICAgICAgICBsb2coXCJUZW1wbGF0ZSByZW5kZXJpbmcgY29tcGxldGVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVuZGVyRmFpbHVyZTogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHZhciBjYW50UmVuZGVyRWwgPSBxcS50b0VsZW1lbnQobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNhbnRSZW5kZXJFbCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXJGaWxlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZmlsZUxpc3QuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNhYmxlQ2FuY2VsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpc0NhbmNlbERpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRGaWxlOiBmdW5jdGlvbihpZCwgbmFtZSwgcHJlcGVuZEluZm8sIGhpZGVGb3JldmVyLCBiYXRjaCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlRWwgPSB0ZW1wbGF0ZURvbS5maWxlVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpLCBmaWxlTmFtZUVsID0gZ2V0VGVtcGxhdGVFbChmaWxlRWwsIHNlbGVjdG9yQ2xhc3Nlcy5maWxlKSwgdXBsb2FkZXJFbCA9IGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMudXBsb2FkZXIpLCBmaWxlQ29udGFpbmVyID0gYmF0Y2ggPyBmaWxlQmF0Y2guY29udGVudCA6IGZpbGVMaXN0LCB0aHVtYjtcbiAgICAgICAgICAgICAgICBpZiAoYmF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUJhdGNoLm1hcFtpZF0gPSBmaWxlRWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHFxKGZpbGVFbCkuYWRkQ2xhc3MoRklMRV9DTEFTU19QUkVGSVggKyBpZCk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXJFbC5yZW1vdmVBdHRyaWJ1dGUoRFJPUFpQT05FX1RFWFRfQVRUUik7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcXEoZmlsZU5hbWVFbCkuc2V0VGV4dChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWVFbC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsZUVsLnNldEF0dHJpYnV0ZShGSUxFX0lEX0FUVFIsIGlkKTtcbiAgICAgICAgICAgICAgICBpZiAocHJlcGVuZEluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlcGVuZEZpbGUoZmlsZUVsLCBwcmVwZW5kSW5mby5pbmRleCwgZmlsZUNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmaWxlRWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaGlkZUZvcmV2ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgcXEoZmlsZUVsKS5hZGRDbGFzcyhISURERU5fRk9SRVZFUl9DTEFTUyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXRQcm9ncmVzcyhpZCkpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldFNpemUoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXREZWxldGUoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaGlkZShnZXRSZXRyeShpZCkpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlKGdldFBhdXNlKGlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoZ2V0Q29udGludWUoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2FuY2VsRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUNhbmNlbChpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBnZXRUaHVtYm5haWwoaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGh1bWIgJiYgIXRodW1iLnNyYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkV2FpdGluZ0ZvclRodW1ibmFpbEltZy50aGVuKGZ1bmN0aW9uKHdhaXRpbmdJbWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYi5zcmMgPSB3YWl0aW5nSW1nLnNyYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2FpdGluZ0ltZy5zdHlsZS5tYXhIZWlnaHQgJiYgd2FpdGluZ0ltZy5zdHlsZS5tYXhXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxcSh0aHVtYikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogd2FpdGluZ0ltZy5zdHlsZS5tYXhIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogd2FpdGluZ0ltZy5zdHlsZS5tYXhXaWR0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdyh0aHVtYik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRGaWxlVG9DYWNoZTogZnVuY3Rpb24oaWQsIG5hbWUsIHByZXBlbmRJbmZvLCBoaWRlRm9yZXZlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZShpZCwgbmFtZSwgcHJlcGVuZEluZm8sIGhpZGVGb3JldmVyLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRDYWNoZVRvRG9tOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmaWxlTGlzdC5hcHBlbmRDaGlsZChmaWxlQmF0Y2guY29udGVudCk7XG4gICAgICAgICAgICAgICAgZmlsZUJhdGNoLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgICAgICAgICAgZmlsZUJhdGNoLm1hcCA9IHt9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZUZpbGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcXEoZ2V0RmlsZShpZCkpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZpbGVJZDogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE5vZGUgPSBlbDtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnROb2RlLmdldEF0dHJpYnV0ZShGSUxFX0lEX0FUVFIpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gY3VycmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoY3VycmVudE5vZGUuZ2V0QXR0cmlidXRlKEZJTEVfSURfQVRUUikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGaWxlTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVMaXN0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1hcmtGaWxlbmFtZUVkaXRhYmxlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IGdldEZpbGVuYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBmaWxlbmFtZSAmJiBxcShmaWxlbmFtZSkuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmVkaXRhYmxlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVGaWxlbmFtZTogZnVuY3Rpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWVFbCA9IGdldEZpbGVuYW1lKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZW5hbWVFbCkge1xuICAgICAgICAgICAgICAgICAgICBxcShmaWxlbmFtZUVsKS5zZXRUZXh0KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZUVsLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlRmlsZW5hbWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRGaWxlbmFtZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dGaWxlbmFtZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldEZpbGVuYW1lKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNGaWxlTmFtZTogZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXEoZWwpLmhhc0NsYXNzKHNlbGVjdG9yQ2xhc3Nlcy5maWxlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRCdXR0b246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmJ1dHRvbiB8fCBnZXRUZW1wbGF0ZUVsKGNvbnRhaW5lciwgc2VsZWN0b3JDbGFzc2VzLmJ1dHRvbik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZURyb3BQcm9jZXNzaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGdldERyb3BQcm9jZXNzaW5nKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dEcm9wUHJvY2Vzc2luZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXREcm9wUHJvY2Vzc2luZygpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREcm9wWm9uZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFRlbXBsYXRlRWwoY29udGFpbmVyLCBzZWxlY3RvckNsYXNzZXMuZHJvcCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNFZGl0RmlsZW5hbWVQb3NzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRWRpdEVsZW1lbnRzRXhpc3Q7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZVJldHJ5OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0UmV0cnkoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1JldHJ5UG9zc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpc1JldHJ5RWxlbWVudEV4aXN0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dSZXRyeTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBzaG93KGdldFJldHJ5KGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmlsZUNvbnRhaW5lcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RmlsZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd0VkaXRJY29uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gZ2V0RWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgIGljb24gJiYgcXEoaWNvbikuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmVkaXRhYmxlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0hpZGRlbkZvcmV2ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGdldEZpbGUoaWQpKS5oYXNDbGFzcyhISURERU5fRk9SRVZFUl9DTEFTUyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZUVkaXRJY29uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gZ2V0RWRpdEljb24oaWQpO1xuICAgICAgICAgICAgICAgIGljb24gJiYgcXEoaWNvbikucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmVkaXRhYmxlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0VkaXRJY29uOiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmVkaXROYW1lSWNvbiwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RWRpdElucHV0OiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRUZW1wbGF0ZUVsKGdldEZpbGUoaWQpLCBzZWxlY3RvckNsYXNzZXMuZWRpdEZpbGVuYW1lSW5wdXQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzRWRpdElucHV0OiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLmVkaXRGaWxlbmFtZUlucHV0LCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24oaWQsIGxvYWRlZCwgdG90YWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmFyID0gZ2V0UHJvZ3Jlc3MoaWQpLCBwZXJjZW50O1xuICAgICAgICAgICAgICAgIGlmIChiYXIgJiYgdG90YWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHBlcmNlbnQgPSBNYXRoLnJvdW5kKGxvYWRlZCAvIHRvdGFsICogMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlcmNlbnQgPT09IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZShiYXIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdyhiYXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNldFByb2dyZXNzQmFyV2lkdGgoaWQsIHBlcmNlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVUb3RhbFByb2dyZXNzOiBmdW5jdGlvbihsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcyhudWxsLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlUHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJhciA9IGdldFByb2dyZXNzKGlkKTtcbiAgICAgICAgICAgICAgICBiYXIgJiYgaGlkZShiYXIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhpZGVUb3RhbFByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVQcm9ncmVzcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0UHJvZ3Jlc3M6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2V0UHJvZ3Jlc3NCYXJXaWR0aChpZCwgMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlVG90YWxQcm9ncmVzcyhpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXRUb3RhbFByb2dyZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0UHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG93Q2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGlmICghaXNDYW5jZWxEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2FuY2VsID0gZ2V0Q2FuY2VsKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsICYmIHFxKGNhbmNlbCkucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmhpZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlQ2FuY2VsOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0Q2FuY2VsKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNDYW5jZWw6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuY2FuY2VsLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhbGxvd1BhdXNlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNob3coZ2V0UGF1c2UoaWQpKTtcbiAgICAgICAgICAgICAgICBoaWRlKGdldENvbnRpbnVlKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkUGF1c2VkOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzVGV4dChpZCwgb3B0aW9ucy50ZXh0LnBhdXNlZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxvd0NvbnRpbnVlQnV0dG9uKGlkKTtcbiAgICAgICAgICAgICAgICBoaWRlKGdldFNwaW5uZXIoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlUGF1c2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgaGlkZShnZXRQYXVzZShpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzUGF1c2U6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMucGF1c2UsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzQ29udGludWVCdXR0b246IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuY29udGludWVCdXR0b24sIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFsbG93Q29udGludWVCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRDb250aW51ZShpZCkpO1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0UGF1c2UoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGxvYWRDb250aW51ZWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXNUZXh0KGlkLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93UGF1c2UoaWQpO1xuICAgICAgICAgICAgICAgIHNob3coZ2V0U3Bpbm5lcihpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dEZWxldGVCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXREZWxldGUoaWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlRGVsZXRlQnV0dG9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0RGVsZXRlKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNEZWxldGVCdXR0b246IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHFxKGVsKS5oYXNDbGFzcyhzZWxlY3RvckNsYXNzZXMuZGVsZXRlQnV0dG9uLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1JldHJ5OiBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcShlbCkuaGFzQ2xhc3Moc2VsZWN0b3JDbGFzc2VzLnJldHJ5LCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVTaXplOiBmdW5jdGlvbihpZCwgdGV4dCkge1xuICAgICAgICAgICAgICAgIHZhciBzaXplID0gZ2V0U2l6ZShpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2hvdyhzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgcXEoc2l6ZSkuc2V0VGV4dCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0U3RhdHVzVGV4dDogZnVuY3Rpb24oaWQsIHRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dEVsID0gZ2V0VGVtcGxhdGVFbChnZXRGaWxlKGlkKSwgc2VsZWN0b3JDbGFzc2VzLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgIGlmICh0ZXh0RWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXEodGV4dEVsKS5jbGVhclRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHFxKHRleHRFbCkuc2V0VGV4dCh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaWRlU3Bpbm5lcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICBxcShnZXRGaWxlKGlkKSkucmVtb3ZlQ2xhc3MoSU5fUFJPR1JFU1NfQ0xBU1MpO1xuICAgICAgICAgICAgICAgIGhpZGUoZ2V0U3Bpbm5lcihpZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dTcGlubmVyOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHFxKGdldEZpbGUoaWQpKS5hZGRDbGFzcyhJTl9QUk9HUkVTU19DTEFTUyk7XG4gICAgICAgICAgICAgICAgc2hvdyhnZXRTcGlubmVyKGlkKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2VuZXJhdGVQcmV2aWV3OiBmdW5jdGlvbihpZCwgb3B0RmlsZU9yQmxvYiwgY3VzdG9tUmVzaXplRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNIaWRkZW5Gb3JldmVyKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHVtYkdlbmVyYXRpb25RdWV1ZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBjdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdEZpbGVPckJsb2I6IG9wdEZpbGVPckJsb2JcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICF0aHVtYm5haWxRdWV1ZU1vbml0b3JSdW5uaW5nICYmIGdlbmVyYXRlTmV4dFF1ZXVlZFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlVGh1bWJuYWlsOiBmdW5jdGlvbihpZCwgdGh1bWJuYWlsVXJsLCBzaG93V2FpdGluZ0ltZywgY3VzdG9tUmVzaXplRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNIaWRkZW5Gb3JldmVyKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHVtYkdlbmVyYXRpb25RdWV1ZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVJlc2l6ZUZ1bmN0aW9uOiBjdXN0b21SZXNpemVGdW5jdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbFVybDogdGh1bWJuYWlsVXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1dhaXRpbmdJbWc6IHNob3dXYWl0aW5nSW1nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAhdGh1bWJuYWlsUXVldWVNb25pdG9yUnVubmluZyAmJiBnZW5lcmF0ZU5leHRRdWV1ZWRQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc0RpYWxvZzogZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxcS5zdXBwb3J0ZWRGZWF0dXJlcy5kaWFsb2dFbGVtZW50ICYmICEhZ2V0RGlhbG9nKHR5cGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3dEaWFsb2c6IGZ1bmN0aW9uKHR5cGUsIG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBkaWFsb2cgPSBnZXREaWFsb2codHlwZSksIG1lc3NhZ2VFbCA9IGdldFRlbXBsYXRlRWwoZGlhbG9nLCBzZWxlY3RvckNsYXNzZXMuZGlhbG9nTWVzc2FnZSksIGlucHV0RWwgPSBkaWFsb2cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJJTlBVVFwiKVswXSwgY2FuY2VsQnRuID0gZ2V0VGVtcGxhdGVFbChkaWFsb2csIHNlbGVjdG9yQ2xhc3Nlcy5kaWFsb2dDYW5jZWxCdXR0b24pLCBva0J0biA9IGdldFRlbXBsYXRlRWwoZGlhbG9nLCBzZWxlY3RvckNsYXNzZXMuZGlhbG9nT2tCdXR0b24pLCBwcm9taXNlID0gbmV3IHFxLlByb21pc2UoKSwgY2xvc2VIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FuY2VsQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgb2tCdG4gJiYgb2tCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG9rQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsdXJlKCk7XG4gICAgICAgICAgICAgICAgfSwgY2FuY2VsQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FuY2VsQ2xpY2tIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSwgb2tDbGlja0hhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbG9zZVwiLCBjbG9zZUhhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBva0J0bi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb2tDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzKGlucHV0RWwgJiYgaW5wdXRFbC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcihcImNsb3NlXCIsIGNsb3NlSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjYW5jZWxDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG9rQnRuICYmIG9rQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBva0NsaWNrSGFuZGxlcik7XG4gICAgICAgICAgICAgICAgaWYgKGlucHV0RWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRFbC52YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWVzc2FnZUVsLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcXEuVWlFdmVudEhhbmRsZXIgPSBmdW5jdGlvbihzLCBwcm90ZWN0ZWRBcGkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkaXNwb3NlciA9IG5ldyBxcS5EaXNwb3NlU3VwcG9ydCgpLCBzcGVjID0ge1xuICAgICAgICAgICAgZXZlbnRUeXBlOiBcImNsaWNrXCIsXG4gICAgICAgICAgICBhdHRhY2hUbzogbnVsbCxcbiAgICAgICAgICAgIG9uSGFuZGxlZDogZnVuY3Rpb24odGFyZ2V0LCBldmVudCkge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIHtcbiAgICAgICAgICAgIGFkZEhhbmRsZXI6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBhZGRIYW5kbGVyKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRpc3Bvc2VyLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGFkZEhhbmRsZXIoZWxlbWVudCkge1xuICAgICAgICAgICAgZGlzcG9zZXIuYXR0YWNoKGVsZW1lbnQsIHNwZWMuZXZlbnRUeXBlLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudDtcbiAgICAgICAgICAgICAgICBzcGVjLm9uSGFuZGxlZCh0YXJnZXQsIGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHFxLmV4dGVuZChwcm90ZWN0ZWRBcGksIHtcbiAgICAgICAgICAgIGdldEZpbGVJZEZyb21JdGVtOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucXFGaWxlSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RGlzcG9zZVN1cHBvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkaXNwb3NlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHFxLmV4dGVuZChzcGVjLCBzKTtcbiAgICAgICAgaWYgKHNwZWMuYXR0YWNoVG8pIHtcbiAgICAgICAgICAgIGFkZEhhbmRsZXIoc3BlYy5hdHRhY2hUbyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHFxLkZpbGVCdXR0b25zQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24ocykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGluaGVyaXRlZEludGVybmFsQXBpID0ge30sIHNwZWMgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0aW5nOiBudWxsLFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHt9LFxuICAgICAgICAgICAgb25EZWxldGVGaWxlOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvblJldHJ5OiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25QYXVzZTogZnVuY3Rpb24oZmlsZUlkKSB7fSxcbiAgICAgICAgICAgIG9uQ29udGludWU6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvbkdldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge31cbiAgICAgICAgfSwgYnV0dG9uSGFuZGxlcnMgPSB7XG4gICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkNhbmNlbChpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cnk6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc3BlYy5vblJldHJ5KGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWxldGVCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkRlbGV0ZUZpbGUoaWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgIHNwZWMub25QYXVzZShpZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGludWVCdXR0b246IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgc3BlYy5vbkNvbnRpbnVlKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZnVuY3Rpb24gZXhhbWluZUV2ZW50KHRhcmdldCwgZXZlbnQpIHtcbiAgICAgICAgICAgIHFxLmVhY2goYnV0dG9uSGFuZGxlcnMsIGZ1bmN0aW9uKGJ1dHRvblR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlyc3RMZXR0ZXJDYXBCdXR0b25UeXBlID0gYnV0dG9uVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGJ1dHRvblR5cGUuc2xpY2UoMSksIGZpbGVJZDtcbiAgICAgICAgICAgICAgICBpZiAoc3BlYy50ZW1wbGF0aW5nW1wiaXNcIiArIGZpcnN0TGV0dGVyQ2FwQnV0dG9uVHlwZV0odGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlSWQgPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RmlsZUlkKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIHFxLnByZXZlbnREZWZhdWx0KGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgc3BlYy5sb2cocXEuZm9ybWF0KFwiRGV0ZWN0ZWQgdmFsaWQgZmlsZSBidXR0b24gY2xpY2sgZXZlbnQgb24gZmlsZSAne30nLCBJRDoge30uXCIsIHNwZWMub25HZXROYW1lKGZpbGVJZCksIGZpbGVJZCkpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQoc3BlYywgcyk7XG4gICAgICAgIHNwZWMuZXZlbnRUeXBlID0gXCJjbGlja1wiO1xuICAgICAgICBzcGVjLm9uSGFuZGxlZCA9IGV4YW1pbmVFdmVudDtcbiAgICAgICAgc3BlYy5hdHRhY2hUbyA9IHNwZWMudGVtcGxhdGluZy5nZXRGaWxlTGlzdCgpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLlVpRXZlbnRIYW5kbGVyKHNwZWMsIGluaGVyaXRlZEludGVybmFsQXBpKSk7XG4gICAgfTtcbiAgICBxcS5GaWxlbmFtZUNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBpbmhlcml0ZWRJbnRlcm5hbEFwaSA9IHt9LCBzcGVjID0ge1xuICAgICAgICAgICAgdGVtcGxhdGluZzogbnVsbCxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7fSxcbiAgICAgICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgICAgICBmaWxlOiBcInFxLXVwbG9hZC1maWxlXCIsXG4gICAgICAgICAgICAgICAgZWRpdE5hbWVJY29uOiBcInFxLWVkaXQtZmlsZW5hbWUtaWNvblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25HZXRVcGxvYWRTdGF0dXM6IGZ1bmN0aW9uKGZpbGVJZCkge30sXG4gICAgICAgICAgICBvbkdldE5hbWU6IGZ1bmN0aW9uKGZpbGVJZCkge31cbiAgICAgICAgfTtcbiAgICAgICAgcXEuZXh0ZW5kKHNwZWMsIHMpO1xuICAgICAgICBmdW5jdGlvbiBleGFtaW5lRXZlbnQodGFyZ2V0LCBldmVudCkge1xuICAgICAgICAgICAgaWYgKHNwZWMudGVtcGxhdGluZy5pc0ZpbGVOYW1lKHRhcmdldCkgfHwgc3BlYy50ZW1wbGF0aW5nLmlzRWRpdEljb24odGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlSWQgPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RmlsZUlkKHRhcmdldCksIHN0YXR1cyA9IHNwZWMub25HZXRVcGxvYWRTdGF0dXMoZmlsZUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBxcS5zdGF0dXMuU1VCTUlUVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwZWMubG9nKHFxLmZvcm1hdChcIkRldGVjdGVkIHZhbGlkIGZpbGVuYW1lIGNsaWNrIGV2ZW50IG9uIGZpbGUgJ3t9JywgSUQ6IHt9LlwiLCBzcGVjLm9uR2V0TmFtZShmaWxlSWQpLCBmaWxlSWQpKTtcbiAgICAgICAgICAgICAgICAgICAgcXEucHJldmVudERlZmF1bHQoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBpbmhlcml0ZWRJbnRlcm5hbEFwaS5oYW5kbGVGaWxlbmFtZUVkaXQoZmlsZUlkLCB0YXJnZXQsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzcGVjLmV2ZW50VHlwZSA9IFwiY2xpY2tcIjtcbiAgICAgICAgc3BlYy5vbkhhbmRsZWQgPSBleGFtaW5lRXZlbnQ7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuRmlsZW5hbWVFZGl0SGFuZGxlcihzcGVjLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkpO1xuICAgIH07XG4gICAgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSW5IYW5kbGVyID0gZnVuY3Rpb24ocywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzcGVjID0ge1xuICAgICAgICAgICAgdGVtcGxhdGluZzogbnVsbCxcbiAgICAgICAgICAgIG9uR2V0VXBsb2FkU3RhdHVzOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlLCBsdmwpIHt9XG4gICAgICAgIH07XG4gICAgICAgIGlmICghaW5oZXJpdGVkSW50ZXJuYWxBcGkpIHtcbiAgICAgICAgICAgIGluaGVyaXRlZEludGVybmFsQXBpID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlSW5wdXRGb2N1cyh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoc3BlYy50ZW1wbGF0aW5nLmlzRWRpdElucHV0KHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZUlkID0gc3BlYy50ZW1wbGF0aW5nLmdldEZpbGVJZCh0YXJnZXQpLCBzdGF0dXMgPSBzcGVjLm9uR2V0VXBsb2FkU3RhdHVzKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gcXEuc3RhdHVzLlNVQk1JVFRFRCkge1xuICAgICAgICAgICAgICAgICAgICBzcGVjLmxvZyhxcS5mb3JtYXQoXCJEZXRlY3RlZCB2YWxpZCBmaWxlbmFtZSBpbnB1dCBmb2N1cyBldmVudCBvbiBmaWxlICd7fScsIElEOiB7fS5cIiwgc3BlYy5vbkdldE5hbWUoZmlsZUlkKSwgZmlsZUlkKSk7XG4gICAgICAgICAgICAgICAgICAgIGluaGVyaXRlZEludGVybmFsQXBpLmhhbmRsZUZpbGVuYW1lRWRpdChmaWxlSWQsIHRhcmdldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNwZWMuZXZlbnRUeXBlID0gXCJmb2N1c2luXCI7XG4gICAgICAgIHNwZWMub25IYW5kbGVkID0gaGFuZGxlSW5wdXRGb2N1cztcbiAgICAgICAgcXEuZXh0ZW5kKHNwZWMsIHMpO1xuICAgICAgICBxcS5leHRlbmQodGhpcywgbmV3IHFxLkZpbGVuYW1lRWRpdEhhbmRsZXIoc3BlYywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpKTtcbiAgICB9O1xuICAgIHFxLkZpbGVuYW1lSW5wdXRGb2N1c0hhbmRsZXIgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBzcGVjLmV2ZW50VHlwZSA9IFwiZm9jdXNcIjtcbiAgICAgICAgc3BlYy5hdHRhY2hUbyA9IG51bGw7XG4gICAgICAgIHFxLmV4dGVuZCh0aGlzLCBuZXcgcXEuRmlsZW5hbWVJbnB1dEZvY3VzSW5IYW5kbGVyKHNwZWMsIHt9KSk7XG4gICAgfTtcbiAgICBxcS5GaWxlbmFtZUVkaXRIYW5kbGVyID0gZnVuY3Rpb24ocywgaW5oZXJpdGVkSW50ZXJuYWxBcGkpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBzcGVjID0ge1xuICAgICAgICAgICAgdGVtcGxhdGluZzogbnVsbCxcbiAgICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSwgbHZsKSB7fSxcbiAgICAgICAgICAgIG9uR2V0VXBsb2FkU3RhdHVzOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25HZXROYW1lOiBmdW5jdGlvbihmaWxlSWQpIHt9LFxuICAgICAgICAgICAgb25TZXROYW1lOiBmdW5jdGlvbihmaWxlSWQsIG5ld05hbWUpIHt9LFxuICAgICAgICAgICAgb25FZGl0aW5nU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbihmaWxlSWQsIGlzRWRpdGluZykge31cbiAgICAgICAgfTtcbiAgICAgICAgZnVuY3Rpb24gZ2V0RmlsZW5hbWVTYW5zRXh0ZW5zaW9uKGZpbGVJZCkge1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lU2Fuc0V4dCA9IHNwZWMub25HZXROYW1lKGZpbGVJZCksIGV4dElkeCA9IGZpbGVuYW1lU2Fuc0V4dC5sYXN0SW5kZXhPZihcIi5cIik7XG4gICAgICAgICAgICBpZiAoZXh0SWR4ID4gMCkge1xuICAgICAgICAgICAgICAgIGZpbGVuYW1lU2Fuc0V4dCA9IGZpbGVuYW1lU2Fuc0V4dC5zdWJzdHIoMCwgZXh0SWR4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmaWxlbmFtZVNhbnNFeHQ7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0T3JpZ2luYWxFeHRlbnNpb24oZmlsZUlkKSB7XG4gICAgICAgICAgICB2YXIgb3JpZ05hbWUgPSBzcGVjLm9uR2V0TmFtZShmaWxlSWQpO1xuICAgICAgICAgICAgcmV0dXJuIHFxLmdldEV4dGVuc2lvbihvcmlnTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTmFtZVVwZGF0ZShuZXdGaWxlbmFtZUlucHV0RWwsIGZpbGVJZCkge1xuICAgICAgICAgICAgdmFyIG5ld05hbWUgPSBuZXdGaWxlbmFtZUlucHV0RWwudmFsdWUsIG9yaWdFeHRlbnNpb247XG4gICAgICAgICAgICBpZiAobmV3TmFtZSAhPT0gdW5kZWZpbmVkICYmIHFxLnRyaW1TdHIobmV3TmFtZSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG9yaWdFeHRlbnNpb24gPSBnZXRPcmlnaW5hbEV4dGVuc2lvbihmaWxlSWQpO1xuICAgICAgICAgICAgICAgIGlmIChvcmlnRXh0ZW5zaW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3TmFtZSA9IG5ld05hbWUgKyBcIi5cIiArIG9yaWdFeHRlbnNpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNwZWMub25TZXROYW1lKGZpbGVJZCwgbmV3TmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzcGVjLm9uRWRpdGluZ1N0YXR1c0NoYW5nZShmaWxlSWQsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlcklucHV0Qmx1ckhhbmRsZXIoaW5wdXRFbCwgZmlsZUlkKSB7XG4gICAgICAgICAgICBpbmhlcml0ZWRJbnRlcm5hbEFwaS5nZXREaXNwb3NlU3VwcG9ydCgpLmF0dGFjaChpbnB1dEVsLCBcImJsdXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlTmFtZVVwZGF0ZShpbnB1dEVsLCBmaWxlSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJJbnB1dEVudGVyS2V5SGFuZGxlcihpbnB1dEVsLCBmaWxlSWQpIHtcbiAgICAgICAgICAgIGluaGVyaXRlZEludGVybmFsQXBpLmdldERpc3Bvc2VTdXBwb3J0KCkuYXR0YWNoKGlucHV0RWwsIFwia2V5dXBcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29kZSA9IGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2g7XG4gICAgICAgICAgICAgICAgaWYgKGNvZGUgPT09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZU5hbWVVcGRhdGUoaW5wdXRFbCwgZmlsZUlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBxcS5leHRlbmQoc3BlYywgcyk7XG4gICAgICAgIHNwZWMuYXR0YWNoVG8gPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RmlsZUxpc3QoKTtcbiAgICAgICAgcXEuZXh0ZW5kKHRoaXMsIG5ldyBxcS5VaUV2ZW50SGFuZGxlcihzcGVjLCBpbmhlcml0ZWRJbnRlcm5hbEFwaSkpO1xuICAgICAgICBxcS5leHRlbmQoaW5oZXJpdGVkSW50ZXJuYWxBcGksIHtcbiAgICAgICAgICAgIGhhbmRsZUZpbGVuYW1lRWRpdDogZnVuY3Rpb24oaWQsIHRhcmdldCwgZm9jdXNJbnB1dCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdGaWxlbmFtZUlucHV0RWwgPSBzcGVjLnRlbXBsYXRpbmcuZ2V0RWRpdElucHV0KGlkKTtcbiAgICAgICAgICAgICAgICBzcGVjLm9uRWRpdGluZ1N0YXR1c0NoYW5nZShpZCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgbmV3RmlsZW5hbWVJbnB1dEVsLnZhbHVlID0gZ2V0RmlsZW5hbWVTYW5zRXh0ZW5zaW9uKGlkKTtcbiAgICAgICAgICAgICAgICBpZiAoZm9jdXNJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdGaWxlbmFtZUlucHV0RWwuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJJbnB1dEJsdXJIYW5kbGVyKG5ld0ZpbGVuYW1lSW5wdXRFbCwgaWQpO1xuICAgICAgICAgICAgICAgIHJlZ2lzdGVySW5wdXRFbnRlcktleUhhbmRsZXIobmV3RmlsZW5hbWVJbnB1dEVsLCBpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59KSh3aW5kb3cpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmluZS11cGxvYWRlci5qcy5tYXBcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vZmluZS11cGxvYWRlci9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXIuanNcbi8vIG1vZHVsZSBpZCA9IDE4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCIuLi9maW5lLXVwbG9hZGVyL2ZpbmUtdXBsb2FkZXJcIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vZmluZS11cGxvYWRlci9saWIvdHJhZGl0aW9uYWwuanNcbi8vIG1vZHVsZSBpZCA9IDE5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIiFmdW5jdGlvbihmKXtpZihcIm9iamVjdFwiPT10eXBlb2YgZXhwb3J0cyYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSltb2R1bGUuZXhwb3J0cz1mKCk7ZWxzZSBpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQpZGVmaW5lKFtdLGYpO2Vsc2V7KFwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OlwidW5kZWZpbmVkXCIhPXR5cGVvZiBnbG9iYWw/Z2xvYmFsOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBzZWxmP3NlbGY6dGhpcykuTWV0ZW9yRW1vamk9ZigpfX0oZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG58fGUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfWZvcih2YXIgaT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7IWZ1bmN0aW9uKGdsb2JhbCxmYWN0b3J5KXtpZih2b2lkIDAhPT1leHBvcnRzKWZhY3RvcnkobW9kdWxlKTtlbHNle3ZhciBtb2Q9e2V4cG9ydHM6e319O2ZhY3RvcnkobW9kKSxnbG9iYWwubWV0ZW9yRW1vamk9bW9kLmV4cG9ydHN9fSh0aGlzLGZ1bmN0aW9uKG1vZHVsZSl7XCJ1c2Ugc3RyaWN0XCI7dmFyIF9jcmVhdGVDbGFzcz1mdW5jdGlvbigpe2Z1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LHByb3BzKXtmb3IodmFyIGk9MDtpPHByb3BzLmxlbmd0aDtpKyspe3ZhciBkZXNjcmlwdG9yPXByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZT1kZXNjcmlwdG9yLmVudW1lcmFibGV8fCExLGRlc2NyaXB0b3IuY29uZmlndXJhYmxlPSEwLFwidmFsdWVcImluIGRlc2NyaXB0b3ImJihkZXNjcmlwdG9yLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LGRlc2NyaXB0b3Iua2V5LGRlc2NyaXB0b3IpfX1yZXR1cm4gZnVuY3Rpb24oQ29uc3RydWN0b3IscHJvdG9Qcm9wcyxzdGF0aWNQcm9wcyl7cmV0dXJuIHByb3RvUHJvcHMmJmRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLHByb3RvUHJvcHMpLHN0YXRpY1Byb3BzJiZkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLHN0YXRpY1Byb3BzKSxDb25zdHJ1Y3Rvcn19KCksTWV0ZW9yRW1vamk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBNZXRlb3JFbW9qaSgpeyFmdW5jdGlvbihpbnN0YW5jZSxDb25zdHJ1Y3Rvcil7aWYoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpfSh0aGlzLE1ldGVvckVtb2ppKSx0aGlzLmluaXRpYXRlKCl9cmV0dXJuIF9jcmVhdGVDbGFzcyhNZXRlb3JFbW9qaSxbe2tleTpcImluaXRpYXRlXCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgX3RoaXM9dGhpcztkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1tZXRlb3ItZW1vamk9XCJ0cnVlXCJdLCBbZGF0YS1tZXRlb3ItZW1vamktbGFyZ2U9XCJ0cnVlXCJdJykuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtfdGhpcy5nZW5lcmF0ZUVsZW1lbnRzKGVsZW1lbnQpfSl9fSx7a2V5OlwiZ2VuZXJhdGVFbGVtZW50c1wiLHZhbHVlOmZ1bmN0aW9uKGVtb2ppSW5wdXQpe3ZhciBjbGlja0xpbms9ZnVuY3Rpb24oZXZlbnQpe3ZhciBjYXJldFBvcz1lbW9qaUlucHV0LnNlbGVjdGlvblN0YXJ0O2Vtb2ppSW5wdXQudmFsdWU9ZW1vamlJbnB1dC52YWx1ZS5zdWJzdHJpbmcoMCxjYXJldFBvcykrXCIgXCIrZXZlbnQudGFyZ2V0LmlubmVySFRNTCtlbW9qaUlucHV0LnZhbHVlLnN1YnN0cmluZyhjYXJldFBvcyksZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGFuZ3VsYXImJmFuZ3VsYXIuZWxlbWVudChlbW9qaUlucHV0KS50cmlnZ2VySGFuZGxlcihcImNoYW5nZVwiKX0sY2xpY2tDYXRlZ29yeT1mdW5jdGlvbihldmVudCl7ZW1vamlJbnB1dC5zZWxlY3Rpb25TdGFydDtlbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIjtmb3IodmFyIGhpZGVVbHM9ZW1vamlQaWNrZXIucXVlcnlTZWxlY3RvckFsbChcInVsXCIpLGk9MSxsPWhpZGVVbHMubGVuZ3RoO2k8bDtpKyspaGlkZVVsc1tpXS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciBiYWNrZ3JvdW5kVG9nZ2xlPWVtb2ppUGlja2VyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0ZWdvcnkgYVwiKTtmb3IoaT0wLGw9YmFja2dyb3VuZFRvZ2dsZS5sZW5ndGg7aTxsO2krKyliYWNrZ3JvdW5kVG9nZ2xlW2ldLnN0eWxlLmJhY2tncm91bmQ9XCJub25lXCI7ZW1vamlQaWNrZXIucXVlcnlTZWxlY3RvcihcIi5cIitldmVudC50YXJnZXQuaWQpLnN0eWxlLmRpc3BsYXk9XCJibG9ja1wiLGVtb2ppUGlja2VyLnF1ZXJ5U2VsZWN0b3IoXCIjXCIrZXZlbnQudGFyZ2V0LmlkKS5zdHlsZS5iYWNrZ3JvdW5kPVwiI2MyYzJjMlwifTtlbW9qaUlucHV0LnN0eWxlLndpZHRoPVwiMTAwJVwiO3ZhciBlbW9qaUNvbnRhaW5lcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2Vtb2ppQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uPVwicmVsYXRpdmVcIixlbW9qaUlucHV0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGVtb2ppQ29udGFpbmVyLGVtb2ppSW5wdXQpLGVtb2ppQ29udGFpbmVyLmFwcGVuZENoaWxkKGVtb2ppSW5wdXQpO3ZhciBlbW9qaVBpY2tlcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2Vtb2ppUGlja2VyLnRhYkluZGV4PTAsZW1vamlJbnB1dC5oYXNBdHRyaWJ1dGUoXCJkYXRhLW1ldGVvci1lbW9qaS1sYXJnZVwiKT8oZW1vamlQaWNrZXIuc3R5bGUuekluZGV4PVwiOTk5XCIsZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsZW1vamlQaWNrZXIuc3R5bGUud2lkdGg9XCIxMDAlXCIsZW1vamlQaWNrZXIuc3R5bGUubWFyZ2luQm90dG9tPVwiMTVweFwiKTooZW1vamlQaWNrZXIuc3R5bGUucG9zaXRpb249XCJhYnNvbHV0ZVwiLGVtb2ppUGlja2VyLnN0eWxlLnJpZ2h0PVwiMHB4XCIsZW1vamlQaWNrZXIuc3R5bGUudG9wPVwiMzBweFwiLGVtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXk9XCJub25lXCIsZW1vamlQaWNrZXIuc3R5bGUud2lkdGg9XCI0MDBweFwiKSxlbW9qaVBpY2tlci5zdHlsZS56SW5kZXg9XCI5OTlcIixlbW9qaVBpY2tlci5zdHlsZS5vdmVyZmxvdz1cImhpZGRlblwiLGVtb2ppUGlja2VyLnN0eWxlLmJhY2tncm91bmQ9XCIjZmZmXCIsZW1vamlQaWNrZXIuc3R5bGUuYm9yZGVyUmFkaXVzPVwiNXB4XCIsZW1vamlQaWNrZXIuc3R5bGUuYm94U2hhZG93PVwiMCAzcHggNnB4IHJnYmEoMCwwLDAsMC4xNiksIDAgM3B4IDZweCByZ2JhKDAsMCwwLDAuMjMpXCIsZW1vamlQaWNrZXIuc3R5bGUuYm9yZGVyUmFkaXVzPVwiMnB4O1wiLGVtb2ppUGlja2VyLnN0eWxlLm1hcmdpblRvcD1cIjVweFwiLGVtb2ppUGlja2VyLnN0eWxlLm91dGxpbmU9XCJub25lXCI7dmFyIGVtb2ppVHJpZ2dlcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaVRyaWdnZXIuc3R5bGUucG9zaXRpb249XCJhYnNvbHV0ZVwiLGVtb2ppVHJpZ2dlci5zdHlsZS50b3A9XCIxMHB4XCIsZW1vamlUcmlnZ2VyLnN0eWxlLnJpZ2h0PVwiMTBweFwiLGVtb2ppVHJpZ2dlci5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaVRyaWdnZXIuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppVHJpZ2dlci5pbm5lckhUTUw9JzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTIgMTRcIj48cGF0aCBkPVwiTTguOSA4LjRxLTAuMyAwLjktMS4xIDEuNXQtMS44IDAuNi0xLjgtMC42LTEuMS0xLjVxLTAuMS0wLjIgMC0wLjR0MC4zLTAuMnEwLjItMC4xIDAuNCAwdDAuMiAwLjNxMC4yIDAuNiAwLjcgMXQxLjIgMC40IDEuMi0wLjQgMC43LTFxMC4xLTAuMiAwLjMtMC4zdDAuNCAwIDAuMyAwLjIgMCAwLjR6TTUgNXEwIDAuNC0wLjMgMC43dC0wLjcgMC4zLTAuNy0wLjMtMC4zLTAuNyAwLjMtMC43IDAuNy0wLjMgMC43IDAuMyAwLjMgMC43ek05IDVxMCAwLjQtMC4zIDAuN3QtMC43IDAuMy0wLjctMC4zLTAuMy0wLjcgMC4zLTAuNyAwLjctMC4zIDAuNyAwLjMgMC4zIDAuN3pNMTEgN3EwLTEtMC40LTEuOXQtMS4xLTEuNi0xLjYtMS4xLTEuOS0wLjQtMS45IDAuNC0xLjYgMS4xLTEuMSAxLjYtMC40IDEuOSAwLjQgMS45IDEuMSAxLjYgMS42IDEuMSAxLjkgMC40IDEuOS0wLjQgMS42LTEuMSAxLjEtMS42IDAuNC0xLjl6TTEyIDdxMCAxLjYtMC44IDN0LTIuMiAyLjItMyAwLjgtMy0wLjgtMi4yLTIuMi0wLjgtMyAwLjgtMyAyLjItMi4yIDMtMC44IDMgMC44IDIuMiAyLjIgMC44IDN6XCIvPjwvc3ZnPicsZW1vamlUcmlnZ2VyLm9uY2xpY2s9ZnVuY3Rpb24oKXtcIm5vbmVcIj09PWVtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXk/ZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheT1cImJsb2NrXCI6XCJibG9ja1wiPT09ZW1vamlQaWNrZXIuc3R5bGUuZGlzcGxheSYmKGVtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXk9XCJub25lXCIpLGVtb2ppUGlja2VyLmZvY3VzKCl9LGVtb2ppSW5wdXQuaGFzQXR0cmlidXRlKFwiZGF0YS1tZXRlb3ItZW1vamktbGFyZ2VcIil8fGVtb2ppQ29udGFpbmVyLmFwcGVuZENoaWxkKGVtb2ppVHJpZ2dlciksd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLGZ1bmN0aW9uKGUpe2Vtb2ppSW5wdXQuaGFzQXR0cmlidXRlKFwiZGF0YS1tZXRlb3ItZW1vamktbGFyZ2VcIil8fFwiYmxvY2tcIj09PWVtb2ppUGlja2VyLnN0eWxlLmRpc3BsYXkmJihlbW9qaVBpY2tlci5jb250YWlucyhlLnRhcmdldCl8fGVtb2ppVHJpZ2dlci5jb250YWlucyhlLnRhcmdldCl8fChlbW9qaVBpY2tlci5zdHlsZS5kaXNwbGF5PVwibm9uZVwiKSl9KTt2YXIgZmFjZXNDYXRlZ29yeT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7ZmFjZXNDYXRlZ29yeS5zdHlsZS5wYWRkaW5nPVwiMTBweCAwcHhcIixmYWNlc0NhdGVnb3J5LnN0eWxlLm1hcmdpbj1cIjBcIixmYWNlc0NhdGVnb3J5LnN0eWxlLmxpc3RTdHlsZT1cIm5vbmVcIixmYWNlc0NhdGVnb3J5LnN0eWxlLnRleHRBbGlnbj1cImxlZnRcIixmYWNlc0NhdGVnb3J5LnN0eWxlLm1hcmdpbkxlZnQ9XCIzJVwiLGZhY2VzQ2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcImZhY2VzXCIpO3ZhciBhbmltYWxzQ2F0ZWdvcnk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO2FuaW1hbHNDYXRlZ29yeS5zdHlsZS5wYWRkaW5nPVwiMTBweCAwcHhcIixhbmltYWxzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLGFuaW1hbHNDYXRlZ29yeS5zdHlsZS5saXN0U3R5bGU9XCJub25lXCIsYW5pbWFsc0NhdGVnb3J5LnN0eWxlLnRleHRBbGlnbj1cImxlZnRcIixhbmltYWxzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsYW5pbWFsc0NhdGVnb3J5LmNsYXNzTGlzdC5hZGQoXCJhbmltYWxzXCIpLGFuaW1hbHNDYXRlZ29yeS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciBmb29kQ2F0ZWdvcnk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO2Zvb2RDYXRlZ29yeS5zdHlsZS5wYWRkaW5nPVwiMTBweCAwcHhcIixmb29kQ2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLGZvb2RDYXRlZ29yeS5zdHlsZS5saXN0U3R5bGU9XCJub25lXCIsZm9vZENhdGVnb3J5LnN0eWxlLnRleHRBbGlnbj1cImxlZnRcIixmb29kQ2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsZm9vZENhdGVnb3J5LmNsYXNzTGlzdC5hZGQoXCJmb29kXCIpLGZvb2RDYXRlZ29yeS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciBzcG9ydENhdGVnb3J5PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTtzcG9ydENhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIxMHB4IDBweFwiLHNwb3J0Q2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLHNwb3J0Q2F0ZWdvcnkuc3R5bGUubGlzdFN0eWxlPVwibm9uZVwiLHNwb3J0Q2F0ZWdvcnkuc3R5bGUudGV4dEFsaWduPVwibGVmdFwiLHNwb3J0Q2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsc3BvcnRDYXRlZ29yeS5jbGFzc0xpc3QuYWRkKFwic3BvcnRcIiksc3BvcnRDYXRlZ29yeS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciB0cmFuc3BvcnRDYXRlZ29yeT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7dHJhbnNwb3J0Q2F0ZWdvcnkuc3R5bGUucGFkZGluZz1cIjEwcHggMHB4XCIsdHJhbnNwb3J0Q2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLHRyYW5zcG9ydENhdGVnb3J5LnN0eWxlLmxpc3RTdHlsZT1cIm5vbmVcIix0cmFuc3BvcnRDYXRlZ29yeS5zdHlsZS50ZXh0QWxpZ249XCJsZWZ0XCIsdHJhbnNwb3J0Q2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsdHJhbnNwb3J0Q2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcInRyYW5zcG9ydFwiKSx0cmFuc3BvcnRDYXRlZ29yeS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciBvYmplY3RzQ2F0ZWdvcnk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInVsXCIpO29iamVjdHNDYXRlZ29yeS5zdHlsZS5wYWRkaW5nPVwiMTBweCAwcHhcIixvYmplY3RzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luPVwiMFwiLG9iamVjdHNDYXRlZ29yeS5zdHlsZS5saXN0U3R5bGU9XCJub25lXCIsb2JqZWN0c0NhdGVnb3J5LnN0eWxlLnRleHRBbGlnbj1cImxlZnRcIixvYmplY3RzQ2F0ZWdvcnkuc3R5bGUubWFyZ2luTGVmdD1cIjMlXCIsb2JqZWN0c0NhdGVnb3J5LmNsYXNzTGlzdC5hZGQoXCJvYmplY3RzXCIpLG9iamVjdHNDYXRlZ29yeS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3ZhciBlbW9qaUNhdGVnb3J5PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKTtlbW9qaUNhdGVnb3J5LnN0eWxlLnBhZGRpbmc9XCIwcHhcIixlbW9qaUNhdGVnb3J5LnN0eWxlLm1hcmdpbj1cIjBcIixlbW9qaUNhdGVnb3J5LnN0eWxlLmRpc3BsYXk9XCJ0YWJsZVwiLGVtb2ppQ2F0ZWdvcnkuc3R5bGUud2lkdGg9XCIxMDAlXCIsZW1vamlDYXRlZ29yeS5zdHlsZS5iYWNrZ3JvdW5kPVwiI2VmZjBmMVwiLGVtb2ppQ2F0ZWdvcnkuc3R5bGUubGlzdFN0eWxlPVwibm9uZVwiLGVtb2ppQ2F0ZWdvcnkuY2xhc3NMaXN0LmFkZChcImNhdGVnb3J5XCIpO3ZhciBlbW9qaUNhdGVnb3JpZXM9bmV3IEFycmF5O2Vtb2ppQ2F0ZWdvcmllcy5wdXNoKHtuYW1lOlwiZmFjZXNcIixzdmc6JzxzdmcgaWQ9XCJmYWNlc1wiIGRhdGEtbmFtZT1cIkxheWVyIDFcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCIgdmlld0JveD1cIjAgMCAxNTAgMTUwXCI+PHBhdGggaWQ9XCJmYWNlc1wiIGQ9XCJNNzQuMzQsMTI4LjQ4YTUzLjUsNTMuNSwwLDEsMSwzNy44NC0xNS42Nyw1My4xNiw1My4xNiwwLDAsMS0zNy44NCwxNS42N1ptMC05Ny44OWE0NC40LDQ0LjQsMCwxLDAsMzEuNCwxMyw0NC4wNyw0NC4wNywwLDAsMC0zMS40LTEzWlwiLz48cGF0aCBpZD1cImZhY2VzXCIgZD1cIk03NC4zNSwxMDhBMzMuMDcsMzMuMDcsMCwwLDEsNDEuMjksNzVhMi4yOCwyLjI4LDAsMCwxLDIuMjctMi4yOGgwQTIuMjcsMi4yNywwLDAsMSw0NS44Myw3NWEyOC41MiwyOC41MiwwLDAsMCw1NywwLDIuMjcsMi4yNywwLDAsMSw0LjU0LDBBMzMuMDksMzMuMDksMCwwLDEsNzQuMzUsMTA4WlwiLz48cGF0aCBpZD1cImZhY2VzXCIgZD1cIk01OC44NCw2MmE2LjgxLDYuODEsMCwxLDAsNi44MSw2LjgxQTYuODEsNi44MSwwLDAsMCw1OC44NCw2MlpcIi8+PHBhdGggaWQ9XCJmYWNlc1wiIGQ9XCJNODkuODcsNjJhNi44MSw2LjgxLDAsMSwwLDYuODEsNi44MUE2LjgyLDYuODIsMCwwLDAsODkuODcsNjJaXCIvPjwvc3ZnPid9KSxlbW9qaUNhdGVnb3JpZXMucHVzaCh7bmFtZTpcImFuaW1hbHNcIixzdmc6JzxzdmcgaWQ9XCJhbmltYWxzXCIgZGF0YS1uYW1lPVwiTGF5ZXIgMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDE1MCAxNTBcIj48cGF0aCBpZD1cImFuaW1hbHNcIiBkPVwiTTU5LjksOTEuNzVoMGMtMjIuNDYsMC00MS44Mi0xOS4zNC00NC4wOS00NEE1Mi4xLDUyLjEsMCwwLDEsMTYsMzYuOGE0LjUxLDQuNTEsMCwwLDEsMi42My0zLjYyLDM5Ljc5LDM5Ljc5LDAsMCwxLDEyLjc0LTMuMzdjMjMuOTItMi4xNSw0NS4zNSwxNy44Myw0Ny43NCw0My44NmE1Mi43Nyw1Mi43NywwLDAsMS0uMTUsMTAuOTMsNC41Niw0LjU2LDAsMCwxLTIuNjQsMy42MiwzOS42NywzOS42NywwLDAsMS0xMi43MywzLjM2Yy0xLjIzLjExLTIuNDUuMTctMy42Ni4xN1pNMjQuNzYsNDAuNDlhNDEuMjksNDEuMjksMCwwLDAsLjA5LDYuNEMyNi43LDY3LDQyLjA5LDgyLjY2LDU5LjksODIuNjdoMGMuOTQsMCwxLjg4LDAsMi44My0uMTRhMzAuMzksMzAuMzksMCwwLDAsNy40MS0xLjYyLDQxLjE0LDQxLjE0LDAsMCwwLS4xMS02LjRDNjguMDksNTMuMzgsNTEuMTEsMzcuMDgsMzIuMTcsMzguODZhMzAuNzgsMzAuNzgsMCwwLDAtNy40MSwxLjYzWlwiLz48cGF0aCBpZD1cImFuaW1hbHNcIiBkPVwiTTM2LjY4LDEyNS42NGE0LjUzLDQuNTMsMCwwLDEtNC4zMy0zLjE3LDUzLjMyLDUzLjMyLDAsMCwxLTIuMjYtMTFBNTAuNDIsNTAuNDIsMCwwLDEsMzkuNTEsNzYuNmM3LjM1LTkuOTEsMTcuODQtMTYsMjkuNS0xNywxLjE2LS4xMSwyLjMzLS4xMywzLjQ3LS4xM2E0LjU0LDQuNTQsMCwwLDEsNC4zMywzLjE2LDUxLjU5LDUxLjU5LDAsMCwxLDIuMjcsMTEuMDgsNTAuMzksNTAuMzksMCwwLDEtOS40MiwzNC44Yy03LjM1LDkuOTEtMTcuODMsMTYtMjkuNSwxN2ExNy42MywxNy42MywwLDAsMS0zLjQ4LjEyWk02OS4wOSw2OC42OUEzMi40MSwzMi40MSwwLDAsMCw0Ni44LDgyYTQyLjU3LDQyLjU3LDAsMCwwLTYuNzEsMzQuMzgsMzIuMzgsMzIuMzgsMCwwLDAsMjIuMjgtMTMuMzJBNDEuMzUsNDEuMzUsMCwwLDAsNzAsNzQuNTFhMzkuMzgsMzkuMzgsMCwwLDAtLjk0LTUuODJaXCIvPjxwYXRoIGlkPVwiYW5pbWFsc1wiIGQ9XCJNOTAuMjcsOTEuNzVjLTEuMjIsMC0yLjQzLS4wNi0zLjY2LS4xN2EzOS42NywzOS42NywwLDAsMS0xMi43My0zLjM2LDQuNTcsNC41NywwLDAsMS0yLjY0LTMuNjEsNTMuMzgsNTMuMzgsMCwwLDEtLjE3LTEwLjkzYzIuNDEtMjYsMjMuNy00Ni4wNyw0Ny43Ni00My44N2EzOS43NCwzOS43NCwwLDAsMSwxMi43MywzLjM3LDQuNTcsNC41NywwLDAsMSwyLjY0LDMuNjIsNTMuMzUsNTMuMzUsMCwwLDEsLjE2LDEwLjkyYy0yLjI4LDI0LjY5LTIxLjY1LDQ0LTQ0LjA5LDQ0Wk04MCw4MC45MWEzMC41NywzMC41NywwLDAsMCw3LjQyLDEuNjJjMTkuMDcsMS43OCwzNS45Mi0xNC41MywzNy44Ny0zNS42NGE0Mi41NSw0Mi41NSwwLDAsMCwuMS02LjRBMzAuODYsMzAuODYsMCwwLDAsMTE4LDM4Ljg2Qzk5LDM3LjA3LDgyLjA2LDUzLjM4LDgwLjEyLDc0LjUxYTQzLjkxLDQzLjkxLDAsMCwwLS4xLDYuNFpcIi8+PHBhdGggaWQ9XCJhbmltYWxzXCIgZD1cIk0xMTMuNDksMTI1LjY0aDBjLTEuMTYsMC0yLjMsMC0zLjQ2LS4xMi0yMy45LTIuMjEtNDEuMzYtMjUuNDctMzguOTQtNTEuODVBNTMuNTIsNTMuNTIsMCwwLDEsNzMuMzQsNjIuNmE0LjU1LDQuNTUsMCwwLDEsNC4zMy0zLjE2YzEuMTYsMCwyLjM0LDAsMy41MS4xMywxMS42NCwxLjA3LDIyLjExLDcuMTIsMjkuNDgsMTdhNTAuNTEsNTAuNTEsMCwwLDEsOS40MiwzNC44MSw1My41MSw1My41MSwwLDAsMS0yLjI2LDExLDQuNTQsNC41NCwwLDAsMS00LjMzLDMuMTlaTTgxLjA4LDY4LjY5YTQyLjUzLDQyLjUzLDAsMCwwLTEsNS44MmMtMS45NCwyMS4xLDExLjQ1LDM5LjcxLDI5Ljk1LDQxLjg4QTQyLjM4LDQyLjM4LDAsMCwwLDEwMy4zNiw4MiwzMi40MiwzMi40MiwwLDAsMCw4MS4wOCw2OC42OVpcIi8+PHBhdGggaWQ9XCJhbmltYWxzXCIgZD1cIk03NS4wOCw0NS40NWE3LjgzLDcuODMsMCwxLDAsNy44Myw3LjgzLDcuODMsNy44MywwLDAsMC03LjgzLTcuODNaXCIvPjxwYXRoIGlkPVwiYW5pbWFsc1wiIGQ9XCJNNzYuMjksNTEuODlhMi4yNiwyLjI2LDAsMCwxLTIuMTQtM0E0Niw0NiwwLDAsMSw5Mi44MiwyNS4zNGEyLjI3LDIuMjcsMCwxLDEsMi40LDMuODZBNDEuNCw0MS40LDAsMCwwLDc4LjQzLDUwLjM5YTIuMjgsMi4yOCwwLDAsMS0yLjE0LDEuNVpcIi8+PHBhdGggaWQ9XCJhbmltYWxzXCIgZD1cIk03My44Nyw1MS44OWEyLjI4LDIuMjgsMCwwLDEtMi4xNC0xLjVBNDEuMzUsNDEuMzUsMCwwLDAsNTQuOTQsMjkuMmEyLjI3LDIuMjcsMCwwLDEsMi4zOS0zLjg2QTQ2LDQ2LDAsMCwxLDc2LDQ4Ljg1YTIuMjgsMi4yOCwwLDAsMS0xLjM3LDIuOTEsMi4zMSwyLjMxLDAsMCwxLS43Ny4xM1pcIi8+PC9zdmc+J30pLGVtb2ppQ2F0ZWdvcmllcy5wdXNoKHtuYW1lOlwiZm9vZFwiLHN2ZzonPHN2ZyBpZD1cImZvb2RcIiBkYXRhLW5hbWU9XCJMYXllciAxXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMTUwIDE1MFwiPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNMTA0LDIwLjc2aC4xNWMxNS44My41MiwyNC4wOCwyMS40OCwyNC4wNywzMi41Ni4yNiwxMi40Mi0xMC43MiwyMy41NS0yNCwyNC4yMWEzLjUzLDMuNTMsMCwwLDEtLjQ2LDBjLTEzLjI1LS42Ni0yNC4yMy0xMS44LTI0LTI0LjMsMC0xMSw4LjI2LTMxLjk1LDI0LjA3LTMyLjQ3Wm0wLDQ3LjY5YzguMjUtLjU0LDE1LjMtNy41MSwxNS4xNC0xNSwwLTguMTItNi4yMi0yMy4xLTE1LjE0LTIzLjU3LTguOS40Ni0xNS4xNCwxNS40NS0xNS4xNCwyMy40OC0uMTQsNy42MSw2LjksMTQuNTksMTUuMTQsMTUuMTNaXCIvPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNOTcuMTksNjkuMjFoLjE0YTQuNTMsNC41MywwLDAsMSw0LjQsNC42OGwtMS40OCw0Ni45MmExLjU5LDEuNTksMCwwLDAsLjUsMS4wNiw0LjYsNC42LDAsMCwwLDMuMjUsMS4xOWgwYTQuNTcsNC41NywwLDAsMCwzLjI2LTEuMiwxLjUzLDEuNTMsMCwwLDAsLjQ5LTFsLTEuNDgtNDYuOTVhNC41NCw0LjU0LDAsMSwxLDkuMDgtLjI4bDEuNDcsNDYuOTFhMTAuNDIsMTAuNDIsMCwwLDEtMyw3LjY1LDEzLjY1LDEzLjY1LDAsMCwxLTkuODEsNGgwYTEzLjU4LDEzLjU4LDAsMCwxLTkuNzktNCwxMC40MiwxMC40MiwwLDAsMS0zLTcuNjdsMS40OC00Ni44OWE0LjUzLDQuNTMsMCwwLDEsNC41My00LjRaXCIvPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNNDEuODQsNjkuMjFINDJhNC41Myw0LjUzLDAsMCwxLDQuNCw0LjY4TDQ0LjksMTIwLjgxYTEuNTcsMS41NywwLDAsMCwuNSwxLjA2LDQuNiw0LjYsMCwwLDAsMy4yNSwxLjE5aDBhNC41MSw0LjUxLDAsMCwwLDMuMjQtMS4xOSwxLjQ4LDEuNDgsMCwwLDAsLjUtMUw1MC45Myw3My44OWE0LjUzLDQuNTMsMCwwLDEsNC4zOS00LjY4QTQuNCw0LjQsMCwwLDEsNjAsNzMuNjFsMS40OCw0Ni45MWExMC40OSwxMC40OSwwLDAsMS0zLDcuNjYsMTMuNTcsMTMuNTcsMCwwLDEtOS43OCw0aDBhMTMuNTksMTMuNTksMCwwLDEtOS43OC00LDEwLjQ4LDEwLjQ4LDAsMCwxLTMtNy42N2wxLjQ4LTQ2LjlhNC41NCw0LjU0LDAsMCwxLDQuNTQtNC40WlwiLz48cGF0aCBpZD1cImZvb2RcIiBkPVwiTTI4LjU5LDIwLjc2YTQuNTQsNC41NCwwLDAsMSw0LjU0LDQuNTRWNTFhMTUuNTIsMTUuNTIsMCwwLDAsMzEsMFYyNS4zYTQuNTUsNC41NSwwLDAsMSw5LjA5LDBWNTFhMjQuNjEsMjQuNjEsMCwxLDEtNDkuMjEsMFYyNS4zYTQuNTQsNC41NCwwLDAsMSw0LjU0LTQuNTRaXCIvPjxwYXRoIGlkPVwiZm9vZFwiIGQ9XCJNNTUuMzQsMjAuNzZhNC41NCw0LjU0LDAsMCwxLDQuNTQsNC41NHYxOWE0LjU0LDQuNTQsMCwxLDEtOS4wOCwwdi0xOWE0LjU0LDQuNTQsMCwwLDEsNC41NC00LjU0WlwiLz48cGF0aCBpZD1cImZvb2RcIiBkPVwiTTQyLDIwLjc2YTQuNTQsNC41NCwwLDAsMSw0LjU0LDQuNTR2MTlhNC41NCw0LjU0LDAsMSwxLTkuMDgsMHYtMTlBNC41NCw0LjU0LDAsMCwxLDQyLDIwLjc2WlwiLz48L3N2Zz4nfSksZW1vamlDYXRlZ29yaWVzLnB1c2goe25hbWU6XCJzcG9ydFwiLHN2ZzonPHN2ZyBpZD1cInNwb3J0XCIgZGF0YS1uYW1lPVwiTGF5ZXIgMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDE1MCAxNTBcIj48cGF0aCBpZD1cInNwb3J0XCIgZD1cIk03NS4zNSwxMzAuMjRhNTMuNDksNTMuNDksMCwxLDEsNTMuNDgtNTMuNDksNTMuNTUsNTMuNTUsMCwwLDEtNTMuNDgsNTMuNDlabTAtOTcuODlhNDQuNDEsNDQuNDEsMCwxLDAsNDQuNCw0NC40LDQ0LjEsNDQuMSwwLDAsMC00NC40LTQ0LjRaXCIvPjxwYXRoIGlkPVwic3BvcnRcIiBkPVwiTTExOS4yNCw4NC4wOEE1MS4yOSw1MS4yOSwwLDAsMSw2OCwzMi44NmE0OS40NCw0OS40NCwwLDAsMSwuMjYtNSwyLjI2LDIuMjYsMCwwLDEsMi0yYzEuNjYtLjE2LDMuMzQtLjI1LDUtLjI1YTUxLjI2LDUxLjI2LDAsMCwxLDUxLjIxLDUxLjIxYzAsMS43MS0uMDksMy4zOC0uMjUsNWEyLjI4LDIuMjgsMCwwLDEtMiwyYy0xLjY1LjE2LTMuMzMuMjUtNSwuMjVaTTcyLjY0LDMwLjE2Yy0uMDYuOS0uMDgsMS43OS0uMDgsMi43YTQ2LjczLDQ2LjczLDAsMCwwLDQ2LjY4LDQ2LjY4cTEuMzcsMCwyLjctLjA5Yy4wNi0uODkuMDgtMS43OS4wOC0yLjdBNDYuNzIsNDYuNzIsMCwwLDAsNzUuMzUsMzAuMDhjLS45MSwwLTEuODIsMC0yLjcxLjA4WlwiLz48cGF0aCBpZD1cInNwb3J0XCIgZD1cIk03NS4zNSwxMjhBNTEuMjgsNTEuMjgsMCwwLDEsMjQuMTIsNzYuNzZjMC0xLjcuMS0zLjM4LjI1LTVhMi4yOSwyLjI5LDAsMCwxLDItMmMxLjY2LS4xNiwzLjMzLS4yNSw1LjA1LS4yNWE1MS4yNyw1MS4yNywwLDAsMSw1MS4yMSw1MS4yMmMwLDEuNjktLjA5LDMuMzctLjI1LDVhMi4yNywyLjI3LDAsMCwxLTIsMmMtMS42Ni4xNi0zLjMyLjI1LTUsLjI1Wk0yOC43NSw3NC4wNWMtLjA1LjktLjA5LDEuOC0uMDksMi43MWE0Ni43NCw0Ni43NCwwLDAsMCw0Ni42OSw0Ni42N2MuOTEsMCwxLjgsMCwyLjctLjA4LDAtLjkuMDgtMS44LjA4LTIuN0E0Ni43Myw0Ni43MywwLDAsMCwzMS40Niw3NGMtLjkxLDAtMS44MSwwLTIuNzEuMDhaXCIvPjxwb2x5Z29uIGlkPVwic3BvcnRcIiBwb2ludHM9XCI0Mi42OSAxMTIuNjEgMzkuNDggMTA5LjQgMTA4IDQwLjg4IDExMS4yMSA0NC4xIDQyLjY5IDExMi42MSA0Mi42OSAxMTIuNjFcIi8+PC9zdmc+J30pLGVtb2ppQ2F0ZWdvcmllcy5wdXNoKHtuYW1lOlwidHJhbnNwb3J0XCIsc3ZnOic8c3ZnIGlkPVwidHJhbnNwb3J0XCIgZGF0YS1uYW1lPVwiTGF5ZXIgMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDE1MCAxNTBcIj48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNMTIwLjcsMTE2SDMxYTQuNTUsNC41NSwwLDAsMS00LjU0LTQuNTVWNTQuMjhBMzEuODIsMzEuODIsMCwwLDEsNTguMjUsMjIuNDloMzUuMmEzMS44MywzMS44MywwLDAsMSwzMS44LDMxLjc5djU3LjE1QTQuNTUsNC41NSwwLDAsMSwxMjAuNywxMTZabS04NS4xNi05LjA5aDgwLjYyVjU0LjI4QTIyLjc0LDIyLjc0LDAsMCwwLDkzLjQ1LDMxLjU3SDU4LjI1QTIyLjc0LDIyLjc0LDAsMCwwLDM1LjU0LDU0LjI4djUyLjYxWlwiLz48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNNDkuMzUsMTI5LjIzYy04LjUzLDAtMTMuNjItMi43Ny0xMy42Mi03LjQxVjExNS42YTQuNTQsNC41NCwwLDEsMSw5LjA4LDB2NC4wNmEyMS4zMiwyMS4zMiwwLDAsMCw5LjA5LDBWMTE1LjZhNC41NCw0LjU0LDAsMCwxLDkuMDgsMHY2LjIyYzAsNC42NC01LjA5LDcuNDEtMTMuNjMsNy40MVpcIi8+PHBhdGggaWQ9XCJ0cmFuc3BvcnRcIiBkPVwiTTEwMi4zNCwxMjkuMjNjLTguNTMsMC0xMy42Mi0yLjc3LTEzLjYyLTcuNDFWMTE1LjZhNC41NCw0LjU0LDAsMCwxLDkuMDgsMHY0LjA2YTIxLjI4LDIxLjI4LDAsMCwwLDkuMDgsMFYxMTUuNmE0LjU1LDQuNTUsMCwwLDEsOS4wOSwwdjYuMjJjMCw0LjY0LTUuMDksNy40MS0xMy42Myw3LjQxWlwiLz48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNOTcuODEsNDQuODNINTMuOWE0LjU1LDQuNTUsMCwxLDEsMC05LjA5SDk3LjgxYTQuNTUsNC41NSwwLDAsMSwwLDkuMDlaXCIvPjxwYXRoIGlkPVwidHJhbnNwb3J0XCIgZD1cIk01NC4yOCw4NC4yQTYuOCw2LjgsMCwxLDAsNjEuMDcsOTFhNi44LDYuOCwwLDAsMC02Ljc5LTYuOFpcIi8+PHBhdGggaWQ9XCJ0cmFuc3BvcnRcIiBkPVwiTTk3LjQzLDg0LjJhNi44LDYuOCwwLDEsMCw2Ljc5LDYuOCw2LjgsNi44LDAsMCwwLTYuNzktNi44WlwiLz48cGF0aCBpZD1cInRyYW5zcG9ydFwiIGQ9XCJNMTA3LjA4LDgxSDQ0LjYzYTYuODIsNi44MiwwLDAsMS02LjgyLTYuODJWNTQuMjhhNi44Miw2LjgyLDAsMCwxLDYuODItNi44MWg2Mi40NWE2LjgyLDYuODIsMCwwLDEsNi44MSw2LjgxVjc0LjE1QTYuODMsNi44MywwLDAsMSwxMDcuMDgsODFaTTQ0LjYzLDUyYTIuMjgsMi4yOCwwLDAsMC0yLjI4LDIuMjdWNzQuMTVhMi4yOCwyLjI4LDAsMCwwLDIuMjgsMi4yN2g2Mi40NWEyLjI3LDIuMjcsMCwwLDAsMi4yNy0yLjI3VjU0LjI4QTIuMjcsMi4yNywwLDAsMCwxMDcuMDgsNTJaXCIvPjwvc3ZnPid9KSxlbW9qaUNhdGVnb3JpZXMucHVzaCh7bmFtZTpcIm9iamVjdHNcIixzdmc6JzxzdmcgaWQ9XCJvYmplY3RzXCIgZGF0YS1uYW1lPVwiTGF5ZXIgMVwiIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjIwXCIgaGVpZ2h0PVwiMjBcIiB2aWV3Qm94PVwiMCAwIDE1MCAxNTBcIj48cGF0aCBpZD1cIm9iamVjdHNcIiBkPVwiTTEwNy43OCwxMjlhNC41NSw0LjU1LDAsMCwxLTIuNjctLjg3bC0zMC0yMS43OS0zMCwyMS43OWE0LjUzLDQuNTMsMCwwLDEtNS4zNCwwLDQuNTgsNC41OCwwLDAsMS0xLjY1LTUuMDhMNDkuNTksODcuODIsMTkuNiw2NmE0LjU0LDQuNTQsMCwwLDEsMi42Ny04LjIySDU5LjM0TDcwLjgsMjIuNTVhNC41NSw0LjU1LDAsMCwxLDguNjQsMEw5MC44OSw1Ny44MUgxMjhBNC41NCw0LjU0LDAsMCwxLDEzMC42Myw2NmwtMzAsMjEuNzksMTEuNDYsMzUuMjVhNC41NSw0LjU1LDAsMCwxLTQuMzIsNlpNNzUuMTIsOTYuMmE0LjUzLDQuNTMsMCwwLDEsMi42Ny44N2wyMS4zNSwxNS41MUw5MSw4Ny40OWE0LjU1LDQuNTUsMCwwLDEsMS42NS01LjA4TDExNCw2Ni44OUg4Ny41OWE0LjU0LDQuNTQsMCwwLDEtNC4zMi0zLjEzbC04LjE1LTI1LjFMNjcsNjMuNzZhNC41Myw0LjUzLDAsMCwxLTQuMzIsMy4xM0gzNi4yNUw1Ny42MSw4Mi40MWE0LjU0LDQuNTQsMCwwLDEsMS42NSw1LjA4bC04LjE3LDI1LjA5TDcyLjQ1LDk3LjA3YTQuNTMsNC41MywwLDAsMSwyLjY3LS44N1pcIi8+PC9zdmc+J30pO2Vtb2ppQ2F0ZWdvcmllcy5tYXAoZnVuY3Rpb24oaXRlbSl7dmFyIGVtb2ppTGluaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaUxpbmsuc3R5bGUudGV4dERlY29yYXRpb249XCJub25lXCIsZW1vamlMaW5rLnN0eWxlLnBhZGRpbmc9XCI1cHhcIixlbW9qaUxpbmsuc3R5bGUucG9zaXRpb249XCJpbml0aWFsXCIsZW1vamlMaW5rLnN0eWxlLmZvbnRTaXplPVwiMjRweFwiLGVtb2ppTGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCJqYXZhc2NyaXB0OnZvaWQoMClcIiksZW1vamlMaW5rLnN0eWxlLmRpc3BsYXk9XCJ0YWJsZS1jZWxsXCIsZW1vamlMaW5rLnN0eWxlLnRleHRBbGlnbj1cImNlbnRlclwiLGVtb2ppTGluay5pZD1TdHJpbmcoaXRlbS5uYW1lKSxcImZhY2VzXCI9PVN0cmluZyhpdGVtLm5hbWUpJiYoZW1vamlMaW5rLnN0eWxlLmJhY2tncm91bmQ9XCIjYzJjMmMyXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nKGl0ZW0uc3ZnKSxlbW9qaUxpbmsub25tb3VzZWRvd249Y2xpY2tDYXRlZ29yeSxlbW9qaUNhdGVnb3J5LmFwcGVuZENoaWxkKGVtb2ppTGluayl9KSxbMTI4NTEzLDEyODUxNCwxMjg1MTUsMTI4NTE2LDEyODUxNywxMjg1MTgsMTI4NTIxLDEyODUyMiwxMjg1MjMsMTI4NTI0LDEyODUyNSwxMjg1MjcsMTI4NTMwLDEyODUzMSwxMjg1MzIsMTI4NTM0LDEyODUzNiwxMjg1MzgsMTI4NTQwLDEyODU0MSwxMjg1NDIsMTI4NTQ0LDEyODU0NSwxMjg1NDYsMTI4NTQ3LDEyODU0OCwxMjg1NDksMTI4NTUyLDEyODU1MywxMjg1NTQsMTI4NTU1LDEyODU1NywxMjg1NjAsMTI4NTYxLDEyODU2MiwxMjg1NjMsMTI4NTY1LDEyODU2N10ubWFwKGZ1bmN0aW9uKGl0ZW0pe3ZhciBlbW9qaUxpbms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7ZW1vamlMaW5rLnN0eWxlLnRleHREZWNvcmF0aW9uPVwibm9uZVwiLGVtb2ppTGluay5zdHlsZS5tYXJnaW49XCI1cHhcIixlbW9qaUxpbmsuc3R5bGUucG9zaXRpb249XCJpbml0aWFsXCIsZW1vamlMaW5rLnN0eWxlLmZvbnRTaXplPVwiMjRweFwiLGVtb2ppTGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCJqYXZhc2NyaXB0OnZvaWQoMClcIiksZW1vamlMaW5rLmlubmVySFRNTD1TdHJpbmcuZnJvbUNvZGVQb2ludChpdGVtKSxlbW9qaUxpbmsub25tb3VzZWRvd249Y2xpY2tMaW5rLGZhY2VzQ2F0ZWdvcnkuYXBwZW5kQ2hpbGQoZW1vamlMaW5rKX0pLFsxMjgwMTIsMTI4MDEzLDEyODAxNCwxMjgwMTcsMTI4MDE4LDEyODAyMCwxMjgwMjMsMTI4MDI0LDEyODAyNSwxMjgwMjYsMTI4MDI3LDEyODAyOCwxMjgwMjksMTI4MDMwLDEyODAzMSwxMjgwMzIsMTI4MDMzLDEyODAzNCwxMjgwMzUsMTI4MDM2LDEyODAzNywxMjgwMzgsMTI4MDM5LDEyODA0MCwxMjgwNDEsMTI4MDQzLDEyODA0NCwxMjgwNDUsMTI4MDQ2LDEyODA0NywxMjgwNDgsMTI4MDQ5LDEyODA1MCwxMjgwNTEsMTI4MDUyLDEyODA1MywxMjgwNTQsMTI4MDU1LDEyODA1NiwxMjgwNTcsMTI4MDU4LDEyODA1OSwxMjgwNjBdLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUubWFyZ2luPVwiNXB4XCIsZW1vamlMaW5rLnN0eWxlLnBvc2l0aW9uPVwiaW5pdGlhbFwiLGVtb2ppTGluay5zdHlsZS5mb250U2l6ZT1cIjI0cHhcIixlbW9qaUxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nLmZyb21Db2RlUG9pbnQoaXRlbSksZW1vamlMaW5rLm9ubW91c2Vkb3duPWNsaWNrTGluayxhbmltYWxzQ2F0ZWdvcnkuYXBwZW5kQ2hpbGQoZW1vamlMaW5rKX0pLFsxMjc4MTMsMTI3ODE0LDEyNzgxNSwxMjc4MTYsMTI3ODE3LDEyNzgxOCwxMjc4MjAsMTI3ODIxLDEyNzgyMiwxMjc4MjMsMTI3ODI1LDEyNzgyNiwxMjc4MjcsMTI3ODI4LDEyNzgyOSwxMjc4MzAsMTI3ODMxLDEyNzgzMiwxMjc4MzYsMTI3ODM3LDEyNzgzOCwxMjc4MzksMTI3ODQwLDEyNzg0MSwxMjc4NDIsMTI3ODQzLDEyNzg0NCwxMjc4NDYsMTI3ODQ4LDEyNzg0OSwxMjc4NTAsMTI3ODUxLDEyNzg1MiwxMjc4NTMsMTI3ODU2LDEyNzg1OCwxMjc4NTksMTI3ODYwLDEyNzg2MywxMjc4NjQsMTI3ODY3XS5tYXAoZnVuY3Rpb24oaXRlbSl7dmFyIGVtb2ppTGluaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaUxpbmsuc3R5bGUudGV4dERlY29yYXRpb249XCJub25lXCIsZW1vamlMaW5rLnN0eWxlLm1hcmdpbj1cIjVweFwiLGVtb2ppTGluay5zdHlsZS5wb3NpdGlvbj1cImluaXRpYWxcIixlbW9qaUxpbmsuc3R5bGUuZm9udFNpemU9XCIyNHB4XCIsZW1vamlMaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIixcImphdmFzY3JpcHQ6dm9pZCgwKVwiKSxlbW9qaUxpbmsuaW5uZXJIVE1MPVN0cmluZy5mcm9tQ29kZVBvaW50KGl0ZW0pLGVtb2ppTGluay5vbm1vdXNlZG93bj1jbGlja0xpbmssZm9vZENhdGVnb3J5LmFwcGVuZENoaWxkKGVtb2ppTGluayl9KSxbMTI3OTIxLDEyNzkyMywxMjc5MzQsMTI3OTM1LDEyNzkzNiwxMjc5MzcsMTI3OTM4LDEyNzkzOSwxMjc5NDAsMTI3OTQyLDEyNzk0NCwxMjc5NDYsMTI4Njc1LDEyODY5MiwxMjg2OTMsOTkxNyw5OTE4LDk5NzgsMTI3OTA3LDEyNzkxOSw5OTcxXS5tYXAoZnVuY3Rpb24oaXRlbSl7dmFyIGVtb2ppTGluaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaUxpbmsuc3R5bGUudGV4dERlY29yYXRpb249XCJub25lXCIsZW1vamlMaW5rLnN0eWxlLm1hcmdpbj1cIjVweFwiLGVtb2ppTGluay5zdHlsZS5wb3NpdGlvbj1cImluaXRpYWxcIixlbW9qaUxpbmsuc3R5bGUuZm9udFNpemU9XCIyNHB4XCIsZW1vamlMaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIixcImphdmFzY3JpcHQ6dm9pZCgwKVwiKSxlbW9qaUxpbmsuaW5uZXJIVE1MPVN0cmluZy5mcm9tQ29kZVBvaW50KGl0ZW0pLGVtb2ppTGluay5vbm1vdXNlZG93bj1jbGlja0xpbmssc3BvcnRDYXRlZ29yeS5hcHBlbmRDaGlsZChlbW9qaUxpbmspfSksWzEyODY0MSwxMjg2NDIsMTI4NjQ2LDEyODY0OCwxMjg2NTAsMTI4NjUzLDEyODY1NCwxMjg2NTYsMTI4NjYwLDEyODY2MiwxMjg2NjQsMTI4NjY3LDEyODY2OCwxMjg2NjksMTI4NjcwLDEyODY3MSwxMjg2NzIsMTI4NjczLDEyODY0MCwxMjg2NDMsMTI4NjQ0LDEyODY0NSwxMjg2NDcsMTI4NjQ5LDEyODY1MiwxMjg2NTcsMTI4NjU4LDEyODY1OSwxMjg2NjEsMTI4NjYzLDEyODY2NSwxMjg2NjYsMTI4Njc0LDEyODY3NiwxMjg2OTBdLm1hcChmdW5jdGlvbihpdGVtKXt2YXIgZW1vamlMaW5rPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2Vtb2ppTGluay5zdHlsZS50ZXh0RGVjb3JhdGlvbj1cIm5vbmVcIixlbW9qaUxpbmsuc3R5bGUubWFyZ2luPVwiNXB4XCIsZW1vamlMaW5rLnN0eWxlLnBvc2l0aW9uPVwiaW5pdGlhbFwiLGVtb2ppTGluay5zdHlsZS5mb250U2l6ZT1cIjI0cHhcIixlbW9qaUxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiamF2YXNjcmlwdDp2b2lkKDApXCIpLGVtb2ppTGluay5pbm5lckhUTUw9U3RyaW5nLmZyb21Db2RlUG9pbnQoaXRlbSksZW1vamlMaW5rLm9ubW91c2Vkb3duPWNsaWNrTGluayx0cmFuc3BvcnRDYXRlZ29yeS5hcHBlbmRDaGlsZChlbW9qaUxpbmspfSksWzEyNzg5MCwxMjc4ODAsMTI3ODgxLDEyNzg4NywxMjc4OTEsMTI3OTA1LDEyNzkwNiwxMjc5MDgsMTI3OTA5LDEyNzkxMSwxMjc5MTIsMTI3OTE1LDEyNzkxNiwxMjc5MTgsMTI3OTE5LDEyNzkyNiwxMjc5MjcsMTI3OTI4LDEyNzkyOSwxMjc5MzAsMTI3OTMxLDEyNzkzMiwxMjc5NjgsMTI3OTczLDEyNzk3OCwxMjgxNDcsMTI4MTQ4LDEyODE0OSwxMjgxNTAsMTI4MTUxLDEyODE1MiwxMjgxODcsMTI4MTg2LDEyODE5NywxMjgyMTMsMTI4MjQ3XS5tYXAoZnVuY3Rpb24oaXRlbSl7dmFyIGVtb2ppTGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO2Vtb2ppTGkuc3R5bGUuZGlzcGxheT1cImlubGluZS1ibG9ja1wiLGVtb2ppTGkuc3R5bGUubWFyZ2luPVwiNXB4XCI7dmFyIGVtb2ppTGluaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtlbW9qaUxpbmsuc3R5bGUudGV4dERlY29yYXRpb249XCJub25lXCIsZW1vamlMaW5rLnN0eWxlLm1hcmdpbj1cIjVweFwiLGVtb2ppTGluay5zdHlsZS5wb3NpdGlvbj1cImluaXRpYWxcIixlbW9qaUxpbmsuc3R5bGUuZm9udFNpemU9XCIyNHB4XCIsZW1vamlMaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIixcImphdmFzY3JpcHQ6dm9pZCgwKVwiKSxlbW9qaUxpbmsuaW5uZXJIVE1MPVN0cmluZy5mcm9tQ29kZVBvaW50KGl0ZW0pLGVtb2ppTGluay5vbm1vdXNlZG93bj1jbGlja0xpbmssb2JqZWN0c0NhdGVnb3J5LmFwcGVuZENoaWxkKGVtb2ppTGluayl9KSxlbW9qaVBpY2tlci5hcHBlbmRDaGlsZChlbW9qaUNhdGVnb3J5KSxlbW9qaVBpY2tlci5hcHBlbmRDaGlsZChmYWNlc0NhdGVnb3J5KSxlbW9qaVBpY2tlci5hcHBlbmRDaGlsZChhbmltYWxzQ2F0ZWdvcnkpLGVtb2ppUGlja2VyLmFwcGVuZENoaWxkKGZvb2RDYXRlZ29yeSksZW1vamlQaWNrZXIuYXBwZW5kQ2hpbGQoc3BvcnRDYXRlZ29yeSksZW1vamlQaWNrZXIuYXBwZW5kQ2hpbGQodHJhbnNwb3J0Q2F0ZWdvcnkpLGVtb2ppUGlja2VyLmFwcGVuZENoaWxkKG9iamVjdHNDYXRlZ29yeSksZW1vamlDb250YWluZXIuYXBwZW5kQ2hpbGQoZW1vamlQaWNrZXIpfX1dKSxNZXRlb3JFbW9qaX0oKTttb2R1bGUuZXhwb3J0cz1NZXRlb3JFbW9qaX0pfSx7fV19LHt9LFsxXSkoMSl9KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vbWV0ZW9yLWVtb2ppL2Rpc3QvbWV0ZW9yRW1vamkubWluLmpzXG4vLyBtb2R1bGUgaWQgPSAyMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1vZHVsZSkge1xyXG5cdGlmKCFtb2R1bGUud2VicGFja1BvbHlmaWxsKSB7XHJcblx0XHRtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fTtcclxuXHRcdG1vZHVsZS5wYXRocyA9IFtdO1xyXG5cdFx0Ly8gbW9kdWxlLnBhcmVudCA9IHVuZGVmaW5lZCBieSBkZWZhdWx0XHJcblx0XHRpZighbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsIFwibG9hZGVkXCIsIHtcclxuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcclxuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmw7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJpZFwiLCB7XHJcblx0XHRcdGVudW1lcmFibGU6IHRydWUsXHJcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0cmV0dXJuIG1vZHVsZS5pO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdG1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxO1xyXG5cdH1cclxuXHRyZXR1cm4gbW9kdWxlO1xyXG59O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAod2VicGFjaykvYnVpbGRpbi9tb2R1bGUuanNcbi8vIG1vZHVsZSBpZCA9IDIxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=